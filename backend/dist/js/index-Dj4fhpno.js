import{k as Y,r as H,e as Z,c,o as A,w as G,a as J,Q as r,R as a,K as n,F as _,N as h,_ as v,a7 as K,S as g,V as p,U as d,l as O,Y as y,$ as S,v as X,j as M,q as ee}from"./vue-vendor-Bom1XEVO.js";import{Z as te,$ as se,L as ne,P as ae,U as oe}from"./ui-vendor-D9aA433m.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"c-form-steps"},re={key:0,class:"single-panel"},ue={key:1,class:"steps-container"},ce={key:0,class:"step-header"},pe={class:"step-title"},de={key:0,class:"step-description"},fe={class:"step-form-items"},ve={class:"steps-actions"},me=Y({__name:"index",props:{formItems:{},layoutConfig:{default:()=>({})},options:{default:()=>[]}},emits:["step-change","step-before-change","step-validate"],setup(T,{expose:j,emit:U}){const k=T,x=U,s=H(0),m=H(!1),w=Z({}),i=c(()=>{const e=k.layoutConfig?.steps||{};return{steps:e.steps||[],vertical:e.vertical||!1,size:e.size||"medium",showStepHeader:e.showStepHeader!==!1,validateBeforeNext:e.validateBeforeNext||!1,prevButtonText:e.prevButtonText||"上一步",nextButtonText:e.nextButtonText||"下一步",defaultStep:e.defaultStep||0}}),B=c(()=>i.value.steps.length>0),o=c(()=>{if(!B.value)return[];const e=new Map;return i.value.steps.forEach(t=>{e.set(t.key,[])}),k.formItems.forEach((t,u)=>{const f=k.options?.[u]?.layout?.step||i.value.steps[0]?.key||"default";e.has(f)||e.set(f,[]),e.get(f).push(t)}),i.value.steps.map(t=>({config:t,items:e.get(t.key)||[]})).filter(t=>t.items.length>0)}),q=c(()=>{for(let e=0;e<=s.value;e++)if(w[e]===!1)return"error";return"process"}),Q=c(()=>s.value===0),R=c(()=>s.value===o.value.length-1),z=(e,t)=>{if(e.key!=null)return String(e.key);const u=e.props;return u?.path?u.path:`step-item-${t}`},D=async()=>{try{const t=await Promise.resolve(x("step-validate",s.value))!==!1;return w[s.value]=t,t}catch{return w[s.value]=!1,!1}},N=async(e,t=!1)=>{if(e<0||e>=o.value.length)return!1;if(e===s.value)return!0;try{return m.value=!0,t&&i.value.validateBeforeNext&&!await D()?!1:(await x("step-before-change",s.value,e),s.value=e,x("step-change",s.value,o.value[s.value].config.key),!0)}catch{return!1}finally{m.value=!1}},b=async()=>{await N(s.value+1,!0)},C=()=>{N(s.value-1)},F=async e=>{if(o.value[e]?.config.disabled)return;const t=e>s.value;await N(e,t)},I=()=>{if(!B.value||o.value.length===0)return;const{defaultStep:e}=i.value,t=e>=0&&e<o.value.length&&!o.value[e]?.config.disabled;s.value=t?e:0};return A(()=>{I()}),G(()=>o.value,()=>I(),{immediate:!0}),j({nextStep:b,previousStep:C,goToStep:F,validateCurrentStep:D,currentStep:J(s),totalSteps:c(()=>o.value.length)}),(e,t)=>{const u=te,L=se,f=ne,P=ae,$=oe;return a(),r("div",ie,[n(B)?(a(),r("div",ue,[g(L,{current:n(s)+1,status:n(q),size:n(i).size,vertical:n(i).vertical,class:"steps-indicator"},{default:d(()=>[(a(!0),r(_,null,h(n(o),l=>(a(),v(u,{key:l.config.key,title:l.config.title,description:l.config.description,disabled:l.config.disabled},null,8,["title","description","disabled"]))),128))]),_:1},8,["current","status","size","vertical"]),g(f,{class:"steps-content",bordered:!1},{default:d(()=>[(a(!0),r(_,null,h(n(o),(l,V)=>O((a(),r("div",{key:l.config.key,class:"step-panel"},[n(i).showStepHeader?(a(),r("div",ce,[p("h3",pe,S(l.config.title),1),l.config.description?(a(),r("p",de,S(l.config.description),1)):y("",!0)])):y("",!0),p("div",fe,[(a(!0),r(_,null,h(l.items,(E,W)=>(a(),v(K(E),{key:z(E,W)}))),128))])])),[[X,n(s)===V]])),128))]),_:1}),p("div",ve,[g($,{justify:"space-between"},{default:d(()=>[n(s)>0?(a(),v(P,{key:0,disabled:n(m),onClick:C},{default:d(()=>[t[0]||(t[0]=p("div",{class:"i-mdi:chevron-left-first mr-1"},null,-1)),M(" "+S(n(i).prevButtonText),1)]),_:1},8,["disabled"])):y("",!0),t[2]||(t[2]=p("div",null,null,-1)),g($,null,{default:d(()=>[n(s)<n(o).length-1?(a(),v(P,{key:0,type:"primary",loading:n(m),onClick:b},{default:d(()=>[M(S(n(i).nextButtonText)+" ",1),t[1]||(t[1]=p("div",{class:"i-mdi:chevron-right-last ml-1"},null,-1))]),_:1},8,["loading"])):y("",!0),ee(e.$slots,"step-actions",{currentStep:n(s),totalSteps:n(o).length,isFirstStep:n(Q),isLastStep:n(R),nextStep:b,previousStep:C,goToStep:F},void 0,!0)]),_:3})]),_:3})])])):(a(),r("div",re,[(a(!0),r(_,null,h(T.formItems,(l,V)=>(a(),v(K(l),{key:z(l,V)}))),128))]))])}}}),ye=le(me,[["__scopeId","data-v-866550c0"]]);export{ye as default};
