import{u as R,w as q,a as ke}from"./office-vendor-DJWPL5tb.js";import{z as Ne,S as le,aA as Ee,aO as Se,U as $e,az as Ce,as as De,P as ze,ag as Te,L as Fe,aF as Re,R as Oe,ay as je,ah as Ie,aZ as Me,a_ as Ue,W as Be}from"./ui-vendor-D9aA433m.js";import{r as C,c as P,m as Pe,k as Ve,e as We,w as Ae,Q as j,R as h,S as s,V as r,_ as U,Y as B,U as t,j as o,K as l,$ as N,a3 as ee,F as G,N as K}from"./vue-vendor-Bom1XEVO.js";import"./charts-vendor-PiKWrtPe.js";const{message:M}=Ne(["message"]),He=c=>{const d=R.sheet_to_json(c,{header:1,defval:"",blankrows:!1});if(d.length===0)return[];const E=d[0].map(y=>String(y).trim());return d.slice(1).filter(y=>y.some(k=>k!==""&&k!==null&&k!==void 0)).map((y,k)=>{const I={};return E.forEach((A,V)=>{I[A]=y[V]!==void 0?y[V]:""}),I.__rowIndex=k+2,I})},te=c=>c.map(d=>{const{__rowIndex:E,...m}=d;return m}),se=(c,d)=>{if(d.length===0)return;const E=Object.keys(d[0]).map(m=>{const y=Math.max(m.length,...d.map(k=>String(k[m]||"").length));return{wch:Math.min(Math.max(y,10),30)}});c["!cols"]=E};function Le(){const c=C(!1),d=C(null),E=C(null),m=C({}),y=P(()=>E.value?.SheetNames||[]),k=()=>{d.value=null};return{loading:c,error:d,workbook:E,sheets:y,data:m,readFile:async v=>{c.value=!0,k();try{const u=await v.arrayBuffer(),n=ke(u,{type:"buffer",cellDates:!0,cellNF:!0,cellText:!1});E.value=n;const w={};return n.SheetNames.forEach(x=>{const i=n.Sheets[x];w[x]=He(i)}),m.value=w,M.success(`成功读取 ${n.SheetNames.length} 个工作表`),w}catch(u){const n=u instanceof Error?u.message:"读取文件失败";throw d.value=n,M.error(n),u}finally{c.value=!1}},exportToExcel:async(v,u={})=>{const{fileName:n=`导出数据_${new Date().toISOString().split("T")[0]}.xlsx`,sheetName:w="Sheet1",autoFitColumns:x=!0}=u;try{c.value=!0;const i=R.book_new(),f=te(v),S=R.json_to_sheet(f);x&&se(S,f),R.book_append_sheet(i,S,w),q(i,n),M.success(`${n} 导出成功！`)}catch(i){const f=i instanceof Error?i.message:"导出失败";throw d.value=f,M.error(f),i}finally{c.value=!1}},exportMultipleSheets:async(v,u=`多表导出_${new Date().toISOString().split("T")[0]}.xlsx`)=>{try{c.value=!0;const n=R.book_new();Object.entries(v).forEach(([w,x])=>{const i=te(x),f=R.json_to_sheet(i);se(f,i),R.book_append_sheet(n,f,w)}),q(n,u),M.success(`${u} 导出成功！`)}catch(n){const w=n instanceof Error?n.message:"导出失败";throw d.value=w,M.error(w),n}finally{c.value=!1}},generateTemplate:async v=>{try{c.value=!0;const u=R.book_new(),n=R.aoa_to_sheet([v.headers]);n["!cols"]=v.headers.map(()=>({wch:15})),R.book_append_sheet(u,n,v.name),q(u,`${v.name}模板.xlsx`),M.success(`${v.name}模板下载成功！`)}catch(u){const n=u instanceof Error?u.message:"生成模板失败";throw d.value=n,M.error(n),u}finally{c.value=!1}},getPresetTemplates:()=>[{name:"员工信息",headers:["姓名","部门","职位","薪资","入职日期","联系电话","邮箱"],description:"员工基本信息登记表"},{name:"商品清单",headers:["商品名称","规格型号","单价","数量","总价","供应商","备注"],description:"商品库存管理表"},{name:"财务报表",headers:["日期","科目","借方金额","贷方金额","摘要","凭证号"],description:"财务记账凭证"}],clearData:()=>{E.value=null,m.value={},k()},clearError:k}}const qe=10,Ge=[{姓名:"张三",部门:"技术部",职位:"前端工程师",薪资:12e3,入职日期:"2023-01-15"},{姓名:"李四",部门:"产品部",职位:"产品经理",薪资:15e3,入职日期:"2022-05-20"},{姓名:"王五",部门:"设计部",职位:"UI设计师",薪资:1e4,入职日期:"2023-03-10"}],Ke=[{title:"时间",key:"time",width:160},{title:"操作",key:"operation",width:120},{title:"描述",key:"description",ellipsis:!0},{title:"状态",key:"status",width:80,render:c=>Pe(le,{type:c.status==="success"?"success":"error"},{default:()=>c.status==="success"?"成功":"失败"})}],Qe={class:"excel-demo"},Ye={class:"demo-content"},Ze={class:"upload-area"},Je={class:"upload-content"},Xe={key:0},et={class:"sheet-selector mb-3"},tt={class:"export-grid"},st={class:"export-card-content"},lt={class:"export-form"},at={class:"export-card-content"},nt={class:"export-form"},ot={key:0},rt={class:"checkbox-grid"},it={key:1},ut={class:"export-card-content"},dt={class:"export-form"},ct={class:"template-grid"},pt={class:"data-process-controls"},mt={key:0,class:"processed-data"},ft={key:1,class:"data-summary"},_t={class:"history-controls mb-3"},yt=Ve({__name:"index",setup(c){const{loading:d,error:E,sheets:m,data:y,readFile:k,exportToExcel:I,exportMultipleSheets:A,getPresetTemplates:V,generateTemplate:Q,clearData:Y,clearError:Z}=Le(),v=Ee(),u=C([]),n=C(""),w=C(!1),x=C([]),i=C([]),f=C(null),S=C([]),O=We({fileName:"",sheetName:""}),ae=P(()=>m.value.map(a=>({label:a,value:a}))),_=P(()=>!n.value||!y.value[n.value]?[]:y.value[n.value]),ne=P(()=>w.value?_.value:_.value.slice(0,qe)),oe=P(()=>{if(_.value.length===0)return[];const a=_.value[0];return Object.keys(a).filter(e=>e!=="__rowIndex").map(e=>({title:e,key:e,width:120,ellipsis:!0}))}),re=P(()=>{if(i.value.length===0)return[];const a=i.value[0];return Object.keys(a).filter(e=>e!=="__rowIndex").map(e=>({title:e,key:e,width:120,ellipsis:!0}))}),b=(a,e,D="success")=>{S.value.unshift({id:Date.now(),time:new Date().toLocaleString("zh-CN"),operation:a,description:e,status:D}),S.value.length>50&&(S.value=S.value.slice(0,50))},ie=async({file:a})=>{if(a.file)try{await k(a.file),u.value=[a],m.value.length>0&&(n.value=m.value[0],x.value=[m.value[0]]),O.fileName=a.name?.replace(/\.[^/.]+$/,"")||"导出数据",O.sheetName=n.value,i.value=[],f.value=null,b("文件导入",`成功导入文件：${a.name}`)}catch(e){b("文件导入",`导入失败：${e instanceof Error?e.message:"未知错误"}`,"error")}},ue=()=>{u.value=[],n.value="",x.value=[],i.value=[],f.value=null,Y(),b("清除数据","清除所有文件数据")},de=async()=>{if(!n.value||_.value.length===0){v.warning("请先选择包含数据的工作表");return}try{await I(_.value,{fileName:O.fileName||"导出数据.xlsx",sheetName:O.sheetName||n.value}),b("单表导出",`导出工作表：${n.value}`)}catch(a){b("单表导出",`导出失败：${a instanceof Error?a.message:"未知错误"}`,"error")}},ce=async()=>{if(x.value.length===0){v.warning("请选择要导出的工作表");return}try{const a={};x.value.forEach(e=>{y.value[e]&&(a[e]=y.value[e])}),await A(a),b("多表导出",`导出${x.value.length}个工作表`)}catch(a){b("多表导出",`导出失败：${a instanceof Error?a.message:"未知错误"}`,"error")}},pe=async()=>{try{await I(Ge,{fileName:"员工信息示例.xlsx",sheetName:"员工列表"}),b("示例导出","导出员工信息示例数据")}catch(a){b("示例导出",`导出失败：${a instanceof Error?a.message:"未知错误"}`,"error")}},me=async a=>{try{await Q(a),b("模板下载",`下载模板：${a.name}`)}catch(e){b("模板下载",`下载失败：${e instanceof Error?e.message:"未知错误"}`,"error")}},fe=()=>{if(_.value.length===0)return;const a=_.value.filter(e=>Object.values(e).some(D=>D!==""&&D!==null&&D!==void 0&&D!=="__rowIndex"));i.value=a,v.success(`筛选完成，共 ${a.length} 条有效数据`),b("数据筛选",`筛选出${a.length}条非空数据`)},_e=()=>{if(_.value.length===0)return;const a=_.value.length,e=_.value.filter(W=>Object.values(W).some($=>$!==""&&$!==null&&$!==void 0&&$!=="__rowIndex")).length,D=a-e,g=_.value.length>0?Object.keys(_.value[0]).filter(W=>W!=="__rowIndex").length:0;f.value={totalRows:a,validRows:e,emptyRows:D,totalFields:g},v.info(`统计完成：总计 ${a} 行，有效 ${e} 行`),b("数据统计",`统计${a}行数据，有效${e}行`)},ve=async()=>{if(i.value.length!==0)try{await I(i.value,{fileName:`处理结果_${new Date().toISOString().split("T")[0]}.xlsx`,sheetName:"处理结果"}),b("导出处理结果",`导出${i.value.length}条处理后数据`)}catch(a){b("导出处理结果",`导出失败：${a instanceof Error?a.message:"未知错误"}`,"error")}},ge=()=>{S.value=[],v.success("操作历史已清空")};return Ae(n,a=>{a&&(O.sheetName=a,i.value=[],f.value=null)}),(a,e)=>{const D=Se,g=De,W=Ce,$=le,z=ze,T=$e,xe=Te,H=Re,F=Fe,J=Oe,he=Ie,ye=je,we=Ue,be=Me,X=Be;return h(),j("div",Qe,[s(D,{class:"demo-title"},{default:t(()=>[...e[5]||(e[5]=[o(" Excel All - [useExcel] 场景示例 ",-1)])]),_:1}),e[41]||(e[41]=r("p",{class:"mb-20px text-gray-600"}," 专注于Excel文件的读取、导出和模板管理功能 ",-1)),r("div",Ye,[s(F,{title:"Excel 文件导入",class:"demo-card demo-section"},{"header-extra":t(()=>[...e[6]||(e[6]=[r("span",{class:"i-mdi-file-upload text-blue-500"},null,-1)])]),default:t(()=>[s(T,{vertical:""},{default:t(()=>[r("div",Ze,[s(W,{"file-list":l(u),"on-change":ie,"show-file-list":!1,accept:".xlsx,.xls",disabled:l(d),drag:"",class:"upload-dragger"},{default:t(()=>[r("div",Je,[e[9]||(e[9]=r("span",{class:"i-mdi-cloud-upload text-4xl text-gray-400 mb-2"},null,-1)),s(g,{class:"upload-text"},{default:t(()=>[...e[7]||(e[7]=[o("点击或拖拽Excel文件到此区域",-1)])]),_:1}),s(g,{depth:"3",class:"upload-hint"},{default:t(()=>[...e[8]||(e[8]=[o("支持 .xlsx, .xls 格式",-1)])]),_:1})])]),_:1},8,["file-list","disabled"]),l(u).length>0?(h(),U(T,{key:0,class:"mt-4"},{default:t(()=>[s($,{type:"success"},{icon:t(()=>[...e[10]||(e[10]=[r("span",{class:"i-mdi-file-check"},null,-1)])]),default:t(()=>[o(" "+N(l(u)[0].name),1)]),_:1}),s(z,{quaternary:"",type:"error",size:"small",onClick:ue},{icon:t(()=>[...e[11]||(e[11]=[r("span",{class:"i-mdi-close"},null,-1)])]),default:t(()=>[e[12]||(e[12]=o(" 清除 ",-1))]),_:1})]),_:1})):B("",!0)]),l(m).length>0?(h(),j("div",Xe,[r("div",et,[s(g,{class:"font-semibold mr-2"},{default:t(()=>[...e[13]||(e[13]=[o("选择工作表：",-1)])]),_:1}),s(xe,{value:l(n),"onUpdate:value":e[0]||(e[0]=p=>ee(n)?n.value=p:null),options:l(ae),class:"w-48",placeholder:"请选择工作表"},null,8,["value","options"]),s(g,{depth:"3",class:"ml-4"},{default:t(()=>[o(" 共 "+N(l(m).length)+" 个工作表 ",1)]),_:1})]),l(_).length>0?(h(),U(F,{key:0,title:"数据预览",size:"small",class:"mb-4"},{"header-extra":t(()=>[s(T,null,{default:t(()=>[s(g,{depth:"3"},{default:t(()=>[o("总计 "+N(l(_).length)+" 行",1)]),_:1}),s(z,{text:"",type:"primary",onClick:e[1]||(e[1]=p=>w.value=!l(w))},{default:t(()=>[o(N(l(w)?"收起":"查看全部"),1)]),_:1})]),_:1})]),default:t(()=>[s(H,{columns:l(oe),data:l(ne),loading:l(d),size:"small",striped:"","scroll-x":1200,class:"preview-table"},null,8,["columns","data","loading"])]),_:1})):B("",!0)])):B("",!0)]),_:1})]),_:1}),s(F,{title:"导出功能",class:"demo-card demo-section"},{"header-extra":t(()=>[...e[14]||(e[14]=[r("span",{class:"i-mdi-download text-purple-500"},null,-1)])]),default:t(()=>[r("div",tt,[s(F,{title:"单表导出",size:"small",class:"export-card"},{default:t(()=>[r("div",st,[r("div",lt,[s(T,{vertical:""},{default:t(()=>[s(J,{value:l(O).fileName,"onUpdate:value":e[2]||(e[2]=p=>l(O).fileName=p),placeholder:"文件名",clearable:""},null,8,["value"]),s(J,{value:l(O).sheetName,"onUpdate:value":e[3]||(e[3]=p=>l(O).sheetName=p),placeholder:"工作表名",clearable:""},null,8,["value"])]),_:1})]),s(z,{type:"primary",loading:l(d),disabled:!l(n)||l(_).length===0,onClick:de,block:"",class:"export-button"},{icon:t(()=>[...e[15]||(e[15]=[r("span",{class:"i-mdi-file-export"},null,-1)])]),default:t(()=>[e[16]||(e[16]=o(" 导出当前工作表 ",-1))]),_:1},8,["loading","disabled"])])]),_:1}),s(F,{title:"多表导出",size:"small",class:"export-card"},{default:t(()=>[r("div",at,[r("div",nt,[l(m).length>1?(h(),j("div",ot,[s(g,{class:"text-sm mb-2"},{default:t(()=>[...e[17]||(e[17]=[o("选择要导出的工作表：",-1)])]),_:1}),s(ye,{value:l(x),"onUpdate:value":e[4]||(e[4]=p=>ee(x)?x.value=p:null)},{default:t(()=>[r("div",rt,[(h(!0),j(G,null,K(l(m),p=>(h(),U(he,{key:p,value:p,label:p},null,8,["value","label"]))),128))])]),_:1},8,["value"])])):(h(),j("div",it,[s(g,{depth:"3",class:"text-center"},{default:t(()=>[...e[18]||(e[18]=[o(" 需要多个工作表才能使用此功能 ",-1)])]),_:1})]))]),s(z,{type:"info",loading:l(d),disabled:l(x).length===0,onClick:ce,block:"",class:"export-button"},{icon:t(()=>[...e[19]||(e[19]=[r("span",{class:"i-mdi-file-multiple-outline"},null,-1)])]),default:t(()=>[e[20]||(e[20]=o(" 导出多个工作表 ",-1))]),_:1},8,["loading","disabled"])])]),_:1}),s(F,{title:"示例数据",size:"small",class:"export-card"},{default:t(()=>[r("div",ut,[r("div",dt,[s(g,{depth:"3"},{default:t(()=>[...e[21]||(e[21]=[o("导出预置的示例数据",-1)])]),_:1}),s(g,{depth:"3",class:"text-xs mt-2"},{default:t(()=>[...e[22]||(e[22]=[o(" 包含员工信息示例数据，用于测试导出功能 ",-1)])]),_:1})]),s(z,{type:"success",onClick:pe,block:"",class:"export-button"},{icon:t(()=>[...e[23]||(e[23]=[r("span",{class:"i-mdi-database-export"},null,-1)])]),default:t(()=>[e[24]||(e[24]=o(" 导出示例数据 ",-1))]),_:1})])]),_:1})])]),_:1}),s(F,{title:"模板管理",class:"demo-card demo-section"},{"header-extra":t(()=>[...e[25]||(e[25]=[r("span",{class:"i-mdi-file-document-multiple text-orange-500"},null,-1)])]),default:t(()=>[r("div",ct,[(h(!0),j(G,null,K(l(V)(),p=>(h(),U(F,{key:p.name,title:p.name,size:"small",class:"template-card",hoverable:""},{default:t(()=>[s(T,{vertical:"",size:"small"},{default:t(()=>[s(g,{depth:"3"},{default:t(()=>[o(N(p.description||"暂无描述"),1)]),_:2},1024),s(g,{depth:"3"},{default:t(()=>[o("字段数量："+N(p.headers.length),1)]),_:2},1024),s(be,null,{default:t(()=>[s(we,{title:"查看字段",name:"fields"},{default:t(()=>[s(T,{size:"small"},{default:t(()=>[(h(!0),j(G,null,K(p.headers,L=>(h(),U($,{key:L,size:"small"},{default:t(()=>[o(N(L),1)]),_:2},1024))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024),s(z,{type:"primary",size:"small",onClick:L=>me(p),loading:l(d),block:""},{icon:t(()=>[...e[26]||(e[26]=[r("span",{class:"i-mdi-download"},null,-1)])]),default:t(()=>[e[27]||(e[27]=o(" 下载模板 ",-1))]),_:1},8,["onClick","loading"])]),_:2},1024)]),_:2},1032,["title"]))),128))])]),_:1}),s(F,{title:"数据处理演示",class:"demo-card demo-section"},{"header-extra":t(()=>[...e[28]||(e[28]=[r("span",{class:"i-mdi-cog text-indigo-500"},null,-1)])]),default:t(()=>[s(T,{vertical:""},{default:t(()=>[s(X,{type:"info",class:"mb-4"},{icon:t(()=>[...e[29]||(e[29]=[r("span",{class:"i-mdi-information"},null,-1)])]),default:t(()=>[e[30]||(e[30]=o(" 这里演示如何在业务层处理导入的数据，比如筛选、验证等操作 ",-1))]),_:1}),r("div",pt,[s(T,null,{default:t(()=>[s(z,{disabled:!l(n)||l(_).length===0,onClick:fe},{icon:t(()=>[...e[31]||(e[31]=[r("span",{class:"i-mdi-filter"},null,-1)])]),default:t(()=>[e[32]||(e[32]=o(" 筛选非空行 ",-1))]),_:1},8,["disabled"]),s(z,{disabled:!l(n)||l(_).length===0,onClick:_e},{icon:t(()=>[...e[33]||(e[33]=[r("span",{class:"i-mdi-chart-bar"},null,-1)])]),default:t(()=>[e[34]||(e[34]=o(" 数据统计 ",-1))]),_:1},8,["disabled"]),l(i).length>0?(h(),U(z,{key:0,type:"success",onClick:ve},{default:t(()=>[...e[35]||(e[35]=[o(" 导出处理结果 ",-1)])]),_:1})):B("",!0)]),_:1})]),l(i).length>0?(h(),j("div",mt,[s(g,{class:"font-semibold mb-2"},{default:t(()=>[...e[36]||(e[36]=[o("处理结果预览：",-1)])]),_:1}),s(H,{columns:l(re),data:l(i).slice(0,5),size:"small",striped:""},null,8,["columns","data"]),s(g,{depth:"3",class:"mt-2"},{default:t(()=>[o(" 处理后数据共 "+N(l(i).length)+" 条 ",1)]),_:1})])):B("",!0),l(f)?(h(),j("div",ft,[s(g,{class:"font-semibold mb-2"},{default:t(()=>[...e[37]||(e[37]=[o("数据统计：",-1)])]),_:1}),s(T,null,{default:t(()=>[s($,{type:"info"},{default:t(()=>[o("总行数: "+N(l(f).totalRows),1)]),_:1}),s($,{type:"success"},{default:t(()=>[o("非空行: "+N(l(f).validRows),1)]),_:1}),s($,{type:"warning"},{default:t(()=>[o("空行: "+N(l(f).emptyRows),1)]),_:1}),s($,{type:"primary"},{default:t(()=>[o("字段数: "+N(l(f).totalFields),1)]),_:1})]),_:1})])):B("",!0)]),_:1})]),_:1}),s(F,{title:"操作历史",class:"demo-card demo-section"},{"header-extra":t(()=>[...e[38]||(e[38]=[r("span",{class:"i-mdi:clock-time-four-outline text-gray-500"},null,-1)])]),default:t(()=>[r("div",_t,[s(T,null,{default:t(()=>[s(z,{quaternary:"",type:"warning",size:"small",onClick:ge,disabled:l(S).length===0},{icon:t(()=>[...e[39]||(e[39]=[r("span",{class:"i-mdi-delete-sweep"},null,-1)])]),default:t(()=>[e[40]||(e[40]=o(" 清空历史 ",-1))]),_:1},8,["disabled"]),s(g,{depth:"3"},{default:t(()=>[o("共 "+N(l(S).length)+" 条操作记录",1)]),_:1})]),_:1})]),s(H,{columns:l(Ke),data:l(S),pagination:{pageSize:8},size:"small"},null,8,["columns","data"])]),_:1})]),l(E)?(h(),U(X,{key:0,type:"error",title:l(E),closable:"",onClose:l(Z),class:"mt-4"},null,8,["title","onClose"])):B("",!0)])}}});export{yt as default};
