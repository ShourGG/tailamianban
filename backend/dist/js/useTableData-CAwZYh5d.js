import{aA as q}from"./ui-vendor-lRdd6BJd.js";import{r as f,x,e as R,c as p}from"./vue-vendor-Bom1XEVO.js";const T=l=>Object.fromEntries(Object.entries(l).filter(([m,r])=>!(r==null||r===""||Array.isArray(r)&&r.length===0||typeof r=="object"&&!Array.isArray(r)&&Object.keys(r).length===0)));function M(l,m={}){const{immediate:r=!0,defaultParams:y={},transform:d,onSuccess:P,onError:S}=m;let c=null;try{c=q?.()}catch{}const i=f(!1),s=x([]),u=f(0),e=R({page:1,pageSize:10}),o=f({}),h=(a={})=>{const t={page:e.page,pageSize:e.pageSize,...y,...o.value,...a};return T(t)},b=a=>{const t=a.data.list||[];s.value=d?d(t):t,u.value=a.data.total||0,a.data.page&&(e.page=a.data.page),a.data.pageSize&&(e.pageSize=a.data.pageSize),c&&c.success(`已加载 ${s.value.length} 条记录`),P?.(s.value)},v=a=>{s.value=[],u.value=0,c&&c.error("加载数据失败，请重试"),S?.(a)},n=async(a={})=>{try{i.value=!0;const t=h(a),g=await l(t);if(g.code==="0")b(g);else throw new Error(g.message||"数据加载失败")}catch(t){v(t)}finally{i.value=!1}},z=a=>(o.value={...a},e.page=1,n()),w=()=>n(),A=()=>(o.value={},e.page=1,n()),D=(a,t)=>(e.page=a,t&&t!==e.pageSize&&(e.pageSize=t,e.page=1),n()),E=()=>(e.page=1,n()),j=p(()=>s.value.length===0),O=p(()=>s.value.length>0),k=p(()=>h());return r&&n(),{loading:i,tableData:s,total:u,pagination:e,searchParams:o,loadData:n,search:z,refresh:w,resetSearch:A,handlePageChange:D,resetToFirstPage:E,isEmpty:j,hasData:O,currentParams:k}}export{M as u};
