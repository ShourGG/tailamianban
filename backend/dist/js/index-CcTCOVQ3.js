import Ue from"./index-C1VqZ0OG.js";import De from"./index-DEX6AgwE.js";import ze from"./index-DP8QyUpt.js";import{m as f,k as Re,r as b,e as W,c as _,Q as V,R as v,S as a,Y as I,U as s,aD as Fe,K as l,j as d,F as Le,N as Me,_ as U,I as Oe,V as L,$ as k,a3 as j,aH as Ee}from"./vue-vendor-Bom1XEVO.js";import{u as qe}from"./useTableData-CAwZYh5d.js";import{S as Y,aA as Be,U as Ve,R as je,ag as Ge,P as Ye,L as Ke,X as Ze,Y as He,as as Qe,ai as Xe,ae as Je,V as We,I as et,ao as tt}from"./ui-vendor-lRdd6BJd.js";import{e as te,f as lt,p as at}from"./index-CkMMG6vV.js";import{_ as st}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./charts-vendor-CvHUaZlk.js";import"./TableEditModal-DOxcbbuo.js";import"./index.vue_vue_type_script_setup_true_lang-BnkEbK8L.js";import"./index-C3XsA_P_.js";import"./editor-vendor-D83MfH0r.js";import"./spline-vendor-Cs6wJgUK.js";import"./data-rvGkdoyf.js";import"./iconify-W0kOH8CK.js";import"./index-Chx56wke.js";const c={module:{text:"模块权限",type:"info",icon:"material-symbols:dashboard",color:"#1890ff",description:"系统功能模块访问权限"},function:{text:"功能权限",type:"success",icon:"material-symbols:settings",color:"#52c41a",description:"具体功能操作权限"},button:{text:"按钮权限",type:"warning",icon:"material-symbols:touch-app",color:"#fa8c16",description:"页面按钮操作权限"},api:{text:"API权限",type:"error",icon:"material-symbols:api",color:"#f5222d",description:"接口访问权限"}},ot={1:{text:"启用",type:"success"},0:{text:"禁用",type:"error"}},D={permissionType:[{label:"模块权限",value:"module"},{label:"功能权限",value:"function"},{label:"按钮权限",value:"button"},{label:"API权限",value:"api"}],permissionStatus:[{label:"启用",value:1},{label:"禁用",value:0}]},C=[{label:"系统管理",value:"system"},{label:"用户管理",value:"user"},{label:"角色管理",value:"role"},{label:"权限管理",value:"permission"},{label:"菜单管理",value:"menu"},{label:"字典管理",value:"dict"},{label:"配置管理",value:"config"},{label:"日志管理",value:"log"},{label:"监控管理",value:"monitor"},{label:"文件管理",value:"file"}],nt=()=>[{key:"name",title:"权限名称",width:120,fixed:"left",editable:!0,required:!0,editType:"input",editProps:{placeholder:"请输入权限名称",rules:[{required:!0,message:"请输入权限名称"},{min:2,max:50,message:"权限名称长度在 2 到 50 个字符"}]}},{key:"code",title:"权限编码",width:220,editable:!1,render:i=>f("code",{class:"permission-code"},i.code)},{key:"type",title:"权限类型",width:120,editable:!0,required:!0,editType:"select",editProps:{options:D.permissionType},render:i=>{const u=c[i.type];return u?f(Y,{type:u.type,size:"small",class:"permission-type-tag"},{default:()=>u.text,icon:()=>f("i",{class:`iconify ${u.icon} type-icon`})}):f("span",{class:"permission-type-unknown"},i.type)}},{key:"module",title:"所属模块",width:120,editable:!0,required:!0,editType:"select",editProps:{options:C},render:i=>{const u=C.find(S=>S.value===i.module)?.label||i.module;return f("span",{class:"module-tag"},u)}},{key:"description",title:"描述",width:200,editable:!0,editType:"textarea",editProps:{rows:2,placeholder:"请输入权限描述"},render:i=>i.description||"-"},{key:"resources",title:"关联资源",width:160,render:i=>!i.resources||i.resources.length===0?"-":f("div",{class:"resource-list"},i.resources.map(u=>f("div",{class:"resource-item"},u)))},{key:"sort",title:"排序",width:80,editable:!0,editType:"number",editProps:{min:0,max:9999,placeholder:"排序"}},{key:"status",title:"状态",width:80,render:i=>{const u=ot[i.status];return f(Y,{type:u.type,size:"small",class:`permission-status status-${i.status===1?"active":"inactive"}`},{default:()=>u.text})}},{key:"createTime",title:"创建时间",width:160,render:i=>typeof i.createTime=="number"?new Date(i.createTime).toLocaleString():String(i.createTime)}],rt={name:[{required:!0,message:"请输入权限名称",trigger:["input","blur"]},{min:2,max:50,message:"权限名称长度在 2 到 50 个字符",trigger:["input","blur"]}],code:[{required:!0,message:"请输入权限编码",trigger:["input","blur"]},{pattern:/^[a-zA-Z][a-zA-Z0-9_:]*$/,message:"权限编码格式不正确，必须以字母开头，只能包含字母、数字、下划线和冒号",trigger:["input","blur"]}],type:[{required:!0,message:"请选择权限类型",trigger:["change","blur"]}],module:[{required:!0,message:"请选择所属模块",trigger:["change","blur"]}],sort:[{type:"number",required:!0,message:"请输入排序值",trigger:["input","blur"]},{type:"number",min:0,max:9999,message:"排序值必须在 0-9999 之间",trigger:["input","blur"]}]},G={name:"",code:"",type:"button",module:"system",description:"",resources:"",status:1,sort:0,remark:""},it=i=>te("/sys/permissionsList",{params:{page:i?.page!=null?String(i.page):void 0,pageSize:i?.pageSize!=null?String(i.pageSize):void 0}}),ee=i=>te(`/sys/permissions/${i}`),M=(i,u)=>at(`/sys/permissions/${i}`,u),ut=i=>lt(`/sys/permissions/${i}`),dt={class:"permission-management"},pt={class:"stat-icon-wrapper"},ct={class:"stat-content"},mt={class:"stat-label"},yt={class:"stat-value"},ft={key:0,class:"filter-tags"},bt=Re({__name:"index",setup(i){const u=Be(),S=b(!1),w=b(!1),T=b(!1),O=b(!1),x=b("add"),K=b(null),le=b(),E=b(null),n=W({...G}),ae=rt,r=W({keyword:"",status:null,type:null,module:null}),se=async t=>{const e=await it(t);return{...e,data:{...e.data,list:e.data.list.map(m=>({...m,type:m.type}))}}},{tableData:q,loading:oe,refresh:g}=qe(se,{immediate:!0,defaultParams:{page:1,pageSize:10},onError:t=>{u.error("获取权限列表失败")}}),ne=_(()=>x.value==="add"?"新增权限":"编辑权限"),Z=_(()=>!!(r.keyword||r.type||r.module||r.status!==null)),z=_(()=>{let t=[...q.value];if(r.keyword){const e=r.keyword.toLowerCase();t=t.filter(p=>(p.name||"").toLowerCase().includes(e)||(p.code||"").toLowerCase().includes(e)||(p.description||"").toLowerCase().includes(e))}return r.type&&(t=t.filter(e=>e.type===r.type)),r.module&&(t=t.filter(e=>e.module===r.module)),r.status!==null&&(t=t.filter(e=>e.status===r.status)),t}),re=_(()=>Z.value?`筛选出 ${z.value.length} 个权限`:`共 ${q.value.length} 个权限`),ie=_(()=>nt()),ue=_(()=>{const t={module:0,function:0,button:0,api:0};return q.value.forEach(e=>{e.status===1&&t[e.type]++}),[{type:"module",label:"模块权限",value:t.module,icon:c.module.icon,color:c.module.color},{type:"function",label:"功能权限",value:t.function,icon:c.function.icon,color:c.function.color},{type:"button",label:"按钮权限",value:t.button,icon:c.button.icon,color:c.button.color},{type:"api",label:"API权限",value:t.api,icon:c.api.icon,color:c.api.color}]}),de={sections:[{title:"基本信息",columns:2,items:[{label:"权限名称",key:"name",type:"text"},{label:"权限编码",key:"code",type:"tag",tagType:"info"},{label:"权限类型",key:"type",type:"tag",tagType:"success",formatter:t=>c[t]?.text||t},{label:"所属模块",key:"module",type:"text",formatter:t=>C.find(e=>e.value===t)?.label||t},{label:"状态",key:"status",type:"tag",tagType:"success",formatter:t=>t===1?"启用":"禁用"},{label:"创建时间",key:"createTime",type:"text"}]},{title:"扩展信息",columns:1,items:[{label:"关联资源",key:"resources",type:"text",span:2,formatter:t=>Array.isArray(t)?t.join(", "):"无"},{label:"描述",key:"description",type:"text",span:2},{label:"备注",key:"remark",type:"text",span:2}]}]},pe=async()=>{S.value=!0;try{u.info("导出功能开发中...")}finally{S.value=!1}},ce=t=>{const e={...t};e.name=`${t.name} - 副本`,e.code=`${t.code}_copy`,H(e)},me=async t=>{try{const e=t.status===1?0:1;await M(t.id,{status:e}),await g(),u.success((e===1?"启用":"禁用")+"成功")}catch{u.error("操作失败")}},ye=_(()=>({edit:async t=>(await M(t.id,t),await g(),!0),delete:async t=>(await ut(t.id),await g(),!0),detail:async t=>{const{data:e}=await ee(t.id);return e},custom:[{key:"copy",label:"复制",icon:"material-symbols:content-copy",type:"info",onClick:t=>ce(t)},{key:"toggle",label:t=>t.status===1?"禁用":"启用",icon:t=>t.status===1?"material-symbols:pause":"material-symbols:play-arrow",type:t=>t.status===1?"warning":"success",onClick:t=>me(t)}]})),fe=t=>C.find(e=>e.value===t)?.label||t,be=t=>D.permissionType.find(e=>e.value===t)?.label||t,ve=t=>{r.type=r.type===t?null:t},R=t=>{r[t]=t==="status"||t==="type"||t==="module"?null:""},ge=()=>{Object.assign(r,{keyword:"",status:null,type:null,module:null})},F=()=>{},_e=async t=>{try{const e=t;await M(e.id,e),u.success("修改成功"),setTimeout(async()=>{await g()},500)}catch(e){throw u.error("保存失败"),e}},ke=async()=>{await g()},we=async t=>{try{O.value=!0;const{data:e}=await ee(t.id);E.value=e,T.value=!0}catch{u.error("获取详情失败")}finally{O.value=!1}},xe=()=>{E.value=null,T.value=!1},H=t=>{x.value=t?"edit":"add",t?Object.assign(n,{id:t.id,name:t.name,code:t.code,type:t.type,module:t.module,description:t.description||"",resources:Array.isArray(t.resources)?t.resources.join(", "):"",sort:t.sort,status:t.status,remark:t.remark||""}):Object.assign(n,G),w.value=!0},Ce=()=>{w.value=!1,Object.assign(n,G)},Se=t=>{n.module&&t&&Q()},Q=()=>{if(!n.module||!n.type)return;const t={module:n.module,function:`${n.module}:manage`,button:`${n.module}:add`,api:`${n.module}:create`};n.code=t[n.type]||""},Te=async()=>{try{if(await K.value?.validate(),x.value==="add")return u.info("请在后端提供创建接口或在 src/api/permission-manage.ts 增加 createPermissionApi"),!1;if(n.id!=null){const t={...n,resources:n.resources?n.resources.split(",").map(e=>e.trim()).filter(Boolean):[]};await M(n.id,t),await g(),u.success("修改成功")}return w.value=!1,!0}catch{return!1}};return(t,e)=>{const p=ze,m=je,h=Ge,N=Ve,P=Ye,B=Ke,$=Ze,X=He,J=Qe,A=Y,he=De,Ne=Ue,y=Je,Pe=We,$e=et,Ae=Xe,Ie=tt;return v(),V("div",dt,[a(B,{class:"header-card"},{default:s(()=>[a(N,{justify:"space-between",align:"center"},{default:s(()=>[a(N,{class:"search-filters"},{default:s(()=>[a(m,{value:l(r).keyword,"onUpdate:value":e[0]||(e[0]=o=>l(r).keyword=o),placeholder:"搜索权限名称、编码、描述",clearable:"",style:{width:"300px"},onKeyup:Fe(F,["enter"])},{prefix:s(()=>[a(p,{name:"material-symbols:search",size:16})]),_:1},8,["value"]),a(h,{value:l(r).type,"onUpdate:value":[e[1]||(e[1]=o=>l(r).type=o),F],placeholder:"权限类型",clearable:"",style:{width:"120px"},options:l(D).permissionType},null,8,["value","options"]),a(h,{value:l(r).module,"onUpdate:value":[e[2]||(e[2]=o=>l(r).module=o),F],placeholder:"所属模块",clearable:"",style:{width:"120px"},options:l(C)},null,8,["value","options"]),a(h,{value:l(r).status,"onUpdate:value":[e[3]||(e[3]=o=>l(r).status=o),F],placeholder:"权限状态",clearable:"",style:{width:"120px"},options:l(D).permissionStatus},null,8,["value","options"])]),_:1}),a(N,null,{default:s(()=>[a(P,{type:"primary",onClick:e[4]||(e[4]=o=>H())},{icon:s(()=>[a(p,{name:"material-symbols:add",size:16})]),default:s(()=>[e[21]||(e[21]=d(" 新增权限 ",-1))]),_:1}),a(P,{onClick:pe,loading:l(S)},{icon:s(()=>[a(p,{name:"material-symbols:download",size:16})]),default:s(()=>[e[22]||(e[22]=d(" 导出 ",-1))]),_:1},8,["loading"]),a(P,{onClick:l(g)},{icon:s(()=>[a(p,{name:"material-symbols:refresh",size:16})]),default:s(()=>[e[23]||(e[23]=d(" 刷新 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),a(X,{cols:4,"x-gap":16,class:"stat-grid"},{default:s(()=>[(v(!0),V(Le,null,Me(l(ue),o=>(v(),U($,{key:o.type},{default:s(()=>[a(B,{size:"small",hoverable:"",class:Oe([{"stat-card-active":l(r).type===o.type},"stat-card-clickable"]),onClick:vt=>ve(o.type)},{default:s(()=>[a(N,{align:"center"},{default:s(()=>[L("div",pt,[a(p,{name:o.icon,size:24,color:o.color},null,8,["name","color"])]),L("div",ct,[L("div",mt,k(o.label),1),L("div",yt,k(o.value),1)])]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1}),l(Z)?(v(),V("div",ft,[a(N,null,{default:s(()=>[a(J,{depth:"3",style:{"margin-right":"8px"}},{default:s(()=>[...e[24]||(e[24]=[d(" 当前筛选： ",-1)])]),_:1}),l(r).keyword?(v(),U(A,{key:0,closable:"",onClose:e[5]||(e[5]=o=>R("keyword")),type:"info"},{default:s(()=>[d(" 关键词: "+k(l(r).keyword),1)]),_:1})):I("",!0),l(r).type?(v(),U(A,{key:1,closable:"",onClose:e[6]||(e[6]=o=>R("type")),type:"success"},{default:s(()=>[d(" 类型: "+k(be(l(r).type)),1)]),_:1})):I("",!0),l(r).module?(v(),U(A,{key:2,closable:"",onClose:e[7]||(e[7]=o=>R("module")),type:"warning"},{default:s(()=>[d(" 模块: "+k(fe(l(r).module)),1)]),_:1})):I("",!0),l(r).status!==null?(v(),U(A,{key:3,closable:"",onClose:e[8]||(e[8]=o=>R("status")),type:l(r).status===1?"success":"error"},{default:s(()=>[d(" 状态: "+k(l(r).status===1?"启用":"禁用"),1)]),_:1},8,["type"])):I("",!0),a(P,{text:"",size:"small",onClick:ge,type:"error"},{default:s(()=>[...e[25]||(e[25]=[d(" 清空筛选 ",-1)])]),_:1})]),_:1})])):I("",!0),a(B,{class:"content-card"},{header:s(()=>[a(J,null,{default:s(()=>[e[26]||(e[26]=d(" 权限资源库 ",-1)),a(A,{type:"info",size:"small",style:{"margin-left":"8px"}},{default:s(()=>[d(k(l(re)),1)]),_:1})]),_:1})]),default:s(()=>[a(he,{ref_key:"tableRef",ref:le,data:l(z),"onUpdate:data":e[9]||(e[9]=o=>j(z)?z.value=o:null),columns:l(ie),loading:l(oe),actions:l(ye),"edit-mode":"modal","modal-title":"编辑权限","modal-width":800,size:"small",striped:"",bordered:"",onSave:_e,onRowDelete:ke,onViewDetail:we},null,8,["data","columns","loading","actions","onViewDetail"])]),_:1}),a(Ne,{visible:l(T),"onUpdate:visible":e[10]||(e[10]=o=>j(T)?T.value=o:null),data:l(E)||{},config:de,title:"权限详情",loading:l(O),onClose:xe},null,8,["visible","data","loading"]),a(Ie,{show:l(w),"onUpdate:show":e[20]||(e[20]=o=>j(w)?w.value=o:null),preset:"dialog",title:l(ne),"positive-text":l(x)==="add"?"确认添加":"确认修改","negative-text":"取消",onPositiveClick:Te,onNegativeClick:Ce,style:{width:"700px"}},{default:s(()=>[a(Ae,{ref_key:"formRef",ref:K,model:l(n),rules:l(ae),"label-placement":"left","label-width":"100px"},{default:s(()=>[a(X,{cols:2,"x-gap":16},{default:s(()=>[a($,null,{default:s(()=>[a(y,{label:"权限名称",path:"name"},{default:s(()=>[a(m,{value:l(n).name,"onUpdate:value":e[11]||(e[11]=o=>l(n).name=o),placeholder:"请输入权限名称"},null,8,["value"])]),_:1})]),_:1}),a($,null,{default:s(()=>[a(y,{label:"权限类型",path:"type"},{default:s(()=>[a(h,{value:l(n).type,"onUpdate:value":[e[12]||(e[12]=o=>l(n).type=o),Se],options:l(D).permissionType},null,8,["value","options"])]),_:1})]),_:1}),a($,null,{default:s(()=>[a(y,{label:"所属模块",path:"module"},{default:s(()=>[a(h,{value:l(n).module,"onUpdate:value":e[13]||(e[13]=o=>l(n).module=o),options:l(C)},null,8,["value","options"])]),_:1})]),_:1}),a($,null,{default:s(()=>[a(y,{label:"排序",path:"sort"},{default:s(()=>[a(Pe,{value:l(n).sort,"onUpdate:value":e[14]||(e[14]=o=>l(n).sort=o),min:0,max:9999,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(y,{label:"权限编码",path:"code"},{default:s(()=>[a(m,{value:l(n).code,"onUpdate:value":e[15]||(e[15]=o=>l(n).code=o),placeholder:"自动生成或手动输入",disabled:l(x)==="edit"},Ee({_:2},[l(x)==="add"?{name:"suffix",fn:s(()=>[a(P,{text:"",size:"small",onClick:Q},{default:s(()=>[a(p,{name:"material-symbols:auto-fix",size:14})]),_:1})]),key:"0"}:void 0]),1032,["value","disabled"])]),_:1}),a(y,{label:"关联资源",path:"resources"},{default:s(()=>[a(m,{value:l(n).resources,"onUpdate:value":e[16]||(e[16]=o=>l(n).resources=o),type:"textarea",rows:2,placeholder:"请输入关联资源，多个用逗号分隔"},null,8,["value"])]),_:1}),a(y,{label:"权限描述",path:"description"},{default:s(()=>[a(m,{value:l(n).description,"onUpdate:value":e[17]||(e[17]=o=>l(n).description=o),type:"textarea",rows:3,placeholder:"请输入权限描述"},null,8,["value"])]),_:1}),a(y,{label:"权限状态",path:"status"},{default:s(()=>[a($e,{value:l(n).status,"onUpdate:value":e[18]||(e[18]=o=>l(n).status=o),"checked-value":1,"unchecked-value":0},{checked:s(()=>[...e[27]||(e[27]=[d("启用",-1)])]),unchecked:s(()=>[...e[28]||(e[28]=[d("禁用",-1)])]),_:1},8,["value"])]),_:1}),a(y,{label:"备注",path:"remark"},{default:s(()=>[a(m,{value:l(n).remark,"onUpdate:value":e[19]||(e[19]=o=>l(n).remark=o),type:"textarea",rows:2,placeholder:"请输入备注信息"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["show","title","positive-text"])])}}}),Rt=st(bt,[["__scopeId","data-v-578f9733"]]);export{Rt as default};
