import{I as K}from"./iconify-W0kOH8CK.js";import{aA as Q,S as N,P as T,M as C,L as f,aF as Y}from"./ui-vendor-lRdd6BJd.js";import{k as H,r as _,e as I,c as z,o as X,n as Z,E as ee,Q as M,R as k,V as s,S as i,_ as te,Y as se,j as D,U as m,$ as d,K as n,F as ae,N as ie,I as oe,m as re}from"./vue-vendor-Bom1XEVO.js";import{u as ne,i as ce,m as le,f as de,b as me,k as ue,d as pe,l as ye,e as fe,h as ve}from"./charts-vendor-CvHUaZlk.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ge={class:"ultrathink-monitor"},_e={class:"page-header"},ke={class:"page-title"},xe={class:"header-actions"},we={class:"overview-cards"},Se={class:"metric-card"},be={class:"metric-header"},Ue={class:"metric-value"},Ce={class:"metric-card"},Me={class:"metric-header"},De={class:"metric-value"},$e={class:"metric-detail"},Le={class:"metric-card"},Ne={class:"metric-header"},Te={class:"metric-value"},Ie={class:"metric-detail"},ze={class:"metric-card"},Be={class:"metric-header"},We={class:"metric-value"},Fe={class:"metric-detail"},Oe={class:"charts-section"},Pe={class:"alerts-list"},Ae={class:"alert-content"},Ee={class:"alert-message"},Ve={class:"alert-time"},Ge="ws://localhost:8080/ws/monitoring",Re=H({name:"UltraThinkMonitor",__name:"index",setup(je){ne([le,de,me,ue,pe,ye,fe,ve]);const p=Q();let c=null;const u=_(!1),B=_(!1),x=_();let y=null;const r=I({timestamp:new Date,cpuUsage:0,memoryUsage:0,memoryTotal:0,memoryUsed:0,diskUsage:0,diskTotal:0,diskUsed:0,networkIn:0,networkOut:0,loadAverage:0,uptime:0,processCount:0}),v=_([]),h=_([]),o=I({timeLabels:[],cpuData:[],memoryData:[],diskData:[]}),w=z(()=>{if(!c)return{type:"error",icon:"mdi:wifi-off",text:"未连接"};switch(c.readyState){case WebSocket.CONNECTING:return{type:"warning",icon:"mdi:wifi-sync",text:"连接中..."};case WebSocket.OPEN:return{type:"success",icon:"mdi:wifi",text:"已连接"};case WebSocket.CLOSING:return{type:"warning",icon:"mdi:wifi-off",text:"断开中..."};case WebSocket.CLOSED:return{type:"error",icon:"mdi:wifi-off",text:"连接断开"};default:return{type:"error",icon:"mdi:wifi-off",text:"未知状态"}}}),W=z(()=>v.value.reduce((e,t)=>e+(t.playerCount||0),0)),F=[{title:"服务器名称",key:"serverName",render:e=>e.serverName},{title:"状态",key:"status",render:e=>{const a={running:{type:"success",text:"运行中"},stopped:{type:"error",text:"已停止"},starting:{type:"warning",text:"启动中"},stopping:{type:"warning",text:"停止中"}}[e.status]||{type:"default",text:"未知"};return re(N,{type:a.type,size:"small"},()=>a.text)}},{title:"端口",key:"port"},{title:"在线玩家",key:"playerCount",render:e=>`${e.playerCount}/${e.maxPlayers}`},{title:"CPU",key:"cpu",render:e=>e.processMetrics?`${e.processMetrics.cpuUsage.toFixed(1)}%`:"N/A"},{title:"内存",key:"memory",render:e=>e.processMetrics?g(e.processMetrics.memoryUsage):"N/A"},{title:"运行时间",key:"uptime",render:e=>j(e.uptime)}],S=()=>{if(!(c&&c.readyState===WebSocket.OPEN))try{c=new WebSocket(Ge),c.onopen=()=>{u.value=!0,c?.send(JSON.stringify({type:"request",requestType:"system_metrics"}))},c.onmessage=e=>{try{const t=JSON.parse(e.data);O(t)}catch{}},c.onclose=()=>{u.value=!1,setTimeout(()=>{u.value===!1&&S()},3e3)},c.onerror=e=>{p.error("WebSocket连接错误")}}catch{p.error("无法创建WebSocket连接")}},$=()=>{c&&(c.close(),c=null),u.value=!1},O=e=>{switch(e.type){case"system":P(e.data);break;case"server":A(e.data);break;case"alert":E(e.data);break}},P=e=>{Object.assign(r,e);const t=new Date().toLocaleTimeString();o.timeLabels.push(t),o.cpuData.push(e.cpuUsage),o.memoryData.push(e.memoryUsage),o.diskData.push(e.diskUsage),o.timeLabels.length>50&&(o.timeLabels.shift(),o.cpuData.shift(),o.memoryData.shift(),o.diskData.shift()),G()},A=e=>{const t=v.value.findIndex(a=>a.serverId===e.serverId);t>=0?v.value[t]=e:v.value.push(e)},E=e=>{h.value.unshift(e),({low:p.info,medium:p.warning,high:p.error,critical:p.error}[e.severity]||p.info)(e.message),e.severity!=="critical"&&setTimeout(()=>{L(e.id)},3e4)},V=()=>{if(!x.value)return;y=ce(x.value);const e={title:{text:"系统性能趋势",left:"center",textStyle:{fontSize:16,fontWeight:"normal"}},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["CPU使用率","内存使用率","磁盘使用率"],bottom:10},grid:{left:"3%",right:"4%",bottom:"15%",containLabel:!0},xAxis:{type:"category",data:o.timeLabels,axisLine:{lineStyle:{color:"#666"}}},yAxis:{type:"value",min:0,max:100,axisLabel:{formatter:"{value}%"},axisLine:{lineStyle:{color:"#666"}},splitLine:{lineStyle:{color:"#eee"}}},series:[{name:"CPU使用率",type:"line",data:o.cpuData,smooth:!0,lineStyle:{color:"#5470c6"},areaStyle:{color:"rgba(84, 112, 198, 0.1)"}},{name:"内存使用率",type:"line",data:o.memoryData,smooth:!0,lineStyle:{color:"#91cc75"},areaStyle:{color:"rgba(145, 204, 117, 0.1)"}},{name:"磁盘使用率",type:"line",data:o.diskData,smooth:!0,lineStyle:{color:"#fac858"},areaStyle:{color:"rgba(250, 200, 88, 0.1)"}}]};y.setOption(e),window.addEventListener("resize",()=>{y?.resize()})},G=()=>{y&&y.setOption({xAxis:{data:o.timeLabels},series:[{data:o.cpuData},{data:o.memoryData},{data:o.diskData}]})},R=()=>{u.value?$():S()},g=e=>{if(e===0)return"0 B";const t=1024,a=["B","KB","MB","GB","TB"],l=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,l)).toFixed(2))+" "+a[l]},j=e=>{if(!e)return"0s";const t=Math.floor(e/1e9)%60,a=Math.floor(e/6e10)%60,l=Math.floor(e/36e11)%24,U=Math.floor(e/864e11);return U>0?`${U}d ${l}h ${a}m`:l>0?`${l}h ${a}m`:a>0?`${a}m ${t}s`:`${t}s`},q=e=>new Date(e).toLocaleString(),b=e=>e<60?"#18a058":e<80?"#f0a020":"#d03050",J=e=>({low:"mdi:information",medium:"mdi:alert",high:"mdi:alert-circle",critical:"mdi:alert-octagon"})[e]||"mdi:information",L=e=>{const t=h.value.findIndex(a=>a.id===e);t>=0&&h.value.splice(t,1)};return X(async()=>{await Z(),V(),S()}),ee(()=>{$(),y?.dispose(),window.removeEventListener("resize",()=>{y?.resize()})}),(e,t)=>{const a=K;return k(),M("div",ge,[s("div",_e,[s("h2",ke,[i(a,{icon:"mdi:monitor-eye",class:"title-icon"}),t[0]||(t[0]=D(" UltraThink 实时监控 ",-1))]),s("div",xe,[i(n(N),{type:w.value.type,size:"small"},{default:m(()=>[i(a,{icon:w.value.icon,class:"status-icon"},null,8,["icon"]),D(" "+d(w.value.text),1)]),_:1},8,["type"]),i(n(T),{onClick:R,size:"small",type:u.value?"warning":"primary"},{default:m(()=>[i(a,{icon:u.value?"mdi:pause":"mdi:play"},null,8,["icon"]),D(" "+d(u.value?"暂停监控":"开始监控"),1)]),_:1},8,["type"])])]),s("div",we,[i(n(f),{class:"overview-card"},{default:m(()=>[s("div",Se,[s("div",be,[i(a,{icon:"mdi:cpu-64-bit",class:"metric-icon cpu-icon"}),t[1]||(t[1]=s("span",{class:"metric-title"},"CPU 使用率",-1))]),s("div",Ue,d(r.cpuUsage.toFixed(1))+"%",1),i(n(C),{type:"line",percentage:r.cpuUsage,color:b(r.cpuUsage),"show-indicator":!1,"stroke-width":"8"},null,8,["percentage","color"])])]),_:1}),i(n(f),{class:"overview-card"},{default:m(()=>[s("div",Ce,[s("div",Me,[i(a,{icon:"mdi:memory",class:"metric-icon memory-icon"}),t[2]||(t[2]=s("span",{class:"metric-title"},"内存使用率",-1))]),s("div",De,d(r.memoryUsage.toFixed(1))+"%",1),i(n(C),{type:"line",percentage:r.memoryUsage,color:b(r.memoryUsage),"show-indicator":!1,"stroke-width":"8"},null,8,["percentage","color"]),s("div",$e,d(g(r.memoryUsed))+" / "+d(g(r.memoryTotal)),1)])]),_:1}),i(n(f),{class:"overview-card"},{default:m(()=>[s("div",Le,[s("div",Ne,[i(a,{icon:"mdi:harddisk",class:"metric-icon disk-icon"}),t[3]||(t[3]=s("span",{class:"metric-title"},"磁盘使用率",-1))]),s("div",Te,d(r.diskUsage.toFixed(1))+"%",1),i(n(C),{type:"line",percentage:r.diskUsage,color:b(r.diskUsage),"show-indicator":!1,"stroke-width":"8"},null,8,["percentage","color"]),s("div",Ie,d(g(r.diskUsed))+" / "+d(g(r.diskTotal)),1)])]),_:1}),i(n(f),{class:"overview-card"},{default:m(()=>[s("div",ze,[s("div",Be,[i(a,{icon:"mdi:server",class:"metric-icon server-icon"}),t[4]||(t[4]=s("span",{class:"metric-title"},"活跃服务器",-1))]),s("div",We,d(v.value.length),1),s("div",Fe,d(W.value)+" 在线玩家 ",1)])]),_:1})]),s("div",Oe,[i(n(f),{title:"系统性能趋势",class:"chart-card full-width"},{default:m(()=>[s("div",{ref_key:"systemChartRef",ref:x,class:"chart-container"},null,512)]),_:1})]),i(n(f),{title:"服务器状态监控",class:"servers-table-card"},{default:m(()=>[i(n(Y),{columns:F,data:v.value,pagination:!1,size:"small",loading:B.value},null,8,["data","loading"])]),_:1}),h.value.length>0?(k(),te(n(f),{key:0,title:"系统告警",class:"alerts-card"},{default:m(()=>[s("div",Pe,[(k(!0),M(ae,null,ie(h.value,l=>(k(),M("div",{key:l.id,class:oe(["alert-item",`alert-${l.severity}`])},[i(a,{icon:J(l.severity),class:"alert-icon"},null,8,["icon"]),s("div",Ae,[s("div",Ee,d(l.message),1),s("div",Ve,d(q(l.timestamp)),1)]),i(n(T),{size:"tiny",onClick:U=>L(l.id)},{default:m(()=>[i(a,{icon:"mdi:close"})]),_:1},8,["onClick"])],2))),128))])]),_:1})):se("",!0)])}}}),He=he(Re,[["__scopeId","data-v-06b5b875"]]);export{He as default};
