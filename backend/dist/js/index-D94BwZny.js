import xe from"./index-DP8QyUpt.js";import{k as Ee,r as Z,e as de,c as T,w as Ue,_ as L,R as h,U as l,S as o,V as n,Q as y,Y as z,a3 as ee,K as d,j as w,$ as m,F as B,N as F,I as re,aF as se}from"./vue-vendor-Bom1XEVO.js";import{ad as Le,R as Be,ag as Fe,ah as Ae,U as De,Q as Oe,P as Ve,af as Re,S as $e,M as Ge,O as je,ac as Ke}from"./ui-vendor-D9aA433m.js";import{_ as Qe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./iconify-W0kOH8CK.js";import"./index-Chx56wke.js";const Ye={permissionTypeOptions:[{label:"菜单权限",value:"menu"},{label:"按钮权限",value:"button"},{label:"接口权限",value:"api"}]},qe=()=>{const M=(p,u)=>{for(const i of p){if(i.id===u)return i;if(i.children){const b=M(i.children,u);if(b)return b}}return null},$=(p,u)=>{for(const i of p)if(i.id===u||i.children&&M(i.children,u))return i;return null},g=p=>{const u=[],i=b=>{for(const k of b)u.push(k.id),k.children&&i(k.children)};return i(p),u},S=(p,u)=>p.some(i=>[i.name,i.code,i.description||""].some(N=>N.toLowerCase().includes(u))||i.children&&S(i.children,u)),U=(p,u)=>p.some(i=>i.type===u||i.children&&U(i.children,u)),A=p=>{const u=[],i=b=>{for(const k of b)u.push(k),k.children&&i(k.children)};return p.children&&i(p.children),u},D=p=>{if(!p.children)return[];const u=p.children.filter(i=>i.type==="menu");return u.length===0?p.children:u},G={menu:"mdi:menu",button:"mdi:gesture-tap-button",api:"mdi:api"},j={menu:"info",button:"success",api:"warning"},P={menu:"菜单",button:"按钮",api:"接口"};return{findPermissionById:M,findTopLevelPermission:$,getAllPermissionIds:g,hasMatchingPermissionInTree:S,hasPermissionTypeInTree:U,getModulePermissions:A,getModuleDisplayPermissions:D,getPermissionIcon:p=>G[p]||"mdi:circle",getPermissionTypeColor:p=>j[p]||"default",getPermissionTypeName:p=>P[p]||p}},He={class:"permission-header"},Je={class:"header-info"},We={class:"header-actions"},Xe={class:"tree-permission-layout"},Ze={class:"permission-toolbar"},es={class:"toolbar-left"},ss={class:"toolbar-right"},ts={class:"permission-stats"},ns={class:"stat-item"},os={class:"stat-value"},is={class:"stat-item"},ls={class:"stat-value highlight"},cs={class:"stat-item"},as={class:"stat-value"},ds={class:"stat-label"},rs={class:"stat-value"},us={class:"tree-permissions-container"},ps={class:"module-header"},ms={class:"module-info"},_s={class:"module-title-section"},hs={class:"module-description"},fs={class:"module-controls"},vs={class:"module-progress"},gs={class:"progress-text"},ys={key:0,class:"permission-content"},ks=["onClick"],Cs={class:"permission-header"},ws={class:"permission-main"},bs={class:"permission-info"},zs={class:"permission-title"},Is={class:"permission-name"},Ms={class:"permission-details"},Ps={class:"permission-code"},Ts={key:0,class:"permission-description"},Ss={key:0,class:"selection-indicator"},Ns={key:0,class:"child-permissions"},xs={class:"child-permissions-grid"},Es=["onClick"],Us={class:"child-permission-content"},Ls={class:"child-permission-info"},Bs={class:"child-permission-title"},Fs={class:"child-permission-name"},As={class:"child-permission-details"},Ds={class:"child-permission-code"},Os={key:0,class:"child-permission-description"},Vs={key:0,class:"child-selection-indicator"},Rs={key:0,class:"selected-preview"},$s={class:"preview-header"},Gs={class:"preview-summary"},js=Ee({__name:"index",props:{show:{type:Boolean},role:{},permissions:{},selectedIds:{}},emits:["update:show","update:selectedIds","save","showTemplate"],setup(M,{emit:$}){const g=M,S=$,{findPermissionById:U,findTopLevelPermission:A,getAllPermissionIds:D,hasMatchingPermissionInTree:G,hasPermissionTypeInTree:j,getModulePermissions:P,getModuleDisplayPermissions:te,getPermissionIcon:K,getPermissionTypeColor:Q,getPermissionTypeName:p}=qe(),u=Z(""),i=Z(null),b=Z(!1),k=de({}),N=de({}),ue=[["menu","菜单"],["button","按钮"],["api","接口"]],O=T({get:()=>g.show,set:s=>S("update:show",s)}),v=T({get:()=>g.selectedIds,set:s=>S("update:selectedIds",s)}),pe=T(()=>{const{permissions:s}=g,e=u.value?.toLowerCase(),t=i.value;return!e&&!t?s:s.filter(c=>{const{name:_,code:C,children:R=[]}=c;return!(e&&![_,C].some(x=>x.toLowerCase().includes(e))&&!G(R,e)||t&&!j(R,t))})}),me=T(()=>D(g.permissions).length),_e=T(()=>{const s=new Set;return v.value.forEach(e=>{const t=A(g.permissions,e);t&&s.add(t.id)}),s.size}),he=T(()=>{const s={menu:0,button:0,api:0};return v.value.forEach(e=>{const t=U(g.permissions,e);t?.type&&t.type in s&&s[t.type]++}),s}),Y=T(()=>{const s={};return v.value.forEach(e=>{const t=U(g.permissions,e),c=A(g.permissions,e);if(t&&c){const{name:_,icon:C="mdi:folder"}=c;s[_]??={module:_,icon:C,permissions:[]},s[_].permissions.push(t)}}),Object.values(s)}),I=s=>v.value.includes(s),ne=s=>{if(!u.value)return!1;const e=u.value.toLowerCase();return[s.name,s.code,s.description||""].some(t=>t.toLowerCase().includes(e))},V=s=>q(s).length>0,q=s=>{const{children:e=[]}=s,t=u.value?.toLowerCase(),c=i.value;return e.filter(_=>c&&_.type!==c?!1:t?[_.name,_.code,_.description||""].some(C=>C.toLowerCase().includes(t)):!0)},fe=s=>{const{children:e=[]}=s,t=e.map(_=>_.id),c=t.filter(_=>v.value.includes(_));return c.length>0&&c.length<t.length},H=s=>P(s).length,oe=s=>P(s).filter(e=>v.value.includes(e.id)).length,ie=s=>{const e=H(s),t=oe(s);return e>0?Math.round(t/e*100):0},ve=s=>{const e=ie(s);return e===0?"#d9d9d9":e===100?"#52c41a":"#1890ff"},ge=s=>{const e=P(s);return e.length>0&&e.every(t=>v.value.includes(t.id))},ye=s=>{const e=P(s),t=e.filter(c=>v.value.includes(c.id)).length;return t>0&&t<e.length},le=(s,e)=>{e[s]=!e[s]},ke=s=>{b.value=s,g.permissions.forEach(({id:e,children:t=[]})=>{k[e]=s,t.forEach(c=>{c.children?.length&&(N[c.id]=s)})})},J=s=>{const e=new Set(v.value);s(e),v.value=Array.from(e)},W=(s,e)=>{J(t=>e?t.add(s):t.delete(s))},Ce=(s,e)=>{const{id:t,children:c=[]}=s;J(_=>{e?(_.add(t),c.forEach(C=>_.add(C.id))):(_.delete(t),c.forEach(C=>_.delete(C.id)))})},we=(s,e)=>{const t=P(s);J(c=>{t.forEach(_=>e?c.add(_.id):c.delete(_.id))})},be=()=>{v.value=D(g.permissions)},ce=()=>{v.value=[]},ze=()=>{S("save",v.value)},Ie=()=>{O.value=!1};return Ue(()=>g.show,s=>{s&&g.permissions.length>0&&g.permissions.forEach(({id:e})=>{k[e]??=!0})},{immediate:!0}),(s,e)=>{const t=xe,c=Ve,_=je,C=De,R=Be,ae=Fe,x=Ae,Me=Oe,X=Re,E=$e,Pe=Ge,Te=Le,Se=Ke;return h(),L(Se,{show:d(O),"onUpdate:show":e[5]||(e[5]=a=>ee(O)?O.value=a:null),width:1200,placement:"right","mask-closable":!1},{default:l(()=>[o(Te,{closable:""},{header:l(()=>[n("div",He,[n("div",Je,[o(t,{name:"mdi:shield-key-outline",size:24}),n("div",null,[e[6]||(e[6]=n("h3",null,"权限分配",-1)),n("p",null,m(M.role?.name)+" - "+m(M.role?.description||"角色权限管理"),1)])]),n("div",We,[o(C,null,{default:l(()=>[o(_,{value:d(v).length,max:999,type:"success"},{default:l(()=>[o(c,{type:"primary",size:"large",onClick:ze},{icon:l(()=>[o(t,{name:"mdi:content-save",size:16})]),default:l(()=>[w(" 保存配置 ("+m(d(v).length)+") ",1)]),_:1})]),_:1},8,["value"]),o(c,{onClick:Ie},{default:l(()=>[...e[7]||(e[7]=[w("取消",-1)])]),_:1})]),_:1})])])]),default:l(()=>[n("div",Xe,[n("div",Ze,[n("div",es,[o(R,{value:d(u),"onUpdate:value":e[0]||(e[0]=a=>ee(u)?u.value=a:null),placeholder:"搜索权限名称、编码或描述...",clearable:"",size:"large",style:{width:"350px"}},{prefix:l(()=>[o(t,{name:"mdi:magnify",size:18})]),_:1},8,["value"]),o(ae,{value:d(i),"onUpdate:value":e[1]||(e[1]=a=>ee(i)?i.value=a:null),placeholder:"权限类型",clearable:"",style:{width:"120px"},options:d(Ye).permissionTypeOptions},null,8,["value","options"]),o(x,{checked:d(b),"onUpdate:checked":ke},{default:l(()=>[w(m(d(b)?"收起全部":"展开全部"),1)]),_:1},8,["checked"])]),n("div",ss,[o(C,null,{default:l(()=>[o(Me,null,{default:l(()=>[o(c,{onClick:be,type:"primary",ghost:""},{icon:l(()=>[o(t,{name:"mdi:checkbox-multiple-marked",size:16})]),default:l(()=>[e[8]||(e[8]=w(" 全选 ",-1))]),_:1}),o(c,{onClick:ce},{icon:l(()=>[o(t,{name:"mdi:checkbox-multiple-blank",size:16})]),default:l(()=>[e[9]||(e[9]=w(" 清空 ",-1))]),_:1})]),_:1}),o(c,{type:"primary",ghost:"",onClick:e[2]||(e[2]=a=>s.$emit("showTemplate"))},{icon:l(()=>[o(t,{name:"mdi:bookmark-multiple",size:16})]),default:l(()=>[e[10]||(e[10]=w(" 快速模板 ",-1))]),_:1})]),_:1})])]),n("div",ts,[o(C,{align:"center"},{default:l(()=>[n("div",ns,[e[11]||(e[11]=n("span",{class:"stat-label"},"全部权限:",-1)),n("span",os,m(d(me)),1)]),o(X,{vertical:""}),n("div",is,[e[12]||(e[12]=n("span",{class:"stat-label"},"已选权限:",-1)),n("span",ls,m(d(v).length),1)]),o(X,{vertical:""}),n("div",cs,[e[13]||(e[13]=n("span",{class:"stat-label"},"覆盖模块:",-1)),n("span",as,m(d(_e)),1)]),o(X,{vertical:""}),(h(),y(B,null,F(ue,([a,r])=>n("div",{key:a,class:"stat-item"},[n("span",ds,m(r)+"权限:",1),n("span",rs,m(d(he)[a]),1)])),64))]),_:1})]),n("div",us,[(h(!0),y(B,null,F(d(pe),a=>(h(),y("div",{key:a.id,class:"permission-module"},[n("div",ps,[n("div",ms,[n("div",_s,[o(c,{text:"",onClick:()=>le(a.id,d(k)),class:"expand-button"},{icon:l(()=>[o(t,{name:d(k)[a.id]?"mdi:chevron-down":"mdi:chevron-right",size:18},null,8,["name"])]),_:2},1032,["onClick"]),o(t,{name:a.icon||"mdi:folder",size:20},null,8,["name"]),n("h4",null,m(a.name),1),o(E,{size:"small",type:"info"},{default:l(()=>[w(m(H(a))+" 权限 ",1)]),_:2},1024)]),n("p",hs,m(a.description||"该模块的功能权限配置"),1)]),n("div",fs,[n("div",vs,[n("span",gs,m(oe(a))+"/"+m(H(a)),1),o(Pe,{type:"line",percentage:ie(a),height:6,"border-radius":3,"show-indicator":!1,color:ve(a)},null,8,["percentage","color"])]),o(x,{checked:ge(a),indeterminate:ye(a),"onUpdate:checked":r=>we(a,r),size:"large"},{default:l(()=>[...e[14]||(e[14]=[w(" 全选模块 ",-1)])]),_:1},8,["checked","indeterminate","onUpdate:checked"])])]),d(k)[a.id]?(h(),y("div",ys,[(h(!0),y(B,null,F(d(te)(a),r=>(h(),y("div",{key:r.id,class:"permission-tree-node"},[n("div",{class:re(["permission-card",{selected:I(r.id),highlighted:ne(r),"has-children":V(r)}]),onClick:()=>W(r.id,!I(r.id))},[n("div",Cs,[n("div",ws,[o(x,{checked:I(r.id),indeterminate:fe(r),"onUpdate:checked":f=>Ce(r,f),onClick:e[3]||(e[3]=se(()=>{},["stop"])),size:"large"},null,8,["checked","indeterminate","onUpdate:checked"]),n("div",bs,[n("div",zs,[o(t,{name:d(K)(r.type),size:16},null,8,["name"]),n("span",Is,m(r.name),1),o(E,{size:"tiny",type:d(Q)(r.type)},{default:l(()=>[w(m(d(p)(r.type)),1)]),_:2},1032,["type"]),V(r)?(h(),L(E,{key:0,size:"tiny",type:"info"},{default:l(()=>[w(m(q(r).length)+" 个子权限 ",1)]),_:2},1024)):z("",!0)]),n("div",Ms,[n("code",Ps,m(r.code),1),r.description?(h(),y("span",Ts,m(r.description),1)):z("",!0)])])]),V(r)?(h(),L(c,{key:0,text:"",size:"small",onClick:se(()=>le(r.id,d(N)),["stop"])},{icon:l(()=>[o(t,{name:d(N)[r.id]?"mdi:chevron-down":"mdi:chevron-right",size:16},null,8,["name"])]),_:2},1032,["onClick"])):z("",!0)]),I(r.id)?(h(),y("div",Ss,[o(t,{name:"mdi:check-circle",size:18})])):z("",!0)],10,ks),V(r)&&d(N)[r.id]?(h(),y("div",Ns,[n("div",xs,[(h(!0),y(B,null,F(q(r),f=>(h(),y("div",{key:f.id,class:re(["child-permission-card",{selected:I(f.id),highlighted:ne(f),"button-type":f.type==="button","api-type":f.type==="api"}]),onClick:()=>W(f.id,!I(f.id))},[n("div",Us,[o(x,{checked:I(f.id),"onUpdate:checked":Ne=>W(f.id,Ne),onClick:e[4]||(e[4]=se(()=>{},["stop"])),size:"medium"},null,8,["checked","onUpdate:checked"]),n("div",Ls,[n("div",Bs,[o(t,{name:d(K)(f.type),size:14},null,8,["name"]),n("span",Fs,m(f.name),1),o(E,{size:"tiny",type:d(Q)(f.type)},{default:l(()=>[w(m(d(p)(f.type)),1)]),_:2},1032,["type"])]),n("div",As,[n("code",Ds,m(f.code),1),f.description?(h(),y("span",Os,m(f.description),1)):z("",!0)])])]),I(f.id)?(h(),y("div",Vs,[o(t,{name:"mdi:check",size:14})])):z("",!0)],10,Es))),128))])])):z("",!0)]))),128))])):z("",!0)]))),128))]),d(v).length>0?(h(),y("div",Rs,[n("div",$s,[e[16]||(e[16]=n("h5",null,"已选择的权限",-1)),o(c,{text:"",type:"error",onClick:ce,size:"small"},{icon:l(()=>[o(t,{name:"mdi:delete-sweep",size:16})]),default:l(()=>[e[15]||(e[15]=w(" 清空全部 ",-1))]),_:1})]),n("div",Gs,[o(C,null,{default:l(()=>[(h(!0),y(B,null,F(d(Y).slice(0,6),a=>(h(),L(E,{key:a.module,type:"primary",size:"medium"},{default:l(()=>[w(m(a.module)+" ("+m(a.permissions.length)+") ",1)]),_:2},1024))),128)),d(Y).length>6?(h(),L(E,{key:0,type:"default",size:"medium"},{default:l(()=>[w(" +"+m(d(Y).length-6)+" 更多模块 ",1)]),_:1})):z("",!0)]),_:1})])])):z("",!0)])]),_:1})]),_:1},8,["show"])}}}),Ws=Qe(js,[["__scopeId","data-v-884eb0dc"]]);export{Ws as default};
