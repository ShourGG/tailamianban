import{k as ae,o as re,e as de,E as ue,r as S,w as ee,c as F,_ as he,V as n,aF as $,M as b,I as M,K as o,$ as J,T as pe,R as y,Q as T,S as fe,Y as B}from"./vue-vendor-Bom1XEVO.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ge="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAELklEQVRYR+2YW2wUZRTH//9vtlCoF9IoIklT3PqgPGi326hoetuaGEhIr9SgCYkkgt2WGOQVCca+GavWdr0GjD4YhG3RB3hply1LQA1tEQIxEXapGI2pEkys9LIzx2ylYWfY6e5sF0oi+7hzzvl+3/9855xvhrjNf7zN+XAHcL4Z+n8o6JWTeYt++W25S596AIZy6TB+n3yo+Nchlk8vmIIVowdXU9c3Q1gDSilBlQwjgBAYFGDvdF58/4milqvZwDpOcXWsb5Uh8hmBqkwXFMhlCN8aX5LXNbRy/T+Z+iXsHAFWRXs3QGQPyLucLDJrK5DgUXdTsxPfjAEro8E3Ce50EtxsKxPTwCPH3U2jTmJkBJgWTnAMxDeGMEoa0xQ+LJQnCD4HYFkCyAC3RdwN3U7gMkpxRTTYrMD91sCJIgCxV5R6O1Jcfy7VwonqLoj9/CqB2kF341qncGkBvRe+ureAWpRgoalCBecMFzcdK24YymZRJz5zprgq1tsJwXYL3CVZGvdGHmwZc7JQtra2gE+f712ep2QUYP714DJhaJrXLqXZQszlZwtYdSHoB9ljVk/ePVrSZFL0ZkAlxzQBVseCT8WhZhRThtFB8plk9Zi/qCi8cv0fNxvKFrDy4oF11NXXIFy2EII4iBcG3Y03VLZT8OqRd5aFPduvOEpxRayvXolxAKB2g6NgEhobBlc1HHYKY7WvHf5wtVAPgegIlbbZ9seUZ7AyFnwewi9pGoUyDmhrB931kfnC1ZwOeKlLP8GZJi6QLSFP2yep4toXSbT3ZQAfX3O6omt8Nhd9r/aHQAUMOQywYBZo5uZD2ThQ2rbPCjlnH6yI9rUryE5DU75ctJaake46Be4DuDjF8dFBNA94/AdtiySVxIlpMlTS8td801o70vMigM9huTda2lhcKHVHPO2HZv/P6LIwX7hk/+qzPSvUJGMkrg8AQYTkroRdXMlE+HH/twsG6BsOdJHYZlaO/lBZ6weOiiSXqs3Gqj0TeAxx+T75DIpgwjC0onD51pQD4JaluPrkR/cpFT9DcoVp84LOgTL/DjtBbglgou+puHwB8lEznPxJw1XSX77VtgizBvQNBw4RMqB7xt4Lc3c8lQKJaQHoO4R8ydz0/7MWoCXk8c85MrMC9J3qaafw/WtQlwXST+F3BnAeYB4obgJ1BJIuG+YtiKAjVOZ/Pd1ZdwzoG+4uBtSPpjaRbhXLcwF3hzytb2TilgVgT5BkYybBrTYC+Rvg5nRpdTRJrIs8+VPXPQXj2i4ItxC4O2NQQUQnN4U9rRcz9nH64p4ceM2lziX5Y4s3KHCdUHwE77ecMkMEp6BwhIa2Z6DslZRvfulgHafYLuCas58WLp2aLCFUga70qxOFU6dPFL2W1feYeaU43Y5z/TxnCuYabMEuC043ckdBp4pZ7f8FE5psOI1g6fwAAAAASUVORK5CYII=",me=["width","height"],we=["width","height"],Xe=["width","height"],xe=n("div",{class:"loading-gif_"},[n("span"),n("span"),n("span"),n("span"),n("span")],-1),ye=[xe],Te={class:"auth-control_"},Se={class:"range-text"},Ye=n("div",null,null,-1),Ce=n("div",null,null,-1),be=n("div",null,null,-1),Be=[Ye,Ce,be],Me=ae({__name:"App",props:{type:{type:String,default:"modal"},canvasWidth:{type:Number,default:310},canvasHeight:{type:Number,default:160},show:{type:Boolean,default:!1},puzzleScale:{type:Number,default:1},sliderSize:{type:Number,default:50},range:{type:Number,default:10},zIndex:{type:Number,default:999},imgs:{type:Array,default:null},successText:{type:String,default:"验证通过！"},failText:{type:String,default:"验证失败，请重试"},sliderText:{type:String,default:"拖动滑块完成拼图"},className:{type:String,default:""}},emits:["success","fail","close","reset"],setup(c,{expose:O,emit:I}){const i=c;re(()=>{document.addEventListener("mousemove",W,!1),document.addEventListener("mouseup",R,!1),document.addEventListener("touchmove",W,{passive:!1}),document.addEventListener("touchend",R,!1),a.isInside=i.type==="inside",i.show&&(!a.isInside&&document.body.classList.add("vue-puzzle-overflow"),H())}),ue(()=>{a.timer1&&clearTimeout(a.timer1),document.removeEventListener("mousemove",W,!1),document.removeEventListener("mouseup",R,!1),document.removeEventListener("touchmove",W,!1),document.removeEventListener("touchend",R,!1)});const m=S(),w=S(),u=S(),p=S(),a=de({isInside:!1,mouseDown:!1,startWidth:50,startX:0,newX:0,pinX:0,pinY:0,loading:!1,isCanSlide:!1,error:!1,infoBoxShow:!1,infoText:"",infoBoxFail:!1,timer1:void 0,closeDown:!1,isSuccess:!1,imgIndex:-1,isSubmting:!1});ee(()=>i.show,t=>{t?(!a.isInside&&document.body.classList.add("vue-puzzle-overflow"),H()):(a.isSubmting=!1,a.isSuccess=!1,a.infoBoxShow=!1,document.body.classList.remove("vue-puzzle-overflow"))}),ee(()=>i.type,t=>{t==="inside"?(a.isInside=!0,document.body.classList.remove("vue-puzzle-overflow")):a.isInside=!1});const Y=F(()=>{const t=a.startWidth+a.newX-a.startX;return t<h.value?h.value:t>i.canvasWidth?i.canvasWidth:t}),r=F(()=>Math.round(Math.max(Math.min(i.puzzleScale,2),.2)*52.5+6)),h=F(()=>Math.max(Math.min(Math.round(i.sliderSize),Math.round(i.canvasWidth*.5)),10)),Q=F(()=>i.zIndex!==999?`z-index:${i.zIndex}`:""),Z=()=>{!a.mouseDown&&!a.isSubmting&&(a.timer1&&clearTimeout(a.timer1),I("close"))},D=()=>{a.isInside||(a.closeDown=!0)},_=()=>{a.closeDown&&Z(),a.closeDown=!1},k=t=>{var s;a.isCanSlide&&(a.mouseDown=!0,a.startWidth=((s=m.value)==null?void 0:s.clientWidth)||0,a.newX=t.clientX!==void 0?t.clientX:t.changedTouches[0].clientX,a.startX=t.clientX!==void 0?t.clientX:t.changedTouches[0].clientX)},W=t=>{a.mouseDown&&(t.preventDefault(),a.newX=t.clientX!==void 0?t.clientX:t.changedTouches[0].clientX)},R=()=>{a.mouseDown&&(a.mouseDown=!1,ie())},G=(t=!1)=>{var s;if(a.loading&&!t)return;a.loading=!0,a.isCanSlide=!1;const d=w.value,f=u.value,v=p.value,e=d?.getContext("2d",{willReadFrequently:!0}),X=f?.getContext("2d"),P=v?.getContext("2d");if(!e||!X||!P)return;const oe=navigator.userAgent.indexOf("Firefox")>=0&&navigator.userAgent.indexOf("Windows")>=0,x=document.createElement("img");if(e.fillStyle="rgba(255,255,255,1)",P.fillStyle="rgba(255,255,255,1)",e.clearRect(0,0,i.canvasWidth,i.canvasHeight),X.clearRect(0,0,i.canvasWidth,i.canvasHeight),a.pinX=l(r.value+20,i.canvasWidth-r.value-10),a.pinY=l(20,i.canvasHeight-r.value-10),x.crossOrigin="anonymous",x.onload=()=>{const[g,N,V,U]=te(x),q=Math.random(),j=Math.random(),K=Math.random(),le=Math.random(),L=q<.33?-1:q<.66?0:1,z=j<.33?-1:j<.66?0:1,A=K<.33?-1:K<.66?0:1;let C=le<.6?1:0;L===z&&z===A&&A===C&&C===0&&(C=1),e.save(),E(e,L,z,A,C),e.closePath(),oe?(e.clip(),e.save(),e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowColor="#000",e.shadowBlur=3,e.fill(),e.restore()):(e.shadowOffsetX=0,e.shadowOffsetY=0,e.shadowColor="#000",e.shadowBlur=3,e.fill(),e.clip()),e.drawImage(x,g,N,V,U),P.fillRect(0,0,i.canvasWidth,i.canvasHeight),P.drawImage(x,g,N,V,U),e.globalCompositeOperation="source-atop",E(e,L,z,A,C),e.arc(a.pinX+Math.ceil(r.value/2),a.pinY+Math.ceil(r.value/2),r.value*1.2,0,Math.PI*2,!0),e.closePath(),e.shadowColor="rgba(255, 255, 255, .8)",e.shadowOffsetX=-1,e.shadowOffsetY=-1,e.shadowBlur=Math.min(Math.ceil(8*i.puzzleScale),12),e.fillStyle="#ffffaa",e.fill();const ce=e.getImageData(a.pinX-3,a.pinY-20,a.pinX+r.value+5,a.pinY+r.value+5);X.putImageData(ce,0,a.pinY-20),e.restore(),e.clearRect(0,0,i.canvasWidth,i.canvasHeight),e.save(),E(e,L,z,A,C),e.globalAlpha=.8,e.fillStyle="#ffffff",e.fill(),e.restore(),e.save(),e.globalCompositeOperation="source-atop",E(e,L,z,A,C),e.arc(a.pinX+Math.ceil(r.value/2),a.pinY+Math.ceil(r.value/2),r.value*1.2,0,Math.PI*2,!0),e.shadowColor="#000",e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowBlur=16,e.fill(),e.restore(),e.save(),e.globalCompositeOperation="destination-over",e.drawImage(x,g,N,V,U),e.restore(),a.loading=!1,a.isCanSlide=!0},x.onerror=()=>{G(!0)},!t&&(s=i.imgs)!=null&&s.length){let g=l(0,i.imgs.length-1);g===a.imgIndex&&(g===i.imgs.length-1?g=0:g++),a.imgIndex=g,x.src=i.imgs[g]}else x.src=se()},l=(t,s)=>Math.ceil(Math.random()*(s-t)+t),te=t=>{const s=t.width/t.height,d=i.canvasWidth/i.canvasHeight;let f=0,v=0,e=0,X=0;return s>d?(X=i.canvasHeight,e=s*X,v=0,f=(i.canvasWidth-e)/2):(e=i.canvasWidth,X=e/s,f=0,v=(i.canvasHeight-X)/2),[f,v,e,X]},E=(t,s,d,f,v)=>{const e=Math.ceil(15*i.puzzleScale);t.beginPath(),t.moveTo(a.pinX,a.pinY),t.lineTo(a.pinX+e,a.pinY),t.arcTo(a.pinX+e,a.pinY+s*e/2,a.pinX+e+e/2,a.pinY+s*e/2,e/2),t.arcTo(a.pinX+e+e,a.pinY+s*e/2,a.pinX+e+e,a.pinY,e/2),t.lineTo(a.pinX+e+e+e,a.pinY),t.lineTo(a.pinX+e+e+e,a.pinY+e),t.arcTo(a.pinX+e+e+e+d*e/2,a.pinY+e,a.pinX+e+e+e+d*e/2,a.pinY+e+e/2,e/2),t.arcTo(a.pinX+e+e+e+d*e/2,a.pinY+e+e,a.pinX+e+e+e,a.pinY+e+e,e/2),t.lineTo(a.pinX+e+e+e,a.pinY+e+e+e),t.lineTo(a.pinX+e+e,a.pinY+e+e+e),t.arcTo(a.pinX+e+e,a.pinY+e+e+e+f*e/2,a.pinX+e+e/2,a.pinY+e+e+e+f*e/2,e/2),t.arcTo(a.pinX+e,a.pinY+e+e+e+f*e/2,a.pinX+e,a.pinY+e+e+e,e/2),t.lineTo(a.pinX,a.pinY+e+e+e),t.lineTo(a.pinX,a.pinY+e+e),t.arcTo(a.pinX+v*e/2,a.pinY+e+e,a.pinX+v*e/2,a.pinY+e+e/2,e/2),t.arcTo(a.pinX+v*e/2,a.pinY+e,a.pinX,a.pinY+e,e/2),t.lineTo(a.pinX,a.pinY)},se=()=>{const t=document.createElement("canvas"),s=t.getContext("2d");if(!s)return"";t.width=i.canvasWidth,t.height=i.canvasHeight,s.fillStyle=`rgb(${l(100,255)},${l(100,255)},${l(100,255)})`,s.fillRect(0,0,i.canvasWidth,i.canvasHeight);for(let d=0;d<12;d++)if(s.fillStyle=`rgb(${l(100,255)},${l(100,255)},${l(100,255)})`,s.strokeStyle=`rgb(${l(100,255)},${l(100,255)},${l(100,255)})`,l(0,2)>1)s.save(),s.rotate(l(-90,90)*Math.PI/180),s.fillRect(l(-20,t.width-20),l(-20,t.height-20),l(10,t.width/2+10),l(10,t.height/2+10)),s.restore();else{s.beginPath();const f=l(-Math.PI,Math.PI);s.arc(l(0,t.width),l(0,t.height),l(10,t.height/2+10),f,f+Math.PI*1.5),s.closePath(),s.fill()}return t.toDataURL("image/png")},ie=()=>{a.isSubmting=!0;const t=Y.value-h.value-(r.value-h.value)*((Y.value-h.value)/(i.canvasWidth-h.value)),s=a.pinX-3-t;Math.abs(s)<i.range?(a.infoText=i.successText,a.infoBoxFail=!1,a.infoBoxShow=!0,a.isCanSlide=!1,a.isSuccess=!0,a.timer1&&clearTimeout(a.timer1),a.timer1=setTimeout(()=>{a.isSubmting=!1,I("success",s,{deviation:s,offsetX:t,pinX:a.pinX-3})},800)):(a.infoText=i.failText,a.infoBoxFail=!0,a.infoBoxShow=!0,a.isCanSlide=!1,I("fail",s,{deviation:s,offsetX:t,pinX:a.pinX-3}),a.timer1&&clearTimeout(a.timer1),a.timer1=setTimeout(()=>{a.isSubmting=!1,H()},800))},ne=()=>{a.infoBoxFail=!1,a.infoBoxShow=!1,a.isCanSlide=!1,a.isSuccess=!1,a.startWidth=h.value,a.startX=0,a.newX=0},H=t=>{a.isSubmting||(ne(),G(),t&&I("reset"))};return O({reset:H}),(t,s)=>(y(),he(pe,{to:"body",disabled:a.isInside},[n("div",{class:M(["vue-puzzle-vcode",{inside_:a.isInside,show_:c.show},c.className]),style:b(o(Q)),onMousedown:D,onMouseup:_,onTouchstartPassive:D,onTouchend:_},[n("div",{class:"vue-auth-box_",onMousedown:s[3]||(s[3]=$(()=>{},["stop"])),onTouchstart:s[4]||(s[4]=$(()=>{},["stop"]))},[n("div",{class:"auth-body_",style:b(`width:${c.canvasWidth}px;height: ${c.canvasHeight}px`)},[n("canvas",{ref_key:"canvas1",ref:w,class:"auth-canvas1_",width:c.canvasWidth,height:c.canvasHeight},null,8,me),n("canvas",{ref_key:"canvas3",ref:p,class:M(["auth-canvas3_",{show:a.isSuccess}]),width:c.canvasWidth,height:c.canvasHeight},null,10,we),n("canvas",{ref_key:"canvas2",ref:u,class:"auth-canvas2_",width:o(r),height:c.canvasHeight,style:b(`width:${o(r)}px;height:${c.canvasHeight}px;transform:translateX(${o(Y)-o(h)-(o(r)-o(h))*((o(Y)-o(h))/(c.canvasWidth-o(h)))}px)`)},null,12,Xe),n("div",{class:M(["loading-box_",{hide_:!a.loading}])},ye,2),n("div",{class:M(["info-box_",{show:a.infoBoxShow},{fail:a.infoBoxFail}])},J(a.infoText),3),n("div",{class:M(["flash_",{show:a.isSuccess}]),style:b(`transform: translateX(${a.isSuccess?`${c.canvasWidth+c.canvasHeight*.578}px`:`-${c.canvasHeight*.578}px`}) skew(-30deg, 0);`)},null,6),n("img",{class:"reset_",onClick:s[0]||(s[0]=d=>H(!0)),src:ge})],4),n("div",Te,[n("div",{class:"range-box",style:b(`height:${o(h)}px;width:${c.canvasWidth}px`)},[n("div",Se,J(c.sliderText),1),n("div",{class:"range-slider",ref_key:"rangeSlider",ref:m,style:b(`width:${o(Y)}px`)},[n("div",{class:M(["range-btn",{isDown:a.mouseDown}]),style:b(`width:${o(h)}px`),onMousedown:s[1]||(s[1]=d=>k(d)),onTouchstart:s[2]||(s[2]=d=>k(d))},Be,38)],4)],4)])],32)],38)],8,["disabled"]))}}),Ie={class:"c-captcha-modern"},_e={class:"captcha-content"},ke={class:"captcha-icon"},ze={key:0},Ae={key:1,class:"success-icon"},De={key:2,class:"error-icon"},We={class:"captcha-text"},He={key:0},Le={key:1,class:"success-text"},Fe={key:2,class:"error-text"},Re=ae({__name:"index",props:{triggerText:{default:"点击进行人机验证"},images:{default:()=>[]},disabled:{type:Boolean,default:!1},theme:{default:"dark"}},emits:["success","fail","change","reset"],setup(c,{expose:O,emit:I}){const i=c,m=I,w=S(!1),u=S(!1),p=S(!1),a=S(""),Y=F(()=>i.images.length>0?i.images:void 0),r=()=>{i.disabled||u.value||(p.value=!1,w.value=!0)},h=()=>{u.value=!0,p.value=!1,w.value=!1;const _=Date.now(),k=`puzzle_${_}_${Math.random().toString(36).substring(2,9)}`;a.value=k,m("success",{token:k,timestamp:_}),m("change",!0)},Q=()=>{u.value=!1,p.value=!0,w.value=!1,setTimeout(()=>{p.value=!1},3e3),m("fail","拼图验证失败"),m("change",!1)},Z=()=>{w.value=!1},D=()=>{u.value=!1,p.value=!1,w.value=!1,a.value="",m("reset"),m("change",!1)};return O({validate:()=>u.value,getToken:()=>a.value,getVerificationData:()=>u.value?{token:a.value,timestamp:Date.now(),type:"puzzle-captcha"}:null,reset:D,show:r}),(_,k)=>(y(),T("div",Ie,[n("div",{class:M(["captcha-trigger",{verified:o(u),error:o(p),disabled:c.disabled}]),onClick:r},[n("div",_e,[n("div",ke,[!o(u)&&!o(p)?(y(),T("span",ze,"🧩")):B("",!0),o(u)?(y(),T("span",Ae,"✓")):B("",!0),o(p)?(y(),T("span",De,"⚠️")):B("",!0)]),n("div",We,[!o(u)&&!o(p)?(y(),T("span",He,J(c.triggerText),1)):B("",!0),o(u)?(y(),T("span",Le,"验证成功")):B("",!0),o(p)?(y(),T("span",Fe,"验证失败，请重试")):B("",!0)])]),o(u)||o(p)?(y(),T("div",{key:0,class:"refresh-button",onClick:$(D,["stop"]),title:"重新验证"}," ⟲ ")):B("",!0)],2),fe(o(Me),{show:o(w),imgs:o(Y),onSuccess:h,onClose:Z,onFail:Q},null,8,["show","imgs"])]))}}),Oe=ve(Re,[["__scopeId","data-v-56d7e478"]]);export{Oe as default};
