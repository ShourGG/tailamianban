import{k as re,r as v,c as B,o as ie,_,R as r,U as l,S as p,K as i,Q as h,V as u,F as z,N as E,Y as d,$,aF as U,j as w,I as ce}from"./vue-vendor-Bom1XEVO.js";import{g as ue,c as pe}from"./index-C2dfl6FL.js";import{aA as de,ai as fe,ae as me,R as _e,aB as he,ag as ve,ap as ge,U as ye,a2 as ke,P as Fe,L as Se}from"./ui-vendor-D9aA433m.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./spline-vendor-C3Tmx0e7.js";import"./charts-vendor-PiKWrtPe.js";import"./editor-vendor-CufumsHQ.js";const Ie={key:1,class:"input-history"},Ne=["onClick"],Le={class:"history-text"},we={key:0,class:"history-footer"},xe=["onClick"],Ce={class:"form-search-item-box"},He={class:"form-item-input"},Be=re({__name:"index",props:{bordered:{type:Boolean,default:!0},formItemList:{default:()=>[]},formParams:{},formSearchInputHistoryString:{},size:{default:"medium"}},emits:["search","reset","change-params"],setup(F,{expose:A,emit:M}){const f=F,S=M,P=de(),b=v(null),c=v([...f.formItemList]),t=v({...f.formParams}),g=v(!1),V=v(!1),D=B(()=>c.value.filter(e=>e.show!==!1)),j=B(()=>c.value.length>7),y=e=>{c.value.forEach(o=>{o.isFocus=o.hisList&&o.prop===e})},O=e=>{const o=ue(f.formSearchInputHistoryString);o&&(c.value=o),y(e)},R=(e,o)=>{t.value[o]=e,y()},I=e=>c.value.find(o=>o.prop===e),k=()=>{f.formSearchInputHistoryString&&pe(f.formSearchInputHistoryString,c.value)},T=(e,o)=>{const n=I(e);n?.hisList&&(n.hisList.splice(o,1),n.hisList.length===0&&(n.isFocus=!1),k())},K=e=>{const o=I(e);o?.hisList&&(o.hisList=[],o.isFocus=!1,k())},Q=()=>{setTimeout(()=>y(),200)},Y=(e,o)=>{const n=e.indexOf(o);return n>-1&&e.splice(n,1),e.unshift(o),e.length>5?e.slice(0,5):e},q=e=>{const o=I(e);if(!o?.hisList)return;o.isFocus=!0;const n=t.value[e];if(n&&n.toString().trim()){const m=n.toString().trim();o.hisList=Y(o.hisList,m)}c.value.forEach(m=>{m.prop!==e&&(m.isFocus=!1)})},G=e=>e===void 0||e===""||e===null||Array.isArray(e)&&e.length===0,J=()=>{Object.keys(t.value).forEach(e=>{t.value[e]&&q(e)}),y(),k()},x=()=>{Object.entries(t.value).filter(([o])=>o!=="pageNum"&&o!=="pageSize").some(([o,n])=>o.includes("Time")&&Array.isArray(n)?n[0]:!G(n))?(f.formSearchInputHistoryString&&J(),S("search",t.value)):P.warning("请输入搜索内容，或选择筛选条件")},C=()=>{b.value?.restoreValidation(),Object.keys(t.value).forEach(e=>{e!=="pageNum"&&e!=="pageSize"&&(t.value[e]=null)}),S("change-params",t.value),S("reset")},H=()=>{g.value=!g.value,c.value.forEach((e,o)=>{o>6&&(e.show=!e.show)}),k()},W=()=>{c.value.forEach((e,o)=>{e.isFocus=!1,o>6&&e.show===void 0&&(e.show=!1),e.type==="select"&&(e.placeholder||(e.placeholder="请选择"),t.value[e.prop]===void 0&&(t.value[e.prop]=null))})};return ie(()=>{W()}),A({formRef:b,formParams:t,searchFn:x,cleanFn:C,changeFoldState:H}),(e,o)=>{const n=_e,m=he,X=ve,Z=ge,ee=me,N=Fe,L=ke,oe=ye,se=fe,te=Se;return r(),_(te,{class:"form-search-card custom-card",bordered:F.bordered},{default:l(()=>[p(se,{class:"form-search",model:i(t),ref_key:"formRef",ref:b,size:F.size},{default:l(()=>[(r(!0),h(z,null,E(i(D),(s,ae)=>(r(),h("div",{class:"form-search-item-box",key:ae},[s.type!=="%"?(r(),_(ee,{key:0,class:"form-item-input",path:s.prop,"show-feedback":!1,"show-label":!1},{default:l(()=>[s.type==="input"?(r(),_(n,{key:0,clearable:"",value:i(t)[s.prop],"onUpdate:value":a=>i(t)[s.prop]=a,placeholder:s.placeholder,onFocus:a=>O(s.prop),onBlur:Q},null,8,["value","onUpdate:value","placeholder","onFocus"])):d("",!0),s.isFocus?(r(),h("div",Ie,[(r(!0),h(z,null,E(s.hisList,(a,ne)=>(r(),h("div",{class:"history-item",onClick:le=>R(a,s.prop),key:a},[u("span",Le,$(a),1),p(m,{class:"delete-icon",size:"14",onClick:U(le=>T(s.prop,ne),["stop"])},{default:l(()=>[...o[1]||(o[1]=[u("div",{class:"i-mdi:close"},null,-1)])]),_:1},8,["onClick"])],8,Ne))),128)),s.hisList&&s.hisList.length>0?(r(),h("div",we,[u("span",{class:"clear-all",onClick:U(a=>K(s.prop),["stop"])}," 清空历史记录 ",8,xe)])):d("",!0)])):d("",!0),s.type==="select"?(r(),_(X,{key:2,value:i(t)[s.prop],"onUpdate:value":a=>i(t)[s.prop]=a,placeholder:s.placeholder||"请选择",clearable:"",options:s.list?.map(a=>({label:a.label||a.labelDefault,value:a.value!==void 0?a.value:a.label||a.labelDefault}))},null,8,["value","onUpdate:value","placeholder","options"])):d("",!0),s.type==="date-range"?(r(),_(Z,{key:3,type:"datetimerange",value:i(t)[s.prop],"onUpdate:value":a=>i(t)[s.prop]=a,format:"yyyy-MM-dd HH:mm","value-format":"yyyy-MM-dd HH:mm","start-placeholder":"开始时间","end-placeholder":"结束时间",clearable:""},null,8,["value","onUpdate:value"])):d("",!0)]),_:2},1032,["path"])):d("",!0)]))),128)),u("div",Ce,[u("div",He,[o[6]||(o[6]=u("div",{class:"button-label-placeholder"},null,-1)),p(oe,null,{default:l(()=>[p(L,{trigger:"hover"},{trigger:l(()=>[p(N,{type:"primary",onClick:x,loading:i(V)},{icon:l(()=>[...o[2]||(o[2]=[u("div",{class:"i-mdi:search w-4 h-4"},null,-1)])]),_:1},8,["loading"])]),default:l(()=>[o[3]||(o[3]=w(" 搜索 ",-1))]),_:1}),p(L,{trigger:"hover"},{trigger:l(()=>[p(N,{onClick:o[0]||(o[0]=s=>C())},{icon:l(()=>[...o[4]||(o[4]=[u("div",{class:"i-mdi:refresh w-4 h-4"},null,-1)])]),_:1})]),default:l(()=>[o[5]||(o[5]=w(" 重置 ",-1))]),_:1}),i(j)?(r(),_(L,{key:0,trigger:"hover"},{trigger:l(()=>[p(N,{onClick:H},{icon:l(()=>[u("div",{class:ce(i(g)?"i-mdi:chevron-up w-4 h-4":"i-mdi:chevron-down w-4 h-4")},null,2)]),_:1})]),default:l(()=>[w(" "+$(i(g)?"收起":"展开"),1)]),_:1})):d("",!0)]),_:1})])])]),_:1},8,["model","size"])]),_:1},8,["bordered"])}}}),Ve=be(Be,[["__scopeId","data-v-63fe2683"]]);export{Ve as default};
