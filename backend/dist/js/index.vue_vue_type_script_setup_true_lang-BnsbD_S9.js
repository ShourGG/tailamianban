import Ee from"./index-ikUMOiiF.js";import{ae as M,au as Pe,av as Ae,aw as Te,ap as D,ax as ke,H as Ve,I as Fe,V as Oe,R as U,U as T,K as Ne,J as Be,ah as Ie,ay as Le,ag as Me,P as x,az as De,ai as Ue}from"./ui-vendor-D9aA433m.js";import{k as xe,r as qe,e as q,c as m,m as d,g as ze,n as je,o as Ge,w as k,t as We,a1 as Ke,_ as z,U as h,S as $,Y as Ye,K as p,R as j,q as Ze,j as G,s as He}from"./vue-vendor-Bom1XEVO.js";const y={MOBILE:/^(?:(?:\+|00)86)?1[3-9]\d{9}$/,ID_CARD:/^\d{15}$|^\d{18}$|^\d{17}[\dXx]$/,EMAIL:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,USERNAME:/^[a-zA-Z0-9_]{3,20}$/,PASSWORD:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{6,20}$/,URL:/^https?:\/\/.+/,IP:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/};function c(t="blur",a,l){return{trigger:t,validator:async(s,r)=>{if(!a(r))throw new Error(l)},message:l}}function Xe(t="blur",a,l){return{trigger:t,validator:async(s,r)=>{if(!await a(r))throw new Error(l)},message:l}}const g={required:(t,a=["blur","input"])=>c(a,l=>l==null?!1:typeof l=="string"?l.trim()!=="":Array.isArray(l)?l.length>0:typeof l=="object"?Object.keys(l).length>0:!!l,`${t}不能为空`),length:(t,a,l)=>c("blur",s=>{if(!s)return!0;const r=String(s).length;return l!==void 0?r>=a&&r<=l:r>=a},l?`${t}长度需在${a}-${l}位之间`:`${t}长度至少${a}位`),range:(t,a,l)=>c("blur",s=>{if(!s&&s!==0)return!0;const r=Number(s);return isNaN(r)?!1:r>=a&&r<=l},`${t}必须在${a}-${l}之间`),mobile:(t="手机号")=>c("blur",a=>!a||y.MOBILE.test(a),`${t}格式错误`),idCard:(t="身份证号")=>c("blur",a=>!a||y.ID_CARD.test(a),`${t}格式错误`),email:(t="邮箱")=>c("blur",a=>!a||y.EMAIL.test(a),`${t}格式错误`),username:(t="用户名")=>c("blur",a=>!a||y.USERNAME.test(a),`${t}只能包含字母、数字、下划线，长度3-20位`),strongPassword:(t="密码")=>c("blur",a=>!a||y.PASSWORD.test(a),`${t}必须包含大小写字母和数字，长度6-20位`),url:(t="链接")=>c("blur",a=>!a||y.URL.test(a),`${t}格式错误`),ip:(t="IP地址")=>c("blur",a=>!a||y.IP.test(a),`${t}格式错误`),confirmPassword:(t,a)=>c("blur",l=>!l||l===a(),`${t}不一致`),pattern:(t,a,l)=>c("blur",s=>!s||a.test(s),l||`${t}格式错误`),asyncCheck:(t,a,l)=>Xe("blur",a,l||`${t}验证失败`)};function Je(t){return t.length<=1?t:[{trigger:["blur","input"],validator:async(a,l)=>{for(const s of t)try{await s.validator?.(s,l,()=>{},{},{})}catch(r){throw r}}}]}const nt={username:(t="用户名")=>[g.required(t),g.username(t)],password:(t="密码")=>[g.required(t),g.strongPassword(t)],email:(t="邮箱")=>[g.required(t),g.email(t)],mobile:(t="手机号")=>[g.required(t),g.mobile(t)],confirmPassword:(t,a)=>[g.required(t),g.confirmPassword(t,a)]},at=xe({__name:"index",props:{options:{},modelValue:{},layoutType:{default:"default"},layoutConfig:{default:()=>({})},validateOnValueChange:{type:Boolean,default:!1},labelPlacement:{default:"left"},labelWidth:{default:"auto"},showRequireMark:{type:Boolean},size:{default:"medium"},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},showDefaultActions:{type:Boolean,default:!0}},emits:["submit","update:modelValue","validate-success","validate-error","fields-change","editor-mounted","on-preview","on-remove","before-remove","on-exceed","on-success","tab-change","step-change","step-before-change","step-validate","field-add","field-remove","field-toggle","fields-clear","render-mode-change","group-toggle","group-reset"],setup(t,{expose:a,emit:l}){const s=t,r=l,i=qe(null),u=q({}),b=q({}),V={default:"Default",inline:"Inline",grid:"Grid",card:"Card",tabs:"Tabs",steps:"Steps",dynamic:"Dynamic",custom:"Custom"},W={input:U,textarea:U,inputNumber:Oe,switch:Fe,slider:Ve,rate:ke,datePicker:D,daterange:D,timePicker:Te,cascader:Ae,colorPicker:Pe},K=["select","checkbox","radio","upload","editor"],Y={input:"",textarea:"",editor:"",select:null,datePicker:null,daterange:null,timePicker:null,cascader:null,colorPicker:null,checkbox:null,upload:[],radio:"",inputNumber:null,slider:null,rate:null,switch:null},Z=["steps","custom"],H=m(()=>V[s.layoutType]||V.default),X=m(()=>({type:s.layoutType,...s.layoutConfig})),S=m(()=>!(s.showDefaultActions===!1||Z.includes(s.layoutType))),F=m(()=>s.options.filter(e=>e.show!==!1)),J=m(()=>F.value.map(e=>d(M,{label:e.label,path:e.prop,key:e.prop,required:!!e.rules?.length},{default:()=>Q(e)}))),Q=e=>{try{if(K.includes(e.type))return ee(e);const n=W[e.type];return n?d(n,{...O(e),...e.attrs}):null}catch{return null}},ee=e=>{const n=O(e);switch(e.type){case"select":return d(Me,{...n,options:e.children?.map(o=>({value:o.value,label:o.label,disabled:o.disabled}))||[],...e.attrs});case"checkbox":return d(Le,{...n,...e.attrs},{default:()=>d(T,{},{default:()=>e.children?.map(o=>d(Ie,{value:o.value,label:o.label,disabled:o.disabled,key:String(o.value)}))||[]})});case"radio":return d(Be,{...n,...e.attrs},{default:()=>d(T,{},{default:()=>e.children?.map(o=>d(Ne,{value:o.value,disabled:o.disabled,key:String(o.value)},{default:()=>o.label}))||[]})});case"upload":return ne(e);case"editor":return te(e);default:return null}},te=e=>d(Ee,{editorId:`editor-${e.prop}`,modelValue:u[e.prop]||"",placeholder:e.placeholder,disabled:s.disabled,readonly:s.readonly,"onUpdate:modelValue":n=>{u[e.prop]=n,R(e.prop)},"onEditor-mounted":n=>{r("editor-mounted",{editor:n,prop:e.prop,html:u[e.prop]||""})},...e.attrs}),ne=e=>{const n=ze();return d(De,{fileList:u[e.prop]||[],"onUpdate:fileList":o=>{u[e.prop]=o,R(e.prop)},onPreview:o=>r("on-preview",o),onRemove:o=>r("on-remove",o),onBeforeRemove:o=>r("before-remove",o),onExceed:o=>r("on-exceed",o),onSuccess:o=>r("on-success",o),...e.attrs},{trigger:()=>n?.slots.uploadClick?.()||d(x,{type:"primary"},{default:()=>"选择文件"}),tip:()=>n?.slots.uploadTip?.()||null})},O=e=>{const n={value:u[e.prop],"onUpdate:value":o=>{u[e.prop]=o,R(e.prop)}};return e.type==="textarea"&&(n.type="textarea"),e.placeholder&&(n.placeholder=e.placeholder),n},N=e=>Y[e]??null,R=e=>{s.validateOnValueChange&&je(()=>{_(e).catch(()=>{})})},E=()=>{try{Object.keys(b).forEach(e=>delete b[e]),s.options.forEach(e=>{u[e.prop]=e.value!==void 0?e.value:N(e.type),e.rules?.length&&(b[e.prop]=Je(e.rules))})}catch{}},C=async()=>{if(!i.value)throw new Error("[C_Form] 表单引用不存在");try{await i.value.validate(),r("validate-success",w())}catch(e){throw r("validate-error",e),e}},_=async e=>{if(!i.value)throw new Error("[C_Form] 表单引用不存在");const n=Array.isArray(e)?e:[e];await i.value.validate(n)},P=e=>{i.value&&(e?(Array.isArray(e)?e:[e]).forEach(o=>{if(u[o]!==void 0){const f=u[o];u[o]=f}}):i.value.restoreValidation())},v=async(e,n)=>{try{const o=s.options.filter(e).map(f=>f.prop);return o.length===0||await _(o),!0}catch{return!1}},ae=async e=>{const n=s.layoutConfig?.steps?.steps?.[e]?.key;return n?v(o=>o.layout?.step===n):!0},oe=async e=>v(n=>n.layout?.tab===e),re=async()=>v(e=>!!e.layout?.dynamic),le=async e=>v(n=>n.layout?.group===e),se=e=>{r("fields-change",e)},ue=e=>r("tab-change",e),de=(e,n)=>r("step-change",e,n),ce=async(e,n)=>(r("step-before-change",e,n),!0),ie=async e=>{try{const n=s.layoutConfig?.steps?.steps?.[e]?.key;if(!n)return!0;const o=s.options.filter(f=>f.layout?.step===n).map(f=>f.prop);return o.length===0||(await _(o),r("step-validate",e)),!0}catch{return!1}},pe=e=>r("field-add",e),fe=e=>r("field-remove",e),ge=(e,n)=>r("field-toggle",e,n),ye=()=>r("fields-clear"),_e=e=>r("render-mode-change",e),me=(e,n)=>r("group-toggle",e,n),he=e=>r("group-reset",e),be=async()=>{try{await C(),r("submit",{model:w(),form:i.value})}catch{}},B=()=>{try{P(),s.options.forEach(e=>{const n=e.value!==void 0?e.value:N(e.type);u[e.prop]=n})}catch{}},I=()=>B(),L=e=>{Object.assign(u,e)},w=()=>({...u}),Ce=async(e,n,o=!1)=>{u[e]=n,o&&await _(e)},ve=e=>u[e],we=async(e,n=!1)=>{Object.assign(u,e),n&&await C()};return Ge(()=>{E(),k(()=>s.options,()=>E(),{deep:!0}),k(()=>s.modelValue,e=>{e&&Object.assign(u,e)},{immediate:!0,deep:!0}),k(u,e=>r("update:modelValue",{...e}),{deep:!0})}),a({validate:C,validateField:_,validateStep:ae,validateTab:oe,validateDynamicFields:re,validateCustomGroup:le,clearValidation:P,getModel:w,setFields:L,resetFields:I,setFieldValue:Ce,getFieldValue:ve,setFieldsValue:we,formRef:i,formModel:u,initialize:E,layoutType:We(s,"layoutType"),shouldShowDefaultActions:S}),(e,n)=>{const o=Ke("DynamicComponent"),f=x,$e=T,Se=M,Re=Ue;return j(),z(Re,He({ref_key:"formRef",ref:i,model:p(u),rules:p(b),"validate-on-rule-change":!1,"label-placement":t.labelPlacement,"label-width":t.labelWidth,size:t.size,disabled:t.disabled,readonly:t.readonly},e.$attrs),{default:h(()=>[$(o,{name:p(H),"form-items":p(J),"layout-config":p(X),options:p(F),"form-data":p(u),"show-default-actions":p(S),onTabChange:ue,onStepChange:de,onStepBeforeChange:ce,onStepValidate:ie,onFieldAdd:pe,onFieldRemove:fe,onFieldToggle:ge,onFieldsClear:ye,onRenderModeChange:_e,onGroupToggle:me,onGroupReset:he,onValidateSuccess:n[0]||(n[0]=A=>r("validate-success",A)),onValidateError:n[1]||(n[1]=A=>r("validate-error",A)),onFieldsChange:se},null,8,["name","form-items","layout-config","options","form-data","show-default-actions"]),p(S)?(j(),z(Se,{key:0,class:"mt-5"},{default:h(()=>[Ze(e.$slots,"action",{form:p(i),model:p(u),validate:C,validateField:_,reset:I,setFields:L,getModel:w,clearValidation:P},()=>[$($e,null,{default:h(()=>[$(f,{type:"primary",onClick:be},{default:h(()=>[...n[2]||(n[2]=[G("提交",-1)])]),_:1}),$(f,{onClick:B},{default:h(()=>[...n[3]||(n[3]=[G("重置",-1)])]),_:1})]),_:1})])]),_:3})):Ye("",!0)]),_:3},16,["model","rules","label-placement","label-width","size","disabled","readonly"])}}});export{g as P,nt as R,at as _};
