import Ee from"./index-C3XsA_P_.js";import{ae as M,au as Pe,av as Ae,aw as Fe,ap as U,ax as Te,H as ke,I as Ve,V as Ne,R as D,U as F,K as Oe,J as Ie,ah as Be,ay as Le,ag as Me,P as x,az as Ue,ai as De}from"./ui-vendor-lRdd6BJd.js";import{k as xe,r as qe,e as q,c as _,m as d,g as ze,n as je,o as Ge,w as T,t as We,a1 as Ke,_ as z,U as h,S as $,Y as Ye,K as p,R as j,q as Ze,j as G,s as He}from"./vue-vendor-Bom1XEVO.js";const y={MOBILE:/^(?:(?:\+|00)86)?1[3-9]\d{9}$/,ID_CARD:/^\d{15}$|^\d{18}$|^\d{17}[\dXx]$/,EMAIL:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,USERNAME:/^[a-zA-Z0-9_]{3,20}$/,PASSWORD:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{6,20}$/,URL:/^https?:\/\/.+/,IP:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/};function c(t="blur",o,l){return{trigger:t,validator:async(s,r)=>{if(!o(r))throw new Error(l)},message:l}}function Xe(t="blur",o,l){return{trigger:t,validator:async(s,r)=>{if(!await o(r))throw new Error(l)},message:l}}const g={required:(t,o=["blur","input"])=>c(o,l=>l==null?!1:typeof l=="string"?l.trim()!=="":Array.isArray(l)?l.length>0:typeof l=="object"?Object.keys(l).length>0:!!l,`${t}不能为空`),length:(t,o,l)=>c("blur",s=>{if(!s)return!0;const r=String(s).length;return l!==void 0?r>=o&&r<=l:r>=o},l?`${t}长度需在${o}-${l}位之间`:`${t}长度至少${o}位`),range:(t,o,l)=>c("blur",s=>{if(!s&&s!==0)return!0;const r=Number(s);return isNaN(r)?!1:r>=o&&r<=l},`${t}必须在${o}-${l}之间`),mobile:(t="手机号")=>c("blur",o=>!o||y.MOBILE.test(o),`${t}格式错误`),idCard:(t="身份证号")=>c("blur",o=>!o||y.ID_CARD.test(o),`${t}格式错误`),email:(t="邮箱")=>c("blur",o=>!o||y.EMAIL.test(o),`${t}格式错误`),username:(t="用户名")=>c("blur",o=>!o||y.USERNAME.test(o),`${t}只能包含字母、数字、下划线，长度3-20位`),strongPassword:(t="密码")=>c("blur",o=>!o||y.PASSWORD.test(o),`${t}必须包含大小写字母和数字，长度6-20位`),url:(t="链接")=>c("blur",o=>!o||y.URL.test(o),`${t}格式错误`),ip:(t="IP地址")=>c("blur",o=>!o||y.IP.test(o),`${t}格式错误`),confirmPassword:(t,o)=>c("blur",l=>!l||l===o(),`${t}不一致`),pattern:(t,o,l)=>c("blur",s=>!s||o.test(s),l||`${t}格式错误`),asyncCheck:(t,o,l)=>Xe("blur",o,l||`${t}验证失败`)};function Je(t){return t.length<=1?t:[{trigger:["blur","input"],validator:async(o,l)=>{for(const s of t)try{await s.validator?.(s,l,()=>{},{},{})}catch(r){throw r}}}]}const at={username:(t="用户名")=>[g.required(t),g.username(t)],password:(t="密码")=>[g.required(t),g.strongPassword(t)],email:(t="邮箱")=>[g.required(t),g.email(t)],mobile:(t="手机号")=>[g.required(t),g.mobile(t)],confirmPassword:(t,o)=>[g.required(t),g.confirmPassword(t,o)]},ot=xe({__name:"index",props:{options:{},modelValue:{},layoutType:{default:"default"},layoutConfig:{default:()=>({})},validateOnValueChange:{type:Boolean,default:!1},labelPlacement:{default:"left"},labelWidth:{default:"auto"},showRequireMark:{type:Boolean},size:{default:"medium"},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},showDefaultActions:{type:Boolean,default:!0}},emits:["submit","update:modelValue","validate-success","validate-error","fields-change","editor-mounted","on-preview","on-remove","before-remove","on-exceed","on-success","tab-change","step-change","step-before-change","step-validate","field-add","field-remove","field-toggle","fields-clear","render-mode-change","group-toggle","group-reset"],setup(t,{expose:o,emit:l}){const s=t,r=l,i=qe(null),u=q({}),b=q({}),k={default:"Default",inline:"Inline",grid:"Grid",card:"Card",tabs:"Tabs",steps:"Steps",dynamic:"Dynamic",custom:"Custom"},W={input:D,textarea:D,inputNumber:Ne,switch:Ve,slider:ke,rate:Te,datePicker:U,daterange:U,timePicker:Fe,cascader:Ae,colorPicker:Pe},K=["select","checkbox","radio","upload","editor"],Y={input:"",textarea:"",editor:"",select:null,datePicker:null,daterange:null,timePicker:null,cascader:null,colorPicker:null,checkbox:null,upload:[],radio:"",inputNumber:null,slider:null,rate:null,switch:null},Z=["steps","custom"],H=_(()=>k[s.layoutType]||k.default),X=_(()=>({type:s.layoutType,...s.layoutConfig})),S=_(()=>!(s.showDefaultActions===!1||Z.includes(s.layoutType))),V=_(()=>s.options.filter(e=>e.show!==!1)),J=_(()=>V.value.map(e=>d(M,{label:e.label,path:e.prop,key:e.prop,required:!!e.rules?.length},{default:()=>Q(e)}))),Q=e=>{try{if(K.includes(e.type))return ee(e);const a=W[e.type];return a?d(a,{...N(e),...e.attrs}):null}catch{return null}},ee=e=>{const a=N(e);switch(e.type){case"select":return d(Me,{...a,options:e.children?.map(n=>({value:n.value,label:n.label,disabled:n.disabled}))||[],...e.attrs});case"checkbox":return d(Le,{...a,...e.attrs},{default:()=>d(F,{},{default:()=>e.children?.map(n=>d(Be,{value:n.value,label:n.label,disabled:n.disabled,key:String(n.value)}))||[]})});case"radio":return d(Ie,{...a,...e.attrs},{default:()=>d(F,{},{default:()=>e.children?.map(n=>d(Oe,{value:n.value,disabled:n.disabled,key:String(n.value)},{default:()=>n.label}))||[]})});case"upload":return ae(e);case"editor":return te(e);default:return null}},te=e=>d(Ee,{editorId:`editor-${e.prop}`,modelValue:u[e.prop]||"",placeholder:e.placeholder,disabled:s.disabled,readonly:s.readonly,"onUpdate:modelValue":a=>{u[e.prop]=a,R(e.prop)},"onEditor-mounted":a=>{r("editor-mounted",{editor:a,prop:e.prop,html:u[e.prop]||""})},...e.attrs}),ae=e=>{const a=ze();return d(Ue,{fileList:u[e.prop]||[],"onUpdate:fileList":n=>{u[e.prop]=n,R(e.prop)},onPreview:n=>r("on-preview",n),onRemove:n=>r("on-remove",n),onBeforeRemove:n=>r("before-remove",n),onExceed:n=>r("on-exceed",n),onSuccess:n=>r("on-success",n),...e.attrs},{trigger:()=>a?.slots.uploadClick?.()||d(x,{type:"primary"},{default:()=>"选择文件"}),tip:()=>a?.slots.uploadTip?.()||null})},N=e=>{const a={value:u[e.prop],"onUpdate:value":n=>{u[e.prop]=n,R(e.prop)}};return e.type==="textarea"&&(a.type="textarea"),e.placeholder&&(a.placeholder=e.placeholder),a},O=e=>Y[e]??null,R=e=>{s.validateOnValueChange&&je(()=>{m(e).catch(()=>{})})},E=()=>{try{Object.keys(b).forEach(e=>delete b[e]),s.options.forEach(e=>{u[e.prop]=e.value!==void 0?e.value:O(e.type),e.rules?.length&&(b[e.prop]=Je(e.rules))})}catch{}},C=async()=>{if(!i.value)throw new Error("[C_Form] 表单引用不存在");try{await i.value.validate(),r("validate-success",w())}catch(e){throw r("validate-error",e),e}},m=async e=>{if(!i.value)throw new Error("[C_Form] 表单引用不存在");const a=Array.isArray(e)?e:[e];await i.value.validate(a)},P=e=>{i.value&&(e?(Array.isArray(e)?e:[e]).forEach(n=>{if(u[n]!==void 0){const f=u[n];u[n]=f}}):i.value.restoreValidation())},v=async(e,a)=>{try{const n=s.options.filter(e).map(f=>f.prop);return n.length===0||await m(n),!0}catch{return!1}},oe=async e=>{const a=s.layoutConfig?.steps?.steps?.[e]?.key;return a?v(n=>n.layout?.step===a):!0},ne=async e=>v(a=>a.layout?.tab===e),re=async()=>v(e=>!!e.layout?.dynamic),le=async e=>v(a=>a.layout?.group===e),se=e=>{r("fields-change",e)},ue=e=>r("tab-change",e),de=(e,a)=>r("step-change",e,a),ce=async(e,a)=>(r("step-before-change",e,a),!0),ie=async e=>{try{const a=s.layoutConfig?.steps?.steps?.[e]?.key;if(!a)return!0;const n=s.options.filter(f=>f.layout?.step===a).map(f=>f.prop);return n.length===0||(await m(n),r("step-validate",e)),!0}catch{return!1}},pe=e=>r("field-add",e),fe=e=>r("field-remove",e),ge=(e,a)=>r("field-toggle",e,a),ye=()=>r("fields-clear"),me=e=>r("render-mode-change",e),_e=(e,a)=>r("group-toggle",e,a),he=e=>r("group-reset",e),be=async()=>{try{await C(),r("submit",{model:w(),form:i.value})}catch{}},I=()=>{try{P(),s.options.forEach(e=>{const a=e.value!==void 0?e.value:O(e.type);u[e.prop]=a})}catch{}},B=()=>I(),L=e=>{Object.assign(u,e)},w=()=>({...u}),Ce=async(e,a,n=!1)=>{u[e]=a,n&&await m(e)},ve=e=>u[e],we=async(e,a=!1)=>{Object.assign(u,e),a&&await C()};return Ge(()=>{E(),T(()=>s.options,()=>E(),{deep:!0}),T(()=>s.modelValue,e=>{e&&Object.assign(u,e)},{immediate:!0,deep:!0}),T(u,e=>r("update:modelValue",{...e}),{deep:!0})}),o({validate:C,validateField:m,validateStep:oe,validateTab:ne,validateDynamicFields:re,validateCustomGroup:le,clearValidation:P,getModel:w,setFields:L,resetFields:B,setFieldValue:Ce,getFieldValue:ve,setFieldsValue:we,formRef:i,formModel:u,initialize:E,layoutType:We(s,"layoutType"),shouldShowDefaultActions:S}),(e,a)=>{const n=Ke("DynamicComponent"),f=x,$e=F,Se=M,Re=De;return j(),z(Re,He({ref_key:"formRef",ref:i,model:p(u),rules:p(b),"validate-on-rule-change":!1,"label-placement":t.labelPlacement,"label-width":t.labelWidth,size:t.size,disabled:t.disabled,readonly:t.readonly},e.$attrs),{default:h(()=>[$(n,{name:p(H),"form-items":p(J),"layout-config":p(X),options:p(V),"form-data":p(u),"show-default-actions":p(S),onTabChange:ue,onStepChange:de,onStepBeforeChange:ce,onStepValidate:ie,onFieldAdd:pe,onFieldRemove:fe,onFieldToggle:ge,onFieldsClear:ye,onRenderModeChange:me,onGroupToggle:_e,onGroupReset:he,onValidateSuccess:a[0]||(a[0]=A=>r("validate-success",A)),onValidateError:a[1]||(a[1]=A=>r("validate-error",A)),onFieldsChange:se},null,8,["name","form-items","layout-config","options","form-data","show-default-actions"]),p(S)?(j(),z(Se,{key:0,class:"mt-5"},{default:h(()=>[Ze(e.$slots,"action",{form:p(i),model:p(u),validate:C,validateField:m,reset:B,setFields:L,getModel:w,clearValidation:P},()=>[$($e,null,{default:h(()=>[$(f,{type:"primary",onClick:be},{default:h(()=>[...a[2]||(a[2]=[G("提交",-1)])]),_:1}),$(f,{onClick:I},{default:h(()=>[...a[3]||(a[3]=[G("重置",-1)])]),_:1})]),_:1})])]),_:3})):Ye("",!0)]),_:3},16,["model","rules","label-placement","label-width","size","disabled","readonly"])}}});export{g as P,at as R,ot as _};
