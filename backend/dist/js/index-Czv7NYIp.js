import{I as c}from"./iconify-W0kOH8CK.js";import{h as P,u as R,i as T,j as $,k as V}from"./terraria-QiQpNcT3.js";import{aA as j,U as h,P as d,L as x,aF as K,ai as Q,ae as k,az as q,a$ as E,as as G,b1 as J,R as A,ao as H,S as O,aI as X}from"./ui-vendor-lRdd6BJd.js";import{k as Y,r as u,o as Z,Q as ee,R as ae,V as v,S as t,j as n,K as l,U as s,m as p}from"./vue-vendor-Bom1XEVO.js";import{_ as te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CkMMG6vV.js";import"./spline-vendor-Cs6wJgUK.js";import"./charts-vendor-CvHUaZlk.js";import"./editor-vendor-D83MfH0r.js";const le={class:"page-container"},se={class:"page-header"},oe={class:"page-title"},ie={style:{"margin-bottom":"12px"}},re=Y({name:"TerrariaWorldManage",__name:"index",setup(ne){const i=j(),g=u(!1),y=u(!1),m=u(!1),N=u([]),w=u(),_=u([]),r=u({name:"",description:""}),C={file:{required:!0,message:"请选择世界文件",trigger:"change"}},F={pageSize:10,showSizePicker:!0,pageSizes:[10,20,50],showQuickJumper:!0},U=[{title:"世界名称",key:"name",width:200,render:a=>p("span",{style:"font-weight: 600"},a.name)},{title:"文件名",key:"fileName",width:200},{title:"状态",key:"isActive",width:100,render:a=>p(O,{type:a.isActive?"success":"default",size:"small"},()=>a.isActive?"使用中":"未使用")},{title:"文件大小",key:"size",width:120,render:a=>D(a.size)},{title:"创建时间",key:"createdAt",width:180,render:a=>I(a.createdAt)},{title:"描述",key:"description",ellipsis:{tooltip:!0}},{title:"操作",key:"actions",width:280,render:a=>p(h,{size:"small"},()=>[p(d,{size:"small",type:"primary",ghost:!0,onClick:()=>L(a.fileName)},()=>"下载"),p(d,{size:"small",type:"info",ghost:!0,onClick:()=>M(a.fileName),disabled:a.isActive},()=>"备份"),p(X,{onPositiveClick:()=>S(a.fileName)},{trigger:()=>p(d,{size:"small",type:"error",ghost:!0,disabled:a.isActive},()=>"删除"),default:()=>"确定要删除这个世界文件吗？此操作不可恢复！"})])}],f=async()=>{g.value=!0;try{const a=await P();a.code==="0"?N.value=a.data||[]:i.error(a.message||"获取世界列表失败")}catch{i.error("获取世界列表失败")}finally{g.value=!1}},b=a=>{if(a.fileList.length>0){const e=a.fileList[0].file;if(e&&(r.value.file=e,!r.value.name)){const o=e.name.replace(".wld","");r.value.name=o}}},B=async()=>{if(w.value)try{if(await w.value.validate(),!r.value.file){i.error("请选择世界文件");return}y.value=!0;const a=await R(r.value.file,{name:r.value.name,description:r.value.description});a.code==="0"?(i.success("世界文件上传成功"),m.value=!1,W(),await f()):i.error(a.message||"上传失败")}catch{i.error("上传世界文件失败")}finally{y.value=!1}},L=a=>{try{T(a),i.success("开始下载世界文件")}catch{i.error("下载世界文件失败")}},M=async a=>{try{const e=await $(a);e.code==="0"?(i.success("世界备份创建成功"),await f()):i.error(e.message||"备份失败")}catch{i.error("备份世界文件失败")}},S=async a=>{try{const e=await V(a);e.code==="0"?(i.success("世界文件删除成功"),await f()):i.error(e.message||"删除失败")}catch{i.error("删除世界文件失败")}},W=()=>{r.value={name:"",description:""},_.value=[]},D=a=>{if(a===0)return"0 B";const e=1024,o=["B","KB","MB","GB"],z=Math.floor(Math.log(a)/Math.log(e));return parseFloat((a/Math.pow(e,z)).toFixed(2))+" "+o[z]},I=a=>new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return Z(()=>{f()}),(a,e)=>(ae(),ee("div",le,[v("div",se,[v("h2",oe,[t(l(c),{icon:"mdi:earth",class:"title-icon"}),e[6]||(e[6]=n(" 世界管理 ",-1))]),e[7]||(e[7]=v("p",{class:"page-desc"},"管理泰拉瑞亚世界文件，支持上传、下载、备份和删除",-1))]),t(l(x),{class:"action-card",bordered:!1},{default:s(()=>[t(l(h),null,{default:s(()=>[t(l(d),{type:"primary",onClick:e[0]||(e[0]=o=>m.value=!0)},{icon:s(()=>[t(l(c),{icon:"mdi:upload"})]),default:s(()=>[e[8]||(e[8]=n(" 上传世界 ",-1))]),_:1}),t(l(d),{onClick:f,loading:g.value},{icon:s(()=>[t(l(c),{icon:"mdi:refresh"})]),default:s(()=>[e[9]||(e[9]=n(" 刷新列表 ",-1))]),_:1},8,["loading"])]),_:1})]),_:1}),t(l(x),{title:"世界文件列表"},{default:s(()=>[t(l(K),{columns:U,data:N.value,loading:g.value,pagination:F,"row-key":o=>o.fileName},null,8,["data","loading","row-key"])]),_:1}),t(l(H),{show:m.value,"onUpdate:show":e[5]||(e[5]=o=>m.value=o),preset:"dialog",title:"上传世界文件"},{header:s(()=>[t(l(c),{icon:"mdi:upload",class:"modal-icon"}),e[10]||(e[10]=n(" 上传世界文件 ",-1))]),action:s(()=>[t(l(h),null,{default:s(()=>[t(l(d),{onClick:e[4]||(e[4]=o=>m.value=!1)},{default:s(()=>[...e[13]||(e[13]=[n("取消",-1)])]),_:1}),t(l(d),{type:"primary",onClick:B,loading:y.value},{default:s(()=>[...e[14]||(e[14]=[n(" 上传 ",-1)])]),_:1},8,["loading"])]),_:1})]),default:s(()=>[t(l(Q),{ref_key:"uploadFormRef",ref:w,model:r.value,rules:C,"label-placement":"left","label-width":"80"},{default:s(()=>[t(l(k),{label:"世界文件",path:"file"},{default:s(()=>[t(l(q),{"file-list":_.value,"onUpdate:fileList":e[1]||(e[1]=o=>_.value=o),max:1,accept:".wld",onChange:b},{default:s(()=>[t(l(E),null,{default:s(()=>[v("div",ie,[t(l(c),{icon:"mdi:file-upload",size:"48",color:"#18a058"})]),t(l(G),{style:{"font-size":"16px"}},{default:s(()=>[...e[11]||(e[11]=[n(" 点击或者拖动文件到该区域来上传 ",-1)])]),_:1}),t(l(J),{depth:"3",style:{margin:"8px 0 0 0"}},{default:s(()=>[...e[12]||(e[12]=[n(" 支持 .wld 格式的泰拉瑞亚世界文件 ",-1)])]),_:1})]),_:1})]),_:1},8,["file-list"])]),_:1}),t(l(k),{label:"世界名称",path:"name"},{default:s(()=>[t(l(A),{value:r.value.name,"onUpdate:value":e[2]||(e[2]=o=>r.value.name=o),placeholder:"可选，留空则使用文件名"},null,8,["value"])]),_:1}),t(l(k),{label:"描述",path:"description"},{default:s(()=>[t(l(A),{value:r.value.description,"onUpdate:value":e[3]||(e[3]=o=>r.value.description=o),type:"textarea",placeholder:"可选，世界文件的描述信息",rows:3},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]))}}),we=te(re,[["__scopeId","data-v-e8a7e07f"]]);export{we as default};
