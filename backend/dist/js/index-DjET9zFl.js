import{I as E}from"./iconify-W0kOH8CK.js";import{k as F,aE as W,r as m,Q as q,R as b,V as g,S as l,j as n,U as t,_ as D,Y as M,$ as z}from"./vue-vendor-Bom1XEVO.js";import{c as G,g as J,a as K}from"./terraria-QiQpNcT3.js";import{aA as L,ai as O,ae as Q,R as Y,U as j,V as H,P as X,S as Z,as as h,ag as ee,J as ae,K as le,I as te,L as oe}from"./ui-vendor-lRdd6BJd.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CkMMG6vV.js";import"./spline-vendor-Cs6wJgUK.js";import"./charts-vendor-CvHUaZlk.js";import"./editor-vendor-D83MfH0r.js";const ne={class:"server-create"},re={class:"page-header"},ue={class:"page-title"},pe=F({name:"ServerCreate",__name:"index",setup(ie){const x=W(),p=L(),f=m(!1),i=m(!1),r=m(null),a=m({name:"",port:7777,maxPlayers:8,world:null,password:"",difficulty:"classic",pvp:!1}),N=[{label:"创建新世界",value:"new"},{label:"MyWorld.wld",value:"MyWorld"},{label:"TestWorld.wld",value:"TestWorld"}],P={name:{required:!0,message:"请输入服务器名称",trigger:"blur"},port:[{required:!0,message:"请输入端口号",trigger:"blur"},{validator:(s,e)=>new Promise((_,d)=>{e<1024||e>65535?d(new Error("端口范围必须在 1024-65535 之间")):r.value&&!r.value.available?d(new Error("该端口已被占用，请选择其他端口")):_()}),trigger:"blur"}],maxPlayers:{required:!0,message:"请输入最大玩家数",trigger:"blur"}},k=async()=>{if(a.value.port){i.value=!0;try{const s=await G(a.value.port);s.code==="0"&&(r.value={available:s.data.available},s.data.available||p.warning(`端口 ${a.value.port} 已被占用，建议选择其他端口`))}catch{r.value=null}finally{i.value=!1}}},C=async()=>{i.value=!0;try{const s=a.value.port||7777,e=await J(s);e.code==="0"&&(a.value.port=e.data.nextPort,r.value={available:!0},p.success(`已自动分配可用端口: ${e.data.nextPort}`))}catch{p.error("获取可用端口失败")}finally{i.value=!1}},$=async()=>{f.value=!0;try{const s={name:a.value.name,port:a.value.port,world:a.value.world||"new",maxPlayers:a.value.maxPlayers,password:a.value.password,difficulty:a.value.difficulty,pvp:a.value.pvp},e=await K(s);e.code==="0"?(p.success("服务器创建成功！"),x.push("/server/list")):p.error(e.message||"创建失败，请重试")}catch{p.error("创建失败，请重试")}finally{f.value=!1}},I=()=>{a.value={name:"",port:7777,maxPlayers:8,world:null,password:"",difficulty:"classic",pvp:!1},r.value=null};return(s,e)=>{const _=E,d=Y,u=Q,y=H,v=X,S=Z,w=j,U=h,A=ee,c=le,B=ae,R=te,V=O,T=oe;return b(),q("div",ne,[g("div",re,[g("h2",ue,[l(_,{icon:"mdi:server-plus",class:"title-icon"}),e[8]||(e[8]=n(" 创建泰拉瑞亚服务器 ",-1))]),e[9]||(e[9]=g("p",{class:"page-desc"},"配置并创建新的泰拉瑞亚服务器实例",-1))]),l(T,{title:"服务器配置",class:"config-card"},{default:t(()=>[l(V,{ref:"formRef",model:a.value,rules:P,"label-placement":"left","label-width":"120px"},{default:t(()=>[l(u,{label:"服务器名称",path:"name"},{default:t(()=>[l(d,{value:a.value.name,"onUpdate:value":e[0]||(e[0]=o=>a.value.name=o),placeholder:"请输入服务器名称"},null,8,["value"])]),_:1}),l(u,{label:"端口",path:"port"},{default:t(()=>[l(w,null,{default:t(()=>[l(y,{value:a.value.port,"onUpdate:value":e[1]||(e[1]=o=>a.value.port=o),min:1024,max:65535,placeholder:"7777",style:{width:"200px"},onBlur:k},null,8,["value"]),l(v,{secondary:"",type:"info",onClick:C,loading:i.value,size:"small"},{default:t(()=>[...e[10]||(e[10]=[n(" 获取可用端口 ",-1)])]),_:1},8,["loading"]),r.value?(b(),D(S,{key:0,type:r.value.available?"success":"error"},{default:t(()=>[n(z(r.value.available?"端口可用":"端口已被占用"),1)]),_:1},8,["type"])):M("",!0)]),_:1}),l(U,{depth:"3",style:{"font-size":"12px","margin-top":"4px",display:"block"}},{default:t(()=>[...e[11]||(e[11]=[n(" 默认端口 7777，范围 1024-65535 ",-1)])]),_:1})]),_:1}),l(u,{label:"最大玩家数",path:"maxPlayers"},{default:t(()=>[l(y,{value:a.value.maxPlayers,"onUpdate:value":e[2]||(e[2]=o=>a.value.maxPlayers=o),min:1,max:255,placeholder:"8"},null,8,["value"])]),_:1}),l(u,{label:"世界文件",path:"world"},{default:t(()=>[l(A,{value:a.value.world,"onUpdate:value":e[3]||(e[3]=o=>a.value.world=o),options:N,placeholder:"选择世界文件"},null,8,["value"])]),_:1}),l(u,{label:"服务器密码",path:"password"},{default:t(()=>[l(d,{value:a.value.password,"onUpdate:value":e[4]||(e[4]=o=>a.value.password=o),type:"password",placeholder:"留空表示无密码"},null,8,["value"])]),_:1}),l(u,{label:"难度模式",path:"difficulty"},{default:t(()=>[l(B,{value:a.value.difficulty,"onUpdate:value":e[5]||(e[5]=o=>a.value.difficulty=o)},{default:t(()=>[l(c,{value:"classic"},{default:t(()=>[...e[12]||(e[12]=[n("经典模式",-1)])]),_:1}),l(c,{value:"expert"},{default:t(()=>[...e[13]||(e[13]=[n("专家模式",-1)])]),_:1}),l(c,{value:"master"},{default:t(()=>[...e[14]||(e[14]=[n("大师模式",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l(u,{label:"PVP模式",path:"pvp"},{default:t(()=>[l(R,{value:a.value.pvp,"onUpdate:value":e[6]||(e[6]=o=>a.value.pvp=o)},null,8,["value"])]),_:1}),l(u,null,{default:t(()=>[l(w,null,{default:t(()=>[l(v,{type:"primary",onClick:$,loading:f.value},{default:t(()=>[...e[15]||(e[15]=[n(" 创建服务器 ",-1)])]),_:1},8,["loading"]),l(v,{onClick:I},{default:t(()=>[...e[16]||(e[16]=[n("重置",-1)])]),_:1}),l(v,{onClick:e[7]||(e[7]=o=>s.$router.go(-1))},{default:t(()=>[...e[17]||(e[17]=[n("返回",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}}),be=se(pe,[["__scopeId","data-v-ff5585aa"]]);export{be as default};
