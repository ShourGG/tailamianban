import{am as O,aG as R,T as X,U as g,aK as x,ag as E,K as v,H as i,S as z,aF as Y,P as F,Q as m,V as q,X as W,Y as I,J as P,a4 as N,M as Z,ay as h,a9 as ee,a7 as le}from"./ui-vendor-C2DiPTQI.js";import{k as ae,r as p,Q as j,R as T,S as a,U as t,K as l,j as o,V as _,m as f,F as te,N as ue,_ as ne,$ as w}from"./vue-vendor-B-HGZVTd.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const oe={class:"backup-page"},ie={class:"font-bold"},de={class:"text-sm text-gray-500"},re=ae({__name:"backup",setup(ve){const d=O(),M=R(),b=p({totalBackups:25,autoBackupEnabled:!0}),k=p(!1),c=p(!1),y=p(!1),C=p(!1),r=p({serverId:"",type:"full",note:""}),s=p({name:"",serverId:"",frequency:"daily",time:null,keepCount:10}),S=[{label:"生存服",value:"1"},{label:"Mod服",value:"2"},{label:"PVP服",value:"3"},{label:"全部服务器",value:"all"}],B=p([{id:"1",name:"backup_2024_01_20_12_00",serverName:"生存服",type:"完整备份",size:"125 MB",createTime:"2024-01-20 12:00:00",note:"定时自动备份"},{id:"2",name:"backup_2024_01_19_12_00",serverName:"生存服",type:"完整备份",size:"123 MB",createTime:"2024-01-19 12:00:00",note:"定时自动备份"},{id:"3",name:"backup_2024_01_18_manual",serverName:"Mod服",type:"世界文件",size:"85 MB",createTime:"2024-01-18 15:30:00",note:"更新前手动备份"}]),$=p([{id:"1",name:"每日自动备份",serverName:"生存服",frequency:"每天",time:"12:00",enabled:!0},{id:"2",name:"每周完整备份",serverName:"全部服务器",frequency:"每周日",time:"03:00",enabled:!0}]),D=[{title:"备份名称",key:"name",ellipsis:{tooltip:!0}},{title:"服务器",key:"serverName",width:120},{title:"类型",key:"type",width:120,render:n=>f(le,{type:"info",size:"small"},()=>n.type)},{title:"大小",key:"size",width:100},{title:"创建时间",key:"createTime",width:180},{title:"备注",key:"note",ellipsis:{tooltip:!0}},{title:"操作",key:"actions",width:200,fixed:"right",render:n=>f(v,{size:"small"},()=>[f(i,{size:"small",type:"primary",onClick:()=>K(n)},{default:()=>"恢复",icon:()=>f("div",{class:"i-mdi:restore"})}),f(i,{size:"small",type:"success",onClick:()=>G(n)},{default:()=>"下载",icon:()=>f("div",{class:"i-mdi:download"})}),f(i,{size:"small",type:"error",onClick:()=>Q(n)},{default:()=>"删除",icon:()=>f("div",{class:"i-mdi:delete"})})])}],V=()=>{d.success("备份列表已刷新")},H=()=>{if(!r.value.serverId){d.error("请选择服务器");return}C.value=!0,setTimeout(()=>{C.value=!1,d.success("备份创建成功"),k.value=!1,r.value={serverId:"",type:"full",note:""},V()},2e3)},K=n=>{M.warning({title:"确认恢复",content:`确定要恢复备份 "${n.name}" 吗？当前数据将被覆盖，且服务器将被重启。`,positiveText:"确定恢复",negativeText:"取消",onPositiveClick:()=>{d.success("正在恢复备份，服务器将自动重启...")}})},G=n=>{d.success(`正在下载备份: ${n.name}`)},Q=n=>{M.error({title:"确认删除",content:`确定要删除备份 "${n.name}" 吗？此操作不可恢复。`,positiveText:"删除",negativeText:"取消",onPositiveClick:()=>{const e=B.value.findIndex(u=>u.id===n.id);e>-1&&B.value.splice(e,1),d.success("备份已删除")}})},A=n=>{d.info("编辑计划功能")},J=n=>{const e=$.value.findIndex(u=>u.id===n);e>-1&&$.value.splice(e,1),d.success("计划已删除")},L=()=>{if(!s.value.name||!s.value.serverId){d.error("请填写完整信息");return}d.success("备份计划添加成功"),y.value=!1,s.value={name:"",serverId:"",frequency:"daily",time:null,keepCount:10}};return(n,e)=>(T(),j("div",oe,[a(l(z),{title:"备份管理",class:"mb-4"},{"header-extra":t(()=>[a(l(v),null,{default:t(()=>[a(l(i),{onClick:V},{icon:t(()=>[...e[17]||(e[17]=[_("div",{class:"i-mdi:refresh"},null,-1)])]),default:t(()=>[e[18]||(e[18]=o(" 刷新 ",-1))]),_:1}),a(l(i),{type:"primary",onClick:e[0]||(e[0]=u=>k.value=!0)},{icon:t(()=>[...e[19]||(e[19]=[_("div",{class:"i-mdi:backup-restore"},null,-1)])]),default:t(()=>[e[20]||(e[20]=o(" 立即备份 ",-1))]),_:1}),a(l(i),{onClick:e[1]||(e[1]=u=>c.value=!0)},{icon:t(()=>[...e[21]||(e[21]=[_("div",{class:"i-mdi:clock-outline"},null,-1)])]),default:t(()=>[e[22]||(e[22]=o(" 备份计划 ",-1))]),_:1})]),_:1})]),default:t(()=>[a(l(X),{cols:4,"x-gap":16,class:"mb-4"},{default:t(()=>[a(l(g),null,{default:t(()=>[a(l(x),{label:"备份总数",value:b.value.totalBackups},null,8,["value"])]),_:1}),a(l(g),null,{default:t(()=>[a(l(x),{label:"总大小",value:"1.2",suffix:"GB"})]),_:1}),a(l(g),null,{default:t(()=>[a(l(x),{label:"最近备份",value:"2小时前"})]),_:1}),a(l(g),null,{default:t(()=>[a(l(x),{label:"自动备份",value:b.value.autoBackupEnabled?"已启用":"已禁用"},{suffix:t(()=>[a(l(E),{value:b.value.autoBackupEnabled,"onUpdate:value":e[2]||(e[2]=u=>b.value.autoBackupEnabled=u)},null,8,["value"])]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(l(z),{title:"备份历史"},{default:t(()=>[a(l(Y),{columns:D,data:B.value,pagination:{pageSize:10},bordered:!1},null,8,["data"])]),_:1}),a(l(N),{show:k.value,"onUpdate:show":e[7]||(e[7]=u=>k.value=u),preset:"card",title:"创建备份",style:{width:"600px"}},{footer:t(()=>[a(l(v),{justify:"end"},{default:t(()=>[a(l(i),{onClick:e[6]||(e[6]=u=>k.value=!1)},{default:t(()=>[...e[26]||(e[26]=[o("取消",-1)])]),_:1}),a(l(i),{type:"primary",onClick:H,loading:C.value},{default:t(()=>[...e[27]||(e[27]=[o("创建备份",-1)])]),_:1},8,["loading"])]),_:1})]),default:t(()=>[a(l(F),{model:r.value,"label-placement":"left","label-width":"120px"},{default:t(()=>[a(l(m),{label:"选择服务器",required:""},{default:t(()=>[a(l(q),{value:r.value.serverId,"onUpdate:value":e[3]||(e[3]=u=>r.value.serverId=u),options:S},null,8,["value"])]),_:1}),a(l(m),{label:"备份类型",required:""},{default:t(()=>[a(l(W),{value:r.value.type,"onUpdate:value":e[4]||(e[4]=u=>r.value.type=u)},{default:t(()=>[a(l(v),null,{default:t(()=>[a(l(I),{value:"full"},{default:t(()=>[...e[23]||(e[23]=[o("完整备份",-1)])]),_:1}),a(l(I),{value:"world"},{default:t(()=>[...e[24]||(e[24]=[o("仅世界文件",-1)])]),_:1}),a(l(I),{value:"config"},{default:t(()=>[...e[25]||(e[25]=[o("仅配置文件",-1)])]),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),a(l(m),{label:"备份备注"},{default:t(()=>[a(l(P),{value:r.value.note,"onUpdate:value":e[5]||(e[5]=u=>r.value.note=u),placeholder:"可选，描述此次备份"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),a(l(N),{show:c.value,"onUpdate:show":e[9]||(e[9]=u=>c.value=u),preset:"card",title:"备份计划设置",style:{width:"700px"}},{default:t(()=>[a(l(v),{vertical:"",size:"large"},{default:t(()=>[a(l(Z),{type:"info",bordered:!1},{default:t(()=>[...e[28]||(e[28]=[o(" 自动备份会在设定的时间自动创建服务器备份，建议在低峰时段执行 ",-1)])]),_:1}),(T(!0),j(te,null,ue($.value,u=>(T(),ne(l(z),{key:u.id,size:"small"},{default:t(()=>[a(l(v),{justify:"space-between",align:"center"},{default:t(()=>[a(l(v),{vertical:"",size:"small"},{default:t(()=>[_("div",ie,w(u.name),1),_("div",de," 服务器: "+w(u.serverName)+" | 频率: "+w(u.frequency)+" | 时间: "+w(u.time),1)]),_:2},1024),a(l(v),null,{default:t(()=>[a(l(E),{value:u.enabled,"onUpdate:value":U=>u.enabled=U},null,8,["value","onUpdate:value"]),a(l(i),{size:"small",onClick:U=>A(u)},{default:t(()=>[...e[29]||(e[29]=[o("编辑",-1)])]),_:1},8,["onClick"]),a(l(i),{size:"small",type:"error",onClick:U=>J(u.id)},{default:t(()=>[...e[30]||(e[30]=[o("删除",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),a(l(i),{dashed:"",block:"",onClick:e[8]||(e[8]=u=>y.value=!0)},{icon:t(()=>[...e[31]||(e[31]=[_("div",{class:"i-mdi:plus"},null,-1)])]),default:t(()=>[e[32]||(e[32]=o(" 添加备份计划 ",-1))]),_:1})]),_:1})]),_:1},8,["show"]),a(l(N),{show:y.value,"onUpdate:show":e[16]||(e[16]=u=>y.value=u),preset:"card",title:"添加备份计划",style:{width:"600px"}},{footer:t(()=>[a(l(v),{justify:"end"},{default:t(()=>[a(l(i),{onClick:e[15]||(e[15]=u=>y.value=!1)},{default:t(()=>[...e[34]||(e[34]=[o("取消",-1)])]),_:1}),a(l(i),{type:"primary",onClick:L},{default:t(()=>[...e[35]||(e[35]=[o("添加",-1)])]),_:1})]),_:1})]),default:t(()=>[a(l(F),{model:s.value,"label-placement":"left","label-width":"120px"},{default:t(()=>[a(l(m),{label:"计划名称",required:""},{default:t(()=>[a(l(P),{value:s.value.name,"onUpdate:value":e[10]||(e[10]=u=>s.value.name=u),placeholder:"例如：每日备份"},null,8,["value"])]),_:1}),a(l(m),{label:"选择服务器",required:""},{default:t(()=>[a(l(q),{value:s.value.serverId,"onUpdate:value":e[11]||(e[11]=u=>s.value.serverId=u),options:S},null,8,["value"])]),_:1}),a(l(m),{label:"备份频率",required:""},{default:t(()=>[a(l(q),{value:s.value.frequency,"onUpdate:value":e[12]||(e[12]=u=>s.value.frequency=u),options:[{label:"每小时",value:"hourly"},{label:"每天",value:"daily"},{label:"每周",value:"weekly"},{label:"每月",value:"monthly"}]},null,8,["value"])]),_:1}),a(l(m),{label:"执行时间",required:""},{default:t(()=>[a(l(h),{value:s.value.time,"onUpdate:value":e[13]||(e[13]=u=>s.value.time=u),format:"HH:mm"},null,8,["value"])]),_:1}),a(l(m),{label:"保留数量"},{default:t(()=>[a(l(ee),{value:s.value.keepCount,"onUpdate:value":e[14]||(e[14]=u=>s.value.keepCount=u),min:1,max:100},null,8,["value"]),e[33]||(e[33]=_("span",{class:"ml-2 text-sm text-gray-500"},"自动删除超过此数量的旧备份",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]))}}),_e=se(re,[["__scopeId","data-v-aad321a3"]]);export{_e as default};
