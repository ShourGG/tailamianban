import{s as gz,c as Hm,i as cd,a as Br,u as vS,l as fz,b as Es,d as DP,e as gi,f as pz,m as Di,g as FP,h as mz,j as vz,k as bS,n as bs,o as bz,p as zP,q as yz,r as yS,t as Cz,v as Sg,w as UC,x as CS,y as _z}from"./ui-vendor-C2DiPTQI.js";import{k as bi,P as wz,E as xz,Q as ni,R as Be,S as ps,q as Ml,U as XC,V as Tl,K as It,g as qc,r as fi,w as He,c as ee,W as NP,i as Bu,X as WP,d as Sz,o as wa,F as Io,N as b1,M as aa,n as ys,b as jP,Y as Ho,Z as Az,_ as $h,x as ip,t as Ti,I as ic,$ as YC,e as Mz,a0 as Pf,p as Uh,a1 as VP,m as De,a2 as le,a3 as y1,L as Tz,a4 as Rz,a5 as Bz,s as GP,a6 as kz,a as Pz,a7 as Ez,j as Lz,H as Bd}from"./vue-vendor-B-HGZVTd.js";var Ag=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function C1(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function cpt(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var t=n.default;if(typeof t=="function"){var e=function i(){var r=!1;try{r=this instanceof i}catch{}return r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}),e}typeof window=="object"&&window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);typeof window<"u"&&(function(n){n.forEach(t=>{Object.prototype.hasOwnProperty.call(t,"append")||Object.defineProperty(t,"append",{configurable:!0,enumerable:!0,writable:!0,value(...e){const i=document.createDocumentFragment();e.forEach(r=>{const o=r instanceof Node;i.appendChild(o?r:document.createTextNode(String(r)))}),this.appendChild(i)}})})})([Element.prototype,Document.prototype,DocumentFragment.prototype]);class As{get disposed(){return this._disposed===!0}dispose(){this._disposed=!0}}(function(n){function t(){return(e,i,r)=>{const o=r.value,s=e.__proto__;r.value=function(...a){this.disposed||(o.call(this,...a),s.dispose.call(this))}}}n.dispose=t})(As||(As={}));class _S{constructor(){this.isDisposed=!1,this.items=new Set}get disposed(){return this.isDisposed}dispose(){this.isDisposed||(this.isDisposed=!0,this.items.forEach(t=>{t.dispose()}),this.items.clear())}contains(t){return this.items.has(t)}add(t){this.items.add(t)}remove(t){this.items.delete(t)}clear(){this.items.clear()}}(function(n){function t(e){const i=new n;return e.forEach(r=>{i.add(r)}),i}n.from=t})(_S||(_S={}));function $P(n,t,e){if(e)switch(e.length){case 0:return n.call(t);case 1:return n.call(t,e[0]);case 2:return n.call(t,e[0],e[1]);case 3:return n.call(t,e[0],e[1],e[2]);case 4:return n.call(t,e[0],e[1],e[2],e[3]);case 5:return n.call(t,e[0],e[1],e[2],e[3],e[4]);case 6:return n.call(t,e[0],e[1],e[2],e[3],e[4],e[5]);default:return n.apply(t,e)}return n.call(t)}function Nt(n,t,...e){return $P(n,t,e)}function Oz(n){return typeof n=="object"&&n.then&&typeof n.then=="function"}function wS(n){return n!=null&&(n instanceof Promise||Oz(n))}function UP(...n){const t=[];if(n.forEach(i=>{Array.isArray(i)?t.push(...i):t.push(i)}),t.some(i=>wS(i))){const i=t.map(r=>wS(r)?r:Promise.resolve(r!==!1));return Promise.all(i).then(r=>r.reduce((o,s)=>s!==!1&&o,!0))}return t.every(i=>i!==!1)}function wb(n,t){const e=[];for(let i=0;i<n.length;i+=2){const r=n[i],o=n[i+1],s=Array.isArray(t)?t:[t],a=$P(r,o,s);e.push(a)}return UP(e)}class Iz{constructor(){this.listeners={}}on(t,e,i){return e==null?this:(this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e,i),this)}once(t,e,i){const r=(...o)=>(this.off(t,r),wb([e,i],o));return this.on(t,r,this)}off(t,e,i){if(!(t||e||i))return this.listeners={},this;const r=this.listeners;return(t?[t]:Object.keys(r)).forEach(s=>{const a=r[s];if(a){if(!(e||i)){delete r[s];return}for(let l=a.length-2;l>=0;l-=2)e&&a[l]!==e||i&&a[l+1]!==i||a.splice(l,2)}}),this}trigger(t,...e){let i=!0;if(t!=="*"){const o=this.listeners[t];o!=null&&(i=wb([...o],e))}const r=this.listeners["*"];return r!=null?UP([i,wb([...r],[t,...e])]):i}emit(t,...e){return this.trigger(t,...e)}}function Hz(n,...t){t.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(i=>{i!=="constructor"&&Object.defineProperty(n.prototype,i,Object.getOwnPropertyDescriptor(e.prototype,i))})})}const Dz=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])};function Fz(n,t){Dz(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}class zz{}const Nz=/^\s*class\s+/.test(`${zz}`)||/^\s*class\s*\{/.test(`${class{}}`);function _1(n,t){let e;return Nz?e=class extends t{}:(e=function(){return t.apply(this,arguments)},Fz(e,t)),Object.defineProperty(e,"name",{value:n}),e}function xS(n){return n==="__proto__"}function w1(n,t,e="/"){let i;const r=Array.isArray(t)?t:t.split(e);if(r.length)for(i=n;r.length;){const o=r.shift();if(Object(i)===i&&o&&o in i)i=i[o];else return}return i}function ku(n,t,e,i="/"){const r=Array.isArray(t)?t:t.split(i),o=r.pop();if(o&&!xS(o)){let s=n;r.forEach(a=>{xS(a)||(s[a]==null&&(s[a]={}),s=s[a])}),s[o]=e}return n}function SS(n,t,e="/"){const i=Array.isArray(t)?t.slice():t.split(e),r=i.pop();if(r)if(i.length>0){const o=w1(n,i);o&&delete o[r]}else delete n[r];return n}var Wz=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o};class ar extends Iz{dispose(){this.off()}}Wz([As.dispose()],ar.prototype,"dispose",null);(function(n){n.dispose=As.dispose})(ar||(ar={}));Hz(ar,As);const XP=n=>{const t=Object.create(null);return(e=>t[e]||(t[e]=n(e)))},YP=XP(n=>n.replace(/\B([A-Z])/g,"-$1").toLowerCase()),x1=XP(n=>gz(Hm(n)).replace(/ /g,""));function xb(n){let t=2166136261,e=!1,i=n;for(let r=0,o=i.length;r<o;r+=1){let s=i.charCodeAt(r);s>127&&!e&&(i=unescape(encodeURIComponent(i)),s=i.charCodeAt(r),e=!0),t^=s,t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)}return t>>>0}function np(){let n="";const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";for(let e=0,i=t.length;e<i;e+=1){const r=t[e],o=Math.random()*16|0,s=r==="x"?o:r==="y"?o&3|8:r;n+=s.toString(16)}return n}function jz(n,t,e){const i=Math.min(2,Math.floor(n.length*.34));let r=Math.floor(n.length*.4)+1,o,s=!1;const a=n.toLowerCase();for(const l of t){const h=e(l);if(h!==void 0&&Math.abs(h.length-a.length)<=i){const u=h.toLowerCase();if(u===a){if(h===n)continue;return l}if(s||h.length<3)continue;const d=Vz(a,u,r-1);if(d===void 0)continue;d<3?(s=!0,o=l):(r=d,o=l)}}return o}function Vz(n,t,e){let i=new Array(t.length+1),r=new Array(t.length+1);const o=e+1;for(let a=0;a<=t.length;a+=1)i[a]=a;for(let a=1;a<=n.length;a+=1){const l=n.charCodeAt(a-1),h=a>e?a-e:1,u=t.length>e+a?e+a:t.length;r[0]=a;let d=a;for(let g=1;g<h;g+=1)r[g]=o;for(let g=h;g<=u;g+=1){const f=l===t.charCodeAt(g-1)?i[g-1]:Math.min(i[g]+1,r[g-1]+1,i[g-1]+2);r[g]=f,d=Math.min(d,f)}for(let g=u+1;g<=t.length;g+=1)r[g]=o;if(d>e)return;const c=i;i=r,r=c}const s=i[t.length];return s>e?void 0:s}function Ms(n){return typeof n=="string"&&n.slice(-1)==="%"}function Qr(n,t){if(n==null)return 0;let e;if(typeof n=="string"){if(e=parseFloat(n),Ms(n)&&(e/=100,Number.isFinite(e)))return e*t}else e=n;return Number.isFinite(e)?e>0&&e<1?e*t:e:0}function Rl(n){if(typeof n=="object"){let e=0,i=0,r=0,o=0;return n.vertical!=null&&Number.isFinite(n.vertical)&&(i=o=n.vertical),n.horizontal!=null&&Number.isFinite(n.horizontal)&&(r=e=n.horizontal),n.left!=null&&Number.isFinite(n.left)&&(e=n.left),n.top!=null&&Number.isFinite(n.top)&&(i=n.top),n.right!=null&&Number.isFinite(n.right)&&(r=n.right),n.bottom!=null&&Number.isFinite(n.bottom)&&(o=n.bottom),{top:i,right:r,bottom:o,left:e}}let t=0;return n!=null&&Number.isFinite(n)&&(t=n),{top:t,right:t,bottom:t,left:t}}let S1=!1,qP=!1,KP=!1,ZP=!1,JP=!1,QP=!1,tE=!1,eE=!1,iE=!1,nE=!1,rE=!1,oE=!1,sE=!1,aE=!1,lE=!1,hE=!1;if(typeof navigator=="object"){const n=navigator.userAgent;S1=n.indexOf("Macintosh")>=0,qP=!!n.match(/(iPad|iPhone|iPod)/g),KP=n.indexOf("Windows")>=0,ZP=n.indexOf("MSIE")>=0,JP=!!n.match(/Trident\/7\./),QP=!!n.match(/Edge\//),tE=n.indexOf("Mozilla/")>=0&&n.indexOf("MSIE")<0&&n.indexOf("Edge/")<0,iE=n.indexOf("Chrome/")>=0&&n.indexOf("Edge/")<0,nE=n.indexOf("Opera/")>=0||n.indexOf("OPR/")>=0,rE=n.indexOf("Firefox/")>=0,oE=n.indexOf("AppleWebKit/")>=0&&n.indexOf("Chrome/")<0&&n.indexOf("Edge/")<0,typeof document=="object"&&(hE=!document.createElementNS||`${document.createElementNS("http://www.w3.org/2000/svg","foreignObject")}`!="[object SVGForeignObjectElement]"||n.indexOf("Opera/")>=0)}typeof window=="object"&&(eE=window.chrome!=null&&window.chrome.app!=null&&window.chrome.app.runtime!=null,aE=window.PointerEvent!=null&&!S1);if(typeof document=="object"){sE="ontouchstart"in document.documentElement;try{const n=Object.defineProperty({},"passive",{get(){lE=!0}}),t=document.createElement("div");t.addEventListener&&t.addEventListener("click",()=>{},n)}catch{}}var la;(function(n){n.IS_MAC=S1,n.IS_IOS=qP,n.IS_WINDOWS=KP,n.IS_IE=ZP,n.IS_IE11=JP,n.IS_EDGE=QP,n.IS_NETSCAPE=tE,n.IS_CHROME_APP=eE,n.IS_CHROME=iE,n.IS_OPERA=nE,n.IS_FIREFOX=rE,n.IS_SAFARI=oE,n.SUPPORT_TOUCH=sE,n.SUPPORT_POINTER=aE,n.SUPPORT_PASSIVE=lE,n.NO_FOREIGNOBJECT=hE,n.SUPPORT_FOREIGNOBJECT=!n.NO_FOREIGNOBJECT})(la||(la={}));(function(n){function t(){const o=window.module;return o!=null&&o.hot!=null&&o.hot.status!=null?o.hot.status():"unkonwn"}n.getHMRStatus=t;function e(){return t()==="apply"}n.isApplyingHMR=e;const i={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};function r(o){const s=document.createElement(i[o]||"div"),a=`on${o}`;let l=a in s;return l||(s.setAttribute(a,"return;"),l=typeof s[a]=="function"),l}n.isEventSupported=r})(la||(la={}));const A1=/[\t\r\n\f]/g,M1=/\S+/g,Xh=n=>` ${n} `;function Yh(n){return n&&n.getAttribute&&n.getAttribute("class")||""}function Kc(n,t){if(n==null||t==null)return!1;const e=Xh(Yh(n)),i=Xh(t);return n.nodeType===1?e.replace(A1," ").includes(i):!1}function we(n,t){if(!(n==null||t==null)){if(typeof t=="function")return we(n,t(Yh(n)));if(typeof t=="string"&&n.nodeType===1){const e=t.match(M1)||[],i=Xh(Yh(n)).replace(A1," ");let r=e.reduce((o,s)=>o.indexOf(Xh(s))<0?`${o}${s} `:o,i);r=r.trim(),i!==r&&n.setAttribute("class",r)}}}function kr(n,t){if(n!=null){if(typeof t=="function")return kr(n,t(Yh(n)));if((!t||typeof t=="string")&&n.nodeType===1){const e=(t||"").match(M1)||[],i=Xh(Yh(n)).replace(A1," ");let r=e.reduce((o,s)=>{const a=Xh(s);return o.indexOf(a)>-1?o.replace(a," "):o},i);r=t?r.trim():"",i!==r&&n.setAttribute("class",r)}}}function uE(n,t,e){if(!(n==null||t==null)){if(e!=null&&typeof t=="string"){e?we(n,t):kr(n,t);return}if(typeof t=="function")return uE(n,t(Yh(n),e),e);typeof t=="string"&&(t.match(M1)||[]).forEach(r=>{Kc(n,r)?kr(n,r):we(n,r)})}}let AS=0;function Gz(){return AS+=1,`v${AS}`}function T1(n){return(n.id==null||n.id==="")&&(n.id=Gz()),n.id}function ha(n){return n==null?!1:typeof n.getScreenCTM=="function"&&n instanceof SVGElement}const Yi={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns/",xml:"http://www.w3.org/XML/1998/namespace",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml"},MS="1.1";function TS(n,t=document){return t.createElement(n)}function R1(n,t=Yi.xhtml,e=document){return e.createElementNS(t,n)}function uo(n,t=document){return R1(n,Yi.svg,t)}function rp(n){if(n){const e=`<svg xmlns="${Yi.svg}" xmlns:xlink="${Yi.xlink}" version="${MS}">${n}</svg>`,{documentElement:i}=$z(e,{async:!1});return i}const t=document.createElementNS(Yi.svg,"svg");return t.setAttributeNS(Yi.xmlns,"xmlns:xlink",Yi.xlink),t.setAttribute("version",MS),t}function $z(n,t={}){let e;try{const i=new DOMParser;if(t.async!=null){const r=i;r.async=t.async}e=i.parseFromString(n,t.mimeType||"text/xml")}catch{e=void 0}if(!e||e.getElementsByTagName("parsererror").length)throw new Error(`Invalid XML: ${n}`);return e}function Uz(n,t=!0){const e=n.nodeName;return t?e.toLowerCase():e.toUpperCase()}function B1(n){let t=0,e=n.previousSibling;for(;e;)e.nodeType===1&&(t+=1),e=e.previousSibling;return t}function Xz(n,t){return n.querySelectorAll(t)}function Yz(n,t){return n.querySelector(t)}function dE(n,t,e){const i=n.ownerSVGElement;let r=n.parentNode;for(;r&&r!==e&&r!==i;){if(Kc(r,t))return r;r=r.parentNode}return null}function cE(n,t){const e=t&&t.parentNode;return n===e||!!(e&&e.nodeType===1&&n.compareDocumentPosition(e)&16)}function qh(n){n&&(Array.isArray(n)?n:[n]).forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)})}function Zc(n){for(;n.firstChild;)n.removeChild(n.firstChild)}function Jc(n,t){(Array.isArray(t)?t:[t]).forEach(i=>{i!=null&&n.appendChild(i)})}function qz(n,t){const e=n.firstChild;return e?k1(e,t):Jc(n,t)}function k1(n,t){const e=n.parentNode;e&&(Array.isArray(t)?t:[t]).forEach(r=>{r!=null&&e.insertBefore(r,n)})}function Kz(n,t){t?.appendChild(n)}function RS(n){try{return n instanceof HTMLElement}catch{return typeof n=="object"&&n.nodeType===1&&typeof n.style=="object"&&typeof n.ownerDocument=="object"}}const gE=["viewBox","attributeName","attributeType","repeatCount","textLength","lengthAdjust","gradientUnits"];function Zz(n,t){return n.getAttribute(t)}function fE(n,t){const e=mE(t);e.ns?n.hasAttributeNS(e.ns,e.local)&&n.removeAttributeNS(e.ns,e.local):n.hasAttribute(t)&&n.removeAttribute(t)}function P1(n,t,e){if(e==null)return fE(n,t);const i=mE(t);i.ns&&typeof e=="string"?n.setAttributeNS(i.ns,t,e):t==="id"?n.id=`${e}`:n.setAttribute(t,`${e}`)}function pE(n,t){Object.keys(t).forEach(e=>{P1(n,e,t[e])})}function je(n,t,e){if(t==null){const i=n.attributes,r={};for(let o=0;o<i.length;o+=1)r[i[o].name]=i[o].value;return r}if(typeof t=="string"&&e===void 0)return n.getAttribute(t);typeof t=="object"?pE(n,t):P1(n,t,e)}function mE(n){if(n.indexOf(":")!==-1){const t=n.split(":");return{ns:Yi[t[0]],local:t[1]}}return{ns:null,local:n}}function nc(n){const t={};return Object.keys(n).forEach(e=>{const i=gE.includes(e)?e:YP(e);t[i]=n[e]}),t}function Mg(n){const t={};return n.split(";").forEach(i=>{const r=i.trim();if(r){const o=r.split("=");o.length&&(t[o[0].trim()]=o[1]?o[1].trim():"")}}),t}function qC(n,t){return Object.keys(t).forEach(e=>{if(e==="class")n[e]=n[e]?`${n[e]} ${t[e]}`:t[e];else if(e==="style"){const i=typeof n[e]=="object",r=typeof t[e]=="object";let o,s;i&&r?(o=n[e],s=t[e]):i?(o=n[e],s=Mg(t[e])):r?(o=Mg(n[e]),s=t[e]):(o=Mg(n[e]),s=Mg(t[e])),n[e]=qC(o,s)}else n[e]=t[e]}),n}function Jz(n,t,e={}){const i=e.offset||0,r=[],o=[];let s,a,l=null;for(let h=0;h<n.length;h+=1){s=o[h]=n[h];for(let u=0,d=t.length;u<d;u+=1){const c=t[u],g=c.start+i,f=c.end+i;h>=g&&h<f&&(typeof s=="string"?s=o[h]={t:n[h],attrs:c.attrs}:s.attrs=qC(qC({},s.attrs),c.attrs),e.includeAnnotationIndices&&(s.annotations==null&&(s.annotations=[]),s.annotations.push(u)))}a=o[h-1],a?cd(s)&&cd(a)?(l=l,JSON.stringify(s.attrs)===JSON.stringify(a.attrs)?l.t+=s.t:(r.push(l),l=s)):cd(s)||cd(a)?(l=l,r.push(l),l=s):l=(l||"")+s:l=s}return l!=null&&r.push(l),r}function Qz(n){return n.replace(/ /g," ")}var BS;(function(n){function t(h){const u="data:";return h.substr(0,u.length)===u}n.isDataUrl=t;function e(h,u){if(!h||t(h)){setTimeout(()=>u(null,h));return}const d=()=>{u(new Error(`Failed to load image: ${h}`))},c=window.FileReader?f=>{if(f.status===200){const p=new FileReader;p.onload=m=>{const v=m.target.result;u(null,v)},p.onerror=d,p.readAsDataURL(f.response)}else d()}:f=>{const p=m=>{const b=[];for(let y=0;y<m.length;y+=32768)b.push(String.fromCharCode.apply(null,m.subarray(y,y+32768)));return b.join("")};if(f.status===200){let m=h.split(".").pop()||"png";m==="svg"&&(m="svg+xml");const v=`data:image/${m};base64,`,b=new Uint8Array(f.response),y=v+btoa(p(b));u(null,y)}else d()},g=new XMLHttpRequest;g.responseType=window.FileReader?"blob":"arraybuffer",g.open("GET",h,!0),g.addEventListener("error",d),g.addEventListener("load",()=>c(g)),g.send()}n.imageToDataUri=e;function i(h){let u=h.replace(/\s/g,"");u=decodeURIComponent(u);const d=u.indexOf(","),c=u.slice(0,d),g=c.split(":")[1].split(";")[0],f=u.slice(d+1);let p;c.indexOf("base64")>=0?p=atob(f):p=unescape(encodeURIComponent(f));const m=new Uint8Array(p.length);for(let v=0;v<p.length;v+=1)m[v]=p.charCodeAt(v);return new Blob([m],{type:g})}n.dataUriToBlob=i;function r(h,u){const d=window.navigator.msSaveBlob;if(d)d(h,u);else{const c=window.URL.createObjectURL(h),g=document.createElement("a");g.href=c,g.download=u,document.body.appendChild(g),g.click(),document.body.removeChild(g),window.URL.revokeObjectURL(c)}}n.downloadBlob=r;function o(h,u){const d=i(h);r(d,u)}n.downloadDataUri=o;function s(h){const u=h.match(/<svg[^>]*viewBox\s*=\s*(["']?)(.+?)\1[^>]*>/i);return u&&u[2]?u[2].replace(/\s+/," ").split(" "):null}function a(h){const u=parseFloat(h);return Number.isNaN(u)?null:u}function l(h,u={}){let d=null;const c=y=>(d==null&&(d=s(h)),d!=null?a(d[y]):null),g=y=>{const C=h.match(y);return C&&C[2]?a(C[2]):null};let f=u.width;if(f==null&&(f=g(/<svg[^>]*width\s*=\s*(["']?)(.+?)\1[^>]*>/i)),f==null&&(f=c(2)),f==null)throw new Error("Can not parse width from svg string");let p=u.height;if(p==null&&(p=g(/<svg[^>]*height\s*=\s*(["']?)(.+?)\1[^>]*>/i)),p==null&&(p=c(3)),p==null)throw new Error("Can not parse height from svg string");return`data:image/svg+xml,${encodeURIComponent(h).replace(/'/g,"%27").replace(/"/g,"%22")}`}n.svgToDataUrl=l})(BS||(BS={}));let qa;const t3={px(n){return n},mm(n){return qa*n},cm(n){return qa*n*10},in(n){return qa*n*25.4},pt(n){return qa*(25.4*n/72)},pc(n){return qa*(25.4*n/6)}};var kS;(function(n){function t(i,r,o){const s=document.createElement("div"),a=s.style;a.display="inline-block",a.position="absolute",a.left="-15000px",a.top="-15000px",a.width=i+(o||"px"),a.height=r+(o||"px"),document.body.appendChild(s);const l=s.getBoundingClientRect(),h={width:l.width||0,height:l.height||0};return document.body.removeChild(s),h}n.measure=t;function e(i,r){qa==null&&(qa=t("1","1","mm").width);const o=r?t3[r]:null;return o?o(i):i}n.toPx=e})(kS||(kS={}));const e3=/-(.)/g;function i3(n){return n.replace(e3,(t,e)=>e.toUpperCase())}const Sb={},PS=["webkit","ms","moz","o"],vE=typeof document<"u"?document.createElement("div").style:{};function n3(n){for(let t=0;t<PS.length;t+=1){const e=PS[t]+n;if(e in vE)return e}return null}function r3(n){const t=i3(n);if(Sb[t]==null){const e=t.charAt(0).toUpperCase()+t.slice(1);Sb[t]=t in vE?t:n3(e)}return Sb[t]}function ES(n,t){const e=n.ownerDocument&&n.ownerDocument.defaultView&&n.ownerDocument.defaultView.opener?n.ownerDocument.defaultView.getComputedStyle(n,null):window.getComputedStyle(n,null);return e&&t?e.getPropertyValue(t)||e[t]:e}const o3={animationIterationCount:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0};function s3(n){return/^--/.test(n)}function a3(n,t,e){const i=window.getComputedStyle(n,null);return e?i.getPropertyValue(t)||void 0:i[t]||n.style[t]}function l3(n,t){return!o3[n]&&typeof t=="number"?`${t}px`:t}function Qc(n,t,e){if(typeof t=="string"){const i=s3(t);if(i||(t=r3(t)),e===void 0)return a3(n,t,i);i||(e=l3(t,e));const r=n.style;i?r.setProperty(t,e):r[t]=e;return}for(const i in t)Qc(n,i,t[i])}const op=new WeakMap;function LS(n,t){const e=Hm(t),i=op.get(n);if(i)return i[e]}function h3(n,t,e){const i=Hm(t),r=op.get(n);r?r[i]=e:op.set(n,{[i]:e})}function Bl(n,t,e){if(!t){const i={};return Object.keys(op).forEach(r=>{i[r]=LS(n,r)}),i}if(typeof t=="string"){if(e===void 0)return LS(n,t);h3(n,t,e);return}for(const i in t)Bl(n,i,t[i])}class Ft{get[Symbol.toStringTag](){return Ft.toStringTag}get type(){return this.node.nodeName}get id(){return this.node.id}set id(t){this.node.id=t}constructor(t,e,i){if(!t)throw new TypeError("Invalid element to create vector");let r;if(Ft.isVector(t))r=t.node;else if(typeof t=="string")if(t.toLowerCase()==="svg")r=rp();else if(t[0]==="<"){const o=rp(t);r=document.importNode(o.firstChild,!0)}else r=document.createElementNS(Yi.svg,t);else r=t;this.node=r,e&&this.setAttributes(e),i&&this.append(i)}transform(t,e){return t==null?Kh(this.node):(Kh(this.node,t,e),this)}translate(t,e=0,i={}){return t==null?IS(this.node):(IS(this.node,t,e,i),this)}rotate(t,e,i,r={}){return t==null?JC(this.node):(JC(this.node,t,e,i,r),this)}scale(t,e){return t==null?QC(this.node):(QC(this.node,t,e),this)}getTransformToElement(t){const e=Ft.toNode(t);return Pd(this.node,e)}removeAttribute(t){return fE(this.node,t),this}getAttribute(t){return Zz(this.node,t)}setAttribute(t,e){return P1(this.node,t,e),this}setAttributes(t){return pE(this.node,t),this}attr(t,e){return t==null?je(this.node):typeof t=="string"&&e===void 0?je(this.node,t):(typeof t=="object"?je(this.node,t):je(this.node,t,e),this)}svg(){return this.node instanceof SVGSVGElement?this:Ft.create(this.node.ownerSVGElement)}defs(){const t=this.svg()||this,e=t.node.getElementsByTagName("defs")[0];return e?Ft.create(e):Ft.create("defs").appendTo(t)}text(t,e={}){return yE(this.node,t,e),this}tagName(){return Uz(this.node)}clone(){return Ft.create(this.node.cloneNode(!0))}remove(){return qh(this.node),this}empty(){return Zc(this.node),this}append(t){return Jc(this.node,Ft.toNodes(t)),this}appendTo(t){return Kz(this.node,Ft.isVector(t)?t.node:t),this}prepend(t){return qz(this.node,Ft.toNodes(t)),this}before(t){return k1(this.node,Ft.toNodes(t)),this}replace(t){return this.node.parentNode&&this.node.parentNode.replaceChild(Ft.toNode(t),this.node),Ft.create(t)}first(){return this.node.firstChild?Ft.create(this.node.firstChild):null}last(){return this.node.lastChild?Ft.create(this.node.lastChild):null}get(t){const e=this.node.childNodes[t];return e?Ft.create(e):null}indexOf(t){return Array.prototype.slice.call(this.node.childNodes).indexOf(Ft.toNode(t))}find(t){const e=[],i=Xz(this.node,t);if(i)for(let r=0,o=i.length;r<o;r+=1)e.push(Ft.create(i[r]));return e}findOne(t){const e=Yz(this.node,t);return e?Ft.create(e):null}findParentByClass(t,e){const i=dE(this.node,t,e);return i?Ft.create(i):null}matches(t){const e=this.node;this.node.matches;const i=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector||null;return i&&i.call(e,t)}contains(t){return cE(this.node,Ft.isVector(t)?t.node:t)}wrap(t){const e=Ft.create(t),i=this.node.parentNode;return i?.insertBefore(e.node,this.node),e.append(this)}parent(t){let e=this;if(e.node.parentNode==null)return null;if(e=Ft.create(e.node.parentNode),t==null)return e;do if(typeof t=="string"?e.matches(t):e instanceof t)return e;while(e=Ft.create(e.node.parentNode));return e}children(){const t=this.node.childNodes,e=[];for(let i=0;i<t.length;i+=1)t[i].nodeType===1&&e.push(Ft.create(t[i]));return e}eachChild(t,e){const i=this.children();for(let r=0,o=i.length;r<o;r+=1)t.call(i[r],i[r],r,i),e&&i[r].eachChild(t,e);return this}index(){return B1(this.node)}hasClass(t){return Kc(this.node,t)}addClass(t){return we(this.node,t),this}removeClass(t){return kr(this.node,t),this}toggleClass(t,e){return uE(this.node,t,e),this}toLocalPoint(t,e){return B3(this.node,t,e)}sample(t=1){return this.node instanceof SVGPathElement?g3(this.node,t):[]}toPath(){return Ft.create(C3(this.node))}toPathData(){return xE(this.node)}}(function(n){n.toStringTag=`X6.${n.name}`;function t(s){if(s==null)return!1;if(s instanceof n)return!0;const a=s[Symbol.toStringTag],l=s;return(a==null||a===n.toStringTag)&&l.node instanceof SVGElement&&typeof l.sample=="function"&&typeof l.toPath=="function"}n.isVector=t;function e(s,a,l){return new n(s,a,l)}n.create=e;function i(s){if(s[0]==="<"){const a=rp(s),l=[];for(let h=0,u=a.childNodes.length;h<u;h+=1){const d=a.childNodes[h];l.push(e(document.importNode(d,!0)))}return l}return[e(s)]}n.createVectors=i;function r(s){return t(s)?s.node:s}n.toNode=r;function o(s){return Array.isArray(s)?s.map(a=>r(a)):[r(s)]}n.toNodes=o})(Ft||(Ft={}));function u3(n,t){const e=Ft.create(t),i=Ft.create("textPath"),r=n.d;if(r&&n["xlink:href"]===void 0){const o=Ft.create("path").attr("d",r).appendTo(e.defs());i.attr("xlink:href",`#${o.id}`)}return typeof n=="object"&&i.attr(n),i.node}function d3(n,t,e){const i=e.eol,r=e.baseSize,o=e.lineHeight;let s=0,a;const l={},h=t.length-1;for(let u=0;u<=h;u+=1){let d=t[u],c=null;if(typeof d=="object"){const g=d.attrs,f=Ft.create("tspan",g);a=f.node;let p=d.t;i&&u===h&&(p+=i),a.textContent=p;const m=g.class;m&&f.addClass(m),e.includeAnnotationIndices&&f.attr("annotations",d.annotations.join(",")),c=parseFloat(g["font-size"]),c===void 0&&(c=r),c&&c>s&&(s=c)}else i&&u===h&&(d+=i),a=document.createTextNode(d||" "),r&&r>s&&(s=r);n.appendChild(a)}return s&&(l.maxFontSize=s),o?l.lineHeight=o:s&&(l.lineHeight=s*1.2),l}const bE=/em$/;function Tg(n,t){const e=parseFloat(n);return bE.test(n)?e*t:e}function c3(n,t,e,i){if(!Array.isArray(t))return 0;const r=t.length;if(!r)return 0;let o=t[0];const s=Tg(o.maxFontSize,e)||e;let a=0;const l=Tg(i,e);for(let d=1;d<r;d+=1){o=t[d];const c=Tg(o.lineHeight,e)||l;a+=c}const h=Tg(o.maxFontSize,e)||e;let u;switch(n){case"middle":u=s/2-.15*h-a/2;break;case"bottom":u=-(.25*h)-a;break;case"top":default:u=.8*s;break}return u}function yE(n,t,e={}){t=Qz(t);const i=e.eol;let r=e.textPath;const o=e.textVerticalAnchor,s=o==="middle"||o==="bottom"||o==="top";let a=e.x;a===void 0&&(a=n.getAttribute("x")||0);const l=e.includeAnnotationIndices;let h=e.annotations;h&&!Array.isArray(h)&&(h=[h]);const u=e.lineHeight,d=u==="auto",c=d?"1.5em":u||"1em";let g=!0;const f=n.childNodes;if(f.length===1){const S=f[0];S&&S.tagName.toUpperCase()==="TITLE"&&(g=!1)}g&&Zc(n),je(n,{"xml:space":"preserve",display:t||e.displayEmpty?null:"none"});const p=je(n,"font-size");let m=parseFloat(p);m||(m=16,(s||h)&&!p&&je(n,"font-size",`${m}`));let v;r?(typeof r=="string"&&(r={d:r}),v=u3(r,n)):v=document.createDocumentFragment();let b,y=0,C;const w=t.split(`
`),_=[],A=w.length-1;for(let S=0;S<=A;S+=1){b=c;let T="v-line";const M=uo("tspan");let R,E=w[S];if(E)if(h){const P=Jz(E,h,{offset:-y,includeAnnotationIndices:l});R=d3(M,P,{eol:S!==A&&i,baseSize:m,lineHeight:d?null:c,includeAnnotationIndices:l});const B=R.lineHeight;B&&d&&S!==0&&(b=B),S===0&&(C=R.maxFontSize*.8)}else i&&S!==A&&(E+=i),M.textContent=E;else{M.textContent="-",T+=" v-empty-line";const P=M.style;P.fillOpacity=0,P.strokeOpacity=0,h&&(R={})}R&&_.push(R),S>0&&M.setAttribute("dy",b),(S>0||r)&&M.setAttribute("x",a),M.className.baseVal=T,v.appendChild(M),y+=E.length+1}if(s)if(h)b=c3(o,_,m,c);else if(o==="top")b="0.8em";else{let S;switch(A>0?(S=parseFloat(c)||1,S*=A,bE.test(c)||(S/=m)):S=0,o){case"middle":b=`${.3-S/2}em`;break;case"bottom":b=`${-S-.3}em`;break}}else o===0?b="0em":o?b=o:(b=0,n.getAttribute("y")==null&&n.setAttribute("y",`${C||"0.8em"}`));v.firstChild.setAttribute("dy",b),n.appendChild(v)}function kd(n,t={}){const e=document.createElement("canvas").getContext("2d");if(!n)return{width:0};const i=[],r=t["font-size"]?`${parseFloat(t["font-size"])}px`:"14px";return i.push(t["font-style"]||"normal"),i.push(t["font-variant"]||"normal"),i.push(t["font-weight"]||400),i.push(r),i.push(t["font-family"]||"sans-serif"),e.font=i.join(" "),e.measureText(n)}function OS(n,t,e,i={}){if(t>=e)return[n,""];const r=n.length,o={};let s=Math.round(t/e*r-1);for(s<0&&(s=0);s>=0&&s<r;){const a=n.slice(0,s),l=o[a]||kd(a,i).width,h=n.slice(0,s+1),u=o[h]||kd(h,i).width;if(o[a]=l,o[h]=u,l>t)s-=1;else if(u<=t)s+=1;else break}return[n.slice(0,s),n.slice(s)]}function CE(n,t,e={},i={}){const r=t.width,o=t.height,s=i.eol||`
`,a=e.fontSize||14,l=e.lineHeight?parseFloat(e.lineHeight):Math.ceil(a*1.4),h=Math.floor(o/l);if(n.indexOf(s)>-1){const m=np(),v=[];return n.split(s).map(b=>{const y=CE(b,Object.assign(Object.assign({},t),{height:Number.MAX_SAFE_INTEGER}),e,Object.assign(Object.assign({},i),{eol:m}));y&&v.push(...y.split(m))}),v.slice(0,h).join(s)}const{width:u}=kd(n,e);if(u<r)return n;const d=[];let c=n,g=u,f=i.ellipsis,p=0;f&&(typeof f!="string"&&(f="…"),p=kd(f,e).width);for(let m=0;m<h;m+=1)if(g>r)if(m===h-1){const[b]=OS(c,r-p,g,e);d.push(f?`${b}${f}`:b)}else{const[b,y]=OS(c,r,g,e);d.push(b),c=y,g=kd(c,e).width}else{d.push(c);break}return d.join(s)}const KC=.551784;function ln(n,t,e=NaN){const i=n.getAttribute(t);if(i==null)return e;const r=parseFloat(i);return Number.isNaN(r)?e:r}function g3(n,t=1){const e=n.getTotalLength(),i=[];let r=0,o;for(;r<e;)o=n.getPointAtLength(r),i.push({distance:r,x:o.x,y:o.y}),r+=t;return i}function f3(n){return["M",ln(n,"x1"),ln(n,"y1"),"L",ln(n,"x2"),ln(n,"y2")].join(" ")}function p3(n){const t=sp(n);return t.length===0?null:`${_E(t)} Z`}function m3(n){const t=sp(n);return t.length===0?null:_E(t)}function _E(n){return`M ${n.map(e=>`${e.x} ${e.y}`).join(" L")}`}function sp(n){const t=[],e=n.points;if(e)for(let i=0,r=e.numberOfItems;i<r;i+=1)t.push(e.getItem(i));return t}function v3(n){const t=ln(n,"cx",0),e=ln(n,"cy",0),i=ln(n,"r"),r=i*KC;return["M",t,e-i,"C",t+r,e-i,t+i,e-r,t+i,e,"C",t+i,e+r,t+r,e+i,t,e+i,"C",t-r,e+i,t-i,e+r,t-i,e,"C",t-i,e-r,t-r,e-i,t,e-i,"Z"].join(" ")}function b3(n){const t=ln(n,"cx",0),e=ln(n,"cy",0),i=ln(n,"rx"),r=ln(n,"ry")||i,o=i*KC,s=r*KC;return["M",t,e-r,"C",t+o,e-r,t+i,e-s,t+i,e,"C",t+i,e+s,t+o,e+r,t,e+r,"C",t-o,e+r,t-i,e+s,t-i,e,"C",t-i,e-s,t-o,e-r,t,e-r,"Z"].join(" ")}function y3(n){return wE({x:ln(n,"x",0),y:ln(n,"y",0),width:ln(n,"width",0),height:ln(n,"height",0),rx:ln(n,"rx",0),ry:ln(n,"ry",0)})}function wE(n){let t;const e=n.x,i=n.y,r=n.width,o=n.height,s=Math.min(n.rx||n["top-rx"]||0,r/2),a=Math.min(n.rx||n["bottom-rx"]||0,r/2),l=Math.min(n.ry||n["top-ry"]||0,o/2),h=Math.min(n.ry||n["bottom-ry"]||0,o/2);return s||a||l||h?t=["M",e,i+l,"v",o-l-h,"a",a,h,0,0,0,a,h,"h",r-2*a,"a",a,h,0,0,0,a,-h,"v",-(o-h-l),"a",s,l,0,0,0,-s,-l,"h",-(r-2*s),"a",s,l,0,0,0,-s,l,"Z"]:t=["M",e,i,"H",e+r,"V",i+o,"H",e,"V",i,"Z"],t.join(" ")}function C3(n){const t=uo("path");je(t,je(n));const e=xE(n);return e&&t.setAttribute("d",e),t}function xE(n){const t=n.tagName.toLowerCase();switch(t){case"path":return n.getAttribute("d");case"line":return f3(n);case"polygon":return p3(n);case"polyline":return m3(n);case"ellipse":return b3(n);case"circle":return v3(n);case"rect":return y3(n)}throw new Error(`"${t}" cannot be converted to svg path element.`)}const _3=/(\w+)\(([^,)]+),?([^)]+)?\)/gi,SE=/[ ,]+/,w3=/^(\w+)\((.*)\)/;function x3(n,t){const i=uo("svg").createSVGPoint();return i.x=n,i.y=t,i}function Ji(n){const e=uo("svg").createSVGMatrix();if(n!=null){const i=n,r=e;for(const o in i)r[o]=i[o]}return e}function gd(n){const t=uo("svg");return n!=null?(n instanceof DOMMatrix||(n=Ji(n)),t.createSVGTransformFromMatrix(n)):t.createSVGTransform()}function rc(n){let t=Ji();const e=n!=null&&n.match(_3);if(!e)return t;for(let i=0,r=e.length;i<r;i+=1){const s=e[i].match(w3);if(s){let a,l,h,u,d,c=Ji();const g=s[2].split(SE);switch(s[1].toLowerCase()){case"scale":a=parseFloat(g[0]),l=g[1]===void 0?a:parseFloat(g[1]),c=c.scaleNonUniform(a,l);break;case"translate":h=parseFloat(g[0]),u=parseFloat(g[1]),c=c.translate(h,u);break;case"rotate":d=parseFloat(g[0]),h=parseFloat(g[1])||0,u=parseFloat(g[2])||0,h!==0||u!==0?c=c.translate(h,u).rotate(d).translate(-h,-u):c=c.rotate(d);break;case"skewx":d=parseFloat(g[0]),c=c.skewX(d);break;case"skewy":d=parseFloat(g[0]),c=c.skewY(d);break;case"matrix":c.a=parseFloat(g[0]),c.b=parseFloat(g[1]),c.c=parseFloat(g[2]),c.d=parseFloat(g[3]),c.e=parseFloat(g[4]),c.f=parseFloat(g[5]);break;default:continue}t=t.multiply(c)}}return t}function Pu(n){const t=n||{},e=t.a!=null?t.a:1,i=t.b!=null?t.b:0,r=t.c!=null?t.c:0,o=t.d!=null?t.d:1,s=t.e!=null?t.e:0,a=t.f!=null?t.f:0;return`matrix(${e},${i},${r},${o},${s},${a})`}function Dm(n){let t,e,i;if(n){const o=SE;if(n.trim().indexOf("matrix")>=0){const s=rc(n),a=S3(s);t=[a.translateX,a.translateY],e=[a.rotation],i=[a.scaleX,a.scaleY];const l=[];(t[0]!==0||t[1]!==0)&&l.push(`translate(${t.join(",")})`),(i[0]!==1||i[1]!==1)&&l.push(`scale(${i.join(",")})`),e[0]!==0&&l.push(`rotate(${e[0]})`),n=l.join(" ")}else{const s=n.match(/translate\((.*?)\)/);s&&(t=s[1].split(o));const a=n.match(/rotate\((.*?)\)/);a&&(e=a[1].split(o));const l=n.match(/scale\((.*?)\)/);l&&(i=l[1].split(o))}}const r=i&&i[0]?parseFloat(i[0]):1;return{raw:n||"",translation:{tx:t&&t[0]?parseInt(t[0],10):0,ty:t&&t[1]?parseInt(t[1],10):0},rotation:{angle:e&&e[0]?parseInt(e[0],10):0,cx:e&&e[1]?parseInt(e[1],10):void 0,cy:e&&e[2]?parseInt(e[2],10):void 0},scale:{sx:r,sy:i&&i[1]?parseFloat(i[1]):r}}}function ZC(n,t){const e=t.x*n.a+t.y*n.c+0,i=t.x*n.b+t.y*n.d+0;return{x:e,y:i}}function S3(n){const t=ZC(n,{x:0,y:1}),e=ZC(n,{x:1,y:0}),i=180/Math.PI*Math.atan2(t.y,t.x)-90,r=180/Math.PI*Math.atan2(e.y,e.x);return{skewX:i,skewY:r,translateX:n.e,translateY:n.f,scaleX:Math.sqrt(n.a*n.a+n.b*n.b),scaleY:Math.sqrt(n.c*n.c+n.d*n.d),rotation:i}}function A3(n){let t,e,i,r;return n?(t=n.a==null?1:n.a,r=n.d==null?1:n.d,e=n.b,i=n.c):t=r=1,{sx:e?Math.sqrt(t*t+e*e):t,sy:i?Math.sqrt(i*i+r*r):r}}function M3(n){let t={x:0,y:1};n&&(t=ZC(n,t));const e=180*Math.atan2(t.y,t.x)/Math.PI%360-90;return{angle:e%360+(e<0?360:0)}}function T3(n){return{tx:n&&n.e||0,ty:n&&n.f||0}}function Kh(n,t,e={}){if(t==null)return rc(je(n,"transform"));if(e.absolute){n.setAttribute("transform",Pu(t));return}const i=n.transform,r=gd(t);i.baseVal.appendItem(r)}function IS(n,t,e=0,i={}){let r=je(n,"transform");const o=Dm(r);if(t==null)return o.translation;r=o.raw,r=r.replace(/translate\([^)]*\)/g,"").trim();const s=i.absolute?t:o.translation.tx+t,a=i.absolute?e:o.translation.ty+e,l=`translate(${s},${a})`;n.setAttribute("transform",`${l} ${r}`.trim())}function JC(n,t,e,i,r={}){let o=je(n,"transform");const s=Dm(o);if(t==null)return s.rotation;o=s.raw,o=o.replace(/rotate\([^)]*\)/g,"").trim(),t%=360;const a=r.absolute?t:s.rotation.angle+t,l=e!=null&&i!=null?`,${e},${i}`:"",h=`rotate(${a}${l})`;n.setAttribute("transform",`${o} ${h}`.trim())}function QC(n,t,e){let i=je(n,"transform");const r=Dm(i);if(t==null)return r.scale;e=e??t,i=r.raw,i=i.replace(/scale\([^)]*\)/g,"").trim();const o=`scale(${t},${e})`;n.setAttribute("transform",`${i} ${o}`.trim())}function Pd(n,t){if(ha(t)&&ha(n)){const e=t.getScreenCTM(),i=n.getScreenCTM();if(e&&i)return e.inverse().multiply(i)}return Ji()}function R3(n,t){let e=Ji();if(ha(t)&&ha(n)){let i=n;const r=[];for(;i&&i!==t;){const o=i.getAttribute("transform")||null,s=rc(o);r.push(s),i=i.parentNode}r.reverse().forEach(o=>{e=e.multiply(o)})}return e}function B3(n,t,e){const i=n instanceof SVGSVGElement?n:n.ownerSVGElement,r=i.createSVGPoint();r.x=t,r.y=e;try{const o=i.getScreenCTM(),s=r.matrixTransform(o.inverse()),a=Pd(n,i).inverse();return s.matrixTransform(a)}catch{return r}}var Mr;(function(n){const t={};function e(o){return t[o]||{}}n.get=e;function i(o,s){t[o]=s}n.register=i;function r(o){delete t[o]}n.unregister=r})(Mr||(Mr={}));var nl;(function(n){const t=new WeakMap;function e(o){return t.has(o)||t.set(o,{events:Object.create(null)}),t.get(o)}n.ensure=e;function i(o){return t.get(o)}n.get=i;function r(o){return t.delete(o)}n.remove=r})(nl||(nl={}));var Ut;(function(n){n.returnTrue=()=>!0,n.returnFalse=()=>!1;function t(r){r.stopPropagation()}n.stopPropagationCallback=t;function e(r,o,s){r.addEventListener!=null&&r.addEventListener(o,s)}n.addEventListener=e;function i(r,o,s){r.removeEventListener!=null&&r.removeEventListener(o,s)}n.removeEventListener=i})(Ut||(Ut={}));(function(n){const t=/[^\x20\t\r\n\f]+/g,e=/^([^.]*)(?:\.(.+)|)/;function i(a){return(a||"").match(t)||[""]}n.splitType=i;function r(a){const l=e.exec(a)||[];return{originType:l[1]?l[1].trim():l[1],namespaces:l[2]?l[2].split(".").map(h=>h.trim()).sort():[]}}n.normalizeType=r;function o(a){return a.nodeType===1||a.nodeType===9||!+a.nodeType}n.isValidTarget=o;function s(a,l){if(l){const h=a;return h.querySelector!=null&&h.querySelector(l)!=null}return!0}n.isValidSelector=s})(Ut||(Ut={}));(function(n){let t=0;const e=new WeakMap;function i(a){return e.has(a)||(e.set(a,t),t+=1),e.get(a)}n.ensureHandlerId=i;function r(a){return e.get(a)}n.getHandlerId=r;function o(a){return e.delete(a)}n.removeHandlerId=o;function s(a,l){return e.set(a,l)}n.setHandlerId=s})(Ut||(Ut={}));(function(n){function t(e,i){const r=[],o=nl.get(e),s=o&&o.events&&o.events[i.type],a=s&&s.handlers||[],l=s?s.delegateCount:0;if(l>0&&!(i.type==="click"&&typeof i.button=="number"&&i.button>=1)){for(let h=i.target;h!==e;h=h.parentNode||e)if(h.nodeType===1&&!(i.type==="click"&&h.disabled===!0)){const u=[],d={};for(let c=0;c<l;c+=1){const g=a[c],f=g.selector;if(f!=null&&d[f]==null){const p=e,m=[];p.querySelectorAll(f).forEach(v=>{m.push(v)}),d[f]=m.includes(h)}d[f]&&u.push(g)}u.length&&r.push({elem:h,handlers:u})}}return l<a.length&&r.push({elem:e,handlers:a.slice(l)}),r}n.getHandlerQueue=t})(Ut||(Ut={}));(function(n){function t(e){return e!=null&&e===e.window}n.isWindow=t})(Ut||(Ut={}));(function(n){function t(e,i){const r=e.nodeType===9?e.documentElement:e,o=i&&i.parentNode;return e===o||!!(o&&o.nodeType===1&&(r.contains?r.contains(o):e.compareDocumentPosition&&e.compareDocumentPosition(o)&16))}n.contains=t})(Ut||(Ut={}));class Eo{constructor(t,e){this.isDefaultPrevented=Ut.returnFalse,this.isPropagationStopped=Ut.returnFalse,this.isImmediatePropagationStopped=Ut.returnFalse,this.isSimulated=!1,this.preventDefault=()=>{const i=this.originalEvent;this.isDefaultPrevented=Ut.returnTrue,i&&!this.isSimulated&&i.preventDefault()},this.stopPropagation=()=>{const i=this.originalEvent;this.isPropagationStopped=Ut.returnTrue,i&&!this.isSimulated&&i.stopPropagation()},this.stopImmediatePropagation=()=>{const i=this.originalEvent;this.isImmediatePropagationStopped=Ut.returnTrue,i&&!this.isSimulated&&i.stopImmediatePropagation(),this.stopPropagation()},typeof t=="string"?this.type=t:t.type&&(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented?Ut.returnTrue:Ut.returnFalse,this.target=t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget,this.timeStamp=t.timeStamp),e&&Object.assign(this,e),this.timeStamp||(this.timeStamp=Date.now())}}(function(n){function t(e){return e instanceof n?e:new n(e)}n.create=t})(Eo||(Eo={}));(function(n){function t(e,i){Object.defineProperty(n.prototype,e,{enumerable:!0,configurable:!0,get:typeof i=="function"?function(){if(this.originalEvent)return i(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set(r){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:r})}})}n.addProperty=t})(Eo||(Eo={}));(function(n){const t={bubbles:!0,cancelable:!0,eventPhase:!0,detail:!0,view:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pageX:!0,pageY:!0,screenX:!0,screenY:!0,toElement:!0,pointerId:!0,pointerType:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,touches:!0,changedTouches:!0,targetTouches:!0,which:!0,altKey:!0,ctrlKey:!0,metaKey:!0,shiftKey:!0};Object.keys(t).forEach(e=>n.addProperty(e,t[e]))})(Eo||(Eo={}));(function(n){Mr.register("load",{noBubble:!0})})();(function(n){Mr.register("beforeunload",{postDispatch(t,e){e.result!==void 0&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}})})();(function(n){Mr.register("mouseenter",{delegateType:"mouseover",bindType:"mouseover",handle(t,e){let i;const r=e.relatedTarget,o=e.handleObj;return(!r||r!==t&&!Ut.contains(t,r))&&(e.type=o.originType,i=o.handler.call(t,e),e.type="mouseover"),i}}),Mr.register("mouseleave",{delegateType:"mouseout",bindType:"mouseout",handle(t,e){let i;const r=e.relatedTarget,o=e.handleObj;return(!r||r!==t&&!Ut.contains(t,r))&&(e.type=o.originType,i=o.handler.call(t,e),e.type="mouseout"),i}})})();var k3=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e},oc;(function(n){let t;function e(s,a,l,h,u){if(!Ut.isValidTarget(s))return;let d;if(typeof l!="function"){const{handler:p,selector:m}=l,v=k3(l,["handler","selector"]);l=p,u=m,d=v}const c=nl.ensure(s);let g=c.handler;g==null&&(g=c.handler=function(p,...m){return t!==p.type?r(s,p,...m):void 0});const f=Ut.ensureHandlerId(l);Ut.splitType(a).forEach(p=>{const{originType:m,namespaces:v}=Ut.normalizeType(p);if(!m)return;let b=m,y=Mr.get(b);b=(u?y.delegateType:y.bindType)||b,y=Mr.get(b);const C=Object.assign({type:b,originType:m,data:h,selector:u,guid:f,handler:l,namespace:v.join(".")},d),w=c.events;let _=w[b];_||(_=w[b]={handlers:[],delegateCount:0},(!y.setup||y.setup(s,h,v,g)===!1)&&Ut.addEventListener(s,b,g)),y.add&&(Ut.removeHandlerId(C.handler),y.add(s,C),Ut.setHandlerId(C.handler,f)),u?(_.handlers.splice(_.delegateCount,0,C),_.delegateCount+=1):_.handlers.push(C)})}n.on=e;function i(s,a,l,h,u){const d=nl.get(s);if(!d)return;const c=d.events;c&&(Ut.splitType(a).forEach(g=>{const{originType:f,namespaces:p}=Ut.normalizeType(g);if(!f){Object.keys(c).forEach(w=>{i(s,w+g,l,h,!0)});return}let m=f;const v=Mr.get(m);m=(h?v.delegateType:v.bindType)||m;const b=c[m];if(!b)return;const y=p.length>0?new RegExp(`(^|\\.)${p.join("\\.(?:.*\\.|)")}(\\.|$)`):null,C=b.handlers.length;for(let w=b.handlers.length-1;w>=0;w-=1){const _=b.handlers[w];(u||f===_.originType)&&(!l||Ut.getHandlerId(l)===_.guid)&&(y==null||_.namespace&&y.test(_.namespace))&&(h==null||h===_.selector||h==="**"&&_.selector)&&(b.handlers.splice(w,1),_.selector&&(b.delegateCount-=1),v.remove&&v.remove(s,_))}C&&b.handlers.length===0&&((!v.teardown||v.teardown(s,p,d.handler)===!1)&&Ut.removeEventListener(s,m,d.handler),delete c[m])}),Object.keys(c).length===0&&nl.remove(s))}n.off=i;function r(s,a,...l){const h=Eo.create(a);h.delegateTarget=s;const u=Mr.get(h.type);if(u.preDispatch&&u.preDispatch(s,h)===!1)return;const d=Ut.getHandlerQueue(s,h);for(let c=0,g=d.length;c<g&&!h.isPropagationStopped();c+=1){const f=d[c];h.currentTarget=f.elem;for(let p=0,m=f.handlers.length;p<m&&!h.isImmediatePropagationStopped();p+=1){const v=f.handlers[p];if(h.rnamespace==null||v.namespace&&h.rnamespace.test(v.namespace)){h.handleObj=v,h.data=v.data;const b=Mr.get(v.originType).handle,y=b?b(f.elem,h,...l):v.handler.call(f.elem,h,...l);y!==void 0&&(h.result=y,y===!1&&(h.preventDefault(),h.stopPropagation()))}}}return u.postDispatch&&u.postDispatch(s,h),h.result}n.dispatch=r;function o(s,a,l,h){let u=s,d=typeof s=="string"?s:s.type,c=typeof s=="string"||u.namespace==null?[]:u.namespace.split(".");const g=l;if(g.nodeType===3||g.nodeType===8)return;d.indexOf(".")>-1&&(c=d.split("."),d=c.shift(),c.sort());const f=d.indexOf(":")<0&&`on${d}`;u=s instanceof Eo?s:new Eo(d,typeof s=="object"?s:null),u.namespace=c.join("."),u.rnamespace=u.namespace?new RegExp(`(^|\\.)${c.join("\\.(?:.*\\.|)")}(\\.|$)`):null,u.result=void 0,u.target||(u.target=g);const p=[u];Array.isArray(a)?p.push(...a):p.push(a);const m=Mr.get(d);if(!h&&m.trigger&&m.trigger(g,u,a)===!1)return;let v;const b=[g];if(!h&&!m.noBubble&&!Ut.isWindow(g)){v=m.delegateType||d;let C=g,w=g.parentNode;for(;w!=null;)b.push(w),C=w,w=w.parentNode;const _=g.ownerDocument||document;if(C===_){const A=C.defaultView||C.parentWindow||window;b.push(A)}}let y=g;for(let C=0,w=b.length;C<w&&!u.isPropagationStopped();C+=1){const _=b[C];y=_,u.type=C>1?v:m.bindType||d;const A=nl.get(_);A&&A.events[u.type]&&A.handler&&A.handler.call(_,...p);const x=f&&_[f]||null;x&&Ut.isValidTarget(_)&&(u.result=x.call(_,...p),u.result===!1&&u.preventDefault())}if(u.type=d,!h&&!u.isDefaultPrevented()){const C=m.preventDefault;if((C==null||C(b.pop(),u,a)===!1)&&Ut.isValidTarget(g)&&f&&typeof g[d]=="function"&&!Ut.isWindow(g)){const w=g[f];w&&(g[f]=null),t=d,u.isPropagationStopped()&&y.addEventListener(d,Ut.stopPropagationCallback),g[d](),u.isPropagationStopped()&&y.removeEventListener(d,Ut.stopPropagationCallback),t=void 0,w&&(g[f]=w)}}return u.result}n.trigger=o})(oc||(oc={}));var sn;(function(n){function t(o,s,a,l,h){return Ed.on(o,s,a,l,h),o}n.on=t;function e(o,s,a,l,h){return Ed.on(o,s,a,l,h,!0),o}n.once=e;function i(o,s,a,l){return Ed.off(o,s,a,l),o}n.off=i;function r(o,s,a,l){return oc.trigger(s,a,o,l),o}n.trigger=r})(sn||(sn={}));var Ed;(function(n){function t(i,r,o,s,a,l){if(typeof r=="object"){typeof o!="string"&&(s=s||o,o=void 0),Object.keys(r).forEach(h=>t(i,h,o,s,r[h],l));return}if(s==null&&a==null?(a=o,s=o=void 0):a==null&&(typeof o=="string"?(a=s,s=void 0):(a=s,s=o,o=void 0)),a===!1)a=Ut.returnFalse;else if(!a)return;if(l){const h=a;a=function(u,...d){return n.off(i,u),h.call(this,u,...d)},Ut.setHandlerId(a,Ut.ensureHandlerId(h))}oc.on(i,r,a,s,o)}n.on=t;function e(i,r,o,s){const a=r;if(a&&a.preventDefault!=null&&a.handleObj!=null){const l=a.handleObj;e(a.delegateTarget,l.namespace?`${l.originType}.${l.namespace}`:l.originType,l.selector,l.handler);return}if(typeof r=="object"){const l=r;Object.keys(l).forEach(h=>e(i,h,o,l[h]));return}(o===!1||typeof o=="function")&&(s=o,o=void 0),s===!1&&(s=Ut.returnFalse),oc.off(i,r,s,o)}n.off=e})(Ed||(Ed={}));class AE{constructor(t,e,i){this.animationFrameId=0,this.deltaX=0,this.deltaY=0,this.eventName=la.isEventSupported("wheel")?"wheel":"mousewheel",this.target=t,this.onWheelCallback=e,this.onWheelGuard=i,this.onWheel=this.onWheel.bind(this),this.didWheel=this.didWheel.bind(this)}enable(){this.target.addEventListener(this.eventName,this.onWheel,{passive:!1})}disable(){this.target.removeEventListener(this.eventName,this.onWheel)}onWheel(t){if(this.onWheelGuard!=null&&!this.onWheelGuard(t))return;this.deltaX+=t.deltaX,this.deltaY+=t.deltaY,t.preventDefault();let e;(this.deltaX!==0||this.deltaY!==0)&&(t.stopPropagation(),e=!0),e===!0&&this.animationFrameId===0&&(this.animationFrameId=requestAnimationFrame(()=>{this.didWheel(t)}))}didWheel(t){this.animationFrameId=0,this.onWheelCallback(t,this.deltaX,this.deltaY),this.deltaX=0,this.deltaY=0}}function ME(n,t=60){let e=null;return(...i)=>{e&&clearTimeout(e),e=window.setTimeout(()=>{n.apply(this,i)},t)}}function P3(n){let t=null,e=[];const i=()=>{if(getComputedStyle(n).position==="static"){const h=n.style;h.position="relative"}const l=document.createElement("object");return l.onload=()=>{l.contentDocument.defaultView.addEventListener("resize",r),r()},l.style.display="block",l.style.position="absolute",l.style.top="0",l.style.left="0",l.style.height="100%",l.style.width="100%",l.style.overflow="hidden",l.style.pointerEvents="none",l.style.zIndex="-1",l.style.opacity="0",l.setAttribute("tabindex","-1"),l.type="text/html",n.appendChild(l),l.data="about:blank",l},r=ME(()=>{e.forEach(l=>l(n))}),o=l=>{t||(t=i()),e.indexOf(l)===-1&&e.push(l)},s=()=>{t&&t.parentNode&&(t.contentDocument&&t.contentDocument.defaultView.removeEventListener("resize",r),t.parentNode.removeChild(t),t=null,e=[])};return{element:n,bind:o,destroy:s,unbind:l=>{const h=e.indexOf(l);h!==-1&&e.splice(h,1),e.length===0&&t&&s()}}}function E3(n){let t=null,e=[];const i=ME(()=>{e.forEach(l=>{l(n)})}),r=()=>{const l=new ResizeObserver(i);return l.observe(n),i(),l},o=l=>{t||(t=r()),e.indexOf(l)===-1&&e.push(l)},s=()=>{t&&(t.disconnect(),e=[],t=null)};return{element:n,bind:o,destroy:s,unbind:l=>{const h=e.indexOf(l);h!==-1&&e.splice(h,1),e.length===0&&t&&s()}}}const L3=typeof ResizeObserver<"u"?E3:P3;var ap;(function(n){const t=new WeakMap;function e(r){let o=t.get(r);return o||(o=L3(r),t.set(r,o),o)}function i(r){r.destroy(),t.delete(r.element)}n.bind=(r,o)=>{const s=e(r);return s.bind(o),()=>s.unbind(o)},n.clear=r=>{const o=e(r);i(o)}})(ap||(ap={}));class sc{constructor(t={}){this.comparator=t.comparator||sc.defaultComparator,this.index={},this.data=t.data||[],this.heapify()}isEmpty(){return this.data.length===0}insert(t,e,i){const r={priority:t,value:e},o=this.data.length;return i&&(r.id=i,this.index[i]=o),this.data.push(r),this.bubbleUp(o),this}peek(){return this.data[0]?this.data[0].value:null}peekPriority(){return this.data[0]?this.data[0].priority:null}updatePriority(t,e){const i=this.index[t];if(typeof i>"u")throw new Error(`Node with id '${t}' was not found in the heap.`);const r=this.data,o=r[i].priority,s=this.comparator(e,o);s<0?(r[i].priority=e,this.bubbleUp(i)):s>0&&(r[i].priority=e,this.bubbleDown(i))}remove(){const t=this.data,e=t[0],i=t.pop();return e.id&&delete this.index[e.id],t.length>0&&(t[0]=i,i.id&&(this.index[i.id]=0),this.bubbleDown(0)),e?e.value:null}heapify(){for(let t=0;t<this.data.length;t+=1)this.bubbleUp(t)}bubbleUp(t){const e=this.data;let i,r,o=t;for(;o>0&&(r=o-1>>>1,this.comparator(e[o].priority,e[r].priority)<0);){i=e[r],e[r]=e[o];let s=e[o].id;s!=null&&(this.index[s]=r),e[o]=i,s=e[o].id,s!=null&&(this.index[s]=o),o=r}}bubbleDown(t){const e=this.data,i=e.length-1;let r=t;for(;;){const o=(r<<1)+1,s=o+1;let a=r;if(o<=i&&this.comparator(e[o].priority,e[a].priority)<0&&(a=o),s<=i&&this.comparator(e[s].priority,e[a].priority)<0&&(a=s),a!==r){const l=e[a];e[a]=e[r];let h=e[r].id;h!=null&&(this.index[h]=a),e[r]=l,h=e[r].id,h!=null&&(this.index[h]=r),r=a}else break}}}(function(n){n.defaultComparator=(t,e)=>t-e})(sc||(sc={}));var t_;(function(n){function t(e,i,r=(o,s)=>1){const o={},s={},a={},l=new sc;for(o[i]=0,Object.keys(e).forEach(h=>{h!==i&&(o[h]=1/0),l.insert(o[h],h,h)});!l.isEmpty();){const h=l.remove();a[h]=!0;const u=e[h]||[];for(let d=0;d<u.length;d+=1){const c=u[d];if(!a[c]){const g=o[h]+r(h,c);g<o[c]&&(o[c]=g,s[c]=h,l.updatePriority(c,g))}}}return s}n.run=t})(t_||(t_={}));let lp=class fd{constructor(t,e,i,r){if(t==null)return this.set(255,255,255,1);if(typeof t=="number")return this.set(t,e,i,r);if(typeof t=="string")return fd.fromString(t)||this;if(Array.isArray(t))return this.set(t);this.set(t.r,t.g,t.b,t.a==null?1:t.a)}blend(t,e,i){this.set(t.r+(e.r-t.r)*i,t.g+(e.g-t.g)*i,t.b+(e.b-t.b)*i,t.a+(e.a-t.a)*i)}lighten(t){const e=fd.lighten(this.toArray(),t);this.r=e[0],this.g=e[1],this.b=e[2],this.a=e[3]}darken(t){this.lighten(-t)}set(t,e,i,r){const o=Array.isArray(t)?t[0]:t,s=Array.isArray(t)?t[1]:e,a=Array.isArray(t)?t[2]:i,l=Array.isArray(t)?t[3]:r;return this.r=Math.round(Br(o,0,255)),this.g=Math.round(Br(s,0,255)),this.b=Math.round(Br(a,0,255)),this.a=l==null?1:Br(l,0,1),this}toHex(){return`#${["r","g","b"].map(e=>{const i=this[e].toString(16);return i.length<2?`0${i}`:i}).join("")}`}toRGBA(){return this.toArray()}toHSLA(){return fd.rgba2hsla(this.r,this.g,this.b,this.a)}toCSS(t){const e=`${this.r},${this.g},${this.b},`;return t?`rgb(${e})`:`rgba(${e},${this.a})`}toGrey(){return fd.makeGrey(Math.round((this.r+this.g+this.b)/3),this.a)}toArray(){return[this.r,this.g,this.b,this.a]}toString(){return this.toCSS()}};(function(n){function t(y){return new n(y)}n.fromArray=t;function e(y){return new n([...f(y),1])}n.fromHex=e;function i(y){const C=y.toLowerCase().match(/^rgba?\(([\s.,0-9]+)\)/);if(C){const w=C[1].split(/\s*,\s*/).map(_=>parseInt(_,10));return new n(w)}return null}n.fromRGBA=i;function r(y,C,w){w<0&&++w,w>1&&--w;const _=6*w;return _<1?y+(C-y)*_:2*w<1?C:3*w<2?y+(C-y)*(2/3-w)*6:y}function o(y){const C=y.toLowerCase().match(/^hsla?\(([\s.,0-9]+)\)/);if(C){const w=C[2].split(/\s*,\s*/),_=(parseFloat(w[0])%360+360)%360/360,A=parseFloat(w[1])/100,x=parseFloat(w[2])/100,S=w[3]==null?1:parseInt(w[3],10);return new n(h(_,A,x,S))}return null}n.fromHSLA=o;function s(y){if(y.startsWith("#"))return e(y);if(y.startsWith("rgb"))return i(y);const C=n.named[y];return C?e(C):o(y)}n.fromString=s;function a(y,C){return n.fromArray([y,y,y,C])}n.makeGrey=a;function l(y,C,w,_){const A=Array.isArray(y)?y[0]:y,x=Array.isArray(y)?y[1]:C,S=Array.isArray(y)?y[2]:w,T=Array.isArray(y)?y[3]:_,M=Math.max(A,x,S),R=Math.min(A,x,S),E=(M+R)/2;let P=0,B=0;if(R!==M){const k=M-R;switch(B=E>.5?k/(2-M-R):k/(M+R),M){case A:P=(x-S)/k+(x<S?6:0);break;case x:P=(S-A)/k+2;break;case S:P=(A-x)/k+4;break}P/=6}return[P,B,E,T??1]}n.rgba2hsla=l;function h(y,C,w,_){const A=Array.isArray(y)?y[0]:y,x=Array.isArray(y)?y[1]:C,S=Array.isArray(y)?y[2]:w,T=Array.isArray(y)?y[3]:_,M=S<=.5?S*(x+1):S+x-S*x,R=2*S-M;return[r(R,M,A+1/3)*256,r(R,M,A)*256,r(R,M,A-1/3)*256,T??1]}n.hsla2rgba=h;function u(y){return new n(Math.round(Math.random()*256),Math.round(Math.random()*256),Math.round(Math.random()*256),y?void 0:parseFloat(Math.random().toFixed(2)))}n.random=u;function d(){const y="0123456789ABCDEF";let C="#";for(let w=0;w<6;w+=1)C+=y[Math.floor(Math.random()*16)];return C}n.randomHex=d;function c(y){return u(y).toString()}n.randomRGBA=c;function g(y,C){if(typeof y=="string"){const S=y[0]==="#",[T,M,R]=f(y);return C?T*.299+M*.587+R*.114>186?"#000000":"#ffffff":`${S?"#":""}${p(255-T,255-M,255-R)}`}const w=y[0],_=y[1],A=y[2],x=y[3];return C?w*.299+_*.587+A*.114>186?[0,0,0,x]:[255,255,255,x]:[255-w,255-_,255-A,x]}n.invert=g;function f(y){const C=y.indexOf("#")===0?y:`#${y}`;let w=+`0x${C.substr(1)}`;if(!(C.length===4||C.length===7)||Number.isNaN(w))throw new Error("Invalid hex color.");const _=C.length===4?4:8,A=(1<<_)-1,x=["b","g","r"].map(()=>{const S=w&A;return w>>=_,_===4?17*S:S});return[x[2],x[1],x[0]]}function p(y,C,w){const _=A=>A.length<2?`0${A}`:A;return`${_(y.toString(16))}${_(C.toString(16))}${_(w.toString(16))}`}function m(y,C){return b(y,C)}n.lighten=m;function v(y,C){return b(y,-C)}n.darken=v;function b(y,C){if(typeof y=="string"){const A=y[0]==="#",x=parseInt(A?y.substr(1):y,16),S=Br((x>>16)+C,0,255),T=Br((x>>8&255)+C,0,255),M=Br((x&255)+C,0,255);return`${A?"#":""}${(M|T<<8|S<<16).toString(16)}`}const w=p(y[0],y[1],y[2]),_=f(b(w,C));return[_[0],_[1],_[2],y[3]]}})(lp||(lp={}));(function(n){n.named={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",burntsienna:"#ea7e5d",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}})(lp||(lp={}));class e_{constructor(){this.clear()}clear(){this.map=new WeakMap,this.arr=[]}has(t){return this.map.has(t)}get(t){return this.map.get(t)}set(t,e){this.map.set(t,e),this.arr.push(t)}delete(t){const e=this.arr.indexOf(t);e>=0&&this.arr.splice(e,1);const i=this.map.get(t);return this.map.delete(t),i}each(t){this.arr.forEach(e=>{const i=this.map.get(e);t(i,e)})}dispose(){this.clear()}}var Zh;(function(n){function t(r){const o=[],s=[];return Array.isArray(r)?o.push(...r):r.split("|").forEach(a=>{a.indexOf("&")===-1?o.push(a):s.push(...a.split("&"))}),{or:o,and:s}}n.parse=t;function e(r,o){if(r!=null&&o!=null){const s=t(r),a=t(o),l=s.or.sort(),h=a.or.sort(),u=s.and.sort(),d=a.and.sort(),c=(g,f)=>g.length===f.length&&(g.length===0||g.every((p,m)=>p===f[m]));return c(l,h)&&c(u,d)}return r==null&&o==null}n.equals=e;function i(r,o,s){if(o==null||Array.isArray(o)&&o.length===0)return s?r.altKey!==!0&&r.ctrlKey!==!0&&r.metaKey!==!0&&r.shiftKey!==!0:!0;const{or:a,and:l}=t(o),h=u=>{const d=`${u.toLowerCase()}Key`;return r[d]===!0};return a.some(u=>h(u))&&l.every(u=>h(u))}n.isMatch=i})(Zh||(Zh={}));var kl;(function(n){n.linear=t=>t,n.quad=t=>t*t,n.cubic=t=>t*t*t,n.inout=t=>{if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)},n.exponential=t=>Math.pow(2,10*(t-1)),n.bounce=(t=>{for(let e=0,i=1;;e+=i,i/=2)if(t>=(7-4*e)/11){const r=(11-6*e-11*t)/4;return-r*r+i*i}})})(kl||(kl={}));(function(n){n.decorators={reverse(t){return e=>1-t(1-e)},reflect(t){return e=>.5*(e<.5?t(2*e):2-t(2-2*e))},clamp(t,e=0,i=1){return r=>{const o=t(r);return o<e?e:o>i?i:o}},back(t=1.70158){return e=>e*e*((t+1)*e-t)},elastic(t=1.5){return e=>Math.pow(2,10*(e-1))*Math.cos(20*Math.PI*t/3*e)}}})(kl||(kl={}));(function(n){function t(B){return-1*Math.cos(B*(Math.PI/2))+1}n.easeInSine=t;function e(B){return Math.sin(B*(Math.PI/2))}n.easeOutSine=e;function i(B){return-.5*(Math.cos(Math.PI*B)-1)}n.easeInOutSine=i;function r(B){return B*B}n.easeInQuad=r;function o(B){return B*(2-B)}n.easeOutQuad=o;function s(B){return B<.5?2*B*B:-1+(4-2*B)*B}n.easeInOutQuad=s;function a(B){return B*B*B}n.easeInCubic=a;function l(B){const k=B-1;return k*k*k+1}n.easeOutCubic=l;function h(B){return B<.5?4*B*B*B:(B-1)*(2*B-2)*(2*B-2)+1}n.easeInOutCubic=h;function u(B){return B*B*B*B}n.easeInQuart=u;function d(B){const k=B-1;return 1-k*k*k*k}n.easeOutQuart=d;function c(B){const k=B-1;return B<.5?8*B*B*B*B:1-8*k*k*k*k}n.easeInOutQuart=c;function g(B){return B*B*B*B*B}n.easeInQuint=g;function f(B){const k=B-1;return 1+k*k*k*k*k}n.easeOutQuint=f;function p(B){const k=B-1;return B<.5?16*B*B*B*B*B:1+16*k*k*k*k*k}n.easeInOutQuint=p;function m(B){return B===0?0:Math.pow(2,10*(B-1))}n.easeInExpo=m;function v(B){return B===1?1:-Math.pow(2,-10*B)+1}n.easeOutExpo=v;function b(B){if(B===0||B===1)return B;const k=B*2,L=k-1;return k<1?.5*Math.pow(2,10*L):.5*(-Math.pow(2,-10*L)+2)}n.easeInOutExpo=b;function y(B){const k=B/1;return-1*(Math.sqrt(1-k*B)-1)}n.easeInCirc=y;function C(B){const k=B-1;return Math.sqrt(1-k*k)}n.easeOutCirc=C;function w(B){const k=B*2,L=k-2;return k<1?-.5*(Math.sqrt(1-k*k)-1):.5*(Math.sqrt(1-L*L)+1)}n.easeInOutCirc=w;function _(B,k=1.70158){return B*B*((k+1)*B-k)}n.easeInBack=_;function A(B,k=1.70158){const L=B/1-1;return L*L*((k+1)*L+k)+1}n.easeOutBack=A;function x(B,k=1.70158){const L=B*2,O=L-2,I=k*1.525;return L<1?.5*L*L*((I+1)*L-I):.5*(O*O*((I+1)*O+I)+2)}n.easeInOutBack=x;function S(B,k=.7){if(B===0||B===1)return B;const O=B/1-1,I=1-k,H=I/(2*Math.PI)*Math.asin(1);return-(Math.pow(2,10*O)*Math.sin((O-H)*(2*Math.PI)/I))}n.easeInElastic=S;function T(B,k=.7){const L=1-k,O=B*2;if(B===0||B===1)return B;const I=L/(2*Math.PI)*Math.asin(1);return Math.pow(2,-10*O)*Math.sin((O-I)*(2*Math.PI)/L)+1}n.easeOutElastic=T;function M(B,k=.65){const L=1-k;if(B===0||B===1)return B;const O=B*2,I=O-1,H=L/(2*Math.PI)*Math.asin(1);return O<1?-.5*(Math.pow(2,10*I)*Math.sin((I-H)*(2*Math.PI)/L)):Math.pow(2,-10*I)*Math.sin((I-H)*(2*Math.PI)/L)*.5+1}n.easeInOutElastic=M;function R(B){const k=B/1;if(k<1/2.75)return 7.5625*k*k;if(k<2/2.75){const L=k-.5454545454545454;return 7.5625*L*L+.75}if(k<2.5/2.75){const L=k-.8181818181818182;return 7.5625*L*L+.9375}{const L=k-.9545454545454546;return 7.5625*L*L+.984375}}n.easeOutBounce=R;function E(B){return 1-R(1-B)}n.easeInBounce=E;function P(B){return B<.5?E(B*2)*.5:R(B*2-1)*.5+.5}n.easeInOutBounce=P})(kl||(kl={}));var rl;(function(n){n.number=(t,e)=>{const i=e-t;return r=>t+i*r},n.object=(t,e)=>{const i=Object.keys(t);return r=>{const o={};for(let s=i.length-1;s!==-1;s-=1){const a=i[s];o[a]=t[a]+(e[a]-t[a])*r}return o}},n.unit=(t,e)=>{const i=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/,r=i.exec(t),o=i.exec(e),s=o?o[1]:"",a=r?+r[1]:0,l=o?+o[1]:0,h=s.indexOf("."),u=h>0?s[1].length-h-1:0,d=l-a,c=r?r[2]:"";return g=>(a+d*g).toFixed(u)+c},n.color=(t,e)=>{const i=parseInt(t.slice(1),16),r=parseInt(e.slice(1),16),o=i&255,s=(r&255)-o,a=i&65280,l=(r&65280)-a,h=i&16711680,u=(r&16711680)-h;return d=>{const c=o+s*d&255,g=a+l*d&65280,f=h+u*d&16711680;return`#${(1<<24|c|g|f).toString(16).slice(1)}`}}})(rl||(rl={}));const Ld=[];function O3(n,t){const e=Ld.find(i=>i.name===n);if(!(e&&(e.loadTimes+=1,e.loadTimes>1))&&!la.isApplyingHMR()){const i=document.createElement("style");i.setAttribute("type","text/css"),i.textContent=t;const r=document.querySelector("head");r&&r.insertBefore(i,r.firstChild),Ld.push({name:n,loadTimes:1,styleElement:i})}}function I3(n){const t=Ld.findIndex(e=>e.name===n);if(t>-1){const e=Ld[t];if(e.loadTimes-=1,e.loadTimes>0)return;let i=e.styleElement;i&&i.parentNode&&i.parentNode.removeChild(i),i=null,Ld.splice(t,1)}}var We;(function(n){function t(i){return 180*i/Math.PI%360}n.toDeg=t,n.toRad=function(i,r=!1){return(r?i:i%360)*Math.PI/180};function e(i){return i%360+(i<0?360:0)}n.normalize=e})(We||(We={}));var Ne;(function(n){function t(a,l=0){return Number.isInteger(a)?a:+a.toFixed(l)}n.round=t;function e(a,l){let h,u;if(l==null?(u=a??1,h=0):(u=l,h=a??0),u<h){const d=h;h=u,u=d}return Math.floor(Math.random()*(u-h+1)+h)}n.random=e;function i(a,l,h){return Number.isNaN(a)?NaN:Number.isNaN(l)||Number.isNaN(h)?0:l<h?a<l?l:a>h?h:a:a<h?h:a>l?l:a}n.clamp=i;function r(a,l){return l*Math.round(a/l)}n.snapToGrid=r;function o(a,l){return l!=null&&a!=null&&l.x>=a.x&&l.x<=a.x+a.width&&l.y>=a.y&&l.y<=a.y+a.height}n.containsPoint=o;function s(a,l){const h=a.x-l.x,u=a.y-l.y;return h*h+u*u}n.squaredLength=s})(Ne||(Ne={}));class xa{valueOf(){return this.toJSON()}toString(){return JSON.stringify(this.toJSON())}}let Y=class Me extends xa{constructor(t,e){super(),this.x=t??0,this.y=e??0}round(t=0){return this.x=Ne.round(this.x,t),this.y=Ne.round(this.y,t),this}add(t,e){const i=Me.create(t,e);return this.x+=i.x,this.y+=i.y,this}update(t,e){const i=Me.create(t,e);return this.x=i.x,this.y=i.y,this}translate(t,e){const i=Me.create(t,e);return this.x+=i.x,this.y+=i.y,this}rotate(t,e){const i=Me.rotate(this,t,e);return this.x=i.x,this.y=i.y,this}scale(t,e,i=new Me){const r=Me.create(i);return this.x=r.x+t*(this.x-r.x),this.y=r.y+e*(this.y-r.y),this}closest(t){if(t.length===1)return Me.create(t[0]);let e=null,i=1/0;return t.forEach(r=>{const o=this.squaredDistance(r);o<i&&(e=r,i=o)}),e?Me.create(e):null}distance(t){return Math.sqrt(this.squaredDistance(t))}squaredDistance(t){const e=Me.create(t),i=this.x-e.x,r=this.y-e.y;return i*i+r*r}manhattanDistance(t){const e=Me.create(t);return Math.abs(e.x-this.x)+Math.abs(e.y-this.y)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)||.01}theta(t=new Me){const e=Me.create(t),i=-(e.y-this.y),r=e.x-this.x;let o=Math.atan2(i,r);return o<0&&(o=2*Math.PI+o),180*o/Math.PI}angleBetween(t,e){if(this.equals(t)||this.equals(e))return NaN;let i=this.theta(e)-this.theta(t);return i<0&&(i+=360),i}vectorAngle(t){return new Me(0,0).angleBetween(this,t)}toPolar(t){return this.update(Me.toPolar(this,t)),this}changeInAngle(t,e,i=new Me){return this.clone().translate(-t,-e).theta(i)-this.theta(i)}adhereToRect(t){return Ne.containsPoint(t,this)||(this.x=Math.min(Math.max(this.x,t.x),t.x+t.width),this.y=Math.min(Math.max(this.y,t.y),t.y+t.height)),this}bearing(t){const e=Me.create(t),i=We.toRad(this.y),r=We.toRad(e.y),o=this.x,s=e.x,a=We.toRad(s-o),l=Math.sin(a)*Math.cos(r),h=Math.cos(i)*Math.sin(r)-Math.sin(i)*Math.cos(r)*Math.cos(a),u=We.toDeg(Math.atan2(l,h)),d=["NE","E","SE","S","SW","W","NW","N"];let c=u-22.5;return c<0&&(c+=360),c=parseInt(c/45,10),d[c]}cross(t,e){if(t!=null&&e!=null){const i=Me.create(t),r=Me.create(e);return(r.x-this.x)*(i.y-this.y)-(r.y-this.y)*(i.x-this.x)}return NaN}dot(t){const e=Me.create(t);return this.x*e.x+this.y*e.y}diff(t,e){if(typeof t=="number")return new Me(this.x-t,this.y-e);const i=Me.create(t);return new Me(this.x-i.x,this.y-i.y)}lerp(t,e){const i=Me.create(t);return new Me((1-e)*this.x+e*i.x,(1-e)*this.y+e*i.y)}normalize(t=1){const e=t/this.magnitude();return this.scale(e,e)}move(t,e){const i=Me.create(t),r=We.toRad(i.theta(this));return this.translate(Math.cos(r)*e,-Math.sin(r)*e)}reflection(t){return Me.create(t).move(this,this.distance(t))}snapToGrid(t,e){return this.x=Ne.snapToGrid(this.x,t),this.y=Ne.snapToGrid(this.y,e??t),this}equals(t){const e=Me.create(t);return e!=null&&e.x===this.x&&e.y===this.y}clone(){return Me.clone(this)}toJSON(){return Me.toJSON(this)}serialize(){return`${this.x} ${this.y}`}};(function(n){function t(e){return e!=null&&e instanceof n}n.isPoint=t})(Y||(Y={}));(function(n){function t(i){return i!=null&&typeof i=="object"&&typeof i.x=="number"&&typeof i.y=="number"}n.isPointLike=t;function e(i){return i!=null&&Array.isArray(i)&&i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"}n.isPointData=e})(Y||(Y={}));(function(n){function t(d,c){return d==null||typeof d=="number"?new n(d,c):e(d)}n.create=t;function e(d){return n.isPoint(d)?new n(d.x,d.y):Array.isArray(d)?new n(d[0],d[1]):new n(d.x,d.y)}n.clone=e;function i(d){return n.isPoint(d)?{x:d.x,y:d.y}:Array.isArray(d)?{x:d[0],y:d[1]}:{x:d.x,y:d.y}}n.toJSON=i;function r(d,c,g=new n){let f=Math.abs(d*Math.cos(c)),p=Math.abs(d*Math.sin(c));const m=e(g),v=We.normalize(We.toDeg(c));return v<90?p=-p:v<180?(f=-f,p=-p):v<270&&(f=-f),new n(m.x+f,m.y+p)}n.fromPolar=r;function o(d,c=new n){const g=e(d),f=e(c),p=g.x-f.x,m=g.y-f.y;return new n(Math.sqrt(p*p+m*m),We.toRad(f.theta(g)))}n.toPolar=o;function s(d,c){return d===c?!0:d!=null&&c!=null?d.x===c.x&&d.y===c.y:!1}n.equals=s;function a(d,c){if(d==null&&c!=null||d!=null&&c==null||d!=null&&c!=null&&d.length!==c.length)return!1;if(d!=null&&c!=null){for(let g=0,f=d.length;g<f;g+=1)if(!s(d[g],c[g]))return!1}return!0}n.equalPoints=a;function l(d,c,g,f){return new n(Ne.random(d,c),Ne.random(g,f))}n.random=l;function h(d,c,g){const f=We.toRad(We.normalize(-c)),p=Math.sin(f),m=Math.cos(f);return u(d,m,p,g)}n.rotate=h;function u(d,c,g,f=new n){const p=e(d),m=e(f),v=p.x-m.x,b=p.y-m.y,y=v*c-b*g,C=b*c+v*g;return new n(y+m.x,C+m.y)}n.rotateEx=u})(Y||(Y={}));class vt extends xa{get left(){return this.x}get top(){return this.y}get right(){return this.x+this.width}get bottom(){return this.y+this.height}get origin(){return new Y(this.x,this.y)}get topLeft(){return new Y(this.x,this.y)}get topCenter(){return new Y(this.x+this.width/2,this.y)}get topRight(){return new Y(this.x+this.width,this.y)}get center(){return new Y(this.x+this.width/2,this.y+this.height/2)}get bottomLeft(){return new Y(this.x,this.y+this.height)}get bottomCenter(){return new Y(this.x+this.width/2,this.y+this.height)}get bottomRight(){return new Y(this.x+this.width,this.y+this.height)}get corner(){return new Y(this.x+this.width,this.y+this.height)}get rightMiddle(){return new Y(this.x+this.width,this.y+this.height/2)}get leftMiddle(){return new Y(this.x,this.y+this.height/2)}get topLine(){return new kt(this.topLeft,this.topRight)}get rightLine(){return new kt(this.topRight,this.bottomRight)}get bottomLine(){return new kt(this.bottomLeft,this.bottomRight)}get leftLine(){return new kt(this.topLeft,this.bottomLeft)}constructor(t,e,i,r){super(),this.x=t??0,this.y=e??0,this.width=i??0,this.height=r??0}getOrigin(){return this.origin}getTopLeft(){return this.topLeft}getTopCenter(){return this.topCenter}getTopRight(){return this.topRight}getCenter(){return this.center}getCenterX(){return this.x+this.width/2}getCenterY(){return this.y+this.height/2}getBottomLeft(){return this.bottomLeft}getBottomCenter(){return this.bottomCenter}getBottomRight(){return this.bottomRight}getCorner(){return this.corner}getRightMiddle(){return this.rightMiddle}getLeftMiddle(){return this.leftMiddle}getTopLine(){return this.topLine}getRightLine(){return this.rightLine}getBottomLine(){return this.bottomLine}getLeftLine(){return this.leftLine}bbox(t){if(!t)return this.clone();const e=We.toRad(t),i=Math.abs(Math.sin(e)),r=Math.abs(Math.cos(e)),o=this.width*r+this.height*i,s=this.width*i+this.height*r;return new vt(this.x+(this.width-o)/2,this.y+(this.height-s)/2,o,s)}round(t=0){return this.x=Ne.round(this.x,t),this.y=Ne.round(this.y,t),this.width=Ne.round(this.width,t),this.height=Ne.round(this.height,t),this}add(t,e,i,r){const o=vt.create(t,e,i,r),s=Math.min(this.x,o.x),a=Math.min(this.y,o.y),l=Math.max(this.x+this.width,o.x+o.width),h=Math.max(this.y+this.height,o.y+o.height);return this.x=s,this.y=a,this.width=l-s,this.height=h-a,this}update(t,e,i,r){const o=vt.create(t,e,i,r);return this.x=o.x,this.y=o.y,this.width=o.width,this.height=o.height,this}inflate(t,e){const i=t,r=e??t;return this.x-=i,this.y-=r,this.width+=2*i,this.height+=2*r,this}snapToGrid(t,e){const i=this.origin.snapToGrid(t,e),r=this.corner.snapToGrid(t,e);return this.x=i.x,this.y=i.y,this.width=r.x-i.x,this.height=r.y-i.y,this}translate(t,e){const i=Y.create(t,e);return this.x+=i.x,this.y+=i.y,this}scale(t,e,i=new Y){const r=this.origin.scale(t,e,i);return this.x=r.x,this.y=r.y,this.width*=t,this.height*=e,this}rotate(t,e=this.getCenter()){if(t!==0){const i=We.toRad(t),r=Math.cos(i),o=Math.sin(i);let s=this.getOrigin(),a=this.getTopRight(),l=this.getBottomRight(),h=this.getBottomLeft();s=Y.rotateEx(s,r,o,e),a=Y.rotateEx(a,r,o,e),l=Y.rotateEx(l,r,o,e),h=Y.rotateEx(h,r,o,e);const u=new vt(s.x,s.y,0,0);u.add(a.x,a.y,0,0),u.add(l.x,l.y,0,0),u.add(h.x,h.y,0,0),this.update(u)}return this}rotate90(){const t=(this.width-this.height)/2;this.x+=t,this.y-=t;const e=this.width;return this.width=this.height,this.height=e,this}moveAndExpand(t){const e=vt.clone(t);return this.x+=e.x||0,this.y+=e.y||0,this.width+=e.width||0,this.height+=e.height||0,this}getMaxScaleToFit(t,e=this.center){const i=vt.clone(t),r=e.x,o=e.y;let s=1/0,a=1/0,l=1/0,h=1/0,u=1/0,d=1/0,c=1/0,g=1/0;const f=i.topLeft;f.x<r&&(s=(this.x-r)/(f.x-r)),f.y<o&&(u=(this.y-o)/(f.y-o));const p=i.bottomRight;p.x>r&&(a=(this.x+this.width-r)/(p.x-r)),p.y>o&&(d=(this.y+this.height-o)/(p.y-o));const m=i.topRight;m.x>r&&(l=(this.x+this.width-r)/(m.x-r)),m.y<o&&(c=(this.y-o)/(m.y-o));const v=i.bottomLeft;return v.x<r&&(h=(this.x-r)/(v.x-r)),v.y>o&&(g=(this.y+this.height-o)/(v.y-o)),{sx:Math.min(s,a,l,h),sy:Math.min(u,d,c,g)}}getMaxUniformScaleToFit(t,e=this.center){const i=this.getMaxScaleToFit(t,e);return Math.min(i.sx,i.sy)}containsPoint(t,e){return Ne.containsPoint(this,Y.create(t,e))}containsRect(t,e,i,r){const o=vt.create(t,e,i,r),s=this.x,a=this.y,l=this.width,h=this.height,u=o.x,d=o.y,c=o.width,g=o.height;return l===0||h===0||c===0||g===0?!1:u>=s&&d>=a&&u+c<=s+l&&d+g<=a+h}intersectsWithLine(t){const e=[this.topLine,this.rightLine,this.bottomLine,this.leftLine],i=[],r=[];return e.forEach(o=>{const s=t.intersectsWithLine(o);s!==null&&r.indexOf(s.toString())<0&&(i.push(s),r.push(s.toString()))}),i.length>0?i:null}intersectsWithLineFromCenterToPoint(t,e){const i=Y.clone(t),r=this.center;let o=null;e!=null&&e!==0&&i.rotate(e,r);const s=[this.topLine,this.rightLine,this.bottomLine,this.leftLine],a=new kt(r,i);for(let l=s.length-1;l>=0;l-=1){const h=s[l].intersectsWithLine(a);if(h!==null){o=h;break}}return o&&e!=null&&e!==0&&o.rotate(-e,r),o}intersectsWithRect(t,e,i,r){const o=vt.create(t,e,i,r);if(!this.isIntersectWithRect(o))return null;const s=this.origin,a=this.corner,l=o.origin,h=o.corner,u=Math.max(s.x,l.x),d=Math.max(s.y,l.y);return new vt(u,d,Math.min(a.x,h.x)-u,Math.min(a.y,h.y)-d)}isIntersectWithRect(t,e,i,r){const o=vt.create(t,e,i,r),s=this.origin,a=this.corner,l=o.origin,h=o.corner;return!(h.x<=s.x||h.y<=s.y||l.x>=a.x||l.y>=a.y)}normalize(){let t=this.x,e=this.y,i=this.width,r=this.height;return this.width<0&&(t=this.x+this.width,i=-this.width),this.height<0&&(e=this.y+this.height,r=-this.height),this.x=t,this.y=e,this.width=i,this.height=r,this}union(t){const e=vt.clone(t),i=this.origin,r=this.corner,o=e.origin,s=e.corner,a=Math.min(i.x,o.x),l=Math.min(i.y,o.y),h=Math.max(r.x,s.x),u=Math.max(r.y,s.y);return new vt(a,l,h-a,u-l)}getNearestSideToPoint(t){const e=Y.clone(t),i=e.x-this.x,r=this.x+this.width-e.x,o=e.y-this.y,s=this.y+this.height-e.y;let a=i,l="left";return r<a&&(a=r,l="right"),o<a&&(a=o,l="top"),s<a&&(l="bottom"),l}getNearestPointToPoint(t){const e=Y.clone(t);if(this.containsPoint(e)){const i=this.getNearestSideToPoint(e);if(i==="left")return new Y(this.x,e.y);if(i==="top")return new Y(e.x,this.y);if(i==="right")return new Y(this.x+this.width,e.y);if(i==="bottom")return new Y(e.x,this.y+this.height)}return e.adhereToRect(this)}equals(t){return t!=null&&t.x===this.x&&t.y===this.y&&t.width===this.width&&t.height===this.height}clone(){return new vt(this.x,this.y,this.width,this.height)}toJSON(){return{x:this.x,y:this.y,width:this.width,height:this.height}}serialize(){return`${this.x} ${this.y} ${this.width} ${this.height}`}}(function(n){function t(e){return e!=null&&e instanceof n}n.isRectangle=t})(vt||(vt={}));(function(n){function t(e){return e!=null&&typeof e=="object"&&typeof e.x=="number"&&typeof e.y=="number"&&typeof e.width=="number"&&typeof e.height=="number"}n.isRectangleLike=t})(vt||(vt={}));(function(n){function t(s,a,l,h){return s==null||typeof s=="number"?new n(s,a,l,h):e(s)}n.create=t;function e(s){return n.isRectangle(s)?s.clone():Array.isArray(s)?new n(s[0],s[1],s[2],s[3]):new n(s.x,s.y,s.width,s.height)}n.clone=e;function i(s){return new n(s.x-s.a,s.y-s.b,2*s.a,2*s.b)}n.fromEllipse=i;function r(s){return new n(0,0,s.width,s.height)}n.fromSize=r;function o(s,a){return new n(s.x,s.y,a.width,a.height)}n.fromPositionAndSize=o})(vt||(vt={}));let kt=class jr extends xa{get center(){return new Y((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)}constructor(t,e,i,r){super(),typeof t=="number"&&typeof e=="number"?(this.start=new Y(t,e),this.end=new Y(i,r)):(this.start=Y.create(t),this.end=Y.create(e))}getCenter(){return this.center}round(t=0){return this.start.round(t),this.end.round(t),this}translate(t,e){return typeof t=="number"?(this.start.translate(t,e),this.end.translate(t,e)):(this.start.translate(t),this.end.translate(t)),this}rotate(t,e){return this.start.rotate(t,e),this.end.rotate(t,e),this}scale(t,e,i){return this.start.scale(t,e,i),this.end.scale(t,e,i),this}length(){return Math.sqrt(this.squaredLength())}squaredLength(){const t=this.start.x-this.end.x,e=this.start.y-this.end.y;return t*t+e*e}setLength(t){const e=this.length();if(!e)return this;const i=t/e;return this.scale(i,i,this.start)}parallel(t){const e=this.clone();if(!e.isDifferentiable())return e;const{start:i,end:r}=e,o=i.clone().rotate(270,r),s=r.clone().rotate(90,i);return i.move(s,t),r.move(o,t),e}vector(){return new Y(this.end.x-this.start.x,this.end.y-this.start.y)}angle(){const t=new Y(this.start.x+1,this.start.y);return this.start.angleBetween(this.end,t)}bbox(){const t=Math.min(this.start.x,this.end.x),e=Math.min(this.start.y,this.end.y),i=Math.max(this.start.x,this.end.x),r=Math.max(this.start.y,this.end.y);return new vt(t,e,i-t,r-e)}bearing(){return this.start.bearing(this.end)}closestPoint(t){return this.pointAt(this.closestPointNormalizedLength(t))}closestPointLength(t){return this.closestPointNormalizedLength(t)*this.length()}closestPointTangent(t){return this.tangentAt(this.closestPointNormalizedLength(t))}closestPointNormalizedLength(t){const e=this.vector().dot(new jr(this.start,t).vector()),i=Math.min(1,Math.max(0,e/this.squaredLength()));return Number.isNaN(i)?0:i}pointAt(t){const e=this.start,i=this.end;return t<=0?e.clone():t>=1?i.clone():e.lerp(i,t)}pointAtLength(t){const e=this.start,i=this.end;let r=!0;t<0&&(r=!1,t=-t);const o=this.length();if(t>=o)return r?i.clone():e.clone();const s=(r?t:o-t)/o;return this.pointAt(s)}divideAt(t){const e=this.pointAt(t);return[new jr(this.start,e),new jr(e,this.end)]}divideAtLength(t){const e=this.pointAtLength(t);return[new jr(this.start,e),new jr(e,this.end)]}containsPoint(t){const e=this.start,i=this.end;if(e.cross(t,i)!==0)return!1;const r=this.length();return!(new jr(e,t).length()>r||new jr(t,i).length()>r)}intersect(t,e){const i=t.intersectsWithLine(this,e);return i?Array.isArray(i)?i:[i]:null}intersectsWithLine(t){const e=new Y(this.end.x-this.start.x,this.end.y-this.start.y),i=new Y(t.end.x-t.start.x,t.end.y-t.start.y),r=e.x*i.y-e.y*i.x,o=new Y(t.start.x-this.start.x,t.start.y-this.start.y),s=o.x*i.y-o.y*i.x,a=o.x*e.y-o.y*e.x;if(r===0||s*r<0||a*r<0)return null;if(r>0){if(s>r||a>r)return null}else if(s<r||a<r)return null;return new Y(this.start.x+s*e.x/r,this.start.y+s*e.y/r)}isDifferentiable(){return!this.start.equals(this.end)}pointOffset(t){const e=Y.clone(t),i=this.start,r=this.end;return((r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x))/this.length()}pointSquaredDistance(t,e){const i=Y.create(t,e);return this.closestPoint(i).squaredDistance(i)}pointDistance(t,e){const i=Y.create(t,e);return this.closestPoint(i).distance(i)}tangentAt(t){if(!this.isDifferentiable())return null;const e=this.start,i=this.end,r=this.pointAt(t),o=new jr(e,i);return o.translate(r.x-e.x,r.y-e.y),o}tangentAtLength(t){if(!this.isDifferentiable())return null;const e=this.start,i=this.end,r=this.pointAtLength(t),o=new jr(e,i);return o.translate(r.x-e.x,r.y-e.y),o}relativeCcw(t,e){const i=Y.create(t,e);let r=i.x-this.start.x,o=i.y-this.start.y;const s=this.end.x-this.start.x,a=this.end.y-this.start.y;let l=r*a-o*s;return l===0&&(l=r*s+o*a,l>0&&(r-=s,o-=a,l=r*s+o*a,l<0&&(l=0))),l<0?-1:l>0?1:0}equals(t){return t!=null&&this.start.x===t.start.x&&this.start.y===t.start.y&&this.end.x===t.end.x&&this.end.y===t.end.y}clone(){return new jr(this.start,this.end)}toJSON(){return{start:this.start.toJSON(),end:this.end.toJSON()}}serialize(){return[this.start.serialize(),this.end.serialize()].join(" ")}};(function(n){function t(e){return e!=null&&e instanceof n}n.isLine=t})(kt||(kt={}));class no extends xa{get center(){return new Y(this.x,this.y)}constructor(t,e,i,r){super(),this.x=t??0,this.y=e??0,this.a=i??0,this.b=r??0}bbox(){return vt.fromEllipse(this)}getCenter(){return this.center}inflate(t,e){const i=t,r=e??t;return this.a+=2*i,this.b+=2*r,this}normalizedDistance(t,e){const i=Y.create(t,e),r=i.x-this.x,o=i.y-this.y,s=this.a,a=this.b;return r*r/(s*s)+o*o/(a*a)}containsPoint(t,e){return this.normalizedDistance(t,e)<=1}intersectsWithLine(t){const e=[],i=this.a,r=this.b,o=t.start,s=t.end,a=t.vector(),l=o.diff(new Y(this.x,this.y)),h=new Y(a.x/(i*i),a.y/(r*r)),u=new Y(l.x/(i*i),l.y/(r*r)),d=a.dot(h),c=a.dot(u),g=l.dot(u)-1,f=c*c-d*g;if(f<0)return null;if(f>0){const p=Math.sqrt(f),m=(-c-p)/d,v=(-c+p)/d;if((m<0||m>1)&&(v<0||v>1))return null;m>=0&&m<=1&&e.push(o.lerp(s,m)),v>=0&&v<=1&&e.push(o.lerp(s,v))}else{const p=-c/d;if(p>=0&&p<=1)e.push(o.lerp(s,p));else return null}return e}intersectsWithLineFromCenterToPoint(t,e=0){const i=Y.clone(t);e&&i.rotate(e,this.getCenter());const r=i.x-this.x,o=i.y-this.y;let s;if(r===0)return s=this.bbox().getNearestPointToPoint(i),e?s.rotate(-e,this.getCenter()):s;const a=o/r,l=a*a,h=this.a*this.a,u=this.b*this.b;let d=Math.sqrt(1/(1/h+l/u));d=r<0?-d:d;const c=a*d;return s=new Y(this.x+d,this.y+c),e?s.rotate(-e,this.getCenter()):s}tangentTheta(t){const e=Y.clone(t),i=e.x,r=e.y,o=this.a,s=this.b,a=this.bbox().center,l=a.x,h=a.y,u=30,d=i>a.x+o/2,c=i<a.x-o/2;let g,f;return d||c?(f=i>a.x?r-u:r+u,g=o*o/(i-l)-o*o*(r-h)*(f-h)/(s*s*(i-l))+l):(g=r>a.y?i+u:i-u,f=s*s/(r-h)-s*s*(i-l)*(g-l)/(o*o*(r-h))+h),new Y(g,f).theta(e)}scale(t,e){return this.a*=t,this.b*=e,this}rotate(t,e){const i=vt.fromEllipse(this);i.rotate(t,e);const r=no.fromRect(i);return this.a=r.a,this.b=r.b,this.x=r.x,this.y=r.y,this}translate(t,e){const i=Y.create(t,e);return this.x+=i.x,this.y+=i.y,this}equals(t){return t!=null&&t.x===this.x&&t.y===this.y&&t.a===this.a&&t.b===this.b}clone(){return new no(this.x,this.y,this.a,this.b)}toJSON(){return{x:this.x,y:this.y,a:this.a,b:this.b}}serialize(){return`${this.x} ${this.y} ${this.a} ${this.b}`}}(function(n){function t(e){return e!=null&&e instanceof n}n.isEllipse=t})(no||(no={}));(function(n){function t(r,o,s,a){return r==null||typeof r=="number"?new n(r,o,s,a):e(r)}n.create=t;function e(r){return n.isEllipse(r)?r.clone():Array.isArray(r)?new n(r[0],r[1],r[2],r[3]):new n(r.x,r.y,r.a,r.b)}n.parse=e;function i(r){const o=r.center;return new n(o.x,o.y,r.width/2,r.height/2)}n.fromRect=i})(no||(no={}));const H3=new RegExp("^[\\s\\dLMCZz,.]*$");function D3(n){return typeof n!="string"?!1:H3.test(n)}function Ab(n,t){return(n%t+t)%t}function F3(n,t,e,i,r){const o=[],s=n[n.length-1],a=t!=null&&t>0,l=t||0;if(i&&a){n=n.slice();const d=n[0],c=new Y(s.x+(d.x-s.x)/2,s.y+(d.y-s.y)/2);n.splice(0,0,c)}let h=n[0],u=1;for(e?o.push("M",h.x,h.y):o.push("L",h.x,h.y);u<(i?n.length:n.length-1);){let d=n[Ab(u,n.length)],c=h.x-d.x,g=h.y-d.y;if(a&&(c!==0||g!==0)&&(r==null||r.indexOf(u-1)<0)){let f=Math.sqrt(c*c+g*g);const p=c*Math.min(l,f/2)/f,m=g*Math.min(l,f/2)/f,v=d.x+p,b=d.y+m;o.push("L",v,b);let y=n[Ab(u+1,n.length)];for(;u<n.length-2&&Math.round(y.x-d.x)===0&&Math.round(y.y-d.y)===0;)y=n[Ab(u+2,n.length)],u+=1;c=y.x-d.x,g=y.y-d.y,f=Math.max(1,Math.sqrt(c*c+g*g));const C=c*Math.min(l,f/2)/f,w=g*Math.min(l,f/2)/f,_=d.x+C,A=d.y+w;o.push("Q",d.x,d.y,_,A),d=new Y(_,A)}else o.push("L",d.x,d.y);h=d,u+=1}return i?o.push("Z"):o.push("L",s.x,s.y),o.map(d=>typeof d=="string"?d:+d.toFixed(3)).join(" ")}function TE(n,t={}){const e=[];return n&&n.length&&n.forEach(i=>{Array.isArray(i)?e.push({x:i[0],y:i[1]}):e.push({x:i.x,y:i.y})}),F3(e,t.round,t.initialMove==null||t.initialMove,t.close,t.exclude)}function hp(n,t,e,i,r=0,o=0,s=0,a,l){if(e===0||i===0)return[];a-=n,l-=t,e=Math.abs(e),i=Math.abs(i);const h=-a/2,u=-l/2,d=Math.cos(r*Math.PI/180),c=Math.sin(r*Math.PI/180),g=d*h+c*u,f=-1*c*h+d*u,p=g*g,m=f*f,v=e*e,b=i*i,y=p/v+m/b;let C;if(y>1)e=Math.sqrt(y)*e,i=Math.sqrt(y)*i,C=0;else{let Z=1;o===s&&(Z=-1),C=Z*Math.sqrt((v*b-v*m-b*p)/(v*m+b*p))}const w=C*e*f/i,_=-1*C*i*g/e,A=d*w-c*_+a/2,x=c*w+d*_+l/2;let S=Math.atan2((f-_)/i,(g-w)/e)-Math.atan2(0,1),T=S>=0?S:2*Math.PI+S;S=Math.atan2((-f-_)/i,(-g-w)/e)-Math.atan2((f-_)/i,(g-w)/e);let M=S>=0?S:2*Math.PI+S;s===0&&M>0?M-=2*Math.PI:s!==0&&M<0&&(M+=2*Math.PI);const R=M*2/Math.PI,E=Math.ceil(R<0?-1*R:R),P=M/E,B=8/3*Math.sin(P/4)*Math.sin(P/4)/Math.sin(P/2),k=d*e,L=d*i,O=c*e,I=c*i;let H=Math.cos(T),D=Math.sin(T),z=-B*(k*D+I*H),G=-B*(O*D-L*H),U=0,j=0;const X=[];for(let Z=0;Z<E;Z+=1){T+=P,H=Math.cos(T),D=Math.sin(T),U=k*H-I*D+A,j=O*H+L*D+x;const J=-B*(k*D+I*H),q=-B*(O*D-L*H),st=Z*6;X[st]=Number(z+n),X[st+1]=Number(G+t),X[st+2]=Number(U-J+n),X[st+3]=Number(j-q+t),X[st+4]=Number(U+n),X[st+5]=Number(j+t),z=U+J,G=j+q}return X.map(Z=>+Z.toFixed(2))}function z3(n,t,e,i,r=0,o=0,s=0,a,l){const h=[],u=hp(n,t,e,i,r,o,s,a,l);if(u!=null)for(let d=0,c=u.length;d<c;d+=6)h.push("C",u[d],u[d+1],u[d+2],u[d+3],u[d+4],u[d+5]);return h.join(" ")}class ki extends xa{get start(){return this.points[0]||null}get end(){return this.points[this.points.length-1]||null}constructor(t){if(super(),t!=null){if(typeof t=="string")return ki.parse(t);this.points=t.map(e=>Y.create(e))}else this.points=[]}scale(t,e,i=new Y){return this.points.forEach(r=>r.scale(t,e,i)),this}rotate(t,e){return this.points.forEach(i=>i.rotate(t,e)),this}translate(t,e){const i=Y.create(t,e);return this.points.forEach(r=>r.translate(i.x,i.y)),this}round(t=0){return this.points.forEach(e=>e.round(t)),this}bbox(){if(this.points.length===0)return new vt;let t=1/0,e=-1/0,i=1/0,r=-1/0;const o=this.points;for(let s=0,a=o.length;s<a;s+=1){const l=o[s],h=l.x,u=l.y;h<t&&(t=h),h>e&&(e=h),u<i&&(i=u),u>r&&(r=u)}return new vt(t,i,e-t,r-i)}closestPoint(t){const e=this.closestPointLength(t);return this.pointAtLength(e)}closestPointLength(t){const e=this.points,i=e.length;if(i===0||i===1)return 0;let r=0,o=0,s=1/0;for(let a=0,l=i-1;a<l;a+=1){const h=new kt(e[a],e[a+1]),u=h.length(),d=h.closestPointNormalizedLength(t),g=h.pointAt(d).squaredDistance(t);g<s&&(s=g,o=r+d*u),r+=u}return o}closestPointNormalizedLength(t){const e=this.length();return e===0?0:this.closestPointLength(t)/e}closestPointTangent(t){const e=this.closestPointLength(t);return this.tangentAtLength(e)}containsPoint(t){if(this.points.length===0)return!1;const e=Y.clone(t),i=e.x,r=e.y,o=this.points,s=o.length;let a=s-1,l=0;for(let h=0;h<s;h+=1){const u=o[a],d=o[h];if(e.equals(u))return!0;const c=new kt(u,d);if(c.containsPoint(t))return!0;if(r<=u.y&&r>d.y||r>u.y&&r<=d.y){const g=u.x-i>d.x-i?u.x-i:d.x-i;if(g>=0){const f=new Y(i+g,r),p=new kt(t,f);c.intersectsWithLine(p)&&(l+=1)}}a=h}return l%2===1}intersectsWithLine(t){const e=[];for(let i=0,r=this.points.length-1;i<r;i+=1){const o=this.points[i],s=this.points[i+1],a=t.intersectsWithLine(new kt(o,s));a&&e.push(a)}return e.length>0?e:null}isDifferentiable(){for(let t=0,e=this.points.length-1;t<e;t+=1){const i=this.points[t],r=this.points[t+1];if(new kt(i,r).isDifferentiable())return!0}return!1}length(){let t=0;for(let e=0,i=this.points.length-1;e<i;e+=1){const r=this.points[e],o=this.points[e+1];t+=r.distance(o)}return t}pointAt(t){const e=this.points,i=e.length;if(i===0)return null;if(i===1||t<=0)return e[0].clone();if(t>=1)return e[i-1].clone();const o=this.length()*t;return this.pointAtLength(o)}pointAtLength(t){const e=this.points,i=e.length;if(i===0)return null;if(i===1)return e[0].clone();let r=!0;t<0&&(r=!1,t=-t);let o=0;for(let a=0,l=i-1;a<l;a+=1){const h=r?a:l-1-a,u=e[h],d=e[h+1],c=new kt(u,d),g=u.distance(d);if(t<=o+g)return c.pointAtLength((r?1:-1)*(t-o));o+=g}return(r?e[i-1]:e[0]).clone()}tangentAt(t){const i=this.points.length;if(i===0||i===1)return null;t<0&&(t=0),t>1&&(t=1);const o=this.length()*t;return this.tangentAtLength(o)}tangentAtLength(t){const e=this.points,i=e.length;if(i===0||i===1)return null;let r=!0;t<0&&(r=!1,t=-t);let o,s=0;for(let a=0,l=i-1;a<l;a+=1){const h=r?a:l-1-a,u=e[h],d=e[h+1],c=new kt(u,d),g=u.distance(d);if(c.isDifferentiable()){if(t<=s+g)return c.tangentAtLength((r?1:-1)*(t-s));o=c}s+=g}if(o){const a=r?1:0;return o.tangentAt(a)}return null}simplify(t={}){const e=this.points;if(e.length<3)return this;const i=t.threshold||0;let r=0;for(;e[r+2];){const o=r,s=r+1,a=r+2,l=e[o],h=e[s],u=e[a];new kt(l,u).closestPoint(h).distance(h)<=i?e.splice(s,1):r+=1}return this}toHull(){const t=this.points,e=t.length;if(e===0)return new ki;let i=t[0];for(let c=1;c<e;c+=1)(t[c].y<i.y||t[c].y===i.y&&t[c].x>i.x)&&(i=t[c]);const r=[];for(let c=0;c<e;c+=1){let g=i.theta(t[c]);g===0&&(g=360),r.push([t[c],c,g])}if(r.sort((c,g)=>{let f=c[2]-g[2];return f===0&&(f=g[1]-c[1]),f}),r.length>2){const c=r[r.length-1];r.unshift(c)}const o={},s=[],a=c=>`${c[0].toString()}@${c[1]}`;for(;r.length!==0;){const c=r.pop(),g=c[0];if(o[a(c)])continue;let f=!1;for(;!f;)if(s.length<2)s.push(c),f=!0;else{const p=s.pop(),m=p[0],v=s.pop(),b=v[0],y=b.cross(m,g);if(y<0)s.push(v),s.push(p),s.push(c),f=!0;else if(y===0){const w=m.angleBetween(b,g);Math.abs(w-180)<1e-10||m.equals(g)||b.equals(m)?(o[a(p)]=m,s.push(v)):Math.abs((w+1)%360-1)<1e-10&&(s.push(v),r.push(p))}else o[a(p)]=m,s.push(v)}}s.length>2&&s.pop();let l,h=-1;for(let c=0,g=s.length;c<g;c+=1){const f=s[c][1];(l===void 0||f<l)&&(l=f,h=c)}let u=[];if(h>0){const c=s.slice(h),g=s.slice(0,h);u=c.concat(g)}else u=s;const d=[];for(let c=0,g=u.length;c<g;c+=1)d.push(u[c][0]);return new ki(d)}equals(t){return t==null||t.points.length!==this.points.length?!1:t.points.every((e,i)=>e.equals(this.points[i]))}clone(){return new ki(this.points.map(t=>t.clone()))}toJSON(){return this.points.map(t=>t.toJSON())}serialize(){return this.points.map(t=>`${t.serialize()}`).join(" ")}}(function(n){function t(e){return e!=null&&e instanceof n}n.isPolyline=t})(ki||(ki={}));(function(n){function t(e){const i=e.trim();if(i==="")return new n;const r=[],o=i.split(/\s*,\s*|\s+/);for(let s=0,a=o.length;s<a;s+=2)r.push({x:+o[s],y:+o[s+1]});return new n(r)}n.parse=t})(ki||(ki={}));let sr=class ss extends xa{constructor(t,e,i,r){super(),this.PRECISION=3,this.start=Y.create(t),this.controlPoint1=Y.create(e),this.controlPoint2=Y.create(i),this.end=Y.create(r)}bbox(){const t=this.start,e=this.controlPoint1,i=this.controlPoint2,r=this.end,o=t.x,s=t.y,a=e.x,l=e.y,h=i.x,u=i.y,d=r.x,c=r.y,g=[],f=[[],[]];let p,m,v,b,y,C,w,_;for(let k=0;k<2;k+=1){if(k===0?(m=6*o-12*a+6*h,p=-3*o+9*a-9*h+3*d,v=3*a-3*o):(m=6*s-12*l+6*u,p=-3*s+9*l-9*u+3*c,v=3*l-3*s),Math.abs(p)<1e-12){if(Math.abs(m)<1e-12)continue;b=-v/m,b>0&&b<1&&g.push(b);continue}w=m*m-4*v*p,_=Math.sqrt(w),!(w<0)&&(y=(-m+_)/(2*p),y>0&&y<1&&g.push(y),C=(-m-_)/(2*p),C>0&&C<1&&g.push(C))}let A,x,S,T=g.length;const M=T;for(;T;)T-=1,b=g[T],S=1-b,A=S*S*S*o+3*S*S*b*a+3*S*b*b*h+b*b*b*d,f[0][T]=A,x=S*S*S*s+3*S*S*b*l+3*S*b*b*u+b*b*b*c,f[1][T]=x;g[M]=0,g[M+1]=1,f[0][M]=o,f[1][M]=s,f[0][M+1]=d,f[1][M+1]=c,g.length=M+2,f[0].length=M+2,f[1].length=M+2;const R=Math.min.apply(null,f[0]),E=Math.min.apply(null,f[1]),P=Math.max.apply(null,f[0]),B=Math.max.apply(null,f[1]);return new vt(R,E,P-R,B-E)}closestPoint(t,e={}){return this.pointAtT(this.closestPointT(t,e))}closestPointLength(t,e={}){const i=this.getOptions(e);return this.lengthAtT(this.closestPointT(t,i),i)}closestPointNormalizedLength(t,e={}){const i=this.getOptions(e),r=this.closestPointLength(t,i);if(!r)return 0;const o=this.length(i);return o===0?0:r/o}closestPointT(t,e={}){const i=this.getPrecision(e),r=this.getDivisions(e),o=Math.pow(10,-i);let s=null,a=0,l=0,h=0,u=0,d=0,c=null;const g=r.length;let f=g>0?1/g:0;for(r.forEach((p,m)=>{const v=p.start.distance(t),b=p.end.distance(t),y=v+b;(c==null||y<c)&&(s=p,a=m*f,l=(m+1)*f,h=v,u=b,c=y,d=p.endpointDistance())});;){const p=h?Math.abs(h-u)/h:0,m=u!=null?Math.abs(h-u)/u:0,v=p<o||m<o,b=h?h<d*o:!0,y=u?u<d*o:!0;if(v||(b||y))return h<=u?a:l;const w=s.divide(.5);f/=2;const _=w[0].start.distance(t),A=w[0].end.distance(t),x=_+A,S=w[1].start.distance(t),T=w[1].end.distance(t),M=S+T;x<=M?(s=w[0],l-=f,h=_,u=A):(s=w[1],a+=f,h=S,u=T)}}closestPointTangent(t,e={}){return this.tangentAtT(this.closestPointT(t,e))}containsPoint(t,e={}){return this.toPolyline(e).containsPoint(t)}divideAt(t,e={}){if(t<=0)return this.divideAtT(0);if(t>=1)return this.divideAtT(1);const i=this.tAt(t,e);return this.divideAtT(i)}divideAtLength(t,e={}){const i=this.tAtLength(t,e);return this.divideAtT(i)}divide(t){return this.divideAtT(t)}divideAtT(t){const e=this.start,i=this.controlPoint1,r=this.controlPoint2,o=this.end;if(t<=0)return[new ss(e,e,e,e),new ss(e,i,r,o)];if(t>=1)return[new ss(e,i,r,o),new ss(o,o,o,o)];const s=this.getSkeletonPoints(t),a=s.startControlPoint1,l=s.startControlPoint2,h=s.divider,u=s.dividerControlPoint1,d=s.dividerControlPoint2;return[new ss(e,a,l,h),new ss(h,u,d,o)]}endpointDistance(){return this.start.distance(this.end)}getSkeletonPoints(t){const e=this.start,i=this.controlPoint1,r=this.controlPoint2,o=this.end;if(t<=0)return{startControlPoint1:e.clone(),startControlPoint2:e.clone(),divider:e.clone(),dividerControlPoint1:i.clone(),dividerControlPoint2:r.clone()};if(t>=1)return{startControlPoint1:i.clone(),startControlPoint2:r.clone(),divider:o.clone(),dividerControlPoint1:o.clone(),dividerControlPoint2:o.clone()};const s=new kt(e,i).pointAt(t),a=new kt(i,r).pointAt(t),l=new kt(r,o).pointAt(t),h=new kt(s,a).pointAt(t),u=new kt(a,l).pointAt(t),d=new kt(h,u).pointAt(t);return{startControlPoint1:s,startControlPoint2:h,divider:d,dividerControlPoint1:u,dividerControlPoint2:l}}getSubdivisions(t={}){const e=this.getPrecision(t);let i=[new ss(this.start,this.controlPoint1,this.controlPoint2,this.end)];if(e===0)return i;let r=this.endpointDistance();const o=Math.pow(10,-e);let s=0;for(;;){s+=1;const a=[];i.forEach(u=>{const d=u.divide(.5);a.push(d[0],d[1])});const l=a.reduce((u,d)=>u+d.endpointDistance(),0),h=l!==0?(l-r)/l:0;if(s>1&&h<o)return a;i=a,r=l}}length(t={}){return this.getDivisions(t).reduce((i,r)=>i+r.endpointDistance(),0)}lengthAtT(t,e={}){if(t<=0)return 0;const i=e.precision===void 0?this.PRECISION:e.precision;return this.divide(t)[0].length({precision:i})}pointAt(t,e={}){if(t<=0)return this.start.clone();if(t>=1)return this.end.clone();const i=this.tAt(t,e);return this.pointAtT(i)}pointAtLength(t,e={}){const i=this.tAtLength(t,e);return this.pointAtT(i)}pointAtT(t){return t<=0?this.start.clone():t>=1?this.end.clone():this.getSkeletonPoints(t).divider}isDifferentiable(){const t=this.start,e=this.controlPoint1,i=this.controlPoint2,r=this.end;return!(t.equals(e)&&e.equals(i)&&i.equals(r))}tangentAt(t,e={}){if(!this.isDifferentiable())return null;t<0?t=0:t>1&&(t=1);const i=this.tAt(t,e);return this.tangentAtT(i)}tangentAtLength(t,e={}){if(!this.isDifferentiable())return null;const i=this.tAtLength(t,e);return this.tangentAtT(i)}tangentAtT(t){if(!this.isDifferentiable())return null;t<0&&(t=0),t>1&&(t=1);const e=this.getSkeletonPoints(t),i=e.startControlPoint2,r=e.dividerControlPoint1,o=e.divider,s=new kt(i,r);return s.translate(o.x-i.x,o.y-i.y),s}getPrecision(t={}){return t.precision==null?this.PRECISION:t.precision}getDivisions(t={}){if(t.subdivisions!=null)return t.subdivisions;const e=this.getPrecision(t);return this.getSubdivisions({precision:e})}getOptions(t={}){const e=this.getPrecision(t),i=this.getDivisions(t);return{precision:e,subdivisions:i}}tAt(t,e={}){if(t<=0)return 0;if(t>=1)return 1;const i=this.getOptions(e),o=this.length(i)*t;return this.tAtLength(o,i)}tAtLength(t,e={}){let i=!0;t<0&&(i=!1,t=-t);const r=this.getPrecision(e),o=this.getDivisions(e),s={precision:r,subdivisions:o};let a=null,l,h,u=0,d=0,c=0;const g=o.length;let f=g>0?1/g:0;for(let v=0;v<g;v+=1){const b=i?v:g-1-v,y=o[v],C=y.endpointDistance();if(t<=c+C){a=y,l=b*f,h=(b+1)*f,u=i?t-c:C+c-t,d=i?C+c-t:t-c;break}c+=C}if(a==null)return i?1:0;const p=this.length(s),m=Math.pow(10,-r);for(;;){let v;if(v=p!==0?u/p:0,v<m)return l;if(v=p!==0?d/p:0,v<m)return h;let b,y;const C=a.divide(.5);f/=2;const w=C[0].endpointDistance(),_=C[1].endpointDistance();u<=w?(a=C[0],h-=f,b=u,y=w-b):(a=C[1],l+=f,b=u-w,y=_-b),u=b,d=y}}toPoints(t={}){const e=this.getDivisions(t),i=[e[0].start.clone()];return e.forEach(r=>i.push(r.end.clone())),i}toPolyline(t={}){return new ki(this.toPoints(t))}scale(t,e,i){return this.start.scale(t,e,i),this.controlPoint1.scale(t,e,i),this.controlPoint2.scale(t,e,i),this.end.scale(t,e,i),this}rotate(t,e){return this.start.rotate(t,e),this.controlPoint1.rotate(t,e),this.controlPoint2.rotate(t,e),this.end.rotate(t,e),this}translate(t,e){return typeof t=="number"?(this.start.translate(t,e),this.controlPoint1.translate(t,e),this.controlPoint2.translate(t,e),this.end.translate(t,e)):(this.start.translate(t),this.controlPoint1.translate(t),this.controlPoint2.translate(t),this.end.translate(t)),this}equals(t){return t!=null&&this.start.equals(t.start)&&this.controlPoint1.equals(t.controlPoint1)&&this.controlPoint2.equals(t.controlPoint2)&&this.end.equals(t.end)}clone(){return new ss(this.start,this.controlPoint1,this.controlPoint2,this.end)}toJSON(){return{start:this.start.toJSON(),controlPoint1:this.controlPoint1.toJSON(),controlPoint2:this.controlPoint2.toJSON(),end:this.end.toJSON()}}serialize(){return[this.start.serialize(),this.controlPoint1.serialize(),this.controlPoint2.serialize(),this.end.serialize()].join(" ")}};(function(n){function t(e){return e!=null&&e instanceof n}n.isCurve=t})(sr||(sr={}));(function(n){function t(r){const o=r.length,s=[],a=[];let l=2;s[0]=r[0]/l;for(let h=1;h<o;h+=1)a[h]=1/l,l=(h<o-1?4:3.5)-a[h],s[h]=(r[h]-s[h-1])/l;for(let h=1;h<o;h+=1)s[o-h-1]-=a[o-h]*s[o-h];return s}function e(r){const o=r.map(c=>Y.clone(c)),s=[],a=[],l=o.length-1;if(l===1)return s[0]=new Y((2*o[0].x+o[1].x)/3,(2*o[0].y+o[1].y)/3),a[0]=new Y(2*s[0].x-o[0].x,2*s[0].y-o[0].y),[s,a];const h=[];for(let c=1;c<l-1;c+=1)h[c]=4*o[c].x+2*o[c+1].x;h[0]=o[0].x+2*o[1].x,h[l-1]=(8*o[l-1].x+o[l].x)/2;const u=t(h);for(let c=1;c<l-1;c+=1)h[c]=4*o[c].y+2*o[c+1].y;h[0]=o[0].y+2*o[1].y,h[l-1]=(8*o[l-1].y+o[l].y)/2;const d=t(h);for(let c=0;c<l;c+=1)s.push(new Y(u[c],d[c])),c<l-1?a.push(new Y(2*o[c+1].x-u[c+1],2*o[c+1].y-d[c+1])):a.push(new Y((o[l].x+u[l-1])/2,(o[l].y+d[l-1])/2));return[s,a]}function i(r){if(r==null||Array.isArray(r)&&r.length<2)throw new Error("At least 2 points are required");const o=e(r),s=[];for(let a=0,l=o[0].length;a<l;a+=1){const h=new Y(o[0][a].x,o[0][a].y),u=new Y(o[1][a].x,o[1][a].y);s.push(new n(r[a],h,u,r[a+1]))}return s}n.throughPoints=i})(sr||(sr={}));let Fm=class extends xa{constructor(){super(...arguments),this.isVisible=!0,this.isSegment=!0,this.isSubpathStart=!1}get end(){return this.endPoint}get start(){if(this.previousSegment==null)throw new Error("Missing previous segment. (This segment cannot be the first segment of a path, or segment has not yet been added to a path.)");return this.previousSegment.end}closestPointT(t,e){if(this.closestPointNormalizedLength)return this.closestPointNormalizedLength(t);throw new Error("Neither `closestPointT` nor `closestPointNormalizedLength` method is implemented.")}lengthAtT(t,e){if(t<=0)return 0;const i=this.length();return t>=1?i:i*t}divideAtT(t){if(this.divideAt)return this.divideAt(t);throw new Error("Neither `divideAtT` nor `divideAt` method is implemented.")}pointAtT(t){if(this.pointAt)return this.pointAt(t);throw new Error("Neither `pointAtT` nor `pointAt` method is implemented.")}tangentAtT(t){if(this.tangentAt)return this.tangentAt(t);throw new Error("Neither `tangentAtT` nor `tangentAt` method is implemented.")}};class _n extends Fm{constructor(t,e){super(),kt.isLine(t)?this.endPoint=t.end.clone().round(2):this.endPoint=Y.create(t,e).round(2)}get type(){return"L"}get line(){return new kt(this.start,this.end)}bbox(){return this.line.bbox()}closestPoint(t){return this.line.closestPoint(t)}closestPointLength(t){return this.line.closestPointLength(t)}closestPointNormalizedLength(t){return this.line.closestPointNormalizedLength(t)}closestPointTangent(t){return this.line.closestPointTangent(t)}length(){return this.line.length()}divideAt(t){const e=this.line.divideAt(t);return[new _n(e[0]),new _n(e[1])]}divideAtLength(t){const e=this.line.divideAtLength(t);return[new _n(e[0]),new _n(e[1])]}getSubdivisions(){return[]}pointAt(t){return this.line.pointAt(t)}pointAtLength(t){return this.line.pointAtLength(t)}tangentAt(t){return this.line.tangentAt(t)}tangentAtLength(t){return this.line.tangentAtLength(t)}isDifferentiable(){return this.previousSegment==null?!1:!this.start.equals(this.end)}clone(){return new _n(this.end)}scale(t,e,i){return this.end.scale(t,e,i),this}rotate(t,e){return this.end.rotate(t,e),this}translate(t,e){return typeof t=="number"?this.end.translate(t,e):this.end.translate(t),this}equals(t){return this.type===t.type&&this.start.equals(t.start)&&this.end.equals(t.end)}toJSON(){return{type:this.type,start:this.start.toJSON(),end:this.end.toJSON()}}serialize(){const t=this.end;return`${this.type} ${t.x} ${t.y}`}}(function(n){function t(...e){const i=e.length,r=e[0];if(kt.isLine(r))return new n(r);if(Y.isPointLike(r))return i===1?new n(r):e.map(s=>new n(s));if(i===2)return new n(+e[0],+e[1]);const o=[];for(let s=0;s<i;s+=2){const a=+e[s],l=+e[s+1];o.push(new n(a,l))}return o}n.create=t})(_n||(_n={}));class Jh extends Fm{get end(){if(!this.subpathStartSegment)throw new Error("Missing subpath start segment. (This segment needs a subpath start segment (e.g. MoveTo), or segment has not yet been added to a path.)");return this.subpathStartSegment.end}get type(){return"Z"}get line(){return new kt(this.start,this.end)}bbox(){return this.line.bbox()}closestPoint(t){return this.line.closestPoint(t)}closestPointLength(t){return this.line.closestPointLength(t)}closestPointNormalizedLength(t){return this.line.closestPointNormalizedLength(t)}closestPointTangent(t){return this.line.closestPointTangent(t)}length(){return this.line.length()}divideAt(t){const e=this.line.divideAt(t);return[e[1].isDifferentiable()?new _n(e[0]):this.clone(),new _n(e[1])]}divideAtLength(t){const e=this.line.divideAtLength(t);return[e[1].isDifferentiable()?new _n(e[0]):this.clone(),new _n(e[1])]}getSubdivisions(){return[]}pointAt(t){return this.line.pointAt(t)}pointAtLength(t){return this.line.pointAtLength(t)}tangentAt(t){return this.line.tangentAt(t)}tangentAtLength(t){return this.line.tangentAtLength(t)}isDifferentiable(){return!this.previousSegment||!this.subpathStartSegment?!1:!this.start.equals(this.end)}scale(){return this}rotate(){return this}translate(){return this}equals(t){return this.type===t.type&&this.start.equals(t.start)&&this.end.equals(t.end)}clone(){return new Jh}toJSON(){return{type:this.type,start:this.start.toJSON(),end:this.end.toJSON()}}serialize(){return this.type}}(function(n){function t(){return new n}n.create=t})(Jh||(Jh={}));class Qh extends Fm{constructor(t,e){super(),this.isVisible=!1,this.isSubpathStart=!0,kt.isLine(t)||sr.isCurve(t)?this.endPoint=t.end.clone().round(2):this.endPoint=Y.create(t,e).round(2)}get start(){throw new Error("Illegal access. Moveto segments should not need a start property.")}get type(){return"M"}bbox(){return null}closestPoint(){return this.end.clone()}closestPointLength(){return 0}closestPointNormalizedLength(){return 0}closestPointT(){return 1}closestPointTangent(){return null}length(){return 0}lengthAtT(){return 0}divideAt(){return[this.clone(),this.clone()]}divideAtLength(){return[this.clone(),this.clone()]}getSubdivisions(){return[]}pointAt(){return this.end.clone()}pointAtLength(){return this.end.clone()}pointAtT(){return this.end.clone()}tangentAt(){return null}tangentAtLength(){return null}tangentAtT(){return null}isDifferentiable(){return!1}scale(t,e,i){return this.end.scale(t,e,i),this}rotate(t,e){return this.end.rotate(t,e),this}translate(t,e){return typeof t=="number"?this.end.translate(t,e):this.end.translate(t),this}clone(){return new Qh(this.end)}equals(t){return this.type===t.type&&this.end.equals(t.end)}toJSON(){return{type:this.type,end:this.end.toJSON()}}serialize(){const t=this.end;return`${this.type} ${t.x} ${t.y}`}}(function(n){function t(...e){const i=e.length,r=e[0];if(kt.isLine(r))return new n(r);if(sr.isCurve(r))return new n(r);if(Y.isPointLike(r)){if(i===1)return new n(r);const s=[];for(let a=0;a<i;a+=1)a===0?s.push(new n(e[a])):s.push(new _n(e[a]));return s}if(i===2)return new n(+e[0],+e[1]);const o=[];for(let s=0;s<i;s+=2){const a=+e[s],l=+e[s+1];s===0?o.push(new n(a,l)):o.push(new _n(a,l))}return o}n.create=t})(Qh||(Qh={}));class _r extends Fm{constructor(t,e,i,r,o,s){super(),sr.isCurve(t)?(this.controlPoint1=t.controlPoint1.clone().round(2),this.controlPoint2=t.controlPoint2.clone().round(2),this.endPoint=t.end.clone().round(2)):typeof t=="number"?(this.controlPoint1=new Y(t,e).round(2),this.controlPoint2=new Y(i,r).round(2),this.endPoint=new Y(o,s).round(2)):(this.controlPoint1=Y.create(t).round(2),this.controlPoint2=Y.create(e).round(2),this.endPoint=Y.create(i).round(2))}get type(){return"C"}get curve(){return new sr(this.start,this.controlPoint1,this.controlPoint2,this.end)}bbox(){return this.curve.bbox()}closestPoint(t){return this.curve.closestPoint(t)}closestPointLength(t){return this.curve.closestPointLength(t)}closestPointNormalizedLength(t){return this.curve.closestPointNormalizedLength(t)}closestPointTangent(t){return this.curve.closestPointTangent(t)}length(){return this.curve.length()}divideAt(t,e={}){const i=this.curve.divideAt(t,e);return[new _r(i[0]),new _r(i[1])]}divideAtLength(t,e={}){const i=this.curve.divideAtLength(t,e);return[new _r(i[0]),new _r(i[1])]}divideAtT(t){const e=this.curve.divideAtT(t);return[new _r(e[0]),new _r(e[1])]}getSubdivisions(){return[]}pointAt(t){return this.curve.pointAt(t)}pointAtLength(t){return this.curve.pointAtLength(t)}tangentAt(t){return this.curve.tangentAt(t)}tangentAtLength(t){return this.curve.tangentAtLength(t)}isDifferentiable(){if(!this.previousSegment)return!1;const t=this.start,e=this.controlPoint1,i=this.controlPoint2,r=this.end;return!(t.equals(e)&&e.equals(i)&&i.equals(r))}scale(t,e,i){return this.controlPoint1.scale(t,e,i),this.controlPoint2.scale(t,e,i),this.end.scale(t,e,i),this}rotate(t,e){return this.controlPoint1.rotate(t,e),this.controlPoint2.rotate(t,e),this.end.rotate(t,e),this}translate(t,e){return typeof t=="number"?(this.controlPoint1.translate(t,e),this.controlPoint2.translate(t,e),this.end.translate(t,e)):(this.controlPoint1.translate(t),this.controlPoint2.translate(t),this.end.translate(t)),this}equals(t){return this.start.equals(t.start)&&this.end.equals(t.end)&&this.controlPoint1.equals(t.controlPoint1)&&this.controlPoint2.equals(t.controlPoint2)}clone(){return new _r(this.controlPoint1,this.controlPoint2,this.end)}toJSON(){return{type:this.type,start:this.start.toJSON(),controlPoint1:this.controlPoint1.toJSON(),controlPoint2:this.controlPoint2.toJSON(),end:this.end.toJSON()}}serialize(){const t=this.controlPoint1,e=this.controlPoint2,i=this.end;return[this.type,t.x,t.y,e.x,e.y,i.x,i.y].join(" ")}}(function(n){function t(...e){const i=e.length,r=e[0];if(sr.isCurve(r))return new n(r);if(Y.isPointLike(r)){if(i===3)return new n(e[0],e[1],e[2]);const s=[];for(let a=0;a<i;a+=3)s.push(new n(e[a],e[a+1],e[a+2]));return s}if(i===6)return new n(e[0],e[1],e[2],e[3],e[4],e[5]);const o=[];for(let s=0;s<i;s+=6)o.push(new n(e[s],e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]));return o}n.create=t})(_r||(_r={}));function Rg(n,t,e){return{x:n*Math.cos(e)-t*Math.sin(e),y:n*Math.sin(e)+t*Math.cos(e)}}function HS(n,t,e,i,r,o){const s=.3333333333333333,a=2/3;return[s*n+a*e,s*t+a*i,s*r+a*e,s*o+a*i,r,o]}function RE(n,t,e,i,r,o,s,a,l,h){const u=Math.PI*120/180,d=Math.PI/180*(+r||0);let c=[],g,f,p,m,v;if(h)f=h[0],p=h[1],m=h[2],v=h[3];else{g=Rg(n,t,-d),n=g.x,t=g.y,g=Rg(a,l,-d),a=g.x,l=g.y;const P=(n-a)/2,B=(t-l)/2;let k=P*P/(e*e)+B*B/(i*i);k>1&&(k=Math.sqrt(k),e=k*e,i=k*i);const L=e*e,O=i*i,I=(o===s?-1:1)*Math.sqrt(Math.abs((L*O-L*B*B-O*P*P)/(L*B*B+O*P*P)));m=I*e*B/i+(n+a)/2,v=I*-i*P/e+(t+l)/2,f=Math.asin((t-v)/i),p=Math.asin((l-v)/i),f=n<m?Math.PI-f:f,p=a<m?Math.PI-p:p,f<0&&(f=Math.PI*2+f),p<0&&(p=Math.PI*2+p),s&&f>p&&(f-=Math.PI*2),!s&&p>f&&(p-=Math.PI*2)}let b=p-f;if(Math.abs(b)>u){const P=p,B=a,k=l;p=f+u*(s&&p>f?1:-1),a=m+e*Math.cos(p),l=v+i*Math.sin(p),c=RE(a,l,e,i,r,0,s,B,k,[p,P,m,v])}b=p-f;const y=Math.cos(f),C=Math.sin(f),w=Math.cos(p),_=Math.sin(p),A=Math.tan(b/4),x=4/3*(e*A),S=4/3*(i*A),T=[n,t],M=[n+x*C,t-S*y],R=[a+x*_,l-S*w],E=[a,l];if(M[0]=2*T[0]-M[0],M[1]=2*T[1]-M[1],h)return[M,R,E].concat(c);{c=[M,R,E].concat(c).join().split(",");const P=[],B=c.length;for(let k=0;k<B;k+=1)P[k]=k%2?Rg(+c[k-1],+c[k],d).y:Rg(+c[k],+c[k+1],d).x;return P}}function N3(n){if(!n)return null;const t=`	
\v\f\r   ᠎             　\u2028\u2029`,e=new RegExp(`([a-z])[${t},]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?[${t}]*,?[${t}]*)+)`,"ig"),i=new RegExp(`(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)[${t}]*,?[${t}]*`,"ig"),r={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},o=[];return n.replace(e,(s,a,l)=>{const h=[];let u=a.toLowerCase();l.replace(i,(c,g)=>(g&&h.push(+g),c)),u==="m"&&h.length>2&&(o.push([a,...h.splice(0,2)]),u="l",a=a==="m"?"l":"L");const d=r[u];for(;h.length>=d&&(o.push([a,...h.splice(0,d)]),!!d););return s}),o}function W3(n){const t=N3(n);if(!t||!t.length)return[["M",0,0]];let e=0,i=0,r=0,o=0;const s=[];for(let a=0,l=t.length;a<l;a+=1){const h=[];s.push(h);const u=t[a],d=u[0];if(d!==d.toUpperCase())switch(h[0]=d.toUpperCase(),h[0]){case"A":h[1]=u[1],h[2]=u[2],h[3]=u[3],h[4]=u[4],h[5]=u[5],h[6]=+u[6]+e,h[7]=+u[7]+i;break;case"V":h[1]=+u[1]+i;break;case"H":h[1]=+u[1]+e;break;case"M":r=+u[1]+e,o=+u[2]+i;for(let c=1,g=u.length;c<g;c+=1)h[c]=+u[c]+(c%2?e:i);break;default:for(let c=1,g=u.length;c<g;c+=1)h[c]=+u[c]+(c%2?e:i);break}else for(let c=0,g=u.length;c<g;c+=1)h[c]=u[c];switch(h[0]){case"Z":e=+r,i=+o;break;case"H":e=h[1];break;case"V":i=h[1];break;case"M":r=h[h.length-2],o=h[h.length-1],e=h[h.length-2],i=h[h.length-1];break;default:e=h[h.length-2],i=h[h.length-1];break}}return s}function j3(n){const t=W3(n),e={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null};function i(l,h,u){let d,c;if(!l)return["C",h.x,h.y,h.x,h.y,h.x,h.y];switch(l[0]in{T:1,Q:1}||(h.qx=null,h.qy=null),l[0]){case"M":h.X=l[1],h.Y=l[2];break;case"A":return parseFloat(l[1])===0||parseFloat(l[2])===0?["L",l[6],l[7]]:["C"].concat(RE.apply(0,[h.x,h.y].concat(l.slice(1))));case"S":return u==="C"||u==="S"?(d=h.x*2-h.bx,c=h.y*2-h.by):(d=h.x,c=h.y),["C",d,c].concat(l.slice(1));case"T":return u==="Q"||u==="T"?(h.qx=h.x*2-h.qx,h.qy=h.y*2-h.qy):(h.qx=h.x,h.qy=h.y),["C"].concat(HS(h.x,h.y,h.qx,h.qy,l[1],l[2]));case"Q":return h.qx=l[1],h.qy=l[2],["C"].concat(HS(h.x,h.y,l[1],l[2],l[3],l[4]));case"H":return["L"].concat(l[1],h.y);case"V":return["L"].concat(h.x,l[1])}return l}function r(l,h){if(l[h].length>7){l[h].shift();const u=l[h];for(;u.length;)o[h]="A",h+=1,l.splice(h,0,["C"].concat(u.splice(0,6)));l.splice(h,1),a=t.length}}const o=[];let s="",a=t.length;for(let l=0;l<a;l+=1){let h="";t[l]&&(h=t[l][0]),h!=="C"&&(o[l]=h,l>0&&(s=o[l-1])),t[l]=i(t[l],e,s),o[l]!=="A"&&h==="C"&&(o[l]="C"),r(t,l);const u=t[l],d=u.length;e.x=u[d-2],e.y=u[d-1],e.bx=parseFloat(u[d-4])||e.x,e.by=parseFloat(u[d-3])||e.y}return(!t[0][0]||t[0][0]!=="M")&&t.unshift(["M",0,0]),t}function V3(n){return j3(n).map(t=>t.map(e=>typeof e=="string"?e:Ne.round(e,2))).join(",").split(",").join(" ")}let ie=class Xi extends xa{constructor(t){if(super(),this.PRECISION=3,this.segments=[],Array.isArray(t))if(kt.isLine(t[0])||sr.isCurve(t[0])){let e=null;t.forEach((r,o)=>{o===0&&this.appendSegment(Xi.createSegment("M",r.start)),e!=null&&!e.end.equals(r.start)&&this.appendSegment(Xi.createSegment("M",r.start)),kt.isLine(r)?this.appendSegment(Xi.createSegment("L",r.end)):sr.isCurve(r)&&this.appendSegment(Xi.createSegment("C",r.controlPoint1,r.controlPoint2,r.end)),e=r})}else t.forEach(i=>{i.isSegment&&this.appendSegment(i)});else t!=null&&(kt.isLine(t)?(this.appendSegment(Xi.createSegment("M",t.start)),this.appendSegment(Xi.createSegment("L",t.end))):sr.isCurve(t)?(this.appendSegment(Xi.createSegment("M",t.start)),this.appendSegment(Xi.createSegment("C",t.controlPoint1,t.controlPoint2,t.end))):ki.isPolyline(t)?t.points&&t.points.length&&t.points.forEach((e,i)=>{const r=i===0?Xi.createSegment("M",e):Xi.createSegment("L",e);this.appendSegment(r)}):t.isSegment&&this.appendSegment(t))}get start(){const t=this.segments,e=t.length;if(e===0)return null;for(let i=0;i<e;i+=1){const r=t[i];if(r.isVisible)return r.start}return t[e-1].end}get end(){const t=this.segments,e=t.length;if(e===0)return null;for(let i=e-1;i>=0;i-=1){const r=t[i];if(r.isVisible)return r.end}return t[e-1].end}moveTo(...t){return this.appendSegment(Qh.create.call(null,...t))}lineTo(...t){return this.appendSegment(_n.create.call(null,...t))}curveTo(...t){return this.appendSegment(_r.create.call(null,...t))}arcTo(t,e,i,r,o,s,a){const l=this.end||new Y,h=typeof s=="number"?hp(l.x,l.y,t,e,i,r,o,s,a):hp(l.x,l.y,t,e,i,r,o,s.x,s.y);if(h!=null)for(let u=0,d=h.length;u<d;u+=6)this.curveTo(h[u],h[u+1],h[u+2],h[u+3],h[u+4],h[u+5]);return this}quadTo(t,e,i,r){const o=this.end||new Y,s=["M",o.x,o.y];if(typeof t=="number")s.push("Q",t,e,i,r);else{const l=e;s.push("Q",t.x,t.y,l.x,l.y)}const a=Xi.parse(s.join(" "));return this.appendSegment(a.segments.slice(1)),this}close(){return this.appendSegment(Jh.create())}drawPoints(t,e={}){const i=TE(t,e),r=Xi.parse(i);r&&r.segments&&this.appendSegment(r.segments)}bbox(){const t=this.segments,e=t.length;if(e===0)return null;let i;for(let o=0;o<e;o+=1){const s=t[o];if(s.isVisible){const a=s.bbox();a!=null&&(i=i?i.union(a):a)}}if(i!=null)return i;const r=t[e-1];return new vt(r.end.x,r.end.y,0,0)}appendSegment(t){const e=this.segments.length;let i=e!==0?this.segments[e-1]:null,r;const o=null;if(Array.isArray(t))for(let s=0,a=t.length;s<a;s+=1){const l=t[s];r=this.prepareSegment(l,i,o),this.segments.push(r),i=r}else t!=null&&t.isSegment&&(r=this.prepareSegment(t,i,o),this.segments.push(r));return this}insertSegment(t,e){const i=this.segments.length;if(t<0&&(t=i+t+1),t>i||t<0)throw new Error("Index out of range.");let r,o=null,s=null;if(i!==0&&(t>=1?(o=this.segments[t-1],s=o.nextSegment):(o=null,s=this.segments[0])),!Array.isArray(e))r=this.prepareSegment(e,o,s),this.segments.splice(t,0,r);else for(let a=0,l=e.length;a<l;a+=1){const h=e[a];r=this.prepareSegment(h,o,s),this.segments.splice(t+a,0,r),o=r}return this}removeSegment(t){const e=this.fixIndex(t),i=this.segments.splice(e,1)[0],r=i.previousSegment,o=i.nextSegment;return r&&(r.nextSegment=o),o&&(o.previousSegment=r),i.isSubpathStart&&o&&this.updateSubpathStartSegment(o),i}replaceSegment(t,e){const i=this.fixIndex(t);let r;const o=this.segments[i];let s=o.previousSegment;const a=o.nextSegment;let l=o.isSubpathStart;if(!Array.isArray(e))r=this.prepareSegment(e,s,a),this.segments.splice(i,1,r),l&&r.isSubpathStart&&(l=!1);else{this.segments.splice(t,1);for(let h=0,u=e.length;h<u;h+=1){const d=e[h];r=this.prepareSegment(d,s,a),this.segments.splice(t+h,0,r),s=r,l&&r.isSubpathStart&&(l=!1)}}l&&a&&this.updateSubpathStartSegment(a)}getSegment(t){const e=this.fixIndex(t);return this.segments[e]}fixIndex(t){const e=this.segments.length;if(e===0)throw new Error("Path has no segments.");let i=t;for(;i<0;)i=e+i;if(i>=e||i<0)throw new Error("Index out of range.");return i}segmentAt(t,e={}){const i=this.segmentIndexAt(t,e);return i?this.getSegment(i):null}segmentAtLength(t,e={}){const i=this.segmentIndexAtLength(t,e);return i?this.getSegment(i):null}segmentIndexAt(t,e={}){if(this.segments.length===0)return null;const i=Ne.clamp(t,0,1),r=this.getOptions(e),s=this.length(r)*i;return this.segmentIndexAtLength(s,r)}segmentIndexAtLength(t,e={}){const i=this.segments.length;if(i===0)return null;let r=!0;t<0&&(r=!1,t=-t);const o=this.getPrecision(e),s=this.getSubdivisions(e);let a=0,l=null;for(let h=0;h<i;h+=1){const u=r?h:i-1-h,d=this.segments[u],c=s[u],g=d.length({precision:o,subdivisions:c});if(d.isVisible){if(t<=a+g)return u;l=u}a+=g}return l}getSegmentSubdivisions(t={}){const e=this.getPrecision(t),i=[];for(let r=0,o=this.segments.length;r<o;r+=1){const a=this.segments[r].getSubdivisions({precision:e});i.push(a)}return i}updateSubpathStartSegment(t){let e=t.previousSegment,i=t;for(;i&&!i.isSubpathStart;)e!=null?i.subpathStartSegment=e.subpathStartSegment:i.subpathStartSegment=null,e=i,i=i.nextSegment}prepareSegment(t,e,i){t.previousSegment=e,t.nextSegment=i,e!=null&&(e.nextSegment=t),i!=null&&(i.previousSegment=t);let r=t;return t.isSubpathStart&&(t.subpathStartSegment=t,r=i),r!=null&&this.updateSubpathStartSegment(r),t}closestPoint(t,e={}){const i=this.closestPointT(t,e);return i?this.pointAtT(i):null}closestPointLength(t,e={}){const i=this.getOptions(e),r=this.closestPointT(t,i);return r?this.lengthAtT(r,i):0}closestPointNormalizedLength(t,e={}){const i=this.getOptions(e),r=this.closestPointLength(t,i);if(r===0)return 0;const o=this.length(i);return o===0?0:r/o}closestPointT(t,e={}){if(this.segments.length===0)return null;const i=this.getPrecision(e),r=this.getSubdivisions(e);let o,s=1/0;for(let a=0,l=this.segments.length;a<l;a+=1){const h=this.segments[a],u=r[a];if(h.isVisible){const d=h.closestPointT(t,{precision:i,subdivisions:u}),c=h.pointAtT(d),g=Ne.squaredLength(c,t);g<s&&(o={segmentIndex:a,value:d},s=g)}}return o||{segmentIndex:this.segments.length-1,value:1}}closestPointTangent(t,e={}){if(this.segments.length===0)return null;const i=this.getPrecision(e),r=this.getSubdivisions(e);let o,s=1/0;for(let a=0,l=this.segments.length;a<l;a+=1){const h=this.segments[a],u=r[a];if(h.isDifferentiable()){const d=h.closestPointT(t,{precision:i,subdivisions:u}),c=h.pointAtT(d),g=Ne.squaredLength(c,t);g<s&&(o=h.tangentAtT(d),s=g)}}return o||null}containsPoint(t,e={}){const i=this.toPolylines(e);if(!i)return!1;let r=0;for(let o=0,s=i.length;o<s;o+=1)i[o].containsPoint(t)&&(r+=1);return r%2===1}pointAt(t,e={}){if(this.segments.length===0)return null;if(t<=0)return this.start.clone();if(t>=1)return this.end.clone();const i=this.getOptions(e),o=this.length(i)*t;return this.pointAtLength(o,i)}pointAtLength(t,e={}){if(this.segments.length===0)return null;if(t===0)return this.start.clone();let i=!0;t<0&&(i=!1,t=-t);const r=this.getPrecision(e),o=this.getSubdivisions(e);let s,a=0;for(let h=0,u=this.segments.length;h<u;h+=1){const d=i?h:u-1-h,c=this.segments[d],g=o[d],f=c.length({precision:r,subdivisions:g});if(c.isVisible){if(t<=a+f)return c.pointAtLength((i?1:-1)*(t-a),{precision:r,subdivisions:g});s=c}a+=f}return s?i?s.end:s.start:this.segments[this.segments.length-1].end.clone()}pointAtT(t){const e=this.segments,i=e.length;if(i===0)return null;const r=t.segmentIndex;if(r<0)return e[0].pointAtT(0);if(r>=i)return e[i-1].pointAtT(1);const o=Ne.clamp(t.value,0,1);return e[r].pointAtT(o)}divideAt(t,e={}){if(this.segments.length===0)return null;const i=Ne.clamp(t,0,1),r=this.getOptions(e),s=this.length(r)*i;return this.divideAtLength(s,r)}divideAtLength(t,e={}){if(this.segments.length===0)return null;let i=!0;t<0&&(i=!1,t=-t);const r=this.getPrecision(e),o=this.getSubdivisions(e);let s=0,a,l,h,u,d;for(let w=0,_=this.segments.length;w<_;w+=1){const A=i?w:_-1-w,x=this.getSegment(A),S=o[A],T={precision:r,subdivisions:S},M=x.length(T);if(x.isDifferentiable()&&(h=x,u=A,t<=s+M)){l=A,a=x.divideAtLength((i?1:-1)*(t-s),T);break}s+=M}if(!h)return null;a||(l=u,d=i?1:0,a=h.divideAtT(d));const c=this.clone(),g=l;c.replaceSegment(g,a);const f=g;let p=g+1,m=g+2;a[0].isDifferentiable()||(c.removeSegment(f),p-=1,m-=1);const v=c.getSegment(p).start;c.insertSegment(p,Xi.createSegment("M",v)),m+=1,a[1].isDifferentiable()||(c.removeSegment(m-1),m-=1);const b=m-f-1;for(let w=m,_=c.segments.length;w<_;w+=1){const A=this.getSegment(w-b),x=c.getSegment(w);if(x.type==="Z"&&!A.subpathStartSegment.end.equals(x.subpathStartSegment.end)){const S=Xi.createSegment("L",A.end);c.replaceSegment(w,S)}}const y=new Xi(c.segments.slice(0,p)),C=new Xi(c.segments.slice(p));return[y,C]}intersectsWithLine(t,e={}){const i=this.toPolylines(e);if(i==null)return null;let r=null;for(let o=0,s=i.length;o<s;o+=1){const a=i[o],l=t.intersect(a);l&&(r==null&&(r=[]),Array.isArray(l)?r.push(...l):r.push(l))}return r}isDifferentiable(){for(let t=0,e=this.segments.length;t<e;t+=1)if(this.segments[t].isDifferentiable())return!0;return!1}isValid(){const t=this.segments;return t.length===0||t[0].type==="M"}length(t={}){if(this.segments.length===0)return 0;const e=this.getSubdivisions(t);let i=0;for(let r=0,o=this.segments.length;r<o;r+=1){const s=this.segments[r],a=e[r];i+=s.length({subdivisions:a})}return i}lengthAtT(t,e={}){const i=this.segments.length;if(i===0)return 0;let r=t.segmentIndex;if(r<0)return 0;let o=Ne.clamp(t.value,0,1);r>=i&&(r=i-1,o=1);const s=this.getPrecision(e),a=this.getSubdivisions(e);let l=0;for(let d=0;d<r;d+=1){const c=this.segments[d],g=a[d];l+=c.length({precision:s,subdivisions:g})}const h=this.segments[r],u=a[r];return l+=h.lengthAtT(o,{precision:s,subdivisions:u}),l}tangentAt(t,e={}){if(this.segments.length===0)return null;const i=Ne.clamp(t,0,1),r=this.getOptions(e),s=this.length(r)*i;return this.tangentAtLength(s,r)}tangentAtLength(t,e={}){if(this.segments.length===0)return null;let i=!0;t<0&&(i=!1,t=-t);const r=this.getPrecision(e),o=this.getSubdivisions(e);let s,a=0;for(let l=0,h=this.segments.length;l<h;l+=1){const u=i?l:h-1-l,d=this.segments[u],c=o[u],g=d.length({precision:r,subdivisions:c});if(d.isDifferentiable()){if(t<=a+g)return d.tangentAtLength((i?1:-1)*(t-a),{precision:r,subdivisions:c});s=d}a+=g}if(s){const l=i?1:0;return s.tangentAtT(l)}return null}tangentAtT(t){const e=this.segments.length;if(e===0)return null;const i=t.segmentIndex;if(i<0)return this.segments[0].tangentAtT(0);if(i>=e)return this.segments[e-1].tangentAtT(1);const r=Ne.clamp(t.value,0,1);return this.segments[i].tangentAtT(r)}getPrecision(t={}){return t.precision==null?this.PRECISION:t.precision}getSubdivisions(t={}){if(t.segmentSubdivisions==null){const e=this.getPrecision(t);return this.getSegmentSubdivisions({precision:e})}return t.segmentSubdivisions}getOptions(t={}){const e=this.getPrecision(t),i=this.getSubdivisions(t);return{precision:e,segmentSubdivisions:i}}toPoints(t={}){const e=this.segments,i=e.length;if(i===0)return null;const r=this.getSubdivisions(t),o=[];let s=[];for(let a=0;a<i;a+=1){const l=e[a];if(l.isVisible){const h=r[a];h.length>0?h.forEach(u=>s.push(u.start)):s.push(l.start)}else s.length>0&&(s.push(e[a-1].end),o.push(s),s=[])}return s.length>0&&(s.push(this.end),o.push(s)),o}toPolylines(t={}){const e=this.toPoints(t);return e?e.map(i=>new ki(i)):null}scale(t,e,i){return this.segments.forEach(r=>r.scale(t,e,i)),this}rotate(t,e){return this.segments.forEach(i=>i.rotate(t,e)),this}translate(t,e){return typeof t=="number"?this.segments.forEach(i=>i.translate(t,e)):this.segments.forEach(i=>i.translate(t)),this}clone(){const t=new Xi;return this.segments.forEach(e=>t.appendSegment(e.clone())),t}equals(t){if(t==null)return!1;const e=this.segments,i=t.segments,r=e.length;if(i.length!==r)return!1;for(let o=0;o<r;o+=1){const s=e[o],a=i[o];if(s.type!==a.type||!s.equals(a))return!1}return!0}toJSON(){return this.segments.map(t=>t.toJSON())}serialize(){if(!this.isValid())throw new Error("Invalid path segments.");return this.segments.map(t=>t.serialize()).join(" ")}toString(){return this.serialize()}};(function(n){function t(e){return e!=null&&e instanceof n}n.isPath=t})(ie||(ie={}));(function(n){function t(i){if(!i)return new n;const r=new n,o=/(?:[a-zA-Z] *)(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)? *,? *)|(?:-?\.\d+ *,? *))+|(?:[a-zA-Z] *)(?! |\d|-|\.)/g,s=n.normalize(i).match(o);if(s!=null)for(let a=0,l=s.length;a<l;a+=1){const h=s[a],u=/(?:[a-zA-Z])|(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)?))|(?:(?:-?\.\d+))/g,d=h.match(u);if(d!=null){const c=d[0],g=d.slice(1).map(p=>+p),f=e.call(null,c,...g);r.appendSegment(f)}}return r}n.parse=t;function e(i,...r){if(i==="M")return Qh.create.call(null,...r);if(i==="L")return _n.create.call(null,...r);if(i==="C")return _r.create.call(null,...r);if(i==="z"||i==="Z")return Jh.create();throw new Error(`Invalid path segment type "${i}"`)}n.createSegment=e})(ie||(ie={}));(function(n){n.normalize=V3,n.isValid=D3,n.drawArc=z3,n.drawPoints=TE,n.arcToCurves=hp})(ie||(ie={}));class Oi{constructor(t){this.options=Object.assign({},t),this.data=this.options.data||{},this.register=this.register.bind(this),this.unregister=this.unregister.bind(this)}get names(){return Object.keys(this.data)}register(t,e,i=!1){if(typeof t=="object"){Object.entries(t).forEach(([s,a])=>{this.register(s,a,e)});return}this.exist(t)&&!i&&!la.isApplyingHMR()&&this.onDuplicated(t);const r=this.options.process,o=r?Nt(r,this,t,e):e;return this.data[t]=o,o}unregister(t){const e=t?this.data[t]:null;return delete this.data[t],e}get(t){return t?this.data[t]:null}exist(t){return t?this.data[t]!=null:!1}onDuplicated(t){try{throw this.options.onConflict&&Nt(this.options.onConflict,this,t),new Error(`${vS(this.options.type)} with name '${t}' already registered.`)}catch(e){throw e}}onNotFound(t,e){throw new Error(this.getSpellingSuggestion(t,e))}getSpellingSuggestion(t,e){const i=this.getSpellingSuggestionForName(t),r=e?`${e} ${fz(this.options.type)}`:this.options.type;return`${vS(r)} with name '${t}' does not exist.${i?` Did you mean '${i}'?`:""}`}getSpellingSuggestionForName(t){return jz(t,Object.keys(this.data),e=>e)}}(function(n){function t(e){return new n(e)}n.create=t})(Oi||(Oi={}));const G3={color:"#aaaaaa",thickness:1,markup:"rect",update(n,t){const e=t.thickness*t.sx,i=t.thickness*t.sy;je(n,{width:e,height:i,rx:e,ry:i,fill:t.color})}},$3={color:"#aaaaaa",thickness:1,markup:"rect",update(n,t){const e=t.sx<=1?t.thickness*t.sx:t.thickness;je(n,{width:e,height:e,rx:e,ry:e,fill:t.color})}},U3={color:"rgba(224,224,224,1)",thickness:1,markup:"path",update(n,t){let e;const i=t.width,r=t.height,o=t.thickness;i-o>=0&&r-o>=0?e=["M",i,0,"H0 M0 0 V0",r].join(" "):e="M 0 0 0 0",je(n,{d:e,stroke:t.color,"stroke-width":t.thickness})}},X3=[{color:"rgba(224,224,224,1)",thickness:1,markup:"path",update(n,t){let e;const i=t.width,r=t.height,o=t.thickness;i-o>=0&&r-o>=0?e=["M",i,0,"H0 M0 0 V0",r].join(" "):e="M 0 0 0 0",je(n,{d:e,stroke:t.color,"stroke-width":t.thickness})}},{color:"rgba(224,224,224,0.2)",thickness:3,factor:4,markup:"path",update(n,t){let e;const i=t.factor||1,r=t.width*i,o=t.height*i,s=t.thickness;r-s>=0&&o-s>=0?e=["M",r,0,"H0 M0 0 V0",o].join(" "):e="M 0 0 0 0",t.width=r,t.height=o,je(n,{d:e,stroke:t.color,"stroke-width":t.thickness})}}],Y3=Object.freeze(Object.defineProperty({__proto__:null,dot:G3,doubleMesh:X3,fixedDot:$3,mesh:U3},Symbol.toStringTag,{value:"Module"}));let Js=class{constructor(){this.patterns={},this.root=Ft.create(rp(),{width:"100%",height:"100%"},[uo("defs")]).node}add(t,e){const i=this.root.childNodes[0];i&&i.appendChild(e),this.patterns[t]=e,Ft.create("rect",{width:"100%",height:"100%",fill:`url(#${t})`}).appendTo(this.root)}get(t){return this.patterns[t]}has(t){return this.patterns[t]!=null}};(function(n){n.presets=Y3,n.registry=Oi.create({type:"grid"}),n.registry.register(n.presets,!0)})(Js||(Js={}));const BE=function(n){const t=document.createElement("canvas"),e=n.width,i=n.height;t.width=e*2,t.height=i;const r=t.getContext("2d");return r.drawImage(n,0,0,e,i),r.translate(2*e,0),r.scale(-1,1),r.drawImage(n,0,0,e,i),t},kE=function(n){const t=document.createElement("canvas"),e=n.width,i=n.height;t.width=e,t.height=i*2;const r=t.getContext("2d");return r.drawImage(n,0,0,e,i),r.translate(0,2*i),r.scale(1,-1),r.drawImage(n,0,0,e,i),t},PE=function(n){const t=document.createElement("canvas"),e=n.width,i=n.height;t.width=2*e,t.height=2*i;const r=t.getContext("2d");return r.drawImage(n,0,0,e,i),r.setTransform(-1,0,0,-1,t.width,t.height),r.drawImage(n,0,0,e,i),r.setTransform(-1,0,0,1,t.width,0),r.drawImage(n,0,0,e,i),r.setTransform(1,0,0,-1,0,t.height),r.drawImage(n,0,0,e,i),t},q3=function(n,t){const e=n.width,i=n.height,r=document.createElement("canvas");r.width=e*3,r.height=i*3;const o=r.getContext("2d"),s=t.angle!=null?-t.angle:-20,a=We.toRad(s),l=r.width/4,h=r.height/4;for(let u=0;u<4;u+=1)for(let d=0;d<4;d+=1)(u+d)%2>0&&(o.setTransform(1,0,0,1,(2*u-1)*l,(2*d-1)*h),o.rotate(a),o.drawImage(n,-e/2,-i/2,e,i));return r},K3=Object.freeze(Object.defineProperty({__proto__:null,flipX:BE,flipXY:PE,flipY:kE,watermark:q3},Symbol.toStringTag,{value:"Module"}));var ac;(function(n){n.presets=Object.assign({},K3),n.presets["flip-x"]=BE,n.presets["flip-y"]=kE,n.presets["flip-xy"]=PE,n.registry=Oi.create({type:"background pattern"}),n.registry.register(n.presets,!0)})(ac||(ac={}));function E1(n,t){return n??t}function qi(n,t){return n!=null&&Number.isFinite(n)?n:t}function Z3(n={}){const t=E1(n.color,"blue"),e=qi(n.width,1),i=qi(n.margin,2),r=qi(n.opacity,1),o=i,s=i+e;return`
    <filter>
      <feFlood flood-color="${t}" flood-opacity="${r}" result="colored"/>
      <feMorphology in="SourceAlpha" result="morphedOuter" operator="dilate" radius="${s}" />
      <feMorphology in="SourceAlpha" result="morphedInner" operator="dilate" radius="${o}" />
      <feComposite result="morphedOuterColored" in="colored" in2="morphedOuter" operator="in"/>
      <feComposite operator="xor" in="morphedOuterColored" in2="morphedInner" result="outline"/>
      <feMerge>
        <feMergeNode in="outline"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  `.trim()}function J3(n={}){const t=E1(n.color,"red"),e=qi(n.blur,0),i=qi(n.width,1),r=qi(n.opacity,1);return`
      <filter>
        <feFlood flood-color="${t}" flood-opacity="${r}" result="colored"/>
        <feMorphology result="morphed" in="SourceGraphic" operator="dilate" radius="${i}"/>
        <feComposite result="composed" in="colored" in2="morphed" operator="in"/>
        <feGaussianBlur result="blured" in="composed" stdDeviation="${e}"/>
        <feBlend in="SourceGraphic" in2="blured" mode="normal"/>
      </filter>
    `.trim()}function Q3(n={}){const t=qi(n.x,2);return`
    <filter>
      <feGaussianBlur stdDeviation="${n.y!=null&&Number.isFinite(n.y)?[t,n.y]:t}"/>
    </filter>
  `.trim()}function tN(n={}){const t=qi(n.dx,0),e=qi(n.dy,0),i=E1(n.color,"black"),r=qi(n.blur,4),o=qi(n.opacity,1);return"SVGFEDropShadowElement"in window?`<filter>
         <feDropShadow stdDeviation="${r}" dx="${t}" dy="${e}" flood-color="${i}" flood-opacity="${o}" />
       </filter>`.trim():`<filter>
         <feGaussianBlur in="SourceAlpha" stdDeviation="${r}" />
         <feOffset dx="${t}" dy="${e}" result="offsetblur" />
         <feFlood flood-color="${i}" />
         <feComposite in2="offsetblur" operator="in" />
         <feComponentTransfer>
           <feFuncA type="linear" slope="${o}" />
         </feComponentTransfer>
         <feMerge>
           <feMergeNode/>
           <feMergeNode in="SourceGraphic"/>
         </feMerge>
       </filter>`.trim()}function eN(n={}){const t=qi(n.amount,1),e=.2126+.7874*(1-t),i=.7152-.7152*(1-t),r=.0722-.0722*(1-t),o=.2126-.2126*(1-t),s=.7152+.2848*(1-t),a=.0722-.0722*(1-t),l=.2126-.2126*(1-t),h=.0722+.9278*(1-t);return`
    <filter>
      <feColorMatrix type="matrix" values="${e} ${i} ${r} 0 0 ${o} ${s} ${a} 0 0 ${l} ${i} ${h} 0 0 0 0 0 1 0"/>
    </filter>
  `.trim()}function iN(n={}){const t=qi(n.amount,1),e=.393+.607*(1-t),i=.769-.769*(1-t),r=.189-.189*(1-t),o=.349-.349*(1-t),s=.686+.314*(1-t),a=.168-.168*(1-t),l=.272-.272*(1-t),h=.534-.534*(1-t),u=.131+.869*(1-t);return`
      <filter>
        <feColorMatrix type="matrix" values="${e} ${i} ${r} 0 0 ${o} ${s} ${a} 0 0 ${l} ${h} ${u} 0 0 0 0 0 1 0"/>
      </filter>
    `.trim()}function nN(n={}){return`
      <filter>
        <feColorMatrix type="saturate" values="${1-qi(n.amount,1)}"/>
      </filter>
    `.trim()}function rN(n={}){return`
      <filter>
        <feColorMatrix type="hueRotate" values="${qi(n.angle,0)}"/>
      </filter>
    `.trim()}function oN(n={}){const t=qi(n.amount,1),e=1-t;return`
      <filter>
        <feComponentTransfer>
          <feFuncR type="table" tableValues="${t} ${e}"/>
          <feFuncG type="table" tableValues="${t} ${e}"/>
          <feFuncB type="table" tableValues="${t} ${e}"/>
        </feComponentTransfer>
      </filter>
    `.trim()}function sN(n={}){const t=qi(n.amount,1);return`
    <filter>
      <feComponentTransfer>
        <feFuncR type="linear" slope="${t}"/>
        <feFuncG type="linear" slope="${t}"/>
        <feFuncB type="linear" slope="${t}"/>
      </feComponentTransfer>
    </filter>
  `.trim()}function aN(n={}){const t=qi(n.amount,1),e=.5-t/2;return`
    <filter>
     <feComponentTransfer>
        <feFuncR type="linear" slope="${t}" intercept="${e}"/>
        <feFuncG type="linear" slope="${t}" intercept="${e}"/>
        <feFuncB type="linear" slope="${t}" intercept="${e}"/>
      </feComponentTransfer>
    </filter>
  `.trim()}const lN=Object.freeze(Object.defineProperty({__proto__:null,blur:Q3,brightness:sN,contrast:aN,dropShadow:tN,grayScale:eN,highlight:J3,hueRotate:rN,invert:oN,outline:Z3,saturate:nN,sepia:iN},Symbol.toStringTag,{value:"Module"}));var tu;(function(n){n.presets=lN,n.registry=Oi.create({type:"filter"}),n.registry.register(n.presets,!0)})(tu||(tu={}));const hN={xlinkHref:"xlink:href",xlinkShow:"xlink:show",xlinkRole:"xlink:role",xlinkType:"xlink:type",xlinkArcrole:"xlink:arcrole",xlinkTitle:"xlink:title",xlinkActuate:"xlink:actuate",xmlSpace:"xml:space",xmlBase:"xml:base",xmlLang:"xml:lang",preserveAspectRatio:"preserveAspectRatio",requiredExtension:"requiredExtension",requiredFeatures:"requiredFeatures",systemLanguage:"systemLanguage",externalResourcesRequired:"externalResourceRequired"},uN={},EE={position:zm("x","width","origin")},LE={position:zm("y","height","origin")},dN={position:zm("x","width","corner")},cN={position:zm("y","height","corner")},OE={set:ua("width","width")},IE={set:ua("height","height")},gN={set:ua("rx","width")},fN={set:ua("ry","height")},HE={set:(n=>{const t=ua(n,"width"),e=ua(n,"height");return function(i,r){const o=r.refBBox,s=o.height>o.width?t:e;return Nt(s,this,i,r)}})("r")},pN={set(n,{refBBox:t}){let e=parseFloat(n);const i=Ms(n);i&&(e/=100);const r=Math.sqrt(t.height*t.height+t.width*t.width);let o;return Number.isFinite(e)&&(i||e>=0&&e<=1?o=e*r:o=Math.max(e+r,0)),{r:o}}},mN={set:ua("cx","width")},vN={set:ua("cy","height")},DE={set:NE({resetOffset:!0})},bN={set:NE({resetOffset:!1})},FE={set:WE({resetOffset:!0})},yN={set:WE({resetOffset:!1})},CN=HE,_N=DE,wN=FE,xN=EE,SN=LE,AN=OE,MN=IE;function zm(n,t,e){return(i,{refBBox:r})=>{if(i==null)return null;let o=parseFloat(i);const s=Ms(i);s&&(o/=100);let a;if(Number.isFinite(o)){const h=r[e];s||o>0&&o<1?a=h[n]+r[t]*o:a=h[n]+o}const l=new Y;return l[n]=a||0,l}}function ua(n,t){return function(e,{refBBox:i}){let r=parseFloat(e);const o=Ms(e);o&&(r/=100);const s={};if(Number.isFinite(r)){const a=o||r>=0&&r<=1?r*i[t]:Math.max(r+i[t],0);s[n]=a}return s}}function zE(n,t){const e="x6-shape",i=t&&t.resetOffset;return function(r,{elem:o,refBBox:s}){let a=Bl(o,e);if(!a||a.value!==r){const p=n(r);a={value:r,shape:p,shapeBBox:p.bbox()},Bl(o,e,a)}const l=a.shape.clone(),h=a.shapeBBox.clone(),u=h.getOrigin(),d=s.getOrigin();h.x=d.x,h.y=d.y;const c=s.getMaxScaleToFit(h,d),g=h.width===0||s.width===0?1:c.sx,f=h.height===0||s.height===0?1:c.sy;return l.scale(g,f,u),i&&l.translate(-u.x,-u.y),l}}function NE(n){function t(i){return ie.parse(i)}const e=zE(t,n);return(i,r)=>({d:e(i,r).serialize()})}function WE(n){const t=zE(e=>new ki(e),n);return(e,i)=>({points:t(e,i).serialize()})}const TN={qualify:Es,set(n,{view:t}){return`url(#${t.graph.defineGradient(n)})`}},RN={qualify:Es,set(n,{view:t}){const e=t.cell,i=Object.assign({},n);if(e.isEdge()&&i.type==="linearGradient"){const r=t,o=r.sourcePoint,s=r.targetPoint;i.id=`gradient-${i.type}-${e.id}`,i.attrs=Object.assign(Object.assign({},i.attrs),{x1:o.x,y1:o.y,x2:s.x,y2:s.y,gradientUnits:"userSpaceOnUse"}),t.graph.defs.remove(i.id)}return`url(#${t.graph.defineGradient(i)})`}},jE={qualify(n,{attrs:t}){return t.textWrap==null||!Es(t.textWrap)},set(n,{view:t,elem:e,attrs:i}){const r="x6-text",o=Bl(e,r),s=u=>{try{return JSON.parse(u)}catch{return u}},a={x:i.x,eol:i.eol,annotations:s(i.annotations),textPath:s(i["text-path"]||i.textPath),textVerticalAnchor:i["text-vertical-anchor"]||i.textVerticalAnchor,displayEmpty:(i["display-empty"]||i.displayEmpty)==="true",lineHeight:i["line-height"]||i.lineHeight},l=i["font-size"]||i.fontSize,h=JSON.stringify([n,a]);if(l&&e.setAttribute("font-size",l),o==null||o!==h){const u=a.textPath;if(u!=null&&typeof u=="object"){const d=u.selector;if(typeof d=="string"){const c=t.find(d)[0];c instanceof SVGPathElement&&(T1(c),a.textPath=Object.assign({"xlink:href":`#${c.id}`},u))}}yE(e,`${n}`,a),Bl(e,r,h)}}},BN={qualify:Es,set(n,{view:t,elem:e,attrs:i,refBBox:r}){const o=n,s=o.width||0;Ms(s)?r.width*=parseFloat(s)/100:s<=0?r.width+=s:r.width=s;const a=o.height||0;Ms(a)?r.height*=parseFloat(a)/100:a<=0?r.height+=a:r.height=a;let l,h=o.text;h==null&&(h=i.text||e?.textContent),h!=null?l=CE(`${h}`,r,{"font-weight":i["font-weight"]||i.fontWeight,"font-size":i["font-size"]||i.fontSize,"font-family":i["font-family"]||i.fontFamily,lineHeight:i.lineHeight},{ellipsis:o.ellipsis}):l="",Nt(jE.set,this,l,{view:t,elem:e,attrs:i,refBBox:r,cell:t.cell})}},Eu=(n,{attrs:t})=>t.text!==void 0,kN={qualify:Eu},PN={qualify:Eu},EN={qualify:Eu},LN={qualify:Eu},ON={qualify:Eu},IN={qualify:Eu},HN={qualify(n,{elem:t}){return t instanceof SVGElement},set(n,{elem:t}){const e="x6-title",i=`${n}`,r=Bl(t,e);if(r==null||r!==i){Bl(t,e,i);const o=t.firstChild;if(o&&o.tagName.toUpperCase()==="TITLE"){const s=o;s.textContent=i}else{const s=document.createElementNS(t.namespaceURI,"title");s.textContent=i,t.insertBefore(s,o)}}}},DN={offset:VE("x","width","right")},FN={offset:VE("y","height","bottom")},zN={offset(n,{refBBox:t}){return n?{x:-t.x,y:-t.y}:{x:0,y:0}}};function VE(n,t,e){return(i,{refBBox:r})=>{const o=new Y;let s;return i==="middle"?s=r[t]/2:i===e?s=r[t]:typeof i=="number"&&Number.isFinite(i)?s=i>-1&&i<1?-r[t]*i:-i:Ms(i)?s=r[t]*parseFloat(i)/100:s=0,o[n]=-(r[n]+s),o}}const NN={qualify:Es,set(n,{elem:t}){Qc(t,n)}},WN={set(n,{elem:t}){t.innerHTML=`${n}`}},jN={qualify:Es,set(n,{view:t}){return`url(#${t.graph.defineFilter(n)})`}},VN={set(n){return n!=null&&typeof n=="object"&&n.id?n.id:n}};function Sa(n,t,e){let i,r;typeof t=="object"?(i=t.x,r=t.y):(i=t,r=e);const o=ie.parse(n),s=o.bbox();if(s){let a=-s.height/2-s.y,l=-s.width/2-s.x;typeof i=="number"&&(l-=i),typeof r=="number"&&(a-=r),o.translate(l,a)}return o.serialize()}var GE=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};const GN=n=>{var{size:t,width:e,height:i,offset:r,open:o}=n,s=GE(n,["size","width","height","offset","open"]);return $E({size:t,width:e,height:i,offset:r},o===!0,!0,void 0,s)},$N=n=>{var{size:t,width:e,height:i,offset:r,factor:o}=n,s=GE(n,["size","width","height","offset","factor"]);return $E({size:t,width:e,height:i,offset:r},!1,!1,o,s)};function $E(n,t,e,i=3/4,r={}){const o=n.size||10,s=n.width||o,a=n.height||o,l=new ie,h={};if(t)l.moveTo(s,0).lineTo(0,a/2).lineTo(s,a),h.fill="none";else{if(l.moveTo(0,a/2),l.lineTo(s,0),!e){const u=Br(i,0,1);l.lineTo(s*u,a/2)}l.lineTo(s,a),l.close()}return Object.assign(Object.assign(Object.assign({},h),r),{tagName:"path",d:Sa(l.serialize(),{x:n.offset!=null?n.offset:-s/2})})}var UN=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};const XN=n=>{var{size:t,width:e,height:i,offset:r}=n,o=UN(n,["size","width","height","offset"]);const s=t||10,a=e||s,l=i||s,h=new ie;return h.moveTo(0,l/2).lineTo(a/2,0).lineTo(a,l/2).lineTo(a/2,l).close(),Object.assign(Object.assign({},o),{tagName:"path",d:Sa(h.serialize(),r??-a/2)})};var YN=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};const qN=n=>{var{d:t,offsetX:e,offsetY:i}=n,r=YN(n,["d","offsetX","offsetY"]);return Object.assign(Object.assign({},r),{tagName:"path",d:Sa(t,e,i)})};var KN=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};const ZN=n=>{var{size:t,width:e,height:i,offset:r}=n,o=KN(n,["size","width","height","offset"]);const s=t||10,a=e||s,l=i||s,h=new ie;return h.moveTo(0,0).lineTo(a,l).moveTo(0,l).lineTo(a,0),Object.assign(Object.assign({},o),{tagName:"path",fill:"none",d:Sa(h.serialize(),r||-a/2)})};var JN=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};const QN=n=>{var{width:t,height:e,offset:i,open:r,flip:o}=n,s=JN(n,["width","height","offset","open","flip"]);let a=e||6;const l=t||10,h=r===!0,u=o===!0,d=Object.assign(Object.assign({},s),{tagName:"path"});u&&(a=-a);const c=new ie;return c.moveTo(0,a).lineTo(l,0),h?d.fill="none":(c.lineTo(l,a),c.close()),d.d=Sa(c.serialize(),{x:i||-l/2,y:a/2}),d};var UE=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};const XE=n=>{var{r:t}=n,e=UE(n,["r"]);const i=t||5;return Object.assign(Object.assign({cx:i},e),{tagName:"circle",r:i})},tW=n=>{var{r:t}=n,e=UE(n,["r"]);const i=t||5,r=new ie;return r.moveTo(i,0).lineTo(i,i*2),r.moveTo(0,i).lineTo(i*2,i),{children:[Object.assign(Object.assign({},XE({r:i})),{fill:"none"}),Object.assign(Object.assign({},e),{tagName:"path",d:Sa(r.serialize(),-i)})]}};var eW=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};const iW=n=>{var{rx:t,ry:e}=n,i=eW(n,["rx","ry"]);const r=t||5,o=e||5;return Object.assign(Object.assign({cx:r},i),{tagName:"ellipse",rx:r,ry:o})},nW=Object.freeze(Object.defineProperty({__proto__:null,async:QN,block:GN,circle:XE,circlePlus:tW,classic:$N,cross:ZN,diamond:XN,ellipse:iW,path:qN},Symbol.toStringTag,{value:"Module"}));var da;(function(n){n.presets=nW,n.registry=Oi.create({type:"marker"}),n.registry.register(n.presets,!0)})(da||(da={}));(function(n){n.normalize=Sa})(da||(da={}));var rW=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};function L1(n){return typeof n=="string"||Es(n)}const oW={qualify:L1,set(n,{view:t,attrs:e}){return O1("marker-start",n,t,e)}},sW={qualify:L1,set(n,{view:t,attrs:e}){return O1("marker-end",n,t,e,{transform:"rotate(180)"})}},aW={qualify:L1,set(n,{view:t,attrs:e}){return O1("marker-mid",n,t,e)}};function O1(n,t,e,i,r={}){const o=typeof t=="string"?{name:t}:t,{name:s,args:a}=o,l=rW(o,["name","args"]);let h=l;if(s&&typeof s=="string"){const d=da.registry.get(s);if(d)h=d(Object.assign(Object.assign({},l),a));else return da.registry.onNotFound(s)}const u=Object.assign(Object.assign(Object.assign({},lW(i,n)),r),h);return{[n]:`url(#${e.graph.defineMarker(u)})`}}function lW(n,t){const e={},i=n.stroke;typeof i=="string"&&(e.stroke=i,e.fill=i);let r=n.strokeOpacity;if(r==null&&(r=n["stroke-opacity"]),r==null&&(r=n.opacity),r!=null&&(e["stroke-opacity"]=r,e["fill-opacity"]=r),t!=="marker-mid"){const o=parseFloat(n.strokeWidth||n["stroke-width"]);if(Number.isFinite(o)&&o>1){const s=Math.ceil(o/2);e.refX=t==="marker-start"?s:-s}}return e}const tg=(n,{view:t})=>t.cell.isEdge(),hW={qualify:tg,set(n,t){var e,i,r,o;const s=t.view,a=n.reverse||!1,l=n.stubs||0;let h;if(Number.isFinite(l)&&l!==0)if(a){let u,d;const c=s.getConnectionLength()||0;l<0?(u=(c+l)/2,d=-l):(u=l,d=c-l*2);const g=s.getConnection();h=(o=(r=(i=(e=g?.divideAtLength(u))===null||e===void 0?void 0:e[1])===null||i===void 0?void 0:i.divideAtLength(d))===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.serialize()}else{let u;l<0?u=((s.getConnectionLength()||0)+l)/2:u=l;const d=s.getConnection();if(d){const c=d.divideAtLength(u),g=d.divideAtLength(-u);c&&g&&(h=`${c[0].serialize()} ${g[1].serialize()}`)}}return{d:h||s.getConnectionPathData()}}},YE={qualify:tg,set:Nm("getTangentAtLength",{rotate:!0})},uW={qualify:tg,set:Nm("getTangentAtLength",{rotate:!1})},qE={qualify:tg,set:Nm("getTangentAtRatio",{rotate:!0})},dW={qualify:tg,set:Nm("getTangentAtRatio",{rotate:!1})},cW=YE,gW=qE;function Nm(n,t){const e={x:1,y:0};return(i,r)=>{let o,s;const a=r.view,l=a[n](Number(i));return l?(s=t.rotate?l.vector().vectorAngle(e):0,o=l.start):(o=a.path.start,s=0),s===0?{transform:`translate(${o.x},${o.y}')`}:{transform:`translate(${o.x},${o.y}') rotate(${s})`}}}const fW=Object.freeze(Object.defineProperty({__proto__:null,annotations:LN,atConnectionLength:cW,atConnectionLengthIgnoreGradient:uW,atConnectionLengthKeepGradient:YE,atConnectionRatio:gW,atConnectionRatioIgnoreGradient:dW,atConnectionRatioKeepGradient:qE,connection:hW,displayEmpty:IN,eol:ON,fill:TN,filter:jN,html:WN,lineHeight:kN,port:VN,ref:uN,refCx:mN,refCy:vN,refD:_N,refDKeepOffset:bN,refDResetOffset:DE,refDx:dN,refDy:cN,refHeight:IE,refHeight2:MN,refPoints:wN,refPointsKeepOffset:yN,refPointsResetOffset:FE,refR:CN,refRCircumscribed:pN,refRInscribed:HE,refRx:gN,refRy:fN,refWidth:OE,refWidth2:AN,refX:EE,refX2:xN,refY:LE,refY2:SN,resetOffset:zN,sourceMarker:oW,stroke:RN,style:NN,targetMarker:sW,text:jE,textPath:EN,textVerticalAnchor:PN,textWrap:BN,title:HN,vertexMarker:aW,xAlign:DN,yAlign:FN},Symbol.toStringTag,{value:"Module"}));var Do;(function(n){function t(e,i,r){return!!(e!=null&&(typeof e=="string"||typeof e.qualify!="function"||Nt(e.qualify,this,i,r)))}n.isValidDefinition=t})(Do||(Do={}));(function(n){n.presets=Object.assign(Object.assign({},hN),fW),n.registry=Oi.create({type:"attribute definition"}),n.registry.register(n.presets,!0)})(Do||(Do={}));const ro={prefixCls:"x6",autoInsertCSS:!0,useCSSSelector:!0,prefix(n){return`${ro.prefixCls}-${n}`}},DS=ro.prefix("highlighted"),pW={highlight(n,t,e){const i=e&&e.className||DS;we(t,i)},unhighlight(n,t,e){const i=e&&e.className||DS;kr(t,i)}},FS=ro.prefix("highlight-opacity"),mW={highlight(n,t){we(t,FS)},unhighlight(n,t){kr(t,FS)}};var Le;(function(n){n.normalizeMarker=Sa;function t(c,g){const f=x3(c.x,c.y).matrixTransform(g);return new Y(f.x,f.y)}n.transformPoint=t;function e(c,g){return new kt(t(c.start,g),t(c.end,g))}n.transformLine=e;function i(c,g){let f=c instanceof ki?c.points:c;return Array.isArray(f)||(f=[]),new ki(f.map(p=>t(p,g)))}n.transformPolyline=i;function r(c,g){const p=uo("svg").createSVGPoint();p.x=c.x,p.y=c.y;const m=p.matrixTransform(g);p.x=c.x+c.width,p.y=c.y;const v=p.matrixTransform(g);p.x=c.x+c.width,p.y=c.y+c.height;const b=p.matrixTransform(g);p.x=c.x,p.y=c.y+c.height;const y=p.matrixTransform(g),C=Math.min(m.x,v.x,b.x,y.x),w=Math.max(m.x,v.x,b.x,y.x),_=Math.min(m.y,v.y,b.y,y.y),A=Math.max(m.y,v.y,b.y,y.y);return new vt(C,_,w-C,A-_)}n.transformRectangle=r;function o(c,g,f){let p;const m=c.ownerSVGElement;if(!m)return new vt(0,0,0,0);try{p=c.getBBox()}catch{p={x:c.clientLeft,y:c.clientTop,width:c.clientWidth,height:c.clientHeight}}if(g)return vt.create(p);const v=Pd(c,f||m);return r(p,v)}n.bbox=o;function s(c,g={}){let f;if(!c.ownerSVGElement||!ha(c)){if(RS(c)){const{left:b,top:y,width:C,height:w}=a(c);return new vt(b,y,C,w)}return new vt(0,0,0,0)}let m=g.target;if(!g.recursive){try{f=c.getBBox()}catch{f={x:c.clientLeft,y:c.clientTop,width:c.clientWidth,height:c.clientHeight}}if(!m)return vt.create(f);const b=Pd(c,m);return r(f,b)}{const b=c.childNodes,y=b.length;if(y===0)return s(c,{target:m});m||(m=c);for(let C=0;C<y;C+=1){const w=b[C];let _;w.childNodes.length===0?_=s(w,{target:m}):_=s(w,{target:m,recursive:!0}),f?f=f.union(_):f=_}return f}}n.getBBox=s;function a(c){let g=0,f=0,p=0,m=0;if(c){let v=c;for(;v;)g+=v.offsetLeft,f+=v.offsetTop,v=v.offsetParent,v&&(g+=parseInt(ES(v,"borderLeft"),10),f+=parseInt(ES(v,"borderTop"),10));p=c.offsetWidth,m=c.offsetHeight}return{left:g,top:f,width:p,height:m}}n.getBoundingOffsetRect=a;function l(c){const g=f=>{const p=c.getAttribute(f),m=p?parseFloat(p):0;return Number.isNaN(m)?0:m};switch(c instanceof SVGElement&&c.nodeName.toLowerCase()){case"rect":return new vt(g("x"),g("y"),g("width"),g("height"));case"circle":return new no(g("cx"),g("cy"),g("r"),g("r"));case"ellipse":return new no(g("cx"),g("cy"),g("rx"),g("ry"));case"polyline":{const f=sp(c);return new ki(f)}case"polygon":{const f=sp(c);return f.length>1&&f.push(f[0]),new ki(f)}case"path":{let f=c.getAttribute("d");return ie.isValid(f)||(f=ie.normalize(f)),ie.parse(f)}case"line":return new kt(g("x1"),g("y1"),g("x2"),g("y2"))}return s(c)}n.toGeometryShape=l;function h(c,g,f,p){const m=Y.create(g),v=Y.create(f);p||(p=c instanceof SVGSVGElement?c:c.ownerSVGElement);const b=QC(c);c.setAttribute("transform","");const y=s(c,{target:p}).scale(b.sx,b.sy),C=gd();C.setTranslate(-y.x-y.width/2,-y.y-y.height/2);const w=gd(),_=m.angleBetween(v,m.clone().translate(1,0));_&&w.setRotate(_,0,0);const A=gd(),x=m.clone().move(v,y.width/2);A.setTranslate(2*m.x-x.x,2*m.y-x.y);const S=Pd(c,p),T=gd();T.setMatrix(A.matrix.multiply(w.matrix.multiply(C.matrix.multiply(S.scale(b.sx,b.sy))))),c.setAttribute("transform",Pu(T.matrix))}n.translateAndAutoOrient=h;function u(c){if(c==null)return null;let g=c;do{let f=g.tagName;if(typeof f!="string")return null;if(f=f.toUpperCase(),Kc(g,"x6-port"))g=g.nextElementSibling;else if(f==="G")g=g.firstElementChild;else if(f==="TITLE")g=g.nextElementSibling;else break}while(g);return g}n.findShapeNode=u;function d(c){const g=u(c);if(!ha(g)){if(RS(c)){const{left:m,top:v,width:b,height:y}=a(c);return new vt(m,v,b,y)}return new vt(0,0,0,0)}return l(g).bbox()||vt.create()}n.getBBoxV2=d})(Le||(Le={}));const vW={padding:3,rx:0,ry:0,attrs:{"stroke-width":3,stroke:"#FEB663"}},bW={highlight(n,t,e){const i=Gs.getHighlighterId(t,e);if(Gs.hasCache(i))return;e=DP({},e,vW);const r=Ft.create(t);let o,s;try{o=r.toPathData()}catch{s=Le.bbox(r.node,!0),o=wE(Object.assign(Object.assign({},e),s))}const a=uo("path");if(je(a,Object.assign({d:o,"pointer-events":"none","vector-effect":"non-scaling-stroke",fill:"none"},e.attrs?nc(e.attrs):null)),n.isEdgeElement(t))je(a,"d",n.getConnectionPathData());else{let u=r.getTransformToElement(n.container);const d=e.padding;if(d){s==null&&(s=Le.bbox(r.node,!0));const c=s.x+s.width/2,g=s.y+s.height/2;s=Le.transformRectangle(s,u);const f=Math.max(s.width,1),p=Math.max(s.height,1),m=(f+d)/f,v=(p+d)/p,b=Ji({a:m,b:0,c:0,d:v,e:c-m*c,f:g-v*g});u=u.multiply(b)}Kh(a,u)}we(a,ro.prefix("highlight-stroke"));const l=n.cell,h=()=>Gs.removeHighlighter(i);l.on("removed",h),l.model&&l.model.on("reseted",h),n.container.appendChild(a),Gs.setCache(i,a)},unhighlight(n,t,e){Gs.removeHighlighter(Gs.getHighlighterId(t,e))}};var Gs;(function(n){function t(s,a){return T1(s),s.id+JSON.stringify(a)}n.getHighlighterId=t;const e={};function i(s,a){e[s]=a}n.setCache=i;function r(s){return e[s]!=null}n.hasCache=r;function o(s){const a=e[s];a&&(qh(a),delete e[s])}n.removeHighlighter=o})(Gs||(Gs={}));const yW=Object.freeze(Object.defineProperty({__proto__:null,className:pW,opacity:mW,stroke:bW},Symbol.toStringTag,{value:"Module"}));var Cs;(function(n){function t(e,i){if(typeof i.highlight!="function")throw new Error(`Highlighter '${e}' is missing required \`highlight()\` method`);if(typeof i.unhighlight!="function")throw new Error(`Highlighter '${e}' is missing required \`unhighlight()\` method`)}n.check=t})(Cs||(Cs={}));(function(n){n.presets=yW,n.registry=Oi.create({type:"highlighter"}),n.registry.register(n.presets,!0)})(Cs||(Cs={}));function i_(n,t={}){return new Y(Qr(t.x,n.width),Qr(t.y,n.height))}function I1(n,t,e){return Object.assign({angle:t,position:n.toJSON()},e)}const CW=(n,t)=>n.map(({x:e,y:i,angle:r})=>I1(i_(t,{x:e,y:i}),r||0)),_W=(n,t,e)=>{const i=e.start||0,r=e.step||20;return KE(n,t,i,(o,s)=>(o+.5-s/2)*r)},wW=(n,t,e)=>{const i=e.start||0,r=e.step||360/n.length;return KE(n,t,i,o=>o*r)};function KE(n,t,e,i){const r=t.getCenter(),o=t.getTopCenter(),s=t.width/t.height,a=no.fromRect(t),l=n.length;return n.map((h,u)=>{const d=e+i(u,l),c=o.clone().rotate(-d,r).scale(s,1,r),g=h.compensateRotate?-a.tangentTheta(c):0;return(h.dx||h.dy)&&c.translate(h.dx||0,h.dy||0),h.dr&&c.move(r,h.dr),I1(c.round(),g,h)})}var xW=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};const SW=(n,t,e)=>{const i=i_(t,e.start||t.getOrigin()),r=i_(t,e.end||t.getCorner());return eg(n,i,r,e)},AW=(n,t,e)=>eg(n,t.getTopLeft(),t.getBottomLeft(),e),MW=(n,t,e)=>eg(n,t.getTopRight(),t.getBottomRight(),e),TW=(n,t,e)=>eg(n,t.getTopLeft(),t.getTopRight(),e),RW=(n,t,e)=>eg(n,t.getBottomLeft(),t.getBottomRight(),e);function eg(n,t,e,i){const r=new kt(t,e),o=n.length;return n.map((s,a)=>{var{strict:l}=s,h=xW(s,["strict"]);const u=l||i.strict?(a+1)/(o+1):(a+.5)/o,d=r.pointAt(u);return(h.dx||h.dy)&&d.translate(h.dx||0,h.dy||0),I1(d.round(),0,h)})}const BW=Object.freeze(Object.defineProperty({__proto__:null,absolute:CW,bottom:RW,ellipse:_W,ellipseSpread:wW,left:AW,line:SW,right:MW,top:TW},Symbol.toStringTag,{value:"Module"}));var ml;(function(n){n.presets=BW,n.registry=Oi.create({type:"port layout"}),n.registry.register(n.presets,!0)})(ml||(ml={}));const kW={position:{x:0,y:0},angle:0,attrs:{".":{y:"0","text-anchor":"start"}}};function Aa(n,t){const{x:e,y:i,angle:r,attrs:o}=t||{};return DP({},{angle:r,attrs:o,position:{x:e,y:i}},n,kW)}const PW=(n,t,e)=>Aa({position:t.getTopLeft()},e),EW=(n,t,e)=>Aa({position:{x:-15,y:0},attrs:{".":{y:".3em","text-anchor":"end"}}},e),LW=(n,t,e)=>Aa({position:{x:15,y:0},attrs:{".":{y:".3em","text-anchor":"start"}}},e),OW=(n,t,e)=>Aa({position:{x:0,y:-15},attrs:{".":{"text-anchor":"middle"}}},e),IW=(n,t,e)=>Aa({position:{x:0,y:15},attrs:{".":{y:".6em","text-anchor":"middle"}}},e),HW=(n,t,e)=>ZE(n,t,!1,e),DW=(n,t,e)=>ZE(n,t,!0,e),FW=(n,t,e)=>JE(n,t,!1,e),zW=(n,t,e)=>JE(n,t,!0,e);function ZE(n,t,e,i){const r=i.offset!=null?i.offset:15,o=t.getCenter().theta(n),s=QE(t);let a,l,h,u,d=0;return o<s[1]||o>s[2]?(a=".3em",l=r,h=0,u="start"):o<s[0]?(a="0",l=0,h=-r,e?(d=-90,u="start"):u="middle"):o<s[3]?(a=".3em",l=-r,h=0,u="end"):(a=".6em",l=0,h=r,e?(d=90,u="start"):u="middle"),Aa({position:{x:Math.round(l),y:Math.round(h)},angle:d,attrs:{".":{y:a,"text-anchor":u}}},i)}function JE(n,t,e,i){const r=i.offset!=null?i.offset:15,o=t.getCenter().theta(n),s=QE(t);let a,l,h,u,d=0;return o<s[1]||o>s[2]?(a=".3em",l=-r,h=0,u="end"):o<s[0]?(a=".6em",l=0,h=r,e?(d=90,u="start"):u="middle"):o<s[3]?(a=".3em",l=r,h=0,u="start"):(a="0em",l=0,h=-r,e?(d=-90,u="start"):u="middle"),Aa({position:{x:Math.round(l),y:Math.round(h)},angle:d,attrs:{".":{y:a,"text-anchor":u}}},i)}function QE(n){const t=n.getCenter(),e=t.theta(n.getTopLeft()),i=t.theta(n.getBottomLeft()),r=t.theta(n.getBottomRight()),o=t.theta(n.getTopRight());return[e,o,r,i]}const NW=(n,t,e)=>tL(n.diff(t.getCenter()),!1,e),WW=(n,t,e)=>tL(n.diff(t.getCenter()),!0,e);function tL(n,t,e){const i=e.offset!=null?e.offset:20,r=new Y(0,0),o=-n.theta(r),s=n.clone().move(r,i).diff(n).round();let a=".3em",l,h=o;return(o+90)%180===0?(l=t?"end":"middle",!t&&o===-270&&(a="0em")):o>-270&&o<-90?(l="start",h=o-180):l="end",Aa({position:s.round().toJSON(),angle:t?h:0,attrs:{".":{y:a,"text-anchor":l}}},e)}const jW=Object.freeze(Object.defineProperty({__proto__:null,bottom:IW,inside:FW,insideOriented:zW,left:EW,manual:PW,outside:HW,outsideOriented:DW,radial:NW,radialOriented:WW,right:LW,top:OW},Symbol.toStringTag,{value:"Module"}));var eu;(function(n){n.presets=jW,n.registry=Oi.create({type:"port label layout"}),n.registry.register(n.presets,!0)})(eu||(eu={}));var VW=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o};class Ze extends ar{get priority(){return 2}get disposeContainer(){return!0}constructor(){super(),this.cid=n_.uniqueId(),Ze.views[this.cid]=this}confirmUpdate(t,e){return 0}empty(t=this.container){return Zc(t),this}unmount(t=this.container){return qh(t),this}remove(t=this.container){return t===this.container?(this.removeEventListeners(document),this.onRemove(),delete Ze.views[this.cid],this.disposeContainer&&this.unmount(t)):this.unmount(t),this}onRemove(){}setClass(t,e=this.container){e.classList.value=Array.isArray(t)?t.join(" "):t}addClass(t,e=this.container){return we(e,Array.isArray(t)?t.join(" "):t),this}removeClass(t,e=this.container){return kr(e,Array.isArray(t)?t.join(" "):t),this}setStyle(t,e=this.container){return Qc(e,t),this}setAttrs(t,e=this.container){return t!=null&&e!=null&&je(e,t),this}findAttr(t,e=this.container){let i=e;for(;i&&i.nodeType===1;){const r=i.getAttribute(t);if(r!=null)return r;if(i===this.container)return null;i=i.parentNode}return null}find(t,e=this.container,i=this.selectors){return Ze.find(t,e,i).elems}findOne(t,e=this.container,i=this.selectors){const r=this.find(t,e,i);return r.length>0?r[0]:null}findByAttr(t,e=this.container){let i=e;for(;i&&i.getAttribute;){const r=i.getAttribute(t);if((r!=null||i===this.container)&&r!=="false")return i;i=i.parentNode}return null}getSelector(t,e){let i;if(t===this.container)return typeof e=="string"&&(i=`> ${e}`),i;if(t){const r=B1(t)+1;i=`${t.tagName.toLowerCase()}:nth-child(${r})`,e&&(i+=` > ${e}`),i=this.getSelector(t.parentNode,i)}return i}prefixClassName(t){return ro.prefix(t)}delegateEvents(t,e){if(t==null)return this;e||this.undelegateEvents();const i=/^(\S+)\s*(.*)$/;return Object.keys(t).forEach(r=>{const o=r.match(i);if(o==null)return;const s=this.getEventHandler(t[r]);typeof s=="function"&&this.delegateEvent(o[1],o[2],s)}),this}undelegateEvents(){return sn.off(this.container,this.getEventNamespace()),this}delegateDocumentEvents(t,e){return this.addEventListeners(document,t,e),this}undelegateDocumentEvents(){return this.removeEventListeners(document),this}delegateEvent(t,e,i){return sn.on(this.container,t+this.getEventNamespace(),e,i),this}undelegateEvent(t,e,i){const r=t+this.getEventNamespace();return e==null?sn.off(this.container,r):typeof e=="string"?sn.off(this.container,r,e,i):sn.off(this.container,r,e),this}addEventListeners(t,e,i){if(e==null)return this;const r=this.getEventNamespace();return Object.keys(e).forEach(o=>{const s=this.getEventHandler(e[o]);typeof s=="function"&&sn.on(t,o+r,i,s)}),this}removeEventListeners(t){return t!=null&&sn.off(t,this.getEventNamespace()),this}getEventNamespace(){return`.${ro.prefixCls}-event-${this.cid}`}getEventHandler(t){let e;if(typeof t=="string"){const i=this[t];typeof i=="function"&&(e=(...r)=>i.call(this,...r))}else e=(...i)=>t.call(this,...i);return e}getEventTarget(t,e={}){const{target:i,type:r,clientX:o=0,clientY:s=0}=t;return e.fromPoint||r==="touchmove"||r==="touchend"?document.elementFromPoint(o,s):i}stopPropagation(t){return this.setEventData(t,{propagationStopped:!0}),this}isPropagationStopped(t){return this.getEventData(t).propagationStopped===!0}getEventData(t){return this.eventData(t)}setEventData(t,e){return this.eventData(t,e)}eventData(t,e){if(t==null)throw new TypeError("Event object required");let i=t.data;const r=`__${this.cid}__`;return e==null?i==null?{}:i[r]||{}:(i==null&&(i=t.data={}),i[r]==null?i[r]=Object.assign({},e):i[r]=Object.assign(Object.assign({},i[r]),e),i[r])}normalizeEvent(t){return Ze.normalizeEvent(t)}dispose(){this.remove()}}VW([Ze.dispose()],Ze.prototype,"dispose",null);(function(n){function t(r,o){return o?uo(r||"g"):R1(r||"div")}n.createElement=t;function e(r,o,s){if(!r||r===".")return{elems:[o]};if(s){const a=s[r];if(a)return{elems:Array.isArray(a)?a:[a]}}{const a=r.includes(">")?`:scope ${r}`:r;return{isCSSSelector:!0,elems:Array.prototype.slice.call(o.querySelectorAll(a))}}}n.find=e;function i(r){let o=r;const s=r.originalEvent,a=s&&s.changedTouches&&s.changedTouches[0];if(a){for(const l in r)a[l]===void 0&&(a[l]=r[l]);o=a}return o}n.normalizeEvent=i})(Ze||(Ze={}));(function(n){n.views={};function t(e){return n.views[e]||null}n.getView=t})(Ze||(Ze={}));var n_;(function(n){let t=0;function e(){const i=`v${t}`;return t+=1,i}n.uniqueId=e})(n_||(n_={}));class GW{constructor(t){this.view=t,this.clean()}clean(){this.elemCache&&this.elemCache.dispose(),this.elemCache=new e_,this.pathCache={}}get(t){return this.elemCache.has(t)||this.elemCache.set(t,{}),this.elemCache.get(t)}getData(t){const e=this.get(t);return e.data||(e.data={}),e.data}getMatrix(t){const e=this.get(t);if(e.matrix==null){const i=this.view.container;e.matrix=R3(t,i)}return Ji(e.matrix)}getShape(t){const e=this.get(t);return e.shape==null&&(e.shape=Le.toGeometryShape(t)),e.shape.clone()}getBoundingRect(t){const e=this.get(t);return e.boundingRect==null&&(e.boundingRect=Le.getBBoxV2(t)),e.boundingRect.clone()}}var qe;(function(n){function t(h){return h!=null&&!e(h)}n.isJSONMarkup=t;function e(h){return h!=null&&typeof h=="string"}n.isStringMarkup=e;function i(h){return h==null||e(h)?h:gi(h)}n.clone=i;function r(h){return`${h}`.trim().replace(/[\r|\n]/g," ").replace(/>\s+</g,"><")}n.sanitize=r;function o(h,u={ns:Yi.svg}){const d=document.createDocumentFragment(),c={},g={},f=[{markup:Array.isArray(h)?h:[h],parent:d,ns:u.ns}];for(;f.length>0;){const p=f.pop();let m=p.ns||Yi.svg;const v=p.markup,b=p.parent;v.forEach(y=>{const C=y.tagName;if(!C)throw new TypeError("Invalid tagName");y.ns&&(m=y.ns);const w=m?R1(C,m):TS(C),_=y.attrs;_&&je(w,nc(_));const A=y.style;A&&Qc(w,A);const x=y.className;x!=null&&w.setAttribute("class",Array.isArray(x)?x.join(" "):x),y.textContent&&(w.textContent=y.textContent);const S=y.selector;if(S!=null){if(g[S])throw new TypeError("Selector must be unique");g[S]=w}if(y.groupSelector){let M=y.groupSelector;Array.isArray(M)||(M=[M]),M.forEach(R=>{c[R]||(c[R]=[]),c[R].push(w)})}b.appendChild(w);const T=y.children;Array.isArray(T)&&f.push({ns:m,markup:T,parent:w})})}return Object.keys(c).forEach(p=>{if(g[p])throw new Error("Ambiguous group selector");g[p]=c[p]}),{fragment:d,selectors:g,groups:c}}n.parseJSONMarkup=o;function s(h){return h instanceof SVGElement?uo("g"):TS("div")}function a(h){if(e(h)){const g=Ft.createVectors(h),f=g.length;if(f===1)return{elem:g[0].node};if(f>1){const p=s(g[0].node);return g.forEach(m=>{p.appendChild(m.node)}),{elem:p}}return{}}const u=o(h),d=u.fragment;let c=null;return d.childNodes.length>1?(c=s(d.firstChild),c.appendChild(d)):c=d.firstChild,{elem:c,selectors:u.selectors}}n.renderMarkup=a;function l(h){const u=Ft.createVectors(h),d=document.createDocumentFragment();for(let c=0,g=u.length;c<g;c+=1){const f=u[c].node;d.appendChild(f)}return{fragment:d,selectors:{}}}n.parseLabelStringMarkup=l})(qe||(qe={}));(function(n){function t(e,i,r){if(e!=null){let o;const s=e.tagName.toLowerCase();if(e===i)return typeof r=="string"?o=`> ${s} > ${r}`:o=`> ${s}`,o;const a=e.parentNode;if(a&&a.childNodes.length>1){const l=B1(e)+1;o=`${s}:nth-child(${l})`}else o=s;return r&&(o+=` > ${r}`),t(e.parentNode,i,o)}return r}n.getSelector=t})(qe||(qe={}));(function(n){function t(){return"g"}n.getPortContainerMarkup=t;function e(){return{tagName:"circle",selector:"circle",attrs:{r:10,fill:"#FFFFFF",stroke:"#000000"}}}n.getPortMarkup=e;function i(){return{tagName:"text",selector:"text",attrs:{fill:"#000000"}}}n.getPortLabelMarkup=i})(qe||(qe={}));(function(n){function t(){return[{tagName:"path",selector:"wrap",groupSelector:"lines",attrs:{fill:"none",cursor:"pointer",stroke:"transparent",strokeLinecap:"round"}},{tagName:"path",selector:"line",groupSelector:"lines",attrs:{fill:"none",pointerEvents:"none"}}]}n.getEdgeMarkup=t})(qe||(qe={}));(function(n){function t(e=!1){return{tagName:"foreignObject",selector:"fo",children:[{ns:Yi.xhtml,tagName:"body",selector:"foBody",attrs:{xmlns:Yi.xhtml},style:{width:"100%",height:"100%",background:"transparent"},children:e?[]:[{tagName:"div",selector:"foContent",style:{width:"100%",height:"100%"}}]}]}}n.getForeignObjectMarkup=t})(qe||(qe={}));class eL{constructor(t){this.view=t}get cell(){return this.view.cell}getDefinition(t){return this.cell.getAttrDefinition(t)}processAttrs(t,e){let i,r,o,s;const a=[];return Object.keys(e).forEach(l=>{const h=e[l],u=this.getDefinition(l),d=Nt(Do.isValidDefinition,this.view,u,h,{elem:t,attrs:e,cell:this.cell,view:this.view});if(u&&d)typeof u=="string"?(i==null&&(i={}),i[u]=h):h!==null&&a.push({name:l,definition:u});else{i==null&&(i={});const c=gE.includes(l)?l:YP(l);i[c]=h}}),a.forEach(({name:l,definition:h})=>{const u=e[l];typeof h.set=="function"&&(r==null&&(r={}),r[l]=u),typeof h.offset=="function"&&(o==null&&(o={}),o[l]=u),typeof h.position=="function"&&(s==null&&(s={}),s[l]=u)}),{raw:e,normal:i,set:r,offset:o,position:s}}mergeProcessedAttrs(t,e){t.set=Object.assign(Object.assign({},t.set),e.set),t.position=Object.assign(Object.assign({},t.position),e.position),t.offset=Object.assign(Object.assign({},t.offset),e.offset);const i=t.normal&&t.normal.transform;i!=null&&e.normal&&(e.normal.transform=i),t.normal=e.normal}findAttrs(t,e,i,r){const o=[],s=new e_;return Object.keys(t).forEach(a=>{const l=t[a];if(!Es(l))return;const{isCSSSelector:h,elems:u}=Ze.find(a,e,r);i[a]=u;for(let d=0,c=u.length;d<c;d+=1){const g=u[d],f=r&&r[a]===g,p=s.get(g);if(p){p.array||(o.push(g),p.array=!0,p.attrs=[p.attrs],p.priority=[p.priority]);const m=p.attrs,v=p.priority;if(f)m.unshift(l),v.unshift(-1);else{const b=pz(v,h?-1:c);m.splice(b,0,l),v.splice(b,0,c)}}else s.set(g,{elem:g,attrs:l,priority:f?-1:c,array:!1})}}),o.forEach(a=>{const l=s.get(a),h=l.attrs;l.attrs=h.reduceRight((u,d)=>Di(u,d),{})}),s}updateRelativeAttrs(t,e,i){const r=e.raw||{};let o=e.normal||{};const s=e.set,a=e.position,l=e.offset,h=()=>({elem:t,cell:this.cell,view:this.view,attrs:r,refBBox:i.clone()});if(s!=null&&Object.keys(s).forEach(m=>{const v=s[m],b=this.getDefinition(m);if(b!=null){const y=Nt(b.set,this.view,v,h());typeof y=="object"?o=Object.assign(Object.assign({},o),y):y!=null&&(o[m]=y)}}),t instanceof HTMLElement){this.view.setAttrs(o,t);return}const u=o.transform,d=u?`${u}`:null,c=rc(d),g=new Y(c.e,c.f);u&&(delete o.transform,c.e=0,c.f=0);let f=!1;a!=null&&Object.keys(a).forEach(m=>{const v=a[m],b=this.getDefinition(m);if(b!=null){const y=Nt(b.position,this.view,v,h());y!=null&&(f=!0,g.translate(Y.create(y)))}}),this.view.setAttrs(o,t);let p=!1;if(l!=null){const m=this.view.getBoundingRectOfElement(t);if(m.width>0&&m.height>0){const v=Le.transformRectangle(m,c);Object.keys(l).forEach(b=>{const y=l[b],C=this.getDefinition(b);if(C!=null){const w=Nt(C.offset,this.view,y,{elem:t,cell:this.cell,view:this.view,attrs:r,refBBox:v});w!=null&&(p=!0,g.translate(Y.create(w)))}})}}(u!=null||f||p)&&(g.round(1),c.e=g.x,c.f=g.y,t.setAttribute("transform",Pu(c)))}update(t,e,i){const r={},o=this.findAttrs(i.attrs||e,t,r,i.selectors),s=i.attrs?this.findAttrs(e,t,r,i.selectors):o,a=[];o.each(u=>{const d=u.elem,c=u.attrs,g=this.processAttrs(d,c);if(g.set==null&&g.position==null&&g.offset==null)this.view.setAttrs(g.normal,d);else{const f=s.get(d),p=f?f.attrs:null,m=p&&c.ref==null?p.ref:c.ref;let v;if(m){if(v=(r[m]||this.view.find(m,t,i.selectors))[0],!v)throw new Error(`"${m}" reference does not exist.`)}else v=null;const b={node:d,refNode:v,attributes:p,processedAttributes:g},y=a.findIndex(C=>C.refNode===d);y>-1?a.splice(y,0,b):a.push(b)}});const l=new e_;let h;a.forEach(u=>{const d=u.node,c=u.refNode;let g;const f=c!=null&&i.rotatableNode!=null&&cE(i.rotatableNode,c);if(c&&(g=l.get(c)),!g){const v=f?i.rotatableNode:t;g=c?Le.getBBox(c,{target:v}):i.rootBBox,c&&l.set(c,g)}let p;i.attrs&&u.attributes?(p=this.processAttrs(d,u.attributes),this.mergeProcessedAttrs(p,u.processedAttributes)):p=u.processedAttributes;let m=g;f&&i.rotatableNode!=null&&!i.rotatableNode.contains(d)&&(h||(h=rc(je(i.rotatableNode,"transform"))),m=Le.transformRectangle(g,h)),this.updateRelativeAttrs(d,p,m)})}}class iL{get cell(){return this.view.cell}constructor(t,e,i=[]){this.view=t;const r={},o={};let s=0;Object.keys(e).forEach(l=>{let h=e[l];Array.isArray(h)||(h=[h]),h.forEach(u=>{let d=r[u];d||(s+=1,d=r[u]=1<<s),o[l]|=d})});let a=i;if(Array.isArray(a)||(a=[a]),a.forEach(l=>{r[l]||(s+=1,r[l]=1<<s)}),s>25)throw new Error("Maximum number of flags exceeded.");this.flags=r,this.attrs=o,this.bootstrap=i}getFlag(t){const e=this.flags;return e==null?0:Array.isArray(t)?t.reduce((i,r)=>i|e[r],0):e[t]|0}hasAction(t,e){return t&this.getFlag(e)}removeAction(t,e){return t^t&this.getFlag(e)}getBootstrapFlag(){return this.getFlag(this.bootstrap)}getChangedFlag(){let t=0;return this.attrs&&Object.keys(this.attrs).forEach(e=>{this.cell.hasChanged(e)&&(t|=this.attrs[e])}),t}}var $W=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o},UW=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};class Ei extends Ze{static getDefaults(){return this.defaults}static config(t){this.defaults=this.getOptions(t)}static getOptions(t){const e=(h,u)=>u!=null?FP([...Array.isArray(h)?h:[h],...Array.isArray(u)?u:[u]]):Array.isArray(h)?[...h]:[h],i=gi(this.getDefaults()),{bootstrap:r,actions:o,events:s,documentEvents:a}=t,l=UW(t,["bootstrap","actions","events","documentEvents"]);return r&&(i.bootstrap=e(i.bootstrap,r)),o&&Object.entries(o).forEach(([h,u])=>{const d=i.actions[h];u&&d?i.actions[h]=e(d,u):u&&(i.actions[h]=e(u))}),s&&(i.events=Object.assign(Object.assign({},i.events),s)),t.documentEvents&&(i.documentEvents=Object.assign(Object.assign({},i.documentEvents),a)),Di(i,l)}get[Symbol.toStringTag](){return Ei.toStringTag}constructor(t,e={}){super(),this.cell=t,this.options=this.ensureOptions(e),this.graph=this.options.graph,this.attr=new eL(this),this.flag=new iL(this,this.options.actions,this.options.bootstrap),this.cache=new GW(this),this.setContainer(this.ensureContainer()),this.setup(),this.init()}init(){}onRemove(){this.removeTools()}get priority(){return this.options.priority}get rootSelector(){return this.options.rootSelector}getConstructor(){return this.constructor}ensureOptions(t){return this.getConstructor().getOptions(t)}getContainerTagName(){return this.options.isSvgElement?"g":"div"}getContainerStyle(){}getContainerAttrs(){return{"data-cell-id":this.cell.id,"data-shape":this.cell.shape}}getContainerClassName(){return this.prefixClassName("cell")}ensureContainer(){return Ze.createElement(this.getContainerTagName(),this.options.isSvgElement)}setContainer(t){if(this.container!==t){this.undelegateEvents(),this.container=t,this.options.events!=null&&this.delegateEvents(this.options.events);const e=this.getContainerAttrs();e!=null&&this.setAttrs(e,t);const i=this.getContainerStyle();i!=null&&this.setStyle(i,t);const r=this.getContainerClassName();r!=null&&this.addClass(r,t)}return this}isNodeView(){return!1}isEdgeView(){return!1}render(){return this}confirmUpdate(t,e={}){return 0}getBootstrapFlag(){return this.flag.getBootstrapFlag()}getFlag(t){return this.flag.getFlag(t)}hasAction(t,e){return this.flag.hasAction(t,e)}removeAction(t,e){return this.flag.removeAction(t,e)}handleAction(t,e,i,r){if(this.hasAction(t,e)){i();const o=[e];return r&&(typeof r=="string"?o.push(r):o.push(...r)),this.removeAction(t,o)}return t}setup(){this.cell.on("changed",this.onCellChanged,this)}onCellChanged({options:t}){this.onAttrsChange(t)}onAttrsChange(t){let e=this.flag.getChangedFlag();t.updated||!e||(t.dirty&&this.hasAction(e,"update")&&(e|=this.getFlag("render")),t.toolId&&(t.async=!1),this.graph!=null&&this.graph.renderer.requestViewUpdate(this,e,t))}parseJSONMarkup(t,e){const i=qe.parseJSONMarkup(t),r=i.selectors,o=this.rootSelector;if(e&&o){if(r[o])throw new Error("Invalid root selector");r[o]=e}return i}can(t){let e=this.graph.options.interacting;if(typeof e=="function"&&(e=Nt(e,this.graph,this)),typeof e=="object"){let i=e[t];return typeof i=="function"&&(i=Nt(i,this.graph,this)),i!==!1}return typeof e=="boolean"?e:!1}cleanCache(){return this.cache.clean(),this}getCache(t){return this.cache.get(t)}getDataOfElement(t){return this.cache.getData(t)}getMatrixOfElement(t){return this.cache.getMatrix(t)}getShapeOfElement(t){return this.cache.getShape(t)}getBoundingRectOfElement(t){return this.cache.getBoundingRect(t)}getBBoxOfElement(t){const e=this.getBoundingRectOfElement(t),i=this.getMatrixOfElement(t),r=this.getRootRotatedMatrix(),o=this.getRootTranslatedMatrix();return Le.transformRectangle(e,o.multiply(r).multiply(i))}getUnrotatedBBoxOfElement(t){const e=this.getBoundingRectOfElement(t),i=this.getMatrixOfElement(t),r=this.getRootTranslatedMatrix();return Le.transformRectangle(e,r.multiply(i))}getBBox(t={}){let e;if(t.useCellGeometry){const i=this.cell,r=i.isNode()?i.getAngle():0;e=i.getBBox().bbox(r)}else e=this.getBBoxOfElement(this.container);return this.graph.coord.localToGraphRect(e)}getRootTranslatedMatrix(){const t=this.cell,e=t.isNode()?t.getPosition():{x:0,y:0};return Ji().translate(e.x,e.y)}getRootRotatedMatrix(){let t=Ji();const e=this.cell,i=e.isNode()?e.getAngle():0;if(i){const r=e.getBBox(),o=r.width/2,s=r.height/2;t=t.translate(o,s).rotate(i).translate(-o,-s)}return t}findMagnet(t=this.container){return this.findByAttr("magnet",t)}updateAttrs(t,e,i={}){i.rootBBox==null&&(i.rootBBox=new vt),i.selectors==null&&(i.selectors=this.selectors),this.attr.update(t,e,i)}isEdgeElement(t){return this.cell.isEdge()&&(t==null||t===this.container)}prepareHighlight(t,e={}){const i=t||this.container;return e.partial=i===this.container,i}highlight(t,e={}){const i=this.prepareHighlight(t,e);return this.notify("cell:highlight",{magnet:i,options:e,view:this,cell:this.cell}),this.isEdgeView()?this.notify("edge:highlight",{magnet:i,options:e,view:this,edge:this.cell,cell:this.cell}):this.isNodeView()&&this.notify("node:highlight",{magnet:i,options:e,view:this,node:this.cell,cell:this.cell}),this}unhighlight(t,e={}){const i=this.prepareHighlight(t,e);return this.notify("cell:unhighlight",{magnet:i,options:e,view:this,cell:this.cell}),this.isNodeView()?this.notify("node:unhighlight",{magnet:i,options:e,view:this,node:this.cell,cell:this.cell}):this.isEdgeView()&&this.notify("edge:unhighlight",{magnet:i,options:e,view:this,edge:this.cell,cell:this.cell}),this}notifyUnhighlight(t,e){}getEdgeTerminal(t,e,i,r,o){const s=this.cell,a=this.findAttr("port",t),l=t.getAttribute("data-selector"),h={cell:s.id};return l!=null&&(h.magnet=l),a!=null?(h.port=a,s.isNode()&&!s.hasPort(a)&&l==null&&(h.selector=this.getSelector(t))):l==null&&this.container!==t&&(h.selector=this.getSelector(t)),h}getMagnetFromEdgeTerminal(t){const e=this.cell,i=this.container,r=t.port;let o=t.magnet,s;return r!=null&&e.isNode()&&e.hasPort(r)?s=this.findPortElem(r,o)||i:(o||(o=t.selector),!o&&r!=null&&(o=`[port="${r}"]`),s=this.findOne(o,i,this.selectors)),s}hasTools(t){const e=this.tools;return e==null?!1:t==null?!0:e.name===t}addTools(t){if(this.removeTools(),t){if(!this.can("toolsAddable"))return this;const e=Wi.isToolsView(t)?t:new Wi(t);this.tools=e,e.config({view:this}),e.mount()}return this}updateTools(t={}){return this.tools&&this.tools.update(t),this}removeTools(){return this.tools&&(this.tools.remove(),this.tools=null),this}hideTools(){return this.tools&&this.tools.hide(),this}showTools(){return this.tools&&this.tools.show(),this}renderTools(){const t=this.cell.getTools();return this.addTools(t),this}notify(t,e){return this.trigger(t,e),this.graph.trigger(t,e),this}getEventArgs(t,e,i){const r=this,o=r.cell;return e==null||i==null?{e:t,view:r,cell:o}:{e:t,x:e,y:i,view:r,cell:o}}onClick(t,e,i){this.notify("cell:click",this.getEventArgs(t,e,i))}onDblClick(t,e,i){this.notify("cell:dblclick",this.getEventArgs(t,e,i))}onContextMenu(t,e,i){this.notify("cell:contextmenu",this.getEventArgs(t,e,i))}onMouseDown(t,e,i){this.cell.model&&(this.cachedModelForMouseEvent=this.cell.model,this.cachedModelForMouseEvent.startBatch("mouse")),this.notify("cell:mousedown",this.getEventArgs(t,e,i))}onMouseUp(t,e,i){this.notify("cell:mouseup",this.getEventArgs(t,e,i)),this.cachedModelForMouseEvent&&(this.cachedModelForMouseEvent.stopBatch("mouse",{cell:this.cell}),this.cachedModelForMouseEvent=null)}onMouseMove(t,e,i){this.notify("cell:mousemove",this.getEventArgs(t,e,i))}onMouseOver(t){this.notify("cell:mouseover",this.getEventArgs(t))}onMouseOut(t){this.notify("cell:mouseout",this.getEventArgs(t))}onMouseEnter(t){this.notify("cell:mouseenter",this.getEventArgs(t))}onMouseLeave(t){this.notify("cell:mouseleave",this.getEventArgs(t))}onMouseWheel(t,e,i,r){this.notify("cell:mousewheel",Object.assign({delta:r},this.getEventArgs(t,e,i)))}onCustomEvent(t,e,i,r){this.notify("cell:customevent",Object.assign({name:e},this.getEventArgs(t,i,r))),this.notify(e,Object.assign({},this.getEventArgs(t,i,r)))}onMagnetMouseDown(t,e,i,r){}onMagnetDblClick(t,e,i,r){}onMagnetContextMenu(t,e,i,r){}onLabelMouseDown(t,e,i){}checkMouseleave(t){const e=this.getEventTarget(t,{fromPoint:!0}),i=this.graph.findViewByElem(e);i!==this&&(this.onMouseLeave(t),i&&i.onMouseEnter(t))}dispose(){this.cell.off("changed",this.onCellChanged,this)}}Ei.defaults={isSvgElement:!0,rootSelector:"root",priority:0,bootstrap:[],actions:{}};$W([Ei.dispose()],Ei.prototype,"dispose",null);(function(n){n.Flag=iL,n.Attr=eL})(Ei||(Ei={}));(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const i=e[Symbol.toStringTag],r=e;return(i==null||i===n.toStringTag)&&typeof r.isNodeView=="function"&&typeof r.isEdgeView=="function"&&typeof r.confirmUpdate=="function"}n.isCellView=t})(Ei||(Ei={}));(function(n){function t(i){return function(r){r.config({priority:i})}}n.priority=t;function e(i){return function(r){r.config({bootstrap:i})}}n.bootstrap=e})(Ei||(Ei={}));(function(n){n.registry=Oi.create({type:"view"})})(Ei||(Ei={}));class Wi extends Ze{get name(){return this.options.name}get graph(){return this.cellView.graph}get cell(){return this.cellView.cell}get[Symbol.toStringTag](){return Wi.toStringTag}constructor(t={}){super(),this.svgContainer=this.createContainer(!0,t),this.htmlContainer=this.createContainer(!1,t),this.config(t)}createContainer(t,e){const i=t?Ze.createElement("g",!0):Ze.createElement("div",!1);return we(i,this.prefixClassName("cell-tools")),e.className&&we(i,e.className),i}config(t){if(this.options=Object.assign(Object.assign({},this.options),t),!Ei.isCellView(t.view)||t.view===this.cellView)return this;this.cellView=t.view,this.cell.isEdge()?(we(this.svgContainer,this.prefixClassName("edge-tools")),we(this.htmlContainer,this.prefixClassName("edge-tools"))):this.cell.isNode()&&(we(this.svgContainer,this.prefixClassName("node-tools")),we(this.htmlContainer,this.prefixClassName("node-tools"))),this.svgContainer.setAttribute("data-cell-id",this.cell.id),this.htmlContainer.setAttribute("data-cell-id",this.cell.id),this.name&&(this.svgContainer.setAttribute("data-tools-name",this.name),this.htmlContainer.setAttribute("data-tools-name",this.name));const e=this.options.items;if(!Array.isArray(e))return this;this.tools=[];const i=[];e.forEach(r=>{Wi.ToolItem.isToolItem(r)?r.name==="vertices"?i.unshift(r):i.push(r):(typeof r=="object"?r.name:r)==="vertices"?i.unshift(r):i.push(r)});for(let r=0;r<i.length;r+=1){const o=i[r];let s;if(Wi.ToolItem.isToolItem(o))s=o;else{const a=typeof o=="object"?o.name:o,l=typeof o=="object"?o.args||{}:{};if(a){if(this.cell.isNode()){const h=nu.registry.get(a);if(h)s=new h(l);else return nu.registry.onNotFound(a)}else if(this.cell.isEdge()){const h=ru.registry.get(a);if(h)s=new h(l);else return ru.registry.onNotFound(a)}}}s&&(s.config(this.cellView,this),s.render(),(s.options.isSVGElement!==!1?this.svgContainer:this.htmlContainer).appendChild(s.container),this.tools.push(s))}return this}update(t={}){const e=this.tools;return e&&e.forEach(i=>{t.toolId!==i.cid&&i.isVisible()&&i.update()}),this}focus(t){const e=this.tools;return e&&e.forEach(i=>{t===i?i.show():i.hide()}),this}blur(t){const e=this.tools;return e&&e.forEach(i=>{i!==t&&!i.isVisible()&&(i.show(),i.update())}),this}hide(){return this.focus(null)}show(){return this.blur(null)}remove(){const t=this.tools;return t&&(t.forEach(e=>e.remove()),this.tools=null),qh(this.svgContainer),qh(this.htmlContainer),super.remove()}mount(){const t=this.tools,e=this.cellView;if(e&&t){const i=t.some(o=>o.options.isSVGElement!==!1),r=t.some(o=>o.options.isSVGElement===!1);i&&(this.options.local?e.container:e.graph.view.decorator).appendChild(this.svgContainer),r&&this.graph.container.appendChild(this.htmlContainer)}return this}}(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const i=e[Symbol.toStringTag],r=e;return(i==null||i===n.toStringTag)&&r.graph!=null&&r.cell!=null&&typeof r.config=="function"&&typeof r.update=="function"&&typeof r.focus=="function"&&typeof r.blur=="function"&&typeof r.show=="function"&&typeof r.hide=="function"}n.isToolsView=t})(Wi||(Wi={}));(function(n){class t extends Ze{static getDefaults(){return this.defaults}static config(i){this.defaults=this.getOptions(i)}static getOptions(i){return Di(gi(this.getDefaults()),i)}get graph(){return this.cellView.graph}get cell(){return this.cellView.cell}get name(){return this.options.name}get[Symbol.toStringTag](){return t.toStringTag}constructor(i={}){super(),this.visible=!0,this.options=this.getOptions(i),this.container=Ze.createElement(this.options.tagName||"g",this.options.isSVGElement!==!1),we(this.container,this.prefixClassName("cell-tool")),typeof this.options.className=="string"&&we(this.container,this.options.className),this.init()}init(){}getOptions(i){return this.constructor.getOptions(i)}delegateEvents(){return this.options.events&&super.delegateEvents(this.options.events),this}config(i,r){return this.cellView=i,this.parent=r,this.stamp(this.container),this.cell.isEdge()?we(this.container,this.prefixClassName("edge-tool")):this.cell.isNode()&&we(this.container,this.prefixClassName("node-tool")),this.name&&this.container.setAttribute("data-tool-name",this.name),this.delegateEvents(),this}render(){this.empty();const i=this.options.markup;if(i){const r=qe.parseJSONMarkup(i);this.container.appendChild(r.fragment),this.childNodes=r.selectors}return this.onRender(),this}onRender(){}update(){return this}stamp(i){i&&i.setAttribute("data-cell-id",this.cellView.cell.id)}show(){return this.container.style.display="",this.visible=!0,this}hide(){return this.container.style.display="none",this.visible=!1,this}isVisible(){return this.visible}focus(){const i=this.options.focusOpacity;return i!=null&&Number.isFinite(i)&&(this.container.style.opacity=`${i}`),this.parent.focus(this),this}blur(){return this.container.style.opacity="",this.parent.blur(this),this}guard(i){return this.graph==null||this.cellView==null?!0:this.graph.view.guard(i,this.cellView)}}t.defaults={isSVGElement:!0,tagName:"g"},n.ToolItem=t,(function(e){let i=0;function r(s){return s?x1(s):(i+=1,`CustomTool${i}`)}function o(s){const a=_1(r(s.name),this);return a.config(s),a}e.define=o})(t=n.ToolItem||(n.ToolItem={})),(function(e){e.toStringTag=`X6.${e.name}`;function i(r){if(r==null)return!1;if(r instanceof e)return!0;const o=r[Symbol.toStringTag],s=r;return(o==null||o===e.toStringTag)&&s.graph!=null&&s.cell!=null&&typeof s.config=="function"&&typeof s.update=="function"&&typeof s.focus=="function"&&typeof s.blur=="function"&&typeof s.show=="function"&&typeof s.hide=="function"&&typeof s.isVisible=="function"}e.isToolItem=i})(t=n.ToolItem||(n.ToolItem={}))})(Wi||(Wi={}));const XW=n=>n;function zS(n,t){return t===0?"0%":`${Math.round(n/t*100)}%`}function nL(n){return(e,i,r,o)=>i.isEdgeElement(r)?qW(n,e,i,r,o):YW(n,e,i,r,o)}function YW(n,t,e,i,r){const o=e.cell,s=o.getAngle(),a=e.getUnrotatedBBoxOfElement(i),l=o.getBBox().getCenter(),h=Y.create(r).rotate(s,l);let u=h.x-a.x,d=h.y-a.y;return n&&(u=zS(u,a.width),d=zS(d,a.height)),t.anchor={name:"topLeft",args:{dx:u,dy:d,rotate:!0}},t}function qW(n,t,e,i,r){const o=e.getConnection();if(!o)return t;const s=o.closestPointLength(r);if(n){const a=o.length();t.anchor={name:"ratio",args:{ratio:s/a}}}else t.anchor={name:"length",args:{length:s}};return t}const KW=nL(!0),ZW=nL(!1),JW=Object.freeze(Object.defineProperty({__proto__:null,noop:XW,pinAbsolute:ZW,pinRelative:KW},Symbol.toStringTag,{value:"Module"}));var r_;(function(n){n.presets=JW,n.registry=Oi.create({type:"connection strategy"}),n.registry.register(n.presets,!0)})(r_||(r_={}));function rL(n,t,e,i){return Nt(r_.presets.pinRelative,this.graph,{},t,e,n,this.cell,i,{}).anchor}function oL(n,t){return t?n.cell.getBBox():n.cell.isEdge()?n.getConnection().bbox():n.getUnrotatedBBoxOfElement(n.container)}class ca extends Wi.ToolItem{onRender(){we(this.container,this.prefixClassName("cell-tool-button")),this.update()}update(){return this.updatePosition(),this}updatePosition(){const e=this.cellView.cell.isEdge()?this.getEdgeMatrix():this.getNodeMatrix();Kh(this.container,e,{absolute:!0})}getNodeMatrix(){const t=this.cellView,e=this.options;let{x:i=0,y:r=0}=e;const{offset:o,useCellGeometry:s,rotate:a}=e;let l=oL(t,s);const h=t.cell.getAngle();a||(l=l.bbox(h));let u=0,d=0;typeof o=="number"?(u=o,d=o):typeof o=="object"&&(u=o.x,d=o.y),i=Qr(i,l.width),r=Qr(r,l.height);let c=Ji().translate(l.x+l.width/2,l.y+l.height/2);return a&&(c=c.rotate(h)),c=c.translate(i+u-l.width/2,r+d-l.height/2),c}getEdgeMatrix(){const t=this.cellView,e=this.options,{offset:i=0,distance:r=0,rotate:o}=e;let s,a,l;const h=Qr(r,1);h>=0&&h<=1?s=t.getTangentAtRatio(h):s=t.getTangentAtLength(h),s?(a=s.start,l=s.vector().vectorAngle(new Y(1,0))||0):(a=t.getConnection().start,l=0);let u=Ji().translate(a.x,a.y).rotate(l);return typeof i=="object"?u=u.translate(i.x||0,i.y||0):u=u.translate(0,i),o||(u=u.rotate(-l)),u}onMouseDown(t){if(this.guard(t))return;t.stopPropagation(),t.preventDefault();const e=this.options.onClick;typeof e=="function"&&Nt(e,this.cellView,{e:t,view:this.cellView,cell:this.cellView.cell,btn:this})}}(function(n){n.config({name:"button",useCellGeometry:!0,events:{mousedown:"onMouseDown",touchstart:"onMouseDown"}})})(ca||(ca={}));(function(n){n.Remove=n.define({name:"button-remove",markup:[{tagName:"circle",selector:"button",attrs:{r:7,fill:"#FF1D00",cursor:"pointer"}},{tagName:"path",selector:"icon",attrs:{d:"M -3 -3 3 3 M -3 3 3 -3",fill:"none",stroke:"#FFFFFF","stroke-width":2,"pointer-events":"none"}}],distance:60,offset:0,useCellGeometry:!0,onClick({view:t,btn:e}){e.parent.remove(),t.cell.remove({ui:!0,toolId:e.cid})}})})(ca||(ca={}));var QW=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};class up extends Wi.ToolItem{onRender(){if(we(this.container,this.prefixClassName("cell-tool-boundary")),this.options.attrs){const t=this.options.attrs,{class:e}=t,i=QW(t,["class"]);je(this.container,nc(i)),e&&we(this.container,e)}this.update()}update(){const t=this.cellView,e=this.options,{useCellGeometry:i,rotate:r}=e,o=Rl(e.padding);let s=oL(t,i).moveAndExpand({x:-o.left,y:-o.top,width:o.left+o.right,height:o.top+o.bottom});const a=t.cell;if(a.isNode()){const l=a.getAngle();if(l)if(r){const h=a.getBBox().getCenter();JC(this.container,l,h.x,h.y,{absolute:!0})}else s=s.bbox(l)}return je(this.container,s.toJSON()),this}}(function(n){n.config({name:"boundary",tagName:"rect",padding:10,useCellGeometry:!0,attrs:{fill:"none",stroke:"#333","stroke-width":.5,"stroke-dasharray":"5, 5","pointer-events":"none"}})})(up||(up={}));class lc extends Wi.ToolItem{constructor(){super(...arguments),this.handles=[]}get vertices(){return this.cellView.cell.getVertices()}onRender(){return this.addClass(this.prefixClassName("edge-tool-vertices")),this.options.addable&&this.updatePath(),this.resetHandles(),this.renderHandles(),this}update(){return this.vertices.length===this.handles.length?this.updateHandles():(this.resetHandles(),this.renderHandles()),this.options.addable&&this.updatePath(),this}resetHandles(){const t=this.handles;this.handles=[],t&&t.forEach(e=>{this.stopHandleListening(e),e.remove()})}renderHandles(){const t=this.vertices;for(let e=0,i=t.length;e<i;e+=1){const r=t[e],o=this.options.createHandle,s=this.options.processHandle,a=o({index:e,graph:this.graph,guard:l=>this.guard(l),attrs:this.options.attrs||{}});s&&s(a),a.updatePosition(r.x,r.y),this.stamp(a.container),this.container.appendChild(a.container),this.handles.push(a),this.startHandleListening(a)}}updateHandles(){const t=this.vertices;for(let e=0,i=t.length;e<i;e+=1){const r=t[e],o=this.handles[e];o&&o.updatePosition(r.x,r.y)}}updatePath(){const t=this.childNodes.connection;t&&t.setAttribute("d",this.cellView.getConnectionPathData())}startHandleListening(t){const e=this.cellView;e.can("vertexMovable")&&(t.on("change",this.onHandleChange,this),t.on("changing",this.onHandleChanging,this),t.on("changed",this.onHandleChanged,this)),e.can("vertexDeletable")&&t.on("remove",this.onHandleRemove,this)}stopHandleListening(t){const e=this.cellView;e.can("vertexMovable")&&(t.off("change",this.onHandleChange,this),t.off("changing",this.onHandleChanging,this),t.off("changed",this.onHandleChanged,this)),e.can("vertexDeletable")&&t.off("remove",this.onHandleRemove,this)}getNeighborPoints(t){const e=this.cellView,i=this.vertices,r=t>0?i[t-1]:e.sourceAnchor,o=t<i.length-1?i[t+1]:e.targetAnchor;return{prev:Y.create(r),next:Y.create(o)}}getMouseEventArgs(t){const e=this.normalizeEvent(t),{x:i,y:r}=this.graph.snapToGrid(e.clientX,e.clientY);return{e,x:i,y:r}}onHandleChange({e:t}){this.focus();const e=this.cellView;if(e.cell.startBatch("move-vertex",{ui:!0,toolId:this.cid}),!this.options.stopPropagation){const{e:i,x:r,y:o}=this.getMouseEventArgs(t);this.eventData(i,{start:{x:r,y:o}}),e.notifyMouseDown(i,r,o)}}onHandleChanging({handle:t,e}){const i=this.cellView,r=t.options.index,{e:o,x:s,y:a}=this.getMouseEventArgs(e),l={x:s,y:a};this.snapVertex(l,r),i.cell.setVertexAt(r,l,{ui:!0,toolId:this.cid}),t.updatePosition(l.x,l.y),this.options.stopPropagation||i.notifyMouseMove(o,s,a)}stopBatch(t){this.cell.stopBatch("move-vertex",{ui:!0,toolId:this.cid}),t&&this.cell.stopBatch("add-vertex",{ui:!0,toolId:this.cid})}onHandleChanged({e:t}){const e=this.options,i=this.cellView;if(e.addable&&this.updatePath(),!e.removeRedundancies){this.stopBatch(this.eventData(t).vertexAdded);return}i.removeRedundantLinearVertices({ui:!0,toolId:this.cid})&&this.render(),this.blur(),this.stopBatch(this.eventData(t).vertexAdded);const{e:o,x:s,y:a}=this.getMouseEventArgs(t);if(!this.options.stopPropagation){i.notifyMouseUp(o,s,a);const{start:l}=this.eventData(o);if(l){const{x:h,y:u}=l;h===s&&u===a&&i.onClick(o,s,a)}}i.checkMouseleave(o),e.onChanged&&e.onChanged({edge:i.cell,edgeView:i})}snapVertex(t,e){const i=this.options.snapRadius||0;if(i>0){const r=this.getNeighborPoints(e),o=r.prev,s=r.next;Math.abs(t.x-o.x)<i?t.x=o.x:Math.abs(t.x-s.x)<i&&(t.x=s.x),Math.abs(t.y-o.y)<i?t.y=r.prev.y:Math.abs(t.y-s.y)<i&&(t.y=s.y)}}onHandleRemove({handle:t,e}){if(this.options.removable){const i=t.options.index,r=this.cellView;r.cell.removeVertexAt(i,{ui:!0}),this.options.addable&&this.updatePath(),r.checkMouseleave(this.normalizeEvent(e))}}allowAddVertex(t){const e=this.guard(t),i=this.options.addable&&this.cellView.can("vertexAddable"),r=this.options.modifiers?Zh.isMatch(t,this.options.modifiers):!0;return!e&&i&&r}onPathMouseDown(t){const e=this.cellView;if(!this.allowAddVertex(t))return;t.stopPropagation(),t.preventDefault();const i=this.normalizeEvent(t),r=this.graph.snapToGrid(i.clientX,i.clientY).toJSON();e.cell.startBatch("add-vertex",{ui:!0,toolId:this.cid});const o=e.getVertexIndex(r.x,r.y);this.snapVertex(r,o),e.cell.insertVertex(r,o,{ui:!0,toolId:this.cid}),this.render();const s=this.handles[o];this.eventData(i,{vertexAdded:!0}),s.onMouseDown(i)}onRemove(){this.resetHandles()}}(function(n){class t extends Ze{get graph(){return this.options.graph}constructor(i){super(),this.options=i,this.render(),this.delegateEvents({mousedown:"onMouseDown",touchstart:"onMouseDown",dblclick:"onDoubleClick"})}render(){this.container=Ze.createElement("circle",!0);const i=this.options.attrs;if(typeof i=="function"){const r=n.getDefaults();this.setAttrs(Object.assign(Object.assign({},r.attrs),i(this)))}else this.setAttrs(i);this.addClass(this.prefixClassName("edge-tool-vertex"))}updatePosition(i,r){this.setAttrs({cx:i,cy:r})}onMouseDown(i){this.options.guard(i)||(i.stopPropagation(),i.preventDefault(),this.graph.view.undelegateEvents(),this.delegateDocumentEvents({mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"},i.data),this.emit("change",{e:i,handle:this}))}onMouseMove(i){this.emit("changing",{e:i,handle:this})}onMouseUp(i){this.emit("changed",{e:i,handle:this}),this.undelegateDocumentEvents(),this.graph.view.delegateEvents()}onDoubleClick(i){this.emit("remove",{e:i,handle:this})}}n.Handle=t})(lc||(lc={}));(function(n){const t=ro.prefix("edge-tool-vertex-path");n.config({name:"vertices",snapRadius:20,addable:!0,removable:!0,removeRedundancies:!0,stopPropagation:!0,attrs:{r:6,fill:"#333",stroke:"#fff",cursor:"move","stroke-width":2},createHandle:e=>new n.Handle(e),markup:[{tagName:"path",selector:"connection",className:t,attrs:{fill:"none",stroke:"transparent","stroke-width":10,cursor:"pointer"}}],events:{[`mousedown .${t}`]:"onPathMouseDown",[`touchstart .${t}`]:"onPathMouseDown"}})})(lc||(lc={}));class hc extends Wi.ToolItem{constructor(){super(...arguments),this.handles=[]}get vertices(){return this.cellView.cell.getVertices()}update(){return this.render(),this}onRender(){we(this.container,this.prefixClassName("edge-tool-segments")),this.resetHandles();const t=this.cellView,e=[...this.vertices];e.unshift(t.sourcePoint),e.push(t.targetPoint);for(let i=0,r=e.length;i<r-1;i+=1){const o=e[i],s=e[i+1],a=this.renderHandle(o,s,i);this.stamp(a.container),this.handles.push(a)}return this}renderHandle(t,e,i){const r=this.options.createHandle({index:i,graph:this.graph,guard:o=>this.guard(o),attrs:this.options.attrs||{}});return this.options.processHandle&&this.options.processHandle(r),this.updateHandle(r,t,e),this.container.appendChild(r.container),this.startHandleListening(r),r}startHandleListening(t){t.on("change",this.onHandleChange,this),t.on("changing",this.onHandleChanging,this),t.on("changed",this.onHandleChanged,this)}stopHandleListening(t){t.off("change",this.onHandleChange,this),t.off("changing",this.onHandleChanging,this),t.off("changed",this.onHandleChanged,this)}resetHandles(){const t=this.handles;this.handles=[],t&&t.forEach(e=>{this.stopHandleListening(e),e.remove()})}shiftHandleIndexes(t){const e=this.handles;for(let i=0,r=e.length;i<r;i+=1)e[i].options.index+=t}resetAnchor(t,e){const i=this.cellView.cell,r={ui:!0,toolId:this.cid};e?i.prop([t,"anchor"],e,r):i.removeProp([t,"anchor"],r)}snapHandle(t,e,i){const r=t.options.axis,o=t.options.index,l=this.cellView.cell.getVertices(),h=l[o-2]||i.sourceAnchor,u=l[o+1]||i.targetAnchor,d=this.options.snapRadius;return Math.abs(e[r]-h[r])<d?e[r]=h[r]:Math.abs(e[r]-u[r])<d&&(e[r]=u[r]),e}onHandleChanging({handle:t,e}){const i=this.graph,r=this.options,o=this.cellView,s=r.anchor,a=t.options.axis,l=t.options.index-1,h=this.getEventData(e),u=this.normalizeEvent(e),d=i.snapToGrid(u.clientX,u.clientY),c=this.snapHandle(t,d.clone(),h),g=gi(this.vertices);let f=g[l],p=g[l+1];const m=o.sourceView,v=o.sourceBBox;let b=!1,y=!1;if(f?l===0?v.containsPoint(f)?(g.shift(),this.shiftHandleIndexes(-1),b=!0):(f[a]=c[a],y=!0):f[a]=c[a]:(f=o.sourceAnchor.toJSON(),f[a]=c[a],v.containsPoint(f)?b=!0:(g.unshift(f),this.shiftHandleIndexes(1),y=!0)),typeof s=="function"&&m){if(b){const x=h.sourceAnchor.clone();x[a]=c[a];const S=Nt(s,o,x,m,o.sourceMagnet||m.container,"source",o,this);this.resetAnchor("source",S)}y&&this.resetAnchor("source",h.sourceAnchorDef)}const C=o.targetView,w=o.targetBBox;let _=!1,A=!1;if(p?l===g.length-2?w.containsPoint(p)?(g.pop(),_=!0):(p[a]=c[a],A=!0):p[a]=c[a]:(p=o.targetAnchor.toJSON(),p[a]=c[a],w.containsPoint(p)?_=!0:(g.push(p),A=!0)),typeof s=="function"&&C){if(_){const x=h.targetAnchor.clone();x[a]=c[a];const S=Nt(s,o,x,C,o.targetMagnet||C.container,"target",o,this);this.resetAnchor("target",S)}A&&this.resetAnchor("target",h.targetAnchorDef)}Y.equalPoints(g,this.vertices)||this.cellView.cell.setVertices(g,{ui:!0,toolId:this.cid}),this.updateHandle(t,f,p,0),r.stopPropagation||o.notifyMouseMove(u,d.x,d.y)}onHandleChange({handle:t,e}){const i=this.options,r=this.handles,o=this.cellView,s=t.options.index;if(Array.isArray(r)){for(let a=0,l=r.length;a<l;a+=1)a!==s&&r[a].hide();if(this.focus(),this.setEventData(e,{sourceAnchor:o.sourceAnchor.clone(),targetAnchor:o.targetAnchor.clone(),sourceAnchorDef:gi(this.cell.prop(["source","anchor"])),targetAnchorDef:gi(this.cell.prop(["target","anchor"]))}),this.cell.startBatch("move-segment",{ui:!0,toolId:this.cid}),!i.stopPropagation){const a=this.normalizeEvent(e),l=this.graph.snapToGrid(a.clientX,a.clientY);o.notifyMouseDown(a,l.x,l.y)}}}onHandleChanged({e:t}){const e=this.options,i=this.cellView;e.removeRedundancies&&i.removeRedundantLinearVertices({ui:!0,toolId:this.cid});const r=this.normalizeEvent(t),o=this.graph.snapToGrid(r.clientX,r.clientY);this.render(),this.blur(),this.cell.stopBatch("move-segment",{ui:!0,toolId:this.cid}),e.stopPropagation||i.notifyMouseUp(r,o.x,o.y),i.checkMouseleave(r),e.onChanged&&e.onChanged({edge:i.cell,edgeView:i})}updateHandle(t,e,i,r=0){const o=this.options.precision||0,s=Math.abs(e.x-i.x)<o,a=Math.abs(e.y-i.y)<o;if(s||a){const l=new kt(e,i);if(l.length()<this.options.threshold)t.hide();else{const u=l.getCenter(),d=s?"x":"y";u[d]+=r||0;const c=l.vector().vectorAngle(new Y(1,0));t.updatePosition(u.x,u.y,c,this.cellView),t.show(),t.options.axis=d}}else t.hide()}onRemove(){this.resetHandles()}}(function(n){class t extends Ze{constructor(i){super(),this.options=i,this.render(),this.delegateEvents({mousedown:"onMouseDown",touchstart:"onMouseDown"})}render(){this.container=Ze.createElement("rect",!0);const i=this.options.attrs;if(typeof i=="function"){const r=n.getDefaults();this.setAttrs(Object.assign(Object.assign({},r.attrs),i(this)))}else this.setAttrs(i);this.addClass(this.prefixClassName("edge-tool-segment"))}updatePosition(i,r,o,s){const a=s.getClosestPoint(new Y(i,r))||new Y(i,r);let l=Ji().translate(a.x,a.y);if(a.equals({x:i,y:r}))l=l.rotate(o);else{let u=new kt(i,r,a.x,a.y).vector().vectorAngle(new Y(1,0));u!==0&&(u+=90),l=l.rotate(u)}this.setAttrs({transform:Pu(l),cursor:o%180===0?"row-resize":"col-resize"})}onMouseDown(i){this.options.guard(i)||(this.trigger("change",{e:i,handle:this}),i.stopPropagation(),i.preventDefault(),this.options.graph.view.undelegateEvents(),this.delegateDocumentEvents({mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"},i.data))}onMouseMove(i){this.emit("changing",{e:i,handle:this})}onMouseUp(i){this.emit("changed",{e:i,handle:this}),this.undelegateDocumentEvents(),this.options.graph.view.delegateEvents()}show(){this.container.style.display=""}hide(){this.container.style.display="none"}}n.Handle=t})(hc||(hc={}));(function(n){n.config({name:"segments",precision:.5,threshold:40,snapRadius:10,stopPropagation:!0,removeRedundancies:!0,attrs:{width:20,height:8,x:-10,y:-4,rx:4,ry:4,fill:"#333",stroke:"#fff","stroke-width":2},createHandle:t=>new n.Handle(t),anchor:rL})})(hc||(hc={}));class dp extends Wi.ToolItem{get type(){return this.options.type}onRender(){we(this.container,this.prefixClassName(`edge-tool-${this.type}-anchor`)),this.toggleArea(!1),this.update()}update(){const t=this.type;return this.cellView.getTerminalView(t)?(this.updateAnchor(),this.updateArea(),this.container.style.display=""):this.container.style.display="none",this}updateAnchor(){const t=this.childNodes;if(!t)return;const e=t.anchor;if(!e)return;const i=this.type,r=this.cellView,o=this.options,s=r.getTerminalAnchor(i),a=r.cell.prop([i,"anchor"]);e.setAttribute("transform",`translate(${s.x}, ${s.y})`);const l=a?o.customAnchorAttrs:o.defaultAnchorAttrs;l&&Object.keys(l).forEach(h=>{e.setAttribute(h,l[h])})}updateArea(){const t=this.childNodes;if(!t)return;const e=t.area;if(!e)return;const i=this.type,r=this.cellView,o=r.getTerminalView(i);if(o){const s=o.cell,a=r.getTerminalMagnet(i);let l=this.options.areaPadding||0;Number.isFinite(l)||(l=0);let h,u,d;o.isEdgeElement(a)?(h=o.getBBox(),u=0,d=h.getCenter()):(h=o.getUnrotatedBBoxOfElement(a),u=s.getAngle(),d=h.getCenter(),u&&d.rotate(-u,s.getBBox().getCenter())),h.inflate(l),je(e,{x:-h.width/2,y:-h.height/2,width:h.width,height:h.height,transform:`translate(${d.x}, ${d.y}) rotate(${u})`})}}toggleArea(t){if(this.childNodes){const e=this.childNodes.area;e&&(e.style.display=t?"":"none")}}onMouseDown(t){this.guard(t)||(t.stopPropagation(),t.preventDefault(),this.graph.view.undelegateEvents(),this.options.documentEvents&&this.delegateDocumentEvents(this.options.documentEvents),this.focus(),this.toggleArea(this.options.restrictArea),this.cell.startBatch("move-anchor",{ui:!0,toolId:this.cid}))}resetAnchor(t){const e=this.type,i=this.cell;t?i.prop([e,"anchor"],t,{rewrite:!0,ui:!0,toolId:this.cid}):i.removeProp([e,"anchor"],{ui:!0,toolId:this.cid})}onMouseMove(t){const e=this.type,i=this.cellView,r=i.getTerminalView(e);if(r==null)return;const o=this.normalizeEvent(t),s=r.cell,a=i.getTerminalMagnet(e);let l=this.graph.coord.clientToLocalPoint(o.clientX,o.clientY);const h=this.options.snap;if(typeof h=="function"){const c=Nt(h,i,l,r,a,e,i,this);l=Y.create(c)}if(this.options.restrictArea)if(r.isEdgeElement(a)){const c=r.getClosestPoint(l);c&&(l=c)}else{const c=r.getUnrotatedBBoxOfElement(a),g=s.getAngle(),f=s.getBBox().getCenter(),p=l.clone().rotate(g,f);c.containsPoint(p)||(l=c.getNearestPointToPoint(p).rotate(-g,f))}let u;const d=this.options.anchor;typeof d=="function"&&(u=Nt(d,i,l,r,a,e,i,this)),this.resetAnchor(u),this.update()}onMouseUp(t){this.graph.view.delegateEvents(),this.undelegateDocumentEvents(),this.blur(),this.toggleArea(!1);const e=this.cellView;this.options.removeRedundancies&&e.removeRedundantLinearVertices({ui:!0,toolId:this.cid}),this.cell.stopBatch("move-anchor",{ui:!0,toolId:this.cid})}onDblClick(){const t=this.options.resetAnchor;t&&this.resetAnchor(t===!0?void 0:t),this.update()}}(function(n){n.config({tagName:"g",markup:[{tagName:"circle",selector:"anchor",attrs:{cursor:"pointer"}},{tagName:"rect",selector:"area",attrs:{"pointer-events":"none",fill:"none",stroke:"#33334F","stroke-dasharray":"2,4",rx:5,ry:5}}],events:{mousedown:"onMouseDown",touchstart:"onMouseDown",dblclick:"onDblClick"},documentEvents:{mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"},customAnchorAttrs:{"stroke-width":4,stroke:"#33334F",fill:"#FFFFFF",r:5},defaultAnchorAttrs:{"stroke-width":2,stroke:"#FFFFFF",fill:"#33334F",r:6},areaPadding:6,snapRadius:10,resetAnchor:!0,restrictArea:!0,removeRedundancies:!0,anchor:rL,snap(t,e,i,r,o,s){const a=s.options.snapRadius||0,l=r==="source",h=l?0:-1,u=this.cell.getVertexAt(h)||this.getTerminalAnchor(l?"target":"source");return u&&(Math.abs(u.x-t.x)<a&&(t.x=u.x),Math.abs(u.y-t.y)<a&&(t.y=u.y)),t}})})(dp||(dp={}));const t5=dp.define({name:"source-anchor",type:"source"}),e5=dp.define({name:"target-anchor",type:"target"});var i5=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};class cp extends Wi.ToolItem{get type(){return this.options.type}get ratio(){return this.options.ratio}init(){if(this.options.attrs){const t=this.options.attrs,{class:e}=t,i=i5(t,["class"]);this.setAttrs(i,this.container),e&&we(this.container,e)}}onRender(){we(this.container,this.prefixClassName(`edge-tool-${this.type}-arrowhead`)),this.update()}update(){const t=this.ratio,e=this.cellView,i=e.getTangentAtRatio(t),r=i?i.start:e.getPointAtRatio(t),o=i&&i.vector().vectorAngle(new Y(1,0))||0;if(!r)return this;const s=Ji().translate(r.x,r.y).rotate(o);return Kh(this.container,s,{absolute:!0}),this}onMouseDown(t){if(this.guard(t))return;t.stopPropagation(),t.preventDefault();const e=this.cellView;if(e.can("arrowheadMovable")){e.cell.startBatch("move-arrowhead",{ui:!0,toolId:this.cid});const i=this.graph.snapToGrid(t.clientX,t.clientY),r=e.prepareArrowheadDragging(this.type,{x:i.x,y:i.y,options:Object.assign(Object.assign({},this.options),{toolId:this.cid})});this.cellView.setEventData(t,r),this.delegateDocumentEvents(this.options.documentEvents,t.data),e.graph.view.undelegateEvents(),this.container.style.pointerEvents="none"}this.focus()}onMouseMove(t){const e=this.normalizeEvent(t),i=this.graph.snapToGrid(e.clientX,e.clientY);this.cellView.onMouseMove(e,i.x,i.y),this.update()}onMouseUp(t){this.undelegateDocumentEvents();const e=this.normalizeEvent(t),i=this.cellView,r=this.graph.snapToGrid(e.clientX,e.clientY);i.onMouseUp(e,r.x,r.y),this.graph.view.delegateEvents(),this.blur(),this.container.style.pointerEvents="",i.cell.stopBatch("move-arrowhead",{ui:!0,toolId:this.cid})}}(function(n){n.config({tagName:"path",isSVGElement:!0,events:{mousedown:"onMouseDown",touchstart:"onMouseDown"},documentEvents:{mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"}})})(cp||(cp={}));const n5=cp.define({name:"source-arrowhead",type:"source",ratio:0,attrs:{d:"M 10 -8 -10 0 10 8 Z",fill:"#333",stroke:"#fff","stroke-width":2,cursor:"move"}}),r5=cp.define({name:"target-arrowhead",type:"target",ratio:1,attrs:{d:"M -10 -8 10 0 -10 8 Z",fill:"#333",stroke:"#fff","stroke-width":2,cursor:"move"}});class iu extends Wi.ToolItem{constructor(){super(...arguments),this.labelIndex=-1,this.distance=.5,this.dblClick=this.onCellDblClick.bind(this)}onRender(){const t=this.cellView;t&&t.on("cell:dblclick",this.dblClick)}createElement(){const t=[this.prefixClassName(`${this.cell.isEdge()?"edge":"node"}-tool-editor`),this.prefixClassName("cell-tool-editor")];this.editor=Wi.createElement("div",!1),this.addClass(t,this.editor),this.editor.contentEditable="true",this.container.appendChild(this.editor)}removeElement(){this.undelegateDocumentEvents(),this.editor&&(this.container.removeChild(this.editor),this.editor=null)}updateEditor(){const{cell:t,editor:e}=this;if(!e)return;const{style:i}=e;t.isNode()?this.updateNodeEditorTransform():t.isEdge()&&this.updateEdgeEditorTransform();const{attrs:r}=this.options;i.fontSize=`${r.fontSize}px`,i.fontFamily=r.fontFamily,i.color=r.color,i.backgroundColor=r.backgroundColor;const o=this.getCellText()||"";return e.innerText=o,this.setCellText(""),this}updateNodeEditorTransform(){const{graph:t,cell:e,editor:i}=this;if(!i)return;let r=Y.create(),o=20,s="",{x:a,y:l}=this.options;const{width:h,height:u}=this.options;if(typeof a<"u"&&typeof l<"u"){const g=e.getBBox();a=Qr(a,g.width),l=Qr(l,g.height),r=g.topLeft.translate(a,l),o=g.width-a*2}else{const g=e.getBBox();r=g.center,o=g.width-4,s="translate(-50%, -50%)"}const d=t.scale(),{style:c}=i;r=t.localToGraph(r),c.left=`${r.x}px`,c.top=`${r.y}px`,c.transform=`scale(${d.sx}, ${d.sy}) ${s}`,c.minWidth=`${o}px`,typeof h=="number"&&(c.width=`${h}px`),typeof u=="number"&&(c.height=`${u}px`)}updateEdgeEditorTransform(){if(!this.event)return;const{graph:t,editor:e}=this;if(!e)return;let i=Y.create(),r=20;const{style:o}=e,s=this.event.target,a=s.parentElement;if(a&&Kc(a,this.prefixClassName("edge-label"))){const u=a.getAttribute("data-index")||"0";this.labelIndex=parseInt(u,10);const d=a.getAttribute("transform"),{translation:c}=Dm(d);i=new Y(c.tx,c.ty),r=Le.getBBox(s).width}else{if(!this.options.labelAddable)return this;i=t.clientToLocal(Y.create(this.event.clientX,this.event.clientY));const d=this.cellView.path.closestPointLength(i);this.distance=d,this.labelIndex=-1}i=t.localToGraph(i);const h=t.scale();o.left=`${i.x}px`,o.top=`${i.y}px`,o.minWidth=`${r}px`,o.transform=`scale(${h.sx}, ${h.sy}) translate(-50%, -50%)`}onDocumentMouseUp(t){if(this.editor&&t.target!==this.editor){const e=this.editor.innerText.replace(/\n$/,"")||"";this.setCellText(e!==""?e:null),this.removeElement()}}onCellDblClick({e:t}){this.editor||(t.stopPropagation(),this.removeElement(),this.event=t,this.createElement(),this.updateEditor(),this.autoFocus(),this.delegateDocumentEvents(this.options.documentEvents))}onMouseDown(t){t.stopPropagation()}autoFocus(){setTimeout(()=>{this.editor&&(this.editor.focus(),this.selectText())})}selectText(){if(window.getSelection&&this.editor){const t=document.createRange(),e=window.getSelection();t.selectNodeContents(this.editor),e.removeAllRanges(),e.addRange(t)}}getCellText(){const{getText:t}=this.options;if(typeof t=="function")return Nt(t,this.cellView,{cell:this.cell,index:this.labelIndex});if(typeof t=="string"){if(this.cell.isNode())return this.cell.attr(t);if(this.cell.isEdge()&&this.labelIndex!==-1)return this.cell.prop(`labels/${this.labelIndex}/attrs/${t}`)}}setCellText(t){const e=this.options.setText;if(typeof e=="function"){Nt(e,this.cellView,{cell:this.cell,value:t,index:this.labelIndex,distance:this.distance});return}if(typeof e=="string"){if(this.cell.isNode()){t!==null&&this.cell.attr(e,t);return}if(this.cell.isEdge()){const i=this.cell;if(this.labelIndex===-1){if(t){const r={position:{distance:this.distance},attrs:{}};ku(r,`attrs/${e}`,t),i.appendLabel(r)}}else t!==null?i.prop(`labels/${this.labelIndex}/attrs/${e}`,t):typeof this.labelIndex=="number"&&i.removeLabelAt(this.labelIndex)}}}onRemove(){const t=this.cellView;t&&t.off("cell:dblclick",this.dblClick),this.removeElement()}}(function(n){n.config({tagName:"div",isSVGElement:!1,events:{mousedown:"onMouseDown",touchstart:"onMouseDown"},documentEvents:{mouseup:"onDocumentMouseUp",touchend:"onDocumentMouseUp",touchcancel:"onDocumentMouseUp"}})})(iu||(iu={}));(function(n){n.NodeEditor=n.define({attrs:{fontSize:14,fontFamily:"Arial, helvetica, sans-serif",color:"#000",backgroundColor:"#fff"},getText:"text/text",setText:"text/text"}),n.EdgeEditor=n.define({attrs:{fontSize:14,fontFamily:"Arial, helvetica, sans-serif",color:"#000",backgroundColor:"#fff"},labelAddable:!0,getText:"label/text",setText:"label/text"})})(iu||(iu={}));var sL=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e},nu;(function(n){n.presets={boundary:up,button:ca,"button-remove":ca.Remove,"node-editor":iu.NodeEditor},n.registry=Oi.create({type:"node tool",process(t,e){if(typeof e=="function")return e;let i=Wi.ToolItem;const{inherit:r}=e,o=sL(e,["inherit"]);if(r){const s=this.get(r);s==null?this.onNotFound(r,"inherited"):i=s}return o.name==null&&(o.name=t),i.define.call(i,o)}}),n.registry.register(n.presets,!0)})(nu||(nu={}));var ru;(function(n){n.presets={boundary:up,vertices:lc,segments:hc,button:ca,"button-remove":ca.Remove,"source-anchor":t5,"target-anchor":e5,"source-arrowhead":n5,"target-arrowhead":r5,"edge-editor":iu.EdgeEditor},n.registry=Oi.create({type:"edge tool",process(t,e){if(typeof e=="function")return e;let i=Wi.ToolItem;const{inherit:r}=e,o=sL(e,["inherit"]);if(r){const s=this.get(r);s==null?this.onNotFound(r,"inherited"):i=s}return o.name==null&&(o.name=t),i.define.call(i,o)}}),n.registry.register(n.presets,!0)})(ru||(ru={}));const o5=Ls("center"),s5=Ls("topCenter"),a5=Ls("bottomCenter"),l5=Ls("leftMiddle"),h5=Ls("rightMiddle"),u5=Ls("topLeft"),d5=Ls("topRight"),c5=Ls("bottomLeft"),g5=Ls("bottomRight");function Ls(n){return function(t,e,i,r={}){const o=r.rotate?t.getUnrotatedBBoxOfElement(e):t.getBBoxOfElement(e),s=o[n];s.x+=Qr(r.dx,o.width),s.y+=Qr(r.dy,o.height);const a=t.cell;return r.rotate?s.rotate(-a.getAngle(),a.getBBox().getCenter()):s}}function Wm(n){return function(t,e,i,r){if(i instanceof Element){const o=this.graph.findViewByElem(i);let s;if(o)if(o.isEdgeElement(i)){const a=r.fixedAt!=null?r.fixedAt:"50%";s=aL(o,a)}else s=o.getBBoxOfElement(i).getCenter();else s=new Y;return n.call(this,t,e,s,r)}return n.apply(this,arguments)}}function aL(n,t){const e=Ms(t),i=typeof t=="string"?parseFloat(t):t;return e?n.getPointAtRatio(i/100):n.getPointAtLength(i)}const f5=function(n,t,e,i){const r=We.normalize(n.cell.getAngle()),o=n.getBBoxOfElement(t),s=o.getCenter(),a=o.getTopLeft(),l=o.getBottomRight();let h=i.padding;if(Number.isFinite(h)||(h=0),a.y+h<=e.y&&e.y<=l.y-h){const u=e.y-s.y;s.x+=r===0||r===180?0:u*1/Math.tan(We.toRad(r)),s.y+=u}else if(a.x+h<=e.x&&e.x<=l.x-h){const u=e.x-s.x;s.y+=r===90||r===270?0:u*Math.tan(We.toRad(r)),s.x+=u}return s},p5=Wm(f5),m5=function(n,t,e,i,r){const o=n.cell.getConnectionPoint(this.cell,r);return(i.dx||i.dy)&&o.translate(i.dx||0,i.dy||0),o},v5=function(n,t,e,i){let r,o=0,s;const a=n.cell;i.rotate?(r=n.getUnrotatedBBoxOfElement(t),s=a.getBBox().getCenter(),o=a.getAngle()):r=n.getBBoxOfElement(t);const l=i.padding;l!=null&&Number.isFinite(l)&&r.inflate(l),i.rotate&&e.rotate(o,s);const h=r.getNearestSideToPoint(e);let u;switch(h){case"left":u=r.getLeftMiddle();break;case"right":u=r.getRightMiddle();break;case"top":u=r.getTopCenter();break;case"bottom":u=r.getBottomCenter();break}const d=i.direction;return d==="H"?(h==="top"||h==="bottom")&&(e.x<=r.x+r.width?u=r.getLeftMiddle():u=r.getRightMiddle()):d==="V"&&(e.y<=r.y+r.height?u=r.getTopCenter():u=r.getBottomCenter()),i.rotate?u.rotate(-o,s):u},b5=Wm(v5),y5=Object.freeze(Object.defineProperty({__proto__:null,bottom:a5,bottomLeft:c5,bottomRight:g5,center:o5,left:l5,midSide:b5,nodeCenter:m5,orth:p5,right:h5,top:s5,topLeft:u5,topRight:d5},Symbol.toStringTag,{value:"Module"}));var ou;(function(n){n.presets=y5,n.registry=Oi.create({type:"node endpoint"}),n.registry.register(n.presets,!0)})(ou||(ou={}));const C5=function(n,t,e,i){let r=i.ratio!=null?i.ratio:.5;return r>1&&(r/=100),n.getPointAtRatio(r)},_5=function(n,t,e,i){const r=i.length!=null?i.length:20;return n.getPointAtLength(r)},lL=function(n,t,e,i){const r=n.getClosestPoint(e);return r??new Y},w5=Wm(lL),x5=function(n,t,e,i){const o=n.getConnection(),s=n.getConnectionSubdivisions(),a=new kt(e.clone().translate(0,1e6),e.clone().translate(0,-1e6)),l=new kt(e.clone().translate(1e6,0),e.clone().translate(-1e6,0)),h=a.intersect(o,{segmentSubdivisions:s}),u=l.intersect(o,{segmentSubdivisions:s}),d=[];return h&&d.push(...h),u&&d.push(...u),d.length>0?e.closest(d):i.fallbackAt!=null?aL(n,i.fallbackAt):Nt(lL,this,n,t,e,i)},S5=Wm(x5),A5=Object.freeze(Object.defineProperty({__proto__:null,closest:w5,length:_5,orth:S5,ratio:C5},Symbol.toStringTag,{value:"Module"}));var su;(function(n){n.presets=A5,n.registry=Oi.create({type:"edge endpoint"}),n.registry.register(n.presets,!0)})(su||(su={}));function jm(n,t,e){let i;if(typeof e=="object"){if(Number.isFinite(e.y)){const o=new kt(t,n),{start:s,end:a}=o.parallel(e.y);t=s,n=a}i=e.x}else i=e;if(i==null||!Number.isFinite(i))return n;const r=n.distance(t);return i===0&&r>0?n:n.move(t,-Math.min(i,r-1))}function gp(n){const t=n.getAttribute("stroke-width");return t===null?0:parseFloat(t)||0}function M5(n){if(n==null)return null;let t=n;do{let e=t.tagName;if(typeof e!="string")return null;if(e=e.toUpperCase(),e==="G")t=t.firstElementChild;else if(e==="TITLE")t=t.nextElementSibling;else break}while(t);return t}const hL=function(n,t,e,i){const r=t.getBBoxOfElement(e);i.stroked&&r.inflate(gp(e)/2);const o=n.intersect(r),s=o&&o.length?n.start.closest(o):n.end;return jm(s,n.start,i.offset)},T5=function(n,t,e,i,r){const o=t.cell,s=o.isNode()?o.getAngle():0;if(s===0)return Nt(hL,this,n,t,e,i,r);const a=t.getUnrotatedBBoxOfElement(e);i.stroked&&a.inflate(gp(e)/2);const l=a.getCenter(),h=n.clone().rotate(s,l),u=h.setLength(1e6).intersect(a),d=u&&u.length?h.start.closest(u).rotate(-s,l):n.end;return jm(d,n.start,i.offset)},R5=function(n,t,e,i){let r,o;const s=n.end,a=i.selector;if(typeof a=="string"?r=t.findOne(a):Array.isArray(a)?r=w1(e,a):r=M5(e),!ha(r)){if(r===e||!ha(e))return s;r=e}const l=t.getShapeOfElement(r),h=t.getMatrixOfElement(r),u=t.getRootTranslatedMatrix(),d=t.getRootRotatedMatrix(),c=u.multiply(d).multiply(h),g=c.inverse(),f=Le.transformLine(n,g),p=f.start.clone(),m=t.getDataOfElement(r);if(i.insideout===!1){m.shapeBBox==null&&(m.shapeBBox=l.bbox());const C=m.shapeBBox;if(C!=null&&C.containsPoint(p))return s}i.extrapolate===!0&&f.setLength(1e6);let v;if(ie.isPath(l)){const C=i.precision||2;m.segmentSubdivisions==null&&(m.segmentSubdivisions=l.getSegmentSubdivisions({precision:C})),v={precision:C,segmentSubdivisions:m.segmentSubdivisions},o=f.intersect(l,v)}else o=f.intersect(l);o?Array.isArray(o)&&(o=p.closest(o)):i.sticky===!0&&(vt.isRectangle(l)?o=l.getNearestPointToPoint(p):no.isEllipse(l)?o=l.intersectsWithLineFromCenterToPoint(p):o=l.closestPoint(p,v));const b=o?Le.transformPoint(o,c):s;let y=i.offset||0;return i.stroked!==!1&&(typeof y=="object"?(y=Object.assign({},y),y.x==null&&(y.x=0),y.x+=gp(r)/2):y+=gp(r)/2),jm(b,n.start,y)};function B5(n,t,e=0){const{start:i,end:r}=n;let o,s,a,l;switch(t){case"left":l="x",o=r,s=i,a=-1;break;case"right":l="x",o=i,s=r,a=1;break;case"top":l="y",o=r,s=i,a=-1;break;case"bottom":l="y",o=i,s=r,a=1;break;default:return}i[l]<r[l]?o[l]=s[l]:s[l]=o[l],Number.isFinite(e)&&(o[l]+=a*e,s[l]+=a*e)}const k5=function(n,t,e,i){const{alignOffset:r,align:o}=i;return o&&B5(n,o,r),jm(n.end,n.start,i.offset)},P5=Object.freeze(Object.defineProperty({__proto__:null,anchor:k5,bbox:hL,boundary:R5,rect:T5},Symbol.toStringTag,{value:"Module"}));var au;(function(n){n.presets=P5,n.registry=Oi.create({type:"connection point"}),n.registry.register(n.presets,!0)})(au||(au={}));const E5=function(n){return[...n]},L5=function(n,t,e){const i=t.side||"bottom",r=Rl(t.padding||40),o=e.sourceBBox,s=e.targetBBox,a=o.getCenter(),l=s.getCenter();let h,u,d;switch(i){case"top":d=-1,h="y",u="height";break;case"left":d=-1,h="x",u="width";break;case"right":d=1,h="x",u="width";break;case"bottom":default:d=1,h="y",u="height";break}return a[h]+=d*(o[u]/2+r[i]),l[h]+=d*(s[u]/2+r[i]),d*(a[h]-l[h])>0?l[h]=a[h]:a[h]=l[h],[a.toJSON(),...n,l.toJSON()]};function Bg(n){return new vt(n.x,n.y,0,0)}function fp(n={}){const t=Rl(n.padding||20);return{x:-t.left,y:-t.top,width:t.left+t.right,height:t.top+t.bottom}}function uL(n,t={}){return n.sourceBBox.clone().moveAndExpand(fp(t))}function dL(n,t={}){return n.targetBBox.clone().moveAndExpand(fp(t))}function O5(n,t={}){return n.sourceAnchor?n.sourceAnchor:uL(n,t).getCenter()}function I5(n,t={}){return n.targetAnchor?n.targetAnchor:dL(n,t).getCenter()}const cL=function(n,t,e){let i=uL(e,t),r=dL(e,t);const o=O5(e,t),s=I5(e,t);i=i.union(Bg(o)),r=r.union(Bg(s));const a=n.map(u=>Y.create(u));a.unshift(o),a.push(s);let l=null;const h=[];for(let u=0,d=a.length-1;u<d;u+=1){let c=null;const g=a[u],f=a[u+1],p=pr.getBearing(g,f)!=null;if(u===0)u+1===d?i.intersectsWithRect(r.clone().inflate(1))?c=pr.insideNode(g,f,i,r):p||(c=pr.nodeToNode(g,f,i,r)):i.containsPoint(f)?c=pr.insideNode(g,f,i,Bg(f).moveAndExpand(fp(t))):p||(c=pr.nodeToVertex(g,f,i));else if(u+1===d){const m=p&&pr.getBearing(f,g)===l;r.containsPoint(g)||m?c=pr.insideNode(g,f,Bg(g).moveAndExpand(fp(t)),r,l):p||(c=pr.vertexToNode(g,f,r,l))}else p||(c=pr.vertexToVertex(g,f,l));c?(h.push(...c.points),l=c.direction):l=pr.getBearing(g,f),u+1<d&&h.push(f)}return h};var pr;(function(n){const t={N:"S",S:"N",E:"W",W:"E"},e={N:-Math.PI/2*3,S:-Math.PI/2,E:0,W:Math.PI};function i(d,c,g){let f=new Y(d.x,c.y);return g.containsPoint(f)&&(f=new Y(c.x,d.y)),f}function r(d,c){return d[c==="W"||c==="E"?"width":"height"]}n.getBBoxSize=r;function o(d,c){return d.x===c.x?d.y>c.y?"N":"S":d.y===c.y?d.x>c.x?"W":"E":null}n.getBearing=o;function s(d,c,g){const f=new Y(d.x,c.y),p=new Y(c.x,d.y),m=o(d,f),v=o(d,p),b=g?t[g]:null,y=m===g||m!==b&&(v===b||v!==g)?f:p;return{points:[y],direction:o(y,c)}}n.vertexToVertex=s;function a(d,c,g){const f=i(d,c,g);return{points:[f],direction:o(f,c)}}n.nodeToVertex=a;function l(d,c,g,f){const p=[new Y(d.x,c.y),new Y(c.x,d.y)],m=p.filter(y=>!g.containsPoint(y)),v=m.filter(y=>o(y,d)!==f);let b;if(v.length>0)return b=v.filter(y=>o(d,y)===f).pop(),b=b||v[0],{points:[b],direction:o(b,c)};{b=mz(p,m)[0];const y=Y.create(c).move(b,-r(g,f)/2);return{points:[i(y,d,g),y],direction:o(y,c)}}}n.vertexToNode=l;function h(d,c,g,f){let p=a(c,d,f);const m=p.points[0];if(g.containsPoint(m)){p=a(d,c,g);const v=p.points[0];if(f.containsPoint(v)){const b=Y.create(d).move(v,-r(g,o(d,v))/2),y=Y.create(c).move(m,-r(f,o(c,m))/2),C=new kt(b,y).getCenter(),w=a(d,C,g),_=s(C,c,w.direction);p.points=[w.points[0],_.points[0]],p.direction=_.direction}}return p}n.nodeToNode=h;function u(d,c,g,f,p){const m=g.union(f).inflate(1),v=m.getCenter(),b=v.distance(c)>v.distance(d),y=b?c:d,C=b?d:c;let w,_,A;p?(w=Y.fromPolar(m.width+m.height,e[p],y),w=m.getNearestPointToPoint(w).move(w,-1)):w=m.getNearestPointToPoint(y).move(y,1),_=i(w,C,m);let x;w.round().equals(_.round())?(_=Y.fromPolar(m.width+m.height,We.toRad(w.theta(y))+Math.PI/2,C),_=m.getNearestPointToPoint(_).move(C,1).round(),A=i(w,_,m),x=b?[_,A,w]:[w,A,_]):x=b?[_,w]:[w,_];const S=o(b?w:_,c);return{points:x,direction:S}}n.insideNode=u})(pr||(pr={}));const H5={step:10,maxLoopCount:2e3,precision:1,maxDirectionChange:90,perpendicular:!0,excludeTerminals:[],excludeNodes:[],excludeShapes:[],startDirections:["top","right","bottom","left"],endDirections:["top","right","bottom","left"],directionMap:{top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},cost(){return Ys(this.step,this)},directions(){const n=Ys(this.step,this),t=Ys(this.cost,this);return[{cost:t,offsetX:n,offsetY:0},{cost:t,offsetX:-n,offsetY:0},{cost:t,offsetX:0,offsetY:n},{cost:t,offsetX:0,offsetY:-n}]},penalties(){const n=Ys(this.step,this);return{0:0,45:n/2,90:n/2}},paddingBox(){const n=Ys(this.step,this);return{x:-n,y:-n,width:2*n,height:2*n}},fallbackRouter:cL,draggingRouter:null,snapToGrid:!0};function Ys(n,t){return typeof n=="function"?n.call(t):n}function D5(n){const t=Object.keys(n).reduce((e,i)=>{const r=e;return i==="fallbackRouter"||i==="draggingRouter"||i==="fallbackRoute"?r[i]=n[i]:r[i]=Ys(n[i],n),e},{});if(t.padding){const e=Rl(t.padding);t.paddingBox={x:-e.left,y:-e.top,width:e.left+e.right,height:e.top+e.bottom}}return t.directions.forEach(e=>{const i=new Y(0,0),r=new Y(e.offsetX,e.offsetY);e.angle=We.normalize(i.theta(r))}),t}const NS=1,WS=2;class F5{constructor(){this.items=[],this.hash={},this.values={}}add(t,e){this.hash[t]?this.items.splice(this.items.indexOf(t),1):this.hash[t]=NS,this.values[t]=e;const i=vz(this.items,t,r=>this.values[r]);this.items.splice(i,0,t)}pop(){const t=this.items.shift();return t&&(this.hash[t]=WS),t}isOpen(t){return this.hash[t]===NS}isClose(t){return this.hash[t]===WS}isEmpty(){return this.items.length===0}}class z5{constructor(t){this.options=t,this.mapGridSize=100,this.map={}}build(t,e){const i=this.options,r=i.excludeTerminals.reduce((h,u)=>{const d=e[u];if(d){const c=t.getCell(d.cell);c&&h.push(c)}return h},[]);let o=[];const s=t.getCell(e.getSourceCellId());s&&(o=bS(o,s.getAncestors().map(h=>h.id)));const a=t.getCell(e.getTargetCellId());a&&(o=bS(o,a.getAncestors().map(h=>h.id)));const l=this.mapGridSize;return t.getNodes().reduce((h,u)=>{const d=r.some(m=>m.id===u.id),c=u.shape?i.excludeShapes.includes(u.shape):!1,g=i.excludeNodes.some(m=>typeof m=="string"?u.id===m:m===u),f=o.includes(u.id),p=c||d||g||f;if(u.isVisible()&&!p){const m=u.getBBox().moveAndExpand(i.paddingBox),v=m.getOrigin().snapToGrid(l),b=m.getCorner().snapToGrid(l);for(let y=v.x;y<=b.x;y+=l)for(let C=v.y;C<=b.y;C+=l){const w=new Y(y,C).toString();h[w]==null&&(h[w]=[]),h[w].push(m)}}return h},this.map),this}isAccessible(t){const e=t.clone().snapToGrid(this.mapGridSize).toString(),i=this.map[e];return i?i.every(r=>!r.containsPoint(t)):!0}}function gL(n,t){const e=n.sourceBBox.clone();return t&&t.paddingBox?e.moveAndExpand(t.paddingBox):e}function fL(n,t){const e=n.targetBBox.clone();return t&&t.paddingBox?e.moveAndExpand(t.paddingBox):e}function pL(n,t){return n.sourceAnchor?n.sourceAnchor:gL(n,t).getCenter()}function N5(n,t){return n.targetAnchor?n.targetAnchor:fL(n,t).getCenter()}function Mb(n,t,e,i,r){const o=360/e,s=n.theta(W5(n,t,i,r)),a=We.normalize(s+o/2);return o*Math.floor(a/o)}function W5(n,t,e,i){const r=i.step,o=t.x-n.x,s=t.y-n.y,a=o/e.x,l=s/e.y,h=a*r,u=l*r;return new Y(n.x+h,n.y+u)}function jS(n,t){const e=Math.abs(n-t);return e>180?360-e:e}function j5(n,t){const e=t.step;return t.directions.forEach(i=>{i.gridOffsetX=i.offsetX/e*n.x,i.gridOffsetY=i.offsetY/e*n.y}),t.directions}function V5(n,t,e){return{source:t.clone(),x:VS(e.x-t.x,n),y:VS(e.y-t.y,n)}}function VS(n,t){if(!n)return t;const e=Math.abs(n),i=Math.round(e/t);if(!i)return e;const r=i*t,s=(e-r)/i;return t+s}function G5(n,t){const e=t.source,i=Ne.snapToGrid(n.x-e.x,t.x)+e.x,r=Ne.snapToGrid(n.y-e.y,t.y)+e.y;return new Y(i,r)}function pd(n,t){return n.round(t)}function Ef(n,t,e){return pd(G5(n.clone(),t),e)}function Od(n){return n.toString()}function Tb(n){return new Y(n.x===0?0:Math.abs(n.x)/n.x,n.y===0?0:Math.abs(n.y)/n.y)}function GS(n,t){let e=1/0;for(let i=0,r=t.length;i<r;i+=1){const o=n.manhattanDistance(t[i]);o<e&&(e=o)}return e}function $S(n,t,e,i,r){const o=r.precision,s=r.directionMap,a=n.diff(t.getCenter()),l=Object.keys(s).reduce((h,u)=>{if(e.includes(u)){const d=s[u],c=new Y(n.x+d.x*(Math.abs(a.x)+t.width),n.y+d.y*(Math.abs(a.y)+t.height)),f=new kt(n,c).intersect(t)||[];let p,m=null;for(let v=0;v<f.length;v+=1){const b=f[v],y=n.squaredDistance(b);(p==null||y>p)&&(p=y,m=b)}if(m){let v=Ef(m,i,o);t.containsPoint(v)&&(v=Ef(v.translate(d.x*i.x,d.y*i.y),i,o)),h.push(v)}}return h},[]);return t.containsPoint(n)||l.push(Ef(n,i,o)),l}function $5(n,t,e,i,r){const o=[];let s=Tb(r.diff(e)),a=Od(e),l=n[a],h;for(;l;){h=t[a];const c=Tb(h.diff(l));c.equals(s)||(o.unshift(h),s=c),a=Od(l),l=n[a]}const u=t[a];return Tb(u.diff(i)).equals(s)||o.unshift(u),o}function U5(n,t,e,i,r){const o=r.precision;let s,a;vt.isRectangle(t)?s=pd(pL(n,r).clone(),o):s=pd(t.clone(),o),vt.isRectangle(e)?a=pd(N5(n,r).clone(),o):a=pd(e.clone(),o);const l=V5(r.step,s,a),h=s,u=a;let d,c;if(vt.isRectangle(t)?d=$S(h,t,r.startDirections,l,r):d=[h],vt.isRectangle(e)?c=$S(a,e,r.endDirections,l,r):c=[u],d=d.filter(g=>i.isAccessible(g)),c=c.filter(g=>i.isAccessible(g)),d.length>0&&c.length>0){const g=new F5,f={},p={},m={};for(let T=0,M=d.length;T<M;T+=1){const R=d[T],E=Od(R);g.add(E,GS(R,c)),f[E]=R,m[E]=0}const v=r.previousDirectionAngle,b=v===void 0;let y,C;const w=j5(l,r),_=w.length,A=c.reduce((T,M)=>{const R=Od(M);return T.push(R),T},[]),x=Y.equalPoints(d,c);let S=r.maxLoopCount;for(;!g.isEmpty()&&S>0;){const T=g.pop(),M=f[T],R=p[T],E=m[T],P=M.equals(h),B=R==null;let k;if(B?b?P?k=null:k=Mb(h,M,_,l,r):k=v:k=Mb(R,M,_,l,r),!(B&&x)&&A.indexOf(T)>=0)return r.previousDirectionAngle=k,$5(p,f,M,h,u);for(let O=0;O<_;O+=1){y=w[O];const I=y.angle;if(C=jS(k,I),!(b&&P)&&C>r.maxDirectionChange)continue;const H=Ef(M.clone().translate(y.gridOffsetX||0,y.gridOffsetY||0),l,o),D=Od(H);if(g.isClose(D)||!i.isAccessible(H))continue;if(A.indexOf(D)>=0&&!H.equals(u)){const X=Mb(H,u,_,l,r);if(jS(I,X)>r.maxDirectionChange)continue}const z=y.cost,G=P?0:r.penalties[C],U=E+z+G;(!g.isOpen(D)||U<m[D])&&(f[D]=H,p[D]=M,m[D]=U,g.add(D,U+GS(H,c)))}S-=1}}return r.fallbackRoute?Nt(r.fallbackRoute,this,h,u,r):null}function X5(n,t=10){if(n.length<=1)return n;for(let e=0,i=n.length;e<i-1;e+=1){const r=n[e],o=n[e+1];if(r.x===o.x){const s=t*Math.round(r.x/t);r.x!==s&&(r.x=s,o.x=s)}else if(r.y===o.y){const s=t*Math.round(r.y/t);r.y!==s&&(r.y=s,o.y=s)}}return n}const Y5=function(n,t,e){const i=D5(t),r=gL(e,i),o=fL(e,i),s=pL(e,i),a=new z5(i).build(e.graph.model,e.cell),l=n.map(g=>Y.create(g)),h=[];let u=s,d,c;for(let g=0,f=l.length;g<=f;g+=1){let p=null;if(d=c||r,c=l[g],c==null){c=o;const v=e.cell;if((v.getSourceCellId()==null||v.getTargetCellId()==null)&&typeof i.draggingRouter=="function"){const y=d===r?s:d,C=c.getOrigin();p=Nt(i.draggingRouter,e,y,C,i)}}if(p==null&&(p=U5(e,d,c,a,i)),p===null)return Nt(i.fallbackRouter,this,n,i,e);const m=p[0];m&&m.equals(u)&&p.shift(),u=p[p.length-1]||u,h.push(...p)}return i.snapToGrid?X5(h,e.graph.grid.getGridSize()):h},mL=function(n,t,e){return Nt(Y5,this,n,Object.assign(Object.assign({},H5),t),e)},q5={maxDirectionChange:45,directions(){const n=Ys(this.step,this),t=Ys(this.cost,this),e=Math.ceil(Math.sqrt(n*n<<1));return[{cost:t,offsetX:n,offsetY:0},{cost:e,offsetX:n,offsetY:n},{cost:t,offsetX:0,offsetY:n},{cost:e,offsetX:-n,offsetY:n},{cost:t,offsetX:-n,offsetY:0},{cost:e,offsetX:-n,offsetY:-n},{cost:t,offsetX:0,offsetY:-n},{cost:e,offsetX:n,offsetY:-n}]},fallbackRoute(n,t,e){const i=n.theta(t),r=[];let o={x:t.x,y:n.y},s={x:n.x,y:t.y};if(i%180>90){const y=o;o=s,s=y}const a=i%90<45?o:s,l=new kt(n,a),h=90*Math.ceil(i/90),u=Y.fromPolar(l.squaredLength(),We.toRad(h+135),a),d=new kt(t,u),c=l.intersectsWithLine(d),g=c||t,f=c?g:n,p=360/e.directions.length,m=f.theta(t),v=We.normalize(m+p/2),b=p*Math.floor(v/p);return e.previousDirectionAngle=b,g&&r.push(g.round()),r.push(t),r}},K5=function(n,t,e){return Nt(mL,this,n,Object.assign(Object.assign({},q5),t),e)},Z5=function(n,t,e){const i=t.offset||32,r=t.min==null?16:t.min;let o=0,s=t.direction;const a=e.sourceBBox,l=e.targetBBox,h=a.getCenter(),u=l.getCenter();if(typeof i=="number"&&(o=i),s==null){let v=l.left-a.right,b=l.top-a.bottom;v>=0&&b>=0?s=v>=b?"L":"T":v<=0&&b>=0?(v=a.left-l.right,v>=0?s=v>=b?"R":"T":s="T"):v>=0&&b<=0?(b=a.top-l.bottom,b>=0?s=v>=b?"L":"B":s="L"):(v=a.left-l.right,b=a.top-l.bottom,v>=0&&b>=0?s=v>=b?"R":"B":v<=0&&b>=0?s="B":v>=0&&b<=0?s="R":s=Math.abs(v)>Math.abs(b)?"R":"B")}s==="H"?s=u.x-h.x>=0?"L":"R":s==="V"&&(s=u.y-h.y>=0?"T":"B"),i==="center"&&(s==="L"?o=(l.left-a.right)/2:s==="R"?o=(a.left-l.right)/2:s==="T"?o=(l.top-a.bottom)/2:s==="B"&&(o=(a.top-l.bottom)/2));let d,c,g;const f=s==="L"||s==="R";if(f){if(u.y===h.y)return[...n];g=s==="L"?1:-1,d="x",c="width"}else{if(u.x===h.x)return[...n];g=s==="T"?1:-1,d="y",c="height"}const p=h.clone(),m=u.clone();if(p[d]+=g*(a[c]/2+o),m[d]-=g*(l[c]/2+o),f){const v=p.x,b=m.x,y=a.width/2+r,C=l.width/2+r;u.x>h.x?b<=v&&(p.x=Math.max(b,h.x+y),m.x=Math.min(v,u.x-C)):b>=v&&(p.x=Math.min(b,h.x-y),m.x=Math.max(v,u.x+C))}else{const v=p.y,b=m.y,y=a.height/2+r,C=l.height/2+r;u.y>h.y?b<=v&&(p.y=Math.max(b,h.y+y),m.y=Math.min(v,u.y-C)):b>=v&&(p.y=Math.min(b,h.y-y),m.y=Math.max(v,u.y+C))}return[p.toJSON(),...n,m.toJSON()]};function ql(n,t){if(t!=null&&t!==!1){const e=typeof t=="boolean"?0:t;if(e>0){const i=Y.create(n[1]).move(n[2],e),r=Y.create(n[1]).move(n[0],e);return[i.toJSON(),...n,r.toJSON()]}{const i=n[1];return[Object.assign({},i),...n,Object.assign({},i)]}}return n}const J5=function(n,t,e){const i=t.width||50,o=(t.height||80)/2,s=t.angle||"auto",a=e.sourceAnchor,l=e.targetAnchor,h=e.sourceBBox,u=e.targetBBox;if(a.equals(l)){const d=v=>{const b=We.toRad(v),y=Math.sin(b),C=Math.cos(b),w=new Y(a.x+C*i,a.y+y*i),_=new Y(w.x-C*o,w.y-y*o),A=_.clone().rotate(-90,w),x=_.clone().rotate(90,w);return[A.toJSON(),w.toJSON(),x.toJSON()]},c=v=>{const b=a.clone().move(v,-1),y=new kt(b,v);return!h.containsPoint(v)&&!h.intersectsWithLine(y)},g=[0,90,180,270,45,135,225,315];if(typeof s=="number")return ql(d(s),t.merge);const f=h.getCenter();if(f.equals(a))return ql(d(0),t.merge);const p=f.angleBetween(a,f.clone().translate(1,0));let m=d(p);if(c(m[1]))return ql(m,t.merge);for(let v=1,b=g.length;v<b;v+=1)if(m=d(p+g[v]),c(m[1]))return ql(m,t.merge);return ql(m,t.merge)}{const d=new kt(a,l);let c=d.parallel(-i),g=c.getCenter(),f=c.start.clone().move(c.end,o),p=c.end.clone().move(c.start,o);const m=d.parallel(-1),v=new kt(m.start,g),b=new kt(m.end,g);if((h.containsPoint(g)||u.containsPoint(g)||h.intersectsWithLine(v)||h.intersectsWithLine(b)||u.intersectsWithLine(v)||u.intersectsWithLine(b))&&(c=d.parallel(i),g=c.getCenter(),f=c.start.clone().move(c.end,o),p=c.end.clone().move(c.start,o)),t.merge){const y=new kt(a,l),C=new kt(g,y.center).setLength(Number.MAX_SAFE_INTEGER),w=h.intersectsWithLine(C),_=u.intersectsWithLine(C),A=w?Array.isArray(w)?w:[w]:[];_&&(Array.isArray(_)?A.push(..._):A.push(_));const x=y.center.closest(A);x?(e.sourceAnchor=x.clone(),e.targetAnchor=x.clone()):(e.sourceAnchor=y.center.clone(),e.targetAnchor=y.center.clone())}return ql([f.toJSON(),g.toJSON(),p.toJSON()],t.merge)}},Q5=Object.freeze(Object.defineProperty({__proto__:null,er:Z5,loop:J5,manhattan:mL,metro:K5,normal:E5,oneSide:L5,orth:cL},Symbol.toStringTag,{value:"Module"}));var Qs;(function(n){n.presets=Q5,n.registry=Oi.create({type:"router"}),n.registry.register(n.presets,!0)})(Qs||(Qs={}));const t6=function(n,t,e,i={}){const r=[n,...e,t],o=new ki(r),s=new ie(o);return i.raw?s:s.serialize()},e6=function(n,t,e,i={}){const r=e.length===3?0:1,o=Y.create(e[0+r]),s=Y.create(e[2+r]),a=Y.create(e[1+r]);if(!Y.equals(n,t)){const h=new Y((n.x+t.x)/2,(n.y+t.y)/2),u=h.angleBetween(Y.create(n).rotate(90,h),a);u>1&&(o.rotate(180-u,h),s.rotate(180-u,h),a.rotate(180-u,h))}const l=`
     M ${n.x} ${n.y}
     Q ${o.x} ${o.y} ${a.x} ${a.y}
     Q ${s.x} ${s.y} ${t.x} ${t.y}
  `;return i.raw?ie.parse(l):l},i6=function(n,t,e,i={}){const r=new ie;r.appendSegment(ie.createSegment("M",n));const o=1/3,s=2/3,a=i.radius||10;let l,h;for(let u=0,d=e.length;u<d;u+=1){const c=Y.create(e[u]),g=e[u-1]||n,f=e[u+1]||t;l=h||c.distance(g)/2,h=c.distance(f)/2;const p=-Math.min(a,l),m=-Math.min(a,h),v=c.clone().move(g,p).round(),b=c.clone().move(f,m).round(),y=new Y(o*v.x+s*c.x,s*c.y+o*v.y),C=new Y(o*b.x+s*c.x,s*c.y+o*b.y);r.appendSegment(ie.createSegment("L",v)),r.appendSegment(ie.createSegment("C",y,C,b))}return r.appendSegment(ie.createSegment("L",t)),i.raw?r:r.serialize()},n6=function(n,t,e,i={}){let r,o=i.direction;if(e&&e.length!==0){const s=[n,...e,t],a=sr.throughPoints(s);r=new ie(a)}else if(r=new ie,r.appendSegment(ie.createSegment("M",n)),o||(o=Math.abs(n.x-t.x)>=Math.abs(n.y-t.y)?"H":"V"),o==="H"){const s=(n.x+t.x)/2;r.appendSegment(ie.createSegment("C",s,n.y,s,t.y,t.x,t.y))}else{const s=(n.y+t.y)/2;r.appendSegment(ie.createSegment("C",n.x,s,t.x,s,t.x,t.y))}return i.raw?r:r.serialize()},US=1,kg=1/3,Pg=2/3;function r6(n){let t=n.graph._jumpOverUpdateList;if(t==null&&(t=n.graph._jumpOverUpdateList=[],n.graph.on("cell:mouseup",()=>{const e=n.graph._jumpOverUpdateList;setTimeout(()=>{for(let i=0;i<e.length;i+=1)e[i].update()})}),n.graph.on("model:reseted",()=>{t=n.graph._jumpOverUpdateList=[]})),t.indexOf(n)<0){t.push(n);const e=()=>t.splice(t.indexOf(n),1);n.cell.once("change:connector",e),n.cell.once("removed",e)}}function Rb(n,t,e=[]){const i=[n,...e,t],r=[];return i.forEach((o,s)=>{const a=i[s+1];a!=null&&r.push(new kt(o,a))}),r}function o6(n,t){const e=[];return t.forEach(i=>{const r=n.intersectsWithLine(i);r&&e.push(r)}),e}function XS(n,t){return new kt(n,t).squaredLength()}function s6(n,t,e){return t.reduce((i,r,o)=>{if(pp.includes(r))return i;const s=i.pop()||n,a=Y.create(r).move(s.start,-e);let l=Y.create(r).move(s.start,+e);const h=t[o+1];if(h!=null){const c=l.distance(h);c<=e&&(l=h.move(s.start,c),pp.push(h))}else if(a.distance(s.end)<e*2+US)return i.push(s),i;if(l.distance(s.start)<e*2+US)return i.push(s),i;const d=new kt(a,l);return uc.push(d),i.push(new kt(s.start,a),d,new kt(l,s.end)),i},[])}function YS(n,t,e,i){const r=new ie;let o;return o=ie.createSegment("M",n[0].start),r.appendSegment(o),n.forEach((s,a)=>{if(uc.includes(s)){let l,h,u,d;if(e==="arc"){l=-90,h=s.start.diff(s.end),(h.x<0||h.x===0&&h.y<0)&&(l+=180);const g=s.getCenter(),f=new kt(g,s.end).rotate(l,g);let p;p=new kt(s.start,g),u=p.pointAt(2/3).rotate(l,s.start),d=f.pointAt(1/3).rotate(-l,f.end),o=ie.createSegment("C",u,d,f.end),r.appendSegment(o),p=new kt(g,s.end),u=f.pointAt(1/3).rotate(l,f.end),d=p.pointAt(1/3).rotate(-l,s.end),o=ie.createSegment("C",u,d,s.end),r.appendSegment(o)}else if(e==="gap")o=ie.createSegment("M",s.end),r.appendSegment(o);else if(e==="cubic"){l=s.start.theta(s.end);const c=t*.6;let g=t*1.35;h=s.start.diff(s.end),(h.x<0||h.x===0&&h.y<0)&&(g*=-1),u=new Y(s.start.x+c,s.start.y+g).rotate(l,s.start),d=new Y(s.end.x-c,s.end.y+g).rotate(l,s.end),o=ie.createSegment("C",u,d,s.end),r.appendSegment(o)}}else{const l=n[a+1];i===0||!l||uc.includes(l)?(o=ie.createSegment("L",s.end),r.appendSegment(o)):a6(i,r,s.end,s.start,l.end)}}),r}function a6(n,t,e,i,r){const o=e.distance(i)/2,s=e.distance(r)/2,a=-Math.min(n,o),l=-Math.min(n,s),h=e.clone().move(i,a).round(),u=e.clone().move(r,l).round(),d=new Y(kg*h.x+Pg*e.x,Pg*e.y+kg*h.y),c=new Y(kg*u.x+Pg*e.x,Pg*e.y+kg*u.y);let g;g=ie.createSegment("L",h),t.appendSegment(g),g=ie.createSegment("C",d,c,u),t.appendSegment(g)}let uc,pp;const l6=function(n,t,e,i={}){uc=[],pp=[],r6(this);const r=i.size||5,o=i.type||"arc",s=i.radius||0,a=i.ignoreConnectors||["smooth"],l=this.graph,u=l.model.getEdges();if(u.length===1)return YS(Rb(n,t,e),r,o,s);const d=this.cell,c=u.indexOf(d),g=l.options.connecting.connector||{},f=u.filter((C,w)=>{const _=C.getConnector()||g;return a.includes(_.name)?!1:w>c?_.name!=="jumpover":!0}),p=f.map(C=>l.findViewByCell(C)),m=Rb(n,t,e),v=p.map(C=>C==null?[]:C===this?m:Rb(C.sourcePoint,C.targetPoint,C.routePoints)),b=[];m.forEach(C=>{const w=f.reduce((_,A,x)=>{if(A!==d){const S=o6(C,v[x]);_.push(...S)}return _},[]).sort((_,A)=>XS(C.start,_)-XS(C.start,A));w.length>0?b.push(...s6(C,w,r)):b.push(C)});const y=YS(b,r,o,s);return uc=[],pp=[],i.raw?y:y.serialize()},h6=Object.freeze(Object.defineProperty({__proto__:null,jumpover:l6,loop:e6,normal:t6,rounded:i6,smooth:n6},Symbol.toStringTag,{value:"Module"}));var vl;(function(n){n.presets=h6,n.registry=Oi.create({type:"connector"}),n.registry.register(n.presets,!0)})(vl||(vl={}));var u6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o};class vL extends ar{constructor(t={}){super(),this.pending=!1,this.changing=!1,this.data={},this.mutate(gi(t)),this.changed={}}mutate(t,e={}){const i=e.unset===!0,r=e.silent===!0,o=[],s=this.changing;this.changing=!0,s||(this.previous=gi(this.data),this.changed={});const a=this.data,l=this.previous,h=this.changed;if(Object.keys(t).forEach(u=>{const d=u,c=t[d];bs(a[d],c)||o.push(d),bs(l[d],c)?delete h[d]:h[d]=c,i?delete a[d]:a[d]=c}),!r&&o.length>0&&(this.pending=!0,this.pendingOptions=e,o.forEach(u=>{this.emit("change:*",{key:u,options:e,store:this,current:a[u],previous:l[u]})})),s)return this;if(!r)for(;this.pending;)this.pending=!1,this.emit("changed",{current:a,previous:l,store:this,options:this.pendingOptions});return this.pending=!1,this.changing=!1,this.pendingOptions=null,this}get(t,e){if(t==null)return this.data;const i=this.data[t];return i??e}getPrevious(t){if(this.previous){const e=this.previous[t];return e??void 0}}set(t,e,i){return t!=null&&(typeof t=="object"?this.mutate(t,e):this.mutate({[t]:e},i)),this}remove(t,e){const r={};let o;if(typeof t=="string")r[t]=void 0,o=e;else if(Array.isArray(t))t.forEach(s=>r[s]=void 0),o=e;else{for(const s in this.data)r[s]=void 0;o=t}return this.mutate(r,Object.assign(Object.assign({},o),{unset:!0})),this}getByPath(t){return w1(this.data,t,"/")}setByPath(t,e,i={}){const o=Array.isArray(t)?[...t]:t.split("/"),s=Array.isArray(t)?t.join("/"):t,a=o[0],l=o.length;if(i.propertyPath=s,i.propertyValue=e,i.propertyPathArray=o,l===1)this.set(a,e,i);else{const h={};let u=h,d=a;for(let f=1;f<l;f+=1){const p=o[f],m=Number.isFinite(Number(p));u=u[d]=m?[]:{},d=p}ku(h,o,e,"/");const c=gi(this.data);i.rewrite&&SS(c,t,"/");const g=Di(c,h);this.set(a,g[a],i)}return this}removeByPath(t,e){const i=Array.isArray(t)?t:t.split("/"),r=i[0];if(i.length===1)this.remove(r,e);else{const o=i.slice(1),s=gi(this.get(r));s&&SS(s,o),this.set(r,s,e)}return this}hasChanged(t){return t==null?Object.keys(this.changed).length>0:t in this.changed}getChanges(t){if(t==null)return this.hasChanged()?gi(this.changed):null;const e=this.changing?this.previous:this.data,i={};let r;for(const o in t){const s=t[o];bs(e[o],s)||(i[o]=s,r=!0)}return r?gi(i):null}toJSON(){return gi(this.data)}clone(){const t=this.constructor;return new t(this.data)}dispose(){this.off(),this.data={},this.previous={},this.changed={},this.pending=!1,this.changing=!1,this.pendingOptions=null,this.trigger("disposed",{store:this})}}u6([ar.dispose()],vL.prototype,"dispose",null);class dc{constructor(t){this.cell=t,this.ids={},this.cache={}}get(){return Object.keys(this.ids)}start(t,e,i={},r="/"){const o=this.cell.getPropByPath(t),s=bz(i,dc.defaultOptions),a=this.getTiming(s.timing),l=this.getInterp(s.interp,o,e);let h=0;const u=Array.isArray(t)?t.join(r):t,d=Array.isArray(t)?t:t.split(r),c=()=>{const g=new Date().getTime();h===0&&(h=g);let p=(g-h)/s.duration;p<1?this.ids[u]=requestAnimationFrame(c):p=1;const m=l(a(p));this.cell.setPropByPath(d,m),i.progress&&i.progress(Object.assign({progress:p,currentValue:m},this.getArgs(u))),p===1&&(this.cell.notify("transition:complete",this.getArgs(u)),i.complete&&i.complete(this.getArgs(u)),this.cell.notify("transition:finish",this.getArgs(u)),i.finish&&i.finish(this.getArgs(u)),this.clean(u))};return setTimeout(()=>{this.stop(t,void 0,r),this.cache[u]={startValue:o,targetValue:e,options:s},this.ids[u]=requestAnimationFrame(c),this.cell.notify("transition:start",this.getArgs(u)),i.start&&i.start(this.getArgs(u))},i.delay),this.stop.bind(this,t,r,i)}stop(t,e={},i="/"){const r=Array.isArray(t)?t:t.split(i);return Object.keys(this.ids).filter(o=>bs(r,o.split(i).slice(0,r.length))).forEach(o=>{cancelAnimationFrame(this.ids[o]);const s=this.cache[o],a=this.getArgs(o),l=Object.assign(Object.assign({},s.options),e),h=l.jumpedToEnd;h&&s.targetValue!=null&&(this.cell.setPropByPath(o,s.targetValue),this.cell.notify("transition:end",Object.assign({},a)),this.cell.notify("transition:complete",Object.assign({},a)),l.complete&&l.complete(Object.assign({},a)));const u=Object.assign({jumpedToEnd:h},a);this.cell.notify("transition:stop",Object.assign({},u)),l.stop&&l.stop(Object.assign({},u)),this.cell.notify("transition:finish",Object.assign({},a)),l.finish&&l.finish(Object.assign({},a)),this.clean(o)}),this}clean(t){delete this.ids[t],delete this.cache[t]}getTiming(t){return typeof t=="string"?kl[t]:t}getInterp(t,e,i){return t?t(e,i):typeof i=="number"?rl.number(e,i):typeof i=="string"?i[0]==="#"?rl.color(e,i):rl.unit(e,i):rl.object(e,i)}getArgs(t){const e=this.cache[t];return{path:t,startValue:e.startValue,targetValue:e.targetValue,cell:this.cell}}}(function(n){n.defaultOptions={delay:10,duration:100,timing:"linear"}})(dc||(dc={}));var d6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o},bL=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};class ae extends ar{static config(t){const{markup:e,propHooks:i,attrHooks:r}=t,o=bL(t,["markup","propHooks","attrHooks"]);e!=null&&(this.markup=e),i&&(this.propHooks=this.propHooks.slice(),Array.isArray(i)?this.propHooks.push(...i):typeof i=="function"?this.propHooks.push(i):Object.values(i).forEach(s=>{typeof s=="function"&&this.propHooks.push(s)})),r&&(this.attrHooks=Object.assign(Object.assign({},this.attrHooks),r)),this.defaults=Di({},this.defaults,o)}static getMarkup(){return this.markup}static getDefaults(t){return t?this.defaults:gi(this.defaults)}static getAttrHooks(){return this.attrHooks}static applyPropHooks(t,e){return this.propHooks.reduce((i,r)=>r?Nt(r,t,i):i,e)}get[Symbol.toStringTag](){return ae.toStringTag}constructor(t={}){super();const i=this.constructor.getDefaults(!0),r=Di({},this.preprocess(i),this.preprocess(t));this.id=r.id||np(),this.store=new vL(r),this.animation=new dc(this),this.setup(),this.init(),this.postprocess(t)}init(){}get model(){return this._model}set model(t){this._model!==t&&(this._model=t)}preprocess(t,e){const i=t.id,o=this.constructor.applyPropHooks(this,t);return i==null&&e!==!0&&(o.id=np()),o}postprocess(t){}setup(){this.store.on("change:*",t=>{const{key:e,current:i,previous:r,options:o}=t;this.notify("change:*",{key:e,options:o,current:i,previous:r,cell:this}),this.notify(`change:${e}`,{options:o,current:i,previous:r,cell:this});const s=e;(s==="source"||s==="target")&&this.notify("change:terminal",{type:s,current:i,previous:r,options:o,cell:this})}),this.store.on("changed",({options:t})=>this.notify("changed",{options:t,cell:this}))}notify(t,e){this.trigger(t,e);const i=this.model;return i&&(i.notify(`cell:${t}`,e),this.isNode()?i.notify(`node:${t}`,Object.assign(Object.assign({},e),{node:this})):this.isEdge()&&i.notify(`edge:${t}`,Object.assign(Object.assign({},e),{edge:this}))),this}isNode(){return!1}isEdge(){return!1}isSameStore(t){return this.store===t.store}get view(){return this.store.get("view")}get shape(){return this.store.get("shape","")}getProp(t,e){return t==null?this.store.get():this.store.get(t,e)}setProp(t,e,i){if(typeof t=="string")this.store.set(t,e,i);else{const r=this.preprocess(t,!0);this.store.set(Di({},this.getProp(),r),e),this.postprocess(t)}return this}removeProp(t,e){return typeof t=="string"||Array.isArray(t)?this.store.removeByPath(t,e):this.store.remove(e),this}hasChanged(t){return t==null?this.store.hasChanged():this.store.hasChanged(t)}getPropByPath(t){return this.store.getByPath(t)}setPropByPath(t,e,i={}){return this.model&&(t==="children"?this._children=e?e.map(r=>this.model.getCell(r)).filter(r=>r!=null):null:t==="parent"&&(this._parent=e?this.model.getCell(e):null)),this.store.setByPath(t,e,i),this}removePropByPath(t,e={}){const i=Array.isArray(t)?t:t.split("/");return i[0]==="attrs"&&(e.dirty=!0),this.store.removeByPath(i,e),this}prop(t,e,i){return t==null?this.getProp():typeof t=="string"||Array.isArray(t)?arguments.length===1?this.getPropByPath(t):e==null?this.removePropByPath(t,i||{}):this.setPropByPath(t,e,i||{}):this.setProp(t,e||{})}previous(t){return this.store.getPrevious(t)}get zIndex(){return this.getZIndex()}set zIndex(t){t==null?this.removeZIndex():this.setZIndex(t)}getZIndex(){return this.store.get("zIndex")}setZIndex(t,e={}){return this.store.set("zIndex",t,e),this}removeZIndex(t={}){return this.store.remove("zIndex",t),this}toFront(t={}){const e=this.model;if(e){let i=e.getMaxZIndex(),r;t.deep?(r=this.getDescendants({deep:!0,breadthFirst:!0}),r.unshift(this)):r=[this],i=i-r.length+1;const o=e.total();let s=e.indexOf(this)!==o-r.length;s||(s=r.some((a,l)=>a.getZIndex()!==i+l)),s&&this.batchUpdate("to-front",()=>{i+=r.length,r.forEach((a,l)=>{a.setZIndex(i+l,t)})})}return this}toBack(t={}){const e=this.model;if(e){let i=e.getMinZIndex(),r;t.deep?(r=this.getDescendants({deep:!0,breadthFirst:!0}),r.unshift(this)):r=[this];let o=e.indexOf(this)!==0;o||(o=r.some((s,a)=>s.getZIndex()!==i+a)),o&&this.batchUpdate("to-back",()=>{i-=r.length,r.forEach((s,a)=>{s.setZIndex(i+a,t)})})}return this}get markup(){return this.getMarkup()}set markup(t){t==null?this.removeMarkup():this.setMarkup(t)}getMarkup(){let t=this.store.get("markup");return t==null&&(t=this.constructor.getMarkup()),t}setMarkup(t,e={}){return this.store.set("markup",t,e),this}removeMarkup(t={}){return this.store.remove("markup",t),this}get attrs(){return this.getAttrs()}set attrs(t){t==null?this.removeAttrs():this.setAttrs(t)}getAttrs(){const t=this.store.get("attrs");return t?Object.assign({},t):{}}setAttrs(t,e={}){if(t==null)this.removeAttrs(e);else{const i=r=>this.store.set("attrs",r,e);if(e.overwrite===!0)i(t);else{const r=this.getAttrs();e.deep===!1?i(Object.assign(Object.assign({},r),t)):i(Di({},r,t))}}return this}replaceAttrs(t,e={}){return this.setAttrs(t,Object.assign(Object.assign({},e),{overwrite:!0}))}updateAttrs(t,e={}){return this.setAttrs(t,Object.assign(Object.assign({},e),{deep:!1}))}removeAttrs(t={}){return this.store.remove("attrs",t),this}getAttrDefinition(t){if(!t)return null;const i=this.constructor.getAttrHooks()||{};let r=i[t]||Do.registry.get(t);if(!r){const o=Hm(t);r=i[o]||Do.registry.get(o)}return r||null}getAttrByPath(t){return t==null||t===""?this.getAttrs():this.getPropByPath(this.prefixAttrPath(t))}setAttrByPath(t,e,i={}){return this.setPropByPath(this.prefixAttrPath(t),e,i),this}removeAttrByPath(t,e={}){return this.removePropByPath(this.prefixAttrPath(t),e),this}prefixAttrPath(t){return Array.isArray(t)?["attrs"].concat(t):`attrs/${t}`}attr(t,e,i){return t==null?this.getAttrByPath():typeof t=="string"||Array.isArray(t)?arguments.length===1?this.getAttrByPath(t):e==null?this.removeAttrByPath(t,i||{}):this.setAttrByPath(t,e,i||{}):this.setAttrs(t,e||{})}get visible(){return this.isVisible()}set visible(t){this.setVisible(t)}setVisible(t,e={}){return this.store.set("visible",t,e),this}isVisible(){return this.store.get("visible")!==!1}show(t={}){return this.isVisible()||this.setVisible(!0,t),this}hide(t={}){return this.isVisible()&&this.setVisible(!1,t),this}toggleVisible(t,e={}){const i=typeof t=="boolean"?t:!this.isVisible(),r=typeof t=="boolean"?e:t;return i?this.show(r):this.hide(r),this}get data(){return this.getData()}set data(t){this.setData(t)}getData(){return this.store.get("data")}setData(t,e={}){if(t==null)this.removeData(e);else{const i=r=>this.store.set("data",r,e);if(e.overwrite===!0)i(t);else{const r=this.getData();e.deep===!1?i(typeof t=="object"?Object.assign(Object.assign({},r),t):t):i(Di({},r,t))}}return this}replaceData(t,e={}){return this.setData(t,Object.assign(Object.assign({},e),{overwrite:!0}))}updateData(t,e={}){return this.setData(t,Object.assign(Object.assign({},e),{deep:!1}))}removeData(t={}){return this.store.remove("data",t),this}get parent(){return this.getParent()}get children(){return this.getChildren()}getParentId(){return this.store.get("parent")}getParent(){const t=this.getParentId();if(t&&this.model){const e=this.model.getCell(t);return this._parent=e,e}return null}getChildren(){const t=this.store.get("children");if(t&&t.length&&this.model){const e=t.map(i=>{var r;return(r=this.model)===null||r===void 0?void 0:r.getCell(i)}).filter(i=>i!=null);return this._children=e,[...e]}return null}hasParent(){return this.parent!=null}isParentOf(t){return t!=null&&t.getParent()===this}isChildOf(t){return t!=null&&this.getParent()===t}eachChild(t,e){return this.children&&this.children.forEach(t,e),this}filterChild(t,e){return this.children?this.children.filter(t,e):[]}getChildCount(){return this.children==null?0:this.children.length}getChildIndex(t){return this.children==null?-1:this.children.indexOf(t)}getChildAt(t){return this.children!=null&&t>=0?this.children[t]:null}getAncestors(t={}){const e=[];let i=this.getParent();for(;i;)e.push(i),i=t.deep!==!1?i.getParent():null;return e}getDescendants(t={}){if(t.deep!==!1){if(t.breadthFirst){const e=[],i=this.getChildren()||[];for(;i.length>0;){const r=i.shift(),o=r.getChildren();e.push(r),o&&i.push(...o)}return e}{const e=this.getChildren()||[];return e.forEach(i=>{e.push(...i.getDescendants(t))}),e}}return this.getChildren()||[]}isDescendantOf(t,e={}){if(t==null)return!1;if(e.deep!==!1){let i=this.getParent();for(;i;){if(i===t)return!0;i=i.getParent()}return!1}return this.isChildOf(t)}isAncestorOf(t,e={}){return t==null?!1:t.isDescendantOf(this,e)}contains(t){return this.isAncestorOf(t)}getCommonAncestor(...t){return ae.getCommonAncestor(this,...t)}setParent(t,e={}){return this._parent=t,t?this.store.set("parent",t.id,e):this.store.remove("parent",e),this}setChildren(t,e={}){return this._children=t,t!=null?this.store.set("children",t.map(i=>i.id),e):this.store.remove("children",e),this}unembed(t,e={}){const i=this.children;if(i!=null&&t!=null){const r=this.getChildIndex(t);r!==-1&&(i.splice(r,1),t.setParent(null,e),this.setChildren(i,e))}return this}embed(t,e={}){return t.addTo(this,e),this}addTo(t,e={}){return ae.isCell(t)?t.addChild(this,e):t.addCell(this,e),this}insertTo(t,e,i={}){return t.insertChild(this,e,i),this}addChild(t,e={}){return this.insertChild(t,void 0,e)}insertChild(t,e,i={}){if(t!=null&&t!==this){const r=t.getParent(),o=this!==r;let s=e;if(s==null&&(s=this.getChildCount(),o||(s-=1)),r){const l=r.getChildren();if(l){const h=l.indexOf(t);h>=0&&(t.setParent(null,i),l.splice(h,1),r.setChildren(l,i))}}let a=this.children;if(a==null?(a=[],a.push(t)):a.splice(s,0,t),t.setParent(this,i),this.setChildren(a,i),o&&this.model){const l=this.model.getIncomingEdges(this),h=this.model.getOutgoingEdges(this);l&&l.forEach(u=>u.updateParent(i)),h&&h.forEach(u=>u.updateParent(i))}this.model&&this.model.addCell(t,i)}return this}removeFromParent(t={}){const e=this.getParent();if(e!=null){const i=e.getChildIndex(this);e.removeChildAt(i,t)}return this}removeChild(t,e={}){const i=this.getChildIndex(t);return this.removeChildAt(i,e)}removeChildAt(t,e={}){const i=this.getChildAt(t);return this.children!=null&&i!=null&&(this.unembed(i,e),i.remove(e)),i}remove(t={}){return this.batchUpdate("remove",()=>{const e=this.getParent();e&&e.removeChild(this,t),t.deep!==!1&&this.eachChild(i=>i.remove(t)),this.model&&this.model.removeCell(this,t)}),this}transition(t,e,i={},r="/"){return this.animation.start(t,e,i,r)}stopTransition(t,e,i="/"){return this.animation.stop(t,e,i),this}getTransitions(){return this.animation.get()}translate(t,e,i){return this}scale(t,e,i,r){return this}addTools(t,e,i){const r=Array.isArray(t)?t:[t],o=typeof e=="string"?e:null,s=typeof e=="object"?e:typeof i=="object"?i:{};if(s.reset)return this.setTools({name:o,items:r,local:s.local},s);let a=gi(this.getTools());if(a==null||o==null||a.name===o)return a==null&&(a={}),a.items||(a.items=[]),a.name=o,a.items=[...a.items,...r],this.setTools(Object.assign({},a),s)}setTools(t,e={}){return t==null?this.removeTools():this.store.set("tools",ae.normalizeTools(t),e),this}getTools(){return this.store.get("tools")}removeTools(t={}){return this.store.remove("tools",t),this}hasTools(t){const e=this.getTools();return e==null?!1:t==null?!0:e.name===t}hasTool(t){const e=this.getTools();return e==null?!1:e.items.some(i=>typeof i=="string"?i===t:i.name===t)}removeTool(t,e={}){const i=gi(this.getTools());if(i){let r=!1;const o=i.items.slice(),s=a=>{o.splice(a,1),r=!0};if(typeof t=="number")s(t);else for(let a=o.length-1;a>=0;a-=1){const l=o[a];(typeof l=="string"?l===t:l.name===t)&&s(a)}r&&(i.items=o,this.setTools(i,e))}return this}getBBox(t){return new vt}getConnectionPoint(t,e){return new Y}toJSON(t={}){const e=Object.assign({},this.store.get()),i=Object.prototype.toString,r=this.isNode()?"node":this.isEdge()?"edge":"cell";if(!e.shape){const f=this.constructor;throw new Error(`Unable to serialize ${r} missing "shape" prop, check the ${r} "${f.name||i.call(f)}"`)}const o=this.constructor,s=t.diff===!0,a=e.attrs||{},l=o.getDefaults(!0),h=s?this.preprocess(l,!0):l,u=h.attrs||{},d={};Object.entries(e).forEach(([f,p])=>{if(p!=null&&!Array.isArray(p)&&typeof p=="object"&&!Es(p))throw new Error(`Can only serialize ${r} with plain-object props, but got a "${i.call(p)}" type of key "${f}" on ${r} "${this.id}"`);if(f!=="attrs"&&f!=="shape"&&s){const m=h[f];bs(p,m)&&delete e[f]}}),Object.keys(a).forEach(f=>{const p=a[f],m=u[f];Object.keys(p).forEach(v=>{const b=p[v],y=m?m[v]:null;b!=null&&typeof b=="object"&&!Array.isArray(b)?Object.keys(b).forEach(C=>{const w=b[C];if(m==null||y==null||!cd(y)||!bs(y[C],w)){d[f]==null&&(d[f]={}),d[f][v]==null&&(d[f][v]={});const _=d[f][v];_[C]=w}}):(m==null||!bs(y,b))&&(d[f]==null&&(d[f]={}),d[f][v]=b)})});const c=Object.assign(Object.assign({},e),{attrs:zP(d)?void 0:d});c.attrs==null&&delete c.attrs;const g=c;return g.angle===0&&delete g.angle,gi(g)}clone(t={}){if(!t.deep){const i=Object.assign({},this.store.get());t.keepId||delete i.id,delete i.parent,delete i.children;const r=this.constructor;return new r(i)}return ae.deepClone(this)[this.id]}findView(t){return t.findViewByCell(this)}startBatch(t,e={},i=this.model){return this.notify("batch:start",{name:t,data:e,cell:this}),i&&i.startBatch(t,Object.assign(Object.assign({},e),{cell:this})),this}stopBatch(t,e={},i=this.model){return i&&i.stopBatch(t,Object.assign(Object.assign({},e),{cell:this})),this.notify("batch:stop",{name:t,data:e,cell:this}),this}batchUpdate(t,e,i){const r=this.model;this.startBatch(t,i,r);const o=e();return this.stopBatch(t,i,r),o}dispose(){this.removeFromParent(),this.store.dispose()}}ae.defaults={};ae.attrHooks={};ae.propHooks=[];d6([ar.dispose()],ae.prototype,"dispose",null);(function(n){function t(e){return typeof e=="string"?{items:[e]}:Array.isArray(e)?{items:e}:e.items?e:{items:[e]}}n.normalizeTools=t})(ae||(ae={}));(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const i=e[Symbol.toStringTag],r=e;return(i==null||i===n.toStringTag)&&typeof r.isNode=="function"&&typeof r.isEdge=="function"&&typeof r.prop=="function"&&typeof r.attr=="function"}n.isCell=t})(ae||(ae={}));(function(n){function t(...o){const s=o.filter(l=>l!=null).map(l=>l.getAncestors()).sort((l,h)=>l.length-h.length);return s.shift().find(l=>s.every(h=>h.includes(l)))||null}n.getCommonAncestor=t;function e(o,s={}){let a=null;for(let l=0,h=o.length;l<h;l+=1){const u=o[l];let d=u.getBBox(s);if(d){if(u.isNode()){const c=u.getAngle();c!=null&&c!==0&&(d=d.bbox(c))}a=a==null?d:a.union(d)}}return a}n.getCellsBBox=e;function i(o){const s=[o,...o.getDescendants({deep:!0})];return n.cloneCells(s)}n.deepClone=i;function r(o){const s=FP(o),a=s.reduce((l,h)=>(l[h.id]=h.clone(),l),{});return s.forEach(l=>{const h=a[l.id];if(h.isEdge()){const c=h.getSourceCellId(),g=h.getTargetCellId();c&&a[c]&&h.setSource(Object.assign(Object.assign({},h.getSource()),{cell:a[c].id})),g&&a[g]&&h.setTarget(Object.assign(Object.assign({},h.getTarget()),{cell:a[g].id}))}const u=l.getParent();u&&a[u.id]&&h.setParent(a[u.id]);const d=l.getChildren();if(d&&d.length){const c=d.reduce((g,f)=>(a[f.id]&&g.push(a[f.id]),g),[]);c.length>0&&h.setChildren(c)}}),a}n.cloneCells=r})(ae||(ae={}));(function(n){n.config({propHooks(t){var{tools:e}=t,i=bL(t,["tools"]);return e&&(i.tools=n.normalizeTools(e)),i}})})(ae||(ae={}));var lu;(function(n){let t,e;function i(s,a){return a?t!=null&&t.exist(s):e!=null&&e.exist(s)}n.exist=i;function r(s){t=s}n.setEdgeRegistry=r;function o(s){e=s}n.setNodeRegistry=o})(lu||(lu={}));class c6{constructor(t){this.ports=[],this.groups={},this.init(gi(t))}getPorts(){return this.ports}getGroup(t){return t!=null?this.groups[t]:null}getPortsByGroup(t){return this.ports.filter(e=>e.group===t||e.group==null&&t==null)}getPortsLayoutByGroup(t,e){const i=this.getPortsByGroup(t),r=t?this.getGroup(t):null,o=r?r.position:null,s=o?o.name:null;let a;if(s!=null){const d=ml.registry.get(s);if(d==null)return ml.registry.onNotFound(s);a=d}else a=ml.presets.left;const l=i.map(d=>d&&d.position&&d.position.args||{}),h=o&&o.args||{};return a(l,e,h).map((d,c)=>{const g=i[c];return{portLayout:d,portId:g.id,portSize:g.size,portAttrs:g.attrs,labelSize:g.label.size,labelLayout:this.getPortLabelLayout(g,Y.create(d.position),e)}})}init(t){const{groups:e,items:i}=t;e!=null&&Object.keys(e).forEach(r=>{this.groups[r]=this.parseGroup(e[r])}),Array.isArray(i)&&i.forEach(r=>{this.ports.push(this.parsePort(r))})}parseGroup(t){return Object.assign(Object.assign({},t),{label:this.getLabel(t,!0),position:this.getPortPosition(t.position,!0)})}parsePort(t){const e=Object.assign({},t),i=this.getGroup(t.group)||{};return e.markup=e.markup||i.markup,e.attrs=Di({},i.attrs,e.attrs),e.position=this.createPosition(i,e),e.label=Di({},i.label,this.getLabel(e)),e.zIndex=this.getZIndex(i,e),e.size=Object.assign(Object.assign({},i.size),e.size),e}getZIndex(t,e){return typeof e.zIndex=="number"?e.zIndex:typeof t.zIndex=="number"||t.zIndex==="auto"?t.zIndex:"auto"}createPosition(t,e){return Di({name:"left",args:{}},t.position,{args:e.args})}getPortPosition(t,e=!1){if(t==null){if(e)return{name:"left",args:{}}}else{if(typeof t=="string")return{name:t,args:{}};if(Array.isArray(t))return{name:"absolute",args:{x:t[0],y:t[1]}};if(typeof t=="object")return t}return{args:{}}}getPortLabelPosition(t,e=!1){if(t==null){if(e)return{name:"left",args:{}}}else{if(typeof t=="string")return{name:t,args:{}};if(typeof t=="object")return t}return{args:{}}}getLabel(t,e=!1){const i=t.label||{};return i.position=this.getPortLabelPosition(i.position,e),i}getPortLabelLayout(t,e,i){const r=t.label.position.name||"left",o=t.label.position.args||{},s=eu.registry.get(r)||eu.presets.left;return s?s(e,i,o):null}}var Vm=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};let Ui=class yL extends ae{get[Symbol.toStringTag](){return yL.toStringTag}constructor(t={}){super(t),this.initPorts()}preprocess(t,e){const{x:i,y:r,width:o,height:s}=t,a=Vm(t,["x","y","width","height"]);if(i!=null||r!=null){const l=a.position;a.position=Object.assign(Object.assign({},l),{x:i??(l?l.x:0),y:r??(l?l.y:0)})}if(o!=null||s!=null){const l=a.size;a.size=Object.assign(Object.assign({},l),{width:o??(l?l.width:0),height:s??(l?l.height:0)})}return super.preprocess(a,e)}isNode(){return!0}size(t,e,i){return t===void 0?this.getSize():typeof t=="number"?this.setSize(t,e,i):this.setSize(t,e)}getSize(){const t=this.store.get("size");return t?Object.assign({},t):{width:1,height:1}}setSize(t,e,i){return typeof t=="object"?this.resize(t.width,t.height,e):this.resize(t,e,i),this}resize(t,e,i={}){this.startBatch("resize",i);const r=i.direction;if(r){const o=this.getSize();switch(r){case"left":case"right":e=o.height;break;case"top":case"bottom":t=o.width;break}let a={right:0,"top-right":0,top:1,"top-left":1,left:2,"bottom-left":2,bottom:3,"bottom-right":3}[r];const l=We.normalize(this.getAngle()||0);i.absolute&&(a+=Math.floor((l+45)/90),a%=4);const h=this.getBBox();let u;a===0?u=h.getBottomLeft():a===1?u=h.getCorner():a===2?u=h.getTopRight():u=h.getOrigin();const d=u.clone().rotate(-l,h.getCenter()),c=Math.sqrt(t*t+e*e)/2;let g=a*Math.PI/2;g+=Math.atan(a%2===0?e/t:t/e),g-=We.toRad(l);const p=Y.fromPolar(c,g,d).clone().translate(t/-2,e/-2);this.store.set("size",{width:t,height:e},i),this.setPosition(p.x,p.y,i)}else this.store.set("size",{width:t,height:e},i);return this.stopBatch("resize",i),this}scale(t,e,i,r={}){const o=this.getBBox().scale(t,e,i??void 0);return this.startBatch("scale",r),this.setPosition(o.x,o.y,r),this.resize(o.width,o.height,r),this.stopBatch("scale"),this}position(t,e,i){return typeof t=="number"?this.setPosition(t,e,i):this.getPosition(t)}getPosition(t={}){if(t.relative){const i=this.getParent();if(i!=null&&i.isNode()){const r=this.getPosition(),o=i.getPosition();return{x:r.x-o.x,y:r.y-o.y}}}const e=this.store.get("position");return e?Object.assign({},e):{x:0,y:0}}setPosition(t,e,i={}){let r,o,s;if(typeof t=="object"?(r=t.x,o=t.y,s=e||{}):(r=t,o=e,s=i||{}),s.relative){const a=this.getParent();if(a!=null&&a.isNode()){const l=a.getPosition();r+=l.x,o+=l.y}}if(s.deep){const a=this.getPosition();this.translate(r-a.x,o-a.y,s)}else this.store.set("position",{x:r,y:o},s);return this}translate(t=0,e=0,i={}){if(t===0&&e===0)return this;i.translateBy=i.translateBy||this.id;const r=this.getPosition();if(i.restrict!=null&&i.translateBy===this.id){const s=this.getBBox({deep:!0}),a=i.restrict,l=r.x-s.x,h=r.y-s.y,u=Math.max(a.x+l,Math.min(a.x+a.width+l-s.width,r.x+t)),d=Math.max(a.y+h,Math.min(a.y+a.height+h-s.height,r.y+e));t=u-r.x,e=d-r.y}const o={x:r.x+t,y:r.y+e};return i.tx=t,i.ty=e,i.transition?(typeof i.transition!="object"&&(i.transition={}),this.transition("position",o,Object.assign(Object.assign({},i.transition),{interp:rl.object})),this.eachChild(s=>{var a;((a=i.exclude)===null||a===void 0?void 0:a.includes(s))||s.translate(t,e,i)})):(this.startBatch("translate",i),this.store.set("position",o,i),this.eachChild(s=>{var a;((a=i.exclude)===null||a===void 0?void 0:a.includes(s))||s.translate(t,e,i)}),this.stopBatch("translate",i)),this}angle(t,e){return t==null?this.getAngle():this.rotate(t,e)}getAngle(){return this.store.get("angle",0)}rotate(t,e={}){const i=this.getAngle();if(e.center){const r=this.getSize(),o=this.getPosition(),s=this.getBBox().getCenter();s.rotate(i-t,e.center);const a=s.x-r.width/2-o.x,l=s.y-r.height/2-o.y;this.startBatch("rotate",{angle:t,options:e}),this.setPosition(o.x+a,o.y+l,e),this.rotate(t,Object.assign(Object.assign({},e),{center:null})),this.stopBatch("rotate")}else this.store.set("angle",e.absolute?t:(i+t)%360,e);return this}getBBox(t={}){if(t.deep){const e=this.getDescendants({deep:!0,breadthFirst:!0});return e.push(this),ae.getCellsBBox(e)}return vt.fromPositionAndSize(this.getPosition(),this.getSize())}getConnectionPoint(t,e){const i=this.getBBox(),r=i.getCenter(),o=t.getTerminal(e);if(o==null)return r;const s=o.port;if(!s||!this.hasPort(s))return r;const a=this.getPort(s);if(!a||!a.group)return r;const h=this.getPortsPosition(a.group)[s].position,u=Y.create(h).translate(i.getOrigin()),d=this.getAngle();return d&&u.rotate(-d,r),u}fit(t={}){const i=(this.getChildren()||[]).filter(h=>h.isNode());if(i.length===0)return this;this.startBatch("fit-embeds",t),t.deep&&i.forEach(h=>h.fit(t));let{x:r,y:o,width:s,height:a}=ae.getCellsBBox(i);const l=Rl(t.padding);return r-=l.left,o-=l.top,s+=l.left+l.right,a+=l.bottom+l.top,this.store.set({position:{x:r,y:o},size:{width:s,height:a}},t),this.stopBatch("fit-embeds"),this}get portContainerMarkup(){return this.getPortContainerMarkup()}set portContainerMarkup(t){this.setPortContainerMarkup(t)}getDefaultPortContainerMarkup(){return this.store.get("defaultPortContainerMarkup")||qe.getPortContainerMarkup()}getPortContainerMarkup(){return this.store.get("portContainerMarkup")||this.getDefaultPortContainerMarkup()}setPortContainerMarkup(t,e={}){return this.store.set("portContainerMarkup",qe.clone(t),e),this}get portMarkup(){return this.getPortMarkup()}set portMarkup(t){this.setPortMarkup(t)}getDefaultPortMarkup(){return this.store.get("defaultPortMarkup")||qe.getPortMarkup()}getPortMarkup(){return this.store.get("portMarkup")||this.getDefaultPortMarkup()}setPortMarkup(t,e={}){return this.store.set("portMarkup",qe.clone(t),e),this}get portLabelMarkup(){return this.getPortLabelMarkup()}set portLabelMarkup(t){this.setPortLabelMarkup(t)}getDefaultPortLabelMarkup(){return this.store.get("defaultPortLabelMarkup")||qe.getPortLabelMarkup()}getPortLabelMarkup(){return this.store.get("portLabelMarkup")||this.getDefaultPortLabelMarkup()}setPortLabelMarkup(t,e={}){return this.store.set("portLabelMarkup",qe.clone(t),e),this}get ports(){const t=this.store.get("ports",{items:[]});return t.items==null&&(t.items=[]),t}getPorts(){return gi(this.ports.items)}getPortsByGroup(t){return this.getPorts().filter(e=>e.group===t)}getPort(t){return gi(this.ports.items.find(e=>e.id&&e.id===t))}getPortAt(t){return this.ports.items[t]||null}hasPorts(){return this.ports.items.length>0}hasPort(t){return this.getPortIndex(t)!==-1}getPortIndex(t){const e=typeof t=="string"?t:t.id;return e!=null?this.ports.items.findIndex(i=>i.id===e):-1}getPortsPosition(t){const e=this.getSize();return this.port.getPortsLayoutByGroup(t,new vt(0,0,e.width,e.height)).reduce((r,o)=>{const s=o.portLayout;return r[o.portId]={position:Object.assign({},s.position),angle:s.angle||0},r},{})}getPortProp(t,e){return this.getPropByPath(this.prefixPortPath(t,e))}setPortProp(t,e,i,r){if(typeof e=="string"||Array.isArray(e)){const a=this.prefixPortPath(t,e),l=i;return this.setPropByPath(a,l,r)}const o=this.prefixPortPath(t),s=e;return this.setPropByPath(o,s,i)}removePortProp(t,e,i){return typeof e=="string"||Array.isArray(e)?this.removePropByPath(this.prefixPortPath(t,e),i):this.removePropByPath(this.prefixPortPath(t),e)}portProp(t,e,i,r){return e==null?this.getPortProp(t):typeof e=="string"||Array.isArray(e)?arguments.length===2?this.getPortProp(t,e):i==null?this.removePortProp(t,e,r):this.setPortProp(t,e,i,r):this.setPortProp(t,e,i)}prefixPortPath(t,e){const i=this.getPortIndex(t);if(i===-1)throw new Error(`Unable to find port with id: "${t}"`);return e==null||e===""?["ports","items",`${i}`]:Array.isArray(e)?["ports","items",`${i}`,...e]:`ports/items/${i}/${e}`}addPort(t,e){const i=[...this.ports.items];return i.push(t),this.setPropByPath("ports/items",i,e),this}addPorts(t,e){return this.setPropByPath("ports/items",[...this.ports.items,...t],e),this}insertPort(t,e,i){const r=[...this.ports.items];return r.splice(t,0,e),this.setPropByPath("ports/items",r,i),this}removePort(t,e={}){return this.removePortAt(this.getPortIndex(t),e)}removePortAt(t,e={}){if(t>=0){const i=[...this.ports.items];i.splice(t,1),e.rewrite=!0,this.setPropByPath("ports/items",i,e)}return this}removePorts(t,e){let i;if(Array.isArray(t)){if(i=e||{},t.length){i.rewrite=!0;const o=[...this.ports.items].filter(s=>!t.some(a=>{const l=typeof a=="string"?a:a.id;return s.id===l}));this.setPropByPath("ports/items",o,i)}}else i=t||{},i.rewrite=!0,this.setPropByPath("ports/items",[],i);return this}getParsedPorts(){return this.port.getPorts()}getParsedGroups(){return this.port.groups}getPortsLayoutByGroup(t,e){return this.port.getPortsLayoutByGroup(t,e)}initPorts(){this.updatePortData(),this.on("change:ports",()=>{this.processRemovedPort(),this.updatePortData()})}processRemovedPort(){const t=this.ports,e={};t.items.forEach(s=>{s.id&&(e[s.id]=!0)});const i={};(this.store.getPrevious("ports")||{items:[]}).items.forEach(s=>{s.id&&!e[s.id]&&(i[s.id]=!0)});const o=this.model;o&&!zP(i)&&(o.getConnectedEdges(this,{incoming:!0}).forEach(l=>{const h=l.getTargetPortId();h&&i[h]&&l.remove()}),o.getConnectedEdges(this,{outgoing:!0}).forEach(l=>{const h=l.getSourcePortId();h&&i[h]&&l.remove()}))}validatePorts(){const t={},e=[];return this.ports.items.forEach(i=>{typeof i!="object"&&e.push(`Invalid port ${i}.`),i.id==null&&(i.id=this.generatePortId()),t[i.id]&&e.push("Duplicitied port id."),t[i.id]=!0}),e}generatePortId(){return np()}updatePortData(){const t=this.validatePorts();if(t.length>0)throw this.store.set("ports",this.store.getPrevious("ports")),new Error(t.join(" "));const e=this.port?this.port.getPorts():null;this.port=new c6(this.ports);const i=this.port.getPorts(),r=e?i.filter(s=>e.find(a=>a.id===s.id)?null:s):[...i],o=e?e.filter(s=>i.find(a=>a.id===s.id)?null:s):[];r.length>0&&this.notify("ports:added",{added:r,cell:this,node:this}),o.length>0&&this.notify("ports:removed",{removed:o,cell:this,node:this})}};Ui.defaults={angle:0,position:{x:0,y:0},size:{width:1,height:1}};(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const i=e[Symbol.toStringTag],r=e;return(i==null||i===n.toStringTag)&&typeof r.isNode=="function"&&typeof r.isEdge=="function"&&typeof r.prop=="function"&&typeof r.attr=="function"&&typeof r.size=="function"&&typeof r.position=="function"}n.isNode=t})(Ui||(Ui={}));(function(n){n.config({propHooks(t){var{ports:e}=t,i=Vm(t,["ports"]);return e&&(i.ports=Array.isArray(e)?{items:e}:e),i}})})(Ui||(Ui={}));(function(n){n.registry=Oi.create({type:"node",process(t,e){if(lu.exist(t,!0))throw new Error(`Node with name '${t}' was registered by anthor Edge`);if(typeof e=="function")return e.config({shape:t}),e;let i=n;const{inherit:r}=e,o=Vm(e,["inherit"]);if(r)if(typeof r=="string"){const a=this.get(r);a==null?this.onNotFound(r,"inherited"):i=a}else i=r;o.constructorName==null&&(o.constructorName=t);const s=i.define.call(i,o);return s.config({shape:t}),s}}),lu.setNodeRegistry(n.registry)})(Ui||(Ui={}));(function(n){let t=0;function e(o){return o?x1(o):(t+=1,`CustomNode${t}`)}function i(o){const{constructorName:s,overwrite:a}=o,l=Vm(o,["constructorName","overwrite"]),h=_1(e(s||l.shape),this);return h.config(l),l.shape&&n.registry.register(l.shape,h,a),h}n.define=i;function r(o){const s=o.shape||"rect",a=n.registry.get(s);return a?new a(o):n.registry.onNotFound(s)}n.create=r})(Ui||(Ui={}));var Gm=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};let vi=class CL extends ae{get[Symbol.toStringTag](){return CL.toStringTag}constructor(t={}){super(t)}preprocess(t,e){const{source:i,sourceCell:r,sourcePort:o,sourcePoint:s,target:a,targetCell:l,targetPort:h,targetPoint:u}=t,c=Gm(t,["source","sourceCell","sourcePort","sourcePoint","target","targetCell","targetPort","targetPoint"]),g=f=>typeof f=="string"||typeof f=="number";if(i!=null)if(ae.isCell(i))c.source={cell:i.id};else if(g(i))c.source={cell:i};else if(Y.isPoint(i))c.source=i.toJSON();else if(Array.isArray(i))c.source={x:i[0],y:i[1]};else{const f=i.cell;ae.isCell(f)?c.source=Object.assign(Object.assign({},i),{cell:f.id}):c.source=i}if(r!=null||o!=null){let f=c.source;if(r!=null){const p=g(r)?r:r.id;f?f.cell=p:f=c.source={cell:p}}o!=null&&f&&(f.port=o)}else s!=null&&(c.source=Y.create(s).toJSON());if(a!=null)if(ae.isCell(a))c.target={cell:a.id};else if(g(a))c.target={cell:a};else if(Y.isPoint(a))c.target=a.toJSON();else if(Array.isArray(a))c.target={x:a[0],y:a[1]};else{const f=a.cell;ae.isCell(f)?c.target=Object.assign(Object.assign({},a),{cell:f.id}):c.target=a}if(l!=null||h!=null){let f=c.target;if(l!=null){const p=g(l)?l:l.id;f?f.cell=p:f=c.target={cell:p}}h!=null&&f&&(f.port=h)}else u!=null&&(c.target=Y.create(u).toJSON());return super.preprocess(c,e)}setup(){super.setup(),this.on("change:labels",t=>this.onLabelsChanged(t)),this.on("change:vertices",t=>this.onVertexsChanged(t))}isEdge(){return!0}disconnect(t={}){return this.store.set({source:{x:0,y:0},target:{x:0,y:0}},t),this}get source(){return this.getSource()}set source(t){this.setSource(t)}getSource(){return this.getTerminal("source")}getSourceCellId(){return this.source.cell}getSourcePortId(){return this.source.port}setSource(t,e,i={}){return this.setTerminal("source",t,e,i)}get target(){return this.getTarget()}set target(t){this.setTarget(t)}getTarget(){return this.getTerminal("target")}getTargetCellId(){return this.target.cell}getTargetPortId(){return this.target.port}setTarget(t,e,i={}){return this.setTerminal("target",t,e,i)}getTerminal(t){return Object.assign({},this.store.get(t))}setTerminal(t,e,i,r={}){if(ae.isCell(e))return this.store.set(t,Di({},i,{cell:e.id}),r),this;const o=e;return Y.isPoint(e)||o.x!=null&&o.y!=null?(this.store.set(t,Di({},i,{x:o.x,y:o.y}),r),this):(this.store.set(t,gi(e),r),this)}getSourcePoint(){return this.getTerminalPoint("source")}getTargetPoint(){return this.getTerminalPoint("target")}getTerminalPoint(t){const e=this[t];if(Y.isPointLike(e))return Y.create(e);const i=this.getTerminalCell(t);return i?i.getConnectionPoint(this,t):new Y}getSourceCell(){return this.getTerminalCell("source")}getTargetCell(){return this.getTerminalCell("target")}getTerminalCell(t){if(this.model){const e=t==="source"?this.getSourceCellId():this.getTargetCellId();if(e)return this.model.getCell(e)}return null}getSourceNode(){return this.getTerminalNode("source")}getTargetNode(){return this.getTerminalNode("target")}getTerminalNode(t){let e=this;const i={};for(;e&&e.isEdge();){if(i[e.id])return null;i[e.id]=!0,e=e.getTerminalCell(t)}return e&&e.isNode()?e:null}get router(){return this.getRouter()}set router(t){t==null?this.removeRouter():this.setRouter(t)}getRouter(){return this.store.get("router")}setRouter(t,e,i){return typeof t=="object"?this.store.set("router",t,e):this.store.set("router",{name:t,args:e},i),this}removeRouter(t={}){return this.store.remove("router",t),this}get connector(){return this.getConnector()}set connector(t){t==null?this.removeConnector():this.setConnector(t)}getConnector(){return this.store.get("connector")}setConnector(t,e,i){return typeof t=="object"?this.store.set("connector",t,e):this.store.set("connector",{name:t,args:e},i),this}removeConnector(t={}){return this.store.remove("connector",t)}getDefaultLabel(){const t=this.constructor,e=this.store.get("defaultLabel")||t.defaultLabel||{};return gi(e)}get labels(){return this.getLabels()}set labels(t){this.setLabels(t)}getLabels(){return[...this.store.get("labels",[])].map(t=>this.parseLabel(t))}setLabels(t,e={}){return this.store.set("labels",Array.isArray(t)?t:[t],e),this}insertLabel(t,e,i={}){const r=this.getLabels(),o=r.length;let s=e!=null&&Number.isFinite(e)?e:o;return s<0&&(s=o+s+1),r.splice(s,0,this.parseLabel(t)),this.setLabels(r,i)}appendLabel(t,e={}){return this.insertLabel(t,-1,e)}getLabelAt(t){const e=this.getLabels();return t!=null&&Number.isFinite(t)?this.parseLabel(e[t]):null}setLabelAt(t,e,i={}){if(t!=null&&Number.isFinite(t)){const r=this.getLabels();r[t]=this.parseLabel(e),this.setLabels(r,i)}return this}removeLabelAt(t,e={}){const i=this.getLabels(),r=t!=null&&Number.isFinite(t)?t:-1,o=i.splice(r,1);return this.setLabels(i,e),o.length?o[0]:null}parseLabel(t){return typeof t=="string"?this.constructor.parseStringLabel(t):t}onLabelsChanged({previous:t,current:e}){const i=t&&e?e.filter(o=>t.find(s=>o===s||bs(o,s))?null:o):e?[...e]:[],r=t&&e?t.filter(o=>e.find(s=>o===s||bs(o,s))?null:o):t?[...t]:[];i.length>0&&this.notify("labels:added",{added:i,cell:this,edge:this}),r.length>0&&this.notify("labels:removed",{removed:r,cell:this,edge:this})}get vertices(){return this.getVertices()}set vertices(t){this.setVertices(t)}getVertices(){return[...this.store.get("vertices",[])]}setVertices(t,e={}){const i=Array.isArray(t)?t:[t];return this.store.set("vertices",i.map(r=>Y.toJSON(r)),e),this}insertVertex(t,e,i={}){const r=this.getVertices(),o=r.length;let s=e!=null&&Number.isFinite(e)?e:o;return s<0&&(s=o+s+1),r.splice(s,0,Y.toJSON(t)),this.setVertices(r,i)}appendVertex(t,e={}){return this.insertVertex(t,-1,e)}getVertexAt(t){return t!=null&&Number.isFinite(t)?this.getVertices()[t]:null}setVertexAt(t,e,i={}){if(t!=null&&Number.isFinite(t)){const r=this.getVertices();r[t]=e,this.setVertices(r,i)}return this}removeVertexAt(t,e={}){const i=this.getVertices(),r=t!=null&&Number.isFinite(t)?t:-1;return i.splice(r,1),this.setVertices(i,e)}onVertexsChanged({previous:t,current:e}){const i=t&&e?e.filter(o=>t.find(s=>Y.equals(o,s))?null:o):e?[...e]:[],r=t&&e?t.filter(o=>e.find(s=>Y.equals(o,s))?null:o):t?[...t]:[];i.length>0&&this.notify("vertexs:added",{added:i,cell:this,edge:this}),r.length>0&&this.notify("vertexs:removed",{removed:r,cell:this,edge:this})}getDefaultMarkup(){return this.store.get("defaultMarkup")||qe.getEdgeMarkup()}getMarkup(){return super.getMarkup()||this.getDefaultMarkup()}translate(t,e,i={}){return i.translateBy=i.translateBy||this.id,i.tx=t,i.ty=e,this.applyToPoints(r=>({x:(r.x||0)+t,y:(r.y||0)+e}),i)}scale(t,e,i,r={}){return this.applyToPoints(o=>Y.create(o).scale(t,e,i).toJSON(),r)}applyToPoints(t,e={}){const i={},r=this.getSource(),o=this.getTarget();Y.isPointLike(r)&&(i.source=t(r)),Y.isPointLike(o)&&(i.target=t(o));const s=this.getVertices();return s.length>0&&(i.vertices=s.map(t)),this.store.set(i,e),this}getBBox(){return this.getPolyline().bbox()}getConnectionPoint(){return this.getPolyline().pointAt(.5)}getPolyline(){const t=[this.getSourcePoint(),...this.getVertices().map(e=>Y.create(e)),this.getTargetPoint()];return new ki(t)}updateParent(t){let e=null;const i=this.getSourceCell(),r=this.getTargetCell(),o=this.getParent();return i&&r&&(i===r||i.isDescendantOf(r)?e=r:r.isDescendantOf(i)?e=i:e=ae.getCommonAncestor(i,r)),o&&e&&e.id!==o.id&&o.unembed(this,t),e&&(!o||o.id!==e.id)&&e.embed(this,t),e}hasLoop(t={}){const e=this.getSource(),i=this.getTarget(),r=e.cell,o=i.cell;if(!r||!o)return!1;let s=r===o;if(!s&&t.deep&&this._model){const a=this.getSourceCell(),l=this.getTargetCell();a&&l&&(s=a.isAncestorOf(l,t)||l.isAncestorOf(a,t))}return s}getFragmentAncestor(){const t=[this,this.getSourceNode(),this.getTargetNode()].filter(e=>e!=null);return this.getCommonAncestor(...t)}isFragmentDescendantOf(t){const e=this.getFragmentAncestor();return!!e&&(e.id===t.id||e.isDescendantOf(t))}};vi.defaults={};(function(n){function t(e,i){const r=e,o=i;return r.cell===o.cell?r.port===o.port||r.port==null&&o.port==null:!1}n.equalTerminals=t})(vi||(vi={}));(function(n){n.defaultLabel={markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}],attrs:{text:{fill:"#000",fontSize:14,textAnchor:"middle",textVerticalAnchor:"middle",pointerEvents:"none"},rect:{ref:"label",fill:"#fff",rx:3,ry:3,refWidth:1,refHeight:1,refX:0,refY:0}},position:{distance:.5}};function t(e){return{attrs:{label:{text:e}}}}n.parseStringLabel=t})(vi||(vi={}));(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const i=e[Symbol.toStringTag],r=e;return(i==null||i===n.toStringTag)&&typeof r.isNode=="function"&&typeof r.isEdge=="function"&&typeof r.prop=="function"&&typeof r.attr=="function"&&typeof r.disconnect=="function"&&typeof r.getSource=="function"&&typeof r.getTarget=="function"}n.isEdge=t})(vi||(vi={}));(function(n){n.registry=Oi.create({type:"edge",process(t,e){if(lu.exist(t,!1))throw new Error(`Edge with name '${t}' was registered by anthor Node`);if(typeof e=="function")return e.config({shape:t}),e;let i=n;const{inherit:r="edge"}=e,o=Gm(e,["inherit"]);if(typeof r=="string"){const a=this.get(r||"edge");a==null&&r?this.onNotFound(r,"inherited"):i=a}else i=r;o.constructorName==null&&(o.constructorName=t);const s=i.define.call(i,o);return s.config({shape:t}),s}}),lu.setEdgeRegistry(n.registry)})(vi||(vi={}));(function(n){let t=0;function e(o){return o?x1(o):(t+=1,`CustomEdge${t}`)}function i(o){const{constructorName:s,overwrite:a}=o,l=Gm(o,["constructorName","overwrite"]),h=_1(e(s||l.shape),this);return h.config(l),l.shape&&n.registry.register(l.shape,h,a),h}n.define=i;function r(o){const s=o.shape||"edge",a=n.registry.get(s);return a?new a(o):n.registry.onNotFound(s)}n.create=r})(vi||(vi={}));(function(n){const t="basic.edge";n.config({shape:t,propHooks(e){const{label:i,vertices:r}=e,o=Gm(e,["label","vertices"]);if(i){o.labels==null&&(o.labels=[]);const s=typeof i=="string"?n.parseStringLabel(i):i;o.labels.push(s)}return r&&Array.isArray(r)&&(o.vertices=r.map(s=>Y.create(s).toJSON())),o}}),n.registry.register(t,n)})(vi||(vi={}));var g6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o};class o_ extends ar{constructor(t,e={}){super(),this.length=0,this.comparator=e.comparator||"zIndex",this.clean(),t&&this.reset(t,{silent:!0})}toJSON(){return this.cells.map(t=>t.toJSON())}add(t,e,i){let r,o;typeof e=="number"?(r=e,o=Object.assign({merge:!1},i)):(r=this.length,o=Object.assign({merge:!1},e)),r>this.length&&(r=this.length),r<0&&(r+=this.length+1);const s=Array.isArray(t)?t:[t],a=this.comparator&&typeof e!="number"&&o.sort!==!1,l=this.comparator||null;let h=!1;const u=[],d=[];return s.forEach(c=>{const g=this.get(c);g?o.merge&&!c.isSameStore(g)&&(g.setProp(c.getProp(),i),d.push(g),a&&!h&&(l==null||typeof l=="function"?h=g.hasChanged():typeof l=="string"?h=g.hasChanged(l):h=l.some(f=>g.hasChanged(f)))):(u.push(c),this.reference(c))}),u.length&&(a&&(h=!0),this.cells.splice(r,0,...u),this.length=this.cells.length),h&&this.sort({silent:!0}),o.silent||(u.forEach((c,g)=>{const f={cell:c,index:r+g,options:o};this.trigger("added",f),o.dryrun||c.notify("added",Object.assign({},f))}),h&&this.trigger("sorted"),(u.length||d.length)&&this.trigger("updated",{added:u,merged:d,removed:[],options:o})),this}remove(t,e={}){const i=Array.isArray(t)?t:[t],r=this.removeCells(i,e);return!e.silent&&r.length>0&&this.trigger("updated",{options:e,removed:r,added:[],merged:[]}),Array.isArray(t)?r:r[0]}removeCells(t,e){const i=[];for(let r=0;r<t.length;r+=1){const o=this.get(t[r]);if(o==null)continue;const s=this.cells.indexOf(o);this.cells.splice(s,1),this.length-=1,delete this.map[o.id],i.push(o),this.unreference(o),e.dryrun||o.remove(),e.silent||(this.trigger("removed",{cell:o,index:s,options:e}),e.dryrun||o.notify("removed",{cell:o,index:s,options:e}))}return i}reset(t,e={}){const i=this.cells.slice();if(i.forEach(r=>this.unreference(r)),this.clean(),this.add(t,Object.assign({silent:!0},e)),!e.silent){const r=this.cells.slice();this.trigger("reseted",{options:e,previous:i,current:r});const o=[],s=[];r.forEach(a=>{i.some(h=>h.id===a.id)||o.push(a)}),i.forEach(a=>{r.some(h=>h.id===a.id)||s.push(a)}),this.trigger("updated",{options:e,added:o,removed:s,merged:[]})}return this}push(t,e){return this.add(t,this.length,e)}pop(t){const e=this.at(this.length-1);return this.remove(e,t)}unshift(t,e){return this.add(t,0,e)}shift(t){const e=this.at(0);return this.remove(e,t)}get(t){if(t==null)return null;const e=typeof t=="string"||typeof t=="number"?t:t.id;return this.map[e]||null}has(t){return this.get(t)!=null}at(t){return t<0&&(t+=this.length),this.cells[t]||null}first(){return this.at(0)}last(){return this.at(-1)}indexOf(t){return this.cells.indexOf(t)}toArray(){return this.cells.slice()}sort(t={}){return this.comparator!=null&&(this.cells=yz(this.cells,this.comparator),t.silent||this.trigger("sorted")),this}clone(){const t=this.constructor;return new t(this.cells.slice(),{comparator:this.comparator})}reference(t){this.map[t.id]=t,t.on("*",this.notifyCellEvent,this)}unreference(t){t.off("*",this.notifyCellEvent,this),delete this.map[t.id]}notifyCellEvent(t,e){const i=e.cell;this.trigger(`cell:${t}`,e),i&&(i.isNode()?this.trigger(`node:${t}`,Object.assign(Object.assign({},e),{node:i})):i.isEdge()&&this.trigger(`edge:${t}`,Object.assign(Object.assign({},e),{edge:i})))}clean(){this.length=0,this.cells=[],this.map={}}dispose(){this.reset([])}}g6([o_.dispose()],o_.prototype,"dispose",null);var f6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o};class to extends ar{get[Symbol.toStringTag](){return to.toStringTag}constructor(t=[]){super(),this.batches={},this.addings=new WeakMap,this.nodes={},this.edges={},this.outgoings={},this.incomings={},this.collection=new o_(t),this.setup()}notify(t,e){this.trigger(t,e);const i=this.graph;return i&&(t==="sorted"||t==="reseted"||t==="updated"?i.trigger(`model:${t}`,e):i.trigger(t,e)),this}setup(){const t=this.collection;t.on("sorted",()=>this.notify("sorted",null)),t.on("updated",e=>this.notify("updated",e)),t.on("cell:change:zIndex",()=>this.sortOnChangeZ()),t.on("added",({cell:e})=>{this.onCellAdded(e)}),t.on("removed",e=>{const i=e.cell;this.onCellRemoved(i,e.options),this.notify("cell:removed",e),i.isNode()?this.notify("node:removed",Object.assign(Object.assign({},e),{node:i})):i.isEdge()&&this.notify("edge:removed",Object.assign(Object.assign({},e),{edge:i}))}),t.on("reseted",e=>{this.onReset(e.current),this.notify("reseted",e)}),t.on("edge:change:source",({edge:e})=>this.onEdgeTerminalChanged(e,"source")),t.on("edge:change:target",({edge:e})=>{this.onEdgeTerminalChanged(e,"target")})}sortOnChangeZ(){this.collection.sort()}onCellAdded(t){const e=t.id;t.isEdge()?(t.updateParent(),this.edges[e]=!0,this.onEdgeTerminalChanged(t,"source"),this.onEdgeTerminalChanged(t,"target")):this.nodes[e]=!0}onCellRemoved(t,e){const i=t.id;if(t.isEdge()){delete this.edges[i];const r=t.getSource(),o=t.getTarget();if(r&&r.cell){const s=this.outgoings[r.cell],a=s?s.indexOf(i):-1;a>=0&&(s.splice(a,1),s.length===0&&delete this.outgoings[r.cell])}if(o&&o.cell){const s=this.incomings[o.cell],a=s?s.indexOf(i):-1;a>=0&&(s.splice(a,1),s.length===0&&delete this.incomings[o.cell])}}else delete this.nodes[i];e.clear||(e.disconnectEdges?this.disconnectConnectedEdges(t,e):this.removeConnectedEdges(t,e)),t.model===this&&(t.model=null)}onReset(t){this.nodes={},this.edges={},this.outgoings={},this.incomings={},t.forEach(e=>this.onCellAdded(e))}onEdgeTerminalChanged(t,e){const i=e==="source"?this.outgoings:this.incomings,r=t.previous(e);if(r&&r.cell){const s=ae.isCell(r.cell)?r.cell.id:r.cell,a=i[s],l=a?a.indexOf(t.id):-1;l>=0&&(a.splice(l,1),a.length===0&&delete i[s])}const o=t.getTerminal(e);if(o&&o.cell){const s=ae.isCell(o.cell)?o.cell.id:o.cell,a=i[s]||[];a.indexOf(t.id)===-1&&a.push(t.id),i[s]=a}}prepareCell(t,e){return!t.model&&(!e||!e.dryrun)&&(t.model=this),t.zIndex==null&&t.setZIndex(this.getMaxZIndex()+1,{silent:!0}),t}resetCells(t,e={}){return t.map(i=>this.prepareCell(i,Object.assign(Object.assign({},e),{dryrun:!0}))),this.collection.reset(t,e),t.map(i=>this.prepareCell(i,{options:e})),this}clear(t={}){const e=this.getCells();if(e.length===0)return this;const i=Object.assign(Object.assign({},t),{clear:!0});return this.batchUpdate("clear",()=>{const r=e.sort((o,s)=>{const a=o.isEdge()?1:2,l=s.isEdge()?1:2;return a-l});for(;r.length>0;){const o=r.shift();o&&o.remove(i)}},i),this}addNode(t,e={}){const i=Ui.isNode(t)?t:this.createNode(t);return this.addCell(i,e),i}updateNode(t,e={}){const i=this.createNode(t),r=i.getProp();return i.dispose(),this.updateCell(r,e)}createNode(t){return Ui.create(t)}addEdge(t,e={}){const i=vi.isEdge(t)?t:this.createEdge(t);return this.addCell(i,e),i}createEdge(t){return vi.create(t)}updateEdge(t,e={}){const i=this.createEdge(t),r=i.getProp();return i.dispose(),this.updateCell(r,e)}addCell(t,e={}){return Array.isArray(t)?this.addCells(t,e):(!this.collection.has(t)&&!this.addings.has(t)&&(this.addings.set(t,!0),this.collection.add(this.prepareCell(t,e),e),t.eachChild(i=>this.addCell(i,e)),this.addings.delete(t)),this)}addCells(t,e={}){const i=t.length;if(i===0)return this;const r=Object.assign(Object.assign({},e),{position:i-1,maxPosition:i-1});return this.startBatch("add",Object.assign(Object.assign({},r),{cells:t})),t.forEach(o=>{this.addCell(o,r),r.position-=1}),this.stopBatch("add",Object.assign(Object.assign({},r),{cells:t})),this}updateCell(t,e={}){const i=t.id&&this.getCell(t.id);return i?this.batchUpdate("update",()=>(Object.entries(t).forEach(([r,o])=>i.setProp(r,o,e)),!0),t):!1}removeCell(t,e={}){const i=typeof t=="string"?this.getCell(t):t;return i&&this.has(i)?this.collection.remove(i,e):null}updateCellId(t,e){if(t.id===e)return;this.startBatch("update",{id:e}),t.prop("id",e);const i=t.clone({keepId:!0});return this.addCell(i),this.getConnectedEdges(t).forEach(o=>{const s=o.getSourceCell(),a=o.getTargetCell();s===t&&o.setSource(Object.assign(Object.assign({},o.getSource()),{cell:e})),a===t&&o.setTarget(Object.assign(Object.assign({},o.getTarget()),{cell:e}))}),this.removeCell(t),this.stopBatch("update",{id:e}),i}removeCells(t,e={}){return t.length?this.batchUpdate("remove",()=>t.map(i=>this.removeCell(i,e))):[]}removeConnectedEdges(t,e={}){const i=this.getConnectedEdges(t);return i.forEach(r=>{r.remove(e)}),i}disconnectConnectedEdges(t,e={}){const i=typeof t=="string"?t:t.id;this.getConnectedEdges(t).forEach(r=>{const o=r.getSourceCellId(),s=r.getTargetCellId();o===i&&r.setSource({x:0,y:0},e),s===i&&r.setTarget({x:0,y:0},e)})}has(t){return this.collection.has(t)}total(){return this.collection.length}indexOf(t){return this.collection.indexOf(t)}getCell(t){return this.collection.get(t)}getCells(){return this.collection.toArray()}getFirstCell(){return this.collection.first()}getLastCell(){return this.collection.last()}getMinZIndex(){const t=this.collection.first();return t&&t.getZIndex()||0}getMaxZIndex(){const t=this.collection.last();return t&&t.getZIndex()||0}getCellsFromCache(t){return t?Object.keys(t).map(e=>this.getCell(e)).filter(e=>e!=null):[]}getNodes(){return this.getCellsFromCache(this.nodes)}getEdges(){return this.getCellsFromCache(this.edges)}getOutgoingEdges(t){const e=typeof t=="string"?t:t.id,i=this.outgoings[e];return i?i.map(r=>this.getCell(r)).filter(r=>r&&r.isEdge()):null}getIncomingEdges(t){const e=typeof t=="string"?t:t.id,i=this.incomings[e];return i?i.map(r=>this.getCell(r)).filter(r=>r&&r.isEdge()):null}getConnectedEdges(t,e={}){const i=[],r=typeof t=="string"?this.getCell(t):t;if(r==null)return i;const o={},s=e.indirect;let a=e.incoming,l=e.outgoing;a==null&&l==null&&(a=l=!0);const h=(u,d)=>{const c=d?this.getOutgoingEdges(u):this.getIncomingEdges(u);if(c?.forEach(g=>{o[g.id]||(i.push(g),o[g.id]=!0,s&&(a&&h(g,!1),l&&h(g,!0)))}),s&&u.isEdge()){const g=d?u.getTargetCell():u.getSourceCell();g&&g.isEdge()&&(o[g.id]||(i.push(g),h(g,d)))}};if(l&&h(r,!0),a&&h(r,!1),e.deep){const u=r.getDescendants({deep:!0}),d={};u.forEach(g=>{g.isNode()&&(d[g.id]=!0)});const c=(g,f)=>{const p=f?this.getOutgoingEdges(g.id):this.getIncomingEdges(g.id);p?.forEach(m=>{if(!o[m.id]){const v=m.getSourceCell(),b=m.getTargetCell();if(!e.enclosed&&v&&d[v.id]&&b&&d[b.id])return;i.push(m),o[m.id]=!0}})};u.forEach(g=>{g.isEdge()||(l&&c(g,!0),a&&c(g,!1))})}return i}isBoundary(t,e){const i=typeof t=="string"?this.getCell(t):t,r=e?this.getIncomingEdges(i):this.getOutgoingEdges(i);return r==null||r.length===0}getBoundaryNodes(t){const e=[];return Object.keys(this.nodes).forEach(i=>{if(this.isBoundary(i,t)){const r=this.getCell(i);r&&e.push(r)}}),e}getRoots(){return this.getBoundaryNodes(!0)}getLeafs(){return this.getBoundaryNodes(!1)}isRoot(t){return this.isBoundary(t,!0)}isLeaf(t){return this.isBoundary(t,!1)}getNeighbors(t,e={}){let i=e.incoming,r=e.outgoing;i==null&&r==null&&(i=r=!0);const s=this.getConnectedEdges(t,e).reduce((a,l)=>{const h=l.hasLoop(e),u=l.getSourceCell(),d=l.getTargetCell();return i&&u&&u.isNode()&&!a[u.id]&&(h||u!==t&&(!e.deep||!u.isDescendantOf(t)))&&(a[u.id]=u),r&&d&&d.isNode()&&!a[d.id]&&(h||d!==t&&(!e.deep||!d.isDescendantOf(t)))&&(a[d.id]=d),a},{});if(t.isEdge()){if(i){const a=t.getSourceCell();a&&a.isNode()&&!s[a.id]&&(s[a.id]=a)}if(r){const a=t.getTargetCell();a&&a.isNode()&&!s[a.id]&&(s[a.id]=a)}}return Object.keys(s).map(a=>s[a])}isNeighbor(t,e,i={}){let r=i.incoming,o=i.outgoing;return r==null&&o==null&&(r=o=!0),this.getConnectedEdges(t,i).some(s=>{const a=s.getSourceCell(),l=s.getTargetCell();return!!(r&&a&&a.id===e.id||o&&l&&l.id===e.id)})}getSuccessors(t,e={}){const i=[];return this.search(t,(r,o)=>{r!==t&&this.matchDistance(o,e.distance)&&i.push(r)},Object.assign(Object.assign({},e),{outgoing:!0})),i}isSuccessor(t,e,i={}){let r=!1;return this.search(t,(o,s)=>{if(o===e&&o!==t&&this.matchDistance(s,i.distance))return r=!0,!1},Object.assign(Object.assign({},i),{outgoing:!0})),r}getPredecessors(t,e={}){const i=[];return this.search(t,(r,o)=>{r!==t&&this.matchDistance(o,e.distance)&&i.push(r)},Object.assign(Object.assign({},e),{incoming:!0})),i}isPredecessor(t,e,i={}){let r=!1;return this.search(t,(o,s)=>{if(o===e&&o!==t&&this.matchDistance(s,i.distance))return r=!0,!1},Object.assign(Object.assign({},i),{incoming:!0})),r}matchDistance(t,e){return e==null?!0:typeof e=="function"?e(t):Array.isArray(e)&&e.includes(t)?!0:t===e}getCommonAncestor(...t){const e=[];return t.forEach(i=>{i&&(Array.isArray(i)?e.push(...i):e.push(i))}),ae.getCommonAncestor(...e)}getSubGraph(t,e={}){const i=[],r={},o=[],s=[],a=l=>{r[l.id]||(i.push(l),r[l.id]=l,l.isEdge()&&s.push(l),l.isNode()&&o.push(l))};return t.forEach(l=>{a(l),e.deep&&l.getDescendants({deep:!0}).forEach(u=>a(u))}),s.forEach(l=>{const h=l.getSourceCell(),u=l.getTargetCell();h&&!r[h.id]&&(i.push(h),r[h.id]=h,h.isNode()&&o.push(h)),u&&!r[u.id]&&(i.push(u),r[u.id]=u,u.isNode()&&o.push(u))}),o.forEach(l=>{this.getConnectedEdges(l,e).forEach(u=>{const d=u.getSourceCell(),c=u.getTargetCell();!r[u.id]&&d&&r[d.id]&&c&&r[c.id]&&(i.push(u),r[u.id]=u)})}),i}cloneSubGraph(t,e={}){const i=this.getSubGraph(t,e);return this.cloneCells(i)}cloneCells(t){return ae.cloneCells(t)}getNodesFromPoint(t,e){const i=typeof t=="number"?{x:t,y:e||0}:t;return this.getNodes().filter(r=>r.getBBox().containsPoint(i))}getNodesInArea(t,e,i,r,o){const s=typeof t=="number"?new vt(t,e,i,r):vt.create(t),a=typeof t=="number"?o:e,l=a&&a.strict;return this.getNodes().filter(h=>{const u=h.getBBox();return l?s.containsRect(u):s.isIntersectWithRect(u)})}getEdgesInArea(t,e,i,r,o){const s=typeof t=="number"?new vt(t,e,i,r):vt.create(t),a=typeof t=="number"?o:e,l=a&&a.strict;return this.getEdges().filter(h=>{const u=h.getBBox();return u.width===0?u.inflate(1,0):u.height===0&&u.inflate(0,1),l?s.containsRect(u):s.isIntersectWithRect(u)})}getNodesUnderNode(t,e={}){const i=t.getBBox();return(e.by==null||e.by==="bbox"?this.getNodesInArea(i):this.getNodesFromPoint(i[e.by])).filter(o=>t.id!==o.id&&!o.isDescendantOf(t))}getAllCellsBBox(){return this.getCellsBBox(this.getCells())}getCellsBBox(t,e={}){return ae.getCellsBBox(t,e)}search(t,e,i={}){i.breadthFirst?this.breadthFirstSearch(t,e,i):this.depthFirstSearch(t,e,i)}breadthFirstSearch(t,e,i={}){const r=[],o={},s={};for(r.push(t),s[t.id]=0;r.length>0;){const a=r.shift();if(a==null||o[a.id]||(o[a.id]=!0,Nt(e,this,a,s[a.id])===!1))continue;this.getNeighbors(a,i).forEach(h=>{s[h.id]=s[a.id]+1,r.push(h)})}}depthFirstSearch(t,e,i={}){const r=[],o={},s={};for(r.push(t),s[t.id]=0;r.length>0;){const a=r.pop();if(a==null||o[a.id]||(o[a.id]=!0,Nt(e,this,a,s[a.id])===!1))continue;const l=this.getNeighbors(a,i),h=r.length;l.forEach(u=>{s[u.id]=s[a.id]+1,r.splice(h,0,u)})}}getShortestPath(t,e,i={}){const r={};this.getEdges().forEach(h=>{const u=h.getSourceCellId(),d=h.getTargetCellId();u&&d&&(r[u]||(r[u]=[]),r[d]||(r[d]=[]),r[u].push(d),i.directed||r[d].push(u))});const o=typeof t=="string"?t:t.id,s=t_.run(r,o,i.weight),a=[];let l=typeof e=="string"?e:e.id;for(s[l]&&a.push(l);l=s[l];)a.unshift(l);return a}translate(t,e,i){return this.getCells().filter(r=>!r.hasParent()).forEach(r=>r.translate(t,e,i)),this}resize(t,e,i){return this.resizeCells(t,e,this.getCells(),i)}resizeCells(t,e,i,r={}){const o=this.getCellsBBox(i);if(o){const s=Math.max(t/o.width,0),a=Math.max(e/o.height,0),l=o.getOrigin();i.forEach(h=>h.scale(s,a,l,r))}return this}toJSON(t={}){return to.toJSON(this.getCells(),t)}parseJSON(t){return to.fromJSON(t)}fromJSON(t,e={}){const i=this.parseJSON(t);return this.resetCells(i,e),this}startBatch(t,e={}){return this.batches[t]=(this.batches[t]||0)+1,this.notify("batch:start",{name:t,data:e}),this}stopBatch(t,e={}){return this.batches[t]=(this.batches[t]||0)-1,this.notify("batch:stop",{name:t,data:e}),this}batchUpdate(t,e,i={}){this.startBatch(t,i);const r=e();return this.stopBatch(t,i),r}hasActiveBatch(t=Object.keys(this.batches)){return(Array.isArray(t)?t:[t]).some(i=>this.batches[i]>0)}dispose(){this.collection.dispose()}}f6([to.dispose()],to.prototype,"dispose",null);(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const i=e[Symbol.toStringTag],r=e;return(i==null||i===n.toStringTag)&&typeof r.addNode=="function"&&typeof r.addEdge=="function"&&r.collection!=null}n.isModel=t})(to||(to={}));(function(n){function t(i,r={}){return{cells:i.map(o=>o.toJSON(r))}}n.toJSON=t;function e(i){const r=[];return Array.isArray(i)?r.push(...i):(i.cells&&r.push(...i.cells),i.nodes&&i.nodes.forEach(o=>{o.shape==null&&(o.shape="rect"),r.push(o)}),i.edges&&i.edges.forEach(o=>{o.shape==null&&(o.shape="edge"),r.push(o)})),r.map(o=>{const s=o.shape;if(s){if(Ui.registry.exist(s))return Ui.create(o);if(vi.registry.exist(s))return vi.create(o)}throw new Error("The `shape` should be specified when creating a node/edge instance")})}n.fromJSON=e})(to||(to={}));var p6=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};let ga=class extends Ui{get label(){return this.getLabel()}set label(t){this.setLabel(t)}getLabel(){return this.getAttrByPath("text/text")}setLabel(t,e){return t==null?this.removeLabel():this.setAttrByPath("text/text",t,e),this}removeLabel(){return this.removeAttrByPath("text/text"),this}};(function(n){n.bodyAttr={fill:"#ffffff",stroke:"#333333",strokeWidth:2},n.labelAttr={fontSize:14,fill:"#000000",refX:.5,refY:.5,textAnchor:"middle",textVerticalAnchor:"middle",fontFamily:"Arial, helvetica, sans-serif"},n.config({attrs:{text:Object.assign({},n.labelAttr)},propHooks(t){const{label:e}=t,i=p6(t,["label"]);return e&&ku(i,"attrs/text/text",e),i},visible:!0})})(ga||(ga={}));var m6=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};function v6(n,t="body"){return[{tagName:n,selector:t},{tagName:"text",selector:"label"}]}function b6(n="xlink:href"){return e=>{const{imageUrl:i,imageWidth:r,imageHeight:o}=e,s=m6(e,["imageUrl","imageWidth","imageHeight"]);if(i!=null||r!=null||o!=null){const a=()=>{if(s.attrs){const l=s.attrs.image;i!=null&&(l[n]=i),r!=null&&(l.width=r),o!=null&&(l.height=o),s.attrs.image=l}};s.attrs?(s.attrs.image==null&&(s.attrs.image={}),a()):(s.attrs={image:{}},a())}return s}}function Lu(n,t,e={}){const i={constructorName:n,markup:v6(n,e.selector),attrs:{[n]:Object.assign({},ga.bodyAttr)}};return(e.parent||ga).define(Di(i,t,{shape:n}))}Lu("rect",{attrs:{body:{refWidth:"100%",refHeight:"100%"}}});const y6=vi.define({shape:"edge",markup:[{tagName:"path",selector:"wrap",groupSelector:"lines",attrs:{fill:"none",cursor:"pointer",stroke:"transparent",strokeLinecap:"round"}},{tagName:"path",selector:"line",groupSelector:"lines",attrs:{fill:"none",pointerEvents:"none"}}],attrs:{lines:{connection:!0,strokeLinejoin:"round"},wrap:{strokeWidth:10},line:{stroke:"#333",strokeWidth:2,targetMarker:"classic"}}});Lu("ellipse",{attrs:{body:{refCx:"50%",refCy:"50%",refRx:"50%",refRy:"50%"}}});var C6=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};class hu extends ga{get points(){return this.getPoints()}set points(t){this.setPoints(t)}getPoints(){return this.getAttrByPath("body/refPoints")}setPoints(t,e){return t==null?this.removePoints():this.setAttrByPath("body/refPoints",hu.pointsToString(t),e),this}removePoints(){return this.removeAttrByPath("body/refPoints"),this}}(function(n){function t(e){return typeof e=="string"?e:e.map(i=>Array.isArray(i)?i.join(","):Y.isPointLike(i)?`${i.x}, ${i.y}`:"").join(" ")}n.pointsToString=t,n.config({propHooks(e){const{points:i}=e,r=C6(e,["points"]);if(i){const o=t(i);o&&ku(r,"attrs/body/refPoints",o)}return r}})})(hu||(hu={}));Lu("polygon",{},{parent:hu});Lu("polyline",{},{parent:hu});var _6=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};ga.define({shape:"path",markup:[{tagName:"rect",selector:"bg"},{tagName:"path",selector:"body"},{tagName:"text",selector:"label"}],attrs:{bg:{refWidth:"100%",refHeight:"100%",fill:"none",stroke:"none",pointerEvents:"all"},body:{fill:"none",stroke:"#000",strokeWidth:2}},propHooks(n){const{path:t}=n,e=_6(n,["path"]);return t&&ku(e,"attrs/body/refD",t),e}});var w6=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};ga.define({shape:"text-block",markup:[{tagName:"rect",selector:"body"},la.SUPPORT_FOREIGNOBJECT?{tagName:"foreignObject",selector:"foreignObject",children:[{tagName:"div",ns:Yi.xhtml,selector:"label",style:{width:"100%",height:"100%",position:"static",backgroundColor:"transparent",textAlign:"center",margin:0,padding:"0px 5px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center"}}]}:{tagName:"text",selector:"label",attrs:{textAnchor:"middle"}}],attrs:{body:Object.assign(Object.assign({},ga.bodyAttr),{refWidth:"100%",refHeight:"100%"}),foreignObject:{refWidth:"100%",refHeight:"100%"},label:{style:{fontSize:14}}},propHooks(n){const{text:t}=n,e=w6(n,["text"]);return t&&ku(e,"attrs/label/text",t),e},attrHooks:{text:{set(n,{cell:t,view:e,refBBox:i,elem:r,attrs:o}){if(r instanceof HTMLElement)r.textContent=n;else{const s=o.style||{},a={text:n,width:-5,height:"100%"},l=Object.assign({textVerticalAnchor:"middle"},s),h=Do.presets.textWrap;return Nt(h.set,this,a,{cell:t,view:e,elem:r,refBBox:i,attrs:l}),{fill:s.color||null}}},position(n,{refBBox:t,elem:e}){if(e instanceof SVGElement)return t.getCenter()}}}});Lu("image",{attrs:{image:{refWidth:"100%",refHeight:"100%"}},propHooks:b6()},{selector:"image"});Lu("circle",{attrs:{body:{refCx:"50%",refCy:"50%",refR:"50%"}}});class oo extends Ei{constructor(){super(...arguments),this.portsCache={}}get[Symbol.toStringTag](){return oo.toStringTag}getContainerClassName(){const t=[super.getContainerClassName(),this.prefixClassName("node")];return this.can("nodeMovable")||t.push(this.prefixClassName("node-immovable")),t.join(" ")}updateClassName(t){const e=t.target;if(e.hasAttribute("magnet")){const i=this.prefixClassName("port-unconnectable");this.can("magnetConnectable")?kr(e,i):we(e,i)}else{const i=this.prefixClassName("node-immovable");this.can("nodeMovable")?this.removeClass(i):this.addClass(i)}}isNodeView(){return!0}confirmUpdate(t,e={}){let i=t;return this.hasAction(i,"ports")&&(this.removePorts(),this.cleanPortsCache()),this.hasAction(i,"render")?(this.render(),i=this.removeAction(i,["render","update","resize","translate","rotate","ports","tools"])):(i=this.handleAction(i,"resize",()=>this.resize(),"update"),i=this.handleAction(i,"update",()=>this.update(),"ports"),i=this.handleAction(i,"translate",()=>this.translate()),i=this.handleAction(i,"rotate",()=>this.rotate()),i=this.handleAction(i,"ports",()=>this.renderPorts()),i=this.handleAction(i,"tools",()=>{this.getFlag("tools")===t?this.renderTools():this.updateTools(e)})),i}update(t){this.cleanCache(),this.removePorts();const e=this.cell,i=e.getSize(),r=e.getAttrs();this.updateAttrs(this.container,r,{attrs:t===r?null:t,rootBBox:new vt(0,0,i.width,i.height),selectors:this.selectors}),this.renderPorts()}renderMarkup(){const t=this.cell.markup;if(t){if(typeof t=="string")throw new TypeError("Not support string markup.");return this.renderJSONMarkup(t)}throw new TypeError("Invalid node markup.")}renderJSONMarkup(t){const e=this.parseJSONMarkup(t,this.container);this.selectors=e.selectors,this.container.appendChild(e.fragment)}render(){return this.empty(),this.renderMarkup(),this.resize(),this.updateTransform(),this.renderTools(),this}resize(){this.cell.getAngle()&&this.rotate(),this.update()}translate(){this.updateTransform()}rotate(){this.updateTransform()}getTranslationString(){const t=this.cell.getPosition();return`translate(${t.x},${t.y})`}getRotationString(){const t=this.cell.getAngle();if(t){const e=this.cell.getSize();return`rotate(${t},${e.width/2},${e.height/2})`}}updateTransform(){let t=this.getTranslationString();const e=this.getRotationString();e&&(t+=` ${e}`),this.container.setAttribute("transform",t)}findPortElem(t,e){const i=t?this.portsCache[t]:null;if(!i)return null;const r=i.portContentElement,o=i.portContentSelectors||{};return this.findOne(e,r,o)}cleanPortsCache(){this.portsCache={}}removePorts(){Object.values(this.portsCache).forEach(t=>{qh(t.portElement)})}renderPorts(){const t=this.container,e=[];t.childNodes.forEach(s=>{e.push(s)});const i=this.cell.getParsedPorts(),r=yS(i,"zIndex"),o="auto";r[o]&&r[o].forEach(s=>{const a=this.getPortElement(s);t.append(a),e.push(a)}),Object.keys(r).forEach(s=>{if(s!==o){const a=parseInt(s,10);this.appendPorts(r[s],a,e)}}),this.updatePorts()}appendPorts(t,e,i){const r=t.map(o=>this.getPortElement(o));i[e]||e<0?k1(i[Math.max(e,0)],r):Jc(this.container,r)}getPortElement(t){const e=this.portsCache[t.id];return e?e.portElement:this.createPortElement(t)}createPortElement(t){let e=qe.renderMarkup(this.cell.getPortContainerMarkup());const i=e.elem;if(i==null)throw new Error("Invalid port container markup.");e=qe.renderMarkup(this.getPortMarkup(t));const r=e.elem,o=e.selectors;if(r==null)throw new Error("Invalid port markup.");this.setAttrs({port:t.id,"port-group":t.group},r);let s="x6-port";t.group&&(s+=` x6-port-${t.group}`),we(i,s),we(i,"x6-port"),we(r,"x6-port-body"),i.appendChild(r);let a=o,l,h;if(this.existPortLabel(t)){if(e=qe.renderMarkup(this.getPortLabelMarkup(t.label)),l=e.elem,h=e.selectors,l==null)throw new Error("Invalid port label markup.");if(o&&h){for(const d in h)if(o[d]&&d!==this.rootSelector)throw new Error("Selectors within port must be unique.");a=Object.assign(Object.assign({},o),h)}we(l,"x6-port-label"),i.appendChild(l)}return this.portsCache[t.id]={portElement:i,portSelectors:a,portLabelElement:l,portLabelSelectors:h,portContentElement:r,portContentSelectors:o},this.graph.options.onPortRendered&&this.graph.options.onPortRendered({port:t,node:this.cell,container:i,selectors:a,labelContainer:l,labelSelectors:h,contentContainer:r,contentSelectors:o}),i}updatePorts(){const t=this.cell.getParsedGroups(),e=Object.keys(t);e.length===0?this.updatePortGroup():e.forEach(i=>this.updatePortGroup(i))}updatePortGroup(t){const e=vt.fromSize(this.cell.getSize()),i=this.cell.getPortsLayoutByGroup(t,e);for(let r=0,o=i.length;r<o;r+=1){const s=i[r],a=s.portId,l=this.portsCache[a]||{},h=s.portLayout;if(this.applyPortTransform(l.portElement,h),s.portAttrs!=null){const d={selectors:l.portSelectors||{}};s.portSize&&(d.rootBBox=vt.fromSize(s.portSize)),this.updateAttrs(l.portElement,s.portAttrs,d)}const u=s.labelLayout;if(u&&l.portLabelElement&&(this.applyPortTransform(l.portLabelElement,u,-(h.angle||0)),u.attrs)){const d={selectors:l.portLabelSelectors||{}};s.labelSize&&(d.rootBBox=vt.fromSize(s.labelSize)),this.updateAttrs(l.portLabelElement,u.attrs,d)}}}applyPortTransform(t,e,i=0){const r=e.angle,o=e.position,s=Ji().rotate(i).translate(o.x||0,o.y||0).rotate(r||0);Kh(t,s,{absolute:!0})}getPortMarkup(t){return t.markup||this.cell.portMarkup}getPortLabelMarkup(t){return t.markup||this.cell.portLabelMarkup}existPortLabel(t){return t.attrs&&t.attrs.text}getEventArgs(t,e,i){const r=this,o=r.cell,s=o;return e==null||i==null?{e:t,view:r,node:o,cell:s}:{e:t,x:e,y:i,view:r,node:o,cell:s}}getPortEventArgs(t,e,i){const r=this,o=r.cell,s=o;return i?{e:t,x:i.x,y:i.y,view:r,node:o,cell:s,port:e}:{e:t,view:r,node:o,cell:s,port:e}}notifyMouseDown(t,e,i){super.onMouseDown(t,e,i),this.notify("node:mousedown",this.getEventArgs(t,e,i))}notifyMouseMove(t,e,i){super.onMouseMove(t,e,i),this.notify("node:mousemove",this.getEventArgs(t,e,i))}notifyMouseUp(t,e,i){super.onMouseUp(t,e,i),this.notify("node:mouseup",this.getEventArgs(t,e,i))}notifyPortEvent(t,e,i){const r=this.findAttr("port",e.target);if(r){const o=e.type;t==="node:port:mouseenter"?e.type="mouseenter":t==="node:port:mouseleave"&&(e.type="mouseleave"),this.notify(t,this.getPortEventArgs(e,r,i)),e.type=o}}onClick(t,e,i){super.onClick(t,e,i),this.notify("node:click",this.getEventArgs(t,e,i)),this.notifyPortEvent("node:port:click",t,{x:e,y:i})}onDblClick(t,e,i){super.onDblClick(t,e,i),this.notify("node:dblclick",this.getEventArgs(t,e,i)),this.notifyPortEvent("node:port:dblclick",t,{x:e,y:i})}onContextMenu(t,e,i){super.onContextMenu(t,e,i),this.notify("node:contextmenu",this.getEventArgs(t,e,i)),this.notifyPortEvent("node:port:contextmenu",t,{x:e,y:i})}onMouseDown(t,e,i){this.isPropagationStopped(t)||(this.notifyMouseDown(t,e,i),this.notifyPortEvent("node:port:mousedown",t,{x:e,y:i}),this.startNodeDragging(t,e,i))}onMouseMove(t,e,i){const r=this.getEventData(t),o=r.action;if(o==="magnet")this.dragMagnet(t,e,i);else{if(o==="move"){const a=r.targetView||this;a.dragNode(t,e,i),a.notify("node:moving",{e:t,x:e,y:i,view:a,cell:a.cell,node:a.cell})}this.notifyMouseMove(t,e,i),this.notifyPortEvent("node:port:mousemove",t,{x:e,y:i})}this.setEventData(t,r)}onMouseUp(t,e,i){const r=this.getEventData(t),o=r.action;o==="magnet"?this.stopMagnetDragging(t,e,i):(this.notifyMouseUp(t,e,i),this.notifyPortEvent("node:port:mouseup",t,{x:e,y:i}),o==="move"&&(r.targetView||this).stopNodeDragging(t,e,i));const s=r.targetMagnet;s&&this.onMagnetClick(t,s,e,i),this.checkMouseleave(t)}onMouseOver(t){super.onMouseOver(t),this.notify("node:mouseover",this.getEventArgs(t)),this.notifyPortEvent("node:port:mouseenter",t),this.notifyPortEvent("node:port:mouseover",t)}onMouseOut(t){super.onMouseOut(t),this.notify("node:mouseout",this.getEventArgs(t)),this.notifyPortEvent("node:port:mouseleave",t),this.notifyPortEvent("node:port:mouseout",t)}onMouseEnter(t){this.updateClassName(t),super.onMouseEnter(t),this.notify("node:mouseenter",this.getEventArgs(t))}onMouseLeave(t){super.onMouseLeave(t),this.notify("node:mouseleave",this.getEventArgs(t))}onMouseWheel(t,e,i,r){super.onMouseWheel(t,e,i,r),this.notify("node:mousewheel",Object.assign({delta:r},this.getEventArgs(t,e,i)))}onMagnetClick(t,e,i,r){const o=this.graph;o.view.getMouseMovedCount(t)>o.options.clickThreshold||this.notify("node:magnet:click",Object.assign({magnet:e},this.getEventArgs(t,i,r)))}onMagnetDblClick(t,e,i,r){this.notify("node:magnet:dblclick",Object.assign({magnet:e},this.getEventArgs(t,i,r)))}onMagnetContextMenu(t,e,i,r){this.notify("node:magnet:contextmenu",Object.assign({magnet:e},this.getEventArgs(t,i,r)))}onMagnetMouseDown(t,e,i,r){this.startMagnetDragging(t,i,r)}onCustomEvent(t,e,i,r){this.notify("node:customevent",Object.assign({name:e},this.getEventArgs(t,i,r))),super.onCustomEvent(t,e,i,r)}prepareEmbedding(t){const e=this.graph,r=this.getEventData(t).cell||this.cell,o=e.findViewByCell(r),s=e.snapToGrid(t.clientX,t.clientY);this.notify("node:embed",{e:t,node:r,view:o,cell:r,x:s.x,y:s.y,currentParent:r.getParent()})}processEmbedding(t,e){const i=e.cell||this.cell,r=e.graph||this.graph,o=r.options.embedding,s=o.findParent;let a=typeof s=="function"?Nt(s,r,{view:this,node:this.cell}).filter(c=>ae.isCell(c)&&this.cell.id!==c.id&&!c.isDescendantOf(this.cell)):r.model.getNodesUnderNode(i,{by:s});if(o.frontOnly&&a.length>0){const c=yS(a,"zIndex"),g=Cz(Object.keys(c).map(f=>parseInt(f,10)));g&&(a=c[g])}a=a.filter(c=>c.visible);let l=null;const h=e.candidateEmbedView,u=o.validate;for(let c=a.length-1;c>=0;c-=1){const g=a[c];if(h&&h.cell.id===g.id){l=h;break}else{const f=g.findView(r);if(u&&Nt(u,r,{child:this.cell,parent:f.cell,childView:this,parentView:f})){l=f;break}}}this.clearEmbedding(e),l&&l.highlight(null,{type:"embedding"}),e.candidateEmbedView=l;const d=r.snapToGrid(t.clientX,t.clientY);this.notify("node:embedding",{e:t,cell:i,node:i,view:r.findViewByCell(i),x:d.x,y:d.y,currentParent:i.getParent(),candidateParent:l?l.cell:null})}clearEmbedding(t){const e=t.candidateEmbedView;e&&(e.unhighlight(null,{type:"embedding"}),t.candidateEmbedView=null)}finalizeEmbedding(t,e){this.graph.startBatch("embedding");const i=e.cell||this.cell,r=e.graph||this.graph,o=r.findViewByCell(i),s=i.getParent(),a=e.candidateEmbedView;if(a?(a.unhighlight(null,{type:"embedding"}),e.candidateEmbedView=null,(s==null||s.id!==a.cell.id)&&a.cell.insertChild(i,void 0,{ui:!0})):s&&s.unembed(i,{ui:!0}),r.model.getConnectedEdges(i,{deep:!0}).forEach(l=>{l.updateParent({ui:!0})}),o&&a){const l=r.snapToGrid(t.clientX,t.clientY);o.notify("node:embedded",{e:t,cell:i,x:l.x,y:l.y,node:i,view:r.findViewByCell(i),previousParent:s,currentParent:i.getParent()})}this.graph.stopBatch("embedding")}getDelegatedView(){let t=this.cell,e=this;for(;e&&!t.isEdge();){if(!t.hasParent()||e.can("stopDelegateOnDragging"))return e;t=t.getParent(),e=this.graph.findViewByCell(t)}return null}validateMagnet(t,e,i){if(e.getAttribute("magnet")!=="passive"){const r=this.graph.options.connecting.validateMagnet;return r?Nt(r,this.graph,{e:i,magnet:e,view:t,cell:t.cell}):!0}return!1}startMagnetDragging(t,e,i){if(!this.can("magnetConnectable"))return;t.stopPropagation();const r=t.currentTarget,o=this.graph;this.setEventData(t,{targetMagnet:r}),this.validateMagnet(this,r,t)?(o.options.magnetThreshold<=0&&this.startConnectting(t,r,e,i),this.setEventData(t,{action:"magnet"}),this.stopPropagation(t)):this.onMouseDown(t,e,i),o.view.delegateDragEvents(t,this)}startConnectting(t,e,i,r){this.graph.model.startBatch("add-edge");const o=this.createEdgeFromMagnet(e,i,r);o.setEventData(t,o.prepareArrowheadDragging("target",{x:i,y:r,isNewEdge:!0,fallbackAction:"remove"})),this.setEventData(t,{edgeView:o}),o.notifyMouseDown(t,i,r)}getDefaultEdge(t,e){let i;const r=this.graph.options.connecting.createEdge;return r&&(i=Nt(r,this.graph,{sourceMagnet:e,sourceView:t,sourceCell:t.cell})),i}createEdgeFromMagnet(t,e,i){const r=this.graph,o=r.model,s=this.getDefaultEdge(this,t);return s.setSource(Object.assign(Object.assign({},s.getSource()),this.getEdgeTerminal(t,e,i,s,"source"))),s.setTarget(Object.assign(Object.assign({},s.getTarget()),{x:e,y:i})),s.addTo(o,{async:!1,ui:!0}),s.findView(r)}dragMagnet(t,e,i){const r=this.getEventData(t),o=r.edgeView;if(o)o.onMouseMove(t,e,i),this.autoScrollGraph(t.clientX,t.clientY);else{const s=this.graph,a=s.options.magnetThreshold,l=this.getEventTarget(t),h=r.targetMagnet;if(a==="onleave"){if(h===l||h.contains(l))return}else if(s.view.getMouseMovedCount(t)<=a)return;this.startConnectting(t,h,e,i)}}stopMagnetDragging(t,e,i){const o=this.eventData(t).edgeView;o&&(o.onMouseUp(t,e,i),this.graph.model.stopBatch("add-edge"))}notifyUnhandledMouseDown(t,e,i){this.notify("node:unhandled:mousedown",{e:t,x:e,y:i,view:this,cell:this.cell,node:this.cell})}notifyNodeMove(t,e,i,r,o){let s=[o];const a=this.graph.getPlugin("selection");if(a&&a.isSelectionMovable()){const l=a.getSelectedCells();l.includes(o)&&(s=l.filter(h=>h.isNode()))}s.forEach(l=>{this.notify(t,{e,x:i,y:r,cell:l,node:l,view:l.findView(this.graph)})})}getRestrictArea(t){const e=this.graph.options.translating.restrict,i=typeof e=="function"?Nt(e,this.graph,t):e;return typeof i=="number"?this.graph.transform.getGraphArea().inflate(i):i===!0?this.graph.transform.getGraphArea():i||null}startNodeDragging(t,e,i){const r=this.getDelegatedView();if(r==null||!r.can("nodeMovable"))return this.notifyUnhandledMouseDown(t,e,i);this.setEventData(t,{targetView:r,action:"move"});const o=Y.create(r.cell.getPosition());r.setEventData(t,{moving:!1,offset:o.diff(e,i),restrict:this.getRestrictArea(r)})}dragNode(t,e,i){const r=this.cell,o=this.graph,s=o.getGridSize(),a=this.getEventData(t),l=a.offset,h=a.restrict;a.moving||(a.moving=!0,this.addClass("node-moving"),this.notifyNodeMove("node:move",t,e,i,this.cell)),this.autoScrollGraph(t.clientX,t.clientY);const u=Ne.snapToGrid(e+l.x,s),d=Ne.snapToGrid(i+l.y,s);r.setPosition(u,d,{restrict:h,deep:!0,ui:!0}),o.options.embedding.enabled&&(a.embedding||(this.prepareEmbedding(t),a.embedding=!0),this.processEmbedding(t,a))}stopNodeDragging(t,e,i){const r=this.getEventData(t);r.embedding&&this.finalizeEmbedding(t,r),r.moving&&(this.removeClass("node-moving"),this.notifyNodeMove("node:moved",t,e,i,this.cell)),r.moving=!1,r.embedding=!1}autoScrollGraph(t,e){const i=this.graph.getPlugin("scroller");i&&i.autoScroll(t,e)}}(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const i=e[Symbol.toStringTag],r=e;return(i==null||i===n.toStringTag)&&typeof r.isNodeView=="function"&&typeof r.isEdgeView=="function"&&typeof r.confirmUpdate=="function"&&typeof r.update=="function"&&typeof r.findPortElem=="function"&&typeof r.resize=="function"&&typeof r.rotate=="function"&&typeof r.translate=="function"}n.isNodeView=t})(oo||(oo={}));oo.config({isSvgElement:!0,priority:0,bootstrap:["render"],actions:{view:["render"],markup:["render"],attrs:["update"],size:["resize","ports","tools"],angle:["rotate","tools"],position:["translate","tools"],ports:["ports"],tools:["tools"]}});oo.registry.register("node",oo,!0);var x6=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};class Ts extends Ei{constructor(){super(...arguments),this.POINT_ROUNDING=2,this.labelDestroyFn={}}get[Symbol.toStringTag](){return Ts.toStringTag}getContainerClassName(){return[super.getContainerClassName(),this.prefixClassName("edge")].join(" ")}get sourceBBox(){const t=this.sourceView;if(!t){const i=this.cell.getSource();return new vt(i.x,i.y)}const e=this.sourceMagnet;return t.isEdgeElement(e)?new vt(this.sourceAnchor.x,this.sourceAnchor.y):t.getBBoxOfElement(e||t.container)}get targetBBox(){const t=this.targetView;if(!t){const i=this.cell.getTarget();return new vt(i.x,i.y)}const e=this.targetMagnet;return t.isEdgeElement(e)?new vt(this.targetAnchor.x,this.targetAnchor.y):t.getBBoxOfElement(e||t.container)}isEdgeView(){return!0}confirmUpdate(t,e={}){let i=t;if(this.hasAction(i,"source")){if(!this.updateTerminalProperties("source"))return i;i=this.removeAction(i,"source")}if(this.hasAction(i,"target")){if(!this.updateTerminalProperties("target"))return i;i=this.removeAction(i,"target")}return this.hasAction(i,"render")?(this.render(),i=this.removeAction(i,["render","update","labels","tools"]),i):(i=this.handleAction(i,"update",()=>this.update(e)),i=this.handleAction(i,"labels",()=>this.onLabelsChange(e)),i=this.handleAction(i,"tools",()=>this.renderTools()),i)}render(){return this.empty(),this.renderMarkup(),this.labelContainer=null,this.renderLabels(),this.update(),this.renderTools(),this}renderMarkup(){const t=this.cell.markup;if(t){if(typeof t=="string")throw new TypeError("Not support string markup.");return this.renderJSONMarkup(t)}throw new TypeError("Invalid edge markup.")}renderJSONMarkup(t){const e=this.parseJSONMarkup(t,this.container);this.selectors=e.selectors,this.container.append(e.fragment)}customizeLabels(){if(this.labelContainer){const t=this.cell,e=t.labels;for(let i=0,r=e.length;i<r;i+=1){const o=e[i],s=this.labelCache[i],a=this.labelSelectors[i],l=this.graph.options.onEdgeLabelRendered;if(l){const h=l({edge:t,label:o,container:s,selectors:a});h&&(this.labelDestroyFn[i]=h)}}}}destroyCustomizeLabels(){const t=this.cell.labels;if(this.labelCache&&this.labelSelectors&&this.labelDestroyFn)for(let e=0,i=t.length;e<i;e+=1){const r=this.labelDestroyFn[e],o=this.labelCache[e],s=this.labelSelectors[e];r&&o&&s&&r({edge:this.cell,label:t[e],container:o,selectors:s})}this.labelDestroyFn={}}renderLabels(){const t=this.cell,e=t.getLabels(),i=e.length;let r=this.labelContainer;if(this.labelCache={},this.labelSelectors={},i<=0)return r&&r.parentNode&&r.parentNode.removeChild(r),this;r?this.empty(r):(r=uo("g"),this.addClass(this.prefixClassName("edge-labels"),r),this.labelContainer=r);for(let o=0,s=e.length;o<s;o+=1){const a=e[o],l=this.normalizeLabelMarkup(this.parseLabelMarkup(a.markup));let h,u;if(l)h=l.node,u=l.selectors;else{const c=t.getDefaultLabel(),g=this.normalizeLabelMarkup(this.parseLabelMarkup(c.markup));h=g.node,u=g.selectors}h.setAttribute("data-index",`${o}`),r.appendChild(h);const d=this.rootSelector;if(u[d])throw new Error("Ambiguous label root selector.");u[d]=h,this.labelCache[o]=h,this.labelSelectors[o]=u}return r.parentNode==null&&this.container.appendChild(r),this.updateLabels(),this.customizeLabels(),this}onLabelsChange(t={}){this.destroyCustomizeLabels(),this.shouldRerenderLabels(t)?this.renderLabels():this.updateLabels(),this.updateLabelPositions()}shouldRerenderLabels(t={}){const e=this.cell.previous("labels");if(e==null)return!0;if("propertyPathArray"in t&&"propertyValue"in t){const i=t.propertyPathArray||[],r=i.length;if(r>1){const o=i[1];if(e[o]){if(r===2)return typeof t.propertyValue=="object"&&Sg(t.propertyValue,"markup");if(i[2]!=="markup")return!1}}}return!0}parseLabelMarkup(t){return t?typeof t=="string"?this.parseLabelStringMarkup(t):this.parseJSONMarkup(t):null}parseLabelStringMarkup(t){const e=Ft.createVectors(t),i=document.createDocumentFragment();for(let r=0,o=e.length;r<o;r+=1){const s=e[r].node;i.appendChild(s)}return{fragment:i,selectors:{}}}normalizeLabelMarkup(t){if(t==null)return;const e=t.fragment;if(!(e instanceof DocumentFragment)||!e.hasChildNodes())throw new Error("Invalid label markup.");let i;const r=e.childNodes;return r.length>1||r[0].nodeName.toUpperCase()!=="G"?i=Ft.create("g").append(e):i=Ft.create(r[0]),i.addClass(this.prefixClassName("edge-label")),{node:i.node,selectors:t.selectors}}updateLabels(){if(this.labelContainer){const t=this.cell,e=t.labels,i=this.can("edgeLabelMovable"),r=t.getDefaultLabel();for(let o=0,s=e.length;o<s;o+=1){const a=this.labelCache[o],l=this.labelSelectors[o];a.setAttribute("cursor",i?"move":"default");const h=e[o],u=Di({},r.attrs,h.attrs);this.updateAttrs(a,u,{selectors:l,rootBBox:h.size?vt.fromSize(h.size):void 0})}}}renderTools(){const t=this.cell.getTools();return this.addTools(t),this}update(t={}){this.cleanCache(),this.updateConnection(t);const e=this.cell.getAttrs(),{text:i}=e,r=x6(e,["text"]);return r!=null&&this.updateAttrs(this.container,r,{selectors:this.selectors}),this.updateLabelPositions(),this.updateTools(t),this}removeRedundantLinearVertices(t={}){const e=this.cell,i=e.getVertices(),r=[this.sourceAnchor,...i,this.targetAnchor],o=r.length,s=new ki(r);s.simplify({threshold:.01});const a=s.points.map(h=>h.toJSON()),l=a.length;return o===l?0:(e.setVertices(a.slice(1,l-1),t),o-l)}getTerminalView(t){switch(t){case"source":return this.sourceView||null;case"target":return this.targetView||null;default:throw new Error(`Unknown terminal type '${t}'`)}}getTerminalAnchor(t){switch(t){case"source":return Y.create(this.sourceAnchor);case"target":return Y.create(this.targetAnchor);default:throw new Error(`Unknown terminal type '${t}'`)}}getTerminalConnectionPoint(t){switch(t){case"source":return Y.create(this.sourcePoint);case"target":return Y.create(this.targetPoint);default:throw new Error(`Unknown terminal type '${t}'`)}}getTerminalMagnet(t,e={}){switch(t){case"source":{if(e.raw)return this.sourceMagnet;const i=this.sourceView;return i?this.sourceMagnet||i.container:null}case"target":{if(e.raw)return this.targetMagnet;const i=this.targetView;return i?this.targetMagnet||i.container:null}default:throw new Error(`Unknown terminal type '${t}'`)}}updateConnection(t={}){const e=this.cell;if(t.translateBy&&e.isFragmentDescendantOf(t.translateBy)){const i=t.tx||0,r=t.ty||0;this.routePoints=new ki(this.routePoints).translate(i,r).points,this.translateConnectionPoints(i,r),this.path.translate(i,r)}else{const i=e.getVertices(),r=this.findAnchors(i);this.sourceAnchor=r.source,this.targetAnchor=r.target,this.routePoints=this.findRoutePoints(i);const o=this.findConnectionPoints(this.routePoints,this.sourceAnchor,this.targetAnchor);this.sourcePoint=o.source,this.targetPoint=o.target;const s=this.findMarkerPoints(this.routePoints,this.sourcePoint,this.targetPoint);this.path=this.findPath(this.routePoints,s.source||this.sourcePoint,s.target||this.targetPoint)}this.cleanCache()}findAnchors(t){const e=this.cell,i=e.source,r=e.target,o=t[0],s=t[t.length-1];return r.priority&&!i.priority?this.findAnchorsOrdered("target",s,"source",o):this.findAnchorsOrdered("source",o,"target",s)}findAnchorsOrdered(t,e,i,r){let o,s;const a=this.cell,l=a[t],h=a[i],u=this.getTerminalView(t),d=this.getTerminalView(i),c=this.getTerminalMagnet(t),g=this.getTerminalMagnet(i);if(u){let f;e?f=Y.create(e):d?f=g:f=Y.create(h),o=this.getAnchor(l.anchor,u,c,f,t)}else o=Y.create(l);if(d){const f=Y.create(r||o);s=this.getAnchor(h.anchor,d,g,f,i)}else s=Y.isPointLike(h)?Y.create(h):new Y;return{[t]:o,[i]:s}}getAnchor(t,e,i,r,o){const s=e.isEdgeElement(i),a=this.graph.options.connecting;let l=typeof t=="string"?{name:t}:t;if(!l){const d=s?(o==="source"?a.sourceEdgeAnchor:a.targetEdgeAnchor)||a.edgeAnchor:(o==="source"?a.sourceAnchor:a.targetAnchor)||a.anchor;l=typeof d=="string"?{name:d}:d}if(!l)throw new Error("Anchor should be specified.");let h;const u=l.name;if(s){const d=su.registry.get(u);if(typeof d!="function")return su.registry.onNotFound(u);h=Nt(d,this,e,i,r,l.args||{},o)}else{const d=ou.registry.get(u);if(typeof d!="function")return ou.registry.onNotFound(u);h=Nt(d,this,e,i,r,l.args||{},o)}return h?h.round(this.POINT_ROUNDING):new Y}findRoutePoints(t=[]){const e=this.graph.options.connecting.router||Qs.presets.normal,i=this.cell.getRouter()||e;let r;if(typeof i=="function")r=Nt(i,this,t,{},this);else{const o=typeof i=="string"?i:i.name,s=typeof i=="string"?{}:i.args||{},a=o?Qs.registry.get(o):Qs.presets.normal;if(typeof a!="function")return Qs.registry.onNotFound(o);r=Nt(a,this,t,s,this)}return r==null?t.map(o=>Y.create(o)):r.map(o=>Y.create(o))}findConnectionPoints(t,e,i){const r=this.cell,o=this.graph.options.connecting,s=r.getSource(),a=r.getTarget(),l=this.sourceView,h=this.targetView,u=t[0],d=t[t.length-1];let c;if(l&&!l.isEdgeElement(this.sourceMagnet)){const f=this.sourceMagnet||l.container,p=u||i,m=new kt(p,e),v=s.connectionPoint||o.sourceConnectionPoint||o.connectionPoint;c=this.getConnectionPoint(v,l,f,m,"source")}else c=e;let g;if(h&&!h.isEdgeElement(this.targetMagnet)){const f=this.targetMagnet||h.container,p=a.connectionPoint||o.targetConnectionPoint||o.connectionPoint,m=d||e,v=new kt(m,i);g=this.getConnectionPoint(p,h,f,v,"target")}else g=i;return{source:c,target:g}}getConnectionPoint(t,e,i,r,o){const s=r.end;if(t==null)return s;const a=typeof t=="string"?t:t.name,l=typeof t=="string"?{}:t.args,h=au.registry.get(a);if(typeof h!="function")return au.registry.onNotFound(a);const u=Nt(h,this,r,e,i,l||{},o);return u?u.round(this.POINT_ROUNDING):s}findMarkerPoints(t,e,i){const r=d=>{const c=this.cell.getAttrs(),g=Object.keys(c);for(let f=0,p=g.length;f<p;f+=1){const m=c[g[f]];if(m[`${d}Marker`]||m[`${d}-marker`]){const v=m.strokeWidth||m["stroke-width"];if(v)return parseFloat(v);break}}return null},o=t[0],s=t[t.length-1];let a,l;const h=r("source");h&&(a=e.clone().move(o||i,-h));const u=r("target");return u&&(l=i.clone().move(s||e,-u)),this.sourceMarkerPoint=a||e.clone(),this.targetMarkerPoint=l||i.clone(),{source:a,target:l}}findPath(t,e,i){const r=this.cell.getConnector()||this.graph.options.connecting.connector;let o,s,a;if(typeof r=="string"?o=r:(o=r.name,s=r.args),o){const h=vl.registry.get(o);if(typeof h!="function")return vl.registry.onNotFound(o);a=h}else a=vl.presets.normal;const l=Nt(a,this,e,i,t,Object.assign(Object.assign({},s),{raw:!0}),this);return typeof l=="string"?ie.parse(l):l}translateConnectionPoints(t,e){this.sourcePoint.translate(t,e),this.targetPoint.translate(t,e),this.sourceAnchor.translate(t,e),this.targetAnchor.translate(t,e),this.sourceMarkerPoint.translate(t,e),this.targetMarkerPoint.translate(t,e)}updateLabelPositions(){if(this.labelContainer==null)return this;if(!this.path)return this;const e=this.cell,i=e.getLabels();if(i.length===0)return this;const r=e.getDefaultLabel(),o=this.normalizeLabelPosition(r.position);for(let s=0,a=i.length;s<a;s+=1){const l=i[s],h=this.labelCache[s];if(!h)continue;const u=this.normalizeLabelPosition(l.position),d=Di({},o,u),c=this.getLabelTransformationMatrix(d);h.setAttribute("transform",Pu(c))}return this}updateTerminalProperties(t){const e=this.cell,i=this.graph,r=e[t],o=r&&r.cell,s=`${t}View`;if(!o)return this[s]=null,this.updateTerminalMagnet(t),!0;const a=i.getCellById(o);if(!a)throw new Error(`Edge's ${t} node with id "${o}" not exists`);const l=a.findView(i);return l?(this[s]=l,this.updateTerminalMagnet(t),!0):!1}updateTerminalMagnet(t){const e=`${t}Magnet`,i=this.getTerminalView(t);if(i){let r=i.getMagnetFromEdgeTerminal(this.cell[t]);r===i.container&&(r=null),this[e]=r}else this[e]=null}getLabelPositionAngle(t){const e=this.cell.getLabelAt(t);return e&&e.position&&typeof e.position=="object"&&e.position.angle||0}getLabelPositionArgs(t){const e=this.cell.getLabelAt(t);if(e&&e.position&&typeof e.position=="object")return e.position.options}getDefaultLabelPositionArgs(){const t=this.cell.getDefaultLabel();if(t&&t.position&&typeof t.position=="object")return t.position.options}mergeLabelPositionArgs(t,e){return t===null?null:t===void 0?e===null?null:e:Di({},e,t)}getConnection(){return this.path!=null?this.path.clone():null}getConnectionPathData(){if(this.path==null)return"";const t=this.cache.pathCache;return Sg(t,"data")||(t.data=this.path.serialize()),t.data||""}getConnectionSubdivisions(){if(this.path==null)return null;const t=this.cache.pathCache;return Sg(t,"segmentSubdivisions")||(t.segmentSubdivisions=this.path.getSegmentSubdivisions()),t.segmentSubdivisions}getConnectionLength(){if(this.path==null)return 0;const t=this.cache.pathCache;return Sg(t,"length")||(t.length=this.path.length({segmentSubdivisions:this.getConnectionSubdivisions()})),t.length}getPointAtLength(t){return this.path==null?null:this.path.pointAtLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()})}getPointAtRatio(t){return this.path==null?null:(Ms(t)&&(t=parseFloat(t)/100),this.path.pointAt(t,{segmentSubdivisions:this.getConnectionSubdivisions()}))}getTangentAtLength(t){return this.path==null?null:this.path.tangentAtLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()})}getTangentAtRatio(t){return this.path==null?null:this.path.tangentAt(t,{segmentSubdivisions:this.getConnectionSubdivisions()})}getClosestPoint(t){return this.path==null?null:this.path.closestPoint(t,{segmentSubdivisions:this.getConnectionSubdivisions()})}getClosestPointLength(t){return this.path==null?null:this.path.closestPointLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()})}getClosestPointRatio(t){return this.path==null?null:this.path.closestPointNormalizedLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()})}getLabelPosition(t,e,i,r){const o={distance:0};let s=0,a;typeof i=="number"?(s=i,a=r):a=i,a!=null&&(o.options=a);const l=a&&a.absoluteOffset,h=!(a&&a.absoluteDistance),u=a&&a.absoluteDistance&&a.reverseDistance,d=this.path,c={segmentSubdivisions:this.getConnectionSubdivisions()},g=new Y(t,e),f=d.closestPointT(g,c),p=this.getConnectionLength()||0;let m=d.lengthAtT(f,c);h&&(m=p>0?m/p:0),u&&(m=-1*(p-m)||1),o.distance=m;let v;l||(v=d.tangentAtT(f));let b;if(v)b=v.pointOffset(g);else{const y=d.pointAtT(f),C=g.diff(y);b={x:C.x,y:C.y}}return o.offset=b,o.angle=s,o}normalizeLabelPosition(t){return typeof t=="number"?{distance:t}:t}getLabelTransformationMatrix(t){const e=this.normalizeLabelPosition(t),i=e.options||{},r=e.angle||0,o=e.distance,s=o>0&&o<=1;let a=0;const l={x:0,y:0},h=e.offset;h&&(typeof h=="number"?a=h:(h.x!=null&&(l.x=h.x),h.y!=null&&(l.y=h.y)));const u=l.x!==0||l.y!==0||a===0,d=i.keepGradient,c=i.ensureLegibility,g=this.path,f={segmentSubdivisions:this.getConnectionSubdivisions()},p=s?o*this.getConnectionLength():o,m=g.tangentAtLength(p,f);let v,b=r;if(m){if(u)v=m.start,v.translate(l);else{const y=m.clone();y.rotate(-90,m.start),y.setLength(a),v=y.end}d&&(b=m.angle()+r,c&&(b=We.normalize((b+90)%180-90)))}else v=g.start,u&&v.translate(l);return Ji().translate(v.x,v.y).rotate(b)}getVertexIndex(t,e){const r=this.cell.getVertices(),o=this.getClosestPointLength(new Y(t,e));let s=0;if(o!=null)for(const a=r.length;s<a;s+=1){const l=r[s],h=this.getClosestPointLength(l);if(h!=null&&o<h)break}return s}getEventArgs(t,e,i){const r=this,o=r.cell,s=o;return e==null||i==null?{e:t,view:r,edge:o,cell:s}:{e:t,x:e,y:i,view:r,edge:o,cell:s}}notifyUnhandledMouseDown(t,e,i){this.notify("edge:unhandled:mousedown",{e:t,x:e,y:i,view:this,cell:this.cell,edge:this.cell})}notifyMouseDown(t,e,i){super.onMouseDown(t,e,i),this.notify("edge:mousedown",this.getEventArgs(t,e,i))}notifyMouseMove(t,e,i){super.onMouseMove(t,e,i),this.notify("edge:mousemove",this.getEventArgs(t,e,i))}notifyMouseUp(t,e,i){super.onMouseUp(t,e,i),this.notify("edge:mouseup",this.getEventArgs(t,e,i))}onClick(t,e,i){super.onClick(t,e,i),this.notify("edge:click",this.getEventArgs(t,e,i))}onDblClick(t,e,i){super.onDblClick(t,e,i),this.notify("edge:dblclick",this.getEventArgs(t,e,i))}onContextMenu(t,e,i){super.onContextMenu(t,e,i),this.notify("edge:contextmenu",this.getEventArgs(t,e,i))}onMouseDown(t,e,i){this.notifyMouseDown(t,e,i),this.startEdgeDragging(t,e,i)}onMouseMove(t,e,i){const r=this.getEventData(t);switch(r.action){case"drag-label":{this.dragLabel(t,e,i);break}case"drag-arrowhead":{this.dragArrowhead(t,e,i);break}case"drag-edge":{this.dragEdge(t,e,i);break}}return this.notifyMouseMove(t,e,i),r}onMouseUp(t,e,i){const r=this.getEventData(t);switch(r.action){case"drag-label":{this.stopLabelDragging(t,e,i);break}case"drag-arrowhead":{this.stopArrowheadDragging(t,e,i);break}case"drag-edge":{this.stopEdgeDragging(t,e,i);break}}return this.notifyMouseUp(t,e,i),this.checkMouseleave(t),r}onMouseOver(t){super.onMouseOver(t),this.notify("edge:mouseover",this.getEventArgs(t))}onMouseOut(t){super.onMouseOut(t),this.notify("edge:mouseout",this.getEventArgs(t))}onMouseEnter(t){super.onMouseEnter(t),this.notify("edge:mouseenter",this.getEventArgs(t))}onMouseLeave(t){super.onMouseLeave(t),this.notify("edge:mouseleave",this.getEventArgs(t))}onMouseWheel(t,e,i,r){super.onMouseWheel(t,e,i,r),this.notify("edge:mousewheel",Object.assign({delta:r},this.getEventArgs(t,e,i)))}onCustomEvent(t,e,i,r){if(dE(t.target,"edge-tool",this.container)){if(t.stopPropagation(),this.can("useEdgeTools")){if(e==="edge:remove"){this.cell.remove({ui:!0});return}this.notify("edge:customevent",Object.assign({name:e},this.getEventArgs(t,i,r)))}this.notifyMouseDown(t,i,r)}else this.notify("edge:customevent",Object.assign({name:e},this.getEventArgs(t,i,r))),super.onCustomEvent(t,e,i,r)}onLabelMouseDown(t,e,i){this.notifyMouseDown(t,e,i),this.startLabelDragging(t,e,i),this.getEventData(t).stopPropagation&&t.stopPropagation()}startEdgeDragging(t,e,i){if(!this.can("edgeMovable")){this.notifyUnhandledMouseDown(t,e,i);return}this.setEventData(t,{x:e,y:i,moving:!1,action:"drag-edge"})}dragEdge(t,e,i){const r=this.getEventData(t);r.moving||(r.moving=!0,this.addClass("edge-moving"),this.notify("edge:move",{e:t,x:e,y:i,view:this,cell:this.cell,edge:this.cell})),this.cell.translate(e-r.x,i-r.y,{ui:!0}),this.setEventData(t,{x:e,y:i}),this.notify("edge:moving",{e:t,x:e,y:i,view:this,cell:this.cell,edge:this.cell})}stopEdgeDragging(t,e,i){const r=this.getEventData(t);r.moving&&(this.removeClass("edge-moving"),this.notify("edge:moved",{e:t,x:e,y:i,view:this,cell:this.cell,edge:this.cell})),r.moving=!1}prepareArrowheadDragging(t,e){const i=this.getTerminalMagnet(t),r={action:"drag-arrowhead",x:e.x,y:e.y,isNewEdge:e.isNewEdge===!0,terminalType:t,initialMagnet:i,initialTerminal:UC(this.cell[t]),fallbackAction:e.fallbackAction||"revert",getValidateConnectionArgs:this.createValidateConnectionArgs(t),options:e.options};return this.beforeArrowheadDragging(r),r}createValidateConnectionArgs(t){const e=[];e[4]=t,e[5]=this;let i,r=0,o=0;t==="source"?(r=2,i="target"):(o=2,i="source");const s=this.cell[i],a=s.cell;if(a){let l;const h=e[r]=this.graph.findViewByCell(a);h&&(l=h.getMagnetFromEdgeTerminal(s),l===h.container&&(l=void 0)),e[r+1]=l}return(l,h)=>(e[o]=l,e[o+1]=l.container===h?void 0:h,e)}beforeArrowheadDragging(t){t.zIndex=this.cell.zIndex,this.cell.toFront();const e=this.container.style;t.pointerEvents=e.pointerEvents,e.pointerEvents="none",this.graph.options.connecting.highlight&&this.highlightAvailableMagnets(t)}afterArrowheadDragging(t){t.zIndex!=null&&(this.cell.setZIndex(t.zIndex,{ui:!0}),t.zIndex=null);const e=this.container;e.style.pointerEvents=t.pointerEvents||"",this.graph.options.connecting.highlight&&this.unhighlightAvailableMagnets(t)}validateConnection(t,e,i,r,o,s,a){const l=this.graph.options.connecting,h=l.allowLoop,u=l.allowNode,d=l.allowEdge,c=l.allowPort,g=l.allowMulti,f=l.validateConnection,p=s?s.cell:null,m=o==="target"?i:t,v=o==="target"?r:e;let b=!0;const y=C=>{const w=o==="source"?a?a.port:null:p?p.getSourcePortId():null,_=o==="target"?a?a.port:null:p?p.getTargetPortId():null;return Nt(C,this.graph,{edge:p,edgeView:s,sourceView:t,targetView:i,sourcePort:w,targetPort:_,sourceMagnet:e,targetMagnet:r,sourceCell:t?t.cell:null,targetCell:i?i.cell:null,type:o})};if(h!=null&&(typeof h=="boolean"?!h&&t===i&&(b=!1):b=y(h)),b&&c!=null&&(typeof c=="boolean"?!c&&v&&(b=!1):b=y(c)),b&&d!=null&&(typeof d=="boolean"?!d&&Ts.isEdgeView(m)&&(b=!1):b=y(d)),b&&u!=null&&v==null&&(typeof u=="boolean"?!u&&oo.isNodeView(m)&&(b=!1):b=y(u)),b&&g!=null&&s){const C=s.cell,w=o==="source"?a:C.getSource(),_=o==="target"?a:C.getTarget(),A=a?this.graph.getCellById(a.cell):null;if(w&&_&&w.cell&&_.cell&&A)if(typeof g=="function")b=y(g);else{const x=this.graph.model.getConnectedEdges(A,{outgoing:o==="source",incoming:o==="target"});x.length&&(g==="withPort"?x.some(T=>{const M=T.getSource(),R=T.getTarget();return M&&R&&M.cell===w.cell&&R.cell===_.cell&&M.port!=null&&M.port===w.port&&R.port!=null&&R.port===_.port})&&(b=!1):g||x.some(T=>{const M=T.getSource(),R=T.getTarget();return M&&R&&M.cell===w.cell&&R.cell===_.cell})&&(b=!1))}}return b&&f!=null&&(b=y(f)),b}allowConnectToBlank(t){const e=this.graph,r=e.options.connecting.allowBlank;if(typeof r!="function")return!!r;const o=e.findViewByCell(t),s=t.getSourceCell(),a=t.getTargetCell(),l=e.findViewByCell(s),h=e.findViewByCell(a);return Nt(r,e,{edge:t,edgeView:o,sourceCell:s,targetCell:a,sourceView:l,targetView:h,sourcePort:t.getSourcePortId(),targetPort:t.getTargetPortId(),sourceMagnet:o.sourceMagnet,targetMagnet:o.targetMagnet})}validateEdge(t,e,i){const r=this.graph;if(!this.allowConnectToBlank(t)){const s=t.getSourceCellId(),a=t.getTargetCellId();if(!(s&&a))return!1}const o=r.options.connecting.validateEdge;return o?Nt(o,r,{edge:t,type:e,previous:i}):!0}arrowheadDragging(t,e,i,r){r.x=e,r.y=i,r.currentTarget!==t&&(r.currentMagnet&&r.currentView&&r.currentView.unhighlight(r.currentMagnet,{type:"magnetAdsorbed"}),r.currentView=this.graph.findViewByElem(t),r.currentView?(r.currentMagnet=r.currentView.findMagnet(t),r.currentMagnet&&this.validateConnection(...r.getValidateConnectionArgs(r.currentView,r.currentMagnet),r.currentView.getEdgeTerminal(r.currentMagnet,e,i,this.cell,r.terminalType))?r.currentView.highlight(r.currentMagnet,{type:"magnetAdsorbed"}):r.currentMagnet=null):r.currentMagnet=null),r.currentTarget=t,this.cell.prop(r.terminalType,{x:e,y:i},Object.assign(Object.assign({},r.options),{ui:!0}))}arrowheadDragged(t,e,i){const r=t.currentView,o=t.currentMagnet;if(!o||!r)return;r.unhighlight(o,{type:"magnetAdsorbed"});const s=t.terminalType,a=r.getEdgeTerminal(o,e,i,this.cell,s);this.cell.setTerminal(s,a,{ui:!0})}snapArrowhead(t,e,i){const r=this.graph,{snap:o,allowEdge:s}=r.options.connecting,a=typeof o=="object"&&o.radius||50,l=typeof o=="object"&&o.anchor||"center",h=r.renderer.findViewsInArea({x:t-a,y:e-a,width:2*a,height:2*a},{nodeOnly:!0});if(s){const C=r.renderer.findEdgeViewsFromPoint({x:t,y:e},a).filter(w=>w!==this);h.push(...C)}const u=i.closestView||null,d=i.closestMagnet||null;i.closestView=null,i.closestMagnet=null;let c,g=Number.MAX_SAFE_INTEGER;const f=new Y(t,e);h.forEach(C=>{if(C.container.getAttribute("magnet")!=="false"){if(C.isNodeView())c=l==="center"?C.cell.getBBox().getCenter().distance(f):C.cell.getBBox().getNearestPointToPoint(f).distance(f);else if(C.isEdgeView()){const w=C.getClosestPoint(f);w?c=w.distance(f):c=Number.MAX_SAFE_INTEGER}c<a&&c<g&&(d===C.container||this.validateConnection(...i.getValidateConnectionArgs(C,null),C.getEdgeTerminal(C.container,t,e,this.cell,i.terminalType)))&&(g=c,i.closestView=C,i.closestMagnet=C.container)}C.container.querySelectorAll("[magnet]").forEach(w=>{if(w.getAttribute("magnet")!=="false"){const _=C.getBBoxOfElement(w);c=f.distance(_.getCenter()),c<a&&c<g&&(d===w||this.validateConnection(...i.getValidateConnectionArgs(C,w),C.getEdgeTerminal(w,t,e,this.cell,i.terminalType)))&&(g=c,i.closestView=C,i.closestMagnet=w)}})});let p;const m=i.terminalType,v=i.closestView,b=i.closestMagnet,y=d!==b;if(u&&y&&u.unhighlight(d,{type:"magnetAdsorbed"}),v){if(!y)return;v.highlight(b,{type:"magnetAdsorbed"}),p=v.getEdgeTerminal(b,t,e,this.cell,m)}else p={x:t,y:e};this.cell.setTerminal(m,p,{},Object.assign(Object.assign({},i.options),{ui:!0}))}snapArrowheadEnd(t){const e=t.closestView,i=t.closestMagnet;e&&i&&(e.unhighlight(i,{type:"magnetAdsorbed"}),t.currentMagnet=e.findMagnet(i)),t.closestView=null,t.closestMagnet=null}finishEmbedding(t){this.graph.options.embedding.enabled&&this.cell.updateParent()&&(t.zIndex=null)}fallbackConnection(t){switch(t.fallbackAction){case"remove":this.cell.remove({ui:!0});break;case"revert":default:this.cell.prop(t.terminalType,t.initialTerminal,{ui:!0});break}}notifyConnectionEvent(t,e){const i=t.terminalType,r=t.initialTerminal,o=this.cell[i];if(o&&!vi.equalTerminals(r,o)){const a=this.graph,l=r,h=l.cell?a.getCellById(l.cell):null,u=l.port,d=h?a.findViewByCell(h):null,c=h||t.isNewEdge?null:Y.create(r).toJSON(),g=o,f=g.cell?a.getCellById(g.cell):null,p=g.port,m=f?a.findViewByCell(f):null,v=f?null:Y.create(o).toJSON();this.notify("edge:connected",{e,previousCell:h,previousPort:u,previousView:d,previousPoint:c,currentCell:f,currentView:m,currentPort:p,currentPoint:v,previousMagnet:t.initialMagnet,currentMagnet:t.currentMagnet,edge:this.cell,view:this,type:i,isNew:t.isNewEdge})}}highlightAvailableMagnets(t){const e=this.graph,i=e.model.getCells();t.marked={};for(let r=0,o=i.length;r<o;r+=1){const s=e.findViewByCell(i[r]);if(!s||s.cell.id===this.cell.id)continue;const a=Array.prototype.slice.call(s.container.querySelectorAll("[magnet]"));s.container.getAttribute("magnet")!=="false"&&a.push(s.container);const l=a.filter(h=>this.validateConnection(...t.getValidateConnectionArgs(s,h),s.getEdgeTerminal(h,t.x,t.y,this.cell,t.terminalType)));if(l.length>0){for(let h=0,u=l.length;h<u;h+=1)s.highlight(l[h],{type:"magnetAvailable"});s.highlight(null,{type:"nodeAvailable"}),t.marked[s.cell.id]=l}}}unhighlightAvailableMagnets(t){const e=t.marked||{};Object.keys(e).forEach(i=>{const r=this.graph.findViewByCell(i);r&&(e[i].forEach(s=>{r.unhighlight(s,{type:"magnetAvailable"})}),r.unhighlight(null,{type:"nodeAvailable"}))}),t.marked=null}startArrowheadDragging(t,e,i){if(!this.can("arrowheadMovable")){this.notifyUnhandledMouseDown(t,e,i);return}const o=t.target.getAttribute("data-terminal"),s=this.prepareArrowheadDragging(o,{x:e,y:i});this.setEventData(t,s)}dragArrowhead(t,e,i){const r=this.getEventData(t);this.graph.options.connecting.snap?this.snapArrowhead(e,i,r):this.arrowheadDragging(this.getEventTarget(t),e,i,r)}stopArrowheadDragging(t,e,i){const r=this.graph,o=this.getEventData(t);r.options.connecting.snap?this.snapArrowheadEnd(o):this.arrowheadDragged(o,e,i),this.validateEdge(this.cell,o.terminalType,o.initialTerminal)?(this.finishEmbedding(o),this.notifyConnectionEvent(o,t)):this.fallbackConnection(o),this.afterArrowheadDragging(o)}startLabelDragging(t,e,i){if(this.can("edgeLabelMovable")){const r=t.currentTarget,o=parseInt(r.getAttribute("data-index"),10),s=this.getLabelPositionAngle(o),a=this.getLabelPositionArgs(o),l=this.getDefaultLabelPositionArgs(),h=this.mergeLabelPositionArgs(a,l);this.setEventData(t,{index:o,positionAngle:s,positionArgs:h,stopPropagation:!0,action:"drag-label"})}else this.setEventData(t,{stopPropagation:!0});this.graph.view.delegateDragEvents(t,this)}dragLabel(t,e,i){const r=this.getEventData(t),o=this.cell.getLabelAt(r.index),s=Di({},o,{position:this.getLabelPosition(e,i,r.positionAngle,r.positionArgs)});this.cell.setLabelAt(r.index,s)}stopLabelDragging(t,e,i){}}(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const i=e[Symbol.toStringTag],r=e;return(i==null||i===n.toStringTag)&&typeof r.isNodeView=="function"&&typeof r.isEdgeView=="function"&&typeof r.confirmUpdate=="function"&&typeof r.update=="function"&&typeof r.getConnection=="function"}n.isEdgeView=t})(Ts||(Ts={}));Ts.config({isSvgElement:!0,priority:1,bootstrap:["render","source","target"],actions:{view:["render"],markup:["render"],attrs:["update"],source:["source","update"],target:["target","update"],router:["update"],connector:["update"],labels:["labels"],defaultLabel:["labels"],tools:["tools"],vertices:["vertices","update"]}});Ts.registry.register("edge",Ts,!0);var S6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o};class Fo extends Ze{get disposeContainer(){return!1}get options(){return this.graph.options}constructor(t){super(),this.graph=t;const{selectors:e,fragment:i}=qe.parseJSONMarkup(Fo.markup);this.background=e.background,this.grid=e.grid,this.svg=e.svg,this.defs=e.defs,this.viewport=e.viewport,this.primer=e.primer,this.stage=e.stage,this.decorator=e.decorator,this.overlay=e.overlay,this.container=this.options.container,this.restore=Fo.snapshoot(this.container),we(this.container,this.prefixClassName("graph")),Jc(this.container,i),this.delegateEvents()}delegateEvents(){const t=this.constructor;return super.delegateEvents(t.events),this}guard(t,e){return t.type==="mousedown"&&t.button===2||this.options.guard&&this.options.guard(t,e)?!0:t.data&&t.data.guarded!==void 0?t.data.guarded:!(e&&e.cell&&ae.isCell(e.cell)||this.svg===t.target||this.container===t.target||this.svg.contains(t.target))}findView(t){return this.graph.findViewByElem(t)}onDblClick(t){this.options.preventDefaultDblClick&&t.preventDefault();const e=this.normalizeEvent(t),i=this.findView(e.target);if(this.guard(e,i))return;const r=this.graph.snapToGrid(e.clientX,e.clientY);i?i.onDblClick(e,r.x,r.y):this.graph.trigger("blank:dblclick",{e,x:r.x,y:r.y})}onClick(t){if(this.getMouseMovedCount(t)<=this.options.clickThreshold){const e=this.normalizeEvent(t),i=this.findView(e.target);if(this.guard(e,i))return;const r=this.graph.snapToGrid(e.clientX,e.clientY);i?i.onClick(e,r.x,r.y):this.graph.trigger("blank:click",{e,x:r.x,y:r.y})}}isPreventDefaultContextMenu(t){let e=this.options.preventDefaultContextMenu;return typeof e=="function"&&(e=Nt(e,this.graph,{view:t})),e}onContextMenu(t){const e=this.normalizeEvent(t),i=this.findView(e.target);if(this.isPreventDefaultContextMenu(i)&&t.preventDefault(),this.guard(e,i))return;const r=this.graph.snapToGrid(e.clientX,e.clientY);i?i.onContextMenu(e,r.x,r.y):this.graph.trigger("blank:contextmenu",{e,x:r.x,y:r.y})}delegateDragEvents(t,e){t.data==null&&(t.data={}),this.setEventData(t,{currentView:e||null,mouseMovedCount:0,startPosition:{x:t.clientX,y:t.clientY}});const i=this.constructor;this.delegateDocumentEvents(i.documentEvents,t.data),this.undelegateEvents()}getMouseMovedCount(t){return this.getEventData(t).mouseMovedCount||0}onMouseDown(t){const e=this.normalizeEvent(t),i=this.findView(e.target);if(this.guard(e,i))return;this.options.preventDefaultMouseDown&&t.preventDefault();const r=this.graph.snapToGrid(e.clientX,e.clientY);i?i.onMouseDown(e,r.x,r.y):(this.options.preventDefaultBlankAction&&["touchstart"].includes(e.type)&&t.preventDefault(),this.graph.trigger("blank:mousedown",{e,x:r.x,y:r.y})),this.delegateDragEvents(e,i)}onMouseMove(t){const e=this.getEventData(t),i=e.startPosition;if(i&&i.x===t.clientX&&i.y===t.clientY||(e.mouseMovedCount==null&&(e.mouseMovedCount=0),e.mouseMovedCount+=1,e.mouseMovedCount<=this.options.moveThreshold))return;const o=this.normalizeEvent(t),s=this.graph.snapToGrid(o.clientX,o.clientY),a=e.currentView;a?a.onMouseMove(o,s.x,s.y):this.graph.trigger("blank:mousemove",{e:o,x:s.x,y:s.y}),this.setEventData(o,e)}onMouseUp(t){this.undelegateDocumentEvents();const e=this.normalizeEvent(t),i=this.graph.snapToGrid(e.clientX,e.clientY),o=this.getEventData(t).currentView;if(o?o.onMouseUp(e,i.x,i.y):this.graph.trigger("blank:mouseup",{e,x:i.x,y:i.y}),!t.isPropagationStopped()){const s=new Eo(t,{type:"click",data:t.data});this.onClick(s)}t.stopImmediatePropagation(),this.delegateEvents()}onMouseOver(t){const e=this.normalizeEvent(t),i=this.findView(e.target);if(!this.guard(e,i))if(i)i.onMouseOver(e);else{if(this.container===e.target)return;this.graph.trigger("blank:mouseover",{e})}}onMouseOut(t){const e=this.normalizeEvent(t),i=this.findView(e.target);if(!this.guard(e,i))if(i)i.onMouseOut(e);else{if(this.container===e.target)return;this.graph.trigger("blank:mouseout",{e})}}onMouseEnter(t){const e=this.normalizeEvent(t),i=this.findView(e.target);if(this.guard(e,i))return;const r=this.graph.findViewByElem(e.relatedTarget);if(i){if(r===i)return;i.onMouseEnter(e)}else{if(r)return;this.graph.trigger("graph:mouseenter",{e})}}onMouseLeave(t){const e=this.normalizeEvent(t),i=this.findView(e.target);if(this.guard(e,i))return;const r=this.graph.findViewByElem(e.relatedTarget);if(i){if(r===i)return;i.onMouseLeave(e)}else{if(r)return;this.graph.trigger("graph:mouseleave",{e})}}onMouseWheel(t){const e=this.normalizeEvent(t),i=this.findView(e.target);if(this.guard(e,i))return;const r=e.originalEvent,o=this.graph.snapToGrid(r.clientX,r.clientY),s=Math.max(-1,Math.min(1,r.wheelDelta||-r.detail));i?i.onMouseWheel(e,o.x,o.y,s):this.graph.trigger("blank:mousewheel",{e,delta:s,x:o.x,y:o.y})}onCustomEvent(t){const e=t.currentTarget,i=e.getAttribute("event")||e.getAttribute("data-event");if(i){const r=this.findView(e);if(r){const o=this.normalizeEvent(t);if(this.guard(o,r))return;const s=this.graph.snapToGrid(o.clientX,o.clientY);r.onCustomEvent(o,i,s.x,s.y)}}}handleMagnetEvent(t,e){const i=t.currentTarget,r=i.getAttribute("magnet");if(r&&r.toLowerCase()!=="false"){const o=this.findView(i);if(o){const s=this.normalizeEvent(t);if(this.guard(s,o))return;const a=this.graph.snapToGrid(s.clientX,s.clientY);Nt(e,this.graph,o,s,i,a.x,a.y)}}}onMagnetMouseDown(t){this.handleMagnetEvent(t,(e,i,r,o,s)=>{e.onMagnetMouseDown(i,r,o,s)})}onMagnetDblClick(t){this.handleMagnetEvent(t,(e,i,r,o,s)=>{e.onMagnetDblClick(i,r,o,s)})}onMagnetContextMenu(t){const e=this.findView(t.target);this.isPreventDefaultContextMenu(e)&&t.preventDefault(),this.handleMagnetEvent(t,(i,r,o,s,a)=>{i.onMagnetContextMenu(r,o,s,a)})}onLabelMouseDown(t){const e=t.currentTarget,i=this.findView(e);if(i){const r=this.normalizeEvent(t);if(this.guard(r,i))return;const o=this.graph.snapToGrid(r.clientX,r.clientY);i.onLabelMouseDown(r,o.x,o.y)}}onImageDragStart(){return!1}dispose(){this.undelegateEvents(),this.undelegateDocumentEvents(),this.restore(),this.restore=()=>{}}}S6([Ze.dispose()],Fo.prototype,"dispose",null);(function(n){const t=`${ro.prefixCls}-graph`;n.markup=[{ns:Yi.xhtml,tagName:"div",selector:"background",className:`${t}-background`},{ns:Yi.xhtml,tagName:"div",selector:"grid",className:`${t}-grid`},{ns:Yi.svg,tagName:"svg",selector:"svg",className:`${t}-svg`,attrs:{width:"100%",height:"100%","xmlns:xlink":Yi.xlink},children:[{tagName:"defs",selector:"defs"},{tagName:"g",selector:"viewport",className:`${t}-svg-viewport`,children:[{tagName:"g",selector:"primer",className:`${t}-svg-primer`},{tagName:"g",selector:"stage",className:`${t}-svg-stage`},{tagName:"g",selector:"decorator",className:`${t}-svg-decorator`},{tagName:"g",selector:"overlay",className:`${t}-svg-overlay`}]}]}];function e(i){const r=i.cloneNode();return i.childNodes.forEach(o=>r.appendChild(o)),()=>{for(Zc(i);i.attributes.length>0;)i.removeAttribute(i.attributes[0].name);for(let o=0,s=r.attributes.length;o<s;o+=1){const a=r.attributes[o];i.setAttribute(a.name,a.value)}r.childNodes.forEach(o=>i.appendChild(o))}}n.snapshoot=e})(Fo||(Fo={}));(function(n){const t=ro.prefixCls;n.events={dblclick:"onDblClick",contextmenu:"onContextMenu",touchstart:"onMouseDown",mousedown:"onMouseDown",mouseover:"onMouseOver",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousewheel:"onMouseWheel",DOMMouseScroll:"onMouseWheel",[`mouseenter  .${t}-cell`]:"onMouseEnter",[`mouseleave  .${t}-cell`]:"onMouseLeave",[`mouseenter  .${t}-cell-tools`]:"onMouseEnter",[`mouseleave  .${t}-cell-tools`]:"onMouseLeave",[`mousedown   .${t}-cell [event]`]:"onCustomEvent",[`touchstart  .${t}-cell [event]`]:"onCustomEvent",[`mousedown   .${t}-cell [data-event]`]:"onCustomEvent",[`touchstart  .${t}-cell [data-event]`]:"onCustomEvent",[`dblclick    .${t}-cell [magnet]`]:"onMagnetDblClick",[`contextmenu .${t}-cell [magnet]`]:"onMagnetContextMenu",[`mousedown   .${t}-cell [magnet]`]:"onMagnetMouseDown",[`touchstart  .${t}-cell [magnet]`]:"onMagnetMouseDown",[`dblclick    .${t}-cell [data-magnet]`]:"onMagnetDblClick",[`contextmenu .${t}-cell [data-magnet]`]:"onMagnetContextMenu",[`mousedown   .${t}-cell [data-magnet]`]:"onMagnetMouseDown",[`touchstart  .${t}-cell [data-magnet]`]:"onMagnetMouseDown",[`dragstart   .${t}-cell image`]:"onImageDragStart",[`mousedown   .${t}-edge .${t}-edge-label`]:"onLabelMouseDown",[`touchstart  .${t}-edge .${t}-edge-label`]:"onLabelMouseDown"},n.documentEvents={mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"}})(Fo||(Fo={}));const A6=`.x6-graph {
  position: relative;
  overflow: hidden;
  outline: none;
  touch-action: none;
}
.x6-graph-background,
.x6-graph-grid,
.x6-graph-svg {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.x6-graph-background-stage,
.x6-graph-grid-stage,
.x6-graph-svg-stage {
  user-select: none;
}
.x6-graph.x6-graph-pannable {
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}
.x6-graph.x6-graph-panning {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
  user-select: none;
}
.x6-node {
  cursor: move;
  /* stylelint-disable-next-line */
}
.x6-node.x6-node-immovable {
  cursor: default;
}
.x6-node * {
  -webkit-user-drag: none;
}
.x6-node .scalable * {
  vector-effect: non-scaling-stroke;
}
.x6-node [magnet='true'] {
  cursor: crosshair;
  transition: opacity 0.3s;
}
.x6-node [magnet='true']:hover {
  opacity: 0.7;
}
.x6-node foreignObject {
  display: block;
  overflow: visible;
  background-color: transparent;
}
.x6-node foreignObject > body {
  position: static;
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  overflow: visible;
  background-color: transparent;
}
.x6-edge .source-marker,
.x6-edge .target-marker {
  vector-effect: non-scaling-stroke;
}
.x6-edge .connection {
  stroke-linejoin: round;
  fill: none;
}
.x6-edge .connection-wrap {
  cursor: move;
  opacity: 0;
  fill: none;
  stroke: #000;
  stroke-width: 15;
  stroke-linecap: round;
  stroke-linejoin: round;
}
.x6-edge .connection-wrap:hover {
  opacity: 0.4;
  stroke-opacity: 0.4;
}
.x6-edge .vertices {
  cursor: move;
  opacity: 0;
}
.x6-edge .vertices .vertex {
  fill: #1abc9c;
}
.x6-edge .vertices .vertex :hover {
  fill: #34495e;
  stroke: none;
}
.x6-edge .vertices .vertex-remove {
  cursor: pointer;
  fill: #fff;
}
.x6-edge .vertices .vertex-remove-area {
  cursor: pointer;
  opacity: 0.1;
}
.x6-edge .vertices .vertex-group:hover .vertex-remove-area {
  opacity: 1;
}
.x6-edge .arrowheads {
  cursor: move;
  opacity: 0;
}
.x6-edge .arrowheads .arrowhead {
  fill: #1abc9c;
}
.x6-edge .arrowheads .arrowhead :hover {
  fill: #f39c12;
  stroke: none;
}
.x6-edge .tools {
  cursor: pointer;
  opacity: 0;
}
.x6-edge .tools .tool-options {
  display: none;
}
.x6-edge .tools .tool-remove circle {
  fill: #f00;
}
.x6-edge .tools .tool-remove path {
  fill: #fff;
}
.x6-edge:hover .vertices,
.x6-edge:hover .arrowheads,
.x6-edge:hover .tools {
  opacity: 1;
}
.x6-highlight-opacity {
  opacity: 0.3;
}
.x6-cell-tool-editor {
  position: relative;
  display: inline-block;
  min-height: 1em;
  margin: 0;
  padding: 0;
  line-height: 1;
  white-space: normal;
  text-align: center;
  vertical-align: top;
  overflow-wrap: normal;
  outline: none;
  transform-origin: 0 0;
  -webkit-user-drag: none;
}
.x6-edge-tool-editor {
  border: 1px solid #275fc5;
  border-radius: 2px;
}
`;class Qi extends As{get options(){return this.graph.options}get model(){return this.graph.model}get view(){return this.graph.view}constructor(t){super(),this.graph=t,this.init()}init(){}}var M6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o};class s_ extends Qi{init(){O3("core",A6)}dispose(){I3("core")}}M6([s_.dispose()],s_.prototype,"dispose",null);var T6=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e},cc;(function(n){function t(e){const{grid:i,panning:r,mousewheel:o,embedding:s}=e,a=T6(e,["grid","panning","mousewheel","embedding"]),l=e.container;if(l!=null)a.width==null&&(a.width=l.clientWidth),a.height==null&&(a.height=l.clientHeight);else throw new Error("Ensure the container of the graph is specified and valid");const h=Di({},n.defaults,a),u={size:10,visible:!1};return typeof i=="number"?h.grid={size:i,visible:!1}:typeof i=="boolean"?h.grid=Object.assign(Object.assign({},u),{visible:i}):h.grid=Object.assign(Object.assign({},u),i),["panning","mousewheel","embedding"].forEach(c=>{const g=e[c];typeof g=="boolean"?h[c].enabled=g:h[c]=Object.assign(Object.assign({},h[c]),g)}),h}n.get=t})(cc||(cc={}));(function(n){n.defaults={x:0,y:0,scaling:{min:.01,max:16},grid:{size:10,visible:!1},background:!1,panning:{enabled:!1,eventTypes:["leftMouseDown"]},mousewheel:{enabled:!1,factor:1.2,zoomAtMousePosition:!0},highlighting:{default:{name:"stroke",args:{padding:3}},nodeAvailable:{name:"className",args:{className:ro.prefix("available-node")}},magnetAvailable:{name:"className",args:{className:ro.prefix("available-magnet")}}},connecting:{snap:!1,allowLoop:!0,allowNode:!0,allowEdge:!1,allowPort:!0,allowBlank:!0,allowMulti:!0,highlight:!1,anchor:"center",edgeAnchor:"ratio",connectionPoint:"boundary",router:"normal",connector:"normal",validateConnection({type:t,sourceView:e,targetView:i}){return(t==="target"?i:e)!=null},createEdge(){return new y6}},translating:{restrict:!1},embedding:{enabled:!1,findParent:"bbox",frontOnly:!0,validate:()=>!0},moveThreshold:0,clickThreshold:0,magnetThreshold:0,preventDefaultDblClick:!0,preventDefaultMouseDown:!1,preventDefaultContextMenu:!0,preventDefaultBlankAction:!0,interacting:{edgeLabelMovable:!1},async:!0,virtual:!1,guard:()=>!1}})(cc||(cc={}));var R6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o},B6=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};class H1 extends Qi{get elem(){return this.view.grid}get grid(){return this.options.grid}init(){this.startListening(),this.draw(this.grid)}startListening(){this.graph.on("scale",this.update,this),this.graph.on("translate",this.update,this)}stopListening(){this.graph.off("scale",this.update,this),this.graph.off("translate",this.update,this)}setVisible(t){this.grid.visible!==t&&(this.grid.visible=t,this.update())}getGridSize(){return this.grid.size}setGridSize(t){this.grid.size=Math.max(t,1),this.update()}show(){this.setVisible(!0),this.update()}hide(){this.setVisible(!1),this.update()}clear(){this.elem.style.backgroundImage=""}draw(t){this.clear(),this.instance=null,Object.assign(this.grid,t),this.patterns=this.resolveGrid(t),this.update()}update(t={}){const e=this.grid.size;if(e<=1||!this.grid.visible)return this.clear();const i=this.graph.matrix(),r=this.getInstance(),o=Array.isArray(t)?t:[t];this.patterns.forEach((l,h)=>{const u=`pattern_${h}`,d=i.a||1,c=i.d||1,{update:g,markup:f}=l,p=B6(l,["update","markup"]),m=Object.assign(Object.assign(Object.assign({},p),o[h]),{sx:d,sy:c,ox:i.e||0,oy:i.f||0,width:e*d,height:e*c});r.has(u)||r.add(u,Ft.create("pattern",{id:u,patternUnits:"userSpaceOnUse"},Ft.createVectors(f)).node);const v=r.get(u);typeof g=="function"&&g(v.childNodes[0],m);let b=m.ox%m.width;b<0&&(b+=m.width);let y=m.oy%m.height;y<0&&(y+=m.height),je(v,{x:b,y,width:m.width,height:m.height})});const s=new XMLSerializer().serializeToString(r.root),a=`url(data:image/svg+xml;base64,${btoa(s)})`;this.elem.style.backgroundImage=a}getInstance(){return this.instance||(this.instance=new Js),this.instance}resolveGrid(t){if(!t)return[];const e=t.type;if(e==null)return[Object.assign(Object.assign({},Js.presets.dot),t.args)];const i=Js.registry.get(e);if(i){let r=t.args||[];return Array.isArray(r)||(r=[r]),Array.isArray(i)?i.map((o,s)=>Object.assign(Object.assign({},o),r[s])):[Object.assign(Object.assign({},i),r[0])]}return Js.registry.onNotFound(e)}dispose(){this.stopListening(),this.clear()}}R6([Qi.dispose()],H1.prototype,"dispose",null);class _L extends Qi{get container(){return this.graph.view.container}get viewport(){return this.graph.view.viewport}get stage(){return this.graph.view.stage}init(){this.resize()}getMatrix(){const t=this.viewport.getAttribute("transform");return t!==this.viewportTransformString&&(this.viewportMatrix=this.viewport.getCTM(),this.viewportTransformString=t),Ji(this.viewportMatrix)}setMatrix(t){const e=Ji(t),i=Pu(e);this.viewport.setAttribute("transform",i),this.viewportMatrix=e,this.viewportTransformString=i}resize(t,e){let i=t===void 0?this.options.width:t,r=e===void 0?this.options.height:e;this.options.width=i,this.options.height=r,typeof i=="number"&&(i=Math.round(i)),typeof r=="number"&&(r=Math.round(r)),this.container.style.width=i==null?"":`${i}px`,this.container.style.height=r==null?"":`${r}px`;const o=this.getComputedSize();return this.graph.trigger("resize",Object.assign({},o)),this}getComputedSize(){let t=this.options.width,e=this.options.height;return CS(t)||(t=this.container.clientWidth),CS(e)||(e=this.container.clientHeight),{width:t,height:e}}getScale(){return A3(this.getMatrix())}scale(t,e=t,i=0,r=0){if(t=this.clampScale(t),e=this.clampScale(e),i||r){const s=this.getTranslation(),a=s.tx-i*(t-1),l=s.ty-r*(e-1);(a!==s.tx||l!==s.ty)&&this.translate(a,l)}const o=this.getMatrix();return o.a=t,o.d=e,this.setMatrix(o),this.graph.trigger("scale",{sx:t,sy:e,ox:i,oy:r}),this}clampScale(t){const e=this.graph.options.scaling;return Br(t,e.min||.01,e.max||16)}getZoom(){return this.getScale().sx}zoom(t,e){e=e||{};let i=t,r=t;const o=this.getScale(),s=this.getComputedSize();let a=s.width/2,l=s.height/2;if(e.absolute||(i+=o.sx,r+=o.sy),e.scaleGrid&&(i=Math.round(i/e.scaleGrid)*e.scaleGrid,r=Math.round(r/e.scaleGrid)*e.scaleGrid),e.maxScale&&(i=Math.min(e.maxScale,i),r=Math.min(e.maxScale,r)),e.minScale&&(i=Math.max(e.minScale,i),r=Math.max(e.minScale,r)),e.center&&(a=e.center.x,l=e.center.y),i=this.clampScale(i),r=this.clampScale(r),a||l){const h=this.getTranslation(),u=a-(a-h.tx)*(i/o.sx),d=l-(l-h.ty)*(r/o.sy);(u!==h.tx||d!==h.ty)&&this.translate(u,d)}return this.scale(i,r),this}getRotation(){return M3(this.getMatrix())}rotate(t,e,i){if(e==null||i==null){const o=Le.getBBox(this.stage);e=o.width/2,i=o.height/2}const r=this.getMatrix().translate(e,i).rotate(t).translate(-e,-i);return this.setMatrix(r),this}getTranslation(){return T3(this.getMatrix())}translate(t,e){const i=this.getMatrix();i.e=t||0,i.f=e||0,this.setMatrix(i);const r=this.getTranslation();return this.options.x=r.tx,this.options.y=r.ty,this.graph.trigger("translate",Object.assign({},r)),this}setOrigin(t,e){return this.translate(t||0,e||0)}fitToContent(t,e,i,r){if(typeof t=="object"){const y=t;t=y.gridWidth||1,e=y.gridHeight||1,i=y.padding||0,r=y}else t=t||1,e=e||1,i=i||0,r==null&&(r={});const o=Rl(i),s=r.border||0,a=r.contentArea?vt.create(r.contentArea):this.getContentArea(r);s>0&&a.inflate(s);const l=this.getScale(),h=this.getTranslation(),u=l.sx,d=l.sy;a.x*=u,a.y*=d,a.width*=u,a.height*=d;let c=Math.max(Math.ceil((a.width+a.x)/t),1)*t,g=Math.max(Math.ceil((a.height+a.y)/e),1)*e,f=0,p=0;(r.allowNewOrigin==="negative"&&a.x<0||r.allowNewOrigin==="positive"&&a.x>=0||r.allowNewOrigin==="any")&&(f=Math.ceil(-a.x/t)*t,f+=o.left,c+=f),(r.allowNewOrigin==="negative"&&a.y<0||r.allowNewOrigin==="positive"&&a.y>=0||r.allowNewOrigin==="any")&&(p=Math.ceil(-a.y/e)*e,p+=o.top,g+=p),c+=o.right,g+=o.bottom,c=Math.max(c,r.minWidth||0),g=Math.max(g,r.minHeight||0),c=Math.min(c,r.maxWidth||Number.MAX_SAFE_INTEGER),g=Math.min(g,r.maxHeight||Number.MAX_SAFE_INTEGER);const m=this.getComputedSize(),v=c!==m.width||g!==m.height;return(f!==h.tx||p!==h.ty)&&this.translate(f,p),v&&this.resize(c,g),new vt(-f/u,-p/d,c/u,g/d)}scaleContentToFit(t={}){this.scaleContentToFitImpl(t)}scaleContentToFitImpl(t={},e=!0){let i,r;if(t.contentArea){const v=t.contentArea;i=this.graph.localToGraph(v),r=Y.create(v)}else i=this.getContentBBox(t),r=this.graph.graphToLocal(i);if(!i.width||!i.height)return;const o=Rl(t.padding),s=t.minScale||0,a=t.maxScale||Number.MAX_SAFE_INTEGER,l=t.minScaleX||s,h=t.maxScaleX||a,u=t.minScaleY||s,d=t.maxScaleY||a;let c;if(t.viewportArea)c=t.viewportArea;else{const v=this.getComputedSize(),b=this.getTranslation();c={x:b.tx,y:b.ty,width:v.width,height:v.height}}c=vt.create(c).moveAndExpand({x:o.left,y:o.top,width:-o.left-o.right,height:-o.top-o.bottom});const g=this.getScale();let f=c.width/i.width*g.sx,p=c.height/i.height*g.sy;t.preserveAspectRatio!==!1&&(f=p=Math.min(f,p));const m=t.scaleGrid;if(m&&(f=m*Math.floor(f/m),p=m*Math.floor(p/m)),f=Br(f,l,h),p=Br(p,u,d),this.scale(f,p),e){const v=this.options,b=c.x-r.x*f-v.x,y=c.y-r.y*p-v.y;this.translate(b,y)}}getContentArea(t={}){return t.useCellGeometry!==!1?this.model.getAllCellsBBox()||new vt:Le.getBBox(this.stage)}getContentBBox(t={}){return this.graph.localToGraph(this.getContentArea(t))}getGraphArea(){const t=vt.fromSize(this.getComputedSize());return this.graph.graphToLocal(t)}zoomToRect(t,e={}){const i=vt.create(t),r=this.graph;e.contentArea=i,e.viewportArea==null&&(e.viewportArea={x:r.options.x,y:r.options.y,width:this.options.width,height:this.options.height}),this.scaleContentToFitImpl(e,!1);const o=i.getCenter();return this.centerPoint(o.x,o.y),this}zoomToFit(t={}){return this.zoomToRect(this.getContentArea(t),t)}centerPoint(t,e){const i=this.getComputedSize(),r=this.getScale(),o=this.getTranslation(),s=i.width/2,a=i.height/2;t=typeof t=="number"?t:s,e=typeof e=="number"?e:a,t=s-t*r.sx,e=a-e*r.sy,(o.tx!==t||o.ty!==e)&&this.translate(t,e)}centerContent(t){const i=this.graph.getContentArea(t).getCenter();this.centerPoint(i.x,i.y)}centerCell(t){return this.positionCell(t,"center")}positionPoint(t,e,i){const r=this.getComputedSize();e=Qr(e,Math.max(0,r.width)),e<0&&(e=r.width+e),i=Qr(i,Math.max(0,r.height)),i<0&&(i=r.height+i);const o=this.getTranslation(),s=this.getScale(),a=e-t.x*s.sx,l=i-t.y*s.sy;(o.tx!==a||o.ty!==l)&&this.translate(a,l)}positionRect(t,e){const i=vt.create(t);switch(e){case"center":return this.positionPoint(i.getCenter(),"50%","50%");case"top":return this.positionPoint(i.getTopCenter(),"50%",0);case"top-right":return this.positionPoint(i.getTopRight(),"100%",0);case"right":return this.positionPoint(i.getRightMiddle(),"100%","50%");case"bottom-right":return this.positionPoint(i.getBottomRight(),"100%","100%");case"bottom":return this.positionPoint(i.getBottomCenter(),"50%","100%");case"bottom-left":return this.positionPoint(i.getBottomLeft(),0,"100%");case"left":return this.positionPoint(i.getLeftMiddle(),0,"50%");case"top-left":return this.positionPoint(i.getTopLeft(),0,0);default:return this}}positionCell(t,e){const i=t.getBBox();return this.positionRect(i,e)}positionContent(t,e){const i=this.graph.getContentArea(e);return this.positionRect(i,t)}}var k6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o};class D1 extends Qi{get elem(){return this.view.background}init(){this.startListening(),this.options.background&&this.draw(this.options.background)}startListening(){this.graph.on("scale",this.update,this),this.graph.on("translate",this.update,this)}stopListening(){this.graph.off("scale",this.update,this),this.graph.off("translate",this.update,this)}updateBackgroundImage(t={}){let e=t.size||"auto auto",i=t.position||"center";const r=this.graph.transform.getScale(),o=this.graph.translate();if(typeof i=="object"){const s=o.tx+r.sx*(i.x||0),a=o.ty+r.sy*(i.y||0);i=`${s}px ${a}px`}typeof e=="object"&&(e=vt.fromSize(e).scale(r.sx,r.sy),e=`${e.width}px ${e.height}px`),this.elem.style.backgroundSize=e,this.elem.style.backgroundPosition=i}drawBackgroundImage(t,e={}){if(!(t instanceof HTMLImageElement)){this.elem.style.backgroundImage="";return}const i=this.optionsCache;if(i&&i.image!==e.image)return;let r;const o=e.opacity,s=e.size;let a=e.repeat||"no-repeat";const l=ac.registry.get(a);if(typeof l=="function"){const u=e.quality||1;t.width*=u,t.height*=u;const d=l(t,e);if(!(d instanceof HTMLCanvasElement))throw new Error("Background pattern must return an HTML Canvas instance");r=d.toDataURL("image/png"),e.repeat&&a!==e.repeat?a=e.repeat:a="repeat",typeof s=="object"?(s.width*=d.width/t.width,s.height*=d.height/t.height):s===void 0&&(e.size={width:d.width/u,height:d.height/u})}else r=t.src,s===void 0&&(e.size={width:t.width,height:t.height});i!=null&&typeof e.size=="object"&&e.image===i.image&&e.repeat===i.repeat&&e.quality===i.quality&&(i.size=UC(e.size));const h=this.elem.style;h.backgroundImage=`url(${r})`,h.backgroundRepeat=a,h.opacity=o==null||o>=1?"":`${o}`,this.updateBackgroundImage(e)}updateBackgroundColor(t){this.elem.style.backgroundColor=t||""}updateBackgroundOptions(t){this.graph.options.background=t}update(){this.optionsCache&&this.updateBackgroundImage(this.optionsCache)}draw(t){const e=t||{};if(this.updateBackgroundOptions(t),this.updateBackgroundColor(e.color),e.image){this.optionsCache=UC(e);const i=document.createElement("img");i.onload=()=>this.drawBackgroundImage(i,t),i.setAttribute("crossorigin","anonymous"),i.src=e.image}else this.drawBackgroundImage(null),this.optionsCache=null}clear(){this.draw()}dispose(){this.clear(),this.stopListening()}}k6([Qi.dispose()],D1.prototype,"dispose",null);var P6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o};class F1 extends Qi{get widgetOptions(){return this.options.panning}get pannable(){return this.widgetOptions&&this.widgetOptions.enabled===!0}init(){this.onRightMouseDown=this.onRightMouseDown.bind(this),this.onSpaceKeyDown=this.onSpaceKeyDown.bind(this),this.onSpaceKeyUp=this.onSpaceKeyUp.bind(this),this.startListening(),this.updateClassName()}startListening(){this.graph.on("blank:mousedown",this.onMouseDown,this),this.graph.on("node:unhandled:mousedown",this.onMouseDown,this),this.graph.on("edge:unhandled:mousedown",this.onMouseDown,this),sn.on(this.graph.container,"mousedown",this.onRightMouseDown),sn.on(document.body,{keydown:this.onSpaceKeyDown,keyup:this.onSpaceKeyUp}),this.mousewheelHandle=new AE(this.graph.container,this.onMouseWheel.bind(this),this.allowMouseWheel.bind(this)),this.mousewheelHandle.enable()}stopListening(){this.graph.off("blank:mousedown",this.onMouseDown,this),this.graph.off("node:unhandled:mousedown",this.onMouseDown,this),this.graph.off("edge:unhandled:mousedown",this.onMouseDown,this),sn.off(this.graph.container,"mousedown",this.onRightMouseDown),sn.off(document.body,{keydown:this.onSpaceKeyDown,keyup:this.onSpaceKeyUp}),this.mousewheelHandle&&this.mousewheelHandle.disable()}allowPanning(t,e){return t.spaceKey=this.isSpaceKeyPressed,this.pannable&&Zh.isMatch(t,this.widgetOptions.modifiers,e)}startPanning(t){const e=this.view.normalizeEvent(t);this.clientX=e.clientX,this.clientY=e.clientY,this.panning=!0,this.updateClassName(),sn.on(document.body,{"mousemove.panning touchmove.panning":this.pan.bind(this),"mouseup.panning touchend.panning":this.stopPanning.bind(this),"mouseleave.panning":this.stopPanning.bind(this)}),sn.on(window,"mouseup.panning",this.stopPanning.bind(this))}pan(t){const e=this.view.normalizeEvent(t),i=e.clientX-this.clientX,r=e.clientY-this.clientY;this.clientX=e.clientX,this.clientY=e.clientY,this.graph.translateBy(i,r)}stopPanning(t){this.panning=!1,this.updateClassName(),sn.off(document.body,".panning"),sn.off(window,".panning")}updateClassName(){const t=this.view.container,e=this.view.prefixClassName("graph-panning"),i=this.view.prefixClassName("graph-pannable");this.pannable?this.panning?(we(t,e),kr(t,i)):(kr(t,e),we(t,i)):(kr(t,e),kr(t,i))}onMouseDown({e:t}){if(!this.allowBlankMouseDown(t))return;const e=this.graph.getPlugin("selection"),i=e&&e.allowRubberband(t,!0);(this.allowPanning(t,!0)||this.allowPanning(t)&&!i)&&this.startPanning(t)}onRightMouseDown(t){const e=this.widgetOptions.eventTypes;e?.includes("rightMouseDown")&&t.button===2&&this.allowPanning(t,!0)&&this.startPanning(t)}onMouseWheel(t,e,i){this.graph.translateBy(-e,-i)}onSpaceKeyDown(t){t.which===32&&(this.isSpaceKeyPressed=!0)}onSpaceKeyUp(t){t.which===32&&(this.isSpaceKeyPressed=!1)}allowBlankMouseDown(t){const e=this.widgetOptions.eventTypes;return e?.includes("leftMouseDown")&&t.button===0||e?.includes("mouseWheelDown")&&t.button===1}allowMouseWheel(t){var e;return this.pannable&&!t.ctrlKey&&((e=this.widgetOptions.eventTypes)===null||e===void 0?void 0:e.includes("mouseWheel"))}autoPanning(t,e){const r=this.graph.getGraphArea();let o=0,s=0;t<=r.left+10&&(o=-10),e<=r.top+10&&(s=-10),t>=r.right-10&&(o=10),e>=r.bottom-10&&(s=10),(o!==0||s!==0)&&this.graph.translateBy(-o,-s)}enablePanning(){this.pannable||(this.widgetOptions.enabled=!0,this.updateClassName())}disablePanning(){this.pannable&&(this.widgetOptions.enabled=!1,this.updateClassName())}dispose(){this.stopListening()}}P6([Qi.dispose()],F1.prototype,"dispose",null);var E6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o};class z1 extends Qi{constructor(){super(...arguments),this.cumulatedFactor=1}get widgetOptions(){return this.options.mousewheel}init(){this.container=this.graph.container,this.target=this.widgetOptions.global?document:this.container,this.mousewheelHandle=new AE(this.target,this.onMouseWheel.bind(this),this.allowMouseWheel.bind(this)),this.widgetOptions.enabled&&this.enable(!0)}get disabled(){return this.widgetOptions.enabled!==!0}enable(t){(this.disabled||t)&&(this.widgetOptions.enabled=!0,this.mousewheelHandle.enable())}disable(){this.disabled||(this.widgetOptions.enabled=!1,this.mousewheelHandle.disable())}allowMouseWheel(t){const e=this.widgetOptions.guard;return(e==null||e(t))&&Zh.isMatch(t,this.widgetOptions.modifiers)}onMouseWheel(t){const e=this.widgetOptions.guard;if((e==null||e(t))&&Zh.isMatch(t,this.widgetOptions.modifiers)){const i=this.widgetOptions.factor||1.2;this.currentScale==null&&(this.startPos={x:t.clientX,y:t.clientY},this.currentScale=this.graph.transform.getScale().sx),t.deltaY<0?this.currentScale<.15?this.cumulatedFactor=(this.currentScale+.01)/this.currentScale:(this.cumulatedFactor=Math.round(this.currentScale*i*20)/20/this.currentScale,this.cumulatedFactor===1&&(this.cumulatedFactor=1.05)):this.currentScale<=.15?this.cumulatedFactor=(this.currentScale-.01)/this.currentScale:(this.cumulatedFactor=Math.round(this.currentScale*(1/i)*20)/20/this.currentScale,this.cumulatedFactor===1&&(this.cumulatedFactor=.95)),this.cumulatedFactor=Math.max(.01,Math.min(this.currentScale*this.cumulatedFactor,160)/this.currentScale);const o=this.currentScale;let s=this.graph.transform.clampScale(o*this.cumulatedFactor);const a=this.widgetOptions.minScale||Number.MIN_SAFE_INTEGER,l=this.widgetOptions.maxScale||Number.MAX_SAFE_INTEGER;if(s=Br(s,a,l),s!==o)if(this.widgetOptions.zoomAtMousePosition){const u=!!this.graph.getPlugin("scroller")?this.graph.clientToLocal(this.startPos):this.graph.clientToGraph(this.startPos);this.graph.zoom(s,{absolute:!0,center:u.clone()})}else this.graph.zoom(s,{absolute:!0});this.currentScale=null,this.cumulatedFactor=1}}dispose(){this.disable()}}E6([As.dispose()],z1.prototype,"dispose",null);var L6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o};class wL extends Qi{init(){this.resetRenderArea=_z(this.resetRenderArea,200,{leading:!0}),this.resetRenderArea(),this.startListening()}startListening(){this.graph.on("translate",this.resetRenderArea,this),this.graph.on("scale",this.resetRenderArea,this),this.graph.on("resize",this.resetRenderArea,this)}stopListening(){this.graph.off("translate",this.resetRenderArea,this),this.graph.off("scale",this.resetRenderArea,this),this.graph.off("resize",this.resetRenderArea,this)}enableVirtualRender(){this.options.virtual=!0,this.resetRenderArea()}disableVirtualRender(){this.options.virtual=!1,this.graph.renderer.setRenderArea(void 0)}resetRenderArea(){if(this.options.virtual){const t=this.graph.getGraphArea();this.graph.renderer.setRenderArea(t)}}dispose(){this.stopListening()}}L6([Qi.dispose()],wL.prototype,"dispose",null);class O6{constructor(){this.isFlushing=!1,this.isFlushPending=!1,this.scheduleId=0,this.queue=[],this.frameInterval=33,this.initialTime=Date.now()}queueJob(t){if(t.priority&us.PRIOR)t.cb();else{const e=this.findInsertionIndex(t);e>=0&&this.queue.splice(e,0,t)}}queueFlush(){!this.isFlushing&&!this.isFlushPending&&(this.isFlushPending=!0,this.scheduleJob())}queueFlushSync(){!this.isFlushing&&!this.isFlushPending&&(this.isFlushPending=!0,this.flushJobsSync())}clearJobs(){this.queue.length=0,this.isFlushing=!1,this.isFlushPending=!1,this.cancelScheduleJob()}flushJobs(){this.isFlushPending=!1,this.isFlushing=!0;const t=this.getCurrentTime();let e;for(;(e=this.queue.shift())&&(e.cb(),!(this.getCurrentTime()-t>=this.frameInterval)););this.isFlushing=!1,this.queue.length&&this.queueFlush()}flushJobsSync(){this.isFlushPending=!1,this.isFlushing=!0;let t;for(;t=this.queue.shift();)try{t.cb()}catch{}this.isFlushing=!1}findInsertionIndex(t){let e=0,i=this.queue.length,r=i-1;const o=t.priority;for(;e<=r;){const s=(r-e>>1)+e;o<=this.queue[s].priority?e=s+1:(i=s,r=s-1)}return i}scheduleJob(){"requestIdleCallback"in window?(this.scheduleId&&this.cancelScheduleJob(),this.scheduleId=window.requestIdleCallback(this.flushJobs.bind(this),{timeout:100})):(this.scheduleId&&this.cancelScheduleJob(),this.scheduleId=window.setTimeout(this.flushJobs.bind(this)))}cancelScheduleJob(){"cancelIdleCallback"in window?(this.scheduleId&&window.cancelIdleCallback(this.scheduleId),this.scheduleId=0):(this.scheduleId&&clearTimeout(this.scheduleId),this.scheduleId=0)}getCurrentTime(){return typeof performance=="object"&&typeof performance.now=="function"?performance.now():Date.now()-this.initialTime}}var us;(function(n){n[n.Update=2]="Update",n[n.RenderEdge=4]="RenderEdge",n[n.RenderNode=8]="RenderNode",n[n.PRIOR=1048576]="PRIOR"})(us||(us={}));var I6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o};class ji extends As{get model(){return this.graph.model}get container(){return this.graph.view.stage}constructor(t){super(),this.views={},this.willRemoveViews={},this.queue=new O6,this.graph=t,this.init()}init(){this.startListening(),this.renderViews(this.model.getCells())}startListening(){this.model.on("reseted",this.onModelReseted,this),this.model.on("cell:added",this.onCellAdded,this),this.model.on("cell:removed",this.onCellRemoved,this),this.model.on("cell:change:zIndex",this.onCellZIndexChanged,this),this.model.on("cell:change:visible",this.onCellVisibleChanged,this)}stopListening(){this.model.off("reseted",this.onModelReseted,this),this.model.off("cell:added",this.onCellAdded,this),this.model.off("cell:removed",this.onCellRemoved,this),this.model.off("cell:change:zIndex",this.onCellZIndexChanged,this),this.model.off("cell:change:visible",this.onCellVisibleChanged,this)}onModelReseted({options:t}){this.queue.clearJobs(),this.removeZPivots(),this.resetViews();const e=this.model.getCells();this.renderViews(e,Object.assign(Object.assign({},t),{queue:e.map(i=>i.id)}))}onCellAdded({cell:t,options:e}){this.renderViews([t],e)}onCellRemoved({cell:t}){this.removeViews([t])}onCellZIndexChanged({cell:t,options:e}){const i=this.views[t.id];i&&this.requestViewUpdate(i.view,ji.FLAG_INSERT,e,us.Update,!0)}onCellVisibleChanged({cell:t,current:e}){this.toggleVisible(t,!!e)}requestViewUpdate(t,e,i={},r=us.Update,o=!0){const s=t.cell.id,a=this.views[s];if(!a)return;a.flag=e,a.options=i,(t.hasAction(e,["translate","resize","rotate"])||i.async===!1)&&(r=us.PRIOR,o=!1),this.queue.queueJob({id:s,priority:r,cb:()=>{this.renderViewInArea(t,e,i);const u=i.queue;if(u){const d=u.indexOf(t.cell.id);d>=0&&u.splice(d,1),u.length===0&&this.graph.trigger("render:done")}}}),this.getEffectedEdges(t).forEach(u=>{this.requestViewUpdate(u.view,u.flag,i,r,!1)}),o&&this.flush()}setRenderArea(t){this.renderArea=t,this.flushWaitingViews()}isViewMounted(t){if(t==null)return!1;const e=this.views[t.cell.id];return e?e.state===ji.ViewState.MOUNTED:!1}renderViews(t,e={}){t.sort((i,r)=>i.isNode()&&r.isEdge()?-1:0),t.forEach(i=>{const r=i.id,o=this.views;let s=0,a=o[r];if(a)s=ji.FLAG_INSERT;else{const l=this.createCellView(i);l&&(l.graph=this.graph,s=ji.FLAG_INSERT|l.getBootstrapFlag(),a={view:l,flag:s,options:e,state:ji.ViewState.CREATED},this.views[r]=a)}a&&this.requestViewUpdate(a.view,s,e,this.getRenderPriority(a.view),!1)}),this.flush()}renderViewInArea(t,e,i={}){const r=t.cell,o=r.id,s=this.views[o];if(!s)return;let a=0;this.isUpdatable(t)?(a=this.updateView(t,e,i),s.flag=a):s.state===ji.ViewState.MOUNTED?(a=this.updateView(t,e,i),s.flag=a):s.state=ji.ViewState.WAITING,a&&r.isEdge()&&(a&t.getFlag(["source","target"]))===0&&this.queue.queueJob({id:o,priority:us.RenderEdge,cb:()=>{this.updateView(t,e,i)}})}removeViews(t){t.forEach(e=>{const i=e.id,r=this.views[i];r&&(this.willRemoveViews[i]=r,delete this.views[i],this.queue.queueJob({id:i,priority:this.getRenderPriority(r.view),cb:()=>{this.removeView(r.view)}}))}),this.flush()}flush(){this.graph.options.async?this.queue.queueFlush():this.queue.queueFlushSync()}flushWaitingViews(){Object.values(this.views).forEach(t=>{if(t&&t.state===ji.ViewState.WAITING){const{view:e,flag:i,options:r}=t;this.requestViewUpdate(e,i,r,this.getRenderPriority(e),!1)}}),this.flush()}updateView(t,e,i={}){if(t==null)return 0;if(Ei.isCellView(t)){if(e&ji.FLAG_REMOVE)return this.removeView(t.cell),0;e&ji.FLAG_INSERT&&(this.insertView(t),e^=ji.FLAG_INSERT)}return e?t.confirmUpdate(e,i):0}insertView(t){const e=this.views[t.cell.id];if(e){const i=t.cell.getZIndex(),r=this.addZPivot(i);this.container.insertBefore(t.container,r),t.cell.isVisible()||this.toggleVisible(t.cell,!1),e.state=ji.ViewState.MOUNTED,this.graph.trigger("view:mounted",{view:t})}}resetViews(){this.willRemoveViews=Object.assign(Object.assign({},this.views),this.willRemoveViews),Object.values(this.willRemoveViews).forEach(t=>{t&&this.removeView(t.view)}),this.views={},this.willRemoveViews={}}removeView(t){const e=t.cell,i=this.willRemoveViews[e.id];i&&t&&(i.view.remove(),delete this.willRemoveViews[e.id],this.graph.trigger("view:unmounted",{view:t}))}toggleVisible(t,e){const i=this.model.getConnectedEdges(t);for(let o=0,s=i.length;o<s;o+=1){const a=i[o];if(e){const l=a.getSourceCell(),h=a.getTargetCell();if(l&&!l.isVisible()||h&&!h.isVisible())continue;this.toggleVisible(a,!0)}else this.toggleVisible(a,!1)}const r=this.views[t.id];r&&Qc(r.view.container,{display:e?"unset":"none"})}addZPivot(t=0){this.zPivots==null&&(this.zPivots={});const e=this.zPivots;let i=e[t];if(i)return i;i=e[t]=document.createComment(`z-index:${t+1}`);let r=-1/0;for(const s in e){const a=+s;a<t&&a>r&&(r=a,t-1)}const o=this.container;if(r!==-1/0){const s=e[r];o.insertBefore(i,s.nextSibling)}else o.insertBefore(i,o.firstChild);return i}removeZPivots(){this.zPivots&&Object.values(this.zPivots).forEach(t=>{t&&t.parentNode&&t.parentNode.removeChild(t)}),this.zPivots={}}createCellView(t){const e={graph:this.graph},i=this.graph.options.createCellView;if(i){const o=Nt(i,this.graph,t);if(o)return new o(t,e);if(o===null)return null}const r=t.view;if(r!=null&&typeof r=="string"){const o=Ei.registry.get(r);return o?new o(t,e):Ei.registry.onNotFound(r)}return t.isNode()?new oo(t,e):t.isEdge()?new Ts(t,e):null}getEffectedEdges(t){const e=[],i=t.cell,r=this.model.getConnectedEdges(i);for(let o=0,s=r.length;o<s;o+=1){const a=r[o],l=this.views[a.id];if(!l)continue;const h=l.view;if(!this.isViewMounted(h))continue;const u=["update"];a.getTargetCell()===i&&u.push("target"),a.getSourceCell()===i&&u.push("source"),e.push({id:a.id,view:h,flag:h.getFlag(u)})}return e}isUpdatable(t){if(t.isNodeView())return this.renderArea?this.renderArea.isIntersectWithRect(t.cell.getBBox()):!0;if(t.isEdgeView()){const e=t.cell,i=e.getSourceCell(),r=e.getTargetCell();if(this.renderArea&&i&&r)return this.renderArea.isIntersectWithRect(i.getBBox())||this.renderArea.isIntersectWithRect(r.getBBox())}return!0}getRenderPriority(t){return t.cell.isNode()?us.RenderNode:us.RenderEdge}dispose(){this.stopListening(),Object.keys(this.views).forEach(t=>{this.views[t].view.dispose()}),this.views={}}}I6([As.dispose()],ji.prototype,"dispose",null);(function(n){n.FLAG_INSERT=1<<30,n.FLAG_REMOVE=1<<29,n.FLAG_RENDER=(1<<26)-1})(ji||(ji={}));(function(n){(function(t){t[t.CREATED=0]="CREATED",t[t.MOUNTED=1]="MOUNTED",t[t.WAITING=2]="WAITING"})(n.ViewState||(n.ViewState={}))})(ji||(ji={}));var H6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o};class N1 extends Qi{constructor(){super(...arguments),this.schedule=new ji(this.graph)}requestViewUpdate(t,e,i={}){this.schedule.requestViewUpdate(t,e,i)}isViewMounted(t){return this.schedule.isViewMounted(t)}setRenderArea(t){this.schedule.setRenderArea(t)}findViewByElem(t){if(t==null)return null;const e=this.options.container,i=typeof t=="string"?e.querySelector(t):t instanceof Element?t:t[0];if(i){const r=this.graph.view.findAttr("data-cell-id",i);if(r){const o=this.schedule.views;if(o[r])return o[r].view}}return null}findViewByCell(t){if(t==null)return null;const e=ae.isCell(t)?t.id:t,i=this.schedule.views;return i[e]?i[e].view:null}findViewsFromPoint(t){const e={x:t.x,y:t.y};return this.model.getCells().map(i=>this.findViewByCell(i)).filter(i=>i!=null?Le.getBBox(i.container,{target:this.view.stage}).containsPoint(e):!1)}findEdgeViewsFromPoint(t,e=5){return this.model.getEdges().map(i=>this.findViewByCell(i)).filter(i=>{if(i!=null){const r=i.getClosestPoint(t);if(r)return r.distance(t)<=e}return!1})}findViewsInArea(t,e={}){const i=vt.create(t);return this.model.getCells().map(r=>this.findViewByCell(r)).filter(r=>{if(r){if(e.nodeOnly&&!r.isNodeView())return!1;const o=Le.getBBox(r.container,{target:this.view.stage});return o.width===0?o.inflate(1,0):o.height===0&&o.inflate(0,1),e.strict?i.containsRect(o):i.isIntersectWithRect(o)}return!1})}dispose(){this.schedule.dispose()}}H6([Qi.dispose()],N1.prototype,"dispose",null);var qS=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};class xL extends Qi{get cid(){return this.graph.view.cid}get svg(){return this.view.svg}get defs(){return this.view.defs}isDefined(t){return this.svg.getElementById(t)!=null}filter(t){let e=t.id;const i=t.name;if(e||(e=`filter-${i}-${this.cid}-${xb(JSON.stringify(t))}`),!this.isDefined(e)){const r=tu.registry.get(i);if(r==null)return tu.registry.onNotFound(i);const o=r(t.args||{}),s=Object.assign(Object.assign({x:-1,y:-1,width:3,height:3,filterUnits:"objectBoundingBox"},t.attrs),{id:e});Ft.create(qe.sanitize(o),s).appendTo(this.defs)}return e}gradient(t){let e=t.id;const i=t.type;if(e||(e=`gradient-${i}-${this.cid}-${xb(JSON.stringify(t))}`),!this.isDefined(e)){const o=t.stops.map(l=>{const h=l.opacity!=null&&Number.isFinite(l.opacity)?l.opacity:1;return`<stop offset="${l.offset}" stop-color="${l.color}" stop-opacity="${h}"/>`}),s=`<${i}>${o.join("")}</${i}>`,a=Object.assign({id:e},t.attrs);Ft.create(s,a).appendTo(this.defs)}return e}marker(t){const{id:e,refX:i,refY:r,markerUnits:o,markerOrient:s,tagName:a,children:l}=t,h=qS(t,["id","refX","refY","markerUnits","markerOrient","tagName","children"]);let u=e;if(u||(u=`marker-${this.cid}-${xb(JSON.stringify(t))}`),!this.isDefined(u)){a!=="path"&&delete h.d;const d=Ft.create("marker",{refX:i,refY:r,id:u,overflow:"visible",orient:s??"auto",markerUnits:o||"userSpaceOnUse"},l?l.map(c=>{var{tagName:g}=c,f=qS(c,["tagName"]);return Ft.create(`${g}`||"path",nc(Object.assign(Object.assign({},h),f)))}):[Ft.create(a||"path",nc(h))]);this.defs.appendChild(d.node)}return u}remove(t){const e=this.svg.getElementById(t);e&&e.parentNode&&e.parentNode.removeChild(e)}}class SL extends Qi{getClientMatrix(){return Ji(this.view.stage.getScreenCTM())}getClientOffset(){const t=this.view.svg.getBoundingClientRect();return new Y(t.left,t.top)}getPageOffset(){return this.getClientOffset().translate(window.scrollX,window.scrollY)}snapToGrid(t,e){return(typeof t=="number"?this.clientToLocalPoint(t,e):this.clientToLocalPoint(t.x,t.y)).snapToGrid(this.graph.getGridSize())}localToGraphPoint(t,e){const i=Y.create(t,e);return Le.transformPoint(i,this.graph.matrix())}localToClientPoint(t,e){const i=Y.create(t,e);return Le.transformPoint(i,this.getClientMatrix())}localToPagePoint(t,e){return(typeof t=="number"?this.localToGraphPoint(t,e):this.localToGraphPoint(t)).translate(this.getPageOffset())}localToGraphRect(t,e,i,r){const o=vt.create(t,e,i,r);return Le.transformRectangle(o,this.graph.matrix())}localToClientRect(t,e,i,r){const o=vt.create(t,e,i,r);return Le.transformRectangle(o,this.getClientMatrix())}localToPageRect(t,e,i,r){return(typeof t=="number"?this.localToGraphRect(t,e,i,r):this.localToGraphRect(t)).translate(this.getPageOffset())}graphToLocalPoint(t,e){const i=Y.create(t,e);return Le.transformPoint(i,this.graph.matrix().inverse())}clientToLocalPoint(t,e){const i=Y.create(t,e);return Le.transformPoint(i,this.getClientMatrix().inverse())}clientToGraphPoint(t,e){const i=Y.create(t,e);return Le.transformPoint(i,this.graph.matrix().multiply(this.getClientMatrix().inverse()))}pageToLocalPoint(t,e){const r=Y.create(t,e).diff(this.getPageOffset());return this.graphToLocalPoint(r)}graphToLocalRect(t,e,i,r){const o=vt.create(t,e,i,r);return Le.transformRectangle(o,this.graph.matrix().inverse())}clientToLocalRect(t,e,i,r){const o=vt.create(t,e,i,r);return Le.transformRectangle(o,this.getClientMatrix().inverse())}clientToGraphRect(t,e,i,r){const o=vt.create(t,e,i,r);return Le.transformRectangle(o,this.graph.matrix().multiply(this.getClientMatrix().inverse()))}pageToLocalRect(t,e,i,r){const o=vt.create(t,e,i,r),s=this.getPageOffset();return o.x-=s.x,o.y-=s.y,this.graphToLocalRect(o)}}var D6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o};class mp extends Qi{constructor(){super(...arguments),this.highlights={}}init(){this.startListening()}startListening(){this.graph.on("cell:highlight",this.onCellHighlight,this),this.graph.on("cell:unhighlight",this.onCellUnhighlight,this)}stopListening(){this.graph.off("cell:highlight",this.onCellHighlight,this),this.graph.off("cell:unhighlight",this.onCellUnhighlight,this)}onCellHighlight({view:t,magnet:e,options:i={}}){const r=this.resolveHighlighter(i);if(!r)return;const o=this.getHighlighterId(e,r);if(!this.highlights[o]){const s=r.highlighter;s.highlight(t,e,Object.assign({},r.args)),this.highlights[o]={cellView:t,magnet:e,highlighter:s,args:r.args}}}onCellUnhighlight({magnet:t,options:e={}}){const i=this.resolveHighlighter(e);if(!i)return;const r=this.getHighlighterId(t,i);this.unhighlight(r)}resolveHighlighter(t){const e=this.options;let i=t.highlighter;if(i==null){const a=t.type;i=a&&e.highlighting[a]||e.highlighting.default}if(i==null)return null;const r=typeof i=="string"?{name:i}:i,o=r.name,s=Cs.registry.get(o);return s==null?Cs.registry.onNotFound(o):(Cs.check(o,s),{name:o,highlighter:s,args:r.args||{}})}getHighlighterId(t,e){return T1(t),e.name+t.id+JSON.stringify(e.args)}unhighlight(t){const e=this.highlights[t];e&&(e.highlighter.unhighlight(e.cellView,e.magnet,e.args),delete this.highlights[t])}dispose(){Object.keys(this.highlights).forEach(t=>this.unhighlight(t)),this.stopListening()}}D6([mp.dispose()],mp.prototype,"dispose",null);var F6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o};class AL extends Qi{getScroller(){const t=this.graph.getPlugin("scroller");return t&&t.options.enabled?t:null}getContainer(){const t=this.getScroller();return t?t.container.parentElement:this.graph.container.parentElement}getSensorTarget(){const t=this.options.autoResize;if(t)return typeof t=="boolean"?this.getContainer():t}init(){if(this.options.autoResize){const e=this.getSensorTarget();e&&ap.bind(e,()=>{const i=e.offsetWidth,r=e.offsetHeight;this.resize(i,r)})}}resize(t,e){const i=this.getScroller();i?i.resize(t,e):this.graph.transform.resize(t,e)}dispose(){ap.clear(this.graph.container)}}F6([Qi.dispose()],AL.prototype,"dispose",null);var z6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o};class jn extends ar{get container(){return this.options.container}get[Symbol.toStringTag](){return jn.toStringTag}constructor(t){super(),this.installedPlugins=new Set,this.options=cc.get(t),this.css=new s_(this),this.view=new Fo(this),this.defs=new xL(this),this.coord=new SL(this),this.transform=new _L(this),this.highlight=new mp(this),this.grid=new H1(this),this.background=new D1(this),this.options.model?this.model=this.options.model:(this.model=new to,this.model.graph=this),this.renderer=new N1(this),this.panning=new F1(this),this.mousewheel=new z1(this),this.virtualRender=new wL(this),this.size=new AL(this)}isNode(t){return t.isNode()}isEdge(t){return t.isEdge()}resetCells(t,e={}){return this.model.resetCells(t,e),this}clearCells(t={}){return this.model.clear(t),this}toJSON(t={}){return this.model.toJSON(t)}parseJSON(t){return this.model.parseJSON(t)}fromJSON(t,e={}){return this.model.fromJSON(t,e),this}getCellById(t){return this.model.getCell(t)}addNode(t,e={}){return this.model.addNode(t,e)}addNodes(t,e={}){return this.addCell(t.map(i=>Ui.isNode(i)?i:this.createNode(i)),e)}createNode(t){return this.model.createNode(t)}removeNode(t,e={}){return this.model.removeCell(t,e)}addEdge(t,e={}){return this.model.addEdge(t,e)}addEdges(t,e={}){return this.addCell(t.map(i=>vi.isEdge(i)?i:this.createEdge(i)),e)}removeEdge(t,e={}){return this.model.removeCell(t,e)}createEdge(t){return this.model.createEdge(t)}addCell(t,e={}){return this.model.addCell(t,e),this}removeCell(t,e={}){return this.model.removeCell(t,e)}removeCells(t,e={}){return this.model.removeCells(t,e)}removeConnectedEdges(t,e={}){return this.model.removeConnectedEdges(t,e)}disconnectConnectedEdges(t,e={}){return this.model.disconnectConnectedEdges(t,e),this}hasCell(t){return this.model.has(t)}getCells(){return this.model.getCells()}getCellCount(){return this.model.total()}getNodes(){return this.model.getNodes()}getEdges(){return this.model.getEdges()}getOutgoingEdges(t){return this.model.getOutgoingEdges(t)}getIncomingEdges(t){return this.model.getIncomingEdges(t)}getConnectedEdges(t,e={}){return this.model.getConnectedEdges(t,e)}getRootNodes(){return this.model.getRoots()}getLeafNodes(){return this.model.getLeafs()}isRootNode(t){return this.model.isRoot(t)}isLeafNode(t){return this.model.isLeaf(t)}getNeighbors(t,e={}){return this.model.getNeighbors(t,e)}isNeighbor(t,e,i={}){return this.model.isNeighbor(t,e,i)}getSuccessors(t,e={}){return this.model.getSuccessors(t,e)}isSuccessor(t,e,i={}){return this.model.isSuccessor(t,e,i)}getPredecessors(t,e={}){return this.model.getPredecessors(t,e)}isPredecessor(t,e,i={}){return this.model.isPredecessor(t,e,i)}getCommonAncestor(...t){return this.model.getCommonAncestor(...t)}getSubGraph(t,e={}){return this.model.getSubGraph(t,e)}cloneSubGraph(t,e={}){return this.model.cloneSubGraph(t,e)}cloneCells(t){return this.model.cloneCells(t)}getNodesFromPoint(t,e){return this.model.getNodesFromPoint(t,e)}getNodesInArea(t,e,i,r,o){return this.model.getNodesInArea(t,e,i,r,o)}getNodesUnderNode(t,e={}){return this.model.getNodesUnderNode(t,e)}searchCell(t,e,i={}){return this.model.search(t,e,i),this}getShortestPath(t,e,i={}){return this.model.getShortestPath(t,e,i)}getAllCellsBBox(){return this.model.getAllCellsBBox()}getCellsBBox(t,e={}){return this.model.getCellsBBox(t,e)}startBatch(t,e={}){this.model.startBatch(t,e)}stopBatch(t,e={}){this.model.stopBatch(t,e)}batchUpdate(t,e,i){const r=typeof t=="string"?t:"update",o=typeof t=="string"?e:t,s=typeof e=="function"?i:e;this.startBatch(r,s);const a=o();return this.stopBatch(r,s),a}updateCellId(t,e){return this.model.updateCellId(t,e)}findView(t){return ae.isCell(t)?this.findViewByCell(t):this.findViewByElem(t)}findViews(t){return vt.isRectangleLike(t)?this.findViewsInArea(t):Y.isPointLike(t)?this.findViewsFromPoint(t):[]}findViewByCell(t){return this.renderer.findViewByCell(t)}findViewByElem(t){return this.renderer.findViewByElem(t)}findViewsFromPoint(t,e){const i=typeof t=="number"?{x:t,y:e}:t;return this.renderer.findViewsFromPoint(i)}findViewsInArea(t,e,i,r,o){const s=typeof t=="number"?{x:t,y:e,width:i,height:r}:t,a=typeof t=="number"?o:e;return this.renderer.findViewsInArea(s,a)}matrix(t){return typeof t>"u"?this.transform.getMatrix():(this.transform.setMatrix(t),this)}resize(t,e){const i=this.getPlugin("scroller");return i?i.resize(t,e):this.transform.resize(t,e),this}scale(t,e=t,i=0,r=0){return typeof t>"u"?this.transform.getScale():(this.transform.scale(t,e,i,r),this)}zoom(t,e){const i=this.getPlugin("scroller");if(i){if(typeof t>"u")return i.zoom();i.zoom(t,e)}else{if(typeof t>"u")return this.transform.getZoom();this.transform.zoom(t,e)}return this}zoomTo(t,e={}){const i=this.getPlugin("scroller");return i?i.zoom(t,Object.assign(Object.assign({},e),{absolute:!0})):this.transform.zoom(t,Object.assign(Object.assign({},e),{absolute:!0})),this}zoomToRect(t,e={}){const i=this.getPlugin("scroller");return i?i.zoomToRect(t,e):this.transform.zoomToRect(t,e),this}zoomToFit(t={}){const e=this.getPlugin("scroller");return e?e.zoomToFit(t):this.transform.zoomToFit(t),this}rotate(t,e,i){return typeof t>"u"?this.transform.getRotation():(this.transform.rotate(t,e,i),this)}translate(t,e){return typeof t>"u"?this.transform.getTranslation():(this.transform.translate(t,e),this)}translateBy(t,e){const i=this.translate(),r=i.tx+t,o=i.ty+e;return this.translate(r,o)}getGraphArea(){return this.transform.getGraphArea()}getContentArea(t={}){return this.transform.getContentArea(t)}getContentBBox(t={}){return this.transform.getContentBBox(t)}fitToContent(t,e,i,r){return this.transform.fitToContent(t,e,i,r)}scaleContentToFit(t={}){return this.transform.scaleContentToFit(t),this}center(t){return this.centerPoint(t)}centerPoint(t,e,i){const r=this.getPlugin("scroller");return r?r.centerPoint(t,e,i):this.transform.centerPoint(t,e),this}centerContent(t){const e=this.getPlugin("scroller");return e?e.centerContent(t):this.transform.centerContent(t),this}centerCell(t,e){const i=this.getPlugin("scroller");return i?i.centerCell(t,e):this.transform.centerCell(t),this}positionPoint(t,e,i,r={}){const o=this.getPlugin("scroller");return o?o.positionPoint(t,e,i,r):this.transform.positionPoint(t,e,i),this}positionRect(t,e,i){const r=this.getPlugin("scroller");return r?r.positionRect(t,e,i):this.transform.positionRect(t,e),this}positionCell(t,e,i){const r=this.getPlugin("scroller");return r?r.positionCell(t,e,i):this.transform.positionCell(t,e),this}positionContent(t,e){const i=this.getPlugin("scroller");return i?i.positionContent(t,e):this.transform.positionContent(t,e),this}snapToGrid(t,e){return this.coord.snapToGrid(t,e)}pageToLocal(t,e,i,r){return vt.isRectangleLike(t)?this.coord.pageToLocalRect(t):typeof t=="number"&&typeof e=="number"&&typeof i=="number"&&typeof r=="number"?this.coord.pageToLocalRect(t,e,i,r):this.coord.pageToLocalPoint(t,e)}localToPage(t,e,i,r){return vt.isRectangleLike(t)?this.coord.localToPageRect(t):typeof t=="number"&&typeof e=="number"&&typeof i=="number"&&typeof r=="number"?this.coord.localToPageRect(t,e,i,r):this.coord.localToPagePoint(t,e)}clientToLocal(t,e,i,r){return vt.isRectangleLike(t)?this.coord.clientToLocalRect(t):typeof t=="number"&&typeof e=="number"&&typeof i=="number"&&typeof r=="number"?this.coord.clientToLocalRect(t,e,i,r):this.coord.clientToLocalPoint(t,e)}localToClient(t,e,i,r){return vt.isRectangleLike(t)?this.coord.localToClientRect(t):typeof t=="number"&&typeof e=="number"&&typeof i=="number"&&typeof r=="number"?this.coord.localToClientRect(t,e,i,r):this.coord.localToClientPoint(t,e)}localToGraph(t,e,i,r){return vt.isRectangleLike(t)?this.coord.localToGraphRect(t):typeof t=="number"&&typeof e=="number"&&typeof i=="number"&&typeof r=="number"?this.coord.localToGraphRect(t,e,i,r):this.coord.localToGraphPoint(t,e)}graphToLocal(t,e,i,r){return vt.isRectangleLike(t)?this.coord.graphToLocalRect(t):typeof t=="number"&&typeof e=="number"&&typeof i=="number"&&typeof r=="number"?this.coord.graphToLocalRect(t,e,i,r):this.coord.graphToLocalPoint(t,e)}clientToGraph(t,e,i,r){return vt.isRectangleLike(t)?this.coord.clientToGraphRect(t):typeof t=="number"&&typeof e=="number"&&typeof i=="number"&&typeof r=="number"?this.coord.clientToGraphRect(t,e,i,r):this.coord.clientToGraphPoint(t,e)}defineFilter(t){return this.defs.filter(t)}defineGradient(t){return this.defs.gradient(t)}defineMarker(t){return this.defs.marker(t)}getGridSize(){return this.grid.getGridSize()}setGridSize(t){return this.grid.setGridSize(t),this}showGrid(){return this.grid.show(),this}hideGrid(){return this.grid.hide(),this}clearGrid(){return this.grid.clear(),this}drawGrid(t){return this.grid.draw(t),this}updateBackground(){return this.background.update(),this}drawBackground(t,e){const i=this.getPlugin("scroller");return i!=null&&(this.options.background==null||!e)?i.drawBackground(t,e):this.background.draw(t),this}clearBackground(t){const e=this.getPlugin("scroller");return e!=null&&(this.options.background==null||!t)?e.clearBackground(t):this.background.clear(),this}enableVirtualRender(){return this.virtualRender.enableVirtualRender(),this}disableVirtualRender(){return this.virtualRender.disableVirtualRender(),this}isMouseWheelEnabled(){return!this.mousewheel.disabled}enableMouseWheel(){return this.mousewheel.enable(),this}disableMouseWheel(){return this.mousewheel.disable(),this}toggleMouseWheel(t){return t==null?this.isMouseWheelEnabled()?this.disableMouseWheel():this.enableMouseWheel():t?this.enableMouseWheel():this.disableMouseWheel(),this}isPannable(){const t=this.getPlugin("scroller");return t?t.isPannable():this.panning.pannable}enablePanning(){const t=this.getPlugin("scroller");return t?t.enablePanning():this.panning.enablePanning(),this}disablePanning(){const t=this.getPlugin("scroller");return t?t.disablePanning():this.panning.disablePanning(),this}togglePanning(t){return t==null?this.isPannable()?this.disablePanning():this.enablePanning():t!==this.isPannable()&&(t?this.enablePanning():this.disablePanning()),this}use(t,...e){return this.installedPlugins.has(t)||(this.installedPlugins.add(t),t.init(this,...e)),this}getPlugin(t){return Array.from(this.installedPlugins).find(e=>e.name===t)}getPlugins(t){return Array.from(this.installedPlugins).filter(e=>t.includes(e.name))}enablePlugins(t){let e=t;Array.isArray(e)||(e=[e]);const i=this.getPlugins(e);return i?.forEach(r=>{var o;(o=r?.enable)===null||o===void 0||o.call(r)}),this}disablePlugins(t){let e=t;Array.isArray(e)||(e=[e]);const i=this.getPlugins(e);return i?.forEach(r=>{var o;(o=r?.disable)===null||o===void 0||o.call(r)}),this}isPluginEnabled(t){var e;const i=this.getPlugin(t);return(e=i?.isEnabled)===null||e===void 0?void 0:e.call(i)}disposePlugins(t){let e=t;Array.isArray(e)||(e=[e]);const i=this.getPlugins(e);return i?.forEach(r=>{r.dispose(),this.installedPlugins.delete(r)}),this}dispose(t=!0){t&&this.model.dispose(),this.css.dispose(),this.defs.dispose(),this.grid.dispose(),this.coord.dispose(),this.transform.dispose(),this.highlight.dispose(),this.background.dispose(),this.mousewheel.dispose(),this.panning.dispose(),this.view.dispose(),this.renderer.dispose(),this.installedPlugins.forEach(e=>{e.dispose()})}}z6([ar.dispose()],jn.prototype,"dispose",null);(function(n){n.View=Fo,n.Renderer=N1,n.MouseWheel=z1,n.DefsManager=xL,n.GridManager=H1,n.CoordManager=SL,n.TransformManager=_L,n.HighlightManager=mp,n.BackgroundManager=D1,n.PanningManager=F1})(jn||(jn={}));(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const i=e[Symbol.toStringTag];return i==null||i===n.toStringTag}n.isGraph=t})(jn||(jn={}));(function(n){function t(e,i){const r=e instanceof HTMLElement?new n({container:e}):new n(e);return i!=null&&r.fromJSON(i),r}n.render=t})(jn||(jn={}));(function(n){n.registerNode=Ui.registry.register,n.registerEdge=vi.registry.register,n.registerView=Ei.registry.register,n.registerAttr=Do.registry.register,n.registerGrid=Js.registry.register,n.registerFilter=tu.registry.register,n.registerNodeTool=nu.registry.register,n.registerEdgeTool=ru.registry.register,n.registerBackground=ac.registry.register,n.registerHighlighter=Cs.registry.register,n.registerPortLayout=ml.registry.register,n.registerPortLabelLayout=eu.registry.register,n.registerMarker=da.registry.register,n.registerRouter=Qs.registry.register,n.registerConnector=vl.registry.register,n.registerAnchor=ou.registry.register,n.registerEdgeAnchor=su.registry.register,n.registerConnectionPoint=au.registry.register})(jn||(jn={}));(function(n){n.unregisterNode=Ui.registry.unregister,n.unregisterEdge=vi.registry.unregister,n.unregisterView=Ei.registry.unregister,n.unregisterAttr=Do.registry.unregister,n.unregisterGrid=Js.registry.unregister,n.unregisterFilter=tu.registry.unregister,n.unregisterNodeTool=nu.registry.unregister,n.unregisterEdgeTool=ru.registry.unregister,n.unregisterBackground=ac.registry.unregister,n.unregisterHighlighter=Cs.registry.unregister,n.unregisterPortLayout=ml.registry.unregister,n.unregisterPortLabelLayout=eu.registry.unregister,n.unregisterMarker=da.registry.unregister,n.unregisterRouter=Qs.registry.unregister,n.unregisterConnector=vl.registry.unregister,n.unregisterAnchor=ou.registry.unregister,n.unregisterEdgeAnchor=su.registry.unregister,n.unregisterConnectionPoint=au.registry.unregister})(jn||(jn={}));var N6=function(n,t,e,i){var r=arguments.length,o=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(s=n[a])&&(o=(r<3?s(o):r>3?s(t,e,o):s(t,e))||o);return r>3&&o&&Object.defineProperty(t,e,o),o},W6=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]]);return e};class uu extends Ui{}(function(n){class t extends oo{init(){super.init(),this.cell.on("change:*",this.onCellChangeAny,this)}onCellChangeAny({key:i}){const r=n.shapeMaps[this.cell.shape];if(r){const{effect:o}=r;(!o||o.includes(i))&&this.renderHTMLComponent()}}confirmUpdate(i){const r=super.confirmUpdate(i);return this.handleAction(r,t.action,()=>this.renderHTMLComponent())}renderHTMLComponent(){const i=this.selectors&&this.selectors.foContent;if(i){Zc(i);const r=n.shapeMaps[this.cell.shape];if(!r)return;let{html:o}=r;typeof o=="function"&&(o=o(this.cell)),o&&(typeof o=="string"?i.innerHTML=o:Jc(i,o))}}dispose(){this.cell.off("change:*",this.onCellChangeAny,this)}}N6([t.dispose()],t.prototype,"dispose",null),n.View=t,(function(e){e.action="html",e.config({bootstrap:[e.action],actions:{html:e.action}}),oo.registry.register("html-view",e,!0)})(t=n.View||(n.View={}))})(uu||(uu={}));(function(n){n.config({view:"html-view",markup:[{tagName:"rect",selector:"body"},Object.assign({},qe.getForeignObjectMarkup()),{tagName:"text",selector:"label"}],attrs:{body:{fill:"none",stroke:"none",refWidth:"100%",refHeight:"100%"},fo:{refWidth:"100%",refHeight:"100%"}}}),Ui.registry.register("html",n,!0)})(uu||(uu={}));(function(n){n.shapeMaps={};function t(e){const{shape:i,html:r,effect:o,inherit:s}=e,a=W6(e,["shape","html","effect","inherit"]);if(!i)throw new Error("should specify shape in config");n.shapeMaps[i]={html:r,effect:o},jn.registerNode(i,Object.assign({inherit:s||"html"},a),!0)}n.register=t})(uu||(uu={}));function $m(n){return NP()?(Pf(n),!0):!1}function gs(n){return typeof n=="function"?n():It(n)}const j6=typeof window<"u"&&typeof document<"u",V6=n=>typeof n<"u",G6=Object.prototype.toString,$6=n=>G6.call(n)==="[object Object]",U6=()=>{};function X6(n,t){function e(...i){return new Promise((r,o)=>{Promise.resolve(n(()=>t.apply(this,i),{fn:t,thisArg:this,args:i})).then(r).catch(o)})}return e}const ML=n=>n();function Y6(n=ML){const t=fi(!0);function e(){t.value=!1}function i(){t.value=!0}const r=(...o)=>{t.value&&n(...o)};return{isActive:Pz(t),pause:e,resume:i,eventFilter:r}}function KS(n,t=!1,e="Timeout"){return new Promise((i,r)=>{setTimeout(t?()=>r(e):i,n)})}function q6(n,t,e={}){const{eventFilter:i=ML,...r}=e;return He(n,X6(i,t),r)}function Kl(n,t,e={}){const{eventFilter:i,...r}=e,{eventFilter:o,pause:s,resume:a,isActive:l}=Y6(i);return{stop:q6(n,t,{...r,eventFilter:o}),pause:s,resume:a,isActive:l}}function K6(n,t={}){if(!y1(n))return Tz(n);const e=Array.isArray(n.value)?Array.from({length:n.value.length}):{};for(const i in n.value)e[i]=Rz(()=>({get(){return n.value[i]},set(r){var o;if((o=gs(t.replaceRef))!=null?o:!0)if(Array.isArray(n.value)){const a=[...n.value];a[i]=r,n.value=a}else{const a={...n.value,[i]:r};Object.setPrototypeOf(a,Object.getPrototypeOf(n.value)),n.value=a}else n.value[i]=r}}));return e}function a_(n,t=!1){function e(d,{flush:c="sync",deep:g=!1,timeout:f,throwOnTimeout:p}={}){let m=null;const b=[new Promise(y=>{m=He(n,C=>{d(C)!==t&&(m?.(),y(C))},{flush:c,deep:g,immediate:!0})})];return f!=null&&b.push(KS(f,p).then(()=>gs(n)).finally(()=>m?.())),Promise.race(b)}function i(d,c){if(!y1(d))return e(C=>C===d,c);const{flush:g="sync",deep:f=!1,timeout:p,throwOnTimeout:m}=c??{};let v=null;const y=[new Promise(C=>{v=He([n,d],([w,_])=>{t!==(w===_)&&(v?.(),C(w))},{flush:g,deep:f,immediate:!0})})];return p!=null&&y.push(KS(p,m).then(()=>gs(n)).finally(()=>(v?.(),gs(n)))),Promise.race(y)}function r(d){return e(c=>!!c,d)}function o(d){return i(null,d)}function s(d){return i(void 0,d)}function a(d){return e(Number.isNaN,d)}function l(d,c){return e(g=>{const f=Array.from(g);return f.includes(d)||f.includes(gs(d))},c)}function h(d){return u(1,d)}function u(d=1,c){let g=-1;return e(()=>(g+=1,g>=d),c)}return Array.isArray(gs(n))?{toMatch:e,toContains:l,changed:h,changedTimes:u,get not(){return a_(n,!t)}}:{toMatch:e,toBe:i,toBeTruthy:r,toBeNull:o,toBeNaN:a,toBeUndefined:s,changed:h,changedTimes:u,get not(){return a_(n,!t)}}}function l_(n){return a_(n)}function Z6(n){var t;const e=gs(n);return(t=e?.$el)!=null?t:e}const TL=j6?window:void 0;function RL(...n){let t,e,i,r;if(typeof n[0]=="string"||Array.isArray(n[0])?([e,i,r]=n,t=TL):[t,e,i,r]=n,!t)return U6;Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]);const o=[],s=()=>{o.forEach(u=>u()),o.length=0},a=(u,d,c,g)=>(u.addEventListener(d,c,g),()=>u.removeEventListener(d,c,g)),l=He(()=>[Z6(t),gs(r)],([u,d])=>{if(s(),!u)return;const c=$6(d)?{...d}:d;o.push(...e.flatMap(g=>i.map(f=>a(u,g,f,c))))},{immediate:!0,flush:"post"}),h=()=>{l(),s()};return $m(h),h}function J6(n){return typeof n=="function"?n:typeof n=="string"?t=>t.key===n:Array.isArray(n)?t=>n.includes(t.key):()=>!0}function ZS(...n){let t,e,i={};n.length===3?(t=n[0],e=n[1],i=n[2]):n.length===2?typeof n[1]=="object"?(t=!0,e=n[0],i=n[1]):(t=n[0],e=n[1]):(t=!0,e=n[0]);const{target:r=TL,eventName:o="keydown",passive:s=!1,dedupe:a=!1}=i,l=J6(t);return RL(r,o,u=>{u.repeat&&gs(a)||l(u)&&e(u)},s)}function Q6(n){return JSON.parse(JSON.stringify(n))}function Bb(n,t,e,i={}){var r,o,s;const{clone:a=!1,passive:l=!1,eventName:h,deep:u=!1,defaultValue:d,shouldEmit:c}=i,g=qc(),f=e||g?.emit||((r=g?.$emit)==null?void 0:r.bind(g))||((s=(o=g?.proxy)==null?void 0:o.$emit)==null?void 0:s.bind(g?.proxy));let p=h;t||(t="modelValue"),p=p||`update:${t.toString()}`;const m=y=>a?typeof a=="function"?a(y):Q6(y):y,v=()=>V6(n[t])?m(n[t]):d,b=y=>{c?c(y)&&f(p,y):f(p,y)};if(l){const y=v(),C=fi(y);let w=!1;return He(()=>n[t],_=>{w||(w=!0,C.value=m(_),ys(()=>w=!1))}),He(C,_=>{!w&&(_!==n[t]||u)&&b(_)},{deep:u}),C}else return ee({get(){return v()},set(y){b(y)}})}var t4={value:()=>{}};function Um(){for(var n=0,t=arguments.length,e={},i;n<t;++n){if(!(i=arguments[n]+"")||i in e||/[\s.]/.test(i))throw new Error("illegal type: "+i);e[i]=[]}return new Lf(e)}function Lf(n){this._=n}function e4(n,t){return n.trim().split(/^|\s+/).map(function(e){var i="",r=e.indexOf(".");if(r>=0&&(i=e.slice(r+1),e=e.slice(0,r)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:i}})}Lf.prototype=Um.prototype={constructor:Lf,on:function(n,t){var e=this._,i=e4(n+"",e),r,o=-1,s=i.length;if(arguments.length<2){for(;++o<s;)if((r=(n=i[o]).type)&&(r=i4(e[r],n.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++o<s;)if(r=(n=i[o]).type)e[r]=JS(e[r],n.name,t);else if(t==null)for(r in e)e[r]=JS(e[r],n.name,null);return this},copy:function(){var n={},t=this._;for(var e in t)n[e]=t[e].slice();return new Lf(n)},call:function(n,t){if((r=arguments.length-2)>0)for(var e=new Array(r),i=0,r,o;i<r;++i)e[i]=arguments[i+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(o=this._[n],i=0,r=o.length;i<r;++i)o[i].value.apply(t,e)},apply:function(n,t,e){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var i=this._[n],r=0,o=i.length;r<o;++r)i[r].value.apply(t,e)}};function i4(n,t){for(var e=0,i=n.length,r;e<i;++e)if((r=n[e]).name===t)return r.value}function JS(n,t,e){for(var i=0,r=n.length;i<r;++i)if(n[i].name===t){n[i]=t4,n=n.slice(0,i).concat(n.slice(i+1));break}return e!=null&&n.push({name:t,value:e}),n}var h_="http://www.w3.org/1999/xhtml";const QS={svg:"http://www.w3.org/2000/svg",xhtml:h_,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Xm(n){var t=n+="",e=t.indexOf(":");return e>=0&&(t=n.slice(0,e))!=="xmlns"&&(n=n.slice(e+1)),QS.hasOwnProperty(t)?{space:QS[t],local:n}:n}function n4(n){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===h_&&t.documentElement.namespaceURI===h_?t.createElement(n):t.createElementNS(e,n)}}function r4(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function BL(n){var t=Xm(n);return(t.local?r4:n4)(t)}function o4(){}function W1(n){return n==null?o4:function(){return this.querySelector(n)}}function s4(n){typeof n!="function"&&(n=W1(n));for(var t=this._groups,e=t.length,i=new Array(e),r=0;r<e;++r)for(var o=t[r],s=o.length,a=i[r]=new Array(s),l,h,u=0;u<s;++u)(l=o[u])&&(h=n.call(l,l.__data__,u,o))&&("__data__"in l&&(h.__data__=l.__data__),a[u]=h);return new lr(i,this._parents)}function a4(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function l4(){return[]}function kL(n){return n==null?l4:function(){return this.querySelectorAll(n)}}function h4(n){return function(){return a4(n.apply(this,arguments))}}function u4(n){typeof n=="function"?n=h4(n):n=kL(n);for(var t=this._groups,e=t.length,i=[],r=[],o=0;o<e;++o)for(var s=t[o],a=s.length,l,h=0;h<a;++h)(l=s[h])&&(i.push(n.call(l,l.__data__,h,s)),r.push(l));return new lr(i,r)}function PL(n){return function(){return this.matches(n)}}function EL(n){return function(t){return t.matches(n)}}var d4=Array.prototype.find;function c4(n){return function(){return d4.call(this.children,n)}}function g4(){return this.firstElementChild}function f4(n){return this.select(n==null?g4:c4(typeof n=="function"?n:EL(n)))}var p4=Array.prototype.filter;function m4(){return Array.from(this.children)}function v4(n){return function(){return p4.call(this.children,n)}}function b4(n){return this.selectAll(n==null?m4:v4(typeof n=="function"?n:EL(n)))}function y4(n){typeof n!="function"&&(n=PL(n));for(var t=this._groups,e=t.length,i=new Array(e),r=0;r<e;++r)for(var o=t[r],s=o.length,a=i[r]=[],l,h=0;h<s;++h)(l=o[h])&&n.call(l,l.__data__,h,o)&&a.push(l);return new lr(i,this._parents)}function LL(n){return new Array(n.length)}function C4(){return new lr(this._enter||this._groups.map(LL),this._parents)}function vp(n,t){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=t}vp.prototype={constructor:vp,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,t){return this._parent.insertBefore(n,t)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function _4(n){return function(){return n}}function w4(n,t,e,i,r,o){for(var s=0,a,l=t.length,h=o.length;s<h;++s)(a=t[s])?(a.__data__=o[s],i[s]=a):e[s]=new vp(n,o[s]);for(;s<l;++s)(a=t[s])&&(r[s]=a)}function x4(n,t,e,i,r,o,s){var a,l,h=new Map,u=t.length,d=o.length,c=new Array(u),g;for(a=0;a<u;++a)(l=t[a])&&(c[a]=g=s.call(l,l.__data__,a,t)+"",h.has(g)?r[a]=l:h.set(g,l));for(a=0;a<d;++a)g=s.call(n,o[a],a,o)+"",(l=h.get(g))?(i[a]=l,l.__data__=o[a],h.delete(g)):e[a]=new vp(n,o[a]);for(a=0;a<u;++a)(l=t[a])&&h.get(c[a])===l&&(r[a]=l)}function S4(n){return n.__data__}function A4(n,t){if(!arguments.length)return Array.from(this,S4);var e=t?x4:w4,i=this._parents,r=this._groups;typeof n!="function"&&(n=_4(n));for(var o=r.length,s=new Array(o),a=new Array(o),l=new Array(o),h=0;h<o;++h){var u=i[h],d=r[h],c=d.length,g=M4(n.call(u,u&&u.__data__,h,i)),f=g.length,p=a[h]=new Array(f),m=s[h]=new Array(f),v=l[h]=new Array(c);e(u,d,p,m,v,g,t);for(var b=0,y=0,C,w;b<f;++b)if(C=p[b]){for(b>=y&&(y=b+1);!(w=m[y])&&++y<f;);C._next=w||null}}return s=new lr(s,i),s._enter=a,s._exit=l,s}function M4(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function T4(){return new lr(this._exit||this._groups.map(LL),this._parents)}function R4(n,t,e){var i=this.enter(),r=this,o=this.exit();return typeof n=="function"?(i=n(i),i&&(i=i.selection())):i=i.append(n+""),t!=null&&(r=t(r),r&&(r=r.selection())),e==null?o.remove():e(o),i&&r?i.merge(r).order():r}function B4(n){for(var t=n.selection?n.selection():n,e=this._groups,i=t._groups,r=e.length,o=i.length,s=Math.min(r,o),a=new Array(r),l=0;l<s;++l)for(var h=e[l],u=i[l],d=h.length,c=a[l]=new Array(d),g,f=0;f<d;++f)(g=h[f]||u[f])&&(c[f]=g);for(;l<r;++l)a[l]=e[l];return new lr(a,this._parents)}function k4(){for(var n=this._groups,t=-1,e=n.length;++t<e;)for(var i=n[t],r=i.length-1,o=i[r],s;--r>=0;)(s=i[r])&&(o&&s.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(s,o),o=s);return this}function P4(n){n||(n=E4);function t(d,c){return d&&c?n(d.__data__,c.__data__):!d-!c}for(var e=this._groups,i=e.length,r=new Array(i),o=0;o<i;++o){for(var s=e[o],a=s.length,l=r[o]=new Array(a),h,u=0;u<a;++u)(h=s[u])&&(l[u]=h);l.sort(t)}return new lr(r,this._parents).order()}function E4(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function L4(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function O4(){return Array.from(this)}function I4(){for(var n=this._groups,t=0,e=n.length;t<e;++t)for(var i=n[t],r=0,o=i.length;r<o;++r){var s=i[r];if(s)return s}return null}function H4(){let n=0;for(const t of this)++n;return n}function D4(){return!this.node()}function F4(n){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var r=t[e],o=0,s=r.length,a;o<s;++o)(a=r[o])&&n.call(a,a.__data__,o,r);return this}function z4(n){return function(){this.removeAttribute(n)}}function N4(n){return function(){this.removeAttributeNS(n.space,n.local)}}function W4(n,t){return function(){this.setAttribute(n,t)}}function j4(n,t){return function(){this.setAttributeNS(n.space,n.local,t)}}function V4(n,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(n):this.setAttribute(n,e)}}function G4(n,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,e)}}function $4(n,t){var e=Xm(n);if(arguments.length<2){var i=this.node();return e.local?i.getAttributeNS(e.space,e.local):i.getAttribute(e)}return this.each((t==null?e.local?N4:z4:typeof t=="function"?e.local?G4:V4:e.local?j4:W4)(e,t))}function OL(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function U4(n){return function(){this.style.removeProperty(n)}}function X4(n,t,e){return function(){this.style.setProperty(n,t,e)}}function Y4(n,t,e){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(n):this.style.setProperty(n,i,e)}}function q4(n,t,e){return arguments.length>1?this.each((t==null?U4:typeof t=="function"?Y4:X4)(n,t,e??"")):du(this.node(),n)}function du(n,t){return n.style.getPropertyValue(t)||OL(n).getComputedStyle(n,null).getPropertyValue(t)}function K4(n){return function(){delete this[n]}}function Z4(n,t){return function(){this[n]=t}}function J4(n,t){return function(){var e=t.apply(this,arguments);e==null?delete this[n]:this[n]=e}}function Q4(n,t){return arguments.length>1?this.each((t==null?K4:typeof t=="function"?J4:Z4)(n,t)):this.node()[n]}function IL(n){return n.trim().split(/^|\s+/)}function j1(n){return n.classList||new HL(n)}function HL(n){this._node=n,this._names=IL(n.getAttribute("class")||"")}HL.prototype={add:function(n){var t=this._names.indexOf(n);t<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var t=this._names.indexOf(n);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function DL(n,t){for(var e=j1(n),i=-1,r=t.length;++i<r;)e.add(t[i])}function FL(n,t){for(var e=j1(n),i=-1,r=t.length;++i<r;)e.remove(t[i])}function t8(n){return function(){DL(this,n)}}function e8(n){return function(){FL(this,n)}}function i8(n,t){return function(){(t.apply(this,arguments)?DL:FL)(this,n)}}function n8(n,t){var e=IL(n+"");if(arguments.length<2){for(var i=j1(this.node()),r=-1,o=e.length;++r<o;)if(!i.contains(e[r]))return!1;return!0}return this.each((typeof t=="function"?i8:t?t8:e8)(e,t))}function r8(){this.textContent=""}function o8(n){return function(){this.textContent=n}}function s8(n){return function(){var t=n.apply(this,arguments);this.textContent=t??""}}function a8(n){return arguments.length?this.each(n==null?r8:(typeof n=="function"?s8:o8)(n)):this.node().textContent}function l8(){this.innerHTML=""}function h8(n){return function(){this.innerHTML=n}}function u8(n){return function(){var t=n.apply(this,arguments);this.innerHTML=t??""}}function d8(n){return arguments.length?this.each(n==null?l8:(typeof n=="function"?u8:h8)(n)):this.node().innerHTML}function c8(){this.nextSibling&&this.parentNode.appendChild(this)}function g8(){return this.each(c8)}function f8(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function p8(){return this.each(f8)}function m8(n){var t=typeof n=="function"?n:BL(n);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function v8(){return null}function b8(n,t){var e=typeof n=="function"?n:BL(n),i=t==null?v8:typeof t=="function"?t:W1(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),i.apply(this,arguments)||null)})}function y8(){var n=this.parentNode;n&&n.removeChild(this)}function C8(){return this.each(y8)}function _8(){var n=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(n,this.nextSibling):n}function w8(){var n=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(n,this.nextSibling):n}function x8(n){return this.select(n?w8:_8)}function S8(n){return arguments.length?this.property("__data__",n):this.node().__data__}function A8(n){return function(t){n.call(this,t,this.__data__)}}function M8(n){return n.trim().split(/^|\s+/).map(function(t){var e="",i=t.indexOf(".");return i>=0&&(e=t.slice(i+1),t=t.slice(0,i)),{type:t,name:e}})}function T8(n){return function(){var t=this.__on;if(t){for(var e=0,i=-1,r=t.length,o;e<r;++e)o=t[e],(!n.type||o.type===n.type)&&o.name===n.name?this.removeEventListener(o.type,o.listener,o.options):t[++i]=o;++i?t.length=i:delete this.__on}}}function R8(n,t,e){return function(){var i=this.__on,r,o=A8(t);if(i){for(var s=0,a=i.length;s<a;++s)if((r=i[s]).type===n.type&&r.name===n.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=e),r.value=t;return}}this.addEventListener(n.type,o,e),r={type:n.type,name:n.name,value:t,listener:o,options:e},i?i.push(r):this.__on=[r]}}function B8(n,t,e){var i=M8(n+""),r,o=i.length,s;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,h=a.length,u;l<h;++l)for(r=0,u=a[l];r<o;++r)if((s=i[r]).type===u.type&&s.name===u.name)return u.value}return}for(a=t?R8:T8,r=0;r<o;++r)this.each(a(i[r],t,e));return this}function zL(n,t,e){var i=OL(n),r=i.CustomEvent;typeof r=="function"?r=new r(t,e):(r=i.document.createEvent("Event"),e?(r.initEvent(t,e.bubbles,e.cancelable),r.detail=e.detail):r.initEvent(t,!1,!1)),n.dispatchEvent(r)}function k8(n,t){return function(){return zL(this,n,t)}}function P8(n,t){return function(){return zL(this,n,t.apply(this,arguments))}}function E8(n,t){return this.each((typeof t=="function"?P8:k8)(n,t))}function*L8(){for(var n=this._groups,t=0,e=n.length;t<e;++t)for(var i=n[t],r=0,o=i.length,s;r<o;++r)(s=i[r])&&(yield s)}var NL=[null];function lr(n,t){this._groups=n,this._parents=t}function ig(){return new lr([[document.documentElement]],NL)}function O8(){return this}lr.prototype=ig.prototype={constructor:lr,select:s4,selectAll:u4,selectChild:f4,selectChildren:b4,filter:y4,data:A4,enter:C4,exit:T4,join:R4,merge:B4,selection:O8,order:k4,sort:P4,call:L4,nodes:O4,node:I4,size:H4,empty:D4,each:F4,attr:$4,style:q4,property:Q4,classed:n8,text:a8,html:d8,raise:g8,lower:p8,append:m8,insert:b8,remove:C8,clone:x8,datum:S8,on:B8,dispatch:E8,[Symbol.iterator]:L8};function Yr(n){return typeof n=="string"?new lr([[document.querySelector(n)]],[document.documentElement]):new lr([[n]],NL)}function I8(n){let t;for(;t=n.sourceEvent;)n=t;return n}function wo(n,t){if(n=I8(n),t===void 0&&(t=n.currentTarget),t){var e=t.ownerSVGElement||t;if(e.createSVGPoint){var i=e.createSVGPoint();return i.x=n.clientX,i.y=n.clientY,i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}if(t.getBoundingClientRect){var r=t.getBoundingClientRect();return[n.clientX-r.left-t.clientLeft,n.clientY-r.top-t.clientTop]}}return[n.pageX,n.pageY]}const H8={passive:!1},gc={capture:!0,passive:!1};function kb(n){n.stopImmediatePropagation()}function Sh(n){n.preventDefault(),n.stopImmediatePropagation()}function WL(n){var t=n.document.documentElement,e=Yr(n).on("dragstart.drag",Sh,gc);"onselectstart"in t?e.on("selectstart.drag",Sh,gc):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}function jL(n,t){var e=n.document.documentElement,i=Yr(n).on("dragstart.drag",null);t&&(i.on("click.drag",Sh,gc),setTimeout(function(){i.on("click.drag",null)},0)),"onselectstart"in e?i.on("selectstart.drag",null):(e.style.MozUserSelect=e.__noselect,delete e.__noselect)}const Eg=n=>()=>n;function u_(n,{sourceEvent:t,subject:e,target:i,identifier:r,active:o,x:s,y:a,dx:l,dy:h,dispatch:u}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},subject:{value:e,enumerable:!0,configurable:!0},target:{value:i,enumerable:!0,configurable:!0},identifier:{value:r,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:s,enumerable:!0,configurable:!0},y:{value:a,enumerable:!0,configurable:!0},dx:{value:l,enumerable:!0,configurable:!0},dy:{value:h,enumerable:!0,configurable:!0},_:{value:u}})}u_.prototype.on=function(){var n=this._.on.apply(this._,arguments);return n===this._?this:n};function D8(n){return!n.ctrlKey&&!n.button}function F8(){return this.parentNode}function z8(n,t){return t??{x:n.x,y:n.y}}function N8(){return navigator.maxTouchPoints||"ontouchstart"in this}function W8(){var n=D8,t=F8,e=z8,i=N8,r={},o=Um("start","drag","end"),s=0,a,l,h,u,d=0;function c(C){C.on("mousedown.drag",g).filter(i).on("touchstart.drag",m).on("touchmove.drag",v,H8).on("touchend.drag touchcancel.drag",b).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function g(C,w){if(!(u||!n.call(this,C,w))){var _=y(this,t.call(this,C,w),C,w,"mouse");_&&(Yr(C.view).on("mousemove.drag",f,gc).on("mouseup.drag",p,gc),WL(C.view),kb(C),h=!1,a=C.clientX,l=C.clientY,_("start",C))}}function f(C){if(Sh(C),!h){var w=C.clientX-a,_=C.clientY-l;h=w*w+_*_>d}r.mouse("drag",C)}function p(C){Yr(C.view).on("mousemove.drag mouseup.drag",null),jL(C.view,h),Sh(C),r.mouse("end",C)}function m(C,w){if(n.call(this,C,w)){var _=C.changedTouches,A=t.call(this,C,w),x=_.length,S,T;for(S=0;S<x;++S)(T=y(this,A,C,w,_[S].identifier,_[S]))&&(kb(C),T("start",C,_[S]))}}function v(C){var w=C.changedTouches,_=w.length,A,x;for(A=0;A<_;++A)(x=r[w[A].identifier])&&(Sh(C),x("drag",C,w[A]))}function b(C){var w=C.changedTouches,_=w.length,A,x;for(u&&clearTimeout(u),u=setTimeout(function(){u=null},500),A=0;A<_;++A)(x=r[w[A].identifier])&&(kb(C),x("end",C,w[A]))}function y(C,w,_,A,x,S){var T=o.copy(),M=wo(S||_,w),R,E,P;if((P=e.call(C,new u_("beforestart",{sourceEvent:_,target:c,identifier:x,active:s,x:M[0],y:M[1],dx:0,dy:0,dispatch:T}),A))!=null)return R=P.x-M[0]||0,E=P.y-M[1]||0,function B(k,L,O){var I=M,H;switch(k){case"start":r[x]=B,H=s++;break;case"end":delete r[x],--s;case"drag":M=wo(O||L,w),H=s;break}T.call(k,C,new u_(k,{sourceEvent:L,subject:P,target:c,identifier:x,active:H,x:M[0]+R,y:M[1]+E,dx:M[0]-I[0],dy:M[1]-I[1],dispatch:T}),A)}}return c.filter=function(C){return arguments.length?(n=typeof C=="function"?C:Eg(!!C),c):n},c.container=function(C){return arguments.length?(t=typeof C=="function"?C:Eg(C),c):t},c.subject=function(C){return arguments.length?(e=typeof C=="function"?C:Eg(C),c):e},c.touchable=function(C){return arguments.length?(i=typeof C=="function"?C:Eg(!!C),c):i},c.on=function(){var C=o.on.apply(o,arguments);return C===o?c:C},c.clickDistance=function(C){return arguments.length?(d=(C=+C)*C,c):Math.sqrt(d)},c}function V1(n,t,e){n.prototype=t.prototype=e,e.constructor=n}function VL(n,t){var e=Object.create(n.prototype);for(var i in t)e[i]=t[i];return e}function ng(){}var fc=.7,bp=1/fc,Ah="\\s*([+-]?\\d+)\\s*",pc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Lo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",j8=/^#([0-9a-f]{3,8})$/,V8=new RegExp(`^rgb\\(${Ah},${Ah},${Ah}\\)$`),G8=new RegExp(`^rgb\\(${Lo},${Lo},${Lo}\\)$`),$8=new RegExp(`^rgba\\(${Ah},${Ah},${Ah},${pc}\\)$`),U8=new RegExp(`^rgba\\(${Lo},${Lo},${Lo},${pc}\\)$`),X8=new RegExp(`^hsl\\(${pc},${Lo},${Lo}\\)$`),Y8=new RegExp(`^hsla\\(${pc},${Lo},${Lo},${pc}\\)$`),tA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};V1(ng,Pl,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:eA,formatHex:eA,formatHex8:q8,formatHsl:K8,formatRgb:iA,toString:iA});function eA(){return this.rgb().formatHex()}function q8(){return this.rgb().formatHex8()}function K8(){return GL(this).formatHsl()}function iA(){return this.rgb().formatRgb()}function Pl(n){var t,e;return n=(n+"").trim().toLowerCase(),(t=j8.exec(n))?(e=t[1].length,t=parseInt(t[1],16),e===6?nA(t):e===3?new Dn(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?Lg(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?Lg(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=V8.exec(n))?new Dn(t[1],t[2],t[3],1):(t=G8.exec(n))?new Dn(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=$8.exec(n))?Lg(t[1],t[2],t[3],t[4]):(t=U8.exec(n))?Lg(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=X8.exec(n))?sA(t[1],t[2]/100,t[3]/100,1):(t=Y8.exec(n))?sA(t[1],t[2]/100,t[3]/100,t[4]):tA.hasOwnProperty(n)?nA(tA[n]):n==="transparent"?new Dn(NaN,NaN,NaN,0):null}function nA(n){return new Dn(n>>16&255,n>>8&255,n&255,1)}function Lg(n,t,e,i){return i<=0&&(n=t=e=NaN),new Dn(n,t,e,i)}function Z8(n){return n instanceof ng||(n=Pl(n)),n?(n=n.rgb(),new Dn(n.r,n.g,n.b,n.opacity)):new Dn}function d_(n,t,e,i){return arguments.length===1?Z8(n):new Dn(n,t,e,i??1)}function Dn(n,t,e,i){this.r=+n,this.g=+t,this.b=+e,this.opacity=+i}V1(Dn,d_,VL(ng,{brighter(n){return n=n==null?bp:Math.pow(bp,n),new Dn(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?fc:Math.pow(fc,n),new Dn(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Dn(bl(this.r),bl(this.g),bl(this.b),yp(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rA,formatHex:rA,formatHex8:J8,formatRgb:oA,toString:oA}));function rA(){return`#${ol(this.r)}${ol(this.g)}${ol(this.b)}`}function J8(){return`#${ol(this.r)}${ol(this.g)}${ol(this.b)}${ol((isNaN(this.opacity)?1:this.opacity)*255)}`}function oA(){const n=yp(this.opacity);return`${n===1?"rgb(":"rgba("}${bl(this.r)}, ${bl(this.g)}, ${bl(this.b)}${n===1?")":`, ${n})`}`}function yp(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function bl(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function ol(n){return n=bl(n),(n<16?"0":"")+n.toString(16)}function sA(n,t,e,i){return i<=0?n=t=e=NaN:e<=0||e>=1?n=t=NaN:t<=0&&(n=NaN),new qr(n,t,e,i)}function GL(n){if(n instanceof qr)return new qr(n.h,n.s,n.l,n.opacity);if(n instanceof ng||(n=Pl(n)),!n)return new qr;if(n instanceof qr)return n;n=n.rgb();var t=n.r/255,e=n.g/255,i=n.b/255,r=Math.min(t,e,i),o=Math.max(t,e,i),s=NaN,a=o-r,l=(o+r)/2;return a?(t===o?s=(e-i)/a+(e<i)*6:e===o?s=(i-t)/a+2:s=(t-e)/a+4,a/=l<.5?o+r:2-o-r,s*=60):a=l>0&&l<1?0:s,new qr(s,a,l,n.opacity)}function Q8(n,t,e,i){return arguments.length===1?GL(n):new qr(n,t,e,i??1)}function qr(n,t,e,i){this.h=+n,this.s=+t,this.l=+e,this.opacity=+i}V1(qr,Q8,VL(ng,{brighter(n){return n=n==null?bp:Math.pow(bp,n),new qr(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?fc:Math.pow(fc,n),new qr(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,t=isNaN(n)||isNaN(this.s)?0:this.s,e=this.l,i=e+(e<.5?e:1-e)*t,r=2*e-i;return new Dn(Pb(n>=240?n-240:n+120,r,i),Pb(n,r,i),Pb(n<120?n+240:n-120,r,i),this.opacity)},clamp(){return new qr(aA(this.h),Og(this.s),Og(this.l),yp(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=yp(this.opacity);return`${n===1?"hsl(":"hsla("}${aA(this.h)}, ${Og(this.s)*100}%, ${Og(this.l)*100}%${n===1?")":`, ${n})`}`}}));function aA(n){return n=(n||0)%360,n<0?n+360:n}function Og(n){return Math.max(0,Math.min(1,n||0))}function Pb(n,t,e){return(n<60?t+(e-t)*n/60:n<180?e:n<240?t+(e-t)*(240-n)/60:t)*255}const G1=n=>()=>n;function tj(n,t){return function(e){return n+e*t}}function ej(n,t,e){return n=Math.pow(n,e),t=Math.pow(t,e)-n,e=1/e,function(i){return Math.pow(n+i*t,e)}}function ij(n){return(n=+n)==1?$L:function(t,e){return e-t?ej(t,e,n):G1(isNaN(t)?e:t)}}function $L(n,t){var e=t-n;return e?tj(n,e):G1(isNaN(n)?t:n)}const Cp=(function n(t){var e=ij(t);function i(r,o){var s=e((r=d_(r)).r,(o=d_(o)).r),a=e(r.g,o.g),l=e(r.b,o.b),h=$L(r.opacity,o.opacity);return function(u){return r.r=s(u),r.g=a(u),r.b=l(u),r.opacity=h(u),r+""}}return i.gamma=n,i})(1);function nj(n,t){t||(t=[]);var e=n?Math.min(t.length,n.length):0,i=t.slice(),r;return function(o){for(r=0;r<e;++r)i[r]=n[r]*(1-o)+t[r]*o;return i}}function rj(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function oj(n,t){var e=t?t.length:0,i=n?Math.min(e,n.length):0,r=new Array(i),o=new Array(e),s;for(s=0;s<i;++s)r[s]=Id(n[s],t[s]);for(;s<e;++s)o[s]=t[s];return function(a){for(s=0;s<i;++s)o[s]=r[s](a);return o}}function sj(n,t){var e=new Date;return n=+n,t=+t,function(i){return e.setTime(n*(1-i)+t*i),e}}function So(n,t){return n=+n,t=+t,function(e){return n*(1-e)+t*e}}function aj(n,t){var e={},i={},r;(n===null||typeof n!="object")&&(n={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in n?e[r]=Id(n[r],t[r]):i[r]=t[r];return function(o){for(r in e)i[r]=e[r](o);return i}}var c_=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Eb=new RegExp(c_.source,"g");function lj(n){return function(){return n}}function hj(n){return function(t){return n(t)+""}}function UL(n,t){var e=c_.lastIndex=Eb.lastIndex=0,i,r,o,s=-1,a=[],l=[];for(n=n+"",t=t+"";(i=c_.exec(n))&&(r=Eb.exec(t));)(o=r.index)>e&&(o=t.slice(e,o),a[s]?a[s]+=o:a[++s]=o),(i=i[0])===(r=r[0])?a[s]?a[s]+=r:a[++s]=r:(a[++s]=null,l.push({i:s,x:So(i,r)})),e=Eb.lastIndex;return e<t.length&&(o=t.slice(e),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?hj(l[0].x):lj(t):(t=l.length,function(h){for(var u=0,d;u<t;++u)a[(d=l[u]).i]=d.x(h);return a.join("")})}function Id(n,t){var e=typeof t,i;return t==null||e==="boolean"?G1(t):(e==="number"?So:e==="string"?(i=Pl(t))?(t=i,Cp):UL:t instanceof Pl?Cp:t instanceof Date?sj:rj(t)?nj:Array.isArray(t)?oj:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?aj:So)(n,t)}var lA=180/Math.PI,g_={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function XL(n,t,e,i,r,o){var s,a,l;return(s=Math.sqrt(n*n+t*t))&&(n/=s,t/=s),(l=n*e+t*i)&&(e-=n*l,i-=t*l),(a=Math.sqrt(e*e+i*i))&&(e/=a,i/=a,l/=a),n*i<t*e&&(n=-n,t=-t,l=-l,s=-s),{translateX:r,translateY:o,rotate:Math.atan2(t,n)*lA,skewX:Math.atan(l)*lA,scaleX:s,scaleY:a}}var Ig;function uj(n){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return t.isIdentity?g_:XL(t.a,t.b,t.c,t.d,t.e,t.f)}function dj(n){return n==null||(Ig||(Ig=document.createElementNS("http://www.w3.org/2000/svg","g")),Ig.setAttribute("transform",n),!(n=Ig.transform.baseVal.consolidate()))?g_:(n=n.matrix,XL(n.a,n.b,n.c,n.d,n.e,n.f))}function YL(n,t,e,i){function r(h){return h.length?h.pop()+" ":""}function o(h,u,d,c,g,f){if(h!==d||u!==c){var p=g.push("translate(",null,t,null,e);f.push({i:p-4,x:So(h,d)},{i:p-2,x:So(u,c)})}else(d||c)&&g.push("translate("+d+t+c+e)}function s(h,u,d,c){h!==u?(h-u>180?u+=360:u-h>180&&(h+=360),c.push({i:d.push(r(d)+"rotate(",null,i)-2,x:So(h,u)})):u&&d.push(r(d)+"rotate("+u+i)}function a(h,u,d,c){h!==u?c.push({i:d.push(r(d)+"skewX(",null,i)-2,x:So(h,u)}):u&&d.push(r(d)+"skewX("+u+i)}function l(h,u,d,c,g,f){if(h!==d||u!==c){var p=g.push(r(g)+"scale(",null,",",null,")");f.push({i:p-4,x:So(h,d)},{i:p-2,x:So(u,c)})}else(d!==1||c!==1)&&g.push(r(g)+"scale("+d+","+c+")")}return function(h,u){var d=[],c=[];return h=n(h),u=n(u),o(h.translateX,h.translateY,u.translateX,u.translateY,d,c),s(h.rotate,u.rotate,d,c),a(h.skewX,u.skewX,d,c),l(h.scaleX,h.scaleY,u.scaleX,u.scaleY,d,c),h=u=null,function(g){for(var f=-1,p=c.length,m;++f<p;)d[(m=c[f]).i]=m.x(g);return d.join("")}}}var cj=YL(uj,"px, ","px)","deg)"),gj=YL(dj,", ",")",")"),fj=1e-12;function hA(n){return((n=Math.exp(n))+1/n)/2}function pj(n){return((n=Math.exp(n))-1/n)/2}function mj(n){return((n=Math.exp(2*n))-1)/(n+1)}const Of=(function n(t,e,i){function r(o,s){var a=o[0],l=o[1],h=o[2],u=s[0],d=s[1],c=s[2],g=u-a,f=d-l,p=g*g+f*f,m,v;if(p<fj)v=Math.log(c/h)/t,m=function(A){return[a+A*g,l+A*f,h*Math.exp(t*A*v)]};else{var b=Math.sqrt(p),y=(c*c-h*h+i*p)/(2*h*e*b),C=(c*c-h*h-i*p)/(2*c*e*b),w=Math.log(Math.sqrt(y*y+1)-y),_=Math.log(Math.sqrt(C*C+1)-C);v=(_-w)/t,m=function(A){var x=A*v,S=hA(w),T=h/(e*b)*(S*mj(t*x+w)-pj(w));return[a+T*g,l+T*f,h*S/hA(t*x+w)]}}return m.duration=v*1e3*t/Math.SQRT2,m}return r.rho=function(o){var s=Math.max(.001,+o),a=s*s,l=a*a;return n(s,a,l)},r})(Math.SQRT2,2,4);var cu=0,md=0,Xu=0,qL=1e3,_p,vd,wp=0,El=0,Ym=0,mc=typeof performance=="object"&&performance.now?performance:Date,KL=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function $1(){return El||(KL(vj),El=mc.now()+Ym)}function vj(){El=0}function xp(){this._call=this._time=this._next=null}xp.prototype=ZL.prototype={constructor:xp,restart:function(n,t,e){if(typeof n!="function")throw new TypeError("callback is not a function");e=(e==null?$1():+e)+(t==null?0:+t),!this._next&&vd!==this&&(vd?vd._next=this:_p=this,vd=this),this._call=n,this._time=e,f_()},stop:function(){this._call&&(this._call=null,this._time=1/0,f_())}};function ZL(n,t,e){var i=new xp;return i.restart(n,t,e),i}function bj(){$1(),++cu;for(var n=_p,t;n;)(t=El-n._time)>=0&&n._call.call(void 0,t),n=n._next;--cu}function uA(){El=(wp=mc.now())+Ym,cu=md=0;try{bj()}finally{cu=0,Cj(),El=0}}function yj(){var n=mc.now(),t=n-wp;t>qL&&(Ym-=t,wp=n)}function Cj(){for(var n,t=_p,e,i=1/0;t;)t._call?(i>t._time&&(i=t._time),n=t,t=t._next):(e=t._next,t._next=null,t=n?n._next=e:_p=e);vd=n,f_(i)}function f_(n){if(!cu){md&&(md=clearTimeout(md));var t=n-El;t>24?(n<1/0&&(md=setTimeout(uA,n-mc.now()-Ym)),Xu&&(Xu=clearInterval(Xu))):(Xu||(wp=mc.now(),Xu=setInterval(yj,qL)),cu=1,KL(uA))}}function dA(n,t,e){var i=new xp;return t=t==null?0:+t,i.restart(r=>{i.stop(),n(r+t)},t,e),i}var _j=Um("start","end","cancel","interrupt"),wj=[],JL=0,cA=1,p_=2,If=3,gA=4,m_=5,Hf=6;function qm(n,t,e,i,r,o){var s=n.__transition;if(!s)n.__transition={};else if(e in s)return;xj(n,e,{name:t,index:i,group:r,on:_j,tween:wj,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:JL})}function U1(n,t){var e=co(n,t);if(e.state>JL)throw new Error("too late; already scheduled");return e}function Wo(n,t){var e=co(n,t);if(e.state>If)throw new Error("too late; already running");return e}function co(n,t){var e=n.__transition;if(!e||!(e=e[t]))throw new Error("transition not found");return e}function xj(n,t,e){var i=n.__transition,r;i[t]=e,e.timer=ZL(o,0,e.time);function o(h){e.state=cA,e.timer.restart(s,e.delay,e.time),e.delay<=h&&s(h-e.delay)}function s(h){var u,d,c,g;if(e.state!==cA)return l();for(u in i)if(g=i[u],g.name===e.name){if(g.state===If)return dA(s);g.state===gA?(g.state=Hf,g.timer.stop(),g.on.call("interrupt",n,n.__data__,g.index,g.group),delete i[u]):+u<t&&(g.state=Hf,g.timer.stop(),g.on.call("cancel",n,n.__data__,g.index,g.group),delete i[u])}if(dA(function(){e.state===If&&(e.state=gA,e.timer.restart(a,e.delay,e.time),a(h))}),e.state=p_,e.on.call("start",n,n.__data__,e.index,e.group),e.state===p_){for(e.state=If,r=new Array(c=e.tween.length),u=0,d=-1;u<c;++u)(g=e.tween[u].value.call(n,n.__data__,e.index,e.group))&&(r[++d]=g);r.length=d+1}}function a(h){for(var u=h<e.duration?e.ease.call(null,h/e.duration):(e.timer.restart(l),e.state=m_,1),d=-1,c=r.length;++d<c;)r[d].call(n,u);e.state===m_&&(e.on.call("end",n,n.__data__,e.index,e.group),l())}function l(){e.state=Hf,e.timer.stop(),delete i[t];for(var h in i)return;delete n.__transition}}function Df(n,t){var e=n.__transition,i,r,o=!0,s;if(e){t=t==null?null:t+"";for(s in e){if((i=e[s]).name!==t){o=!1;continue}r=i.state>p_&&i.state<m_,i.state=Hf,i.timer.stop(),i.on.call(r?"interrupt":"cancel",n,n.__data__,i.index,i.group),delete e[s]}o&&delete n.__transition}}function Sj(n){return this.each(function(){Df(this,n)})}function Aj(n,t){var e,i;return function(){var r=Wo(this,n),o=r.tween;if(o!==e){i=e=o;for(var s=0,a=i.length;s<a;++s)if(i[s].name===t){i=i.slice(),i.splice(s,1);break}}r.tween=i}}function Mj(n,t,e){var i,r;if(typeof e!="function")throw new Error;return function(){var o=Wo(this,n),s=o.tween;if(s!==i){r=(i=s).slice();for(var a={name:t,value:e},l=0,h=r.length;l<h;++l)if(r[l].name===t){r[l]=a;break}l===h&&r.push(a)}o.tween=r}}function Tj(n,t){var e=this._id;if(n+="",arguments.length<2){for(var i=co(this.node(),e).tween,r=0,o=i.length,s;r<o;++r)if((s=i[r]).name===n)return s.value;return null}return this.each((t==null?Aj:Mj)(e,n,t))}function X1(n,t,e){var i=n._id;return n.each(function(){var r=Wo(this,i);(r.value||(r.value={}))[t]=e.apply(this,arguments)}),function(r){return co(r,i).value[t]}}function QL(n,t){var e;return(typeof t=="number"?So:t instanceof Pl?Cp:(e=Pl(t))?(t=e,Cp):UL)(n,t)}function Rj(n){return function(){this.removeAttribute(n)}}function Bj(n){return function(){this.removeAttributeNS(n.space,n.local)}}function kj(n,t,e){var i,r=e+"",o;return function(){var s=this.getAttribute(n);return s===r?null:s===i?o:o=t(i=s,e)}}function Pj(n,t,e){var i,r=e+"",o;return function(){var s=this.getAttributeNS(n.space,n.local);return s===r?null:s===i?o:o=t(i=s,e)}}function Ej(n,t,e){var i,r,o;return function(){var s,a=e(this),l;return a==null?void this.removeAttribute(n):(s=this.getAttribute(n),l=a+"",s===l?null:s===i&&l===r?o:(r=l,o=t(i=s,a)))}}function Lj(n,t,e){var i,r,o;return function(){var s,a=e(this),l;return a==null?void this.removeAttributeNS(n.space,n.local):(s=this.getAttributeNS(n.space,n.local),l=a+"",s===l?null:s===i&&l===r?o:(r=l,o=t(i=s,a)))}}function Oj(n,t){var e=Xm(n),i=e==="transform"?gj:QL;return this.attrTween(n,typeof t=="function"?(e.local?Lj:Ej)(e,i,X1(this,"attr."+n,t)):t==null?(e.local?Bj:Rj)(e):(e.local?Pj:kj)(e,i,t))}function Ij(n,t){return function(e){this.setAttribute(n,t.call(this,e))}}function Hj(n,t){return function(e){this.setAttributeNS(n.space,n.local,t.call(this,e))}}function Dj(n,t){var e,i;function r(){var o=t.apply(this,arguments);return o!==i&&(e=(i=o)&&Hj(n,o)),e}return r._value=t,r}function Fj(n,t){var e,i;function r(){var o=t.apply(this,arguments);return o!==i&&(e=(i=o)&&Ij(n,o)),e}return r._value=t,r}function zj(n,t){var e="attr."+n;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;var i=Xm(n);return this.tween(e,(i.local?Dj:Fj)(i,t))}function Nj(n,t){return function(){U1(this,n).delay=+t.apply(this,arguments)}}function Wj(n,t){return t=+t,function(){U1(this,n).delay=t}}function jj(n){var t=this._id;return arguments.length?this.each((typeof n=="function"?Nj:Wj)(t,n)):co(this.node(),t).delay}function Vj(n,t){return function(){Wo(this,n).duration=+t.apply(this,arguments)}}function Gj(n,t){return t=+t,function(){Wo(this,n).duration=t}}function $j(n){var t=this._id;return arguments.length?this.each((typeof n=="function"?Vj:Gj)(t,n)):co(this.node(),t).duration}function Uj(n,t){if(typeof t!="function")throw new Error;return function(){Wo(this,n).ease=t}}function Xj(n){var t=this._id;return arguments.length?this.each(Uj(t,n)):co(this.node(),t).ease}function Yj(n,t){return function(){var e=t.apply(this,arguments);if(typeof e!="function")throw new Error;Wo(this,n).ease=e}}function qj(n){if(typeof n!="function")throw new Error;return this.each(Yj(this._id,n))}function Kj(n){typeof n!="function"&&(n=PL(n));for(var t=this._groups,e=t.length,i=new Array(e),r=0;r<e;++r)for(var o=t[r],s=o.length,a=i[r]=[],l,h=0;h<s;++h)(l=o[h])&&n.call(l,l.__data__,h,o)&&a.push(l);return new Rs(i,this._parents,this._name,this._id)}function Zj(n){if(n._id!==this._id)throw new Error;for(var t=this._groups,e=n._groups,i=t.length,r=e.length,o=Math.min(i,r),s=new Array(i),a=0;a<o;++a)for(var l=t[a],h=e[a],u=l.length,d=s[a]=new Array(u),c,g=0;g<u;++g)(c=l[g]||h[g])&&(d[g]=c);for(;a<i;++a)s[a]=t[a];return new Rs(s,this._parents,this._name,this._id)}function Jj(n){return(n+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||t==="start"})}function Qj(n,t,e){var i,r,o=Jj(t)?U1:Wo;return function(){var s=o(this,n),a=s.on;a!==i&&(r=(i=a).copy()).on(t,e),s.on=r}}function tV(n,t){var e=this._id;return arguments.length<2?co(this.node(),e).on.on(n):this.each(Qj(e,n,t))}function eV(n){return function(){var t=this.parentNode;for(var e in this.__transition)if(+e!==n)return;t&&t.removeChild(this)}}function iV(){return this.on("end.remove",eV(this._id))}function nV(n){var t=this._name,e=this._id;typeof n!="function"&&(n=W1(n));for(var i=this._groups,r=i.length,o=new Array(r),s=0;s<r;++s)for(var a=i[s],l=a.length,h=o[s]=new Array(l),u,d,c=0;c<l;++c)(u=a[c])&&(d=n.call(u,u.__data__,c,a))&&("__data__"in u&&(d.__data__=u.__data__),h[c]=d,qm(h[c],t,e,c,h,co(u,e)));return new Rs(o,this._parents,t,e)}function rV(n){var t=this._name,e=this._id;typeof n!="function"&&(n=kL(n));for(var i=this._groups,r=i.length,o=[],s=[],a=0;a<r;++a)for(var l=i[a],h=l.length,u,d=0;d<h;++d)if(u=l[d]){for(var c=n.call(u,u.__data__,d,l),g,f=co(u,e),p=0,m=c.length;p<m;++p)(g=c[p])&&qm(g,t,e,p,c,f);o.push(c),s.push(u)}return new Rs(o,s,t,e)}var oV=ig.prototype.constructor;function sV(){return new oV(this._groups,this._parents)}function aV(n,t){var e,i,r;return function(){var o=du(this,n),s=(this.style.removeProperty(n),du(this,n));return o===s?null:o===e&&s===i?r:r=t(e=o,i=s)}}function tO(n){return function(){this.style.removeProperty(n)}}function lV(n,t,e){var i,r=e+"",o;return function(){var s=du(this,n);return s===r?null:s===i?o:o=t(i=s,e)}}function hV(n,t,e){var i,r,o;return function(){var s=du(this,n),a=e(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(n),du(this,n))),s===l?null:s===i&&l===r?o:(r=l,o=t(i=s,a))}}function uV(n,t){var e,i,r,o="style."+t,s="end."+o,a;return function(){var l=Wo(this,n),h=l.on,u=l.value[o]==null?a||(a=tO(t)):void 0;(h!==e||r!==u)&&(i=(e=h).copy()).on(s,r=u),l.on=i}}function dV(n,t,e){var i=(n+="")=="transform"?cj:QL;return t==null?this.styleTween(n,aV(n,i)).on("end.style."+n,tO(n)):typeof t=="function"?this.styleTween(n,hV(n,i,X1(this,"style."+n,t))).each(uV(this._id,n)):this.styleTween(n,lV(n,i,t),e).on("end.style."+n,null)}function cV(n,t,e){return function(i){this.style.setProperty(n,t.call(this,i),e)}}function gV(n,t,e){var i,r;function o(){var s=t.apply(this,arguments);return s!==r&&(i=(r=s)&&cV(n,s,e)),i}return o._value=t,o}function fV(n,t,e){var i="style."+(n+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,gV(n,t,e??""))}function pV(n){return function(){this.textContent=n}}function mV(n){return function(){var t=n(this);this.textContent=t??""}}function vV(n){return this.tween("text",typeof n=="function"?mV(X1(this,"text",n)):pV(n==null?"":n+""))}function bV(n){return function(t){this.textContent=n.call(this,t)}}function yV(n){var t,e;function i(){var r=n.apply(this,arguments);return r!==e&&(t=(e=r)&&bV(r)),t}return i._value=n,i}function CV(n){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(n==null)return this.tween(t,null);if(typeof n!="function")throw new Error;return this.tween(t,yV(n))}function _V(){for(var n=this._name,t=this._id,e=eO(),i=this._groups,r=i.length,o=0;o<r;++o)for(var s=i[o],a=s.length,l,h=0;h<a;++h)if(l=s[h]){var u=co(l,t);qm(l,n,e,h,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new Rs(i,this._parents,n,e)}function wV(){var n,t,e=this,i=e._id,r=e.size();return new Promise(function(o,s){var a={value:s},l={value:function(){--r===0&&o()}};e.each(function(){var h=Wo(this,i),u=h.on;u!==n&&(t=(n=u).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),h.on=t}),r===0&&o()})}var xV=0;function Rs(n,t,e,i){this._groups=n,this._parents=t,this._name=e,this._id=i}function eO(){return++xV}var Yo=ig.prototype;Rs.prototype={constructor:Rs,select:nV,selectAll:rV,selectChild:Yo.selectChild,selectChildren:Yo.selectChildren,filter:Kj,merge:Zj,selection:sV,transition:_V,call:Yo.call,nodes:Yo.nodes,node:Yo.node,size:Yo.size,empty:Yo.empty,each:Yo.each,on:tV,attr:Oj,attrTween:zj,style:dV,styleTween:fV,text:vV,textTween:CV,remove:iV,tween:Tj,delay:jj,duration:$j,ease:Xj,easeVarying:qj,end:wV,[Symbol.iterator]:Yo[Symbol.iterator]};function SV(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var AV={time:null,delay:0,duration:250,ease:SV};function MV(n,t){for(var e;!(e=n.__transition)||!(e=e[t]);)if(!(n=n.parentNode))throw new Error(`transition ${t} not found`);return e}function TV(n){var t,e;n instanceof Rs?(t=n._id,n=n._name):(t=eO(),(e=AV).time=$1(),n=n==null?null:n+"");for(var i=this._groups,r=i.length,o=0;o<r;++o)for(var s=i[o],a=s.length,l,h=0;h<a;++h)(l=s[h])&&qm(l,n,t,h,s,e||MV(l,t));return new Rs(i,this._parents,n,t)}ig.prototype.interrupt=Sj;ig.prototype.transition=TV;const Hg=n=>()=>n;function RV(n,{sourceEvent:t,target:e,transform:i,dispatch:r}){Object.defineProperties(this,{type:{value:n,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:e,enumerable:!0,configurable:!0},transform:{value:i,enumerable:!0,configurable:!0},_:{value:r}})}function ms(n,t,e){this.k=n,this.x=t,this.y=e}ms.prototype={constructor:ms,scale:function(n){return n===1?this:new ms(this.k*n,this.x,this.y)},translate:function(n,t){return n===0&t===0?this:new ms(this.k,this.x+this.k*n,this.y+this.k*t)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var gu=new ms(1,0,0);ms.prototype;function Lb(n){n.stopImmediatePropagation()}function Yu(n){n.preventDefault(),n.stopImmediatePropagation()}function BV(n){return(!n.ctrlKey||n.type==="wheel")&&!n.button}function kV(){var n=this;return n instanceof SVGElement?(n=n.ownerSVGElement||n,n.hasAttribute("viewBox")?(n=n.viewBox.baseVal,[[n.x,n.y],[n.x+n.width,n.y+n.height]]):[[0,0],[n.width.baseVal.value,n.height.baseVal.value]]):[[0,0],[n.clientWidth,n.clientHeight]]}function fA(){return this.__zoom||gu}function PV(n){return-n.deltaY*(n.deltaMode===1?.05:n.deltaMode?1:.002)*(n.ctrlKey?10:1)}function EV(){return navigator.maxTouchPoints||"ontouchstart"in this}function LV(n,t,e){var i=n.invertX(t[0][0])-e[0][0],r=n.invertX(t[1][0])-e[1][0],o=n.invertY(t[0][1])-e[0][1],s=n.invertY(t[1][1])-e[1][1];return n.translate(r>i?(i+r)/2:Math.min(0,i)||Math.max(0,r),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}function OV(){var n=BV,t=kV,e=LV,i=PV,r=EV,o=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,l=Of,h=Um("start","zoom","end"),u,d,c,g=500,f=150,p=0,m=10;function v(P){P.property("__zoom",fA).on("wheel.zoom",x,{passive:!1}).on("mousedown.zoom",S).on("dblclick.zoom",T).filter(r).on("touchstart.zoom",M).on("touchmove.zoom",R).on("touchend.zoom touchcancel.zoom",E).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}v.transform=function(P,B,k,L){var O=P.selection?P.selection():P;O.property("__zoom",fA),P!==O?w(P,B,k,L):O.interrupt().each(function(){_(this,arguments).event(L).start().zoom(null,typeof B=="function"?B.apply(this,arguments):B).end()})},v.scaleBy=function(P,B,k,L){v.scaleTo(P,function(){var O=this.__zoom.k,I=typeof B=="function"?B.apply(this,arguments):B;return O*I},k,L)},v.scaleTo=function(P,B,k,L){v.transform(P,function(){var O=t.apply(this,arguments),I=this.__zoom,H=k==null?C(O):typeof k=="function"?k.apply(this,arguments):k,D=I.invert(H),z=typeof B=="function"?B.apply(this,arguments):B;return e(y(b(I,z),H,D),O,s)},k,L)},v.translateBy=function(P,B,k,L){v.transform(P,function(){return e(this.__zoom.translate(typeof B=="function"?B.apply(this,arguments):B,typeof k=="function"?k.apply(this,arguments):k),t.apply(this,arguments),s)},null,L)},v.translateTo=function(P,B,k,L,O){v.transform(P,function(){var I=t.apply(this,arguments),H=this.__zoom,D=L==null?C(I):typeof L=="function"?L.apply(this,arguments):L;return e(gu.translate(D[0],D[1]).scale(H.k).translate(typeof B=="function"?-B.apply(this,arguments):-B,typeof k=="function"?-k.apply(this,arguments):-k),I,s)},L,O)};function b(P,B){return B=Math.max(o[0],Math.min(o[1],B)),B===P.k?P:new ms(B,P.x,P.y)}function y(P,B,k){var L=B[0]-k[0]*P.k,O=B[1]-k[1]*P.k;return L===P.x&&O===P.y?P:new ms(P.k,L,O)}function C(P){return[(+P[0][0]+ +P[1][0])/2,(+P[0][1]+ +P[1][1])/2]}function w(P,B,k,L){P.on("start.zoom",function(){_(this,arguments).event(L).start()}).on("interrupt.zoom end.zoom",function(){_(this,arguments).event(L).end()}).tween("zoom",function(){var O=this,I=arguments,H=_(O,I).event(L),D=t.apply(O,I),z=k==null?C(D):typeof k=="function"?k.apply(O,I):k,G=Math.max(D[1][0]-D[0][0],D[1][1]-D[0][1]),U=O.__zoom,j=typeof B=="function"?B.apply(O,I):B,X=l(U.invert(z).concat(G/U.k),j.invert(z).concat(G/j.k));return function(Z){if(Z===1)Z=j;else{var J=X(Z),q=G/J[2];Z=new ms(q,z[0]-J[0]*q,z[1]-J[1]*q)}H.zoom(null,Z)}})}function _(P,B,k){return!k&&P.__zooming||new A(P,B)}function A(P,B){this.that=P,this.args=B,this.active=0,this.sourceEvent=null,this.extent=t.apply(P,B),this.taps=0}A.prototype={event:function(P){return P&&(this.sourceEvent=P),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(P,B){return this.mouse&&P!=="mouse"&&(this.mouse[1]=B.invert(this.mouse[0])),this.touch0&&P!=="touch"&&(this.touch0[1]=B.invert(this.touch0[0])),this.touch1&&P!=="touch"&&(this.touch1[1]=B.invert(this.touch1[0])),this.that.__zoom=B,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(P){var B=Yr(this.that).datum();h.call(P,this.that,new RV(P,{sourceEvent:this.sourceEvent,target:v,transform:this.that.__zoom,dispatch:h}),B)}};function x(P,...B){if(!n.apply(this,arguments))return;var k=_(this,B).event(P),L=this.__zoom,O=Math.max(o[0],Math.min(o[1],L.k*Math.pow(2,i.apply(this,arguments)))),I=wo(P);if(k.wheel)(k.mouse[0][0]!==I[0]||k.mouse[0][1]!==I[1])&&(k.mouse[1]=L.invert(k.mouse[0]=I)),clearTimeout(k.wheel);else{if(L.k===O)return;k.mouse=[I,L.invert(I)],Df(this),k.start()}Yu(P),k.wheel=setTimeout(H,f),k.zoom("mouse",e(y(b(L,O),k.mouse[0],k.mouse[1]),k.extent,s));function H(){k.wheel=null,k.end()}}function S(P,...B){if(c||!n.apply(this,arguments))return;var k=P.currentTarget,L=_(this,B,!0).event(P),O=Yr(P.view).on("mousemove.zoom",z,!0).on("mouseup.zoom",G,!0),I=wo(P,k),H=P.clientX,D=P.clientY;WL(P.view),Lb(P),L.mouse=[I,this.__zoom.invert(I)],Df(this),L.start();function z(U){if(Yu(U),!L.moved){var j=U.clientX-H,X=U.clientY-D;L.moved=j*j+X*X>p}L.event(U).zoom("mouse",e(y(L.that.__zoom,L.mouse[0]=wo(U,k),L.mouse[1]),L.extent,s))}function G(U){O.on("mousemove.zoom mouseup.zoom",null),jL(U.view,L.moved),Yu(U),L.event(U).end()}}function T(P,...B){if(n.apply(this,arguments)){var k=this.__zoom,L=wo(P.changedTouches?P.changedTouches[0]:P,this),O=k.invert(L),I=k.k*(P.shiftKey?.5:2),H=e(y(b(k,I),L,O),t.apply(this,B),s);Yu(P),a>0?Yr(this).transition().duration(a).call(w,H,L,P):Yr(this).call(v.transform,H,L,P)}}function M(P,...B){if(n.apply(this,arguments)){var k=P.touches,L=k.length,O=_(this,B,P.changedTouches.length===L).event(P),I,H,D,z;for(Lb(P),H=0;H<L;++H)D=k[H],z=wo(D,this),z=[z,this.__zoom.invert(z),D.identifier],O.touch0?!O.touch1&&O.touch0[2]!==z[2]&&(O.touch1=z,O.taps=0):(O.touch0=z,I=!0,O.taps=1+!!u);u&&(u=clearTimeout(u)),I&&(O.taps<2&&(d=z[0],u=setTimeout(function(){u=null},g)),Df(this),O.start())}}function R(P,...B){if(this.__zooming){var k=_(this,B).event(P),L=P.changedTouches,O=L.length,I,H,D,z;for(Yu(P),I=0;I<O;++I)H=L[I],D=wo(H,this),k.touch0&&k.touch0[2]===H.identifier?k.touch0[0]=D:k.touch1&&k.touch1[2]===H.identifier&&(k.touch1[0]=D);if(H=k.that.__zoom,k.touch1){var G=k.touch0[0],U=k.touch0[1],j=k.touch1[0],X=k.touch1[1],Z=(Z=j[0]-G[0])*Z+(Z=j[1]-G[1])*Z,J=(J=X[0]-U[0])*J+(J=X[1]-U[1])*J;H=b(H,Math.sqrt(Z/J)),D=[(G[0]+j[0])/2,(G[1]+j[1])/2],z=[(U[0]+X[0])/2,(U[1]+X[1])/2]}else if(k.touch0)D=k.touch0[0],z=k.touch0[1];else return;k.zoom("touch",e(y(H,D,z),k.extent,s))}}function E(P,...B){if(this.__zooming){var k=_(this,B).event(P),L=P.changedTouches,O=L.length,I,H;for(Lb(P),c&&clearTimeout(c),c=setTimeout(function(){c=null},g),I=0;I<O;++I)H=L[I],k.touch0&&k.touch0[2]===H.identifier?delete k.touch0:k.touch1&&k.touch1[2]===H.identifier&&delete k.touch1;if(k.touch1&&!k.touch0&&(k.touch0=k.touch1,delete k.touch1),k.touch0)k.touch0[1]=this.__zoom.invert(k.touch0[0]);else if(k.end(),k.taps===2&&(H=wo(H,this),Math.hypot(d[0]-H[0],d[1]-H[1])<m)){var D=Yr(this).on("dblclick.zoom");D&&D.apply(this,arguments)}}}return v.wheelDelta=function(P){return arguments.length?(i=typeof P=="function"?P:Hg(+P),v):i},v.filter=function(P){return arguments.length?(n=typeof P=="function"?P:Hg(!!P),v):n},v.touchable=function(P){return arguments.length?(r=typeof P=="function"?P:Hg(!!P),v):r},v.extent=function(P){return arguments.length?(t=typeof P=="function"?P:Hg([[+P[0][0],+P[0][1]],[+P[1][0],+P[1][1]]]),v):t},v.scaleExtent=function(P){return arguments.length?(o[0]=+P[0],o[1]=+P[1],v):[o[0],o[1]]},v.translateExtent=function(P){return arguments.length?(s[0][0]=+P[0][0],s[1][0]=+P[1][0],s[0][1]=+P[0][1],s[1][1]=+P[1][1],v):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},v.constrain=function(P){return arguments.length?(e=P,v):e},v.duration=function(P){return arguments.length?(a=+P,v):a},v.interpolate=function(P){return arguments.length?(l=P,v):l},v.on=function(){var P=h.on.apply(h,arguments);return P===h?v:P},v.clickDistance=function(P){return arguments.length?(p=(P=+P)*P,v):Math.sqrt(p)},v.tapDistance=function(P){return arguments.length?(m=+P,v):m},v}var Rt=(n=>(n.Left="left",n.Top="top",n.Right="right",n.Bottom="bottom",n))(Rt||{}),Y1=(n=>(n.Partial="partial",n.Full="full",n))(Y1||{}),Ka=(n=>(n.Bezier="default",n.SimpleBezier="simple-bezier",n.Straight="straight",n.Step="step",n.SmoothStep="smoothstep",n))(Ka||{}),fa=(n=>(n.Strict="strict",n.Loose="loose",n))(fa||{}),v_=(n=>(n.Arrow="arrow",n.ArrowClosed="arrowclosed",n))(v_||{}),Hd=(n=>(n.Free="free",n.Vertical="vertical",n.Horizontal="horizontal",n))(Hd||{});const IV=["INPUT","SELECT","TEXTAREA"],HV=typeof document<"u"?document:null;function b_(n){var t,e;const i=((e=(t=n.composedPath)==null?void 0:t.call(n))==null?void 0:e[0])||n.target,r=typeof i?.hasAttribute=="function"?i.hasAttribute("contenteditable"):!1,o=typeof i?.closest=="function"?i.closest(".nokey"):null;return IV.includes(i?.nodeName)||r||!!o}function DV(n){return n.ctrlKey||n.metaKey||n.shiftKey||n.altKey}function pA(n,t,e,i){const r=t.replace("+",`
`).replace(`

`,`
+`).split(`
`).map(s=>s.trim().toLowerCase());if(r.length===1)return n.toLowerCase()===t.toLowerCase();i||e.add(n.toLowerCase());const o=r.every((s,a)=>e.has(s)&&Array.from(e.values())[a]===r[a]);return i&&e.delete(n.toLowerCase()),o}function FV(n,t){return e=>{if(!e.code&&!e.key)return!1;const i=zV(e.code,n);return Array.isArray(n)?n.some(r=>pA(e[i],r,t,e.type==="keyup")):pA(e[i],n,t,e.type==="keyup")}}function zV(n,t){return t.includes(n)?"code":"key"}function Dd(n,t){const e=ee(()=>le(t?.target)??HV),i=ip(le(n)===!0);let r=!1;const o=new Set;let s=l(le(n));He(()=>le(n),(h,u)=>{typeof u=="boolean"&&typeof h!="boolean"&&a(),s=l(h)},{immediate:!0}),RL(["blur","contextmenu"],a),ZS((...h)=>s(...h),h=>{var u,d;const c=le(t?.actInsideInputWithModifier)??!0,g=le(t?.preventDefault)??!1;if(r=DV(h),(!r||r&&!c)&&b_(h))return;const p=((d=(u=h.composedPath)==null?void 0:u.call(h))==null?void 0:d[0])||h.target,m=p?.nodeName==="BUTTON"||p?.nodeName==="A";!g&&(r||!m)&&h.preventDefault(),i.value=!0},{eventName:"keydown",target:e}),ZS((...h)=>s(...h),h=>{const u=le(t?.actInsideInputWithModifier)??!0;if(i.value){if((!r||r&&!u)&&b_(h))return;r=!1,i.value=!1}},{eventName:"keyup",target:e});function a(){r=!1,o.clear(),i.value=le(n)===!0}function l(h){return h===null?(a(),()=>!1):typeof h=="boolean"?(a(),i.value=h,()=>!1):Array.isArray(h)||typeof h=="string"?FV(h,o):h}return i}const iO="vue-flow__node-desc",nO="vue-flow__edge-desc",NV="vue-flow__aria-live",rO=["Enter"," ","Escape"],Mh={ArrowUp:{x:0,y:-1},ArrowDown:{x:0,y:1},ArrowLeft:{x:-1,y:0},ArrowRight:{x:1,y:0}};function Sp(n){return{...n.computedPosition||{x:0,y:0},width:n.dimensions.width||0,height:n.dimensions.height||0}}function Ap(n,t){const e=Math.max(0,Math.min(n.x+n.width,t.x+t.width)-Math.max(n.x,t.x)),i=Math.max(0,Math.min(n.y+n.height,t.y+t.height)-Math.max(n.y,t.y));return Math.ceil(e*i)}function Km(n){return{width:n.offsetWidth,height:n.offsetHeight}}function Ll(n,t=0,e=1){return Math.min(Math.max(n,t),e)}function oO(n,t){return{x:Ll(n.x,t[0][0],t[1][0]),y:Ll(n.y,t[0][1],t[1][1])}}function mA(n){const t=n.getRootNode();return"elementFromPoint"in t?t:window.document}function pa(n){return n&&typeof n=="object"&&"id"in n&&"source"in n&&"target"in n}function yl(n){return n&&typeof n=="object"&&"id"in n&&"position"in n&&!pa(n)}function bd(n){return yl(n)&&"computedPosition"in n}function Dg(n){return!Number.isNaN(n)&&Number.isFinite(n)}function WV(n){return Dg(n.width)&&Dg(n.height)&&Dg(n.x)&&Dg(n.y)}function jV(n,t,e){const i={id:n.id.toString(),type:n.type??"default",dimensions:Bd({width:0,height:0}),computedPosition:Bd({z:0,...n.position}),handleBounds:{source:[],target:[]},draggable:void 0,selectable:void 0,connectable:void 0,focusable:void 0,selected:!1,dragging:!1,resizing:!1,initialized:!1,isParent:!1,position:{x:0,y:0},data:Hi(n.data)?n.data:{},events:Bd(Hi(n.events)?n.events:{})};return Object.assign(t??i,n,{id:n.id.toString(),parentNode:e})}function sO(n,t,e){var i,r;const o={id:n.id.toString(),type:n.type??t?.type??"default",source:n.source.toString(),target:n.target.toString(),sourceHandle:(i=n.sourceHandle)==null?void 0:i.toString(),targetHandle:(r=n.targetHandle)==null?void 0:r.toString(),updatable:n.updatable??e?.updatable,selectable:n.selectable??e?.selectable,focusable:n.focusable??e?.focusable,data:Hi(n.data)?n.data:{},events:Bd(Hi(n.events)?n.events:{}),label:n.label??"",interactionWidth:n.interactionWidth??e?.interactionWidth,...e??{}};return Object.assign(t??o,n,{id:n.id.toString()})}function aO(n,t,e,i){const r=typeof n=="string"?n:n.id,o=new Set,s=i==="source"?"target":"source";for(const a of e)a[s]===r&&o.add(a[i]);return t.filter(a=>o.has(a.id))}function VV(...n){if(n.length===3){const[o,s,a]=n;return aO(o,s,a,"target")}const[t,e]=n,i=typeof t=="string"?t:t.id;return e.filter(o=>pa(o)&&o.source===i).map(o=>e.find(s=>yl(s)&&s.id===o.target))}function GV(...n){if(n.length===3){const[o,s,a]=n;return aO(o,s,a,"source")}const[t,e]=n,i=typeof t=="string"?t:t.id;return e.filter(o=>pa(o)&&o.target===i).map(o=>e.find(s=>yl(s)&&s.id===o.source))}function lO({source:n,sourceHandle:t,target:e,targetHandle:i}){return`vueflow__edge-${n}${t??""}-${e}${i??""}`}function $V(n,t){return t.some(e=>pa(e)&&e.source===n.source&&e.target===n.target&&(e.sourceHandle===n.sourceHandle||!e.sourceHandle&&!n.sourceHandle)&&(e.targetHandle===n.targetHandle||!e.targetHandle&&!n.targetHandle))}function y_({x:n,y:t},{x:e,y:i,zoom:r}){return{x:n*r+e,y:t*r+i}}function vc({x:n,y:t},{x:e,y:i,zoom:r},o=!1,s=[1,1]){const a={x:(n-e)/r,y:(t-i)/r};return o?Zm(a,s):a}function UV(n,t){return{x:Math.min(n.x,t.x),y:Math.min(n.y,t.y),x2:Math.max(n.x2,t.x2),y2:Math.max(n.y2,t.y2)}}function hO({x:n,y:t,width:e,height:i}){return{x:n,y:t,x2:n+e,y2:t+i}}function XV({x:n,y:t,x2:e,y2:i}){return{x:n,y:t,width:e-n,height:i-t}}function uO(n){let t={x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY,x2:Number.NEGATIVE_INFINITY,y2:Number.NEGATIVE_INFINITY};for(let e=0;e<n.length;e++){const i=n[e];t=UV(t,hO({...i.computedPosition,...i.dimensions}))}return XV(t)}function dO(n,t,e={x:0,y:0,zoom:1},i=!1,r=!1){const o={...vc(t,e),width:t.width/e.zoom,height:t.height/e.zoom},s=[];for(const a of n){const{dimensions:l,selectable:h=!0,hidden:u=!1}=a,d=l.width??a.width??null,c=l.height??a.height??null;if(r&&!h||u)continue;const g=Ap(o,Sp(a)),f=d===null||c===null,p=i&&g>0,m=(d??0)*(c??0);(f||p||g>=m||a.dragging)&&s.push(a)}return s}function cO(n,t){const e=new Set;if(typeof n=="string")e.add(n);else if(n.length>=1)for(const i of n)e.add(i.id);return t.filter(i=>e.has(i.source)||e.has(i.target))}function vA(n,t,e,i,r,o=.1,s={x:0,y:0}){const a=t/(n.width*(1+o)),l=e/(n.height*(1+o)),h=Math.min(a,l),u=Ll(h,i,r),d=n.x+n.width/2,c=n.y+n.height/2,g=t/2-d*u+(s.x??0),f=e/2-c*u+(s.y??0);return{x:g,y:f,zoom:u}}function YV(n,t){return{x:t.x+n.x,y:t.y+n.y,z:(n.z>t.z?n.z:t.z)+1}}function gO(n,t){if(!n.parentNode)return!1;const e=t(n.parentNode);return e?e.selected?!0:gO(e,t):!1}function bc(n,t){return typeof n>"u"?"":typeof n=="string"?n:`${t?`${t}__`:""}${Object.keys(n).sort().map(i=>`${i}=${n[i]}`).join("&")}`}function bA(n,t,e){return n<t?Ll(Math.abs(n-t),1,t)/t:n>e?-Ll(Math.abs(n-e),1,t)/t:0}function fO(n,t,e=15,i=40){const r=bA(n.x,i,t.width-i)*e,o=bA(n.y,i,t.height-i)*e;return[r,o]}function Ob(n,t){if(t){const e=n.position.x+n.dimensions.width-t.dimensions.width,i=n.position.y+n.dimensions.height-t.dimensions.height;if(e>0||i>0||n.position.x<0||n.position.y<0){let r={};if(typeof t.style=="function"?r={...t.style(t)}:t.style&&(r={...t.style}),r.width=r.width??`${t.dimensions.width}px`,r.height=r.height??`${t.dimensions.height}px`,e>0)if(typeof r.width=="string"){const o=Number(r.width.replace("px",""));r.width=`${o+e}px`}else r.width+=e;if(i>0)if(typeof r.height=="string"){const o=Number(r.height.replace("px",""));r.height=`${o+i}px`}else r.height+=i;if(n.position.x<0){const o=Math.abs(n.position.x);if(t.position.x=t.position.x-o,typeof r.width=="string"){const s=Number(r.width.replace("px",""));r.width=`${s+o}px`}else r.width+=o;n.position.x=0}if(n.position.y<0){const o=Math.abs(n.position.y);if(t.position.y=t.position.y-o,typeof r.height=="string"){const s=Number(r.height.replace("px",""));r.height=`${s+o}px`}else r.height+=o;n.position.y=0}t.dimensions.width=Number(r.width.toString().replace("px","")),t.dimensions.height=Number(r.height.toString().replace("px","")),typeof t.style=="function"?t.style=o=>{const s=t.style;return{...s(o),...r}}:t.style={...t.style,...r}}}}function yA(n,t){var e,i;const r=n.filter(s=>s.type==="add"||s.type==="remove");for(const s of r)if(s.type==="add")t.findIndex(l=>l.id===s.item.id)===-1&&t.push(s.item);else if(s.type==="remove"){const a=t.findIndex(l=>l.id===s.id);a!==-1&&t.splice(a,1)}const o=t.map(s=>s.id);for(const s of t)for(const a of n)if(a.id===s.id)switch(a.type){case"select":s.selected=a.selected;break;case"position":if(bd(s)&&(typeof a.position<"u"&&(s.position=a.position),typeof a.dragging<"u"&&(s.dragging=a.dragging),s.expandParent&&s.parentNode)){const l=t[o.indexOf(s.parentNode)];l&&bd(l)&&Ob(s,l)}break;case"dimensions":if(bd(s)&&(typeof a.dimensions<"u"&&(s.dimensions=a.dimensions),typeof a.updateStyle<"u"&&a.updateStyle&&(s.style={...s.style||{},width:`${(e=a.dimensions)==null?void 0:e.width}px`,height:`${(i=a.dimensions)==null?void 0:i.height}px`}),typeof a.resizing<"u"&&(s.resizing=a.resizing),s.expandParent&&s.parentNode)){const l=t[o.indexOf(s.parentNode)];l&&bd(l)&&(!!l.dimensions.width&&!!l.dimensions.height?Ob(s,l):ys(()=>{Ob(s,l)}))}break}return t}function Vs(n,t){return{id:n,type:"select",selected:t}}function CA(n){return{item:n,type:"add"}}function _A(n){return{id:n,type:"remove"}}function wA(n,t,e,i,r){return{id:n,source:t,target:e,sourceHandle:i||null,targetHandle:r||null,type:"remove"}}function $s(n,t=new Set,e=!1){const i=[];for(const[r,o]of n){const s=t.has(r);!(o.selected===void 0&&!s)&&o.selected!==s&&(e&&(o.selected=s),i.push(Vs(o.id,s)))}return i}function xt(n){const t=new Set;let e=!1;const i=()=>t.size>0;n&&(e=!0,t.add(n));const r=a=>{t.delete(a)};return{on:a=>{n&&e&&t.delete(n),t.add(a);const l=()=>{r(a),n&&e&&t.add(n)};return $m(l),{off:l}},off:r,trigger:a=>Promise.all(Array.from(t).map(l=>l(a))),hasListeners:i,fns:t}}function xA(n,t,e){let i=n;do{if(i&&i.matches(t))return!0;if(i===e)return!1;i=i.parentElement}while(i);return!1}function qV(n,t,e,i,r){var o,s;const a=[];for(const l of n)(l.selected||l.id===r)&&(!l.parentNode||!gO(l,i))&&(l.draggable||t&&typeof l.draggable>"u")&&a.push(Bd({id:l.id,position:l.position||{x:0,y:0},distance:{x:e.x-((o=l.computedPosition)==null?void 0:o.x)||0,y:e.y-((s=l.computedPosition)==null?void 0:s.y)||0},from:l.computedPosition,extent:l.extent,parentNode:l.parentNode,dimensions:l.dimensions,expandParent:l.expandParent}));return a}function Ib({id:n,dragItems:t,findNode:e}){const i=[];for(const r of t){const o=e(r.id);o&&i.push(o)}return[n?i.find(r=>r.id===n):i[0],i]}function pO(n){if(Array.isArray(n))switch(n.length){case 1:return[n[0],n[0],n[0],n[0]];case 2:return[n[0],n[1],n[0],n[1]];case 3:return[n[0],n[1],n[2],n[1]];case 4:return n;default:return[0,0,0,0]}return[n,n,n,n]}function KV(n,t,e){const[i,r,o,s]=typeof n!="string"?pO(n.padding):[0,0,0,0];return e&&typeof e.computedPosition.x<"u"&&typeof e.computedPosition.y<"u"&&typeof e.dimensions.width<"u"&&typeof e.dimensions.height<"u"?[[e.computedPosition.x+s,e.computedPosition.y+i],[e.computedPosition.x+e.dimensions.width-r,e.computedPosition.y+e.dimensions.height-o]]:!1}function ZV(n,t,e,i){let r=n.extent||e;if((r==="parent"||!Array.isArray(r)&&r?.range==="parent")&&!n.expandParent)if(n.parentNode&&i&&n.dimensions.width&&n.dimensions.height){const o=KV(r,n,i);o&&(r=o)}else t(new Gi(zi.NODE_EXTENT_INVALID,n.id)),r=e;else if(Array.isArray(r)){const o=i?.computedPosition.x||0,s=i?.computedPosition.y||0;r=[[r[0][0]+o,r[0][1]+s],[r[1][0]+o,r[1][1]+s]]}else if(r!=="parent"&&r?.range&&Array.isArray(r.range)){const[o,s,a,l]=pO(r.padding),h=i?.computedPosition.x||0,u=i?.computedPosition.y||0;r=[[r.range[0][0]+h+l,r.range[0][1]+u+o],[r.range[1][0]+h-s,r.range[1][1]+u-a]]}return r==="parent"?[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]]:r}function JV({width:n,height:t},e){return[e[0],[e[1][0]-(n||0),e[1][1]-(t||0)]]}function q1(n,t,e,i,r){const o=JV(n.dimensions,ZV(n,e,i,r)),s=oO(t,o);return{position:{x:s.x-(r?.computedPosition.x||0),y:s.y-(r?.computedPosition.y||0)},computedPosition:s}}function fu(n,t,e=Rt.Left,i=!1){const r=(t?.x??0)+n.computedPosition.x,o=(t?.y??0)+n.computedPosition.y,{width:s,height:a}=t??i9(n);if(i)return{x:r+s/2,y:o+a/2};switch(t?.position??e){case Rt.Top:return{x:r+s/2,y:o};case Rt.Right:return{x:r+s,y:o+a/2};case Rt.Bottom:return{x:r+s/2,y:o+a};case Rt.Left:return{x:r,y:o+a/2}}}function SA(n,t){return n&&(t?n.find(e=>e.id===t):n[0])||null}function QV({sourcePos:n,targetPos:t,sourceWidth:e,sourceHeight:i,targetWidth:r,targetHeight:o,width:s,height:a,viewport:l}){const h={x:Math.min(n.x,t.x),y:Math.min(n.y,t.y),x2:Math.max(n.x+e,t.x+r),y2:Math.max(n.y+i,t.y+o)};h.x===h.x2&&(h.x2+=1),h.y===h.y2&&(h.y2+=1);const u=hO({x:(0-l.x)/l.zoom,y:(0-l.y)/l.zoom,width:s/l.zoom,height:a/l.zoom}),d=Math.max(0,Math.min(u.x2,h.x2)-Math.max(u.x,h.x)),c=Math.max(0,Math.min(u.y2,h.y2)-Math.max(u.y,h.y));return Math.ceil(d*c)>0}function t9(n,t,e=!1){const i=typeof n.zIndex=="number";let r=i?n.zIndex:0;const o=t(n.source),s=t(n.target);return!o||!s?0:(e&&(r=i?n.zIndex:Math.max(o.computedPosition.z||0,s.computedPosition.z||0)),r)}var zi=(n=>(n.MISSING_STYLES="MISSING_STYLES",n.MISSING_VIEWPORT_DIMENSIONS="MISSING_VIEWPORT_DIMENSIONS",n.NODE_INVALID="NODE_INVALID",n.NODE_NOT_FOUND="NODE_NOT_FOUND",n.NODE_MISSING_PARENT="NODE_MISSING_PARENT",n.NODE_TYPE_MISSING="NODE_TYPE_MISSING",n.NODE_EXTENT_INVALID="NODE_EXTENT_INVALID",n.EDGE_INVALID="EDGE_INVALID",n.EDGE_NOT_FOUND="EDGE_NOT_FOUND",n.EDGE_SOURCE_MISSING="EDGE_SOURCE_MISSING",n.EDGE_TARGET_MISSING="EDGE_TARGET_MISSING",n.EDGE_TYPE_MISSING="EDGE_TYPE_MISSING",n.EDGE_SOURCE_TARGET_SAME="EDGE_SOURCE_TARGET_SAME",n.EDGE_SOURCE_TARGET_MISSING="EDGE_SOURCE_TARGET_MISSING",n.EDGE_ORPHANED="EDGE_ORPHANED",n.USEVUEFLOW_OPTIONS="USEVUEFLOW_OPTIONS",n))(zi||{});const AA={MISSING_STYLES:()=>"It seems that you haven't loaded the necessary styles. Please import '@vue-flow/core/dist/style.css' to ensure that the graph is rendered correctly",MISSING_VIEWPORT_DIMENSIONS:()=>"The Vue Flow parent container needs a width and a height to render the graph",NODE_INVALID:n=>`Node is invalid
Node: ${n}`,NODE_NOT_FOUND:n=>`Node not found
Node: ${n}`,NODE_MISSING_PARENT:(n,t)=>`Node is missing a parent
Node: ${n}
Parent: ${t}`,NODE_TYPE_MISSING:n=>`Node type is missing
Type: ${n}`,NODE_EXTENT_INVALID:n=>`Only child nodes can use a parent extent
Node: ${n}`,EDGE_INVALID:n=>`An edge needs a source and a target
Edge: ${n}`,EDGE_SOURCE_MISSING:(n,t)=>`Edge source is missing
Edge: ${n} 
Source: ${t}`,EDGE_TARGET_MISSING:(n,t)=>`Edge target is missing
Edge: ${n} 
Target: ${t}`,EDGE_TYPE_MISSING:n=>`Edge type is missing
Type: ${n}`,EDGE_SOURCE_TARGET_SAME:(n,t,e)=>`Edge source and target are the same
Edge: ${n} 
Source: ${t} 
Target: ${e}`,EDGE_SOURCE_TARGET_MISSING:(n,t,e)=>`Edge source or target is missing
Edge: ${n} 
Source: ${t} 
Target: ${e}`,EDGE_ORPHANED:n=>`Edge was orphaned (suddenly missing source or target) and has been removed
Edge: ${n}`,EDGE_NOT_FOUND:n=>`Edge not found
Edge: ${n}`,USEVUEFLOW_OPTIONS:()=>"The options parameter is deprecated and will be removed in the next major version. Please use the id parameter instead"};class Gi extends Error{constructor(t,...e){var i;super((i=AA[t])==null?void 0:i.call(AA,...e)),this.name="VueFlowError",this.code=t,this.args=e}}function K1(n){return"clientX"in n}function e9(n){return"sourceEvent"in n}function Ao(n,t){const e=K1(n);let i,r;return e?(i=n.clientX,r=n.clientY):"touches"in n&&n.touches.length>0?(i=n.touches[0].clientX,r=n.touches[0].clientY):"changedTouches"in n&&n.changedTouches.length>0?(i=n.changedTouches[0].clientX,r=n.changedTouches[0].clientY):(i=0,r=0),{x:i-(t?.left??0),y:r-(t?.top??0)}}const Mp=()=>{var n;return typeof navigator<"u"&&((n=navigator?.userAgent)==null?void 0:n.indexOf("Mac"))>=0};function i9(n){var t,e;return{width:((t=n.dimensions)==null?void 0:t.width)??n.width??0,height:((e=n.dimensions)==null?void 0:e.height)??n.height??0}}function Zm(n,t=[1,1]){return{x:t[0]*Math.round(n.x/t[0]),y:t[1]*Math.round(n.y/t[1])}}const n9=()=>!0;function Hb(n){n?.classList.remove("valid","connecting","vue-flow__handle-valid","vue-flow__handle-connecting")}function r9(n,t,e){const i=[],r={x:n.x-e,y:n.y-e,width:e*2,height:e*2};for(const o of t.values())Ap(r,Sp(o))>0&&i.push(o);return i}const o9=250;function s9(n,t,e,i){var r,o;let s=[],a=Number.POSITIVE_INFINITY;const l=r9(n,e,t+o9);for(const h of l){const u=[...((r=h.handleBounds)==null?void 0:r.source)??[],...((o=h.handleBounds)==null?void 0:o.target)??[]];for(const d of u){if(i.nodeId===d.nodeId&&i.type===d.type&&i.id===d.id)continue;const{x:c,y:g}=fu(h,d,d.position,!0),f=Math.sqrt((c-n.x)**2+(g-n.y)**2);f>t||(f<a?(s=[{...d,x:c,y:g}],a=f):f===a&&s.push({...d,x:c,y:g}))}}if(!s.length)return null;if(s.length>1){const h=i.type==="source"?"target":"source";return s.find(u=>u.type===h)??s[0]}return s[0]}function MA(n,{handle:t,connectionMode:e,fromNodeId:i,fromHandleId:r,fromType:o,doc:s,lib:a,flowId:l,isValidConnection:h=n9},u,d,c){const g=o==="target",f=t?s.querySelector(`.${a}-flow__handle[data-id="${l}-${t?.nodeId}-${t?.id}-${t?.type}"]`):null,{x:p,y:m}=Ao(n),v=s.elementFromPoint(p,m),b=v?.classList.contains(`${a}-flow__handle`)?v:f,y={handleDomNode:b,isValid:!1,connection:null,toHandle:null};if(b){const C=mO(void 0,b),w=b.getAttribute("data-nodeid"),_=b.getAttribute("data-handleid"),A=b.classList.contains("connectable"),x=b.classList.contains("connectableend");if(!w||!C)return y;const S={source:g?w:i,sourceHandle:g?_:r,target:g?i:w,targetHandle:g?r:_};y.connection=S;const M=A&&x&&(e===fa.Strict?g&&C==="source"||!g&&C==="target":w!==i||_!==r);y.isValid=M&&h(S,{nodes:d,edges:u,sourceNode:c(i),targetNode:c(w)}),y.toHandle=t}return y}function mO(n,t){return n||(t?.classList.contains("target")?"target":t?.classList.contains("source")?"source":null)}function a9(n,t){let e=null;return t?e="valid":n&&!t&&(e="invalid"),e}function l9(n,t){let e=null;return t?e=!0:n&&!t&&(e=!1),e}function h9(n,t,e,i,r,o=!1){var s,a,l;const h=i.get(n);if(!h)return null;const u=r===fa.Strict?(s=h.handleBounds)==null?void 0:s[t]:[...((a=h.handleBounds)==null?void 0:a.source)??[],...((l=h.handleBounds)==null?void 0:l.target)??[]],d=(e?u?.find(c=>c.id===e):u?.[0])??null;return d&&o?{...d,...fu(h,d,d.position,!0)}:d}const C_={[Rt.Left]:Rt.Right,[Rt.Right]:Rt.Left,[Rt.Top]:Rt.Bottom,[Rt.Bottom]:Rt.Top},u9=["production","prod"];function Jm(n,...t){vO()}function vO(){return!u9.includes("production")}function TA(n,t,e,i,r){const o=t.querySelectorAll(`.vue-flow__handle.${n}`);return o?.length?Array.from(o).map(s=>{const a=s.getBoundingClientRect();return{id:s.getAttribute("data-handleid"),type:n,nodeId:r,position:s.getAttribute("data-handlepos"),x:(a.left-e.left)/i,y:(a.top-e.top)/i,...Km(s)}}):null}function __(n,t,e,i,r,o=!1,s){r.value=!1,n.selected?(o||n.selected&&t)&&(i([n]),ys(()=>{s.blur()})):e([n])}function Hi(n){return typeof It(n)<"u"}function d9(n,t,e,i){if(!n||!n.source||!n.target)return e(new Gi(zi.EDGE_INVALID,n?.id??"[ID UNKNOWN]")),!1;let r;return pa(n)?r=n:r={...n,id:lO(n)},r=sO(r,void 0,i),$V(r,t)?!1:r}function c9(n,t,e,i,r){if(!t.source||!t.target)return r(new Gi(zi.EDGE_INVALID,n.id)),!1;if(!e)return r(new Gi(zi.EDGE_NOT_FOUND,n.id)),!1;const{id:o,...s}=n;return{...s,id:i?lO(t):o,source:t.source,target:t.target,sourceHandle:t.sourceHandle,targetHandle:t.targetHandle}}function RA(n,t,e){const i={},r=[];for(let o=0;o<n.length;++o){const s=n[o];if(!yl(s)){e(new Gi(zi.NODE_INVALID,s?.id)||`[ID UNKNOWN|INDEX ${o}]`);continue}const a=jV(s,t(s.id),s.parentNode);s.parentNode&&(i[s.parentNode]=!0),r[o]=a}for(const o of r){const s=t(o.parentNode)||r.find(a=>a.id===o.parentNode);o.parentNode&&!s&&e(new Gi(zi.NODE_MISSING_PARENT,o.id,o.parentNode)),(o.parentNode||i[o.id])&&(i[o.id]&&(o.isParent=!0),s&&(s.isParent=!0))}return r}function BA(n,t,e,i,r,o){let s=r;const a=i.get(s)||new Map;i.set(s,a.set(e,t)),s=`${r}-${n}`;const l=i.get(s)||new Map;if(i.set(s,l.set(e,t)),o){s=`${r}-${n}-${o}`;const h=i.get(s)||new Map;i.set(s,h.set(e,t))}}function Db(n,t,e){n.clear();for(const i of e){const{source:r,target:o,sourceHandle:s=null,targetHandle:a=null}=i,l={edgeId:i.id,source:r,target:o,sourceHandle:s,targetHandle:a},h=`${r}-${s}--${o}-${a}`,u=`${o}-${a}--${r}-${s}`;BA("source",l,u,n,r,s),BA("target",l,h,n,o,a)}}function kA(n,t){if(n.size!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;return!0}function Fb(n,t,e,i,r,o,s,a){const l=[];for(const h of n){const u=pa(h)?h:d9(h,a,r,o);if(!u)continue;const d=e(u.source),c=e(u.target);if(!d||!c){r(new Gi(zi.EDGE_SOURCE_TARGET_MISSING,u.id,u.source,u.target));continue}if(!d){r(new Gi(zi.EDGE_SOURCE_MISSING,u.id,u.source));continue}if(!c){r(new Gi(zi.EDGE_TARGET_MISSING,u.id,u.target));continue}if(t&&!t(u,{edges:a,nodes:s,sourceNode:d,targetNode:c})){r(new Gi(zi.EDGE_INVALID,u.id));continue}const g=i(u.id);l.push({...sO(u,g,o),sourceNode:d,targetNode:c})}return l}const PA=Symbol("vueFlow"),bO=Symbol("nodeId"),yO=Symbol("nodeRef"),g9=Symbol("edgeId"),f9=Symbol("edgeRef"),Qm=Symbol("slots");function CO(n){const{vueFlowRef:t,snapToGrid:e,snapGrid:i,noDragClassName:r,nodes:o,nodeExtent:s,nodeDragThreshold:a,viewport:l,autoPanOnNodeDrag:h,autoPanSpeed:u,nodesDraggable:d,panBy:c,findNode:g,multiSelectionActive:f,nodesSelectionActive:p,selectNodesOnDrag:m,removeSelectedElements:v,addSelectedNodes:b,updateNodePositions:y,emits:C}=yi(),{onStart:w,onDrag:_,onStop:A,onClick:x,el:S,disabled:T,id:M,selectable:R,dragHandle:E}=n,P=ip(!1);let B=[],k,L=null,O={x:void 0,y:void 0},I={x:0,y:0},H=null,D=!1,z=0,G=!1;const U=v9(),j=({x:Q,y:ot})=>{O={x:Q,y:ot};let nt=!1;if(B=B.map(F=>{const N={x:Q-F.distance.x,y:ot-F.distance.y},{computedPosition:W}=q1(F,e.value?Zm(N,i.value):N,C.error,s.value,F.parentNode?g(F.parentNode):void 0);return nt=nt||F.position.x!==W.x||F.position.y!==W.y,F.position=W,F}),!!nt&&(y(B,!0,!0),P.value=!0,H)){const[F,N]=Ib({id:M,dragItems:B,findNode:g});_({event:H,node:F,nodes:N})}},X=()=>{if(!L)return;const[Q,ot]=fO(I,L,u.value);if(Q!==0||ot!==0){const nt={x:(O.x??0)-Q/l.value.zoom,y:(O.y??0)-ot/l.value.zoom};c({x:Q,y:ot})&&j(nt)}z=requestAnimationFrame(X)},Z=(Q,ot)=>{D=!0;const nt=g(M);!m.value&&!f.value&&nt&&(nt.selected||v()),nt&&le(R)&&m.value&&__(nt,f.value,b,v,p,!1,ot);const F=U(Q.sourceEvent);if(O=F,B=qV(o.value,d.value,F,g,M),B.length){const[N,W]=Ib({id:M,dragItems:B,findNode:g});w({event:Q.sourceEvent,node:N,nodes:W})}},J=(Q,ot)=>{var nt;Q.sourceEvent.type==="touchmove"&&Q.sourceEvent.touches.length>1||(a.value===0&&Z(Q,ot),O=U(Q.sourceEvent),L=((nt=t.value)==null?void 0:nt.getBoundingClientRect())||null,I=Ao(Q.sourceEvent,L))},q=(Q,ot)=>{const nt=U(Q.sourceEvent);if(!G&&D&&h.value&&(G=!0,X()),!D){const F=nt.xSnapped-(O.x??0),N=nt.ySnapped-(O.y??0);Math.sqrt(F*F+N*N)>a.value&&Z(Q,ot)}(O.x!==nt.xSnapped||O.y!==nt.ySnapped)&&B.length&&D&&(H=Q.sourceEvent,I=Ao(Q.sourceEvent,L),j(nt))},st=Q=>{let ot=!1;if(!D&&!P.value&&!f.value){const nt=Q.sourceEvent,F=U(nt),N=F.xSnapped-(O.x??0),W=F.ySnapped-(O.y??0),V=Math.sqrt(N*N+W*W);V!==0&&V<=a.value&&(x?.(nt),ot=!0)}if(B.length&&!ot){y(B,!1,!1);const[nt,F]=Ib({id:M,dragItems:B,findNode:g});A({event:Q.sourceEvent,node:nt,nodes:F})}B=[],P.value=!1,G=!1,D=!1,O={x:void 0,y:void 0},cancelAnimationFrame(z)};return He([()=>le(T),S],([Q,ot],nt,F)=>{if(ot){const N=Yr(ot);Q||(k=W8().on("start",W=>J(W,ot)).on("drag",W=>q(W,ot)).on("end",W=>st(W)).filter(W=>{const V=W.target,K=le(E);return!W.button&&(!r.value||!xA(V,`.${r.value}`,ot)&&(!K||xA(V,K,ot)))}),N.call(k)),F(()=>{N.on(".drag",null),k&&(k.on("start",null),k.on("drag",null),k.on("end",null))})}}),P}function p9(){return{doubleClick:xt(),click:xt(),mouseEnter:xt(),mouseMove:xt(),mouseLeave:xt(),contextMenu:xt(),updateStart:xt(),update:xt(),updateEnd:xt()}}function m9(n,t){const e=p9();return e.doubleClick.on(i=>{var r,o;t.edgeDoubleClick(i),(o=(r=n.events)==null?void 0:r.doubleClick)==null||o.call(r,i)}),e.click.on(i=>{var r,o;t.edgeClick(i),(o=(r=n.events)==null?void 0:r.click)==null||o.call(r,i)}),e.mouseEnter.on(i=>{var r,o;t.edgeMouseEnter(i),(o=(r=n.events)==null?void 0:r.mouseEnter)==null||o.call(r,i)}),e.mouseMove.on(i=>{var r,o;t.edgeMouseMove(i),(o=(r=n.events)==null?void 0:r.mouseMove)==null||o.call(r,i)}),e.mouseLeave.on(i=>{var r,o;t.edgeMouseLeave(i),(o=(r=n.events)==null?void 0:r.mouseLeave)==null||o.call(r,i)}),e.contextMenu.on(i=>{var r,o;t.edgeContextMenu(i),(o=(r=n.events)==null?void 0:r.contextMenu)==null||o.call(r,i)}),e.updateStart.on(i=>{var r,o;t.edgeUpdateStart(i),(o=(r=n.events)==null?void 0:r.updateStart)==null||o.call(r,i)}),e.update.on(i=>{var r,o;t.edgeUpdate(i),(o=(r=n.events)==null?void 0:r.update)==null||o.call(r,i)}),e.updateEnd.on(i=>{var r,o;t.edgeUpdateEnd(i),(o=(r=n.events)==null?void 0:r.updateEnd)==null||o.call(r,i)}),Object.entries(e).reduce((i,[r,o])=>(i.emit[r]=o.trigger,i.on[r]=o.on,i),{emit:{},on:{}})}function v9(){const{viewport:n,snapGrid:t,snapToGrid:e,vueFlowRef:i}=yi();return r=>{var o;const s=((o=i.value)==null?void 0:o.getBoundingClientRect())??{left:0,top:0},a=e9(r)?r.sourceEvent:r,{x:l,y:h}=Ao(a,s),u=vc({x:l,y:h},n.value),{x:d,y:c}=e.value?Zm(u,t.value):u;return{xSnapped:d,ySnapped:c,...u}}}function Fg(){return!0}function _O({handleId:n,nodeId:t,type:e,isValidConnection:i,edgeUpdaterType:r,onEdgeUpdate:o,onEdgeUpdateEnd:s}){const{id:a,vueFlowRef:l,connectionMode:h,connectionRadius:u,connectOnClick:d,connectionClickStartHandle:c,nodesConnectable:g,autoPanOnConnect:f,autoPanSpeed:p,findNode:m,panBy:v,startConnection:b,updateConnection:y,endConnection:C,emits:w,viewport:_,edges:A,nodes:x,isValidConnection:S,nodeLookup:T}=yi();let M=null,R=!1,E=null;function P(k){var L;const O=le(e)==="target",I=K1(k),H=mA(k.target);if(I&&k.button===0||!I){let D=function(lt){F=Ao(lt,Q),j=s9(vc(F,_.value,!1,[1,1]),u.value,T.value,V),N||(W(),N=!0);const ct=MA(lt,{handle:j,connectionMode:h.value,fromNodeId:le(t),fromHandleId:le(n),fromType:O?"target":"source",isValidConnection:U,doc:H,lib:"vue",flowId:a,nodeLookup:T.value},A.value,x.value,m);E=ct.handleDomNode,M=ct.connection,R=l9(!!j,ct.isValid);const ut={...rt,isValid:R,to:ct.toHandle&&R?y_({x:ct.toHandle.x,y:ct.toHandle.y},_.value):F,toHandle:ct.toHandle,toPosition:R&&ct.toHandle?ct.toHandle.position:C_[V.position],toNode:ct.toHandle?T.value.get(ct.toHandle.nodeId):null};if(!(R&&j&&rt?.toHandle&&ut.toHandle&&rt.toHandle.type===ut.toHandle.type&&rt.toHandle.nodeId===ut.toHandle.nodeId&&rt.toHandle.id===ut.toHandle.id&&rt.to.x===ut.to.x&&rt.to.y===ut.to.y)){if(y(j&&R?y_({x:j.x,y:j.y},_.value):F,ct.toHandle,a9(!!j,R)),rt=ut,!j&&!R&&!E)return Hb(nt);M&&M.source!==M.target&&E&&(Hb(nt),nt=E,E.classList.add("connecting","vue-flow__handle-connecting"),E.classList.toggle("valid",!!R),E.classList.toggle("vue-flow__handle-valid",!!R))}},z=function(lt){(j||E)&&M&&R&&(o?o(lt,M):w.connect(M)),w.connectEnd(lt),r&&s?.(lt),Hb(nt),cancelAnimationFrame(X),C(lt),N=!1,R=!1,M=null,E=null,H.removeEventListener("mousemove",D),H.removeEventListener("mouseup",z),H.removeEventListener("touchmove",D),H.removeEventListener("touchend",z)};const G=m(le(t));let U=le(i)||S.value||Fg;!U&&G&&(U=(O?G.isValidSourcePos:G.isValidTargetPos)||Fg);let j,X=0;const{x:Z,y:J}=Ao(k),q=H?.elementFromPoint(Z,J),st=mO(le(r),q),Q=(L=l.value)==null?void 0:L.getBoundingClientRect();if(!Q||!st)return;const ot=h9(le(t),st,le(n),T.value,h.value);if(!ot)return;let nt,F=Ao(k,Q),N=!1;const W=()=>{if(!f.value)return;const[lt,ct]=fO(F,Q,p.value);v({x:lt,y:ct}),X=requestAnimationFrame(W)},V={...ot,nodeId:le(t),type:st,position:ot.position},K=T.value.get(le(t)),it={inProgress:!0,isValid:null,from:fu(K,V,Rt.Left,!0),fromHandle:V,fromPosition:V.position,fromNode:K,to:F,toHandle:null,toPosition:C_[V.position],toNode:null};b({nodeId:le(t),id:le(n),type:st,position:q?.getAttribute("data-handlepos")||Rt.Top,...F},{x:Z-Q.left,y:J-Q.top}),w.connectStart({event:k,nodeId:le(t),handleId:le(n),handleType:st});let rt=it;H.addEventListener("mousemove",D),H.addEventListener("mouseup",z),H.addEventListener("touchmove",D),H.addEventListener("touchend",z)}}function B(k){var L,O;if(!d.value)return;const I=le(e)==="target";if(!c.value){w.clickConnectStart({event:k,nodeId:le(t),handleId:le(n)}),b({nodeId:le(t),type:le(e),id:le(n),position:Rt.Top,...Ao(k)},void 0,!0);return}let H=le(i)||S.value||Fg;const D=m(le(t));if(!H&&D&&(H=(I?D.isValidSourcePos:D.isValidTargetPos)||Fg),D&&(typeof D.connectable>"u"?g.value:D.connectable)===!1)return;const z=mA(k.target),G=MA(k,{handle:{nodeId:le(t),id:le(n),type:le(e),position:Rt.Top,...Ao(k)},connectionMode:h.value,fromNodeId:c.value.nodeId,fromHandleId:c.value.id??null,fromType:c.value.type,isValidConnection:H,doc:z,lib:"vue",flowId:a,nodeLookup:T.value},A.value,x.value,m),U=((L=G.connection)==null?void 0:L.source)===((O=G.connection)==null?void 0:O.target);G.isValid&&G.connection&&!U&&w.connect(G.connection),w.clickConnectEnd(k),C(k,!0)}return{handlePointerDown:P,handleClick:B}}function b9(){return Bu(bO,"")}function wO(n){const t=n??b9()??"",e=Bu(yO,fi(null)),{findNode:i,edges:r,emits:o}=yi(),s=i(t);return s||o.error(new Gi(zi.NODE_NOT_FOUND,t)),{id:t,nodeEl:e,node:s,parentNode:ee(()=>i(s.parentNode)),connectedEdges:ee(()=>cO([s],r.value))}}function y9(){return{doubleClick:xt(),click:xt(),mouseEnter:xt(),mouseMove:xt(),mouseLeave:xt(),contextMenu:xt(),dragStart:xt(),drag:xt(),dragStop:xt()}}function C9(n,t){const e=y9();return e.doubleClick.on(i=>{var r,o;t.nodeDoubleClick(i),(o=(r=n.events)==null?void 0:r.doubleClick)==null||o.call(r,i)}),e.click.on(i=>{var r,o;t.nodeClick(i),(o=(r=n.events)==null?void 0:r.click)==null||o.call(r,i)}),e.mouseEnter.on(i=>{var r,o;t.nodeMouseEnter(i),(o=(r=n.events)==null?void 0:r.mouseEnter)==null||o.call(r,i)}),e.mouseMove.on(i=>{var r,o;t.nodeMouseMove(i),(o=(r=n.events)==null?void 0:r.mouseMove)==null||o.call(r,i)}),e.mouseLeave.on(i=>{var r,o;t.nodeMouseLeave(i),(o=(r=n.events)==null?void 0:r.mouseLeave)==null||o.call(r,i)}),e.contextMenu.on(i=>{var r,o;t.nodeContextMenu(i),(o=(r=n.events)==null?void 0:r.contextMenu)==null||o.call(r,i)}),e.dragStart.on(i=>{var r,o;t.nodeDragStart(i),(o=(r=n.events)==null?void 0:r.dragStart)==null||o.call(r,i)}),e.drag.on(i=>{var r,o;t.nodeDrag(i),(o=(r=n.events)==null?void 0:r.drag)==null||o.call(r,i)}),e.dragStop.on(i=>{var r,o;t.nodeDragStop(i),(o=(r=n.events)==null?void 0:r.dragStop)==null||o.call(r,i)}),Object.entries(e).reduce((i,[r,o])=>(i.emit[r]=o.trigger,i.on[r]=o.on,i),{emit:{},on:{}})}function xO(){const{getSelectedNodes:n,nodeExtent:t,updateNodePositions:e,findNode:i,snapGrid:r,snapToGrid:o,nodesDraggable:s,emits:a}=yi();return(l,h=!1)=>{const u=o.value?r.value[0]:5,d=o.value?r.value[1]:5,c=h?4:1,g=l.x*u*c,f=l.y*d*c,p=[];for(const m of n.value)if(m.draggable||s&&typeof m.draggable>"u"){const v={x:m.computedPosition.x+g,y:m.computedPosition.y+f},{computedPosition:b}=q1(m,v,a.error,t.value,m.parentNode?i(m.parentNode):void 0);p.push({id:m.id,position:b,from:m.position,distance:{x:l.x,y:l.y},dimensions:m.dimensions})}e(p,!0,!1)}}const zb=.1,_9=n=>((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2;function Hs(){return Jm("Viewport not initialized yet."),Promise.resolve(!1)}const w9={zoomIn:Hs,zoomOut:Hs,zoomTo:Hs,fitView:Hs,setCenter:Hs,fitBounds:Hs,project:n=>n,screenToFlowCoordinate:n=>n,flowToScreenCoordinate:n=>n,setViewport:Hs,setTransform:Hs,getViewport:()=>({x:0,y:0,zoom:1}),getTransform:()=>({x:0,y:0,zoom:1}),viewportInitialized:!1};function x9(n){function t(i,r){return new Promise(o=>{n.d3Selection&&n.d3Zoom?n.d3Zoom.interpolate(r?.interpolate==="linear"?Id:Of).scaleBy(Nb(n.d3Selection,r?.duration,r?.ease,()=>{o(!0)}),i):o(!1)})}function e(i,r,o,s){return new Promise(a=>{var l;const{x:h,y:u}=oO({x:-i,y:-r},n.translateExtent),d=gu.translate(-h,-u).scale(o);n.d3Selection&&n.d3Zoom?(l=n.d3Zoom)==null||l.interpolate(s?.interpolate==="linear"?Id:Of).transform(Nb(n.d3Selection,s?.duration,s?.ease,()=>{a(!0)}),d):a(!1)})}return ee(()=>n.d3Zoom&&n.d3Selection&&n.dimensions.width&&n.dimensions.height?{viewportInitialized:!0,zoomIn:r=>t(1.2,r),zoomOut:r=>t(1/1.2,r),zoomTo:(r,o)=>new Promise(s=>{n.d3Selection&&n.d3Zoom?n.d3Zoom.interpolate(o?.interpolate==="linear"?Id:Of).scaleTo(Nb(n.d3Selection,o?.duration,o?.ease,()=>{s(!0)}),r):s(!1)}),setViewport:(r,o)=>e(r.x,r.y,r.zoom,o),setTransform:(r,o)=>e(r.x,r.y,r.zoom,o),getViewport:()=>({x:n.viewport.x,y:n.viewport.y,zoom:n.viewport.zoom}),getTransform:()=>({x:n.viewport.x,y:n.viewport.y,zoom:n.viewport.zoom}),fitView:(r={padding:zb,includeHiddenNodes:!1,duration:0})=>{var o,s;const a=[];for(const c of n.nodes)c.dimensions.width&&c.dimensions.height&&(r?.includeHiddenNodes||!c.hidden)&&(!((o=r.nodes)!=null&&o.length)||(s=r.nodes)!=null&&s.length&&r.nodes.includes(c.id))&&a.push(c);if(!a.length)return Promise.resolve(!1);const l=uO(a),{x:h,y:u,zoom:d}=vA(l,n.dimensions.width,n.dimensions.height,r.minZoom??n.minZoom,r.maxZoom??n.maxZoom,r.padding??zb,r.offset);return e(h,u,d,r)},setCenter:(r,o,s)=>{const a=typeof s?.zoom<"u"?s.zoom:n.maxZoom,l=n.dimensions.width/2-r*a,h=n.dimensions.height/2-o*a;return e(l,h,a,s)},fitBounds:(r,o={padding:zb})=>{const{x:s,y:a,zoom:l}=vA(r,n.dimensions.width,n.dimensions.height,n.minZoom,n.maxZoom,o.padding);return e(s,a,l,o)},project:r=>vc(r,n.viewport,n.snapToGrid,n.snapGrid),screenToFlowCoordinate:r=>{if(n.vueFlowRef){const{x:o,y:s}=n.vueFlowRef.getBoundingClientRect(),a={x:r.x-o,y:r.y-s};return vc(a,n.viewport,n.snapToGrid,n.snapGrid)}return{x:0,y:0}},flowToScreenCoordinate:r=>{if(n.vueFlowRef){const{x:o,y:s}=n.vueFlowRef.getBoundingClientRect(),a={x:r.x+o,y:r.y+s};return y_(a,n.viewport)}return{x:0,y:0}}}:w9)}function Nb(n,t=0,e=_9,i=()=>{}){const r=typeof t=="number"&&t>0;return r||i(),r?n.transition().duration(t).ease(e).on("end",i):n}function S9(n,t,e){const i=WP(!0);return i.run(()=>{const r=()=>{i.run(()=>{let p,m,v=!!(e.nodes.value.length||e.edges.value.length);p=Kl([n.modelValue,()=>{var b,y;return(y=(b=n.modelValue)==null?void 0:b.value)==null?void 0:y.length}],([b])=>{b&&Array.isArray(b)&&(m?.pause(),e.setElements(b),!m&&!v&&b.length?v=!0:m?.resume())}),m=Kl([e.nodes,e.edges,()=>e.edges.value.length,()=>e.nodes.value.length],([b,y])=>{var C;(C=n.modelValue)!=null&&C.value&&Array.isArray(n.modelValue.value)&&(p?.pause(),n.modelValue.value=[...b,...y],ys(()=>{p?.resume()}))},{immediate:v}),Pf(()=>{p?.stop(),m?.stop()})})},o=()=>{i.run(()=>{let p,m,v=!!e.nodes.value.length;p=Kl([n.nodes,()=>{var b,y;return(y=(b=n.nodes)==null?void 0:b.value)==null?void 0:y.length}],([b])=>{b&&Array.isArray(b)&&(m?.pause(),e.setNodes(b),!m&&!v&&b.length?v=!0:m?.resume())}),m=Kl([e.nodes,()=>e.nodes.value.length],([b])=>{var y;(y=n.nodes)!=null&&y.value&&Array.isArray(n.nodes.value)&&(p?.pause(),n.nodes.value=[...b],ys(()=>{p?.resume()}))},{immediate:v}),Pf(()=>{p?.stop(),m?.stop()})})},s=()=>{i.run(()=>{let p,m,v=!!e.edges.value.length;p=Kl([n.edges,()=>{var b,y;return(y=(b=n.edges)==null?void 0:b.value)==null?void 0:y.length}],([b])=>{b&&Array.isArray(b)&&(m?.pause(),e.setEdges(b),!m&&!v&&b.length?v=!0:m?.resume())}),m=Kl([e.edges,()=>e.edges.value.length],([b])=>{var y;(y=n.edges)!=null&&y.value&&Array.isArray(n.edges.value)&&(p?.pause(),n.edges.value=[...b],ys(()=>{p?.resume()}))},{immediate:v}),Pf(()=>{p?.stop(),m?.stop()})})},a=()=>{i.run(()=>{He(()=>t.maxZoom,()=>{t.maxZoom&&Hi(t.maxZoom)&&e.setMaxZoom(t.maxZoom)},{immediate:!0})})},l=()=>{i.run(()=>{He(()=>t.minZoom,()=>{t.minZoom&&Hi(t.minZoom)&&e.setMinZoom(t.minZoom)},{immediate:!0})})},h=()=>{i.run(()=>{He(()=>t.translateExtent,()=>{t.translateExtent&&Hi(t.translateExtent)&&e.setTranslateExtent(t.translateExtent)},{immediate:!0})})},u=()=>{i.run(()=>{He(()=>t.nodeExtent,()=>{t.nodeExtent&&Hi(t.nodeExtent)&&e.setNodeExtent(t.nodeExtent)},{immediate:!0})})},d=()=>{i.run(()=>{He(()=>t.applyDefault,()=>{Hi(t.applyDefault)&&(e.applyDefault.value=t.applyDefault)},{immediate:!0})})},c=()=>{i.run(()=>{const p=async m=>{let v=m;typeof t.autoConnect=="function"&&(v=await t.autoConnect(m)),v!==!1&&e.addEdges([v])};He(()=>t.autoConnect,()=>{Hi(t.autoConnect)&&(e.autoConnect.value=t.autoConnect)},{immediate:!0}),He(e.autoConnect,(m,v,b)=>{m?e.onConnect(p):e.hooks.value.connect.off(p),b(()=>{e.hooks.value.connect.off(p)})},{immediate:!0})})},g=()=>{const p=["id","modelValue","translateExtent","nodeExtent","edges","nodes","maxZoom","minZoom","applyDefault","autoConnect"];for(const m of Object.keys(t)){const v=m;if(!p.includes(v)){const b=Ti(()=>t[v]),y=e[v];y1(y)&&i.run(()=>{He(b,C=>{Hi(C)&&(y.value=C)},{immediate:!0})})}}};(()=>{r(),o(),s(),l(),a(),h(),u(),d(),c(),g()})()}),()=>i.stop()}function A9(){return{edgesChange:xt(),nodesChange:xt(),nodeDoubleClick:xt(),nodeClick:xt(),nodeMouseEnter:xt(),nodeMouseMove:xt(),nodeMouseLeave:xt(),nodeContextMenu:xt(),nodeDragStart:xt(),nodeDrag:xt(),nodeDragStop:xt(),nodesInitialized:xt(),miniMapNodeClick:xt(),miniMapNodeDoubleClick:xt(),miniMapNodeMouseEnter:xt(),miniMapNodeMouseMove:xt(),miniMapNodeMouseLeave:xt(),connect:xt(),connectStart:xt(),connectEnd:xt(),clickConnectStart:xt(),clickConnectEnd:xt(),paneReady:xt(),init:xt(),move:xt(),moveStart:xt(),moveEnd:xt(),selectionDragStart:xt(),selectionDrag:xt(),selectionDragStop:xt(),selectionContextMenu:xt(),selectionStart:xt(),selectionEnd:xt(),viewportChangeStart:xt(),viewportChange:xt(),viewportChangeEnd:xt(),paneScroll:xt(),paneClick:xt(),paneContextMenu:xt(),paneMouseEnter:xt(),paneMouseMove:xt(),paneMouseLeave:xt(),edgeContextMenu:xt(),edgeMouseEnter:xt(),edgeMouseMove:xt(),edgeMouseLeave:xt(),edgeDoubleClick:xt(),edgeClick:xt(),edgeUpdateStart:xt(),edgeUpdate:xt(),edgeUpdateEnd:xt(),updateNodeInternals:xt(),error:xt(n=>Jm(n.message))}}function M9(n,t){Sz(()=>{for(const[e,i]of Object.entries(t.value)){const r=o=>{n(e,o)};i.fns.add(r),$m(()=>{i.off(r)})}})}function SO(){return{vueFlowRef:null,viewportRef:null,nodes:[],edges:[],connectionLookup:new Map,nodeTypes:{},edgeTypes:{},initialized:!1,dimensions:{width:0,height:0},viewport:{x:0,y:0,zoom:1},d3Zoom:null,d3Selection:null,d3ZoomHandler:null,minZoom:.5,maxZoom:2,translateExtent:[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],nodeExtent:[[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY]],selectionMode:Y1.Full,paneDragging:!1,preventScrolling:!0,zoomOnScroll:!0,zoomOnPinch:!0,zoomOnDoubleClick:!0,panOnScroll:!1,panOnScrollSpeed:.5,panOnScrollMode:Hd.Free,paneClickDistance:0,panOnDrag:!0,edgeUpdaterRadius:10,onlyRenderVisibleElements:!1,defaultViewport:{x:0,y:0,zoom:1},nodesSelectionActive:!1,userSelectionActive:!1,userSelectionRect:null,defaultMarkerColor:"#b1b1b7",connectionLineStyle:{},connectionLineType:null,connectionLineOptions:{type:Ka.Bezier,style:{}},connectionMode:fa.Loose,connectionStartHandle:null,connectionEndHandle:null,connectionClickStartHandle:null,connectionPosition:{x:Number.NaN,y:Number.NaN},connectionRadius:20,connectOnClick:!0,connectionStatus:null,isValidConnection:null,snapGrid:[15,15],snapToGrid:!1,edgesUpdatable:!1,edgesFocusable:!0,nodesFocusable:!0,nodesConnectable:!0,nodesDraggable:!0,nodeDragThreshold:1,elementsSelectable:!0,selectNodesOnDrag:!0,multiSelectionActive:!1,selectionKeyCode:"Shift",multiSelectionKeyCode:Mp()?"Meta":"Control",zoomActivationKeyCode:Mp()?"Meta":"Control",deleteKeyCode:"Backspace",panActivationKeyCode:"Space",hooks:A9(),applyDefault:!0,autoConnect:!1,fitViewOnInit:!1,fitViewOnInitDone:!1,noDragClassName:"nodrag",noWheelClassName:"nowheel",noPanClassName:"nopan",defaultEdgeOptions:void 0,elevateEdgesOnSelect:!1,elevateNodesOnSelect:!0,autoPanOnNodeDrag:!0,autoPanOnConnect:!0,autoPanSpeed:15,disableKeyboardA11y:!1,ariaLiveMessage:""}}const T9=["id","vueFlowRef","viewportRef","initialized","modelValue","nodes","edges","maxZoom","minZoom","translateExtent","hooks","defaultEdgeOptions"];function R9(n,t,e){const i=x9(n),r=F=>{const N=F??[];n.hooks.updateNodeInternals.trigger(N)},o=F=>GV(F,n.nodes,n.edges),s=F=>VV(F,n.nodes,n.edges),a=F=>cO(F,n.edges),l=({id:F,type:N,nodeId:W})=>{var V;return Array.from(((V=n.connectionLookup.get(`${W}-${N}-${F??null}`))==null?void 0:V.values())??[])},h=F=>{if(F)return t.value.get(F)},u=F=>{if(F)return e.value.get(F)},d=(F,N,W)=>{var V,K;const et=[];for(const it of F){const rt={id:it.id,type:"position",dragging:W,from:it.from};if(N&&(rt.position=it.position,it.parentNode)){const lt=h(it.parentNode);rt.position={x:rt.position.x-(((V=lt?.computedPosition)==null?void 0:V.x)??0),y:rt.position.y-(((K=lt?.computedPosition)==null?void 0:K.y)??0)}}et.push(rt)}et?.length&&n.hooks.nodesChange.trigger(et)},c=F=>{if(!n.vueFlowRef)return;const N=n.vueFlowRef.querySelector(".vue-flow__transformationpane");if(!N)return;const W=window.getComputedStyle(N),{m22:V}=new window.DOMMatrixReadOnly(W.transform),K=[];for(const et of F){const it=et,rt=h(it.id);if(rt){const lt=Km(it.nodeElement);if(!!(lt.width&&lt.height&&(rt.dimensions.width!==lt.width||rt.dimensions.height!==lt.height||it.forceUpdate))){const ut=it.nodeElement.getBoundingClientRect();rt.dimensions=lt,rt.handleBounds.source=TA("source",it.nodeElement,ut,V,rt.id),rt.handleBounds.target=TA("target",it.nodeElement,ut,V,rt.id),K.push({id:rt.id,type:"dimensions",dimensions:lt})}}}!n.fitViewOnInitDone&&n.fitViewOnInit&&i.value.fitView().then(()=>{n.fitViewOnInitDone=!0}),K.length&&n.hooks.nodesChange.trigger(K)},g=(F,N)=>{const W=new Set,V=new Set;for(const it of F)yl(it)?W.add(it.id):pa(it)&&V.add(it.id);const K=$s(t.value,W,!0),et=$s(e.value,V);if(n.multiSelectionActive){for(const it of W)K.push(Vs(it,N));for(const it of V)et.push(Vs(it,N))}K.length&&n.hooks.nodesChange.trigger(K),et.length&&n.hooks.edgesChange.trigger(et)},f=F=>{if(n.multiSelectionActive){const N=F.map(W=>Vs(W.id,!0));n.hooks.nodesChange.trigger(N);return}n.hooks.nodesChange.trigger($s(t.value,new Set(F.map(N=>N.id)),!0)),n.hooks.edgesChange.trigger($s(e.value))},p=F=>{if(n.multiSelectionActive){const N=F.map(W=>Vs(W.id,!0));n.hooks.edgesChange.trigger(N);return}n.hooks.edgesChange.trigger($s(e.value,new Set(F.map(N=>N.id)))),n.hooks.nodesChange.trigger($s(t.value,new Set,!0))},m=F=>{g(F,!0)},v=F=>{const W=(F||n.nodes).map(V=>(V.selected=!1,Vs(V.id,!1)));n.hooks.nodesChange.trigger(W)},b=F=>{const W=(F||n.edges).map(V=>(V.selected=!1,Vs(V.id,!1)));n.hooks.edgesChange.trigger(W)},y=F=>{if(!F||!F.length)return g([],!1);const N=F.reduce((W,V)=>{const K=Vs(V.id,!1);return yl(V)?W.nodes.push(K):W.edges.push(K),W},{nodes:[],edges:[]});N.nodes.length&&n.hooks.nodesChange.trigger(N.nodes),N.edges.length&&n.hooks.edgesChange.trigger(N.edges)},C=F=>{var N;(N=n.d3Zoom)==null||N.scaleExtent([F,n.maxZoom]),n.minZoom=F},w=F=>{var N;(N=n.d3Zoom)==null||N.scaleExtent([n.minZoom,F]),n.maxZoom=F},_=F=>{var N;(N=n.d3Zoom)==null||N.translateExtent(F),n.translateExtent=F},A=F=>{n.nodeExtent=F,r()},x=F=>{var N;(N=n.d3Zoom)==null||N.clickDistance(F)},S=F=>{n.nodesDraggable=F,n.nodesConnectable=F,n.elementsSelectable=F},T=F=>{const N=F instanceof Function?F(n.nodes):F;!n.initialized&&!N.length||(n.nodes=RA(N,h,n.hooks.error.trigger))},M=F=>{const N=F instanceof Function?F(n.edges):F;if(!n.initialized&&!N.length)return;const W=Fb(N,n.isValidConnection,h,u,n.hooks.error.trigger,n.defaultEdgeOptions,n.nodes,n.edges);Db(n.connectionLookup,e.value,W),n.edges=W},R=F=>{const N=F instanceof Function?F([...n.nodes,...n.edges]):F;!n.initialized&&!N.length||(T(N.filter(yl)),M(N.filter(pa)))},E=F=>{let N=F instanceof Function?F(n.nodes):F;N=Array.isArray(N)?N:[N];const W=RA(N,h,n.hooks.error.trigger),V=[];for(const K of W)V.push(CA(K));V.length&&n.hooks.nodesChange.trigger(V)},P=F=>{let N=F instanceof Function?F(n.edges):F;N=Array.isArray(N)?N:[N];const W=Fb(N,n.isValidConnection,h,u,n.hooks.error.trigger,n.defaultEdgeOptions,n.nodes,n.edges),V=[];for(const K of W)V.push(CA(K));V.length&&n.hooks.edgesChange.trigger(V)},B=(F,N=!0,W=!1)=>{const V=F instanceof Function?F(n.nodes):F,K=Array.isArray(V)?V:[V],et=[],it=[];function rt(ct){const ut=a(ct);for(const gt of ut)(!Hi(gt.deletable)||gt.deletable)&&it.push(wA(gt.id,gt.source,gt.target,gt.sourceHandle,gt.targetHandle))}function lt(ct){const ut=[];for(const gt of n.nodes)gt.parentNode===ct&&ut.push(gt);if(ut.length){for(const gt of ut)et.push(_A(gt.id));N&&rt(ut);for(const gt of ut)lt(gt.id)}}for(const ct of K){const ut=typeof ct=="string"?h(ct):ct;ut&&(Hi(ut.deletable)&&!ut.deletable||(et.push(_A(ut.id)),N&&rt([ut]),W&&lt(ut.id)))}it.length&&n.hooks.edgesChange.trigger(it),et.length&&n.hooks.nodesChange.trigger(et)},k=F=>{const N=F instanceof Function?F(n.edges):F,W=Array.isArray(N)?N:[N],V=[];for(const K of W){const et=typeof K=="string"?u(K):K;et&&(Hi(et.deletable)&&!et.deletable||V.push(wA(typeof K=="string"?K:K.id,et.source,et.target,et.sourceHandle,et.targetHandle)))}n.hooks.edgesChange.trigger(V)},L=(F,N,W=!0)=>{const V=u(F.id);if(!V)return!1;const K=n.edges.indexOf(V),et=c9(F,N,V,W,n.hooks.error.trigger);if(et){const[it]=Fb([et],n.isValidConnection,h,u,n.hooks.error.trigger,n.defaultEdgeOptions,n.nodes,n.edges);return n.edges=n.edges.map((rt,lt)=>lt===K?it:rt),Db(n.connectionLookup,e.value,[it]),it}return!1},O=(F,N,W={replace:!1})=>{const V=u(F);if(!V)return;const K=typeof N=="function"?N(V):N;V.data=W.replace?K:{...V.data,...K}},I=F=>yA(F,n.nodes),H=F=>{const N=yA(F,n.edges);return Db(n.connectionLookup,e.value,N),N},D=(F,N,W={replace:!1})=>{const V=h(F);if(!V)return;const K=typeof N=="function"?N(V):N;W.replace?n.nodes.splice(n.nodes.indexOf(V),1,K):Object.assign(V,K)},z=(F,N,W={replace:!1})=>{const V=h(F);if(!V)return;const K=typeof N=="function"?N(V):N;V.data=W.replace?K:{...V.data,...K}},G=(F,N,W=!1)=>{W?n.connectionClickStartHandle=F:n.connectionStartHandle=F,n.connectionEndHandle=null,n.connectionStatus=null,N&&(n.connectionPosition=N)},U=(F,N=null,W=null)=>{n.connectionStartHandle&&(n.connectionPosition=F,n.connectionEndHandle=N,n.connectionStatus=W)},j=(F,N)=>{n.connectionPosition={x:Number.NaN,y:Number.NaN},n.connectionEndHandle=null,n.connectionStatus=null,N?n.connectionClickStartHandle=null:n.connectionStartHandle=null},X=F=>{const N=WV(F),W=N?null:bd(F)?F:h(F.id);return!N&&!W?[null,null,N]:[N?F:Sp(W),W,N]},Z=(F,N=!0,W=n.nodes)=>{const[V,K,et]=X(F);if(!V)return[];const it=[];for(const rt of W||n.nodes){if(!et&&(rt.id===K.id||!rt.computedPosition))continue;const lt=Sp(rt),ct=Ap(lt,V);(N&&ct>0||ct>=Number(V.width)*Number(V.height))&&it.push(rt)}return it},J=(F,N,W=!0)=>{const[V]=X(F);if(!V)return!1;const K=Ap(V,N);return W&&K>0||K>=Number(V.width)*Number(V.height)},q=F=>{const{viewport:N,dimensions:W,d3Zoom:V,d3Selection:K,translateExtent:et}=n;if(!V||!K||!F.x&&!F.y)return!1;const it=gu.translate(N.x+F.x,N.y+F.y).scale(N.zoom),rt=[[0,0],[W.width,W.height]],lt=V.constrain()(it,rt,et),ct=n.viewport.x!==lt.x||n.viewport.y!==lt.y||n.viewport.zoom!==lt.k;return V.transform(K,lt),ct},st=F=>{const N=F instanceof Function?F(n):F,W=["d3Zoom","d3Selection","d3ZoomHandler","viewportRef","vueFlowRef","dimensions","hooks"];Hi(N.defaultEdgeOptions)&&(n.defaultEdgeOptions=N.defaultEdgeOptions);const V=N.modelValue||N.nodes||N.edges?[]:void 0;V&&(N.modelValue&&V.push(...N.modelValue),N.nodes&&V.push(...N.nodes),N.edges&&V.push(...N.edges),R(V));const K=()=>{Hi(N.maxZoom)&&w(N.maxZoom),Hi(N.minZoom)&&C(N.minZoom),Hi(N.translateExtent)&&_(N.translateExtent)};for(const et of Object.keys(N)){const it=et,rt=N[it];![...T9,...W].includes(it)&&Hi(rt)&&(n[it]=rt)}l_(()=>n.d3Zoom).not.toBeNull().then(K),n.initialized||(n.initialized=!0)};return{updateNodePositions:d,updateNodeDimensions:c,setElements:R,setNodes:T,setEdges:M,addNodes:E,addEdges:P,removeNodes:B,removeEdges:k,findNode:h,findEdge:u,updateEdge:L,updateEdgeData:O,updateNode:D,updateNodeData:z,applyEdgeChanges:H,applyNodeChanges:I,addSelectedElements:m,addSelectedNodes:f,addSelectedEdges:p,setMinZoom:C,setMaxZoom:w,setTranslateExtent:_,setNodeExtent:A,setPaneClickDistance:x,removeSelectedElements:y,removeSelectedNodes:v,removeSelectedEdges:b,startConnection:G,updateConnection:U,endConnection:j,setInteractive:S,setState:st,getIntersectingNodes:Z,getIncomers:o,getOutgoers:s,getConnectedEdges:a,getHandleConnections:l,isNodeIntersecting:J,panBy:q,fitView:F=>i.value.fitView(F),zoomIn:F=>i.value.zoomIn(F),zoomOut:F=>i.value.zoomOut(F),zoomTo:(F,N)=>i.value.zoomTo(F,N),setViewport:(F,N)=>i.value.setViewport(F,N),setTransform:(F,N)=>i.value.setTransform(F,N),getViewport:()=>i.value.getViewport(),getTransform:()=>i.value.getTransform(),setCenter:(F,N,W)=>i.value.setCenter(F,N,W),fitBounds:(F,N)=>i.value.fitBounds(F,N),project:F=>i.value.project(F),screenToFlowCoordinate:F=>i.value.screenToFlowCoordinate(F),flowToScreenCoordinate:F=>i.value.flowToScreenCoordinate(F),toObject:()=>{const F=[],N=[];for(const W of n.nodes){const{computedPosition:V,handleBounds:K,selected:et,dimensions:it,isParent:rt,resizing:lt,dragging:ct,events:ut,...gt}=W;F.push(gt)}for(const W of n.edges){const{selected:V,sourceNode:K,targetNode:et,events:it,...rt}=W;N.push(rt)}return JSON.parse(JSON.stringify({nodes:F,edges:N,position:[n.viewport.x,n.viewport.y],zoom:n.viewport.zoom,viewport:n.viewport}))},fromObject:F=>new Promise(N=>{const{nodes:W,edges:V,position:K,zoom:et,viewport:it}=F;if(W&&T(W),V&&M(V),it?.x&&it?.y||K){const rt=it?.x||K[0],lt=it?.y||K[1],ct=it?.zoom||et||n.viewport.zoom;return l_(()=>i.value.viewportInitialized).toBe(!0).then(()=>{i.value.setViewport({x:rt,y:lt,zoom:ct}).then(()=>{N(!0)})})}else N(!0)}),updateNodeInternals:r,viewportHelper:i,$reset:()=>{const F=SO();if(n.edges=[],n.nodes=[],n.d3Zoom&&n.d3Selection){const N=gu.translate(F.defaultViewport.x??0,F.defaultViewport.y??0).scale(Ll(F.defaultViewport.zoom??1,F.minZoom,F.maxZoom)),W=n.viewportRef.getBoundingClientRect(),V=[[0,0],[W.width,W.height]],K=n.d3Zoom.constrain()(N,V,F.translateExtent);n.d3Zoom.transform(n.d3Selection,K)}st(F)},$destroy:()=>{}}}const B9=["data-id","data-handleid","data-nodeid","data-handlepos"],k9={name:"Handle",compatConfig:{MODE:3}},Tp=bi({...k9,props:{id:{default:null},type:{},position:{default:()=>Rt.Top},isValidConnection:{type:Function},connectable:{type:[Boolean,Number,String,Function],default:void 0},connectableStart:{type:Boolean,default:!0},connectableEnd:{type:Boolean,default:!0}},setup(n,{expose:t}){const e=kz(n,["position","connectable","connectableStart","connectableEnd","id"]),i=Ti(()=>e.type??"source"),r=Ti(()=>e.isValidConnection??null),{id:o,connectionStartHandle:s,connectionClickStartHandle:a,connectionEndHandle:l,vueFlowRef:h,nodesConnectable:u,noDragClassName:d,noPanClassName:c}=yi(),{id:g,node:f,nodeEl:p,connectedEdges:m}=wO(),v=fi(),b=Ti(()=>typeof n.connectableStart<"u"?n.connectableStart:!0),y=Ti(()=>typeof n.connectableEnd<"u"?n.connectableEnd:!0),C=Ti(()=>{var M,R,E,P,B,k;return((M=s.value)==null?void 0:M.nodeId)===g&&((R=s.value)==null?void 0:R.id)===n.id&&((E=s.value)==null?void 0:E.type)===i.value||((P=l.value)==null?void 0:P.nodeId)===g&&((B=l.value)==null?void 0:B.id)===n.id&&((k=l.value)==null?void 0:k.type)===i.value}),w=Ti(()=>{var M,R,E;return((M=a.value)==null?void 0:M.nodeId)===g&&((R=a.value)==null?void 0:R.id)===n.id&&((E=a.value)==null?void 0:E.type)===i.value}),{handlePointerDown:_,handleClick:A}=_O({nodeId:g,handleId:n.id,isValidConnection:r,type:i}),x=ee(()=>typeof n.connectable=="string"&&n.connectable==="single"?!m.value.some(M=>{const R=M[`${i.value}Handle`];return M[i.value]!==g?!1:R?R===n.id:!0}):typeof n.connectable=="number"?m.value.filter(M=>{const R=M[`${i.value}Handle`];return M[i.value]!==g?!1:R?R===n.id:!0}).length<n.connectable:typeof n.connectable=="function"?n.connectable(f,m.value):Hi(n.connectable)?n.connectable:u.value);wa(()=>{var M;if(!f.dimensions.width||!f.dimensions.height)return;const R=(M=f.handleBounds[i.value])==null?void 0:M.find(I=>I.id===n.id);if(!h.value||R)return;const E=h.value.querySelector(".vue-flow__transformationpane");if(!p.value||!v.value||!E||!n.id)return;const P=p.value.getBoundingClientRect(),B=v.value.getBoundingClientRect(),k=window.getComputedStyle(E),{m22:L}=new window.DOMMatrixReadOnly(k.transform),O={id:n.id,position:n.position,x:(B.left-P.left)/L,y:(B.top-P.top)/L,type:i.value,nodeId:g,...Km(v.value)};f.handleBounds[i.value]=[...f.handleBounds[i.value]??[],O]});function S(M){const R=K1(M);x.value&&b.value&&(R&&M.button===0||!R)&&_(M)}function T(M){!g||!a.value&&!b.value||x.value&&A(M)}return t({handleClick:A,handlePointerDown:_,onClick:T,onPointerDown:S}),(M,R)=>(Be(),ni("div",{ref_key:"handle",ref:v,"data-id":`${It(o)}-${It(g)}-${n.id}-${i.value}`,"data-handleid":n.id,"data-nodeid":It(g),"data-handlepos":M.position,class:ic(["vue-flow__handle",[`vue-flow__handle-${M.position}`,`vue-flow__handle-${n.id}`,It(d),It(c),i.value,{connectable:x.value,connecting:w.value,connectablestart:b.value,connectableend:y.value,connectionindicator:x.value&&(b.value&&!C.value||y.value&&C.value)}]]),onMousedown:S,onTouchstartPassive:S,onClick:T},[Ml(M.$slots,"default",{id:M.id})],42,B9))}}),tv=function({sourcePosition:n=Rt.Bottom,targetPosition:t=Rt.Top,label:e,connectable:i=!0,isValidTargetPos:r,isValidSourcePos:o,data:s}){const a=s.label??e;return[De(Tp,{type:"target",position:t,connectable:i,isValidConnection:r}),typeof a!="string"&&a?De(a):De(Io,[a]),De(Tp,{type:"source",position:n,connectable:i,isValidConnection:o})]};tv.props=["sourcePosition","targetPosition","label","isValidTargetPos","isValidSourcePos","connectable","data"];tv.inheritAttrs=!1;tv.compatConfig={MODE:3};const P9=tv,ev=function({targetPosition:n=Rt.Top,label:t,connectable:e=!0,isValidTargetPos:i,data:r}){const o=r.label??t;return[De(Tp,{type:"target",position:n,connectable:e,isValidConnection:i}),typeof o!="string"&&o?De(o):De(Io,[o])]};ev.props=["targetPosition","label","isValidTargetPos","connectable","data"];ev.inheritAttrs=!1;ev.compatConfig={MODE:3};const E9=ev,iv=function({sourcePosition:n=Rt.Bottom,label:t,connectable:e=!0,isValidSourcePos:i,data:r}){const o=r.label??t;return[typeof o!="string"&&o?De(o):De(Io,[o]),De(Tp,{type:"source",position:n,connectable:e,isValidConnection:i})]};iv.props=["sourcePosition","label","isValidSourcePos","connectable","data"];iv.inheritAttrs=!1;iv.compatConfig={MODE:3};const L9=iv,O9=["transform"],I9=["width","height","x","y","rx","ry"],H9=["y"],D9={name:"EdgeText",compatConfig:{MODE:3}},F9=bi({...D9,props:{x:{},y:{},label:{},labelStyle:{default:()=>({})},labelShowBg:{type:Boolean,default:!0},labelBgStyle:{default:()=>({})},labelBgPadding:{default:()=>[2,4]},labelBgBorderRadius:{default:2}},setup(n){const t=fi({x:0,y:0,width:0,height:0}),e=fi(null),i=ee(()=>`translate(${n.x-t.value.width/2} ${n.y-t.value.height/2})`);wa(r),He([()=>n.x,()=>n.y,e,()=>n.label],r);function r(){if(!e.value)return;const o=e.value.getBBox();(o.width!==t.value.width||o.height!==t.value.height)&&(t.value=o)}return(o,s)=>(Be(),ni("g",{transform:i.value,class:"vue-flow__edge-textwrapper"},[o.labelShowBg?(Be(),ni("rect",{key:0,class:"vue-flow__edge-textbg",width:`${t.value.width+2*o.labelBgPadding[0]}px`,height:`${t.value.height+2*o.labelBgPadding[1]}px`,x:-o.labelBgPadding[0],y:-o.labelBgPadding[1],style:aa(o.labelBgStyle),rx:o.labelBgBorderRadius,ry:o.labelBgBorderRadius},null,12,I9)):Ho("",!0),Tl("text",GP(o.$attrs,{ref_key:"el",ref:e,class:"vue-flow__edge-text",y:t.value.height/2,dy:"0.3em",style:o.labelStyle}),[Ml(o.$slots,"default",{},()=>[typeof o.label!="string"?(Be(),$h(Ez(o.label),{key:0})):(Be(),ni(Io,{key:1},[Lz(YC(o.label),1)],64))])],16,H9)],8,O9))}}),z9=["id","d","marker-end","marker-start"],N9=["d","stroke-width"],W9={name:"BaseEdge",inheritAttrs:!1,compatConfig:{MODE:3}},nv=bi({...W9,props:{id:{},labelX:{},labelY:{},path:{},label:{},markerStart:{},markerEnd:{},interactionWidth:{default:20},labelStyle:{},labelShowBg:{type:Boolean},labelBgStyle:{},labelBgPadding:{},labelBgBorderRadius:{}},setup(n,{expose:t}){const e=fi(null),i=fi(null),r=fi(null),o=Bz();return t({pathEl:e,interactionEl:i,labelEl:r}),(s,a)=>(Be(),ni(Io,null,[Tl("path",GP(It(o),{id:s.id,ref_key:"pathEl",ref:e,d:s.path,class:"vue-flow__edge-path","marker-end":s.markerEnd,"marker-start":s.markerStart}),null,16,z9),s.interactionWidth?(Be(),ni("path",{key:0,ref_key:"interactionEl",ref:i,fill:"none",d:s.path,"stroke-width":s.interactionWidth,"stroke-opacity":0,class:"vue-flow__edge-interaction"},null,8,N9)):Ho("",!0),s.label&&s.labelX&&s.labelY?(Be(),$h(F9,{key:1,ref_key:"labelEl",ref:r,x:s.labelX,y:s.labelY,label:s.label,"label-show-bg":s.labelShowBg,"label-bg-style":s.labelBgStyle,"label-bg-padding":s.labelBgPadding,"label-bg-border-radius":s.labelBgBorderRadius,"label-style":s.labelStyle},null,8,["x","y","label","label-show-bg","label-bg-style","label-bg-padding","label-bg-border-radius","label-style"])):Ho("",!0)],64))}});function AO({sourceX:n,sourceY:t,targetX:e,targetY:i}){const r=Math.abs(e-n)/2,o=e<n?e+r:e-r,s=Math.abs(i-t)/2,a=i<t?i+s:i-s;return[o,a,r,s]}function MO({sourceX:n,sourceY:t,targetX:e,targetY:i,sourceControlX:r,sourceControlY:o,targetControlX:s,targetControlY:a}){const l=n*.125+r*.375+s*.375+e*.125,h=t*.125+o*.375+a*.375+i*.125,u=Math.abs(l-n),d=Math.abs(h-t);return[l,h,u,d]}function zg(n,t){return n>=0?.5*n:t*25*Math.sqrt(-n)}function EA({pos:n,x1:t,y1:e,x2:i,y2:r,c:o}){let s,a;switch(n){case Rt.Left:s=t-zg(t-i,o),a=e;break;case Rt.Right:s=t+zg(i-t,o),a=e;break;case Rt.Top:s=t,a=e-zg(e-r,o);break;case Rt.Bottom:s=t,a=e+zg(r-e,o);break}return[s,a]}function TO(n){const{sourceX:t,sourceY:e,sourcePosition:i=Rt.Bottom,targetX:r,targetY:o,targetPosition:s=Rt.Top,curvature:a=.25}=n,[l,h]=EA({pos:i,x1:t,y1:e,x2:r,y2:o,c:a}),[u,d]=EA({pos:s,x1:r,y1:o,x2:t,y2:e,c:a}),[c,g,f,p]=MO({sourceX:t,sourceY:e,targetX:r,targetY:o,sourceControlX:l,sourceControlY:h,targetControlX:u,targetControlY:d});return[`M${t},${e} C${l},${h} ${u},${d} ${r},${o}`,c,g,f,p]}function LA({pos:n,x1:t,y1:e,x2:i,y2:r}){let o,s;switch(n){case Rt.Left:case Rt.Right:o=.5*(t+i),s=e;break;case Rt.Top:case Rt.Bottom:o=t,s=.5*(e+r);break}return[o,s]}function RO(n){const{sourceX:t,sourceY:e,sourcePosition:i=Rt.Bottom,targetX:r,targetY:o,targetPosition:s=Rt.Top}=n,[a,l]=LA({pos:i,x1:t,y1:e,x2:r,y2:o}),[h,u]=LA({pos:s,x1:r,y1:o,x2:t,y2:e}),[d,c,g,f]=MO({sourceX:t,sourceY:e,targetX:r,targetY:o,sourceControlX:a,sourceControlY:l,targetControlX:h,targetControlY:u});return[`M${t},${e} C${a},${l} ${h},${u} ${r},${o}`,d,c,g,f]}const OA={[Rt.Left]:{x:-1,y:0},[Rt.Right]:{x:1,y:0},[Rt.Top]:{x:0,y:-1},[Rt.Bottom]:{x:0,y:1}};function j9({source:n,sourcePosition:t=Rt.Bottom,target:e}){return t===Rt.Left||t===Rt.Right?n.x<e.x?{x:1,y:0}:{x:-1,y:0}:n.y<e.y?{x:0,y:1}:{x:0,y:-1}}function IA(n,t){return Math.sqrt((t.x-n.x)**2+(t.y-n.y)**2)}function V9({source:n,sourcePosition:t=Rt.Bottom,target:e,targetPosition:i=Rt.Top,center:r,offset:o}){const s=OA[t],a=OA[i],l={x:n.x+s.x*o,y:n.y+s.y*o},h={x:e.x+a.x*o,y:e.y+a.y*o},u=j9({source:l,sourcePosition:t,target:h}),d=u.x!==0?"x":"y",c=u[d];let g,f,p;const m={x:0,y:0},v={x:0,y:0},[b,y,C,w]=AO({sourceX:n.x,sourceY:n.y,targetX:e.x,targetY:e.y});if(s[d]*a[d]===-1){f=r.x??b,p=r.y??y;const A=[{x:f,y:l.y},{x:f,y:h.y}],x=[{x:l.x,y:p},{x:h.x,y:p}];s[d]===c?g=d==="x"?A:x:g=d==="x"?x:A}else{const A=[{x:l.x,y:h.y}],x=[{x:h.x,y:l.y}];if(d==="x"?g=s.x===c?x:A:g=s.y===c?A:x,t===i){const E=Math.abs(n[d]-e[d]);if(E<=o){const P=Math.min(o-1,o-E);s[d]===c?m[d]=(l[d]>n[d]?-1:1)*P:v[d]=(h[d]>e[d]?-1:1)*P}}if(t!==i){const E=d==="x"?"y":"x",P=s[d]===a[E],B=l[E]>h[E],k=l[E]<h[E];(s[d]===1&&(!P&&B||P&&k)||s[d]!==1&&(!P&&k||P&&B))&&(g=d==="x"?A:x)}const S={x:l.x+m.x,y:l.y+m.y},T={x:h.x+v.x,y:h.y+v.y},M=Math.max(Math.abs(S.x-g[0].x),Math.abs(T.x-g[0].x)),R=Math.max(Math.abs(S.y-g[0].y),Math.abs(T.y-g[0].y));M>=R?(f=(S.x+T.x)/2,p=g[0].y):(f=g[0].x,p=(S.y+T.y)/2)}return[[n,{x:l.x+m.x,y:l.y+m.y},...g,{x:h.x+v.x,y:h.y+v.y},e],f,p,C,w]}function G9(n,t,e,i){const r=Math.min(IA(n,t)/2,IA(t,e)/2,i),{x:o,y:s}=t;if(n.x===o&&o===e.x||n.y===s&&s===e.y)return`L${o} ${s}`;if(n.y===s){const h=n.x<e.x?-1:1,u=n.y<e.y?1:-1;return`L ${o+r*h},${s}Q ${o},${s} ${o},${s+r*u}`}const a=n.x<e.x?1:-1,l=n.y<e.y?-1:1;return`L ${o},${s+r*l}Q ${o},${s} ${o+r*a},${s}`}function w_(n){const{sourceX:t,sourceY:e,sourcePosition:i=Rt.Bottom,targetX:r,targetY:o,targetPosition:s=Rt.Top,borderRadius:a=5,centerX:l,centerY:h,offset:u=20}=n,[d,c,g,f,p]=V9({source:{x:t,y:e},sourcePosition:i,target:{x:r,y:o},targetPosition:s,center:{x:l,y:h},offset:u});return[d.reduce((v,b,y)=>{let C;return y>0&&y<d.length-1?C=G9(d[y-1],b,d[y+1],a):C=`${y===0?"M":"L"}${b.x} ${b.y}`,v+=C,v},""),c,g,f,p]}function $9(n){const{sourceX:t,sourceY:e,targetX:i,targetY:r}=n,[o,s,a,l]=AO({sourceX:t,sourceY:e,targetX:i,targetY:r});return[`M ${t},${e}L ${i},${r}`,o,s,a,l]}const U9=bi({name:"StraightEdge",props:["label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","sourceY","sourceX","targetX","targetY","markerEnd","markerStart","interactionWidth"],compatConfig:{MODE:3},setup(n,{attrs:t}){return()=>{const[e,i,r]=$9(n);return De(nv,{path:e,labelX:i,labelY:r,...t,...n})}}}),X9=U9,Y9=bi({name:"SmoothStepEdge",props:["sourcePosition","targetPosition","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","sourceY","sourceX","targetX","targetY","borderRadius","markerEnd","markerStart","interactionWidth","offset"],compatConfig:{MODE:3},setup(n,{attrs:t}){return()=>{const[e,i,r]=w_({...n,sourcePosition:n.sourcePosition??Rt.Bottom,targetPosition:n.targetPosition??Rt.Top});return De(nv,{path:e,labelX:i,labelY:r,...t,...n})}}}),BO=Y9,q9=bi({name:"StepEdge",props:["sourcePosition","targetPosition","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","sourceY","sourceX","targetX","targetY","markerEnd","markerStart","interactionWidth"],setup(n,{attrs:t}){return()=>De(BO,{...n,...t,borderRadius:0})}}),K9=q9,Z9=bi({name:"BezierEdge",props:["sourcePosition","targetPosition","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","sourceY","sourceX","targetX","targetY","curvature","markerEnd","markerStart","interactionWidth"],compatConfig:{MODE:3},setup(n,{attrs:t}){return()=>{const[e,i,r]=TO({...n,sourcePosition:n.sourcePosition??Rt.Bottom,targetPosition:n.targetPosition??Rt.Top});return De(nv,{path:e,labelX:i,labelY:r,...t,...n})}}}),J9=Z9,Q9=bi({name:"SimpleBezierEdge",props:["sourcePosition","targetPosition","label","labelStyle","labelShowBg","labelBgStyle","labelBgPadding","labelBgBorderRadius","sourceY","sourceX","targetX","targetY","markerEnd","markerStart","interactionWidth"],compatConfig:{MODE:3},setup(n,{attrs:t}){return()=>{const[e,i,r]=RO({...n,sourcePosition:n.sourcePosition??Rt.Bottom,targetPosition:n.targetPosition??Rt.Top});return De(nv,{path:e,labelX:i,labelY:r,...t,...n})}}}),t7=Q9,e7={input:L9,default:P9,output:E9},i7={default:J9,straight:X9,step:K9,smoothstep:BO,simplebezier:t7};function n7(n,t,e){const i=ee(()=>p=>t.value.get(p)),r=ee(()=>p=>e.value.get(p)),o=ee(()=>{const p={...i7,...n.edgeTypes},m=Object.keys(p);for(const v of n.edges)v.type&&!m.includes(v.type)&&(p[v.type]=v.type);return p}),s=ee(()=>{const p={...e7,...n.nodeTypes},m=Object.keys(p);for(const v of n.nodes)v.type&&!m.includes(v.type)&&(p[v.type]=v.type);return p}),a=ee(()=>n.onlyRenderVisibleElements?dO(n.nodes,{x:0,y:0,width:n.dimensions.width,height:n.dimensions.height},n.viewport,!0):n.nodes),l=ee(()=>{if(n.onlyRenderVisibleElements){const p=[];for(const m of n.edges){const v=t.value.get(m.source),b=t.value.get(m.target);QV({sourcePos:v.computedPosition||{x:0,y:0},targetPos:b.computedPosition||{x:0,y:0},sourceWidth:v.dimensions.width,sourceHeight:v.dimensions.height,targetWidth:b.dimensions.width,targetHeight:b.dimensions.height,width:n.dimensions.width,height:n.dimensions.height,viewport:n.viewport})&&p.push(m)}return p}return n.edges}),h=ee(()=>[...a.value,...l.value]),u=ee(()=>{const p=[];for(const m of n.nodes)m.selected&&p.push(m);return p}),d=ee(()=>{const p=[];for(const m of n.edges)m.selected&&p.push(m);return p}),c=ee(()=>[...u.value,...d.value]),g=ee(()=>{const p=[];for(const m of n.nodes)m.dimensions.width&&m.dimensions.height&&m.handleBounds!==void 0&&p.push(m);return p}),f=ee(()=>a.value.length>0&&g.value.length===a.value.length);return{getNode:i,getEdge:r,getElements:h,getEdgeTypes:o,getNodeTypes:s,getEdges:l,getNodes:a,getSelectedElements:c,getSelectedNodes:u,getSelectedEdges:d,getNodesInitialized:g,areNodesInitialized:f}}class Za{constructor(){this.currentId=0,this.flows=new Map}static getInstance(){var t;const e=(t=qc())==null?void 0:t.appContext.app,i=e?.config.globalProperties.$vueFlowStorage??Za.instance;return Za.instance=i??new Za,e&&(e.config.globalProperties.$vueFlowStorage=Za.instance),Za.instance}set(t,e){return this.flows.set(t,e)}get(t){return this.flows.get(t)}remove(t){return this.flows.delete(t)}create(t,e){const i=SO(),r=Mz(i),o={};for(const[c,g]of Object.entries(r.hooks)){const f=`on${c.charAt(0).toUpperCase()+c.slice(1)}`;o[f]=g.on}const s={};for(const[c,g]of Object.entries(r.hooks))s[c]=g.trigger;const a=ee(()=>{const c=new Map;for(const g of r.nodes)c.set(g.id,g);return c}),l=ee(()=>{const c=new Map;for(const g of r.edges)c.set(g.id,g);return c}),h=n7(r,a,l),u=R9(r,a,l);u.setState({...r,...e});const d={...o,...h,...u,...K6(r),nodeLookup:a,edgeLookup:l,emits:s,id:t,vueFlowVersion:"1.45.0",$destroy:()=>{this.remove(t)}};return this.set(t,d),d}getId(){return`vue-flow-${this.currentId++}`}}function yi(n){const t=Za.getInstance(),e=NP(),i=typeof n=="object",r=i?n:{id:n},o=r.id,s=o??e?.vueFlowId;let a;if(e){const l=Bu(PA,null);typeof l<"u"&&l!==null&&(!s||l.id===s)&&(a=l)}if(a||s&&(a=t.get(s)),!a||s&&a.id!==s){const l=o??t.getId(),h=t.create(l,r);a=h,(e??WP(!0)).run(()=>{He(h.applyDefault,(d,c,g)=>{const f=m=>{h.applyNodeChanges(m)},p=m=>{h.applyEdgeChanges(m)};d?(h.onNodesChange(f),h.onEdgesChange(p)):(h.hooks.value.nodesChange.off(f),h.hooks.value.edgesChange.off(p)),g(()=>{h.hooks.value.nodesChange.off(f),h.hooks.value.edgesChange.off(p)})},{immediate:!0}),$m(()=>{if(a){const d=t.get(a.id);d?d.$destroy():Jm(`No store instance found for id ${a.id} in storage.`)}})})}else i&&a.setState(r);if(e&&(Uh(PA,a),e.vueFlowId=a.id),i){const l=qc();l?.type.name!=="VueFlow"&&a.emits.error(new Gi(zi.USEVUEFLOW_OPTIONS))}return a}function r7(n){const{emits:t,dimensions:e}=yi();let i;wa(()=>{const r=n.value,o=()=>{if(!r)return;const s=Km(r);(s.width===0||s.height===0)&&t.error(new Gi(zi.MISSING_VIEWPORT_DIMENSIONS)),e.value={width:s.width||500,height:s.height||500}};o(),window.addEventListener("resize",o),r&&(i=new ResizeObserver(()=>o()),i.observe(r)),jP(()=>{window.removeEventListener("resize",o),i&&r&&i.unobserve(r)})})}const o7={name:"UserSelection",compatConfig:{MODE:3}},s7=bi({...o7,props:{userSelectionRect:{}},setup(n){return(t,e)=>(Be(),ni("div",{class:"vue-flow__selection vue-flow__container",style:aa({width:`${t.userSelectionRect.width}px`,height:`${t.userSelectionRect.height}px`,transform:`translate(${t.userSelectionRect.x}px, ${t.userSelectionRect.y}px)`})},null,4))}}),a7=["tabIndex"],l7={name:"NodesSelection",compatConfig:{MODE:3}},h7=bi({...l7,setup(n){const{emits:t,viewport:e,getSelectedNodes:i,noPanClassName:r,disableKeyboardA11y:o,userSelectionActive:s}=yi(),a=xO(),l=fi(null),h=CO({el:l,onStart(f){t.selectionDragStart(f)},onDrag(f){t.selectionDrag(f)},onStop(f){t.selectionDragStop(f)}});wa(()=>{var f;o.value||(f=l.value)==null||f.focus({preventScroll:!0})});const u=ee(()=>uO(i.value)),d=ee(()=>({width:`${u.value.width}px`,height:`${u.value.height}px`,top:`${u.value.y}px`,left:`${u.value.x}px`}));function c(f){t.selectionContextMenu({event:f,nodes:i.value})}function g(f){o||Mh[f.key]&&(f.preventDefault(),a({x:Mh[f.key].x,y:Mh[f.key].y},f.shiftKey))}return(f,p)=>!It(s)&&u.value.width&&u.value.height?(Be(),ni("div",{key:0,class:ic(["vue-flow__nodesselection vue-flow__container",It(r)]),style:aa({transform:`translate(${It(e).x}px,${It(e).y}px) scale(${It(e).zoom})`})},[Tl("div",{ref_key:"el",ref:l,class:ic([{dragging:It(h)},"vue-flow__nodesselection-rect"]),style:aa(d.value),tabIndex:It(o)?void 0:-1,onContextmenu:c,onKeydown:g},null,46,a7)],6)):Ho("",!0)}});function u7(n,t){return{x:n.clientX-t.left,y:n.clientY-t.top}}const d7={name:"Pane",compatConfig:{MODE:3}},c7=bi({...d7,props:{isSelecting:{type:Boolean},selectionKeyPressed:{type:Boolean}},setup(n){const{vueFlowRef:t,nodes:e,viewport:i,emits:r,userSelectionActive:o,removeSelectedElements:s,userSelectionRect:a,elementsSelectable:l,nodesSelectionActive:h,getSelectedEdges:u,getSelectedNodes:d,removeNodes:c,removeEdges:g,selectionMode:f,deleteKeyCode:p,multiSelectionKeyCode:m,multiSelectionActive:v,edgeLookup:b,nodeLookup:y,connectionLookup:C,defaultEdgeOptions:w,connectionStartHandle:_}=yi(),A=fi(null),x=fi(new Set),S=fi(new Set),T=fi(),M=Ti(()=>l.value&&(n.isSelecting||o.value)),R=Ti(()=>_.value!==null);let E=!1,P=!1;const B=Dd(p,{actInsideInputWithModifier:!1}),k=Dd(m);He(B,U=>{U&&(c(d.value),g(u.value),h.value=!1)}),He(k,U=>{v.value=U});function L(U,j){return X=>{X.target===j&&U?.(X)}}function O(U){if(E||R.value){E=!1;return}r.paneClick(U),s(),h.value=!1}function I(U){U.preventDefault(),U.stopPropagation(),r.paneContextMenu(U)}function H(U){r.paneScroll(U)}function D(U){var j,X,Z;if(T.value=(j=t.value)==null?void 0:j.getBoundingClientRect(),!l.value||!n.isSelecting||U.button!==0||U.target!==A.value||!T.value)return;(Z=(X=U.target)==null?void 0:X.setPointerCapture)==null||Z.call(X,U.pointerId);const{x:J,y:q}=u7(U,T.value);P=!0,E=!1,s(),a.value={width:0,height:0,startX:J,startY:q,x:J,y:q},r.selectionStart(U)}function z(U){var j;if(!T.value||!a.value)return;E=!0;const{x:X,y:Z}=Ao(U,T.value),{startX:J=0,startY:q=0}=a.value,st={startX:J,startY:q,x:X<J?X:J,y:Z<q?Z:q,width:Math.abs(X-J),height:Math.abs(Z-q)},Q=x.value,ot=S.value;x.value=new Set(dO(e.value,st,i.value,f.value===Y1.Partial,!0).map(F=>F.id)),S.value=new Set;const nt=((j=w.value)==null?void 0:j.selectable)??!0;for(const F of x.value){const N=C.value.get(F);if(N)for(const{edgeId:W}of N.values()){const V=b.value.get(W);V&&(V.selectable??nt)&&S.value.add(W)}}if(!kA(Q,x.value)){const F=$s(y.value,x.value,!0);r.nodesChange(F)}if(!kA(ot,S.value)){const F=$s(b.value,S.value);r.edgesChange(F)}a.value=st,o.value=!0,h.value=!1}function G(U){var j;U.button!==0||!P||((j=U.target)==null||j.releasePointerCapture(U.pointerId),!o.value&&a.value&&U.target===A.value&&O(U),o.value=!1,a.value=null,h.value=x.value.size>0,r.selectionEnd(U),n.selectionKeyPressed&&(E=!1),P=!1)}return(U,j)=>(Be(),ni("div",{ref_key:"container",ref:A,class:ic(["vue-flow__pane vue-flow__container",{selection:U.isSelecting}]),onClick:j[0]||(j[0]=X=>M.value?void 0:L(O,A.value)(X)),onContextmenu:j[1]||(j[1]=X=>L(I,A.value)(X)),onWheelPassive:j[2]||(j[2]=X=>L(H,A.value)(X)),onPointerenter:j[3]||(j[3]=X=>M.value?void 0:It(r).paneMouseEnter(X)),onPointerdown:j[4]||(j[4]=X=>M.value?D(X):It(r).paneMouseMove(X)),onPointermove:j[5]||(j[5]=X=>M.value?z(X):It(r).paneMouseMove(X)),onPointerup:j[6]||(j[6]=X=>M.value?G(X):void 0),onPointerleave:j[7]||(j[7]=X=>It(r).paneMouseLeave(X))},[Ml(U.$slots,"default"),It(o)&&It(a)?(Be(),$h(s7,{key:0,"user-selection-rect":It(a)},null,8,["user-selection-rect"])):Ho("",!0),It(h)&&It(d).length?(Be(),$h(h7,{key:1})):Ho("",!0)],34))}}),g7={name:"Transform",compatConfig:{MODE:3}},f7=bi({...g7,setup(n){const{viewport:t,fitViewOnInit:e,fitViewOnInitDone:i}=yi(),r=ee(()=>e.value?!i.value:!1),o=ee(()=>`translate(${t.value.x}px,${t.value.y}px) scale(${t.value.zoom})`);return(s,a)=>(Be(),ni("div",{class:"vue-flow__transformationpane vue-flow__container",style:aa({transform:o.value,opacity:r.value?0:void 0})},[Ml(s.$slots,"default")],4))}}),p7={name:"Viewport",compatConfig:{MODE:3}},m7=bi({...p7,setup(n){const{minZoom:t,maxZoom:e,defaultViewport:i,translateExtent:r,zoomActivationKeyCode:o,selectionKeyCode:s,panActivationKeyCode:a,panOnScroll:l,panOnScrollMode:h,panOnScrollSpeed:u,panOnDrag:d,zoomOnDoubleClick:c,zoomOnPinch:g,zoomOnScroll:f,preventScrolling:p,noWheelClassName:m,noPanClassName:v,emits:b,connectionStartHandle:y,userSelectionActive:C,paneDragging:w,d3Zoom:_,d3Selection:A,d3ZoomHandler:x,viewport:S,viewportRef:T,paneClickDistance:M}=yi();r7(T);const R=ip(!1),E=ip(!1);let P=null,B=!1,k=0,L={x:0,y:0,zoom:0};const O=Dd(a),I=Dd(s),H=Dd(o),D=Ti(()=>(!I.value||I.value&&s.value===!0)&&(O.value||d.value)),z=Ti(()=>O.value||l.value),G=Ti(()=>I.value||s.value===!0&&D.value!==!0);wa(()=>{if(!T.value){Jm("Viewport element is missing");return}const q=T.value,st=q.getBoundingClientRect(),Q=OV().clickDistance(M.value).scaleExtent([t.value,e.value]).translateExtent(r.value),ot=Yr(q).call(Q),nt=ot.on("wheel.zoom"),F=gu.translate(i.value.x??0,i.value.y??0).scale(Ll(i.value.zoom??1,t.value,e.value)),N=[[0,0],[st.width,st.height]],W=Q.constrain()(F,N,r.value);Q.transform(ot,W),Q.wheelDelta(j),_.value=Q,A.value=ot,x.value=nt,S.value={x:W.x,y:W.y,zoom:W.k},Q.on("start",V=>{var K;if(!V.sourceEvent)return null;k=V.sourceEvent.button,R.value=!0;const et=Z(V.transform);((K=V.sourceEvent)==null?void 0:K.type)==="mousedown"&&(w.value=!0),L=et,b.viewportChangeStart(et),b.moveStart({event:V,flowTransform:et})}),Q.on("end",V=>{if(!V.sourceEvent)return null;if(R.value=!1,w.value=!1,U(D.value,k??0)&&!B&&b.paneContextMenu(V.sourceEvent),B=!1,X(L,V.transform)){const K=Z(V.transform);L=K,b.viewportChangeEnd(K),b.moveEnd({event:V,flowTransform:K})}}),Q.filter(V=>{var K;const et=H.value||f.value,it=g.value&&V.ctrlKey,rt=V.button;if(rt===1&&V.type==="mousedown"&&(J(V,"vue-flow__node")||J(V,"vue-flow__edge")))return!0;if(!D.value&&!et&&!z.value&&!c.value&&!g.value||C.value||!c.value&&V.type==="dblclick"||J(V,m.value)&&V.type==="wheel"||J(V,v.value)&&(V.type!=="wheel"||z.value&&V.type==="wheel"&&!H.value)||!g.value&&V.ctrlKey&&V.type==="wheel"||!et&&!z.value&&!it&&V.type==="wheel")return!1;if(!g&&V.type==="touchstart"&&((K=V.touches)==null?void 0:K.length)>1)return V.preventDefault(),!1;if(!D.value&&(V.type==="mousedown"||V.type==="touchstart")||s.value===!0&&Array.isArray(d.value)&&d.value.includes(0)&&rt===0||Array.isArray(d.value)&&!d.value.includes(rt)&&(V.type==="mousedown"||V.type==="touchstart"))return!1;const lt=Array.isArray(d.value)&&d.value.includes(rt)||s.value===!0&&Array.isArray(d.value)&&!d.value.includes(0)||!rt||rt<=1;return(!V.ctrlKey||O.value||V.type==="wheel")&&lt}),He([C,D],()=>{C.value&&!R.value?Q.on("zoom",null):C.value||Q.on("zoom",V=>{S.value={x:V.transform.x,y:V.transform.y,zoom:V.transform.k};const K=Z(V.transform);B=U(D.value,k??0),b.viewportChange(K),b.move({event:V,flowTransform:K})})},{immediate:!0}),He([C,z,h,H,g,p,m],()=>{z.value&&!H.value&&!C.value?ot.on("wheel.zoom",V=>{if(J(V,m.value))return!1;const K=H.value||f.value,et=g.value&&V.ctrlKey;if(!(!p.value||z.value||K||et))return!1;V.preventDefault(),V.stopImmediatePropagation();const rt=ot.property("__zoom").k||1,lt=Mp();if(!O.value&&V.ctrlKey&&g.value&&lt){const re=wo(V),Fe=j(V),Qt=rt*2**Fe;Q.scaleTo(ot,Qt,re,V);return}const ct=V.deltaMode===1?20:1;let ut=h.value===Hd.Vertical?0:V.deltaX*ct,gt=h.value===Hd.Horizontal?0:V.deltaY*ct;!lt&&V.shiftKey&&h.value!==Hd.Vertical&&!ut&&gt&&(ut=gt,gt=0),Q.translateBy(ot,-(ut/rt)*u.value,-(gt/rt)*u.value);const Gt=Z(ot.property("__zoom"));P&&clearTimeout(P),E.value?(b.move({event:V,flowTransform:Gt}),b.viewportChange(Gt),P=setTimeout(()=>{b.moveEnd({event:V,flowTransform:Gt}),b.viewportChangeEnd(Gt),E.value=!1},150)):(E.value=!0,b.moveStart({event:V,flowTransform:Gt}),b.viewportChangeStart(Gt))},{passive:!1}):typeof nt<"u"&&ot.on("wheel.zoom",function(V,K){const et=!p.value&&V.type==="wheel"&&!V.ctrlKey,it=H.value||f.value,rt=g.value&&V.ctrlKey;if(!it&&!l.value&&!rt&&V.type==="wheel"||et||J(V,m.value))return null;V.preventDefault(),nt.call(this,V,K)},{passive:!1})},{immediate:!0})});function U(q,st){return st===2&&Array.isArray(q)&&q.includes(2)}function j(q){const st=q.ctrlKey&&Mp()?10:1;return-q.deltaY*(q.deltaMode===1?.05:q.deltaMode?1:.002)*st}function X(q,st){return q.x!==st.x&&!Number.isNaN(st.x)||q.y!==st.y&&!Number.isNaN(st.y)||q.zoom!==st.k&&!Number.isNaN(st.k)}function Z(q){return{x:q.x,y:q.y,zoom:q.k}}function J(q,st){return q.target.closest(`.${st}`)}return(q,st)=>(Be(),ni("div",{ref_key:"viewportRef",ref:T,class:"vue-flow__viewport vue-flow__container"},[ps(c7,{"is-selecting":G.value,"selection-key-pressed":It(I),class:ic({connecting:!!It(y),dragging:It(w),draggable:It(d)===!0||Array.isArray(It(d))&&It(d).includes(0)})},{default:XC(()=>[ps(f7,null,{default:XC(()=>[Ml(q.$slots,"default")]),_:3})]),_:3},8,["is-selecting","selection-key-pressed","class"])],512))}}),v7=["id"],b7=["id"],y7=["id"],C7={name:"A11yDescriptions",compatConfig:{MODE:3}},_7=bi({...C7,setup(n){const{id:t,disableKeyboardA11y:e,ariaLiveMessage:i}=yi();return(r,o)=>(Be(),ni(Io,null,[Tl("div",{id:`${It(iO)}-${It(t)}`,style:{display:"none"}}," Press enter or space to select a node. "+YC(It(e)?"":"You can then use the arrow keys to move the node around.")+" You can then use the arrow keys to move the node around, press delete to remove it and press escape to cancel. ",9,v7),Tl("div",{id:`${It(nO)}-${It(t)}`,style:{display:"none"}}," Press enter or space to select an edge. You can then press delete to remove it or press escape to cancel. ",8,b7),It(e)?Ho("",!0):(Be(),ni("div",{key:0,id:`${It(NV)}-${It(t)}`,"aria-live":"assertive","aria-atomic":"true",style:{position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0",padding:"0",overflow:"hidden",clip:"rect(0px, 0px, 0px, 0px)","clip-path":"inset(100%)"}},YC(It(i)),9,y7))],64))}});function w7(){const n=yi();He(()=>n.viewportHelper.value.viewportInitialized,t=>{t&&setTimeout(()=>{n.emits.init(n),n.emits.paneReady(n)},1)})}function x7(n,t,e){return e===Rt.Left?n-t:e===Rt.Right?n+t:n}function S7(n,t,e){return e===Rt.Top?n-t:e===Rt.Bottom?n+t:n}const Z1=function({radius:n=10,centerX:t=0,centerY:e=0,position:i=Rt.Top,type:r}){return De("circle",{class:`vue-flow__edgeupdater vue-flow__edgeupdater-${r}`,cx:x7(t,n,i),cy:S7(e,n,i),r:n,stroke:"transparent",fill:"transparent"})};Z1.props=["radius","centerX","centerY","position","type"];Z1.compatConfig={MODE:3};const HA=Z1,A7=bi({name:"Edge",compatConfig:{MODE:3},props:["id"],setup(n){const{id:t,addSelectedEdges:e,connectionMode:i,edgeUpdaterRadius:r,emits:o,nodesSelectionActive:s,noPanClassName:a,getEdgeTypes:l,removeSelectedEdges:h,findEdge:u,findNode:d,isValidConnection:c,multiSelectionActive:g,disableKeyboardA11y:f,elementsSelectable:p,edgesUpdatable:m,edgesFocusable:v,hooks:b}=yi(),y=ee(()=>u(n.id)),{emit:C,on:w}=m9(y.value,o),_=Bu(Qm),A=qc(),x=fi(!1),S=fi(!1),T=fi(""),M=fi(null),R=fi("source"),E=fi(null),P=Ti(()=>typeof y.value.selectable>"u"?p.value:y.value.selectable),B=Ti(()=>typeof y.value.updatable>"u"?m.value:y.value.updatable),k=Ti(()=>typeof y.value.focusable>"u"?v.value:y.value.focusable);Uh(g9,n.id),Uh(f9,E);const L=ee(()=>y.value.class instanceof Function?y.value.class(y.value):y.value.class),O=ee(()=>y.value.style instanceof Function?y.value.style(y.value):y.value.style),I=ee(()=>{const N=y.value.type||"default",W=_?.[`edge-${N}`];if(W)return W;let V=y.value.template??l.value[N];if(typeof V=="string"&&A){const K=Object.keys(A.appContext.components);K&&K.includes(N)&&(V=VP(N,!1))}return V&&typeof V!="string"?V:(o.error(new Gi(zi.EDGE_TYPE_MISSING,V)),!1)}),{handlePointerDown:H}=_O({nodeId:T,handleId:M,type:R,isValidConnection:c,edgeUpdaterType:R,onEdgeUpdate:G,onEdgeUpdateEnd:U});return()=>{const N=d(y.value.source),W=d(y.value.target),V="pathOptions"in y.value?y.value.pathOptions:{};if(!N&&!W)return o.error(new Gi(zi.EDGE_SOURCE_TARGET_MISSING,y.value.id,y.value.source,y.value.target)),null;if(!N)return o.error(new Gi(zi.EDGE_SOURCE_MISSING,y.value.id,y.value.source)),null;if(!W)return o.error(new Gi(zi.EDGE_TARGET_MISSING,y.value.id,y.value.target)),null;if(!y.value||y.value.hidden||N.hidden||W.hidden)return null;let K;i.value===fa.Strict?K=N.handleBounds.source:K=[...N.handleBounds.source||[],...N.handleBounds.target||[]];const et=SA(K,y.value.sourceHandle);let it;i.value===fa.Strict?it=W.handleBounds.target:it=[...W.handleBounds.target||[],...W.handleBounds.source||[]];const rt=SA(it,y.value.targetHandle),lt=et?.position||Rt.Bottom,ct=rt?.position||Rt.Top,{x:ut,y:gt}=fu(N,et,lt),{x:Gt,y:re}=fu(W,rt,ct);return y.value.sourceX=ut,y.value.sourceY=gt,y.value.targetX=Gt,y.value.targetY=re,De("g",{ref:E,key:n.id,"data-id":n.id,class:["vue-flow__edge",`vue-flow__edge-${I.value===!1?"default":y.value.type||"default"}`,a.value,L.value,{updating:x.value,selected:y.value.selected,animated:y.value.animated,inactive:!P.value&&!b.value.edgeClick.hasListeners()}],tabIndex:k.value?0:void 0,"aria-label":y.value.ariaLabel===null?void 0:y.value.ariaLabel??`Edge from ${y.value.source} to ${y.value.target}`,"aria-describedby":k.value?`${nO}-${t}`:void 0,"aria-roledescription":"edge",role:k.value?"group":"img",...y.value.domAttributes,onClick:X,onContextmenu:Z,onDblclick:J,onMouseenter:q,onMousemove:st,onMouseleave:Q,onKeyDown:k.value?F:void 0},[S.value?null:De(I.value===!1?l.value.default:I.value,{id:n.id,sourceNode:N,targetNode:W,source:y.value.source,target:y.value.target,type:y.value.type,updatable:B.value,selected:y.value.selected,animated:y.value.animated,label:y.value.label,labelStyle:y.value.labelStyle,labelShowBg:y.value.labelShowBg,labelBgStyle:y.value.labelBgStyle,labelBgPadding:y.value.labelBgPadding,labelBgBorderRadius:y.value.labelBgBorderRadius,data:y.value.data,events:{...y.value.events,...w},style:O.value,markerStart:`url('#${bc(y.value.markerStart,t)}')`,markerEnd:`url('#${bc(y.value.markerEnd,t)}')`,sourcePosition:lt,targetPosition:ct,sourceX:ut,sourceY:gt,targetX:Gt,targetY:re,sourceHandleId:y.value.sourceHandle,targetHandleId:y.value.targetHandle,interactionWidth:y.value.interactionWidth,...V}),[B.value==="source"||B.value===!0?[De("g",{onMousedown:ot,onMouseenter:D,onMouseout:z},De(HA,{position:lt,centerX:ut,centerY:gt,radius:r.value,type:"source","data-type":"source"}))]:null,B.value==="target"||B.value===!0?[De("g",{onMousedown:nt,onMouseenter:D,onMouseout:z},De(HA,{position:ct,centerX:Gt,centerY:re,radius:r.value,type:"target","data-type":"target"}))]:null]])};function D(){x.value=!0}function z(){x.value=!1}function G(N,W){C.update({event:N,edge:y.value,connection:W})}function U(N){C.updateEnd({event:N,edge:y.value}),S.value=!1}function j(N,W){N.button===0&&(S.value=!0,T.value=W?y.value.target:y.value.source,M.value=(W?y.value.targetHandle:y.value.sourceHandle)??null,R.value=W?"target":"source",C.updateStart({event:N,edge:y.value}),H(N))}function X(N){var W;const V={event:N,edge:y.value};P.value&&(s.value=!1,y.value.selected&&g.value?(h([y.value]),(W=E.value)==null||W.blur()):e([y.value])),C.click(V)}function Z(N){C.contextMenu({event:N,edge:y.value})}function J(N){C.doubleClick({event:N,edge:y.value})}function q(N){C.mouseEnter({event:N,edge:y.value})}function st(N){C.mouseMove({event:N,edge:y.value})}function Q(N){C.mouseLeave({event:N,edge:y.value})}function ot(N){j(N,!0)}function nt(N){j(N,!1)}function F(N){var W;!f.value&&rO.includes(N.key)&&P.value&&(N.key==="Escape"?((W=E.value)==null||W.blur(),h([u(n.id)])):e([u(n.id)]))}}}),M7=A7,T7=bi({name:"ConnectionLine",compatConfig:{MODE:3},setup(){var n;const{id:t,connectionMode:e,connectionStartHandle:i,connectionEndHandle:r,connectionPosition:o,connectionLineType:s,connectionLineStyle:a,connectionLineOptions:l,connectionStatus:h,viewport:u,findNode:d}=yi(),c=(n=Bu(Qm))==null?void 0:n["connection-line"],g=ee(()=>{var b;return d((b=i.value)==null?void 0:b.nodeId)}),f=ee(()=>{var b;return d((b=r.value)==null?void 0:b.nodeId)??null}),p=ee(()=>({x:(o.value.x-u.value.x)/u.value.zoom,y:(o.value.y-u.value.y)/u.value.zoom})),m=ee(()=>l.value.markerStart?`url(#${bc(l.value.markerStart,t)})`:""),v=ee(()=>l.value.markerEnd?`url(#${bc(l.value.markerEnd,t)})`:"");return()=>{var b,y,C;if(!g.value||!i.value)return null;const w=i.value.id,_=i.value.type,A=g.value.handleBounds;let x=A?.[_]??[];if(e.value===fa.Loose){const O=A?.[_==="source"?"target":"source"]??[];x=[...x,...O]}if(!x)return null;const S=(w?x.find(O=>O.id===w):x[0])??null,T=S?.position??Rt.Top,{x:M,y:R}=fu(g.value,S,T);let E=null;f.value&&(e.value===fa.Strict?E=((b=f.value.handleBounds[_==="source"?"target":"source"])==null?void 0:b.find(O=>{var I;return O.id===((I=r.value)==null?void 0:I.id)}))||null:E=((y=[...f.value.handleBounds.source??[],...f.value.handleBounds.target??[]])==null?void 0:y.find(O=>{var I;return O.id===((I=r.value)==null?void 0:I.id)}))||null);const P=((C=r.value)==null?void 0:C.position)??(T?C_[T]:null);if(!T||!P)return null;const B=s.value??l.value.type??Ka.Bezier;let k="";const L={sourceX:M,sourceY:R,sourcePosition:T,targetX:p.value.x,targetY:p.value.y,targetPosition:P};return B===Ka.Bezier?[k]=TO(L):B===Ka.Step?[k]=w_({...L,borderRadius:0}):B===Ka.SmoothStep?[k]=w_(L):B===Ka.SimpleBezier?[k]=RO(L):k=`M${M},${R} ${p.value.x},${p.value.y}`,De("svg",{class:"vue-flow__edges vue-flow__connectionline vue-flow__container"},De("g",{class:"vue-flow__connection"},c?De(c,{sourceX:M,sourceY:R,sourcePosition:T,targetX:p.value.x,targetY:p.value.y,targetPosition:P,sourceNode:g.value,sourceHandle:S,targetNode:f.value,targetHandle:E,markerEnd:v.value,markerStart:m.value,connectionStatus:h.value}):De("path",{d:k,class:[l.value.class,h,"vue-flow__connection-path"],style:{...a.value,...l.value.style},"marker-end":v.value,"marker-start":m.value})))}}}),R7=T7,B7=["id","markerWidth","markerHeight","markerUnits","orient"],k7={name:"MarkerType",compatConfig:{MODE:3}},P7=bi({...k7,props:{id:{},type:{},color:{default:"none"},width:{default:12.5},height:{default:12.5},markerUnits:{default:"strokeWidth"},orient:{default:"auto-start-reverse"},strokeWidth:{default:1}},setup(n){return(t,e)=>(Be(),ni("marker",{id:t.id,class:"vue-flow__arrowhead",viewBox:"-10 -10 20 20",refX:"0",refY:"0",markerWidth:`${t.width}`,markerHeight:`${t.height}`,markerUnits:t.markerUnits,orient:t.orient},[t.type===It(v_).ArrowClosed?(Be(),ni("polyline",{key:0,style:aa({stroke:t.color,fill:t.color,strokeWidth:t.strokeWidth}),"stroke-linecap":"round","stroke-linejoin":"round",points:"-5,-4 0,0 -5,4 -5,-4"},null,4)):Ho("",!0),t.type===It(v_).Arrow?(Be(),ni("polyline",{key:1,style:aa({stroke:t.color,strokeWidth:t.strokeWidth}),"stroke-linecap":"round","stroke-linejoin":"round",fill:"none",points:"-5,-4 0,0 -5,4"},null,4)):Ho("",!0)],8,B7))}}),E7={class:"vue-flow__marker vue-flow__container","aria-hidden":"true"},L7={name:"MarkerDefinitions",compatConfig:{MODE:3}},O7=bi({...L7,setup(n){const{id:t,edges:e,connectionLineOptions:i,defaultMarkerColor:r}=yi(),o=ee(()=>{const s=new Set,a=[],l=h=>{if(h){const u=bc(h,t);s.has(u)||(typeof h=="object"?a.push({...h,id:u,color:h.color||r.value}):a.push({id:u,color:r.value,type:h}),s.add(u))}};for(const h of[i.value.markerEnd,i.value.markerStart])l(h);for(const h of e.value)for(const u of[h.markerStart,h.markerEnd])l(u);return a.sort((h,u)=>h.id.localeCompare(u.id))});return(s,a)=>(Be(),ni("svg",E7,[Tl("defs",null,[(Be(!0),ni(Io,null,b1(o.value,l=>(Be(),$h(P7,{id:l.id,key:l.id,type:l.type,color:l.color,width:l.width,height:l.height,markerUnits:l.markerUnits,"stroke-width":l.strokeWidth,orient:l.orient},null,8,["id","type","color","width","height","markerUnits","stroke-width","orient"]))),128))])]))}}),I7={name:"Edges",compatConfig:{MODE:3}},H7=bi({...I7,setup(n){const{findNode:t,getEdges:e,elevateEdgesOnSelect:i}=yi();return(r,o)=>(Be(),ni(Io,null,[ps(O7),(Be(!0),ni(Io,null,b1(It(e),s=>(Be(),ni("svg",{key:s.id,class:"vue-flow__edges vue-flow__container",style:aa({zIndex:It(t9)(s,It(t),It(i))})},[ps(It(M7),{id:s.id},null,8,["id"])],4))),128)),ps(It(R7))],64))}}),D7=bi({name:"Node",compatConfig:{MODE:3},props:["id","resizeObserver"],setup(n){const{id:t,noPanClassName:e,selectNodesOnDrag:i,nodesSelectionActive:r,multiSelectionActive:o,emits:s,removeSelectedNodes:a,addSelectedNodes:l,updateNodeDimensions:h,onUpdateNodeInternals:u,getNodeTypes:d,nodeExtent:c,elevateNodesOnSelect:g,disableKeyboardA11y:f,ariaLiveMessage:p,snapToGrid:m,snapGrid:v,nodeDragThreshold:b,nodesDraggable:y,elementsSelectable:C,nodesConnectable:w,nodesFocusable:_,hooks:A}=yi(),x=fi(null);Uh(yO,x),Uh(bO,n.id);const S=Bu(Qm),T=qc(),M=xO(),{node:R,parentNode:E}=wO(n.id),{emit:P,on:B}=C9(R,s),k=Ti(()=>typeof R.draggable>"u"?y.value:R.draggable),L=Ti(()=>typeof R.selectable>"u"?C.value:R.selectable),O=Ti(()=>typeof R.connectable>"u"?w.value:R.connectable),I=Ti(()=>typeof R.focusable>"u"?_.value:R.focusable),H=ee(()=>L.value||k.value||A.value.nodeClick.hasListeners()||A.value.nodeDoubleClick.hasListeners()||A.value.nodeMouseEnter.hasListeners()||A.value.nodeMouseMove.hasListeners()||A.value.nodeMouseLeave.hasListeners()),D=Ti(()=>!!R.dimensions.width&&!!R.dimensions.height),z=ee(()=>{const W=R.type||"default",V=S?.[`node-${W}`];if(V)return V;let K=R.template||d.value[W];if(typeof K=="string"&&T){const et=Object.keys(T.appContext.components);et&&et.includes(W)&&(K=VP(W,!1))}return K&&typeof K!="string"?K:(s.error(new Gi(zi.NODE_TYPE_MISSING,K)),!1)}),G=CO({id:n.id,el:x,disabled:()=>!k.value,selectable:L,dragHandle:()=>R.dragHandle,onStart(W){P.dragStart(W)},onDrag(W){P.drag(W)},onStop(W){P.dragStop(W)},onClick(W){F(W)}}),U=ee(()=>R.class instanceof Function?R.class(R):R.class),j=ee(()=>{const W=(R.style instanceof Function?R.style(R):R.style)||{},V=R.width instanceof Function?R.width(R):R.width,K=R.height instanceof Function?R.height(R):R.height;return!W.width&&V&&(W.width=typeof V=="string"?V:`${V}px`),!W.height&&K&&(W.height=typeof K=="string"?K:`${K}px`),W}),X=Ti(()=>Number(R.zIndex??j.value.zIndex??0));return u(W=>{(W.includes(n.id)||!W.length)&&J()}),wa(()=>{He(()=>R.hidden,(W=!1,V,K)=>{!W&&x.value&&(n.resizeObserver.observe(x.value),K(()=>{x.value&&n.resizeObserver.unobserve(x.value)}))},{immediate:!0,flush:"post"})}),He([()=>R.type,()=>R.sourcePosition,()=>R.targetPosition],()=>{ys(()=>{h([{id:n.id,nodeElement:x.value,forceUpdate:!0}])})}),He([()=>R.position.x,()=>R.position.y,()=>{var W;return(W=E.value)==null?void 0:W.computedPosition.x},()=>{var W;return(W=E.value)==null?void 0:W.computedPosition.y},()=>{var W;return(W=E.value)==null?void 0:W.computedPosition.z},X,()=>R.selected,()=>R.dimensions.height,()=>R.dimensions.width,()=>{var W;return(W=E.value)==null?void 0:W.dimensions.height},()=>{var W;return(W=E.value)==null?void 0:W.dimensions.width}],([W,V,K,et,it,rt])=>{const lt={x:W,y:V,z:rt+(g.value&&R.selected?1e3:0)};typeof K<"u"&&typeof et<"u"?R.computedPosition=YV({x:K,y:et,z:it},lt):R.computedPosition=lt},{flush:"post",immediate:!0}),He([()=>R.extent,c],([W,V],[K,et])=>{(W!==K||V!==et)&&Z()}),R.extent==="parent"||typeof R.extent=="object"&&"range"in R.extent&&R.extent.range==="parent"?l_(()=>D).toBe(!0).then(Z):Z(),()=>R.hidden?null:De("div",{ref:x,"data-id":R.id,class:["vue-flow__node",`vue-flow__node-${z.value===!1?"default":R.type||"default"}`,{[e.value]:k.value,dragging:G?.value,draggable:k.value,selected:R.selected,selectable:L.value,parent:R.isParent},U.value],style:{visibility:D.value?"visible":"hidden",zIndex:R.computedPosition.z??X.value,transform:`translate(${R.computedPosition.x}px,${R.computedPosition.y}px)`,pointerEvents:H.value?"all":"none",...j.value},tabIndex:I.value?0:void 0,role:I.value?"group":void 0,"aria-describedby":f.value?void 0:`${iO}-${t}`,"aria-label":R.ariaLabel,"aria-roledescription":"node",...R.domAttributes,onMouseenter:q,onMousemove:st,onMouseleave:Q,onContextmenu:ot,onClick:F,onDblclick:nt,onKeydown:N},[De(z.value===!1?d.value.default:z.value,{id:R.id,type:R.type,data:R.data,events:{...R.events,...B},selected:R.selected,resizing:R.resizing,dragging:G.value,connectable:O.value,position:R.computedPosition,dimensions:R.dimensions,isValidTargetPos:R.isValidTargetPos,isValidSourcePos:R.isValidSourcePos,parent:R.parentNode,parentNodeId:R.parentNode,zIndex:R.computedPosition.z??X.value,targetPosition:R.targetPosition,sourcePosition:R.sourcePosition,label:R.label,dragHandle:R.dragHandle,onUpdateNodeInternals:J})]);function Z(){const W=R.computedPosition,{computedPosition:V,position:K}=q1(R,m.value?Zm(W,v.value):W,s.error,c.value,E.value);(R.computedPosition.x!==V.x||R.computedPosition.y!==V.y)&&(R.computedPosition={...R.computedPosition,...V}),(R.position.x!==K.x||R.position.y!==K.y)&&(R.position=K)}function J(){x.value&&h([{id:n.id,nodeElement:x.value,forceUpdate:!0}])}function q(W){G?.value||P.mouseEnter({event:W,node:R})}function st(W){G?.value||P.mouseMove({event:W,node:R})}function Q(W){G?.value||P.mouseLeave({event:W,node:R})}function ot(W){return P.contextMenu({event:W,node:R})}function nt(W){return P.doubleClick({event:W,node:R})}function F(W){L.value&&(!i.value||!k.value||b.value>0)&&__(R,o.value,l,a,r,!1,x.value),P.click({event:W,node:R})}function N(W){if(!(b_(W)||f.value))if(rO.includes(W.key)&&L.value){const V=W.key==="Escape";__(R,o.value,l,a,r,V,x.value)}else k.value&&R.selected&&Mh[W.key]&&(W.preventDefault(),p.value=`Moved selected node ${W.key.replace("Arrow","").toLowerCase()}. New position, x: ${~~R.position.x}, y: ${~~R.position.y}`,M({x:Mh[W.key].x,y:Mh[W.key].y},W.shiftKey))}}}),F7=D7;function z7(n={includeHiddenNodes:!1}){const{nodes:t}=yi();return ee(()=>{if(t.value.length===0)return!1;for(const e of t.value)if((n.includeHiddenNodes||!e.hidden)&&(e?.handleBounds===void 0||e.dimensions.width===0||e.dimensions.height===0))return!1;return!0})}const N7={class:"vue-flow__nodes vue-flow__container"},W7={name:"Nodes",compatConfig:{MODE:3}},j7=bi({...W7,setup(n){const{getNodes:t,updateNodeDimensions:e,emits:i}=yi(),r=z7(),o=fi();return He(r,s=>{s&&ys(()=>{i.nodesInitialized(t.value)})},{immediate:!0}),wa(()=>{o.value=new ResizeObserver(s=>{const a=s.map(l=>({id:l.target.getAttribute("data-id"),nodeElement:l.target,forceUpdate:!0}));ys(()=>e(a))})}),jP(()=>{var s;return(s=o.value)==null?void 0:s.disconnect()}),(s,a)=>(Be(),ni("div",N7,[o.value?(Be(!0),ni(Io,{key:0},b1(It(t),(l,h,u,d)=>{const c=[l.id];if(d&&d.key===l.id&&Az(d,c))return d;const g=(Be(),$h(It(F7),{id:l.id,key:l.id,"resize-observer":o.value},null,8,["id","resize-observer"]));return g.memo=c,g},a,0),128)):Ho("",!0)]))}});function V7(){const{emits:n}=yi();wa(()=>{if(vO()){const t=document.querySelector(".vue-flow__pane");t&&window.getComputedStyle(t).zIndex!=="1"&&n.error(new Gi(zi.MISSING_STYLES))}})}const G7=Tl("div",{class:"vue-flow__edge-labels"},null,-1),$7={name:"VueFlow",compatConfig:{MODE:3}},mpt=bi({...$7,props:{id:{},modelValue:{},nodes:{},edges:{},edgeTypes:{},nodeTypes:{},connectionMode:{},connectionLineType:{},connectionLineStyle:{default:void 0},connectionLineOptions:{default:void 0},connectionRadius:{},isValidConnection:{type:[Function,null],default:void 0},deleteKeyCode:{default:void 0},selectionKeyCode:{type:[Boolean,null],default:void 0},multiSelectionKeyCode:{default:void 0},zoomActivationKeyCode:{default:void 0},panActivationKeyCode:{default:void 0},snapToGrid:{type:Boolean,default:void 0},snapGrid:{},onlyRenderVisibleElements:{type:Boolean,default:void 0},edgesUpdatable:{type:[Boolean,String],default:void 0},nodesDraggable:{type:Boolean,default:void 0},nodesConnectable:{type:Boolean,default:void 0},nodeDragThreshold:{},elementsSelectable:{type:Boolean,default:void 0},selectNodesOnDrag:{type:Boolean,default:void 0},panOnDrag:{type:[Boolean,Array],default:void 0},minZoom:{},maxZoom:{},defaultViewport:{},translateExtent:{},nodeExtent:{},defaultMarkerColor:{},zoomOnScroll:{type:Boolean,default:void 0},zoomOnPinch:{type:Boolean,default:void 0},panOnScroll:{type:Boolean,default:void 0},panOnScrollSpeed:{},panOnScrollMode:{},paneClickDistance:{},zoomOnDoubleClick:{type:Boolean,default:void 0},preventScrolling:{type:Boolean,default:void 0},selectionMode:{},edgeUpdaterRadius:{},fitViewOnInit:{type:Boolean,default:void 0},connectOnClick:{type:Boolean,default:void 0},applyDefault:{type:Boolean,default:void 0},autoConnect:{type:[Boolean,Function],default:void 0},noDragClassName:{},noWheelClassName:{},noPanClassName:{},defaultEdgeOptions:{},elevateEdgesOnSelect:{type:Boolean,default:void 0},elevateNodesOnSelect:{type:Boolean,default:void 0},disableKeyboardA11y:{type:Boolean,default:void 0},edgesFocusable:{type:Boolean,default:void 0},nodesFocusable:{type:Boolean,default:void 0},autoPanOnConnect:{type:Boolean,default:void 0},autoPanOnNodeDrag:{type:Boolean,default:void 0},autoPanSpeed:{}},emits:["nodesChange","edgesChange","nodesInitialized","paneReady","init","updateNodeInternals","error","connect","connectStart","connectEnd","clickConnectStart","clickConnectEnd","moveStart","move","moveEnd","selectionDragStart","selectionDrag","selectionDragStop","selectionContextMenu","selectionStart","selectionEnd","viewportChangeStart","viewportChange","viewportChangeEnd","paneScroll","paneClick","paneContextMenu","paneMouseEnter","paneMouseMove","paneMouseLeave","edgeUpdate","edgeContextMenu","edgeMouseEnter","edgeMouseMove","edgeMouseLeave","edgeDoubleClick","edgeClick","edgeUpdateStart","edgeUpdateEnd","nodeContextMenu","nodeMouseEnter","nodeMouseMove","nodeMouseLeave","nodeDoubleClick","nodeClick","nodeDragStart","nodeDrag","nodeDragStop","miniMapNodeClick","miniMapNodeDoubleClick","miniMapNodeMouseEnter","miniMapNodeMouseMove","miniMapNodeMouseLeave","update:modelValue","update:nodes","update:edges"],setup(n,{expose:t,emit:e}){const i=n,r=wz(),o=Bb(i,"modelValue",e),s=Bb(i,"nodes",e),a=Bb(i,"edges",e),l=yi(i),h=S9({modelValue:o,nodes:s,edges:a},i,l);return M9(e,l.hooks),w7(),V7(),Uh(Qm,r),xz(()=>{h()}),t(l),(u,d)=>(Be(),ni("div",{ref:It(l).vueFlowRef,class:"vue-flow"},[ps(m7,null,{default:XC(()=>[ps(H7),G7,ps(j7),Ml(u.$slots,"zoom-pane")]),_:3}),Ml(u.$slots,"default"),ps(_7)],512))}});var Ce;(function(n){n.default="default",n.grabing="grabing",n.scrolling="scrolling"})(Ce||(Ce={}));var Fn;(function(n){n.FinishToStart="finish_to_start",n.StartToStart="start_to_start",n.FinishToFinish="finish_to_finish",n.StartToFinish="start_to_finish"})(Fn||(Fn={}));var ft;(function(n){n.Tasks_Separate="tasks_separate",n.Sub_Tasks_Inline="sub_tasks_inline",n.Sub_Tasks_Separate="sub_tasks_separate",n.Sub_Tasks_Arrange="sub_tasks_arrange",n.Sub_Tasks_Compact="sub_tasks_compact",n.Project_Sub_Tasks_Inline="project_sub_tasks_inline"})(ft||(ft={}));var se;(function(n){n.TASK="task",n.PROJECT="project",n.MILESTONE="milestone"})(se||(se={}));const qt={SCROLL:"scroll",CHANGE_DATE_RANGE:"change_date_range",CLICK_TASK_BAR:"click_task_bar",CONTEXTMENU_TASK_BAR:"contextmenu_task_bar",MOUSEENTER_TASK_BAR:"mouseenter_task_bar",MOUSELEAVE_TASK_BAR:"mouseleave_task_bar",CREATE_TASK_SCHEDULE:"create_task_schedule",CREATE_DEPENDENCY_LINK:"create_dependency_link",DELETE_DEPENDENCY_LINK:"delete_dependency_link",CLICK_DEPENDENCY_LINK_POINT:"click_dependency_link_point",CONTEXTMENU_DEPENDENCY_LINK:"contextmenu_dependency_link",CLICK_MARKLINE_CREATE:"click_markline_create",CLICK_MARKLINE_CONTENT:"click_markline_content",MOVE_END_TASK_BAR:"move_end_task_bar",PROGRESS_UPDATE:"progress_update"};class Ci{static GenAutoIncrementId(){return Ci.auto_increment_id++}}Ci.auto_increment_id=0;class Ot{constructor(t){this.id=Ci.GenAutoIncrementId(),this.registry=t}}const rv="named",kO="inject",PO="multi_inject",EO="inversify:tagged",LO="inversify:paramtypes";class J1{constructor(t,e){this.key=t,this.value=e}toString(){return this.key===rv?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}}const Th=(function(n){var t;return(function(e){const i=typeof Symbol=="function",r=i&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",o=Object.getPrototypeOf(Function),s=Map,a=new WeakMap;function l(B,k,L,O){if(!_(L))throw new TypeError;return v(B,k,L,O)}function h(B,k,L){if(!_(k))throw new TypeError;return y(L)||(L=M(L)),g(B,k,L)}function u(B,k,L){if(!_(k))throw new TypeError;return y(L)||(L=M(L)),f(B,k,L)}function d(B,k,L){if(!_(k))throw new TypeError;return y(L)||(L=M(L)),p(B,k,L)}function c(B,k,L){let O=a.get(B);if(y(O)){if(!L)return;O=new s,a.set(B,O)}let I=O.get(k);if(y(I)){if(!L)return;I=new s,O.set(k,I)}return I}function g(B,k,L){if(f(B,k,L))return!0;const O=P(k);return!C(O)&&g(B,O,L)}function f(B,k,L){const O=c(k,L,!1);return!y(O)&&S(O.has(B))}function p(B,k,L){if(f(B,k,L))return m(B,k,L);const O=P(k);return C(O)?void 0:p(B,O,L)}function m(B,k,L){const O=c(k,L,!1);if(!y(O))return O.get(B)}function v(B,k,L,O){c(L,O,!0).set(B,k)}function b(B){if(B===null)return 1;switch(typeof B){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return B===null?1:6;default:return 6}}function y(B){return B===void 0}function C(B){return B===null}function w(B){return typeof B=="symbol"}function _(B){return typeof B=="object"?B!==null:typeof B=="function"}function A(B,k){switch(b(B)){case 0:case 1:case 2:case 3:case 4:case 5:return B}const L="string",O=E(B,r);if(O!==void 0){const I=O.call(B,L);if(_(I))throw new TypeError;return I}return x(B)}function x(B,k){{const L=B.toString;if(R(L)){const I=L.call(B);if(!_(I))return I}const O=B.valueOf;if(R(O)){const I=O.call(B);if(!_(I))return I}}throw new TypeError}function S(B){return!!B}function T(B){return""+B}function M(B){const k=A(B);return w(k)?k:T(k)}function R(B){return typeof B=="function"}function E(B,k){const L=B[k];if(L!=null){if(!R(L))throw new TypeError;return L}}function P(B){const k=Object.getPrototypeOf(B);if(typeof B!="function"||B===o||k!==o)return k;const L=B.prototype,O=L&&Object.getPrototypeOf(L);if(O==null||O===Object.prototype)return k;const I=O.constructor;return typeof I!="function"||I===B?k:I}e("defineMetadata",l),e("hasMetadata",h),e("hasOwnMetadata",u),e("getMetadata",d)})((t=n,function(e,i){typeof t[e]!="function"&&Object.defineProperty(t,e,{configurable:!0,writable:!0,value:i})})),n})({});function U7(n,t,e,i){const r=[i];let o={};Th.hasOwnMetadata(n,t)&&(o=Th.getMetadata(n,t));let s=o[e];s===void 0&&(s=[]),s.push(...r),o[e]=s,Th.defineMetadata(n,o,t)}function X7(n,t,e,i){U7(EO,n,e.toString(),i)}function OO(n){return(t,e,i)=>{X7(t,e,i,n)}}function IO(n){return t=>(e,i,r)=>OO(new J1(n,t))(e,i,r)}const Xt=IO(kO),HO=IO(PO);function pt(){return function(n){return Th.defineMetadata(LO,null,n),n}}function Li(n){return OO(new J1(rv,n))}const Ol={Singleton:"Singleton",Transient:"Transient"},ta={ConstantValue:"ConstantValue",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid"};class Q1{constructor(t,e){this.id=Ci.GenAutoIncrementId(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=ta.Invalid,this.constraint=i=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.dynamicValue=null}clone(){const t=new Q1(this.serviceIdentifier,this.scope);return t.activated=t.scope===Ol.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.provider=this.provider,t.constraint=this.constraint,t.cache=this.cache,t}}class Y7{getConstructorMetadata(t){return{compilerGeneratedMetadata:Th.getMetadata(LO,t),userGeneratedMetadata:Th.getMetadata(EO,t)||{}}}getPropertiesMetadata(t){throw new Error("暂未实现")}}const q7=n=>t=>{const e=i=>{if(i==null)return!1;if(i.key===n&&i.value===t)return!0;if(i.constructorArgsMetadata==null)return!1;const r=i.constructorArgsMetadata;for(let o=0;o<r.length;o++)if(r[o].key===n&&r[o].value===t)return!0;return!1};return e.metaData=new J1(n,t),e},K7=q7(rv);class Ng{constructor(t){this._binding=t}inRequestScope(){throw new Error("暂未实现")}inSingletonScope(){return this._binding.scope=Ol.Singleton,this}inTransientScope(){return this._binding.scope=Ol.Transient,this}whenTargetNamed(t){return this._binding.constraint=K7(t),this}}class Z7{constructor(t){this._binding=t}to(t){return this._binding.type=ta.Instance,this._binding.implementationType=t,new Ng(this._binding)}toSelf(){const t=this._binding.serviceIdentifier;return this.to(t)}toDynamicValue(t){return this._binding.type=ta.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new Ng(this._binding)}toConstantValue(t){return this._binding.type=ta.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Ol.Singleton,new Ng(this._binding)}toFactory(t){return this._binding.type=ta.Factory,this._binding.factory=t,this._binding.scope=Ol.Singleton,new Ng(this._binding)}toService(t){this.toDynamicValue((e=>e.container.get(t)))}}let J7=class{constructor(t){const e=t||{};e.defaultScope=e.defaultScope||Ol.Transient,this.options=e,this.id=Ci.GenAutoIncrementId(),this._bindingDictionary=new Map,this._metadataReader=new Y7}load(t){const e=this._getContainerModuleHelpersFactory()(t.id);t.registry(e.bindFunction,e.unbindFunction,e.isboundFunction,e.rebindFunction)}get(t){const e=this._getNotAllArgs(t,!1);return this._get(e)}getAll(t){const e=this._getAllArgs(t);return this._get(e)}getTagged(t,e,i){const r=this._getNotAllArgs(t,!1,e,i);return this._get(r)}getNamed(t,e){return this.getTagged(t,rv,e)}isBound(t){return this._bindingDictionary.has(t)}bind(t){const e=this.options.defaultScope,i=new Q1(t,e),r=this._bindingDictionary.get(t)||[];return r.push(i),this._bindingDictionary.set(t,r),new Z7(i)}unbind(t){this._bindingDictionary.delete(t)}rebind(t){return this.unbind(t),this.bind(t)}_getContainerModuleHelpersFactory(){const t=(s,a)=>{s._binding.moduleId=a},e=s=>a=>{const l=this.bind(a);return t(l,s),l},i=()=>s=>this.unbind(s),r=()=>s=>this.isBound(s),o=s=>a=>{const l=this.rebind(a);return t(l,s),l};return s=>({bindFunction:e(s),isboundFunction:r(),rebindFunction:o(s),unbindFunction:i(),unbindAsyncFunction:a=>null})}_getNotAllArgs(t,e,i,r){return{avoidConstraints:!1,isMultiInject:e,serviceIdentifier:t,key:i,value:r}}_getAllArgs(t){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:t}}_get(t){const e=[];return this._bindingDictionary.get(t.serviceIdentifier).filter((i=>i.constraint(t))).forEach((i=>{e.push(this._resolveFromBinding(i))})),t.isMultiInject||e.length!==1?e:e[0]}_getChildRequest(t){const e=t.implementationType,{userGeneratedMetadata:i}=this._metadataReader.getConstructorMetadata(e),r=Object.keys(i),o=[];for(let s=0;s<r.length;s++){const a=i[s],l={};a.forEach((g=>{l[g.key]=g.value}));const h={inject:l[kO],multiInject:l[PO]},u=h.inject||h.multiInject,d={serviceIdentifier:u,constructorArgsMetadata:a},c=(this._bindingDictionary.get(u)||[]).filter((g=>g.constraint(d)));if(c.length){const g={injectIdentifier:u,metadata:a,bindings:c};o.push(g)}}return o}_resolveFromBinding(t){const e=this._getResolvedFromBinding(t);return this._saveToScope(t,e),e}_getResolvedFromBinding(t){let e;switch(t.type){case ta.ConstantValue:case ta.Function:e=t.cache;break;case ta.Instance:e=this._resolveInstance(t,t.implementationType);break;default:e=t.dynamicValue({container:this})}return e}_resolveInstance(t,e){if(t.activated)return t.cache;const i=this._getChildRequest(t);return this._createInstance(e,i)}_createInstance(t,e){return e.length?new t(...this._resolveRequests(e)):new t}_resolveRequests(t){return t.map((e=>e.bindings.length>1?e.bindings.map((i=>this._resolveFromBinding(i))):this._resolveFromBinding(e.bindings[0])))}_saveToScope(t,e){t.scope===Ol.Singleton&&(t.cache=e,t.activated=!0)}};const li=Symbol("ContributionProvider");class DO{constructor(t,e){this.serviceIdentifier=t,this.container=e,FO.setStore(this.serviceIdentifier,this)}getContributions(){return this.caches||(this.caches=[],this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier))),this.caches}refresh(){this.caches&&(this.caches.length=0,this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier)))}}function cn(n,t){n(li).toDynamicValue((({container:e})=>new DO(t,e))).inSingletonScope().whenTargetNamed(t)}function Q7(n,t){n(li).toDynamicValue((({container:e})=>new DO(t,e))).whenTargetNamed(t)}class FO{static getStore(t){return this.store.get(t)}static setStore(t,e){this.store.set(t,e)}static refreshAllContributions(){this.store.forEach((t=>{t.refresh()}))}}FO.store=new Map;class tG{constructor(t,e){this._args=t,this.name=e,this.taps=[]}tap(t,e){this._tap("sync",t,e)}unTap(t,e){const i=typeof t=="string"?t.trim():t.name;i&&(this.taps=this.taps.filter((r=>!(r.name===i&&(!e||r.fn===e)))))}_parseOptions(t,e,i){let r;if(typeof e=="string")r={name:e.trim()};else if(typeof e!="object"||e===null)throw new Error("Invalid tap options");if(typeof r.name!="string"||r.name==="")throw new Error("Missing name for tap");return r=Object.assign({type:t,fn:i},r),r}_tap(t,e,i){this._insert(this._parseOptions(t,e,i))}_insert(t){let e;typeof t.before=="string"?e=new Set([t.before]):Array.isArray(t.before)&&(e=new Set(t.before));let i=0;typeof t.stage=="number"&&(i=t.stage);let r=this.taps.length;for(;r>0;){r--;const o=this.taps[r];this.taps[r+1]=o;const s=o.stage||0;if(e){if(e.has(o.name)){e.delete(o.name);continue}if(e.size>0)continue}if(!(s>i)){r++;break}}this.taps[r]=t}}class yn extends tG{call(...t){this.taps.map((e=>e.fn)).forEach((e=>e(...t)))}}const ov=Symbol.for("EnvContribution"),tx=Symbol.for("VGlobal"),Et=new J7,ex=Symbol.for("RenderService");class eG{get renderService(){return this._renderService||(this._renderService=Et.get(ex)),this._renderService}}const mt=new eG;let DA=0;class zO{constructor(){this.nextAnimationFrameCbs=new Map,this._rafHandle=null,this.runAnimationFrame=t=>{this._rafHandle=null;const e=this.nextAnimationFrameCbs;this.nextAnimationFrameCbs=new Map,e.forEach((i=>i(t)))},this.tryRunAnimationFrameNextFrame=()=>{this._rafHandle===null&&this.nextAnimationFrameCbs.size!==0&&(this._rafHandle=mt.global.getRequestAnimationFrame()(this.runAnimationFrame))}}addAnimationFrameCb(t){return this.nextAnimationFrameCbs.set(++DA,t),this.tryRunAnimationFrameNextFrame(),DA}removeAnimationFrameCb(t){return!!this.nextAnimationFrameCbs.has(t)&&(this.nextAnimationFrameCbs.delete(t),!0)}}class NO{constructor(){this._listenerMap=new Map,this._eventListenerTransformer=t=>t}setEventListenerTransformer(t){this._eventListenerTransformer=t||(e=>e)}addEventListener(t,e,i){if(!e)return;const r=o=>{const s=this._eventListenerTransformer(o);typeof e=="function"?e(s):e.handleEvent&&e.handleEvent(s)};this._listenerMap.has(t)||this._listenerMap.set(t,new Map),this._listenerMap.get(t).set(e,r),this._nativeAddEventListener(t,r,i)}removeEventListener(t,e,i){var r;if(!e)return;const o=(r=this._listenerMap.get(t))===null||r===void 0?void 0:r.get(e);o&&(this._nativeRemoveEventListener(t,o,i),this._listenerMap.get(t).delete(e),this._listenerMap.get(t).size===0&&this._listenerMap.delete(t))}dispatchEvent(t){return this._nativeDispatchEvent(t)}clearAllEventListeners(){this._listenerMap.forEach(((t,e)=>{t.forEach(((i,r)=>{this._nativeRemoveEventListener(e,i,void 0)}))})),this._listenerMap.clear()}_nativeAddEventListener(t,e,i){throw new Error("_nativeAddEventListener must be implemented by derived classes")}_nativeRemoveEventListener(t,e,i){throw new Error("_nativeRemoveEventListener must be implemented by derived classes")}_nativeDispatchEvent(t){throw new Error("_nativeDispatchEvent must be implemented by derived classes")}}var iG=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},nG=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},FA=function(n,t){return function(e,i){t(e,i,n)}},rG=function(n,t,e,i){return new(e||(e=Promise))((function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e((function(d){d(u)}))).then(s,a)}l((i=i.apply(n,t||[])).next())}))};let x_=class extends NO{get env(){return this._env}get isImageAnonymous(){return this._isImageAnonymous}set isImageAnonymous(n){this._isImageAnonymous=n}get devicePixelRatio(){return this._env||this.setEnv("browser"),this.envContribution.getDevicePixelRatio()}get supportEvent(){return this._env||this.setEnv("browser"),this.envContribution.supportEvent}set supportEvent(n){this._env||this.setEnv("browser"),this.envContribution.supportEvent=n}get supportsTouchEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents}set supportsTouchEvents(n){this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents=n}get supportsPointerEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents}set supportsPointerEvents(n){this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents=n}get supportsMouseEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents}set supportsMouseEvents(n){this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents=n}get applyStyles(){return this._env||this.setEnv("browser"),this.envContribution.applyStyles}set applyStyles(n){this._env||this.setEnv("browser"),this.envContribution.applyStyles=n}constructor(n){super(),this.contributions=n,this._isImageAnonymous=!0,this._performanceRAFList=[],this.eventListenerTransformer=t=>t,this.id=Ci.GenAutoIncrementId(),this.hooks={onSetEnv:new yn(["lastEnv","env","global"])},this.measureTextMethod="native",this.optimizeVisible=!1}_nativeAddEventListener(n,t,e){return this._env||this.setEnv("browser"),this.envContribution.addEventListener(n,t,e)}_nativeRemoveEventListener(n,t,e){return this._env||this.setEnv("browser"),this.envContribution.removeEventListener(n,t,e)}_nativeDispatchEvent(n){return this._env||this.setEnv("browser"),this.envContribution.dispatchEvent(n)}bindContribution(n){const t=[];if(this.contributions.getContributions().forEach((e=>{const i=e.configure(this,n);i&&i.then&&t.push(i)})),t.length)return Promise.all(t)}getDynamicCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getDynamicCanvasCount()}getStaticCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getStaticCanvasCount()}setEnv(n,t){if(t&&t.force===!0||this._env!==n)return this.deactiveCurrentEnv(),this.activeEnv(n,t)}deactiveCurrentEnv(){this.envContribution&&this.envContribution.release()}activeEnv(n,t){const e=this._env;this._env=n;const i=this.bindContribution(t);if(i&&i.then)return i.then((()=>{this.envParams=t,this.hooks.onSetEnv.call(e,n,this)}));this.envParams=t,this.hooks.onSetEnv.call(e,n,this)}setActiveEnvContribution(n){this.envContribution=n}createCanvas(n){return this._env||this.setEnv("browser"),this.envContribution.createCanvas(n)}createOffscreenCanvas(n){return this._env||this.setEnv("browser"),this.envContribution.createOffscreenCanvas(n)}releaseCanvas(n){return this._env||this.setEnv("browser"),this.envContribution.releaseCanvas(n)}getRequestAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getRequestAnimationFrame()}getSpecifiedRequestAnimationFrame(n){this._env||this.setEnv("browser"),this._performanceRAFList[n]||(this._performanceRAFList[n]=new zO);const t=this._performanceRAFList[n];return e=>t.addAnimationFrameCb(e)}getSpecifiedCancelAnimationFrame(n){if(this._env||this.setEnv("browser"),!this._performanceRAFList[n])return()=>!1;const t=this._performanceRAFList[n];return e=>t.removeAnimationFrameCb(e)}getCancelAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getCancelAnimationFrame()}getElementById(n){return this._env||this.setEnv("browser"),this.envContribution.getElementById?this.envContribution.getElementById(n):null}getRootElement(){return this._env||this.setEnv("browser"),this.envContribution.getRootElement?this.envContribution.getRootElement():null}getDocument(){return this._env||this.setEnv("browser"),this.envContribution.getDocument?this.envContribution.getDocument():null}mapToCanvasPoint(n,t){return this._env||this.setEnv("browser"),this.envContribution.mapToCanvasPoint?this.envContribution.mapToCanvasPoint(n,t):null}loadImage(n){return this._env||this.setEnv("browser"),this.envContribution.loadImage(n)}loadSvg(n){return this._env||this.setEnv("browser"),this.envContribution.loadSvg(n)}loadJson(n){return this._env||this.setEnv("browser"),this.envContribution.loadJson(n)}loadArrayBuffer(n){return this._env||this.setEnv("browser"),this.envContribution.loadArrayBuffer(n)}loadBlob(n){return this._env||this.setEnv("browser"),this.envContribution.loadBlob(n)}loadFont(n,t,e){return rG(this,void 0,void 0,(function*(){return this._env||this.setEnv("browser"),this.envContribution.loadFont(n,t,e)}))}isChrome(){return this._isChrome!=null||(this._env||this.setEnv("browser"),this._isChrome=this._env==="browser"&&navigator.userAgent.indexOf("Chrome")>-1),this._isChrome}isSafari(){return this._isSafari!=null||(this._env||this.setEnv("browser"),this._isSafari=this._env==="browser"&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)),this._isSafari}getNativeAABBBounds(n){return this._env||this.setEnv("browser"),this.envContribution.getNativeAABBBounds(n)}removeDom(n){return this._env||this.setEnv("browser"),this.envContribution.removeDom(n)}createDom(n){return this._env||this.setEnv("browser"),this.envContribution.createDom(n)}updateDom(n,t){return this._env||this.setEnv("browser"),this.envContribution.updateDom(n,t)}getElementTop(n,t=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementTop(n,t)}getElementLeft(n,t=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementLeft(n,t)}getElementTopLeft(n,t=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementTopLeft(n,t)}isMacOS(){return this._env||this.setEnv("browser"),this.envContribution.isMacOS()}copyToClipBoard(n){return this._env||this.setEnv("browser"),this.envContribution.copyToClipBoard(n)}};x_=iG([pt(),FA(0,Xt(li)),FA(0,Li(ov)),nG("design:paramtypes",[Object])],x_);var Cl;(function(n){n[n.estimate=0]="estimate",n[n.actualBounding=1]="actualBounding",n[n.fontBounding=2]="fontBounding"})(Cl||(Cl={}));var In;(function(n){n[n.INITIAL=0]="INITIAL",n[n.RUNNING=1]="RUNNING",n[n.PAUSE=2]="PAUSE"})(In||(In={}));var Fd;(function(n){n.wait="wait",n.from="from",n.to="to",n.customAnimate="customAnimate"})(Fd||(Fd={}));var bn;(function(n){n[n.INITIAL=0]="INITIAL",n[n.RUNNING=1]="RUNNING",n[n.PAUSED=2]="PAUSED",n[n.END=3]="END"})(bn||(bn={}));var Wb={exports:{}},zA;function oG(){return zA||(zA=1,(function(n){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function r(l,h,u){this.fn=l,this.context=h,this.once=u||!1}function o(l,h,u,d,c){if(typeof u!="function")throw new TypeError("The listener must be a function");var g=new r(u,d||l,c),f=e?e+h:h;return l._events[f]?l._events[f].fn?l._events[f]=[l._events[f],g]:l._events[f].push(g):(l._events[f]=g,l._eventsCount++),l}function s(l,h){--l._eventsCount===0?l._events=new i:delete l._events[h]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var h=[],u,d;if(this._eventsCount===0)return h;for(d in u=this._events)t.call(u,d)&&h.push(e?d.slice(1):d);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(u)):h},a.prototype.listeners=function(h){var u=e?e+h:h,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var c=0,g=d.length,f=new Array(g);c<g;c++)f[c]=d[c].fn;return f},a.prototype.listenerCount=function(h){var u=e?e+h:h,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(h,u,d,c,g,f){var p=e?e+h:h;if(!this._events[p])return!1;var m=this._events[p],v=arguments.length,b,y;if(m.fn){switch(m.once&&this.removeListener(h,m.fn,void 0,!0),v){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,u),!0;case 3:return m.fn.call(m.context,u,d),!0;case 4:return m.fn.call(m.context,u,d,c),!0;case 5:return m.fn.call(m.context,u,d,c,g),!0;case 6:return m.fn.call(m.context,u,d,c,g,f),!0}for(y=1,b=new Array(v-1);y<v;y++)b[y-1]=arguments[y];m.fn.apply(m.context,b)}else{var C=m.length,w;for(y=0;y<C;y++)switch(m[y].once&&this.removeListener(h,m[y].fn,void 0,!0),v){case 1:m[y].fn.call(m[y].context);break;case 2:m[y].fn.call(m[y].context,u);break;case 3:m[y].fn.call(m[y].context,u,d);break;case 4:m[y].fn.call(m[y].context,u,d,c);break;default:if(!b)for(w=1,b=new Array(v-1);w<v;w++)b[w-1]=arguments[w];m[y].fn.apply(m[y].context,b)}}return!0},a.prototype.on=function(h,u,d){return o(this,h,u,d,!1)},a.prototype.once=function(h,u,d){return o(this,h,u,d,!0)},a.prototype.removeListener=function(h,u,d,c){var g=e?e+h:h;if(!this._events[g])return this;if(!u)return s(this,g),this;var f=this._events[g];if(f.fn)f.fn===u&&(!c||f.once)&&(!d||f.context===d)&&s(this,g);else{for(var p=0,m=[],v=f.length;p<v;p++)(f[p].fn!==u||c&&!f[p].once||d&&f[p].context!==d)&&m.push(f[p]);m.length?this._events[g]=m.length===1?m[0]:m:s(this,g)}return this},a.prototype.removeAllListeners=function(h){var u;return h?(u=e?e+h:h,this._events[u]&&s(this,u)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,n.exports=a})(Wb)),Wb.exports}var sG=oG();const Gl=C1(sG),rg=(n,t)=>Object.prototype.toString.call(n)===`[object ${t}]`,yc=(n,t=!1)=>t?typeof n=="boolean":n===!0||n===!1||rg(n,"Boolean"),sl=n=>typeof n=="function",ze=n=>n==null,qn=n=>n!=null,Ja=n=>{const t=typeof n;return n!==null&&t==="object"||t==="function"},aG=n=>typeof n=="object"&&n!==null,lG=function(n){if(!aG(n)||!rg(n,"Object"))return!1;if(Object.getPrototypeOf(n)===null)return!0;let t=n;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(n)===t},Je=n=>n===void 0,Oo=(n,t=!1)=>{const e=typeof n;return t?e==="string":e==="string"||rg(n,"String")},ue=n=>Array.isArray?Array.isArray(n):rg(n,"Array"),$i=(n,t=!1)=>{const e=typeof n;return t?e==="number":e==="number"||rg(n,"Number")},hG=n=>new RegExp(/^(http(s)?:\/\/)\w+[^\s]+(\.[^\s]+){1,}$/).test(n),uG=n=>new RegExp(/^data:image\/(?:gif|png|jpeg|bmp|webp|svg\+xml)(?:;charset=utf-8)?;base64,(?:[A-Za-z0-9]|[+/])+={0,2}/g).test(n),dG=Object.prototype.hasOwnProperty,cG=(n,t)=>n!=null&&dG.call(n,t);function NA(n){return Object.prototype.toString.call(n)}function WA(n){return Object.keys(n)}function S_(n,t,e){if(n===t)return!0;if(typeof n!=typeof t||n==null||t==null)return!1;if(Number.isNaN(n)&&Number.isNaN(t))return!0;if(NA(n)!==NA(t)||sl(n)||typeof n!="object")return!1;if(ue(n)){if(n.length!==t.length)return!1;for(let o=n.length-1;o>=0;o--)if(!S_(n[o],t[o]))return!1;return!0}if(!lG(n))return!1;const i=WA(n),r=WA(t);if(i.length!==r.length)return!1;i.sort(),r.sort();for(let o=i.length-1;o>=0;o--)if(i[o]!=r[o])return!1;for(let o=i.length-1;o>=0;o--){const s=i[o];if(!S_(n[s],t[s]))return!1}return!0}function Wg(n,t){if(!ue(n)||!ue(t)||n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}const gG=typeof console<"u";function jg(n,t,e){const i=[t].concat([].slice.call(e))}var Vr;(function(n){n[n.None=0]="None",n[n.Error=1]="Error",n[n.Warn=2]="Warn",n[n.Info=3]="Info",n[n.Debug=4]="Debug"})(Vr||(Vr={}));let Hn=class Xn{static getInstance(t,e){return Xn._instance&&$i(t)?Xn._instance.level(t):Xn._instance||(Xn._instance=new Xn(t,e)),Xn._instance}static setInstance(t){return Xn._instance=t}static setInstanceLevel(t){Xn._instance?Xn._instance.level(t):Xn._instance=new Xn(t)}static clearInstance(){Xn._instance=null}constructor(t=Vr.None,e){this._onErrorHandler=[],this._level=t,this._method=e}addErrorHandler(t){this._onErrorHandler.find((e=>e===t))||this._onErrorHandler.push(t)}removeErrorHandler(t){const e=this._onErrorHandler.findIndex((i=>i===t));e<0||this._onErrorHandler.splice(e,1)}callErrorHandler(...t){this._onErrorHandler.forEach((e=>e(...t)))}canLogInfo(){return this._level>=Vr.Info}canLogDebug(){return this._level>=Vr.Debug}canLogError(){return this._level>=Vr.Error}canLogWarn(){return this._level>=Vr.Warn}level(t){return arguments.length?(this._level=+t,this):this._level}error(...t){var e;return this._level>=Vr.Error&&(this._onErrorHandler.length?this.callErrorHandler(...t):jg((e=this._method)!==null&&e!==void 0?e:"error","ERROR",t)),this}warn(...t){return this._level>=Vr.Warn&&jg(this._method||"warn","WARN",t),this}info(...t){return this._level>=Vr.Info&&jg(this._method||"log","INFO",t),this}debug(...t){return this._level>=Vr.Debug&&jg(this._method||"log","DEBUG",t),this}};Hn._instance=null;const fG=1e-10,pG=1e-10;function jA(n,t,e=pG,i=fG){const r=i,o=e*Math.max(n,t);return Math.abs(n-t)<=Math.max(r,o)}const mG=function(n,t,e){return n<t?t:n>e?e:n},Pe=1e-12,si=Math.PI,Rr=si/2,un=2*si,zt=2*Math.PI,ge=Math.abs,de=Math.atan2,Mi=Math.cos,_s=Math.max,gn=Math.min,Ue=Math.sin,eo=Math.sqrt,Zl=Math.pow;function vG(n){return n>1?0:n<-1?si:Math.acos(n)}function VA(n){return n>=1?Rr:n<=-1?-Rr:Math.asin(n)}function GA(n,t,e,i,r){let o=e,s=i;return typeof n=="number"&&typeof e=="number"&&(o=(1-r)*n+r*e),typeof t=="number"&&typeof i=="number"&&(s=(1-r)*t+r*i),{x:o,y:s}}let Te=class WO{constructor(t=0,e=0,i,r){this.x=0,this.y=0,this.x=t,this.y=e,this.x1=i,this.y1=r}clone(){return new WO(this.x,this.y)}copyFrom(t){return this.x=t.x,this.y=t.y,this.x1=t.x1,this.y1=t.y1,this.defined=t.defined,this.context=t.context,this}set(t,e){return this.x=t,this.y=e,this}add(t){return $i(t)?(this.x+=t,void(this.y+=t)):(this.x+=t.x,this.y+=t.y,this)}sub(t){return $i(t)?(this.x-=t,void(this.y-=t)):(this.x-=t.x,this.y-=t.y,this)}multi(t){throw new Error("暂不支持")}div(t){throw new Error("暂不支持")}},Kr=class{static distancePP(t,e){return eo(Zl(t.x-e.x,2)+Zl(t.y-e.y,2))}static distanceNN(t,e,i,r){return eo(Zl(t-i,2)+Zl(e-r,2))}static distancePN(t,e,i){return eo(Zl(e-t.x,2)+Zl(i-t.y,2))}static pointAtPP(t,e,i){return new Te((e.x-t.x)*i+t.x,(e.y-t.y)*i+t.y)}};function mh(n){return n*(Math.PI/180)}function bG(n){return 180*n/Math.PI}const yG=(n=0)=>{if(n<0)for(;n<-un;)n+=un;else if(n>0)for(;n>un;)n-=un;return n},CG=yG;function _G(n,t,e){if(n===null)return t;if(t===null)return n;const{x11:i,x12:r,y11:o,y12:s,x21:a,x22:l,y21:h,y22:u}=wG(n,t);return i>=l||r<=a||o>=u||s<=h?{x1:0,y1:0,x2:0,y2:0}:{x1:Math.max(i,a),y1:Math.max(o,h),x2:Math.min(r,l),y2:Math.min(s,u)}}var $A;(function(n){n[n.NONE=0]="NONE",n[n.BBOX1=1]="BBOX1",n[n.BBOX2=2]="BBOX2"})($A||($A={}));const wG=(n,t,e)=>{let i=n.x1,r=n.x2,o=n.y1,s=n.y2,a=t.x1,l=t.x2,h=t.y1,u=t.y2;return{x11:i,x12:r,y11:o,y12:s,x21:a,x22:l,y21:h,y22:u}};function UA(n,t,e){return n&&t?!(n.x1>t.x2||n.x2<t.x1||n.y1>t.y2||n.y2<t.y1):!0}function jb(n,t){return Math.abs(t[0]*n[0]+t[1]*n[1])}function vs({x:n,y:t},e,i={x:0,y:0}){return{x:(n-i.x)*Math.cos(e)-(t-i.y)*Math.sin(e)+i.x,y:(n-i.x)*Math.sin(e)+(t-i.y)*Math.cos(e)+i.y}}function A_(n){return{x:(n.x1+n.x2)/2,y:(n.y1+n.y2)/2}}function XA(n,t){const e=t?mh(n.angle):n.angle,i=A_(n);return[vs({x:n.x1,y:n.y1},e,i),vs({x:n.x2,y:n.y1},e,i),vs({x:n.x2,y:n.y2},e,i),vs({x:n.x1,y:n.y2},e,i)]}function xG(n,t,e=!1){const i=XA(n,e),r=XA(t,e),o=(m,v)=>[v.x-m.x,v.y-m.y],s=o(A_(n),A_(t)),a=o(i[0],i[1]),l=o(i[1],i[2]),h=o(r[0],r[1]),u=o(r[1],r[2]),d=e?mh(n.angle):n.angle;let c=e?mh(90-n.angle):n.angle+Rr;const g=e?mh(t.angle):t.angle;let f=e?mh(90-t.angle):t.angle+Rr;c>zt&&(c-=zt),f>zt&&(f-=zt);const p=(m,v,b,y)=>{const C=[Math.cos(v),Math.sin(v)];return m+(jb(C,b)+jb(C,y))/2>jb(C,s)};return p((n.x2-n.x1)/2,d,h,u)&&p((n.y2-n.y1)/2,c,h,u)&&p((t.x2-t.x1)/2,g,a,l)&&p((t.y2-t.y1)/2,f,a,l)}function Pa(n,t,e,i,r,o){if(o>t&&o>i||o<t&&o<i||i===t)return 0;const s=(o-t)/(i-t);let a=i<t?1:-1;s!==1&&s!==0||(a=i<t?.5:-.5);const l=s*(e-n)+n;return l===r?1/0:l>r?a:0}const YA=n=>{let t=n.charCodeAt(0),e=n.length===2?n.charCodeAt(1):0,i=t;return 55296<=t&&t<=56319&&56320<=e&&e<=57343&&(t&=1023,e&=1023,i=t<<10|e,i+=65536),i===12288||65281<=i&&i<=65376||65504<=i&&i<=65510?"F":i===8361||65377<=i&&i<=65470||65474<=i&&i<=65479||65482<=i&&i<=65487||65490<=i&&i<=65495||65498<=i&&i<=65500||65512<=i&&i<=65518?"H":4352<=i&&i<=4447||4515<=i&&i<=4519||4602<=i&&i<=4607||9001<=i&&i<=9002||11904<=i&&i<=11929||11931<=i&&i<=12019||12032<=i&&i<=12245||12272<=i&&i<=12283||12289<=i&&i<=12350||12353<=i&&i<=12438||12441<=i&&i<=12543||12549<=i&&i<=12589||12593<=i&&i<=12686||12688<=i&&i<=12730||12736<=i&&i<=12771||12784<=i&&i<=12830||12832<=i&&i<=12871||12880<=i&&i<=13054||13056<=i&&i<=19903||19968<=i&&i<=42124||42128<=i&&i<=42182||43360<=i&&i<=43388||44032<=i&&i<=55203||55216<=i&&i<=55238||55243<=i&&i<=55291||63744<=i&&i<=64255||65040<=i&&i<=65049||65072<=i&&i<=65106||65108<=i&&i<=65126||65128<=i&&i<=65131||110592<=i&&i<=110593||127488<=i&&i<=127490||127504<=i&&i<=127546||127552<=i&&i<=127560||127568<=i&&i<=127569||131072<=i&&i<=194367||177984<=i&&i<=196605||196608<=i&&i<=262141?"W":32<=i&&i<=126||162<=i&&i<=163||165<=i&&i<=166||i===172||i===175||10214<=i&&i<=10221||10629<=i&&i<=10630?"Na":i===161||i===164||167<=i&&i<=168||i===170||173<=i&&i<=174||176<=i&&i<=180||182<=i&&i<=186||188<=i&&i<=191||i===198||i===208||215<=i&&i<=216||222<=i&&i<=225||i===230||232<=i&&i<=234||236<=i&&i<=237||i===240||242<=i&&i<=243||247<=i&&i<=250||i===252||i===254||i===257||i===273||i===275||i===283||294<=i&&i<=295||i===299||305<=i&&i<=307||i===312||319<=i&&i<=322||i===324||328<=i&&i<=331||i===333||338<=i&&i<=339||358<=i&&i<=359||i===363||i===462||i===464||i===466||i===468||i===470||i===472||i===474||i===476||i===593||i===609||i===708||i===711||713<=i&&i<=715||i===717||i===720||728<=i&&i<=731||i===733||i===735||768<=i&&i<=879||913<=i&&i<=929||931<=i&&i<=937||945<=i&&i<=961||963<=i&&i<=969||i===1025||1040<=i&&i<=1103||i===1105||i===8208||8211<=i&&i<=8214||8216<=i&&i<=8217||8220<=i&&i<=8221||8224<=i&&i<=8226||8228<=i&&i<=8231||i===8240||8242<=i&&i<=8243||i===8245||i===8251||i===8254||i===8308||i===8319||8321<=i&&i<=8324||i===8364||i===8451||i===8453||i===8457||i===8467||i===8470||8481<=i&&i<=8482||i===8486||i===8491||8531<=i&&i<=8532||8539<=i&&i<=8542||8544<=i&&i<=8555||8560<=i&&i<=8569||i===8585||8592<=i&&i<=8601||8632<=i&&i<=8633||i===8658||i===8660||i===8679||i===8704||8706<=i&&i<=8707||8711<=i&&i<=8712||i===8715||i===8719||i===8721||i===8725||i===8730||8733<=i&&i<=8736||i===8739||i===8741||8743<=i&&i<=8748||i===8750||8756<=i&&i<=8759||8764<=i&&i<=8765||i===8776||i===8780||i===8786||8800<=i&&i<=8801||8804<=i&&i<=8807||8810<=i&&i<=8811||8814<=i&&i<=8815||8834<=i&&i<=8835||8838<=i&&i<=8839||i===8853||i===8857||i===8869||i===8895||i===8978||9312<=i&&i<=9449||9451<=i&&i<=9547||9552<=i&&i<=9587||9600<=i&&i<=9615||9618<=i&&i<=9621||9632<=i&&i<=9633||9635<=i&&i<=9641||9650<=i&&i<=9651||9654<=i&&i<=9655||9660<=i&&i<=9661||9664<=i&&i<=9665||9670<=i&&i<=9672||i===9675||9678<=i&&i<=9681||9698<=i&&i<=9701||i===9711||9733<=i&&i<=9734||i===9737||9742<=i&&i<=9743||9748<=i&&i<=9749||i===9756||i===9758||i===9792||i===9794||9824<=i&&i<=9825||9827<=i&&i<=9829||9831<=i&&i<=9834||9836<=i&&i<=9837||i===9839||9886<=i&&i<=9887||9918<=i&&i<=9919||9924<=i&&i<=9933||9935<=i&&i<=9953||i===9955||9960<=i&&i<=9983||i===10045||i===10071||10102<=i&&i<=10111||11093<=i&&i<=11097||12872<=i&&i<=12879||57344<=i&&i<=63743||65024<=i&&i<=65039||i===65533||127232<=i&&i<=127242||127248<=i&&i<=127277||127280<=i&&i<=127337||127344<=i&&i<=127386||917760<=i&&i<=917999||983040<=i&&i<=1048573||1048576<=i&&i<=1114109?"A":"N"};function jO(n,t={},e){e||(e=1);const{fontStyle:i=t.fontStyle,fontVariant:r=t.fontVariant,fontWeight:o=t.fontWeight,fontSize:s=t.fontSize,fontFamily:a=t.fontFamily}=n;return(i?i+" ":"")+(r?r+" ":"")+(o?o+" ":"")+s*e+"px "+(a||"sans-serif")}let Rh=class Da{constructor(t,e){this._numberCharSize=null,this._fullCharSize=null,this._letterCharSize=null,this._specialCharSizeMap={},this._canvas=null,this._context=null,this._contextSaved=!1,this._notSupportCanvas=!1,this._notSupportVRender=!1,this._userSpec={},this.specialCharSet=`-/: .,@%'"~`,this._option=t,this._userSpec=e??{},this.textSpec=this._initSpec(),qn(t.specialCharSet)&&(this.specialCharSet=t.specialCharSet),this._standardMethod=qn(t.getTextBounds)?this.fullMeasure.bind(this):this.measureWithNaiveCanvas.bind(this)}initContext(){if(this._notSupportCanvas)return!1;if(ze(this._canvas)&&(qn(this._option.getCanvasForMeasure)&&(this._canvas=this._option.getCanvasForMeasure()),ze(this._canvas)&&typeof window<"u"&&window.document!==void 0&&globalThis&&qn(globalThis.document)&&(this._canvas=globalThis.document.createElement("canvas"))),ze(this._context)&&qn(this._canvas)){const t=this._canvas.getContext("2d");qn(t)&&(t.save(),t.font=jO(this.textSpec),this._contextSaved=!0,this._context=t)}return!ze(this._context)||(this._notSupportCanvas=!0,!1)}_initSpec(){var t,e,i;const{defaultFontParams:r={}}=this._option,{fontStyle:o=r.fontStyle,fontVariant:s=r.fontVariant,fontWeight:a=(t=r.fontWeight)!==null&&t!==void 0?t:"normal",fontSize:l=(e=r.fontSize)!==null&&e!==void 0?e:12,fontFamily:h=(i=r.fontFamily)!==null&&i!==void 0?i:"sans-serif",align:u,textAlign:d=u??"center",baseline:c,textBaseline:g=c??"middle",ellipsis:f,limit:p}=this._userSpec;let{lineHeight:m=l}=this._userSpec;if(Oo(m)&&m[m.length-1]==="%"){const v=Number.parseFloat(m.substring(0,m.length-1))/100;m=l*v}return{fontStyle:o,fontVariant:s,fontFamily:h,fontSize:l,fontWeight:a,textAlign:d,textBaseline:g,ellipsis:f,limit:p,lineHeight:m}}measure(t,e){switch(e){case"vrender":case"canopus":return this.fullMeasure(t);case"canvas":return this.measureWithNaiveCanvas(t);case"simple":return this.quickMeasureWithoutCanvas(t);default:return this.quickMeasure(t)}}fullMeasure(t){if(ze(t))return{width:0,height:0};if(ze(this._option.getTextBounds)||!this._notSupportVRender)return this.measureWithNaiveCanvas(t);const{fontFamily:e,fontSize:i,fontWeight:r,textAlign:o,textBaseline:s,ellipsis:a,limit:l,lineHeight:h}=this.textSpec;let u;try{const d=this._option.getTextBounds({text:t,fontFamily:e,fontSize:i,fontWeight:r,textAlign:o,textBaseline:s,ellipsis:!!a,maxLineWidth:l||1/0,lineHeight:h});u={width:d.width(),height:d.height()}}catch{this._notSupportVRender=!0,u=this.measureWithNaiveCanvas(t)}return u}measureWithNaiveCanvas(t){return this._measureReduce(t,this._measureWithNaiveCanvas.bind(this))}_measureWithNaiveCanvas(t){var e;if(!this.initContext())return this._quickMeasureWithoutCanvas(t);const i=this._context.measureText(t),{fontSize:r,lineHeight:o}=this.textSpec;return{width:i.width,height:(e=o)!==null&&e!==void 0?e:r,fontBoundingBoxAscent:i.fontBoundingBoxAscent,fontBoundingBoxDescent:i.fontBoundingBoxDescent}}quickMeasure(t){return this._measureReduce(t,this._quickMeasure.bind(this))}_quickMeasure(t){const e={width:0,height:0};for(let i=0;i<t.length;i++){const r=t[i];let o=this._measureSpecialChar(r);ze(o)&&Da.NUMBERS_CHAR_SET.includes(r)&&(o=this._measureNumberChar()),ze(o)&&["F","W"].includes(YA(r))&&(o=this._measureFullSizeChar()),ze(o)&&(o=this._measureLetterChar()),e.width+=o.width,e.height=Math.max(e.height,o.height),!ze(o.fontBoundingBoxAscent)&&(e.fontBoundingBoxAscent=o.fontBoundingBoxAscent),!ze(o.fontBoundingBoxDescent)&&(e.fontBoundingBoxDescent=o.fontBoundingBoxDescent)}return e}quickMeasureWithoutCanvas(t){return this._measureReduce(t,this._quickMeasureWithoutCanvas.bind(this))}_quickMeasureWithoutCanvas(t){var e;const i={width:0,height:0},{fontSize:r,lineHeight:o}=this.textSpec;for(let s=0;s<t.length;s++){const a=t[s],l=["F","W"].includes(YA(a))?1:.53;i.width+=l*r}return i.height=(e=o)!==null&&e!==void 0?e:r,i}_measureReduce(t,e){var i;const{fontSize:r,lineHeight:o}=this.textSpec,s={width:0,height:0};if(ze(t))return s;if(ue(t)){const a=t.filter(qn).map((l=>l.toString()));return a.length===0?s:a.length===1?e(a[0]):{width:a.reduce(((l,h)=>Math.max(l,e(h).width)),0),height:a.length*(((i=o)!==null&&i!==void 0?i:r)+1)+1}}return e(t.toString())}_measureNumberChar(){if(ze(this._numberCharSize)){const t=this._standardMethod(Da.NUMBERS_CHAR_SET);this._numberCharSize={width:t.width/Da.NUMBERS_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._numberCharSize}_measureFullSizeChar(){return ze(this._fullCharSize)&&(this._fullCharSize=this._standardMethod(Da.FULL_SIZE_CHAR)),this._fullCharSize}_measureLetterChar(){if(ze(this._letterCharSize)){const t=this._standardMethod(Da.ALPHABET_CHAR_SET);this._letterCharSize={width:t.width/Da.ALPHABET_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._letterCharSize}_measureSpecialChar(t){return qn(this._specialCharSizeMap[t])?this._specialCharSizeMap[t]:this.specialCharSet.includes(t)?(this._specialCharSizeMap[t]=this._standardMethod(t),this._specialCharSizeMap[t]):null}release(){qn(this._canvas)&&(this._canvas=null),qn(this._context)&&(this._contextSaved&&(this._context.restore(),this._contextSaved=!1),this._context=null)}};Rh.ALPHABET_CHAR_SET="abcdefghijklmnopqrstuvwxyz",Rh.NUMBERS_CHAR_SET="0123456789",Rh.FULL_SIZE_CHAR="字";function ix(n,t,e){const{x1:i,y1:r,x2:o,y2:s}=t;return e.onlyTranslate()?(n!==t&&n.setValue(t.x1,t.y1,t.x2,t.y2),n.translate(e.e,e.f),t):(n.clear(),n.add(e.a*i+e.c*r+e.e,e.b*i+e.d*r+e.f),n.add(e.a*o+e.c*r+e.e,e.b*o+e.d*r+e.f),n.add(e.a*o+e.c*s+e.e,e.b*o+e.d*s+e.f),n.add(e.a*i+e.c*s+e.e,e.b*i+e.d*s+e.f),t)}let Cc=class VO{constructor(t){t?this.setValue(t.x1,t.y1,t.x2,t.y2):this.clear()}clone(){return new VO(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}setValue(t=0,e=0,i=0,r=0){return this.x1=t,this.y1=e,this.x2=i,this.y2=r,this}set(t=0,e=0,i=0,r=0){return i<t?(this.x2=t,this.x1=i):(this.x1=t,this.x2=i),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this}add(t=0,e=0){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this}expand(t=0){return ue(t)?(this.y1-=t[0],this.x2+=t[1],this.y2+=t[2],this.x1-=t[3]):(this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(t=0,e=0){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this}rotate(t=0,e=0,i=0){const r=this.rotatedPoints(t,e,i);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])}scale(t=0,e=0,i=0,r=0){const o=this.scalePoints(t,e,i,r);return this.clear().add(o[0],o[1]).add(o[2],o[3])}union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this}intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this}encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2}alignsWith(t){return t&&(this.x1===t.x1||this.x2===t.x2||this.y1===t.y1||this.y2===t.y2)}intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)}contains(t=0,e=0){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)}containsPoint(t){return!(t.x<this.x1||t.x>this.x2||t.y<this.y1||t.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(t=0){return this.x1*=t,this.x2*=t,this}scaleY(t=0){return this.y1*=t,this.y2*=t,this}transformWithMatrix(t){return ix(this,this,t),this}copy(t){return this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this}rotatedPoints(t,e,i){const{x1:r,y1:o,x2:s,y2:a}=this,l=Math.cos(t),h=Math.sin(t),u=e-e*l+i*h,d=i-e*h-i*l;return[l*r-h*o+u,h*r+l*o+d,l*r-h*a+u,h*r+l*a+d,l*s-h*o+u,h*s+l*o+d,l*s-h*a+u,h*s+l*a+d]}scalePoints(t,e,i,r){const{x1:o,y1:s,x2:a,y2:l}=this;return[t*o+(1-t)*i,e*s+(1-e)*r,t*a+(1-t)*i,e*l+(1-e)*r]}},Zi=class extends Cc{};class nx extends Cc{constructor(t,e=0){var i;super(t),t&&(this.angle=(i=t.angle)!==null&&i!==void 0?i:e)}intersects(t){return xG(this,t)}setValue(t=0,e=0,i=0,r=0,o=0){return super.setValue(t,e,i,r),this.angle=o,this}clone(){return new nx(this)}getRotatedCorners(){const t={x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2};return[vs({x:this.x1,y:this.y1},this.angle,t),vs({x:this.x2,y:this.y1},this.angle,t),vs({x:this.x1,y:this.y2},this.angle,t),vs({x:this.x2,y:this.y2},this.angle,t)]}}let wn=class Ff{constructor(t=1,e=0,i=0,r=1,o=0,s=0){this.a=t,this.b=e,this.c=i,this.d=r,this.e=o,this.f=s}equalToMatrix(t){return!(this.e!==t.e||this.f!==t.f||this.a!==t.a||this.d!==t.d||this.b!==t.b||this.c!==t.c)}equalTo(t,e,i,r,o,s){return!(this.e!==o||this.f!==s||this.a!==t||this.d!==r||this.b!==e||this.c!==i)}setValue(t,e,i,r,o,s){return this.a=t,this.b=e,this.c=i,this.d=r,this.e=o,this.f=s,this}reset(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}getInverse(){const t=this.a,e=this.b,i=this.c,r=this.d,o=this.e,s=this.f,a=new Ff,l=t*r-e*i;return a.a=r/l,a.b=-e/l,a.c=-i/l,a.d=t/l,a.e=(i*s-r*o)/l,a.f=-(t*s-e*o)/l,a}rotate(t){const e=Math.cos(t),i=Math.sin(t),r=this.a*e+this.c*i,o=this.b*e+this.d*i,s=this.a*-i+this.c*e,a=this.b*-i+this.d*e;return this.a=r,this.b=o,this.c=s,this.d=a,this}rotateByCenter(t,e,i){const r=Math.cos(t),o=Math.sin(t),s=(1-r)*e+o*i,a=(1-r)*i-o*e,l=r*this.a-o*this.b,h=o*this.a+r*this.b,u=r*this.c-o*this.d,d=o*this.c+r*this.d,c=r*this.e-o*this.f+s,g=o*this.e+r*this.f+a;return this.a=l,this.b=h,this.c=u,this.d=d,this.e=c,this.f=g,this}scale(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this}setScale(t,e){return this.b=this.b/this.a*t,this.c=this.c/this.d*e,this.a=t,this.d=e,this}transform(t,e,i,r,o,s){return this.multiply(t,e,i,r,o,s),this}translate(t,e){return this.e+=this.a*t+this.c*e,this.f+=this.b*t+this.d*e,this}transpose(){const{a:t,b:e,c:i,d:r,e:o,f:s}=this;return this.a=e,this.b=t,this.c=r,this.d=i,this.e=s,this.f=o,this}multiply(t,e,i,r,o,s){const a=this.a,l=this.b,h=this.c,u=this.d,d=a*t+h*e,c=l*t+u*e,g=a*i+h*r,f=l*i+u*r,p=a*o+h*s+this.e,m=l*o+u*s+this.f;return this.a=d,this.b=c,this.c=g,this.d=f,this.e=p,this.f=m,this}interpolate(t,e){const i=new Ff;return i.a=this.a+(t.a-this.a)*e,i.b=this.b+(t.b-this.b)*e,i.c=this.c+(t.c-this.c)*e,i.d=this.d+(t.d-this.d)*e,i.e=this.e+(t.e-this.e)*e,i.f=this.f+(t.f-this.f)*e,i}transformPoint(t,e){const{a:i,b:r,c:o,d:s,e:a,f:l}=this,h=i*s-r*o,u=s/h,d=-r/h,c=-o/h,g=i/h,f=(o*l-s*a)/h,p=-(i*l-r*a)/h,{x:m,y:v}=t;e.x=m*u+v*c+f,e.y=m*d+v*g+p}onlyTranslate(t=1){return this.a===t&&this.b===0&&this.c===0&&this.d===t}clone(){return new Ff(this.a,this.b,this.c,this.d,this.e,this.f)}toTransformAttrs(){const t=this.a,e=this.b,i=this.c,r=this.d,o=t*r-e*i,s={x:this.e,y:this.f,rotateDeg:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(t!==0||e!==0){const a=Math.sqrt(t*t+e*e);s.rotateDeg=e>0?Math.acos(t/a):-Math.acos(t/a),s.scaleX=a,s.scaleY=o/a,s.skewX=(t*i+e*r)/o,s.skewY=0}else if(i!==0||r!==0){const a=Math.sqrt(i*i+r*r);s.rotateDeg=Math.PI/2-(r>0?Math.acos(-i/a):-Math.acos(i/a)),s.scaleX=o/a,s.scaleY=a,s.skewX=0,s.skewY=(t*i+e*r)/o}return s.rotateDeg=bG(s.rotateDeg),s}};function SG(n,t,e,i,r,o,s,a){const l=t.a,h=t.b,u=t.c,d=t.d,c=t.e,g=t.f,f=Mi(s),p=Ue(s);let m,v;a?(m=a[0],v=a[1]):(m=e,v=i);const b=m-e,y=v-i,C=l*f+u*p,w=h*f+d*p,_=u*f-l*p,A=d*f-h*p;n.a=r*C,n.b=r*w,n.c=o*_,n.d=o*A,n.e=c+l*m+u*v-C*b-_*y,n.f=g+h*m+d*v-w*b-A*y}class AG{constructor(){this.CLEAN_THRESHOLD=1e3,this.L_TIME=1e3,this.R_COUNT=1,this.R_TIMESTAMP_MAX_SIZE=20}clearCache(t,e){const{CLEAN_THRESHOLD:i=this.CLEAN_THRESHOLD,L_TIME:r=this.L_TIME,R_COUNT:o=this.R_COUNT}=e;if(t.size<i)return 0;let s=0;const a=h=>{s++,t.delete(h)},l=Date.now();return t.forEach(((h,u)=>{if(h.timestamp.length<o)return a(u);let d=0;for(;l-h.timestamp[h.timestamp.length-1-d]<r&&(d++,!(d>=o)););if(d<o)return a(u);for(;l-h.timestamp[0]>r;)h.timestamp.shift()})),s}addLimitedTimestamp(t,e,i){const{R_TIMESTAMP_MAX_SIZE:r=this.R_TIMESTAMP_MAX_SIZE}=i;t.timestamp.length>r&&t.timestamp.shift(),t.timestamp.push(e)}clearTimeStamp(t,e){const{L_TIME:i=this.L_TIME}=e,r=Date.now();t.forEach((o=>{for(;r-o.timestamp[0]>i;)o.timestamp.shift()}))}clearItemTimestamp(t,e){const{L_TIME:i=this.L_TIME}=e,r=Date.now();for(;r-t.timestamp[0]>i;)t.timestamp.shift()}}function qA(n,t,e){t/=100,e/=100;const i=(1-Math.abs(2*e-1))*t,r=i*(1-Math.abs(n/60%2-1)),o=e-i/2;let s=0,a=0,l=0;return 0<=n&&n<60?(s=i,a=r,l=0):60<=n&&n<120?(s=r,a=i,l=0):120<=n&&n<180?(s=0,a=i,l=r):180<=n&&n<240?(s=0,a=r,l=i):240<=n&&n<300?(s=r,a=0,l=i):300<=n&&n<360&&(s=i,a=0,l=r),s=Math.round(255*(s+o)),a=Math.round(255*(a+o)),l=Math.round(255*(l+o)),{r:s,g:a,b:l}}function GO(n,t,e){n/=255,t/=255,e/=255;const i=Math.min(n,t,e),r=Math.max(n,t,e),o=r-i;let s=0,a=0,l=0;return s=o===0?0:r===n?(t-e)/o%6:r===t?(e-n)/o+2:(n-t)/o+4,s=Math.round(60*s),s<0&&(s+=360),l=(r+i)/2,a=o===0?0:o/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:s,s:a,l}}const MG=/^#([0-9a-f]{3,8})$/,KA={transparent:4294967040},Vb={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Vg(n){return((n=Math.max(0,Math.min(255,Math.round(n)||0)))<16?"0":"")+n.toString(16)}function $O(n){return $i(n)?new Pr(n>>16,n>>8&255,255&n,1):ue(n)?new Pr(n[0],n[1],n[2]):new Pr(255,255,255)}function TG(n){return $i(n)?new Pr(n>>>24,n>>>16&255,n>>>8&255,255&n):ue(n)?new Pr(n[0],n[1],n[2],n[3]):new Pr(255,255,255,1)}function Gb(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function $b(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}const ZA=(n,t)=>{const e=MG.exec(n);if(t||e){const i=parseInt(e[1],16),r=e[1].length;return r===3?new Pr((i>>8&15)+((i>>8&15)<<4),(i>>4&15)+((i>>4&15)<<4),(15&i)+((15&i)<<4),1):r===6?$O(i):r===8?new Pr(i>>24&255,i>>16&255,i>>8&255,(255&i)/255):null}};let JA=class Fa{static Brighter(t,e=1){return e===1?t:new Fa(t).brighter(e).toRGBA()}static SetOpacity(t,e=1){return e===1?t:new Fa(t).setOpacity(e).toRGBA()}static getColorBrightness(t,e="hsl"){const i=t instanceof Fa?t:new Fa(t);switch(e){case"hsv":default:return i.getHSVBrightness();case"hsl":return i.getHSLBrightness();case"lum":return i.getLuminance();case"lum2":return i.getLuminance2();case"lum3":return i.getLuminance3();case"wcag":return i.getLuminanceWCAG()}}static parseColorString(t){if(qn(KA[t]))return TG(KA[t]);if(qn(Vb[t]))return $O(Vb[t]);const e=`${t}`.trim().toLowerCase(),i=ZA(e);if(i!==void 0)return i;if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const r=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new Pr(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10),parseFloat(r[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const r=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),o=qA(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10));return new Pr(o.r,o.g,o.b,parseFloat(r[3]))}}constructor(t){const e=Fa.parseColorString(t);e?this.color=e:this.color=new Pr(255,255,255)}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t))),this}add(t){const{r:e,g:i,b:r}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,r+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return .5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const r=this.color.opacity,o=GO(this.color.r,this.color.g,this.color.b),s=qA(ze(t)?o.h:mG(t,0,360),ze(e)?o.s:e>=0&&e<=1?100*e:e,ze(i)?o.l:i<=1&&i>=0?100*i:i);return this.color=new Pr(s.r,s.g,s.b,r),this}setRGB(t,e,i){return!ze(t)&&(this.color.r=t),!ze(e)&&(this.color.g=e),!ze(i)&&(this.color.b=i),this}setHex(t){const e=`${t}`.trim().toLowerCase(),i=ZA(e,!0);return i??this}setColorName(t){const e=Vb[t.toLowerCase()];return e!==void 0&&this.setHex(e),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(t=1){return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}getLuminanceWCAG(){const t=this.color.r/255,e=this.color.g/255,i=this.color.b/255;let r,o,s;return r=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),o=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),s=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),.2126*r+.7152*o+.0722*s}clone(){return new Fa(this.color.toString())}copyGammaToLinear(t,e=2){return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t,e=2){const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=Gb(t.color.r),this.color.g=Gb(t.color.g),this.color.b=Gb(t.color.b),this}copyLinearToSRGB(t){return this.color.r=$b(t.color.r),this.color.g=$b(t.color.g),this.color.b=$b(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}},Pr=class{constructor(t,e,i,r){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),qn(r)?this.opacity=isNaN(+r)?1:Math.max(0,Math.min(1,+r)):this.opacity=1}formatHex(){return`#${Vg(this.r)+Vg(this.g)+Vg(this.b)+(this.opacity===1?"":Vg(255*this.opacity))}`}formatRgb(){const t=this.opacity;return`${t===1?"rgb(":"rgba("}${this.r},${this.g},${this.b}${t===1?")":`,${t})`}`}formatHsl(){const t=this.opacity,{h:e,s:i,l:r}=GO(this.r,this.g,this.b);return`${t===1?"hsl(":"hsla("}${e},${i}%,${r}%${t===1?")":`,${t})`}`}toString(){return this.formatHex()}};const RG=un-1e-8;class rx{constructor(t){this.init(t)}init(t){this.bounds=t}arc(t,e,i,r,o,s){if(Math.abs(o-r)>RG)return this.bounds.add(t-i,e-i),void this.bounds.add(t+i,e+i);let a,l,h,u,d=1/0,c=-1/0,g=1/0,f=-1/0;function p(m){h=i*Math.cos(m),u=i*Math.sin(m),h<d&&(d=h),h>c&&(c=h),u<g&&(g=u),u>f&&(f=u)}if(p(r),p(o),o!==r)if((r%=un)<0&&(r+=un),(o%=un)<0&&(o+=un),o<r&&(s=!s,a=r,r=o,o=a),s)for(o-=un,a=r-r%Rr,l=0;l<4&&a>o;++l,a-=Rr)p(a);else for(a=r-r%Rr+Rr,l=0;l<4&&a<o;++l,a+=Rr)p(a);this.bounds.add(t+d,e+g),this.bounds.add(t+c,e+f)}arcTo(t,e,i,r,o){this.bounds.add(t,e)}bezierCurveTo(t,e,i,r,o,s){this.bounds.add(t,e),this.bounds.add(i,r),this.bounds.add(o,s)}closePath(){}ellipse(){throw new Error("不支持ellipse")}lineTo(t,e){this.bounds.add(t,e)}moveTo(t,e){this.bounds.add(t,e)}quadraticCurveTo(t,e,i,r){this.bounds.add(t,e),this.bounds.add(i,r)}rect(t,e,i,r){this.bounds.add(t,e),this.bounds.add(t+i,e+r)}clear(){this.bounds.clear()}release(...t){}}class BG{constructor(){this._curves=[],this.bounds=new Zi}get curves(){return this._curves}getCurveLengths(){return this._curves.map((t=>t.getLength()))}getPointAt(t){return{x:0,y:0}}getLength(){return 0}getBounds(){return this.bounds}}const kG=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,PG={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7},Yt={A:0,AT:1,C:2,Z:3,E:4,L:5,M:6,Q:7,R:8};let Ub,QA,Gg,tM,Xb,$g;function EG(n){if(!n)return[];const t=n.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(t===null)return[];let e,i;const r=[];for(let o=0,s=t.length;o<s;o++)if(Ub=t[o],QA=Ub.slice(1),Gg=Ub[0],e=[Gg],i=QA.match(kG),i!==null){for(let a=0,l=i.length;a<l;a++)tM=i[a],Xb=parseFloat(tM),Number.isNaN(Xb)||e.push(Xb);if($g=PG[Gg],e.length-1>$g){let a,l=Gg;for(let h=1,u=e.length;h<u;h+=$g){a=[l];for(let d=h,c=h+$g;d<c;d++)a.push(e[d]);r.push(a),l==="m"?l="l":l==="M"&&(l="L")}}else r.push(e)}else r.push(e);return r}var Ae;(function(n){n[n.NONE=0]="NONE",n[n.UPDATE_BOUNDS=1]="UPDATE_BOUNDS",n[n.UPDATE_SHAPE=2]="UPDATE_SHAPE",n[n.CLEAR_SHAPE=253]="CLEAR_SHAPE",n[n.UPDATE_SHAPE_AND_BOUNDS=3]="UPDATE_SHAPE_AND_BOUNDS",n[n.INIT=179]="INIT",n[n.CLEAR_BOUNDS=254]="CLEAR_BOUNDS",n[n.UPDATE_GLOBAL_MATRIX=32]="UPDATE_GLOBAL_MATRIX",n[n.CLEAR_GLOBAL_MATRIX=223]="CLEAR_GLOBAL_MATRIX",n[n.UPDATE_LOCAL_MATRIX=16]="UPDATE_LOCAL_MATRIX",n[n.CLEAR_LOCAL_MATRIX=239]="CLEAR_LOCAL_MATRIX",n[n.UPDATE_GLOBAL_LOCAL_MATRIX=48]="UPDATE_GLOBAL_LOCAL_MATRIX",n[n.UPDATE_LAYOUT=128]="UPDATE_LAYOUT",n[n.CLEAR_LAYOUT=127]="CLEAR_LAYOUT"})(Ae||(Ae={}));var _c;(function(n){n[n.GLOBAL=1]="GLOBAL",n[n.LOCAL=16]="LOCAL",n[n.GLOBAL_ACCURATE=3]="GLOBAL_ACCURATE",n[n.LOCAL_ACCURATE=48]="LOCAL_ACCURATE"})(_c||(_c={}));var Tn;(function(n){n[n.INIT=0]="INIT",n[n.DEFAULT=1]="DEFAULT",n[n.STATE=2]="STATE",n[n.ANIMATE_BIND=10]="ANIMATE_BIND",n[n.ANIMATE_PLAY=11]="ANIMATE_PLAY",n[n.ANIMATE_START=12]="ANIMATE_START",n[n.ANIMATE_UPDATE=13]="ANIMATE_UPDATE",n[n.ANIMATE_END=14]="ANIMATE_END",n[n.TRANSLATE=20]="TRANSLATE",n[n.TRANSLATE_TO=21]="TRANSLATE_TO",n[n.SCALE=22]="SCALE",n[n.SCALE_TO=23]="SCALE_TO",n[n.ROTATE=24]="ROTATE",n[n.ROTATE_TO=25]="ROTATE_TO"})(Tn||(Tn={}));var ve;(function(n){n[n.ROW=1]="ROW",n[n.COLUMN=2]="COLUMN"})(ve||(ve={}));var wc;(function(n){n[n.CubicBezierCurve=0]="CubicBezierCurve",n[n.QuadraticBezierCurve=1]="QuadraticBezierCurve",n[n.ArcCurve=2]="ArcCurve",n[n.LineCurve=3]="LineCurve",n[n.EllipseCurve=4]="EllipseCurve",n[n.MoveCurve=5]="MoveCurve"})(wc||(wc={}));var ne;(function(n){n[n.beforeFillStroke=0]="beforeFillStroke",n[n.afterFillStroke=1]="afterFillStroke"})(ne||(ne={}));function LG(n,t,e,i,r,o,s,a,l){const h=mh(s),u=Math.sin(h),d=Math.cos(h),c=d*(a-n)*.5+u*(l-t)*.5,g=d*(l-t)*.5-u*(a-n)*.5;let f=c*c/((e=Math.abs(e))*e)+g*g/((i=Math.abs(i))*i);f>1&&(f=Math.sqrt(f),e*=f,i*=f);const p=d/e,m=u/e,v=-u/i,b=d/i,y=p*a+m*l,C=v*a+b*l,w=p*n+m*t,_=v*n+b*t;let A=1/((w-y)*(w-y)+(_-C)*(_-C))-.25;A<0&&(A=0);let x=Math.sqrt(A);o===r&&(x=-x);const S=.5*(y+w)-x*(_-C),T=.5*(C+_)+x*(w-y),M=Math.atan2(C-T,y-S);let R=Math.atan2(_-T,w-S)-M;R<0&&o===1?R+=un:R>0&&o===0&&(R-=un);const E=Math.ceil(Math.abs(R/(Rr+.001))),P=[];for(let B=0;B<E;++B){const k=M+B*R/E,L=M+(B+1)*R/E;P[B]=[S,T,k,L,e,i,u,d]}return P}function OG(n){const t=n[0],e=n[1],i=n[2],r=n[3],o=n[4],s=n[5],a=n[6],l=n[7],h=l*o,u=-a*s,d=a*o,c=l*s,g=Math.cos(i),f=Math.sin(i),p=Math.cos(r),m=Math.sin(r),v=.5*(r-i),b=Math.sin(.5*v),y=8/3*b*b/Math.sin(v),C=t+g-y*f,w=e+f+y*g,_=t+p,A=e+m,x=_+y*m,S=A-y*p;return[h*C+u*w,d*C+c*w,h*x+u*S,d*x+c*S,h*_+u*A,d*_+c*A]}function eM(n,t,e,i){const r=LG(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,e);for(let o=0;o<r.length;++o){const s=OG(r[o]);n.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5])}}const IG=(n,t,e,i,r,o,s,a=!1)=>{const l=2*Math.PI,h=(t%l+l)%l;let u,d=(e%l+l)%l;a?(d>=h&&(d-=l),u=d-h):(d<=h&&(d+=l),u=d-h);const c=Math.ceil(Math.abs(u)/(.5*Math.PI)),g=u/c;for(let f=0;f<c;f++){const p=h+g*f,m=h+g*(f+1),v=4/3*Math.tan(Math.abs(g)/4),b=Math.cos(p),y=Math.sin(p),C=Math.cos(m),w=Math.sin(m),_=b*o+i,A=y*s+r,x=C*o+i,S=w*s+r,T=a?-1:1,M=o*v*T,R=s*v*T;n.push(_-M*y,A+R*b,x+M*w,S-R*C,x,S)}},HG=[(n,t,e,i,r,o,s)=>t.arc(n[1]*r+e,n[2]*o+i,n[3]*(r+o)/2,n[4],n[5],n[6],s),(n,t,e,i,r,o,s)=>t.arcTo(n[1]*r+e,n[2]*o+i,n[3]*r+e,n[4]*o+i,n[5]*(r+o)/2,s),(n,t,e,i,r,o,s)=>t.bezierCurveTo(n[1]*r+e,n[2]*o+i,n[3]*r+e,n[4]*o+i,n[5]*r+e,n[6]*o+i,s),(n,t,e,i)=>t.closePath(),(n,t,e,i,r,o)=>t.ellipse(n[1]*r+e,n[2]*o+i,n[3]*r,n[4]*o,n[5],n[6],n[7],n[8]),(n,t,e,i,r,o,s)=>t.lineTo(n[1]*r+e,n[2]*o+i,s),(n,t,e,i,r,o,s)=>t.moveTo(n[1]*r+e,n[2]*o+i,s),(n,t,e,i,r,o,s)=>t.quadraticCurveTo(n[1]*r+e,n[2]*o+i,n[3]*r+e,n[4]*o+i,s),(n,t,e,i,r,o,s)=>t.rect(n[1]*r+e,n[2]*o+i,n[3]*r,n[4]*o,s)];function Bs(n,t,e=0,i=0,r=1,o=1,s){for(let a=0;a<n.length;a++){const l=n[a];HG[l[0]](l,t,e,i,r,o,s)}}class ox{getLength(t){return t!=null?this.calcProjLength(t):(Number.isFinite(this.length)||(this.length=this.calcLength()),this.length)}}function UO(n,t){let e=0;const i=n.length;for(let r=0;r<i;r++){const o=n[r],s=t[r],a=n[(r+1)%i],l=t[(r+1)%i];e+=Kr.distanceNN(o,s,a,l)}return e/2}function DG(n,t,e,i,r){return UO([n.x,t.x,e.x,i.x],[n.y,t.y,e.y,i.y])}function iM(n,t,e,i,r){const o=1-r;return o*o*o*n+3*t*r*o*o+3*e*r*r*o+i*r*r*r}function XO(n,t,e,i,r){const o=iM(n.x,t.x,e.x,i.x,r),s=iM(n.y,t.y,e.y,i.y,r);return new Te(o,s)}function nM(n,t,e,i){const r=1-i;return r*r*n+2*r*i*t+i*i*e}function YO(n,t,e,i){const r=nM(n.x,t.x,e.x,i),o=nM(n.y,t.y,e.y,i);return new Te(r,o)}function FG(n,t,e,i){return UO([n.x,t.x,e.x],[n.y,t.y,e.y])}function pu(n,t){const{p0:e,p1:i,p2:r,p3:o}=n,s=XO(e,i,r,o,t),a=Kr.pointAtPP(e,i,t),l=Kr.pointAtPP(i,r,t),h=Kr.pointAtPP(r,o,t),u=Kr.pointAtPP(a,l,t),d=Kr.pointAtPP(l,h,t);return[new Rp(e,a,u,s),new Rp(s,d,h,o)]}class Rp extends ox{constructor(t,e,i,r){super(),this.type=wc.CubicBezierCurve,this.p0=t,this.p1=e,this.p2=i,this.p3=r}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y+this.p3.x+this.p3.y)}getPointAt(t){if(this.defined!==!1)return XO(this.p0,this.p1,this.p2,this.p3,t);throw new Error("defined为false的点不能getPointAt")}calcLength(){return this._validPoint()?DG(this.p0,this.p1,this.p2,this.p3):60}calcProjLength(t){return t===ve.ROW?ge(this.p0.x-this.p3.x):t===ve.COLUMN?ge(this.p0.y-this.p3.y):0}getAngleAt(t){const e=_s(t-.01,0),i=gn(t+.01,1),r=this.getPointAt(e),o=this.getPointAt(i);return de(o.y-r.y,o.x-r.x)}draw(t,e,i,r,o,s){if(t.moveTo(this.p0.x*r+e,this.p0.y*o+i),s>=1)t.bezierCurveTo(this.p1.x*r+e,this.p1.y*o+i,this.p2.x*r+e,this.p2.y*o+i,this.p3.x*r+e,this.p3.y*o+i);else if(s>0){const[a]=pu(this,s);t.bezierCurveTo(a.p1.x*r+e,a.p1.y*o+i,a.p2.x*r+e,a.p2.y*o+i,a.p3.x*r+e,a.p3.y*o+i)}}includeX(t){const e=gn(this.p0.x,this.p1.x,this.p2.x,this.p3.x),i=_s(this.p0.x,this.p1.x,this.p2.x,this.p3.x);return t>=e&&t<=i}getYAt(t){const e=gn(this.p0.x,this.p1.x,this.p2.x,this.p3.x),i=(t-e)/(_s(this.p0.x,this.p1.x,this.p2.x,this.p3.x)-e);return this.getPointAt(i).y}}function rM(n,t){const{p0:e,p1:i}=n,r=Kr.pointAtPP(e,i,t);return[new Bp(e,r),new Bp(r,i)]}class Bp extends ox{constructor(t,e){super(),this.type=wc.LineCurve,this.p0=t,this.p1=e}getPointAt(t){if(this.defined!==!1)return Kr.pointAtPP(this.p0,this.p1,t);throw new Error("defined为false的点不能getPointAt")}getAngleAt(t){return this.angle==null&&(this.angle=de(this.p1.y-this.p0.y,this.p1.x-this.p0.x)),this.angle}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y)}calcLength(){return this._validPoint()?Kr.distancePP(this.p0,this.p1):60}calcProjLength(t){return t===ve.ROW?ge(this.p0.x-this.p1.x):t===ve.COLUMN?ge(this.p0.y-this.p1.y):0}draw(t,e,i,r,o,s){if(t.moveTo(this.p0.x*r+e,this.p0.y*o+i),s>=1)t.lineTo(this.p1.x*r+e,this.p1.y*o+i);else if(s>0){const a=this.getPointAt(s);t.lineTo(a.x*r+e,a.y*o+i)}}includeX(t){return t>=this.p0.x&&t<=this.p1.x||t>=this.p1.x&&t<=this.p0.x}getYAt(t){if(this.includeX(t)){let e=this.p0,i=this.p1;this.p0.x>this.p1.x&&(e=this.p1,i=this.p0);const r=(t-e.x)/(i.x-e.x);return e.y+r*(i.y-e.y)}return 1/0}}class sv{get endX(){return this._lastX}get endY(){return this._lastY}constructor(t,e){this.init(t,e)}init(t,e){this._lastX=this._lastY=this._startX=this._startY=0,this.curveType=t,this.direction=e,this.curves=[]}bezierCurveTo(t,e,i,r,o,s,a,l){const h=new Rp(new Te(this._lastX,this._lastY),new Te(t,e),new Te(i,r),new Te(o,s));h.originP1=this._lastOriginP,h.originP2=l,h.defined=a,this.curves.push(h),this._lastX=o,this._lastY=s,this._lastOriginP=l}closePath(){if(this.curves.length<2)return;const t=this.curves[this.curves.length-1];this.lineTo(this._startX,this._startY,t.defined,this._startOriginP)}ellipse(){throw new Error("SegContext不支持调用ellipse")}lineTo(t,e,i,r){const o=this.addLinearCurve(t,e,i,this._lastOriginP,r);this.curves.push(o),this._lastX=t,this._lastY=e,this._lastOriginP=r}moveTo(t,e,i){return this._lastX=this._startX=t,this._lastY=this._startY=e,this._lastOriginP=i,this._startOriginP=i,this}quadraticCurveTo(t,e,i,r){throw new Error("SegContext不支持调用quadraticCurveTo")}clear(){this.curves=[],this.length=NaN}tryUpdateLength(t){return this.getLength(t)}addLinearCurve(t,e,i,r,o){const s=new Bp(new Te(this._lastX,this._lastY),new Te(t,e));return s.originP1=r,s.originP2=o,s.defined=i,s}getPointAt(t){throw new Error("暂未实现")}getCurveLengths(){return[]}getLength(t){var e,i;if(t===ve.COLUMN){if(!this.curves.length)return 0;const r=this.curves[0],o=this.curves[this.curves.length-1],s=(e=o.p3)!==null&&e!==void 0?e:o.p1;return ge(r.p0.y-s.y)}if(t===ve.ROW){if(!this.curves.length)return 0;const r=this.curves[0],o=this.curves[this.curves.length-1],s=(i=o.p3)!==null&&i!==void 0?i:o.p1;return ge(r.p0.x-s.x)}return Number.isFinite(this.length)||(this.length=this.curves.reduce(((r,o)=>r+o.getLength()),0)),this.length}}class zG extends sv{bezierCurveTo(t,e,i,r,o,s,a,l){return super.bezierCurveTo(e,t,r,i,s,o,a,l)}lineTo(t,e,i,r){return super.lineTo(e,t,i,r)}moveTo(t,e,i){return super.moveTo(e,t,i)}clear(){return super.clear()}}function $l(n,t,e=1){let i=!1;for(let r=0,o=t.length;r<=o;r++)r>=o===i&&((i=!i)?n.lineStart():n.lineEnd()),i&&n.point(t[r])}function Ou(n,t,e){const i=t??(ge(e[e.length-1].x-e[0].x)>ge(e[e.length-1].y-e[0].y)?ve.ROW:ve.COLUMN);return n==="monotoneY"?new zG(n,i):new sv(n,i)}class qO{constructor(t,e){this.context=t,e&&(this.startPoint=e)}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t)}this._lastDefined=t.defined}tryUpdateLength(){return this.context.tryUpdateLength()}}function og(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;const r=Ou("linear",e,n);return NG(new qO(r,i),n),r}function NG(n,t){return $l(n,t,1)}function oM(n,t,e,i,r){n.context.bezierCurveTo((2*n._x0+n._x1)/3,(2*n._y0+n._y1)/3,(n._x0+2*n._x1)/3,(n._y0+2*n._y1)/3,(n._x0+4*n._x1+t)/6,(n._y0+4*n._y1+e)/6,i,n.lastPoint1)}class WG{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){this._point===2&&oM(this,6*this._x1-(this._x0+4*this._x1),6*this._y1-(this._y0+4*this._y1),this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;break;default:oM(this,e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}function jG(n,t){return $l(n,t,2)}function VG(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;if(n.length<3-+!!i)return og(n,t);const r=Ou("basis",e,n);return jG(new WG(r,i),n),r}function sM(n){return n<0?-1:1}function aM(n,t,e){const i=n._x1-n._x0,r=t-n._x1,o=(n._y1-n._y0)/(i||Number(r<0&&-0)),s=(e-n._y1)/(r||Number(i<0&&-0)),a=(o*r+s*i)/(i+r);return(sM(o)+sM(s))*Math.min(Math.abs(o),Math.abs(s),.5*Math.abs(a))||0}function lM(n,t){const e=n._x1-n._x0;return e?(3*(n._y1-n._y0)/e-t)/2:t}function Yb(n,t,e,i,r){const o=n._x0,s=n._y0,a=n._x1,l=n._y1,h=(a-o)/3;n.context.bezierCurveTo(o+h,s+h*t,a-h,l-h*e,a,l,i,n.lastPoint1)}class KO{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x1,this._y1,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1);break;case 3:Yb(this,this._t0,lM(this,this._t0),this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1)}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){let e=NaN;const i=t.x,r=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(i,r,this._lastDefined1!==!1&&this._lastDefined2!==!1,t):this.context.moveTo(i,r,t);break;case 1:this._point=2;break;case 2:this._point=3,Yb(this,lM(this,e=aM(this,i,r)),e,this._lastDefined1!==!1&&this._lastDefined2!==!1);break;default:Yb(this,this._t0,e=aM(this,i,r),this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=r,this._t0=e,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined!==!1,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}class GG extends KO{constructor(t,e){super(t,e)}point(t){return super.point({y:t.x,x:t.y,defined:t.defined})}}function $G(n,t){return $l(n,t,2)}function UG(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;if(n.length<3-+!!i)return og(n,t);const r=Ou("monotoneX",e,n);return $G(new KO(r,i),n),r}function XG(n,t){return $l(n,t,2)}function YG(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;if(n.length<3-+!!i)return og(n,t);const r=Ou("monotoneY",e,n);return XG(new GG(r,i),n),r}let ZO=class{constructor(t,e=.5,i){this.context=t,this._t=e,this.startPoint=i}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x=this._y=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){0<this._t&&this._t<1&&this._point===2&&this.context.lineTo(this._x,this._y,this._lastDefined!==!1,this.lastPoint),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:if(this._t<=0)this.context.lineTo(this._x,i,this._lastDefined!==!1&&t.defined!==!1,this.lastPoint),this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t);else{const r=this._x*(1-this._t)+e*this._t;this._t===.5?this.context.lineTo(r,this._y,this._lastDefined!==!1,this.lastPoint):this.context.lineTo(r,this._y,this._lastDefined!==!1&&t.defined!==!1,this.lastPoint),this.context.lineTo(r,i,this._lastDefined!==!1&&t.defined!==!1,t)}}this._lastDefined=t.defined,this._x=e,this._y=i,this.lastPoint=t}tryUpdateLength(){return this.context.tryUpdateLength()}};class qG extends ZO{lineEnd(){this.context.closePath()}}function qb(n,t,e={}){const{direction:i,startPoint:r}=e;if(n.length<2-+!!r)return null;const o=new sv("step",i??(ge(n[n.length-1].x-n[0].x)>ge(n[n.length-1].y-n[0].y)?ve.ROW:ve.COLUMN));return JO(new ZO(o,t,r),n),o}function JO(n,t){return $l(n,t,1)}function KG(n,t,e={}){const{direction:i,startPoint:r}=e;if(n.length<2-+!!r)return null;const o=new sv("step",i??(ge(n[n.length-1].x-n[0].x)>ge(n[n.length-1].y-n[0].y)?ve.ROW:ve.COLUMN));return JO(new qG(o,t,r),n),o}class ZG extends qO{lineEnd(){this.context.closePath()}}function JG(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;const r=Ou("linear",e,n);return QG(new ZG(r,i),n),r}function QG(n,t){return $l(n,t,1)}function QO(n,t,e,i,r){let o=n._x1,s=n._y1,a=n._x2,l=n._y2;if(n._l01_a>Pe){const h=2*n._l01_2a+3*n._l01_a*n._l12_a+n._l12_2a,u=3*n._l01_a*(n._l01_a+n._l12_a);o=(o*h-n._x0*n._l12_2a+n._x2*n._l01_2a)/u,s=(s*h-n._y0*n._l12_2a+n._y2*n._l01_2a)/u}if(n._l23_a>Pe){const h=2*n._l23_2a+3*n._l23_a*n._l12_a+n._l12_2a,u=3*n._l23_a*(n._l23_a+n._l12_a);a=(a*h+n._x1*n._l23_2a-t*n._l12_2a)/u,l=(l*h+n._y1*n._l23_2a-e*n._l12_2a)/u}n.context.bezierCurveTo(o,s,a,l,n._x2,n._y2,i,n.lastPoint1)}class t${constructor(t,e=.5,i){this.context=t,this.startPoint=i,this._alpha=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x2,this._y2,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1);break;case 3:this.point({x:this._x2,y:this._y2})}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){const{x:e,y:i}=t;if(this._point){const r=this._x2-e,o=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+o*o,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1):this.context.moveTo(e,i);break;case 1:this._point=2;break;case 2:this._point=3;default:QO(this,e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}function tI(n,t){return function(e,i,r={}){const{direction:o,startPoint:s}=r;if(e.length<2-+!!s)return null;if(e.length<3-+!!s)return og(e,r);const a=Ou(n,o,e),l=new t(a,i,s);return $l(l,e,2),a}}const e$=tI("catmullRom",t$);class i${constructor(t,e=.5,i){this.context=t,this.startPoint=i,this._alpha=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 1:this.context.moveTo(this._x3,this._y3,this.lastPoint1),this.context.closePath();break;case 2:this.context.lineTo(this._x3,this._y3,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1),this.context.closePath();break;case 3:this.point({x:this._x3,y:this._y3}),this.point({x:this._x4,y:this._y4}),this.point({x:this._x5,y:this._y5})}}point(t){const{x:e,y:i}=t;if(this._point){const r=this._x2-e,o=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+o*o,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=i;break;case 1:this._point=2,this.context.moveTo(this._x4=e,this._y4=i,t);break;case 2:this._point=3,this._x5=e,this._y5=i;break;default:QO(this,e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}const n$=tI("catmullRomClosed",i$);function r$(n,t){const{p0:e,p1:i,p2:r}=n,o=YO(e,i,r,t),s=Kr.pointAtPP(e,i,t),a=Kr.pointAtPP(i,r,t);return[new M_(e,s,o),new M_(o,a,r)]}class M_ extends ox{constructor(t,e,i){super(),this.type=wc.QuadraticBezierCurve,this.p0=t,this.p1=e,this.p2=i}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y)}getPointAt(t){if(this.defined!==!1)return YO(this.p0,this.p1,this.p2,t);throw new Error("defined为false的点不能getPointAt")}calcLength(){return this._validPoint()?FG(this.p0,this.p1,this.p2):60}calcProjLength(t){return t===ve.ROW?ge(this.p0.x-this.p2.x):t===ve.COLUMN?ge(this.p0.y-this.p2.y):0}getAngleAt(t){const e=_s(t-.01,0),i=gn(t+.01,1),r=this.getPointAt(e),o=this.getPointAt(i);return de(o.y-r.y,o.x-r.x)}draw(t,e,i,r,o,s){if(t.moveTo(this.p0.x*r+e,this.p0.y*o+i),s>=1)t.quadraticCurveTo(this.p1.x*r+e,this.p1.y*o+i,this.p2.x*r+e,this.p2.y*o+i);else if(s>0){const[a]=r$(this,s);t.quadraticCurveTo(a.p1.x*r+e,a.p1.y*o+i,a.p2.x*r+e,a.p2.y*o+i)}}getYAt(t){throw new Error("QuadraticBezierCurve暂不支持getYAt")}includeX(t){throw new Error("QuadraticBezierCurve暂不支持includeX")}}class o${constructor(t){this.path=t,this._lastX=this._lastY=this._startX=this._startY=0}moveTo(t,e){return this._lastX=this._startX=t,this._lastY=this._startY=e,this}lineTo(t,e){const i=this.addLinearCurve(t,e);this.path.addCurve(i),this._lastX=t,this._lastY=e}addLinearCurve(t,e){return new Bp(new Te(this._lastX,this._lastY),new Te(t,e))}quadraticCurveTo(t,e,i,r){const o=new M_(new Te(this._lastX,this._lastY),new Te(t,e),new Te(i,r));this.path.addCurve(o),this._lastX=i,this._lastY=r}bezierCurveTo(t,e,i,r,o,s){const a=new Rp(new Te(this._lastX,this._lastY),new Te(t,e),new Te(i,r),new Te(o,s));this.path.addCurve(a),this._lastX=o,this._lastY=s}arcTo(t,e,i,r,o){throw new Error("CurveContext不支持调用arcTo")}ellipse(t,e,i,r,o,s,a,l){throw new Error("CurveContext不支持调用ellipse")}rect(t,e,i,r){throw new Error("CurveContext不支持调用rect")}arc(t,e,i,r,o,s){throw new Error("CurveContext不支持调用arc")}closePath(){this.path.curves.length<2||this.lineTo(this._startX,this._startY)}}function al(n,t,e){var i,r;switch(t){case"linear":default:return og(n,e);case"basis":return VG(n,e);case"monotoneX":return UG(n,e);case"monotoneY":return YG(n,e);case"step":return qb(n,.5,e);case"stepClosed":return KG(n,.5,e);case"stepBefore":return qb(n,0,e);case"stepAfter":return qb(n,1,e);case"catmullRom":return e$(n,(i=e?.curveTension)!==null&&i!==void 0?i:.5,e);case"catmullRomClosed":return n$(n,(r=e?.curveTension)!==null&&r!==void 0?r:.5,e);case"linearClosed":return JG(n,e)}}class Fi extends BG{constructor(t){super(),this.commandList=[],t&&(this._ctx=t),this._boundsContext=new rx(this.bounds)}get curves(){return this.tryBuildCurves()}setCtx(t){this._ctx=t}moveTo(t,e){return this.commandList.push([Yt.M,t,e]),this._ctx&&this._ctx.moveTo(t,e),this}lineTo(t,e){return this.commandList.push([Yt.L,t,e]),this._ctx&&this._ctx.lineTo(t,e),this}quadraticCurveTo(t,e,i,r){return this.commandList.push([Yt.Q,t,e,i,r]),this._ctx&&this._ctx.quadraticCurveTo(t,e,i,r),this}bezierCurveTo(t,e,i,r,o,s){return this.commandList.push([Yt.C,t,e,i,r,o,s]),this._ctx&&this._ctx.bezierCurveTo(t,e,i,r,o,s),this}arcTo(t,e,i,r,o){return this.commandList.push([Yt.AT,t,e,i,r,o]),this._ctx&&this._ctx.arcTo(t,e,i,r,o),this}ellipse(t,e,i,r,o,s,a,l){return this.commandList.push([Yt.E,t,e,i,r,o,s,a,l]),this._ctx&&this._ctx.ellipse(t,e,i,r,o,s,a,l),this}rect(t,e,i,r){return this.commandList.push([Yt.R,t,e,i,r]),this._ctx&&this._ctx.rect(t,e,i,r),this}arc(t,e,i,r,o,s){return this.commandList.push([Yt.A,t,e,i,r,o,s]),this._ctx&&this._ctx.arc(t,e,i,r,o,s),this}closePath(){return this.commandList.push([Yt.Z]),this._ctx&&this._ctx.closePath(),this}addCurve(t){this._curves.push(t)}clear(){this.transformCbList=null,this.commandList.length=0,this._curves.length=0}beginPath(){this.clear()}tryBuildCurves(){if(!this._curves||!this._curves.length){const t=new o$(this);Bs(this.commandList,t,0,0,1,1)}return this._curves}toString(){if(!this.toStringCbList){const i=[];i[Yt.M]=r=>`M${r[1]} ${r[2]}`,i[Yt.L]=r=>`L${r[1]} ${r[2]}`,i[Yt.Q]=r=>`Q${r[1]} ${r[2]} ${r[3]} ${r[4]}`,i[Yt.C]=r=>`C${r[1]} ${r[2]} ${r[3]} ${r[4]} ${r[5]} ${r[6]}`,i[Yt.A]=r=>{const o=[],s=r[1],a=r[2],l=r[3],h=r[4],u=r[5],d=r[6];IG(o,h,u,s,a,l,l,d);let c="";for(let g=0;g<o.length;g+=6)c+=`C${o[g]} ${o[g+1]} ${o[g+2]} ${o[g+3]} ${o[g+4]} ${o[g+5]}`;return c},i[Yt.R]=r=>`M${r[1]} ${r[2]} h${r[3]} v${r[4]} H${r[1]}Z`,i[Yt.Z]=r=>"Z",this.toStringCbList=i}const t=this.toStringCbList;let e="";return this.commandList.forEach((i=>{e+=t[i[0]](i)})),e}fromString(t,e,i,r,o){this.clear();const s=EG(t);return this._runCommandStrList(s,e,i,r,o),this._updateBounds(),this}fromLine(t){const{points:e,curveType:i,clipRangeByDimension:r}=t.attribute;if(!e)return;const o=al(e,i);r==="x"?this.direction=ve.ROW:r==="y"?this.direction=ve.COLUMN:r==="auto"&&(this.direction=o.direction),this._curves=o.curves}fromCustomPath2D(t,e,i,r,o){return this.clear(),this._runCommandList(t.commandList,e,i,r,o),this._updateBounds(),this}transform(t,e,i,r){const o=this.commandList;if(!this.transformCbList){const s=[];s[Yt.M]=this.moveToTransform,s[Yt.L]=this.lineToTransform,s[Yt.Q]=this.quadraticCurveToTransform,s[Yt.C]=this.bezierCurveToTransform,s[Yt.AT]=this.arcToTransform,s[Yt.E]=this.ellipseTransform,s[Yt.R]=this.rectTransform,s[Yt.A]=this.arcTransform,s[Yt.Z]=this.closePathTransform,this.transformCbList=s}o.forEach((s=>{this.transformCbList[s[0]](s,t,e,i,r)})),this._updateBounds()}moveToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i}lineToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i}quadraticCurveToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r+e,t[4]=t[4]*o+i}bezierCurveToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r+e,t[4]=t[4]*o+i,t[5]=t[5]*r+e,t[6]=t[6]*o+i}arcToTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r+e,t[4]=t[4]*o+i,t[5]=t[5]*(r+o)/2}ellipseTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r,t[4]=t[4]*o}rectTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*r,t[4]=t[4]*o}arcTransform(t,e,i,r,o){t[1]=t[1]*r+e,t[2]=t[2]*o+i,t[3]=t[3]*(r+o)/2}closePathTransform(){}_runCommandStrList(t,e=0,i=0,r=1,o=1){let s,a,l,h,u,d=null,c=0,g=0,f=0,p=0;for(let m=0,v=t.length;m<v;++m){switch(s=t[m],r===1&&o===1||(s=s$(s,r,o)),s[0]){case"l":c+=s[1],g+=s[2],this.lineTo(c+e,g+i);break;case"L":c=s[1],g=s[2],this.lineTo(c+e,g+i);break;case"h":c+=s[1],this.lineTo(c+e,g+i);break;case"H":c=s[1],this.lineTo(c+e,g+i);break;case"v":g+=s[1],this.lineTo(c+e,g+i);break;case"V":g=s[1],this.lineTo(c+e,g+i);break;case"m":c+=s[1],g+=s[2],this.moveTo(c+e,g+i);break;case"M":c=s[1],g=s[2],this.moveTo(c+e,g+i);break;case"c":a=c+s[5],l=g+s[6],f=c+s[3],p=g+s[4],this.bezierCurveTo(c+s[1]+e,g+s[2]+i,f+e,p+i,a+e,l+i),c=a,g=l;break;case"C":c=s[5],g=s[6],f=s[3],p=s[4],this.bezierCurveTo(s[1]+e,s[2]+i,f+e,p+i,c+e,g+i);break;case"s":a=c+s[3],l=g+s[4],d[0].match(/[CcSs]/)===null?(f=c,p=g):(f=2*c-f,p=2*g-p),h=c+s[1],u=g+s[2],this.bezierCurveTo(f+e,p+i,h+e,u+i,a+e,l+i),f=h,p=u,c=a,g=l;break;case"S":a=s[3],l=s[4],d[0].match(/[CcSs]/)===null?(f=c,p=g):(f=2*c-f,p=2*g-p),h=s[1],u=s[2],this.bezierCurveTo(f+e,p+i,h+e,u+i,a+e,l+i),f=h,p=u,c=a,g=l;break;case"q":a=c+s[3],l=g+s[4],f=c+s[1],p=g+s[2],this.quadraticCurveTo(f+e,p+i,a+e,l+i),c=a,g=l;break;case"Q":a=s[3],l=s[4],this.quadraticCurveTo(s[1]+e,s[2]+i,a+e,l+i),c=a,g=l,f=s[1],p=s[2];break;case"t":a=c+s[1],l=g+s[2],d[0].match(/[QqTt]/)===null?(f=c,p=g):d[0]==="t"?(f=2*c-h,p=2*g-u):d[0]==="q"&&(f=2*c-f,p=2*g-p),h=f,u=p,this.quadraticCurveTo(f+e,p+i,a+e,l+i),c=a,g=l,f=c+s[1],p=g+s[2];break;case"T":a=s[1],l=s[2],f=2*c-f,p=2*g-p,this.quadraticCurveTo(f+e,p+i,a+e,l+i),c=a,g=l;break;case"a":eM(this,c+e,g+i,[s[1],s[2],s[3],s[4],s[5],s[6]+c+e,s[7]+g+i]),c+=s[6],g+=s[7];break;case"A":eM(this,c+e,g+i,[s[1],s[2],s[3],s[4],s[5],s[6]+e,s[7]+i]),c=s[6],g=s[7];break;case"z":case"Z":this.closePath()}d=s}}_runCommandList(t,e=0,i=0,r=1,o=1){if(e!==0||i!==0||r!==1||o!==1)for(let s=0,a=t.length;s<a;++s){const l=t[s].slice();switch(l[0]){case Yt.L:this.lineToTransform(l,e,i,r,o);break;case Yt.M:this.moveToTransform(l,e,i,r,o);break;case Yt.C:this.bezierCurveToTransform(l,e,i,r,o);break;case Yt.Q:this.quadraticCurveToTransform(l,e,i,r,o);break;case Yt.A:this.arcToTransform(l,e,i,r,o);break;case Yt.E:this.ellipseTransform(l,e,i,r,o);break;case Yt.R:this.rectTransform(l,e,i,r,o);break;case Yt.AT:this.arcToTransform(l,e,i,r,o);break;case Yt.Z:this.closePath()}}else this.commandList=t.map((s=>s.slice()))}_updateBounds(){this.bounds.clear(),Bs(this.commandList,this._boundsContext)}release(){this.commandList=[],this._boundsContext=null,this._ctx=null}getLength(){if(this.direction===ve.COLUMN){if(!this._curves.length)return 0;const t=this._curves[0],e=this._curves[this._curves.length-1];return ge(t.p0.y-e.p1.y)}if(this.direction===ve.ROW){if(!this._curves.length)return 0;const t=this._curves[0],e=this._curves[this._curves.length-1];return ge(t.p0.x-e.p1.x)}return this._curves.reduce(((t,e)=>t+e.getLength()),0)}getYAt(t){if(!this.curves)return 1/0;for(let e=0;e<this.curves.length;e++){const i=this.curves[e];if(i.includeX(t))return i.getYAt(t)}return 1/0}getAttrAt(t){if(!this._curves)return{pos:{x:0,y:0},angle:0};let e,i=0;for(let o=0;o<this._curves.length;o++){e=this._curves[o];const s=e.getLength(this.direction);if(i+s>=t)break;i+=s}const r=(t-i)/e.getLength(this.direction);return{pos:e.getPointAt(r),angle:e.getAngleAt(r)}}drawWithClipRange(t,e,i,r,o){this.tryBuildCurves();const s=this.getLength()*o;let a=0;for(let l=0;l<this._curves.length;l++){const h=this._curves[l],u=h.getLength(this.direction);if(!(a+u<=s)){const d=1-(a+u-s)/u;h.draw(t,i,r,e,e,d);break}h.draw(t,i,r,e,e,1),a+=u}}}const dr=["l",0,0,0,0,0,0,0];function s$(n,t,e){const i=dr[0]=n[0];if(i==="a"||i==="A")dr[1]=t*n[1],dr[2]=e*n[2],dr[3]=n[3],dr[4]=n[4],dr[5]=n[5],dr[6]=t*n[6],dr[7]=e*n[7];else if(i==="h"||i==="H")dr[1]=t*n[1];else if(i==="v"||i==="V")dr[1]=e*n[1];else for(let r=1,o=n.length;r<o;++r)dr[r]=(r%2==1?t:e)*n[r];return dr}const a$={alignSelf:"auto"},Vi={x:0,y:0,z:0,dx:0,dy:0,dz:0,scrollX:0,scrollY:0,scaleX:1,scaleY:1,scaleZ:1,angle:0,alpha:0,beta:0,scaleCenter:[0,0],anchor:[0,0],anchor3d:[0,0],postMatrix:new wn},eI={fillOpacity:1,fill:!1,shadowBlur:0,shadowColor:"black",shadowOffsetX:0,shadowOffsetY:0},Kb={strokeOpacity:1,lineDash:[],lineDashOffset:0,lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,strokeBoundsBuffer:2,stroke:!1},iI=Object.assign({outerBorder:Object.assign(Object.assign({},Kb),{distance:0}),innerBorder:Object.assign(Object.assign({},Kb),{distance:0})},Kb),zn={text:"",maxLineWidth:1/0,maxWidth:1/0,textAlign:"left",textBaseline:"alphabetic",fontSize:16,fontFamily:`PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,
    Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol`,fontWeight:"",ellipsis:"…",fontVariant:"",fontStyle:"",lineHeight:void 0,underline:0,lineThrough:0,scaleIn3d:!1,direction:"horizontal",wordBreak:"break-all",ignoreBuf:!1,verticalMode:0,wrap:!1,whiteSpace:"no-wrap",heightLimit:1/0,lineClamp:1/0,suffixPosition:"end",underlineDash:[],underlineOffset:0,disableAutoClipedPoptip:void 0,measureMode:Cl.fontBounding,keepCenterInLine:!1},l$={pickStrokeBuffer:0},h$=Object.assign(Object.assign(Object.assign(Object.assign({forceBoundsWidth:void 0,forceBoundsHeight:void 0,opacity:1,background:null,autoAnimateTexture:!1,textureRatio:1,textureOptions:null,backgroundOpacity:1,backgroundCornerRadius:0,texture:null,textureColor:"black",textureSize:10,texturePadding:2,backgroundMode:"no-repeat",backgroundFit:!0,backgroundKeepAspectRatio:!1,backgroundClip:!0,backgroundScale:1,backgroundOffsetX:0,backgroundOffsetY:0,blur:0,filter:"",cursor:null,html:null,react:null,vue:null},eI),iI),a$),l$),nI={connectedType:"none",connectedStyle:{},connectedX:NaN,connectedY:NaN},u$={_debug_bounds:!1},ei=Object.assign(Object.assign(Object.assign({strokeSeg:null,renderable:!0,pickable:!0,shadowGraphic:void 0,childrenPickable:!0,fillPickable:!0,strokePickable:!0,visible:!0,zIndex:0,layout:null,boundsPadding:0,fillStrokeOrder:0,renderStyle:"default",pickMode:"accurate",customPickShape:null,boundsMode:"accurate",keepDirIn3d:!0,shadowRootIdx:1,globalZIndex:1,globalCompositeOperation:"",overflow:"hidden",shadowPickMode:"graphic",keepStrokeScale:!1,clipConfig:null,roughStyle:null},u$),h$),Vi),d$=Object.assign(Object.assign({},ei),{startAngle:0,endAngle:zt,innerRadius:0,outerRadius:1,innerPadding:0,outerPadding:0,cornerRadius:0,padRadius:0,padAngle:0,cap:!1,forceShowCap:!1}),c$=Object.assign(Object.assign(Object.assign({},ei),nI),{points:[],segments:[],curveType:"linear",clipRange:1,closePath:!1,curveTension:1}),g$=Object.assign(Object.assign({},ei),{radius:1,startAngle:0,endAngle:zt}),f$=Object.assign(Object.assign({},ei),{width:0,height:0,cornerRadius:0,path:[],clip:!1,visibleAll:!0,display:"relative",flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"flex-start",alignContent:"flex-start",baseOpacity:1,cornerType:"round"}),p$=Object.assign(Object.assign({},ei),{path:"",width:0,height:0,cornerRadius:0,clip:!1}),m$=Object.assign(Object.assign(Object.assign({},ei),nI),{points:[],segments:[],curveType:"linear",clipRange:1,clipRangeByDimension:"default",closePath:!1,curveTension:1}),v$=Object.assign(Object.assign({},ei),{path:new Fi,fillStrokeOrder:1,clipRange:1,customPath:()=>{Hn.getInstance().warn("空函数")}}),b$=Object.assign(Object.assign({},ei),{points:[],cornerRadius:0,closePath:!0}),y$=Object.assign(Object.assign({},ei),{width:100,height:100,spikes:5,thickness:.5}),C$=Object.assign(Object.assign({},ei),{width:0,height:0,x1:0,y1:0,strokeBoundsBuffer:0,cornerRadius:0,cornerType:"round",drawStrokeWhenZeroWH:!1});Object.assign(Object.assign({},ei),{width:0,height:0,x1:0,y1:0,cornerRadius:0,length:0,cornerType:"round",drawStrokeWhenZeroWH:!1});const _$=Object.assign(Object.assign({},ei),{symbolType:"circle",size:10,keepDirIn3d:!0,clipRange:1}),rI=Object.assign(Object.assign(Object.assign({},ei),zn),{strokeBoundsBuffer:0,keepDirIn3d:!0}),as=Object.assign(Object.assign(Object.assign({},ei),zn),{upgradeAttrs:null,editable:!1,editOptions:null,ascentDescentMode:"actual",width:300,height:300,ellipsis:!0,wordBreak:"break-word",verticalDirection:"top",textAlign:"left",textBaseline:"top",layoutDirection:"horizontal",textConfig:[],disableAutoWrapLine:!1,maxHeight:void 0,maxWidth:void 0,singleLine:!1}),xc=Object.assign(Object.assign({repeatX:"no-repeat",repeatY:"no-repeat",image:"",width:0,height:0,maxWidth:500,maxHeight:500},ei),{fill:!0,cornerRadius:0,cornerType:"round"}),w$=Object.assign(Object.assign({},xc),{backgroundShowMode:"never",backgroundWidth:0,backgroundHeight:0,textAlign:"left",textBaseline:"middle",direction:"horizontal",margin:0,id:"",width:20,height:20,backgroundFill:"rgba(101, 117, 168, 0.1)",backgroundFillOpacity:1,backgroundStroke:!1,backgroundStrokeOpacity:1,backgroundRadius:4,opacity:1}),x$=(function(){const n={linearGradient:/^(linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,fromAngleValue:/^from\s*(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/(^\#[0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^(rgb\(\d{1,3},\s*\d{1,3},\s*\d{1,3}\))/i,rgbaColor:/^(rgba\(\d{1,3},\s*\d{1,3},\s*\d{1,3},\s*((\d\.\d+)|\d{1,3})\))/i};let t="";function e(C){const w=new Error(t+": "+C);throw w.source=t,w}function i(){const C=g(r);return t.length>0&&e("Invalid input not EOF"),C}function r(){return o("linear",n.linearGradient,s)||o("radial",n.radialGradient,l)||o("conic",n.conicGradient,a)}function o(C,w,_){return(function(A,x){const S=b(A);if(S){b(n.startCall)||e("Missing (");const T=x(S);return b(n.endCall)||e("Missing )"),T}})(w,(function(A){const x=_();return x&&(b(n.comma)||e("Missing comma before color stops")),{type:C,orientation:x,colorStops:g(f)}}))}function s(){return v("directional",n.sideOrCorner,1)||v("angular",n.angleValue,1)}function a(){return v("angular",n.fromAngleValue,1)}function l(){let C,w,_=h();return _&&(C=[],C.push(_),w=t,b(n.comma)&&(_=h(),_?C.push(_):t=w)),C}function h(){let C=(function(){const w=v("shape",/^(circle)/i,0);return w&&(w.style=m()||u()),w})()||(function(){const w=v("shape",/^(ellipse)/i,0);return w&&(w.style=p()||u()),w})();if(C)C.at=d();else{const w=u();if(w){C=w;const _=d();_&&(C.at=_)}else{const _=c();_&&(C={type:"default-radial",at:_})}}return C}function u(){return v("extent-keyword",n.extentKeywords,1)}function d(){if(v("position",/^at/,0)){const C=c();return C||e("Missing positioning value"),C}}function c(){const C={x:p(),y:p()};if(C.x||C.y)return{type:"position",value:C}}function g(C){let w=C();const _=[];if(w)for(_.push(w);b(n.comma);)w=C(),w?_.push(w):e("One extra comma");return _}function f(){const C=v("hex",n.hexColor,1)||v("rgba",n.rgbaColor,1)||v("rgb",n.rgbColor,1)||v("literal",n.literalColor,0);return C||e("Expected color definition"),C.length=p(),C}function p(){return v("%",n.percentageValue,1)||v("position-keyword",n.positionKeywords,1)||m()}function m(){return v("px",n.pixelValue,1)||v("em",n.emValue,1)}function v(C,w,_){const A=b(w);if(A)return{type:C,value:A[_]}}function b(C){const w=/^[\n\r\t\s]+/.exec(t);w&&y(w[0].length);const _=C.exec(t);return _&&y(_[0].length),_}function y(C){t=t.substr(C)}return function(C){return t=C.toString(),i()}})();class ls{static IsGradient(t){return!(typeof t=="string"&&!t.includes("gradient"))}static IsGradientStr(t){return typeof t=="string"&&t.includes("gradient")}static Parse(t){if(ls.IsGradientStr(t))try{const e=x$(t)[0];if(e){if(e.type==="linear")return ls.ParseLinear(e);if(e.type==="radial")return ls.ParseRadial(e);if(e.type==="conic")return ls.ParseConic(e)}}catch{return t}return t}static processColorStops(t){if(!t||t.length===0)return[];if(t.some((e=>e.length))){const e=t.map((i=>({color:i.value,offset:i.length?parseFloat(i.length.value)/100:-1})));e[0].offset<0&&(e[0].offset=0),e[e.length-1].offset<0&&(e[e.length-1].offset=1);for(let i=1;i<e.length-1;i++)if(e[i].offset<0){const r=i-1;let o=i+1;for(;o<e.length&&e[o].offset<0;)o++;const s=e[r].offset,a=e[o].offset,l=o-r;for(let h=1;h<l;h++)e[r+h].offset=s+(a-s)*h/l;i=o-1}return e}return t.map(((e,i)=>{const r=t.length>1?i/(t.length-1):0;return{color:e.value,offset:r}}))}static ParseConic(t){const{orientation:e,colorStops:i=[]}=t,r=si/2,o=parseFloat(e.value)/180*si-r;return{gradient:"conical",x:.5,y:.5,startAngle:o,endAngle:o+zt,stops:ls.processColorStops(i)}}static ParseRadial(t){const{colorStops:e=[]}=t;return{gradient:"radial",x0:.5,y0:.5,x1:.5,y1:.5,r0:0,r1:1,stops:ls.processColorStops(e)}}static ParseLinear(t){const{orientation:e,colorStops:i=[]}=t,r=si/2;let o=e.type==="angular"?parseFloat(e.value)/180*si:0;for(;o<0;)o+=zt;for(;o>=zt;)o-=zt;let s=0,a=0,l=0,h=0;return o<r?(s=0,a=1,l=Math.sin(o),h=a-Math.cos(o)):o<si?(s=0,a=0,l=Math.cos(o-r),h=Math.sin(o-r)):o<si+r?(s=1,a=0,l=s-Math.sin(o-si),h=Math.cos(o-si)):(s=1,l=s-Math.cos(o-r-si),h-=Math.sin(o-r-si)),{gradient:"linear",x0:s,y0:a,x1:l,y1:h,stops:ls.processColorStops(i)}}}function jo(n,t,e){let i=t;const{a:r,b:o,c:s,d:a}=n.currentMatrix,l=Math.sign(r)*Math.sqrt(r*r+o*o),h=Math.sign(a)*Math.sqrt(s*s+a*a);return l+h===0?0:(i=i/Math.abs(l+h)*2*e,i)}function kp(n,t,e,i=0,r=0){var o,s,a,l;if(!t||t===!0)return"black";let h,u;if(ue(t))for(let d=0;d<t.length&&(u=t[d],!u);d++);else u=t;if(u=ls.Parse(u),typeof u=="string")return u;if(e.AABBBounds&&(!e.attribute||e.attribute.scaleX!==0||e.attribute.scaleY!==0)){const d=e.AABBBounds;let c=d.x2-d.x1,g=d.y2-d.y1,f=d.x1-i,p=d.y1-r;if(e.attribute){const{scaleX:m=1,scaleY:v=1,angle:b=0}=e.attribute;c/=m,g/=v,f/=m,p/=v,(b||m!==1||v!==1)&&(f=(o=e.x1WithoutTransform)!==null&&o!==void 0?o:0,p=(s=e.y1WithoutTransform)!==null&&s!==void 0?s:0,c=(a=e.widthWithoutTransform)!==null&&a!==void 0?a:c,g=(l=e.heightWithoutTransform)!==null&&l!==void 0?l:g)}u.gradient==="linear"?h=S$(n,u,f,p,c,g):u.gradient==="conical"?h=M$(n,u,f,p,c,g):u.gradient==="radial"&&(h=A$(n,u,f,p,c,g))}return h||"orange"}function S$(n,t,e,i,r,o){var s,a,l,h;const u=n.createLinearGradient(e+((s=t.x0)!==null&&s!==void 0?s:0)*r,i+((a=t.y0)!==null&&a!==void 0?a:0)*o,e+((l=t.x1)!==null&&l!==void 0?l:1)*r,i+((h=t.y1)!==null&&h!==void 0?h:0)*o);return t.stops.forEach((d=>{u.addColorStop(d.offset,d.color)})),u}function A$(n,t,e,i,r,o){var s,a,l,h,u,d;const c=n.createRadialGradient(e+((s=t.x0)!==null&&s!==void 0?s:.5)*r,i+((a=t.y0)!==null&&a!==void 0?a:.5)*o,Math.max(r,o)*((l=t.r0)!==null&&l!==void 0?l:0),e+((h=t.x1)!==null&&h!==void 0?h:.5)*r,i+((u=t.y1)!==null&&u!==void 0?u:.5)*o,Math.max(r,o)*((d=t.r1)!==null&&d!==void 0?d:.5));return t.stops.forEach((g=>{c.addColorStop(g.offset,g.color)})),c}function M$(n,t,e,i,r,o){var s,a;const l=n.createConicGradient(e+((s=t.x)!==null&&s!==void 0?s:0)*r,i+((a=t.y)!==null&&a!==void 0?a:0)*o,t.startAngle,t.endAngle);return t.stops.forEach((h=>{l.addColorStop(h.offset,h.color)})),l.GetPattern?l.GetPattern(r+e,o+i,void 0):l}const sx={horizontal:{width:"width",height:"height",left:"left",top:"top",x:"x",y:"y",bottom:"bottom"},vertical:{width:"height",height:"width",left:"top",top:"left",x:"y",y:"x",bottom:"right"}},oI={fill:!0,stroke:!1},Pp=/\w|\(|\)|-/,sI=/[.?!,;:/，。？！、；：]/,T$=/\S/,aI=(n,t)=>{let e=t.fontSize||16;switch(t.script){case"super":case"sub":e*=.8}n.setTextStyle({textAlign:"left",textBaseline:t.textBaseline||"alphabetic",fontStyle:t.fontStyle||"",fontWeight:t.fontWeight||"",fontSize:e,fontFamily:t.fontFamily})};function R$(n,t,e){const i=t&&t.fill||oI.fill,{fillOpacity:r=1,opacity:o=1}=t;n.globalAlpha=r*o,n.fillStyle=e?kp(n,i,{AABBBounds:e}):i,aI(n,t)}function B$(n,t){const e=t&&t.stroke||oI.stroke;if(!e)return void(n.globalAlpha=0);const{strokeOpacity:i=1,opacity:r=1}=t;n.globalAlpha=i*r,n.lineWidth=t&&typeof t.lineWidth=="number"?t.lineWidth:1,n.strokeStyle=e,aI(n,t)}function zf(n,t,e,i,r){if(n.length<=1||!t||t<=0)return 0;const o=mt.graphicUtil.textMeasure;let s=i,a=n.slice(0,s),l=Math.floor(o.measureText(a,e).width),h=n.slice(0,s+1),u=Math.floor(o.measureText(h,e).width);for(;l>t||u<=t;){if(l>t?s--:s++,s>n.length){s=n.length;break}if(s<0){s=0;break}a=n.slice(0,s),l=Math.floor(o.measureText(a,e).width),h=n.slice(0,s+1),u=Math.floor(o.measureText(h,e).width)}return r&&(s=Nf(n,s)),s}function Nf(n,t,e=!1){let i=t;for(;Pp.test(n[i-1])&&Pp.test(n[i])||sI.test(n[i]);)if(i--,i<=0)return e?k$(n,t):t;return i}function k$(n,t){let e=t;for(;Pp.test(n[e+1])&&Pp.test(n[e])||sI.test(n[e]);)if(e++,e>=n.length)return e;return e+1}function Qa(n,t,e="actual"){var i;if(n==="")return{ascent:0,height:0,descent:0,width:0};const r=mt.graphicUtil.textMeasure.measureText(n,t),o={ascent:0,height:0,descent:0,width:0},s=e==="actual"?r.actualBoundingBoxAscent:r.fontBoundingBoxAscent,a=e==="actual"?r.actualBoundingBoxDescent:r.fontBoundingBoxDescent;typeof s!="number"||typeof a!="number"?(o.width=Math.floor(r.width),o.height=t.fontSize||0,o.ascent=o.height,o.descent=0):(o.width=Math.floor(r.width),o.height=Math.floor(s+a),o.ascent=Math.floor(s),o.descent=o.height-o.ascent);const l=(i=t.space)!==null&&i!==void 0?i:0;return o.width+=l,o}var P$=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let T_=class{constructor(){this.id="ATextMeasure"}configure(n,t){this.canvas=n.canvas,this.context=n.context,n.bindTextMeasure(this)}_measureTextWithoutAlignBaseline(n,t,e){this.context.setTextStyleWithoutAlignBaseline(t);const i=this.context.measureText(n);return e?this.compatibleMetrics(i,t):i}_measureTextWithAlignBaseline(n,t,e){this.context.setTextStyle(t);const i=this.context.measureText(n);return e?this.compatibleMetrics(i,t):i}compatibleMetrics(n,t){if(n.actualBoundingBoxAscent==null||n.actualBoundingBoxDescent==null||n.fontBoundingBoxAscent==null||n.fontBoundingBoxDescent==null){n={width:n.width};const{ascent:e,descent:i}=this.measureTextBoundADscentEstimate(t);n.actualBoundingBoxAscent=e,n.actualBoundingBoxDescent=i,n.fontBoundingBoxAscent=e,n.fontBoundingBoxDescent=i}if(n.actualBoundingBoxLeft==null||n.actualBoundingBoxRight==null){n={width:n.width,actualBoundingBoxAscent:n.actualBoundingBoxAscent,actualBoundingBoxDescent:n.actualBoundingBoxDescent,fontBoundingBoxAscent:n.fontBoundingBoxAscent,fontBoundingBoxDescent:n.fontBoundingBoxDescent};const{left:e,right:i}=this.measureTextBoundLeftRightEstimate(t);n.actualBoundingBoxLeft=e,n.actualBoundingBoxRight=i}return n}estimate(n,{fontSize:t=rI.fontSize}){let e=0,i=0;for(let r=0;r<n.length;r++)n.charCodeAt(r)<128?e++:i++;return{width:~~(.8*e*t+i*t),height:t}}measureTextWidth(n,t,e){return this.context?(e=e??this._measureTextWithoutAlignBaseline(n,t)).width:this.estimate(n,t).width}measureTextBoundsWidth(n,t,e){return this.context?(e=e??this._measureTextWithoutAlignBaseline(n,t)).width:this.estimate(n,t).width}measureTextBoundsLeftRight(n,t,e){return this.context?{left:(e=e??this._measureTextWithAlignBaseline(n,t,!0)).actualBoundingBoxLeft,right:e.actualBoundingBoxRight}:this.measureTextBoundLeftRightEstimate(t)}measureTextPixelHeight(n,t,e){var i;return this.context?(e=e??this._measureTextWithoutAlignBaseline(n,t,!0),Math.abs(e.actualBoundingBoxAscent-e.actualBoundingBoxDescent)):(i=t.fontSize)!==null&&i!==void 0?i:zn.fontSize}measureTextPixelADscent(n,t,e){return this.context?{ascent:(e=e??this._measureTextWithAlignBaseline(n,t,!0)).actualBoundingBoxAscent,descent:e.actualBoundingBoxDescent}:this.measureTextBoundADscentEstimate(t)}measureTextBoundHieght(n,t,e){var i;return this.context?(e=e??this._measureTextWithoutAlignBaseline(n,t,!0),Math.abs(e.fontBoundingBoxAscent-e.fontBoundingBoxDescent)):(i=t.fontSize)!==null&&i!==void 0?i:zn.fontSize}measureTextBoundADscent(n,t,e){return this.context?{ascent:(e=e??this._measureTextWithAlignBaseline(n,t,!0)).fontBoundingBoxAscent,descent:e.fontBoundingBoxDescent}:this.measureTextBoundADscentEstimate(t)}measureTextBoundADscentEstimate(n){var t;const e=(t=n.fontSize)!==null&&t!==void 0?t:zn.fontSize;return{ascent:.79*e,descent:.21*e}}measureTextBoundLeftRightEstimate(n){var t;const e=(t=n.fontSize)!==null&&t!==void 0?t:zn.fontSize,{textAlign:i}=n;return i==="center"?{left:e/2,right:e/2}:i==="right"||i==="end"?{left:e,right:0}:{left:0,right:e}}measureTextPixelADscentAndWidth(n,t,e){if(!this.context)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(t)),{width:this.estimate(n,t).width});const i=this._measureTextWithoutAlignBaseline(n,t,!0);if(e===Cl.actualBounding)return{ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,width:i.width};if(e===Cl.estimate)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(t)),{width:i.width});if(e===Cl.fontBounding){let r=i.fontBoundingBoxAscent,o=i.fontBoundingBoxDescent;if(i.actualBoundingBoxDescent&&o<i.actualBoundingBoxDescent){const s=i.actualBoundingBoxDescent-o;o+=s,r-=s}else if(i.actualBoundingBoxAscent&&r<i.actualBoundingBoxAscent){const s=i.actualBoundingBoxAscent-r;r+=s,o-=s}return{ascent:r,descent:o,width:i.width}}return{ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,width:i.width}}measureText(n,t){return this.context?(this.context.setTextStyleWithoutAlignBaseline(t),this.context.measureText(n)):this.estimate(n,t)}clipTextVertical(n,t,e,i){if(n.length===0)return{verticalList:n,width:0};const{fontSize:r=12}=t;n.forEach((l=>{l.width=l.direction===0?r:this.measureTextWidth(l.text,t)}));const o=[];let s=0,a=0;for(;a<n.length&&s+n[a].width<e;a++)s+=n[a].width,o.push(n[a]);if(n[a]&&n[a].text.length>1){const l=this._clipText(n[a].text,t,e-s,0,n[a].text.length-1,"end",!1);if(i&&l.str!==n[a].text){let h="",u=0;for(let g=0;g<a;g++){const f=n[g];h+=f.text,u+=f.text.length}h+=n[a].text;const d=u+l.str.length;let c=Nf(h,d);c-=u,c!==l.str.length-1&&(l.str=l.str.substring(0,c),l.width=this.measureTextWidth(l.str,t))}o.push(Object.assign(Object.assign({},n[a]),{text:l.str,width:l.width})),s+=l.width}return{verticalList:o,width:s}}clipText(n,t,e,i,r){if(n.length===0)return{str:"",width:0};let o=this.measureTextWidth(n,t);if(o<=e)return{str:n,width:o};if(o=this.measureTextWidth(n[0],t),o>e)return{str:"",width:0};const s=this._clipText(n,t,e,0,n.length-1,"end",!1);if(i&&s.str!==n){let a=Nf(n,s.str.length,r);a!==s.str.length&&(a>s.str.length&&(s.wordBreaked=a,a=s.str.length),s.str=n.substring(0,a),s.width=this.measureTextWidth(s.str,t))}return s}_clipText(n,t,e,i,r,o,s){let a;if(o==="start")a=this._clipTextStart(n,t,e,i,r),s&&(a.result=s+a.str);else if(o==="middle"){const l=this._clipTextMiddle(n,t,e,"","",0,0,1);a={str:"none",width:l.width,result:l.left+s+l.right}}else a=this._clipTextEnd(n,t,e,i,r),s&&(a.result=a.str+s);return a}_clipTextEnd(n,t,e,i,r){if(i===r){Hn.getInstance().warn(`【_clipTextEnd】不应该走到这里${n}, ${i}, ${r}`);const h=n.substring(0,r+1);return{str:h,width:this.measureTextWidth(h,t)}}const o=Math.floor((i+r)/2),s=n.substring(0,o+1),a=this.measureTextWidth(s,t);let l;if(a>e){if(s.length<=1)return{str:"",width:0};const h=n.substring(0,o);return l=this.measureTextWidth(h,t),l<=e?{str:h,width:l}:this._clipTextEnd(n,t,e,i,o)}if(a<e){if(o>=n.length-1)return{str:n,width:this.measureTextWidth(n,t)};const h=n.substring(0,o+2);return l=this.measureTextWidth(h,t),l>=e?{str:s,width:a}:this._clipTextEnd(n,t,e,o,r)}return{str:s,width:a}}_clipTextStart(n,t,e,i,r){const o=Math.ceil((i+r)/2),s=n.substring(o-1,n.length),a=this.measureTextWidth(s,t);let l;if(a>e){if(s.length<=1)return{str:"",width:0};const h=n.substring(o,n.length);return l=this.measureTextWidth(h,t),l<=e?{str:h,width:l}:this._clipTextStart(n,t,e,o,n.length)}if(a<e){if(o<=0)return{str:n,width:this.measureTextWidth(n,t)};const h=n.substring(o-2,n.length);return l=this.measureTextWidth(h,t),l>=e?{str:s,width:a}:this._clipTextStart(n,t,e,i,o)}return{str:s,width:a}}_clipTextMiddle(n,t,e,i,r,o,s,a){const l=n.substring(0,a),h=this.measureTextWidth(l,t);if(h+s>e)return{left:i,right:r,width:o+s};const u=n.substring(n.length-a,n.length),d=this.measureTextWidth(u,t);return h+d>e?{left:l,right:r,width:h+s}:this._clipTextMiddle(n,t,e,l,u,h,d,a+1)}clipTextWithSuffixVertical(n,t,e,i,r,o){if(i==="")return this.clipTextVertical(n,t,e,r);if(n.length===0)return{verticalList:n,width:0};const s=this.clipTextVertical(n,t,e,r);if(s.verticalList.length===n.length&&s.verticalList[s.verticalList.length-1].width===n[n.length-1].width)return s;const a=this.measureTextWidth(i,t);if(a>e)return s;let l;if(e-=a,o==="start"){const h=this.revertVerticalList(n);l=this.clipTextVertical(h,t,e,r);const u=this.revertVerticalList(l.verticalList);u.unshift({text:i,direction:1,width:a}),l.verticalList=u}else if(o==="middle"){const h=this.clipTextVertical(n,t,e/2,r),u=this.revertVerticalList(n),d=this.clipTextVertical(u,t,e/2,r);h.verticalList.push({text:i,direction:1,width:a}),this.revertVerticalList(d.verticalList).forEach((c=>h.verticalList.push(c))),l={verticalList:h.verticalList,width:h.width+d.width}}else l=this.clipTextVertical(n,t,e,r),l.verticalList.push({text:i,direction:1,width:a});return l.width+=a,l}revertVerticalList(n){return n.reverse().map((t=>{const e=t.text.split("").reverse().join("");return Object.assign(Object.assign({},t),{text:e})}))}clipTextWithSuffix(n,t,e,i,r,o,s=!1){if(i==="")return this.clipText(n,t,e,r);if(n.length===0)return{str:"",width:0};const a=this.measureTextWidth(n,t);if(!s&&a<=e)return{str:n,width:a};const l=this.measureTextWidth(i,t);if(l>e)return{str:"",width:0};if(s&&a+l<=e)return{str:n+i,width:a+l};e-=l;const h=this._clipText(n,t,e,0,n.length-1,o,i);if(r&&h.str!==n){const u=Nf(n,h.str.length);u!==h.str.length&&(h.result=n.substring(0,u),h.width=this.measureTextWidth(h.str,t))}else s&&h.str===n&&(h.result=n+i);return h.str=h.result,h.width+=l,h}};T_=P$([pt()],T_);var E$=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};const ws=Symbol.for("TextMeasureContribution");let mu=class extends T_{constructor(){super(...arguments),this.id="DefaultTextMeasureContribution"}};mu=E$([pt()],mu);const lI=Symbol.for("CanvasFactory"),L$=Symbol.for("Context2dFactory");function R_(n){return Et.getNamed(lI,mt.global.env)(n)}const hI=1e-4,hM=Math.sqrt(3),Ug=1/3;function ea(n){return n>-Sc&&n<Sc}function uI(n){return n>Sc||n<-Sc}const Mo=[0,0],Tr=[0,0],Bh=[0,0];function kh(n,t){return(n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])}function ds(n,t,e,i){const r=1-i;return r*(r*n+2*i*t)+i*i*e}function cs(n,t,e,i,r){const o=1-r;return o*o*(o*n+3*r*t)+r*r*(r*i+3*o*e)}function O$(n,t,e,i,r){const o=n-2*t+e,s=2*(t-n),a=n-i;let l=0;if(ea(o)){if(uI(s)){const h=-a/s;h>=0&&h<=1&&(r[l++]=h)}}else{const h=s*s-4*o*a;if(ea(h)){const u=-s/(2*o);u>=0&&u<=1&&(r[l++]=u)}else if(h>0){const u=Math.sqrt(h),d=(-s+u)/(2*o),c=(-s-u)/(2*o);d>=0&&d<=1&&(r[l++]=d),c>=0&&c<=1&&(r[l++]=c)}}return l}function I$(n,t,e){const i=n+e-2*t;return i===0?.5:(n-t)/i}function H$(n,t,e,i,r,o,s,a,l){let h=0,u=.005,d=1/0;Mo[0]=s,Mo[1]=a;for(let c=0;c<1;c+=.05){Tr[0]=ds(n,e,r,c),Tr[1]=ds(t,i,o,c);const g=kh(Mo,Tr);g<d&&(h=c,d=g)}d=1/0;for(let c=0;c<32&&!(u<hI);c++){const g=h-u,f=h+u;Tr[0]=ds(n,e,r,g),Tr[1]=ds(t,i,o,g);const p=kh(Tr,Mo);if(g>=0&&p<d)h=g,d=p;else{Bh[0]=ds(n,e,r,f),Bh[1]=ds(t,i,o,f);const m=kh(Bh,Mo);f<=1&&m<d?(h=f,d=m):u*=.5}}return Math.sqrt(d)}function D$(n,t,e,i,r,o,s,a,l,h,u){let d,c,g,f,p=0,m=.005,v=1/0;Mo[0]=l,Mo[1]=h;for(let b=0;b<1;b+=.05)Tr[0]=cs(n,e,r,s,b),Tr[1]=cs(t,i,o,a,b),g=kh(Mo,Tr),g<v&&(p=b,v=g);v=1/0;for(let b=0;b<32&&!(m<hI);b++)d=p-m,c=p+m,Tr[0]=cs(n,e,r,s,d),Tr[1]=cs(t,i,o,a,d),g=kh(Tr,Mo),d>=0&&g<v?(p=d,v=g):(Bh[0]=cs(n,e,r,s,c),Bh[1]=cs(t,i,o,a,c),f=kh(Bh,Mo),c<=1&&f<v?(p=c,v=f):m*=.5);return Math.sqrt(v)}function Xg(n){return(n%=zt)<0&&(n+=zt),n}function F$(n,t,e,i,r,o,s,a,l){if(s===0)return!1;const h=s;return l>t+h&&l>i+h&&l>o+h||l<t-h&&l<i-h&&l<o-h||a>n+h&&a>e+h&&a>r+h||a<n-h&&a<e-h&&a<r-h?!1:H$(n,t,e,i,r,o,a,l)<=h/2}function z$(n,t,e,i,r,o,s,a,l,h,u){if(l===0)return!1;const d=l;return u>t+d&&u>i+d&&u>o+d&&u>a+d||u<t-d&&u<i-d&&u<o-d&&u<a-d||h>n+d&&h>e+d&&h>r+d&&h>s+d||h<n-d&&h<e-d&&h<r-d&&h<s-d?!1:D$(n,t,e,i,r,o,s,a,h,u)<=d/2}function N$(n,t,e,i,r,o,s,a,l){if(s===0)return!1;const h=s;a-=n,l-=t;const u=Math.sqrt(a*a+l*l);if(u-h>e||u+h<e)return!1;if(Math.abs(i-r)%zt<1e-4)return!0;if(o){const c=i;i=Xg(r),r=Xg(c)}else i=Xg(i),r=Xg(r);i>r&&(r+=zt);let d=Math.atan2(l,a);return d<0&&(d+=zt),d>=i&&d<=r||d+zt>=i&&d+zt<=r}function Jl(n,t,e,i,r,o,s){if(r===0)return!1;const a=r,l=r/2;let h=0,u=n;if(s>t+l&&s>i+l||s<t-l&&s<i-l||o>n+l&&o>e+l||o<n-l&&o<e-l)return!1;if(n===e)return Math.abs(o-n)<=a/2;h=(t-i)/(n-e),u=(n*i-e*t)/(n-e);const d=h*o-s+u;return d*d/(h*h+1)<=a/2*a/2}const Sc=1e-4;function W$(n,t,e,i,r,o){const s=i+3*(t-e)-n,a=3*(e-2*t+n),l=3*(t-n),h=n-r,u=a*a-3*s*l,d=a*l-9*s*h,c=l*l-3*a*h;let g=0;if(ea(u)&&ea(d))if(ea(a))o[0]=0;else{const f=-l/a;f>=0&&f<=1&&(o[g++]=f)}else{const f=d*d-4*u*c;if(ea(f)){const p=d/u,m=-a/s+p,v=-p/2;m>=0&&m<=1&&(o[g++]=m),v>=0&&v<=1&&(o[g++]=v)}else if(f>0){const p=Math.sqrt(f);let m=u*a+1.5*s*(-d+p),v=u*a+1.5*s*(-d-p);m=m<0?-Math.pow(-m,Ug):Math.pow(m,Ug),v=v<0?-Math.pow(-v,Ug):Math.pow(v,Ug);const b=(-a-(m+v))/(3*s);b>=0&&b<=1&&(o[g++]=b)}else{const p=(2*u*a-3*s*d)/(2*Math.sqrt(u*u*u)),m=Math.acos(p)/3,v=Math.sqrt(u),b=Math.cos(m),y=(-a-2*v*b)/(3*s),C=(-a+v*(b+hM*Math.sin(m)))/(3*s),w=(-a+v*(b-hM*Math.sin(m)))/(3*s);y>=0&&y<=1&&(o[g++]=y),C>=0&&C<=1&&(o[g++]=C),w>=0&&w<=1&&(o[g++]=w)}}return g}function j$(n,t,e,i,r){const o=6*e-12*t+6*n,s=9*t+3*i-3*n-9*e,a=3*t-3*n;let l=0;if(ea(s)){if(uI(o)){const h=-a/o;h>=0&&h<=1&&(r[l++]=h)}}else{const h=o*o-4*s*a;if(ea(h))r[0]=-o/(2*s);else if(h>0){const u=Math.sqrt(h),d=(-o+u)/(2*s),c=(-o-u)/(2*s);d>=0&&d<=1&&(r[l++]=d),c>=0&&c<=1&&(r[l++]=c)}}return l}function V$(n,t){return Math.abs(n-t)<Sc}const Rn=[-1,-1,-1],Cr=[-1,-1];function G$(){const n=Cr[0];Cr[0]=Cr[1],Cr[1]=n}function $$(n,t,e,i,r,o,s,a,l,h){if(h>t&&h>i&&h>o&&h>a||h<t&&h<i&&h<o&&h<a)return 0;const u=W$(t,i,o,a,h,Rn);if(u===0)return 0;let d=0,c=-1,g=0,f=0;for(let p=0;p<u;p++){const m=Rn[p],v=m===0||m===1?.5:1;cs(n,e,r,s,m)<l||(c<0&&(c=j$(t,i,o,a,Cr),Cr[1]<Cr[0]&&c>1&&G$(),g=cs(t,i,o,a,Cr[0]),c>1&&(f=cs(t,i,o,a,Cr[1]))),c===2?m<Cr[0]?d+=g<t?v:-v:m<Cr[1]?d+=f<g?v:-v:d+=a<f?v:-v:m<Cr[0]?d+=g<t?v:-v:d+=a<g?v:-v)}return d}function U$(n,t,e,i,r,o,s,a){if(a>t&&a>i&&a>o||a<t&&a<i&&a<o)return 0;const l=O$(t,i,o,a,Rn);if(l===0)return 0;const h=I$(t,i,o);if(h>=0&&h<=1){let d=0;const c=ds(t,i,o,h);for(let g=0;g<l;g++){const f=Rn[g]===0||Rn[g]===1?.5:1;ds(n,e,r,Rn[g])<s||(Rn[g]<h?d+=c<t?f:-f:d+=o<c?f:-f)}return d}const u=Rn[0]===0||Rn[0]===1?.5:1;return ds(n,e,r,Rn[0])<s?0:o<t?u:-u}function X$(n,t,e,i,r,o,s,a){if((a-=t)>e||a<-e)return 0;const l=Math.sqrt(e*e-a*a);Rn[0]=-l,Rn[1]=l;const h=Math.abs(i-r);if(h<1e-4)return 0;if(h>=zt-1e-4){i=0,r=zt;const d=o?1:-1;return s>=Rn[0]+n&&s<=Rn[1]+n?d:0}if(i>r){const d=i;i=r,r=d}i<0&&(i+=zt,r+=zt);let u=0;for(let d=0;d<2;d++){const c=Rn[d];if(c+n>s){let g=Math.atan2(a,c),f=o?1:-1;g<0&&(g=zt+g),(g>=i&&g<=r||g+zt>=i&&g+zt<=r)&&(g>si/2&&g<1.5*si&&(f=-f),u+=f)}}return u}function Zb(n){return Math.round(n/si*1e8)/1e8%2*si}function Y$(n,t){let e=Zb(n[0]);e<0&&(e+=zt);const i=e-n[0];let r=n[1];r+=i,!t&&r-e>=zt?r=e+zt:t&&e-r>=zt?r=e-zt:!t&&e>r?r=e+(zt-Zb(e-r)):t&&e<r&&(r=e-(zt-Zb(r-e))),n[0]=e,n[1]=r}const qu=[0,0];function dI(n,t,e,i,r){const o=n,s=n.length;let a,l,h=0,u=0,d=0,c=0,g=0;for(let f=0;f<s;f++){const p=o[f],m=f===0;p[0]===Yt.M&&f>1&&(e||(h+=Pa(u,d,c,g,i,r))),m&&(u=p[1],d=p[2],c=u,g=d);const v=p[0],b=p[1],y=p[2],C=p[3],w=p[4],_=p[5],A=p[6];let x=w,S=_;qu[0]=x,qu[1]=S,Y$(qu,!!p[6]),x=qu[0],S=qu[1];const T=x,M=S-x,R=!!(1-(p[6]?0:1)),E=(i-b)*C/C+b;switch(v){case Yt.M:c=b,g=y,u=c,d=g;break;case Yt.L:if(e){if(Jl(u,d,b,y,t,i,r))return!0}else h+=Pa(u,d,b,y,i,r)||0;u=b,d=y;break;case Yt.C:if(e){if(z$(u,d,b,y,C,w,_,A,t,i,r))return!0}else h+=$$(u,d,b,y,C,w,_,A,i,r)||0;u=_,d=A;break;case Yt.Q:if(e){if(F$(u,d,b,y,C,w,t,i,r))return!0}else h+=U$(u,d,b,y,C,w,i,r)||0;u=C,d=w;break;case Yt.A:if(a=Math.cos(T)*C+b,l=Math.sin(T)*C+y,m?(c=a,g=l):h+=Pa(u,d,a,l,i,r),e){if(N$(b,y,C,T,T+M,R,t,E,r))return!0}else h+=X$(b,y,C,T,T+M,R,E,r);u=Math.cos(T+M)*C+b,d=Math.sin(T+M)*C+y;break;case Yt.R:if(c=u=b,g=d=y,a=c+C,l=g+w,e){if(Jl(c,g,a,g,t,i,r)||Jl(a,g,a,l,t,i,r)||Jl(a,l,c,l,t,i,r)||Jl(c,l,c,g,t,i,r))return!0}else h+=Pa(a,g,a,l,i,r),h+=Pa(c,l,c,g,i,r);break;case Yt.Z:if(e){if(Jl(u,d,c,g,t,i,r))return!0}else h+=Pa(u,d,c,g,i,r);u=c,d=g}}return e||V$(d,g)||(h+=Pa(u,d,c,g,i,r)||0),h!==0}function q$(n,t,e){return dI(n,0,!1,t,e)}function K$(n,t,e,i){return dI(n,t,!0,e,i)}class Z${constructor(){this.pools=[],this.allocatedCanvas=[]}shareCanvas(){return this.allocatedCanvas.length?this.allocatedCanvas[0]:this.getCommonCanvas()}getCommonCanvas(){return this._commonCanvas||(this._commonCanvas=this.allocate({width:100,height:100,dpr:2})),this._commonCanvas}allocate(t){if(!this.pools.length){const i=R_(Object.assign({nativeCanvas:mt.global.createCanvas(t)},t));return this.allocatedCanvas.push(i),i}const e=this.pools.pop();return e.resize(t.width,t.height),e.dpr=t.dpr,e}allocateByObj(t){if(!this.pools.length){const i={width:t.width/t.dpr,height:t.height/t.dpr,dpr:t.dpr},r=R_(Object.assign({nativeCanvas:mt.global.createCanvas(i)},i));return this.allocatedCanvas.push(r),r}const e=this.pools.pop();return e.width=t.width,e.height=t.height,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}}const _l=new Z$;var J$=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},Q$=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};const Ac=Symbol.for("VWindow"),ax=Symbol.for("WindowHandlerContribution");let B_=class extends NO{get width(){if(this._handler){const n=this._handler.getWH();return this._width=n.width}return this._width}get height(){if(this._handler){const n=this._handler.getWH();return this._height=n.height}return this._height}get dpr(){return this._handler.getDpr()}constructor(){super(),this.hooks={onChange:new yn(["x","y","width","height"])},this.active=()=>{const n=this.global;!n.env||this.actived||(Et.getNamed(ax,n.env).configure(this,n),this.actived=!0)},this._uid=Ci.GenAutoIncrementId(),this.global=mt.global,this.postInit()}_nativeAddEventListener(n,t,e){return this._handler.addEventListener(n,t,e)}_nativeRemoveEventListener(n,t,e){return this._handler.removeEventListener(n,t,e)}_nativeDispatchEvent(n){return this._handler.dispatchEvent(n)}postInit(){this.global.hooks.onSetEnv.tap("window",this.active),this.active()}get style(){var n;return(n=this._handler.getStyle())!==null&&n!==void 0?n:{}}set style(n){this._handler.setStyle(n)}create(n){var t,e;this._handler.createWindow(n);const i=this._handler.getWH();this._width=i.width,this._height=i.height,n.viewBox?this.setViewBox(n.viewBox):n.canvasControled!==!1?this.setViewBox({x1:0,y1:0,x2:this._width,y2:this._height}):this.setViewBox({x1:0,y1:0,x2:(t=n.width)!==null&&t!==void 0?t:this._width,y2:(e=n.height)!==null&&e!==void 0?e:this._height}),this.title=this._handler.getTitle(),this.resizable=!0}setWindowHandler(n){this._handler=n}setDpr(n){return this._handler.setDpr(n)}resize(n,t){return this._handler.resizeWindow(n,t)}configure(){throw new Error("暂不支持")}release(){return this.global.hooks.onSetEnv.unTap("window",this.active),this.clearAllEventListeners(),this._handler.releaseWindow()}getContext(){return this._handler.getContext()}getNativeHandler(){return this._handler.getNativeHandler()}getImageBuffer(n){return this._handler.getImageBuffer?this._handler.getImageBuffer(n):null}getBoundingClientRect(){return this._handler.getBoundingClientRect()}getContainer(){return this._handler.container}clearViewBox(n){this._handler.clearViewBox(n)}setViewBox(n){this._handler.setViewBox(n)}setViewBoxTransform(n,t,e,i,r,o){this._handler.setViewBoxTransform(n,t,e,i,r,o)}getViewBox(){return this._handler.getViewBox()}getViewBoxTransform(){return this._handler.getViewBoxTransform()}pointTransform(n,t){const e=this._handler.getViewBox(),i={x:n,y:t};return this._handler.getViewBoxTransform().transformPoint({x:n,y:t},i),i.x-=e.x1,i.y-=e.y1,i}hasSubView(){const n=this._handler.getViewBox();return!(n.x1===0&&n.y1===0&&jA(this.width,n.width())&&jA(this.height,n.height()))}isVisible(n){return this._handler.isVisible(n)}onVisibleChange(n){return this._handler.onVisibleChange(n)}getTopLeft(n){return this._handler.getTopLeft(n)}};B_=J$([pt(),Q$("design:paramtypes",[])],B_);var cI=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},gI=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},uM=function(n,t){return function(e,i){t(e,i,n)}};let k_=class{get canvas(){return this.tryInitCanvas(),this._canvas}get context(){return this.tryInitCanvas(),this._context}constructor(n){this.contributions=n,this.configured=!1,this.global=mt.global,this._textMeasureMap=new Map,this.global.hooks.onSetEnv.tap("graphic-util",((t,e,i)=>{this.configured=!1,this.configure(i,e)}))}get textMeasure(){return this._textMeasure||this.configure(this.global,this.global.env),this._textMeasure}getTextMeasureInstance(n){return n?this._textMeasureMap.get(n)||this.textMeasure:this.textMeasure}configure(n,t){this.configured||(this.contributions.getContributions().forEach((e=>{e.configure(this,t)})),this.configured=!0)}tryInitCanvas(){if(!this._canvas){const n=_l.shareCanvas();this._canvas=n,this._context=n.getContext("2d")}}bindTextMeasure(n){this._textMeasure&&n.id!=="DefaultTextMeasureContribution"||(this._textMeasure=n),this._textMeasureMap.has(n.id)||this._textMeasureMap.set(n.id,n)}measureText(n,t,e="native"){var i;this.configure(this.global,this.global.env);const r=this.global.measureTextMethod;this.global.measureTextMethod=e;const o={width:this._textMeasure.measureTextWidth(n,t),height:(i=t.fontSize)!==null&&i!==void 0?i:zn.fontSize};return this.global.measureTextMethod=r,o}createTextMeasureInstance(n,t,e){return this.configure(this.global,this.global.env),new Rh(Object.assign({defaultFontParams:{fontFamily:zn.fontFamily,fontSize:zn.fontSize},getCanvasForMeasure:e||(()=>this.canvas),getTextBounds:void 0,specialCharSet:`-/: .,@%'"~`+Rh.ALPHABET_CHAR_SET+Rh.ALPHABET_CHAR_SET.toUpperCase()},t??{}),n)}drawGraphicToCanvas(n,t,e){if(!t.defaultLayer)return null;const i=Et.get(Ac),r=n.AABBBounds,o=r.width(),s=r.height(),a=-r.x1,l=-r.y1;i.create({viewBox:{x1:a,y1:l,x2:r.x2,y2:r.y2},width:o,height:s,canvas:e,dpr:t.window.dpr,canvasControled:!0,offscreen:!0,title:""});const h=t.params.optimize.disableCheckGraphicWidthOutRange;t.params.optimize.disableCheckGraphicWidthOutRange=!0,t.defaultLayer.getNativeHandler().drawTo(i,[n],{transMatrix:i.getViewBoxTransform(),viewBox:i.getViewBox(),stage:t,layer:t.defaultLayer,renderService:t.renderService,background:"transparent",clear:!0,updateBounds:!1}),t.params.optimize.disableCheckGraphicWidthOutRange=h;const u=i.getNativeHandler();return u.nativeCanvas?u.nativeCanvas:null}};k_=cI([pt(),uM(0,Xt(li)),uM(0,Li(ws)),gI("design:paramtypes",[Object])],k_);var Us;(function(n){n[n.transform=0]="transform",n[n.matrix=1]="matrix"})(Us||(Us={}));const wi=new wn;let P_=class{constructor(){this.matrix=new wn}init(n){return this.mode=Us.transform,this.originTransform=n,this.matrix.reset(),this}fromMatrix(n,t){return this.mode=Us.matrix,this.outSourceMatrix=n,this.outTargetMatrix=t,this}scaleMatrix(n,t,e){const i=this.outSourceMatrix;if(wi.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),e){const{x:r,y:o}=e;this.outTargetMatrix.translate(r,o),this.outTargetMatrix.scale(n,t),this.outTargetMatrix.translate(-r,-o)}else this.outTargetMatrix.scale(n,t);return this.outTargetMatrix.multiply(wi.a,wi.b,wi.c,wi.d,wi.e,wi.f),this}rotateMatrix(n,t){const e=this.outSourceMatrix;if(wi.setValue(e.a,e.b,e.c,e.d,e.e,e.f),this.outTargetMatrix.reset(),t){const{x:i,y:r}=t;this.outTargetMatrix.translate(i,r),this.outTargetMatrix.rotate(n),this.outTargetMatrix.translate(-i,-r)}else this.outTargetMatrix.rotate(n);return this.outTargetMatrix.multiply(wi.a,wi.b,wi.c,wi.d,wi.e,wi.f),this}scale(n,t,e){return this.mode===Us.matrix?this.scaleMatrix(n,t,e):this}rotate(n,t){return this.mode===Us.matrix?this.rotateMatrix(n,t):this}translateMatrix(n,t){const e=this.outSourceMatrix;return wi.setValue(e.a,e.b,e.c,e.d,e.e,e.f),this.outTargetMatrix.reset(),this.outTargetMatrix.translate(n,t),this.outTargetMatrix.multiply(wi.a,wi.b,wi.c,wi.d,wi.e,wi.f),this}translate(n,t){return this.mode===Us.matrix?this.translateMatrix(n,t):this}simplify(n){return this.mode===Us.matrix?this.simplifyMatrix(n):this}simplifyMatrix(n){return this}};P_=cI([pt(),gI("design:paramtypes",[])],P_);const mn={arc:d$,area:c$,circle:g$,line:m$,path:v$,symbol:_$,text:rI,rect:C$,polygon:b$,star:y$,richtext:as,richtextIcon:w$,image:xc,group:f$,glyph:p$},Jb=Object.keys(mn);function tU(){return{arc:Object.assign({},mn.arc),area:Object.assign({},mn.area),circle:Object.assign({},mn.circle),line:Object.assign({},mn.line),path:Object.assign({},mn.path),symbol:Object.assign({},mn.symbol),text:Object.assign({},mn.text),rect:Object.assign({},mn.rect),polygon:Object.assign({},mn.polygon),star:Object.assign({},mn.star),richtext:Object.assign({},mn.richtext),richtextIcon:Object.assign({},mn.richtextIcon),image:Object.assign({},mn.image),group:Object.assign({},mn.group),glyph:Object.assign({},mn.glyph)}}function Yg(n,t){Object.keys(t).forEach((e=>{n[e]=t[e]}))}const dM=tU();class Mc{constructor(){this.initTheme(),this.dirty=!1}initTheme(){this._defaultTheme={},Jb.forEach((t=>{this._defaultTheme[t]=Object.create(dM[t])})),this.combinedTheme=this._defaultTheme}getTheme(t){if(!t)return this.combinedTheme;if(!this.dirty)return this.combinedTheme;let e={};const i=this.getParentWithTheme(t);return i&&(e=i.theme),this.applyTheme(t,e),this.combinedTheme}getParentWithTheme(t){for(;t.parent;)if((t=t.parent).theme)return t;return null}applyTheme(t,e,i=!1){if(this.dirty){const r=this.getParentWithTheme(t);if(r){const o=r.theme;(o.dirty||i)&&o.applyTheme(r,e,!0)}this.userTheme?this.doCombine(r&&r.theme.combinedTheme):(r?this.combinedTheme=r.theme.combinedTheme:(this.combinedTheme=this._defaultTheme,Hn.getInstance().warn("未知错误，走到不应该走的区域里")),this.dirty=!1)}return this.combinedTheme}doCombine(t){const e=this.userTheme,i=this.combinedTheme;Jb.forEach((r=>{const o=Object.create(dM[r]);t&&t[r]&&Yg(o,t[r]),i[r]&&Yg(o,i[r]),e[r]&&Yg(o,e[r]),this.combinedTheme[r]=o})),e.common&&Jb.forEach((r=>{Yg(this.combinedTheme[r],e.common)})),this.dirty=!1}setTheme(t,e){let i=this.userTheme;i?Object.keys(t).forEach((r=>{i[r]?Object.assign(i[r],t[r]):i[r]=Object.assign({},t[r])})):i=t,this.userTheme=i,this.dirty=!0,this.dirtyChildren(e)}resetTheme(t,e){this.userTheme=t,this.dirty=!0,this.dirtyChildren(e)}dirtyChildren(t){t.forEachChildren((e=>{e.isContainer&&(e.theme&&(e.theme.dirty=!0),this.dirtyChildren(e))}))}}const fI=new Mc;function Wt(n,t){return n.glyphHost?Wt(n.glyphHost):t?(n.isContainer,t):eU(n)||n.attachedThemeGraphic&&Wt(n.attachedThemeGraphic)||fI.getTheme()}function eU(n){let t;if(t=n.isContainer?n:n.parent,t){for(;t&&!t.theme;)t=t.parent;return t?(t.theme||t.createTheme(),t.theme.getTheme(t)):fI.getTheme()}return null}var iU=function(n,t,e,i){return new(e||(e=Promise))((function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e((function(d){d(u)}))).then(s,a)}l((i=i.apply(n,t||[])).next())}))};let nU=class extends Gl{get previousSibling(){return this._prev}get nextSibling(){return this._next}get children(){return this.getChildren()}get firstChild(){return this._firstChild}get lastChild(){return this._lastChild}get count(){return this._count}get childrenCount(){return this._idMap?this._idMap.size:0}constructor(){super(),this._uid=Ci.GenAutoIncrementId(),this._firstChild=null,this._lastChild=null,this.parent=null,this._count=1}forEachChildren(t,e=!1){if(e){let i=this._lastChild,r=0;for(;i;){if(t(i,r++))return;i=i._prev}}else{let i=this._firstChild,r=0;for(;i;){if(t(i,r++))return;i=i._next}}}forEachChildrenAsync(t,e=!1){return iU(this,void 0,void 0,(function*(){if(e){let i=this._lastChild,r=0;for(;i;){let o=t(i,r++);if(o.then&&(o=yield o),o)return;i=i._prev}}else{let i=this._firstChild,r=0;for(;i;){let o=t(i,r++);if(o.then&&(o=yield o),o)return;i=i._next}}}))}forEach(t){return this.forEachChildren(t)}appendChild(t,e=!0){if(this._uid===t._uid)return null;if(!e&&t.isAncestorsOf(this))throw new Error("【Node::appendChild】不能将父辈元素append为子元素");return t.parent&&t.parent.removeChild(t),t.parent=this,this._lastChild?(this._lastChild._next=t,t._prev=this._lastChild,this._lastChild=t):(this._firstChild=this._lastChild=t,t._prev=t._next=null),this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this.setCount(t.count),this._structEdit=!0,t}appendChildArrHighPerformance(t,e=!1){return t}insertBefore(t,e){if(!e)return this.appendChild(t);if(this===t||t===e)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertBefore】不能将父辈元素insert为子元素");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,t._prev=e._prev,e._prev?e._prev._next=t:this._firstChild=t,e._prev=t,t._next=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertAfter(t,e){if(!e)return this.appendChild(t);if(this===t||t===e)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertAfter】不能将父辈元素insert为子元素");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,e._next?(e._next._prev=t,t._next=e._next):this._lastChild=t,e._next=t,t._prev=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertInto(t,e){if(!this._ignoreWarn&&this._nodeList&&Hn.getInstance().warn("insertIntoKeepIdx和insertInto混用可能会存在错误"),e>=this.childrenCount)return this.appendChild(t);if(this===t)return null;if(t.isAncestorsOf(this))throw new Error("【Node::insertBefore】不能将父辈元素insert为子元素");if(t.parent&&t.parent.removeChild(t),t.parent=this,e===0)t._next=this._firstChild,this._firstChild&&(this._firstChild._prev=t),t._prev=null,this._firstChild=t;else{let i=this._firstChild;for(let r=0;r<e;r++){if(!i)return null;r>0&&(i=i._next)}if(!i)return null;t._next=i._next,t._prev=i,i._next=t,t._next&&(t._next._prev=t)}return this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t}insertIntoKeepIdx(t,e){if(this._nodeList||(this._nodeList=this.children),this._nodeList[e]){const o=this._nodeList[e];return this._nodeList.splice(e,0,t),this.insertBefore(t,o)}let i;this._nodeList[e]=t;for(let o=e-1;o>=0&&(i=this._nodeList[o],!i);o--);if(i)return i._next?this.insertBefore(t,i._next):this.appendChild(t);this._ignoreWarn=!0;const r=this.insertInto(t,0);return this._ignoreWarn=!1,r}removeChild(t){if(!this._idMap||!this._idMap.has(t._uid))return null;if(this._idMap.delete(t._uid),this._nodeList){const e=this._nodeList.findIndex((i=>i===t));e>=0&&this._nodeList.splice(e,1)}return t._prev?t._prev._next=t._next:this._firstChild=t._next,t._next?t._next._prev=t._prev:this._lastChild=t._prev,t.parent=null,t._prev=null,t._next=null,this._structEdit=!0,this.setCount(-t.count),t}delete(){this.parent&&this.parent.removeChild(this)}removeAllChild(t){if(!this._idMap)return;this._nodeList&&(this._nodeList.length=0);let e=this._firstChild;for(;e;){const i=e._next;e.parent=null,e._prev=null,e._next=null,e=e._next,e=i}this._firstChild=null,this._lastChild=null,this._idMap.clear(),this._structEdit=!0,this.setCount(1-this._count)}replaceChild(t,e){throw new Error("暂不支持")}find(t,e=!1){let i=null;return this.forEachChildren(((r,o)=>!(r===this||!t(r,o))&&(i=r,!0))),e&&this.forEachChildren((r=>{if(r.isContainer){const o=r.find(t,!0);if(o)return i=o,!0}return!1})),i}findAll(t,e=!1){let i=[];return this.forEachChildren(((r,o)=>{r!==this&&t(r,o)&&i.push(r)})),e&&this.forEachChildren((r=>{if(r.isContainer){const o=r.findAll(t,!0);o.length&&(i=i.concat(o))}})),i}getElementById(t){return this.find((e=>e.id===t),!0)}findChildById(t){return this.getElementById(t)}findChildByUid(t){return this._idMap&&this._idMap.get(t)||null}getElementsByName(t){return this.findAll((e=>e.name===t),!0)}findChildrenByName(t){return this.getElementsByName(t)}getElementsByType(t){return this.findAll((e=>e.type===t),!0)}getChildByName(t,e=!1){return this.find((i=>i.name===t),e)}getChildAt(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<t;i++){if(!e._next)return null;e=e._next}return e}at(t){return this.getChildAt(t)}containNode(t){if(!this._idMap)return!1;if(this._idMap.has(t._uid))return!0;let e=this._firstChild;for(;e;){if(e.containNode(t))return!0;e=e._next}return!1}getRootNode(){let t=this.parent;for(;t?.parent;)t=t.parent;return t||this}hasChildNodes(){return this._firstChild!==null}addChild(t){return this.appendChild(t)}add(t){return this.appendChild(t)}getChildren(){const t=[];let e=this._firstChild;for(;e;)t.push(e),e=e._next;return t}isChildOf(t){return!!this.parent&&this.parent._uid===t._uid}isParentOf(t){return t.isChildOf(this)}isDescendantsOf(t){let e=this.parent;if(!e)return!1;do{if(e._uid===t._uid)return!0;e=e.parent}while(e!==null);return!1}isAncestorsOf(t){return t.isDescendantsOf(this)}getAncestor(t){throw new Error("暂不支持")}setAllDescendantsProps(t,e){let i=this._firstChild;for(;i;)i[t]=e,i.setAllDescendantsProps(t,e),i=i._next}setCount(t){this._count+=t;let e=this.parent;if(e)do e._count+=t,e=e.parent;while(e!==null)}clone(){throw new Error("暂不支持")}cloneTo(t){throw new Error("暂不支持")}getParent(){return this.parent}del(t){return this.removeChild(t)}addEventListener(t,e,i){const r=yc(i,!0)&&i||Ja(i)&&i.capture,o=Ja(i)&&i.once,s=sl(e)?void 0:e;return t=r?`${t}capture`:t,e=sl(e)?e:e.handleEvent,o?super.once(t,e,s):super.on(t,e,s),this}on(t,e,i){return this.addEventListener(t,e,i)}removeEventListener(t,e,i){const r=yc(i,!0)&&i||Ja(i)&&i.capture,o=sl(e)?void 0:e;t=r?`${t}capture`:t,e=sl(e)?e:e.handleEvent;const s=Ja(i)&&i.once;return super.off(t,e,o,s),this}off(t,e,i){return this.removeEventListener(t,e,i)}once(t,e,i){return Ja(i)?(i.once=!0,this.addEventListener(t,e,i)):this.addEventListener(t,e,{once:!0})}removeAllEventListeners(){return super.removeAllListeners(),this}removeAllListeners(){return this.removeAllEventListeners()}dispatchEvent(t,...e){return super.emit(t.type,t,...e),!t.defaultPrevented}emit(t,e){return this.dispatchEvent(t,e)}release(){this.removeAllListeners()}};class sg{get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get x(){return this.canvas.x}get y(){return this.canvas.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}get viewX(){return this.viewport.x}get viewY(){return this.viewport.y}constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=sg.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer={x:0,y:0},this.page={x:0,y:0},this.canvas={x:0,y:0},this.viewport={x:0,y:0},this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.composedDetailPath(),this.path}composedDetailPath(){return this.pickParams&&this.pickParams.graphic?(this.detailPath=this.path.slice(),this._composedDetailPath(this.pickParams)):this.detailPath=this.path.slice(),this.detailPath}_composedDetailPath(t){if(t&&t.graphic){const e=t.graphic;if(e.stage){const i=e.stage.eventSystem.manager.propagationPath(e);this.detailPath.push(i),this._composedDetailPath(t.params)}}}preventDefault(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault()}catch{this.nativeEvent.preventDefault&&sl(this.nativeEvent.preventDefault)&&this.nativeEvent.preventDefault()}this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.stopPropagation()}catch{this.nativeEvent.stopPropagation&&sl(this.nativeEvent.stopPropagation)&&this.nativeEvent.stopPropagation()}this.propagationStopped=!0}initEvent(){}initUIEvent(){}clone(){throw new Error("Method not implemented.")}}class Ep extends sg{constructor(){super(...arguments),this.client={x:0,y:0},this.movement={x:0,y:0},this.offset={x:0,y:0},this.global={x:0,y:0},this.screen={x:0,y:0}}get clientX(){return this.client.x}get clientY(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,r,o,s,a,l,h,u,d,c,g,f,p){throw new Error("Method not implemented.")}}class Kn extends Ep{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}clone(){var t,e,i;const r=new Kn(this.manager);r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.detailPath=[],r.target=null,r.nativeEvent=this.nativeEvent,r.originalEvent=this.originalEvent,(t=this.manager)===null||t===void 0||t.copyPointerData(this,r),(e=this.manager)===null||e===void 0||e.copyMouseData(this,r),(i=this.manager)===null||i===void 0||i.copyData(this,r),r.target=this.target,r.path=this.composedPath().slice();const o=this.composedDetailPath();return r.detailPath=o&&o.slice(),r.type=this.type,r}}class oa extends Ep{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}clone(){var t,e,i;const r=new oa(this.manager);r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.detailPath=[],r.target=null,r.nativeEvent=this.nativeEvent,r.originalEvent=this.originalEvent,(t=this.manager)===null||t===void 0||t.copyWheelData(this,r),(e=this.manager)===null||e===void 0||e.copyMouseData(this,r),(i=this.manager)===null||i===void 0||i.copyData(this,r),r.target=this.target,r.path=this.composedPath().slice();const o=this.composedDetailPath();return r.detailPath=o&&o.slice(),r.type=this.type,r}}oa.DOM_DELTA_PIXEL=0,oa.DOM_DELTA_LINE=1,oa.DOM_DELTA_PAGE=2;class lx extends sg{constructor(t,e){super(),this.type=t,this.detail=e}}const pI="*",ll=typeof performance=="object"&&performance.now?performance:Date;function Ds(n){return n==="mouse"||n==="pen"}let rU=class{constructor(t,e){this.dispatch=new Gl,this.cursorTarget=null,this.pauseNotify=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.onPointerDown=(i,r)=>{if(!(i instanceof Kn))return void Hn.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.createPointerEvent(i,i.type,r);if(this.dispatchEvent(o,"pointerdown"),o.pointerType==="touch")this.dispatchEvent(o,"touchstart");else if(Ds(o.pointerType)){const s=o.button===2;this.dispatchEvent(o,s?"rightdown":"mousedown")}this.trackingData(i.pointerId).pressTargetsByButton[i.button]=o.composedPath(),this.freeEvent(o)},this.onPointerMove=(i,r)=>{var o,s;if(!(i instanceof Kn))return void Hn.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const a=this.createPointerEvent(i,i.type,r),l=Ds(a.pointerType),h=this.trackingData(i.pointerId),u=this.findMountedTarget(h.overTargets);if(h.overTargets&&u&&u!==this.rootTarget&&u!==a.target){const d=i.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(i,d,u||void 0);if(this.dispatchEvent(c,"pointerout"),l&&this.dispatchEvent(c,"mouseout"),!a.composedPath().includes(u)){const g=this.createPointerEvent(i,"pointerleave",u||void 0);for(g.eventPhase=g.AT_TARGET;g.target&&!a.composedPath().includes(g.target);)g.currentTarget=g.target,this.notifyTarget(g),l&&this.notifyTarget(g,"mouseleave"),g.target=g.target.parent;this.freeEvent(g)}this.freeEvent(c)}if(u!==a.target){const d=i.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(a,d);this.dispatchEvent(c,"pointerover"),l&&this.dispatchEvent(c,"mouseover");let g=u?.parent;for(;g&&g!==this.rootTarget.parent&&g!==a.target;)g=g.parent;if(!g||g===this.rootTarget.parent){const f=this.clonePointerEvent(a,"pointerenter");f.eventPhase=f.AT_TARGET;let p=f.target;const m=new Set;let v=u;for(;v&&v!==this.rootTarget;)m.add(v),v=v.parent;for(;p&&p!==u&&p!==this.rootTarget.parent;)m.has(p)||(f.currentTarget=p,this.notifyTarget(f),l&&this.notifyTarget(f,"mouseenter")),p=p.parent;this.freeEvent(f)}this.freeEvent(c)}this.dispatchEvent(a,"pointermove"),a.pointerType==="touch"&&this.dispatchEvent(a,"touchmove"),l&&(this.dispatchEvent(a,"mousemove"),this.cursorTarget=a.target,this.cursor=((s=(o=a.target)===null||o===void 0?void 0:o.attribute)===null||s===void 0?void 0:s.cursor)||this.rootTarget.getCursor()),h.overTargets=a.composedPath(),this.freeEvent(a)},this.onPointerOver=(i,r)=>{var o,s;if(!(i instanceof Kn))return void Hn.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const a=this.trackingData(i.pointerId),l=this.createPointerEvent(i,i.type,r),h=Ds(l.pointerType);this.dispatchEvent(l,"pointerover"),h&&this.dispatchEvent(l,"mouseover"),l.pointerType==="mouse"&&(this.cursorTarget=l.target,this.cursor=((s=(o=l.target)===null||o===void 0?void 0:o.attribute)===null||s===void 0?void 0:s.cursor)||this.rootTarget.getCursor());const u=this.clonePointerEvent(l,"pointerenter");for(u.eventPhase=u.AT_TARGET;u.target&&u.target!==this.rootTarget.parent;)u.currentTarget=u.target,this.notifyTarget(u),h&&this.notifyTarget(u,"mouseenter"),u.target=u.target.parent;a.overTargets=l.composedPath(),this.freeEvent(l),this.freeEvent(u)},this.onPointerOut=(i,r)=>{if(!(i instanceof Kn))return void Hn.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.trackingData(i.pointerId);if(o.overTargets){const s=Ds(i.pointerType),a=this.findMountedTarget(o.overTargets),l=this.createPointerEvent(i,"pointerout",a||void 0);this.dispatchEvent(l),s&&this.dispatchEvent(l,"mouseout");const h=this.createPointerEvent(i,"pointerleave",a||void 0);for(h.eventPhase=h.AT_TARGET;h.target&&h.target!==this.rootTarget.parent;)h.currentTarget=h.target,this.notifyTarget(h),s&&this.notifyTarget(h,"mouseleave"),h.target=h.target.parent;o.overTargets=[],this.freeEvent(l),this.freeEvent(h)}this.cursorTarget=null,this.cursor=""},this.onPointerUp=(i,r)=>{var o;if(!(i instanceof Kn))return void Hn.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const s=ll.now(),a=this.createPointerEvent(i,i.type,r);if(this.dispatchEvent(a,"pointerup"),a.pointerType==="touch")this.dispatchEvent(a,"touchend");else if(Ds(a.pointerType)){const d=a.button===2;this.dispatchEvent(a,d?"rightup":"mouseup")}const l=this.trackingData(i.pointerId),h=this.findMountedTarget(l.pressTargetsByButton[i.button]);let u=h;if(h&&!a.composedPath().includes(h)){let d=h;for(;d&&!a.composedPath().includes(d);){if(a.currentTarget=d,this.notifyTarget(a,"pointerupoutside"),a.pointerType==="touch")this.notifyTarget(a,"touchendoutside");else if(Ds(a.pointerType)){const c=a.button===2;this.notifyTarget(a,c?"rightupoutside":"mouseupoutside")}d=d.parent}delete l.pressTargetsByButton[i.button],u=d}if(u){const d=this.clonePointerEvent(a,"click");d.target=u,d.path=[],d.detailPath=[],l.clicksByButton[i.button]||(l.clicksByButton[i.button]={clickCount:0,target:d.target,timeStamp:s});const c=l.clicksByButton[i.button];c.target===d.target&&s-c.timeStamp<((o=this._config.clickInterval)!==null&&o!==void 0?o:200)?++c.clickCount:c.clickCount=1,c.target=d.target,c.timeStamp=s,d.detail=c.clickCount,Ds(d.pointerType)?(this.dispatchEvent(d,"click"),c.clickCount===2&&this.dispatchEvent(d,"dblclick")):d.pointerType==="touch"&&this._config.supportsTouchEvents&&(this.dispatchEvent(d,"tap"),c.clickCount===2&&this.dispatchEvent(d,"dbltap")),this.dispatchEvent(d,"pointertap"),this.freeEvent(d)}this.freeEvent(a)},this.onPointerUpOutside=(i,r)=>{if(!(i instanceof Kn))return void Hn.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=this.trackingData(i.pointerId),s=this.findMountedTarget(o.pressTargetsByButton[i.button]),a=this.createPointerEvent(i,i.type,r);if(s){let l=s;for(;l;)a.currentTarget=l,this.notifyTarget(a,"pointerupoutside"),a.pointerType==="touch"?this.notifyTarget(a,"touchendoutside"):Ds(a.pointerType)&&this.notifyTarget(a,a.button===2?"rightupoutside":"mouseupoutside"),l=l.parent;delete o.pressTargetsByButton[i.button]}this.freeEvent(a)},this.onWheel=(i,r)=>{if(!(i instanceof oa))return void Hn.getInstance().warn("EventManager cannot map a non-wheel event as a wheel event");const o=this.createWheelEvent(i,r);this.dispatchEvent(o),this.freeEvent(o)},this.rootTarget=t,this.mappingTable={},this._config=Object.assign({clickInterval:200},e),this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((i,r)=>i.priority-r.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){var e,i,r,o,s,a,l;if(!this.rootTarget)return;const h=this.mappingTable[t.type];let u;const d=`${t.canvasX}-${t.canvasY}`;if(!((e=this._prePointTargetCache)===null||e===void 0)&&e[d]&&(!((r=(i=this._prePointTargetCache)===null||i===void 0?void 0:i[d])===null||r===void 0)&&r.stage)&&((s=(o=this._prePointTargetCache)===null||o===void 0?void 0:o[d])===null||s===void 0?void 0:s.stage.renderCount)===((a=this._prePointTargetCache)===null||a===void 0?void 0:a.stageRenderCount)?u=this._prePointTargetCache[d]:(u=this.pickTarget(t.viewX,t.viewY,t),t.pickParams||(this._prePointTargetCache={[d]:u,stageRenderCount:(l=u?.stage.renderCount)!==null&&l!==void 0?l:-1})),h)for(let c=0,g=h.length;c<g;c++)h[c].fn(t,u);else Hn.getInstance().warn(`[EventManager]: Event mapping not defined for ${t.type}`)}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let r=0,o=i.length-1;r<o;r++)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let r=i.length-2;r>=0;r--)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget&&t.parent;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}notifyTarget(t,e){if(this.pauseNotify)return;e=e??t.type;const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){var r,o;const s=this.allocateEvent(Kn);return this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=i||this.pickTarget((r=s.viewX)!==null&&r!==void 0?r:s.global.x,(o=s.viewY)!==null&&o!==void 0?o:s.global.y,s),typeof e=="string"&&(s.type=e),s}createWheelEvent(t,e){var i,r;const o=this.allocateEvent(oa);return this.copyWheelData(t,o),this.copyMouseData(t,o),this.copyData(t,o),o.nativeEvent=t.nativeEvent,o.originalEvent=t,o.target=e||this.pickTarget((i=o.viewX)!==null&&i!==void 0?i:o.global.x,(r=o.viewY)!==null&&r!==void 0?r:o.global.y,o),o}clonePointerEvent(t,e){const i=this.allocateEvent(Kn);i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice();const r=t.composedDetailPath();return i.detailPath=r&&r.slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Kn&&e instanceof Kn&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Ep&&e instanceof Ep&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.metaKey=t.metaKey,["client","movement","canvas","screen","global","offset","viewport"].forEach((i=>{e[i].x=t[i].x,e[i].y=t[i].y})))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=ll.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.x=t.layer.x,e.layer.y=t.layer.y,e.page.x=t.page.x,e.page.y=t.page.y,e.pickParams=t.pickParams}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){var e;this.eventPool.has(t)||this.eventPool.set(t,[]);const i=((e=this.eventPool.get(t))===null||e===void 0?void 0:e.pop())||new t(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.path=[],i.detailPath=[],i.target=null,i}freeEvent(t){var e;if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventManager!");const i=t.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),(e=this.eventPool.get(i))===null||e===void 0||e.push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i)if("fn"in i)i.once&&t.currentTarget.removeEventListener(e,i.fn,{once:!0}),i.fn.call(i.context,t);else for(let r=0,o=i.length;r<o&&!t.propagationImmediatelyStopped;r++)i[r].once&&t.currentTarget.removeEventListener(e,i[r].fn,{once:!0}),i[r].fn.call(i[r].context,t);this.emitDelegation(t,e)}emitDelegation(t,e){const i=t.currentTarget._events[pI];if(i)if("fn"in i)i.fn.call(i.context,t,e);else for(let r=0,o=i.length;r<o&&!t.propagationImmediatelyStopped;r++)i[r].fn.call(i[r].context,t,e)}pickTarget(t,e,i){let r;const o=this.rootTarget.pick(t,e);return r=o&&o.graphic?o.graphic:o&&o.group?o.group:this.rootTarget.AABBBounds.contains(t,e)?this.rootTarget:null,i&&(i.pickParams=o.params),r}release(){this.dispatch.removeAllListeners(),this.eventPool.clear(),this.rootTarget=null,this.mappingTable=null,this.mappingState=null,this.cursorTarget=null}};const oU={dispatchEvent(n){var t;if(!(n instanceof sg))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return n.defaultPrevented=!1,n.path=[],n.detailPath&&(n.detailPath=[]),n.target=this,(t=n?.manager)===null||t===void 0||t.dispatchEvent(n),!n.defaultPrevented},emit(n,t){return this.dispatchEvent(new lx(n,t))}},sU={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class aU{constructor(t){this.resolution=1,this.onPointerDown=u=>{if(this.supportsTouchEvents&&u.pointerType==="touch")return;const d=this.normalizeToPointerData(u);this.autoPreventDefault&&d[0].isNormalized&&(u.cancelable||!("cancelable"in u))&&u.preventDefault();for(let c=0,g=d.length;c<g;c++){const f=d[c],p=this.bootstrapEvent(this.rootPointerEvent,f);this.manager.mapEvent(p)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerMove=u=>{if(this.supportsTouchEvents&&u.pointerType==="touch"||this.isEventOutsideOfTargetElement(u))return;const d=this.normalizeToPointerData(u);for(let c=0,g=d.length;c<g;c++){const f=this.bootstrapEvent(this.rootPointerEvent,d[c]);this.manager.mapEvent(f)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerUp=u=>{if(this.supportsTouchEvents&&u.pointerType==="touch")return;const d=this.isEventOutsideOfTargetViewPort(u)?"outside":"",c=this.normalizeToPointerData(u);for(let g=0,f=c.length;g<f;g++){const p=this.bootstrapEvent(this.rootPointerEvent,c[g]);p.type+=d,this.manager.mapEvent(p)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerOverOut=u=>{if(this.supportsTouchEvents&&u.pointerType==="touch")return;const d=this.normalizeToPointerData(u);for(let c=0,g=d.length;c<g;c++){const f=this.bootstrapEvent(this.rootPointerEvent,d[c]);this.manager.mapEvent(f)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onWheel=u=>{const d=this.normalizeWheelEvent(u);this.manager.mapEvent(d)};const{targetElement:e,resolution:i,rootNode:r,global:o,autoPreventDefault:s=!1,clickInterval:a,supportsTouchEvents:l=o.supportsTouchEvents,supportsPointerEvents:h=o.supportsPointerEvents}=t;this.manager=new rU(r,{clickInterval:a,supportsTouchEvents:l}),this.globalObj=o,this.supportsPointerEvents=h,this.supportsTouchEvents=l,this.supportsMouseEvents=o.supportsMouseEvents,this.applyStyles=o.applyStyles,this.autoPreventDefault=s,this.eventsAdded=!1,this.rootPointerEvent=new Kn,this.rootWheelEvent=new oa,this.cursorStyles={default:"inherit",pointer:"pointer"},this.resolution=i,this.setTargetElement(e)}release(){this.removeEvents(),this.manager&&this.manager.release(),this.domElement=null,this.manager=null,this.globalObj=null}setCursor(t,e){if(!e&&!this.manager.rootTarget.window._handler.canvas.controled)return;t||(t="default");const{applyStyles:i,domElement:r}=this;if(this.currentCursor===t)return;this.currentCursor=t;const o=this.cursorStyles[t];o?typeof o=="string"&&i?r.style.cursor=o:typeof o=="function"?o(t):typeof o=="object"&&i&&Object.assign(r.style,o):i&&Oo(t)&&!cG(this.cursorStyles,t)&&(r.style.cursor=t)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.addEventListener("pointermove",this.onPointerMove,!0),t.addEventListener("pointerup",this.onPointerUp,!0)):(e.addEventListener("pointermove",this.onPointerMove,!0),e.addEventListener("pointerup",this.onPointerUp,!0)),e.addEventListener("pointerdown",this.onPointerDown,!0),e.addEventListener("pointerleave",this.onPointerOverOut,!0),e.addEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.addEventListener("mousemove",this.onPointerMove,!0),t.addEventListener("mouseup",this.onPointerUp,!0)):(e.addEventListener("mousemove",this.onPointerMove,!0),e.addEventListener("mouseup",this.onPointerUp,!0)),e.addEventListener("mousedown",this.onPointerDown,!0),e.addEventListener("mouseout",this.onPointerOverOut,!0),e.addEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.addEventListener("touchstart",this.onPointerDown,!0),e.addEventListener("touchend",this.onPointerUp,!0),e.addEventListener("touchmove",this.onPointerMove,!0)),e.addEventListener("wheel",this.onWheel,{capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.removeEventListener("pointermove",this.onPointerMove,!0),t.removeEventListener("pointerup",this.onPointerUp,!0)):(e.removeEventListener("pointermove",this.onPointerMove,!0),e.removeEventListener("pointerup",this.onPointerUp,!0)),e.removeEventListener("pointerdown",this.onPointerDown,!0),e.removeEventListener("pointerleave",this.onPointerOverOut,!0),e.removeEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.removeEventListener("mousemove",this.onPointerMove,!0),t.removeEventListener("mouseup",this.onPointerUp,!0)):(e.removeEventListener("mousemove",this.onPointerMove,!0),e.removeEventListener("mouseup",this.onPointerUp,!0)),e.removeEventListener("mousedown",this.onPointerDown,!0),e.removeEventListener("mouseout",this.onPointerOverOut,!0),e.removeEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.removeEventListener("touchstart",this.onPointerDown,!0),e.removeEventListener("touchend",this.onPointerUp,!0),e.removeEventListener("touchmove",this.onPointerMove,!0)),e.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapToViewportPoint(t){return this.domElement.pointTransform?this.domElement.pointTransform(t.x,t.y):t}mapToCanvasPoint(t){var e,i;const r=(e=this.globalObj)===null||e===void 0?void 0:e.mapToCanvasPoint(t,this.domElement);if(r)return r;let o=0,s=0;if(t.changedTouches){const l=(i=t.changedTouches[0])!==null&&i!==void 0?i:{};o=l.clientX||0,s=l.clientY||0}else o=t.clientX||0,s=t.clientY||0;const a=this.domElement.getBoundingClientRect();return{x:o-a.left,y:s-a.top}}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t.changedTouches&&t.changedTouches.length)for(let i=0,r=t.changedTouches.length;i<r;i++){const o=t.changedTouches[i];Je(o.button)&&(o.button=0),Je(o.buttons)&&(o.buttons=1),Je(o.isPrimary)&&(o.isPrimary=t.touches.length===1&&t.type==="touchstart"),Je(o.width)&&(o.width=o.radiusX||1),Je(o.height)&&(o.height=o.radiusY||1),Je(o.tiltX)&&(o.tiltX=0),Je(o.tiltY)&&(o.tiltY=0),Je(o.pointerType)&&(o.pointerType="touch"),Je(o.pointerId)&&(o.pointerId=o.identifier||0),Je(o.pressure)&&(o.pressure=o.force||.5),Je(o.twist)&&(o.twist=0),Je(o.tangentialPressure)&&(o.tangentialPressure=0),Je(o.layerX)&&(o.layerX=o.offsetX=o.clientX),Je(o.layerY)&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,o.type=t.type,e.push(o)}else if(this.globalObj.supportsMouseEvents&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof PointerEvent))e.push(t);else{const i=t;Je(i.isPrimary)&&(i.isPrimary=!0),Je(i.width)&&(i.width=1),Je(i.height)&&(i.height=1),Je(i.tiltX)&&(i.tiltX=0),Je(i.tiltY)&&(i.tiltY=0),Je(i.pointerType)&&(i.pointerType="mouse"),Je(i.pointerId)&&(i.pointerId=1),Je(i.pressure)&&(i.pressure=.5),Je(i.twist)&&(i.twist=0),Je(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ;const{x:i,y:r}=this.mapToCanvasPoint(t);e.canvas.x=i,e.canvas.y=r,e.global.x=i,e.global.y=r,e.offset.x=i,e.offset.y=r;const{x:o,y:s}=this.mapToViewportPoint(e);return e.viewport.x=o,e.viewport.y=s,e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);const{x:i,y:r}=this.mapToCanvasPoint(e);t.canvas.x=i,t.canvas.y=r,t.global.x=i,t.global.y=r,t.offset.x=i,t.offset.y=r;const{x:o,y:s}=this.mapToViewportPoint(t);return t.viewport.x=o,t.viewport.y=s,t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=sU[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=ll.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null}isEventOutsideOfTargetViewPort(t){if(this.isEventOutsideOfTargetElement(t))return!0;if(this.domElement.getViewBox){const e=this.mapToViewportPoint(this.mapToCanvasPoint(t)),i=this.domElement.getViewBox(),r=i.width(),o=i.height();return!(e.x<r&&e.y<o&&e.x>0&&e.y>0)}return!1}isEventOutsideOfTargetElement(t){let e=t.target;return t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]),e!==(this.domElement.getNativeHandler?this.domElement.getNativeHandler().nativeCanvas:this.domElement)}pauseTriggerEvent(){this.manager.pauseNotify=!0}resumeTriggerEvent(){this.manager.pauseNotify=!1}}class Se{static GetImage(t,e){var i;const r=Se.cache.get(t);r?r.loadState==="fail"?mt.global.getRequestAnimationFrame()((()=>{e.imageLoadFail(t)})):r.loadState==="init"||r.loadState==="loading"?(i=r.waitingMark)===null||i===void 0||i.push(e):e&&e.imageLoadSuccess(t,r.data):Se.loadImage(t,e)}static GetSvg(t,e){var i;let r=Se.cache.get(t);r?r.loadState==="fail"?mt.global.getRequestAnimationFrame()((()=>{e.imageLoadFail(t)})):r.loadState==="init"||r.loadState==="loading"?(i=r.waitingMark)===null||i===void 0||i.push(e):e&&e.imageLoadSuccess(t,r.data):(r={type:"image",loadState:"init"},Se.cache.set(t,r),r.dataPromise=mt.global.loadSvg(t),r.dataPromise?(r.waitingMark=[e],r.dataPromise.then((o=>{var s;r.loadState=o?.data?"success":"fail",r.data=o?.data,(s=r.waitingMark)===null||s===void 0||s.map(((a,l)=>{o?.data?(r.loadState="success",r.data=o.data,a.imageLoadSuccess(t,o.data)):(r.loadState="fail",a.imageLoadFail(t))})),r.waitingMark&&(r.waitingMark=[])}))):(r.loadState="fail",e.imageLoadFail(t)))}static GetFile(t,e){let i=Se.cache.get(t);return i?i.loadState==="fail"?Promise.reject():i.loadState==="init"||i.loadState==="loading"?i.dataPromise.then((r=>r.data)):Promise.resolve(i.data):(i={type:e,loadState:"init"},Se.cache.set(t,i),e==="arrayBuffer"?i.dataPromise=mt.global.loadArrayBuffer(t):e==="blob"?i.dataPromise=mt.global.loadBlob(t):e==="json"&&(i.dataPromise=mt.global.loadJson(t)),i.dataPromise.then((r=>r.data)))}static loading(){setTimeout((()=>{if(!Se.isLoading&&Se.toLoadAueue.length){Se.isLoading=!0;const t=Se.toLoadAueue.splice(0,10),e=[];t.forEach((i=>{const{url:r,marks:o}=i,s={type:"image",loadState:"init"};if(Se.cache.set(r,s),s.dataPromise=mt.global.loadImage(r),s.dataPromise){s.waitingMark=o;const a=s.dataPromise.then((l=>{var h;s.loadState=l?.data?"success":"fail",s.data=l?.data,(h=s.waitingMark)===null||h===void 0||h.map(((u,d)=>{l?.data?(s.loadState="success",s.data=l.data,u.imageLoadSuccess(r,l.data)):(s.loadState="fail",u.imageLoadFail(r))})),s.waitingMark&&(s.waitingMark=[])}));e.push(a)}else s.loadState="fail",o.forEach((a=>a.imageLoadFail(r)))})),Promise.all(e).then((()=>{Se.isLoading=!1,this.onLoadSuccessCb.forEach((i=>i())),Se.loading()})).catch((i=>{Se.isLoading=!1,this.onLoadSuccessCb.forEach((r=>r())),Se.loading()}))}}),0)}static loadImage(t,e){const i=cM(t,Se.toLoadAueue);if(i!==-1)return Se.toLoadAueue[i].marks.push(e),void Se.loading();Se.toLoadAueue.push({url:t,marks:[e]}),Se.loading()}static improveImageLoading(t){const e=cM(t,Se.toLoadAueue);if(e!==-1){const i=Se.toLoadAueue.splice(e,1);Se.toLoadAueue.unshift(i[0])}}static onLoadSuccess(t){this.onLoadSuccessCb.push(t)}}function cM(n,t){for(let e=0;e<t.length;e++)if(t[e].url===n)return e;return-1}Se.cache=new Map,Se.isLoading=!1,Se.toLoadAueue=[],Se.onLoadSuccessCb=[];var gM;(function(n){n[n.Top=1]="Top",n[n.Right=2]="Right",n[n.Bottom=4]="Bottom",n[n.Left=8]="Left",n[n.ALL=15]="ALL"})(gM||(gM={}));const qo=[!1,!1,!1,!1],lU=n=>{var t;let e=!0;if(yc(n,!0)){for(let i=0;i<4;i++)qo[i]=n,e&&(e=!((t=qo[i])!==null&&t!==void 0&&!t));e=n}else if(Array.isArray(n))for(let i=0;i<4;i++)qo[i]=!!n[i],e&&(e=!!qo[i]);else qo[0]=!1,qo[1]=!1,qo[2]=!1,qo[3]=!1;return{isFullStroke:e,stroke:qo}},Ku=[0,0,0,0],Lp=n=>n?ue(n)?n.length===0?0:n.length===1?n[0]:n.length===2?(Ku[0]=n[0],Ku[2]=n[0],Ku[1]=n[1],Ku[3]=n[1],Ku):n:n:0,Ql=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],qg=[1,2,3,0,1,2,3,0];function E_(n,t,e,i){for(;n>=zt;)n-=zt;for(;n<0;)n+=zt;for(;n>t;)t+=zt;Ql[0].x=e,Ql[1].y=e,Ql[2].x=-e,Ql[3].y=-e;const r=Math.ceil(n/Rr)%4,o=Math.ceil(t/Rr)%4;if(i.add(Mi(n)*e,Ue(n)*e),i.add(Mi(t)*e,Ue(t)*e),r!==o||t-n>si){let s=!1;for(let a=0;a<qg.length;a++)if(s||r!==qg[a]){if(s&&o===qg[a])break;if(s){const l=Ql[qg[a]];i.add(l.x,l.y)}}else{s=!0;const l=Ql[r];i.add(l.x,l.y)}}}function L_(n,t,e){const{x:i,y:r}=GA(n.x,n.y,t.x,t.y,e),{x:o,y:s}=GA(n.x1,n.y1,t.x1,t.y1,e),a=new Te(i,r,o,s);return a.defined=t.defined,a}function hx(n,t,e){if(!n||!t)return[];Array.isArray(n)||(n=[n]),Array.isArray(t)||(t=[t]);let i=[];if(n.length>t.length){i=t.map((r=>{const o=new Te(r.x,r.y,r.x1,r.y1);return o.defined=r.defined,o}));for(let r=0;r<t.length;r++)i[r]=L_(n[r],t[r],e)}else{i=t.map((r=>{const o=new Te(r.x,r.y,r.x1,r.y1);return o.defined=r.defined,o}));for(let r=0;r<n.length;r++)i[r]=L_(n[r],t[r],e)}return i}function Kg(n,t){if(ue(n)){let e;for(let i=0;i<n.length&&e===void 0;i++)e=n[i][t];return e}return n[t]}class av{constructor(t=av.TimeOut){this.durations=[],this.timeout=t,this.lastDate=0,this.durationsListThreshold=30}call(t){return this.lastDate=Date.now(),setTimeout((()=>{this.appendDuration(Date.now()-this.lastDate),t(0)}),this.timeout,!0)}clear(t){clearTimeout(t)}appendDuration(t){this.durations.push(t),this.durations.length>this.durationsListThreshold&&this.durations.shift(),this.timeout=Math.min(Math.max(this.durations.reduce(((e,i)=>e+i),0)/this.durations.length,1e3/60),1e3/30)}}av.TimeOut=1e3/60;const fM=new av,hU=(n,t)=>Oo(n)&&n[n.length-1]==="%"?t*(Number.parseFloat(n.substring(0,n.length-1))/100):n,ag=(n,t)=>{const e=hU(n,t);return isNaN(e)?e:Math.max(t,e)};class _i{bounds(t,e){if($i(t)){const i=t/2;e.x1=-i,e.x2=i,e.y1=-i,e.y2=i}else e.x1=-t[0]/2,e.x2=t[0]/2,e.y1=-t[1]/2,e.y2=t[1]/2}parseSize(t){return $i(t)?t:Math.min(t[0],t[1])}}function pM(n,t,e,i,r){return r?n.arc(e,i,t,0,un,!1,r):n.arc(e,i,t,0,un),!1}class uU extends _i{constructor(){super(...arguments),this.type="circle",this.pathStr="M0.5,0A0.5,0.5,0,1,1,-0.5,0A0.5,0.5,0,1,1,0.5,0"}draw(t,e,i,r,o){return pM(t,this.parseSize(e)/2,i,r,o)}drawOffset(t,e,i,r,o,s){return pM(t,this.parseSize(e)/2+o,i,r,s)}drawToSvgPath(t,e,i,r){const o=this.parseSize(t)/2;return`M ${e-o}, ${i} a ${o},${o} 0 1,0 ${2*o},0 a ${o},${o} 0 1,0 -${2*o},0`}}const dU=new uU;function cU(n,t,e,i,r){return n.moveTo(-3*t+e,-t+i,r),n.lineTo(-t+e,-t+i,r),n.lineTo(-t+e,-3*t+i,r),n.lineTo(t+e,-3*t+i,r),n.lineTo(t+e,-t+i,r),n.lineTo(3*t+e,-t+i,r),n.lineTo(3*t+e,t+i,r),n.lineTo(t+e,t+i,r),n.lineTo(t+e,3*t+i,r),n.lineTo(-t+e,3*t+i,r),n.lineTo(-t+e,t+i,r),n.lineTo(-3*t+e,t+i,r),n.closePath(),!0}function gU(n,t,e,i,r,o){return n.moveTo(-3*t+e-r,-t+i-r,o),n.lineTo(-t+e-r,-t+i-r,o),n.lineTo(-t+e-r,-3*t+i-r,o),n.lineTo(t+e+r,-3*t+i-r,o),n.lineTo(t+e+r,-t+i-r,o),n.lineTo(3*t+e+r,-t+i-r,o),n.lineTo(3*t+e+r,t+i+r,o),n.lineTo(t+e+r,t+i+r,o),n.lineTo(t+e+r,3*t+i+r,o),n.lineTo(-t+e-r,3*t+i+r,o),n.lineTo(-t+e-r,t+i+r,o),n.lineTo(-3*t+e-r,t+i+r,o),n.closePath(),!0}class fU extends _i{constructor(){super(...arguments),this.type="cross",this.pathStr="M-0.5,-0.2L-0.5,0.2L-0.2,0.2L-0.2,0.5L0.2,0.5L0.2,0.2L0.5,0.2L0.5,-0.2L0.2,-0.2L0.2,-0.5L-0.2,-0.5L-0.2,-0.2Z"}draw(t,e,i,r,o){return cU(t,this.parseSize(e)/6,i,r,o)}drawOffset(t,e,i,r,o,s){return gU(t,this.parseSize(e)/6,i,r,o,s)}}const pU=new fU;function Qb(n,t,e,i,r){return n.moveTo(e,i-t,r),n.lineTo(t+e,i,r),n.lineTo(e,i+t,r),n.lineTo(e-t,i,r),n.closePath(),!0}class mU extends _i{constructor(){super(...arguments),this.type="diamond",this.pathStr="M-0.5,0L0,-0.5L0.5,0L0,0.5Z"}draw(t,e,i,r,o){return Qb(t,this.parseSize(e)/2,i,r,o)}drawFitDir(t,e,i,r,o){return Qb(t,this.parseSize(e)/2,i,r,o)}drawOffset(t,e,i,r,o,s){return Qb(t,this.parseSize(e)/2+o,i,r,s)}}const vU=new mU;function mM(n,t,e,i){const r=2*t;return n.rect(e-t,i-t,r,r),!1}class bU extends _i{constructor(){super(...arguments),this.type="square",this.pathStr="M-0.5,-0.5h1v1h-1Z"}draw(t,e,i,r){return mM(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return mM(t,this.parseSize(e)/2+o,i,r)}}const yU=new bU;function vM(n,t,e,i,r=0){return n.moveTo(e+t+2*r,t+i+r),n.lineTo(e-t-2*r,t+i+r),n.lineTo(e,i-t-2*r),n.closePath(),!0}class mI extends _i{constructor(){super(...arguments),this.type="triangleUp",this.pathStr="M0.5,0.5 L-0.5,0.5 L0,-0.5 Z"}draw(t,e,i,r){return vM(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return vM(t,this.parseSize(e)/2,i,r,o)}}const CU=new mI;class _U extends mI{constructor(){super(...arguments),this.type="triangle"}}const wU=new _U,vI=Math.sin(Math.PI/10)/Math.sin(7*Math.PI/10),xU=Math.sin(un/10)*vI,SU=-Math.cos(un/10)*vI;function bM(n,t,e,i){const r=xU*t,o=SU*t;n.moveTo(e,-t+i),n.lineTo(r+e,o+i);for(let s=1;s<5;++s){const a=un*s/5,l=Math.cos(a),h=Math.sin(a);n.lineTo(h*t+e,-l*t+i),n.lineTo(l*r-h*o+e,h*r+l*o+i)}return n.closePath(),!0}class AU extends _i{constructor(){super(...arguments),this.type="star",this.pathStr="M0 -1L0.22451398828979266 -0.3090169943749474L0.9510565162951535 -0.30901699437494745L0.3632712640026804 0.1180339887498948L0.5877852522924732 0.8090169943749473L8.326672684688674e-17 0.3819660112501051L-0.587785252292473 0.8090169943749476L-0.3632712640026804 0.11803398874989487L-0.9510565162951536 -0.30901699437494723L-0.22451398828979274 -0.30901699437494734Z"}draw(t,e,i,r){return bM(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return bM(t,this.parseSize(e)/2+o,i,r)}}const MU=new AU,TU=eo(3);function yM(n,t,e,i){const r=t,o=r/TU,s=o/5,a=t;return n.moveTo(0+e,-r+i),n.lineTo(o/2+e,i),n.lineTo(s/2+e,i),n.lineTo(s/2+e,a+i),n.lineTo(-s/2+e,a+i),n.lineTo(-s/2+e,i),n.lineTo(-o/2+e,i),n.closePath(),!0}class RU extends _i{constructor(){super(...arguments),this.type="arrow",this.pathStr="M-0.07142857142857142,0.5L0.07142857142857142,0.5L0.07142857142857142,-0.0625L0.2,-0.0625L0,-0.5L-0.2,-0.0625L-0.07142857142857142,-0.0625Z"}draw(t,e,i,r){return yM(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return yM(t,this.parseSize(e)/2+o,i,r)}}const BU=new RU;function CM(n,t,e,i){const r=2*t;return n.moveTo(e,-t+i),n.lineTo(r/3/2+e,t+i),n.lineTo(-r/3/2+e,t+i),n.closePath(),!0}class kU extends _i{constructor(){super(...arguments),this.type="wedge",this.pathStr="M0,-0.5773502691896257L-0.125,0.28867513459481287L0.125,0.28867513459481287Z"}draw(t,e,i,r){return CM(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return CM(t,this.parseSize(e)/2+o,i,r)}}const PU=new kU;function _M(n,t,e,i){return n.moveTo(-t+e,i),n.lineTo(e,t+i),!1}class EU extends _i{constructor(){super(...arguments),this.type="stroke",this.pathStr=""}draw(t,e,i,r){return _M(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return _M(t,this.parseSize(e)/2+o,i,r)}}const LU=new EU,cr=-.5,gr=eo(3)/2,wM=1/eo(12);function xM(n,t,e,i){const r=t/2,o=t*wM,s=r,a=t*wM+t,l=-s,h=a;return n.moveTo(r+e,o+i),n.lineTo(s+e,a+i),n.lineTo(l+e,h+i),n.lineTo(cr*r-gr*o+e,gr*r+cr*o+i),n.lineTo(cr*s-gr*a+e,gr*s+cr*a+i),n.lineTo(cr*l-gr*h+e,gr*l+cr*h+i),n.lineTo(cr*r+gr*o+e,cr*o-gr*r+i),n.lineTo(cr*s+gr*a+e,cr*a-gr*s+i),n.lineTo(cr*l+gr*h+e,cr*h-gr*l+i),n.closePath(),!1}class OU extends _i{constructor(){super(...arguments),this.type="wye",this.pathStr="M0.25 0.14433756729740646L0.25 0.6443375672974064L-0.25 0.6443375672974064L-0.25 0.14433756729740643L-0.6830127018922193 -0.10566243270259357L-0.4330127018922193 -0.5386751345948129L0 -0.28867513459481287L0.4330127018922193 -0.5386751345948129L0.6830127018922193 -0.10566243270259357Z"}draw(t,e,i,r){return xM(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return xM(t,this.parseSize(e)/2+o,i,r)}}const IU=new OU;function SM(n,t,e,i,r){return n.moveTo(-t+e-2*r,i),n.lineTo(t+e+r,t+i+2*r),n.lineTo(t+e+r,i-t-2*r),n.closePath(),!0}class HU extends _i{constructor(){super(...arguments),this.type="triangleLeft",this.pathStr="M-0.5,0 L0.5,0.5 L0.5,-0.5 Z"}draw(t,e,i,r){return SM(t,this.parseSize(e)/2,i,r,0)}drawOffset(t,e,i,r,o){return SM(t,this.parseSize(e)/2,i,r,o)}}const DU=new HU;function AM(n,t,e,i,r=0){return n.moveTo(e-t-r,t+i+2*r),n.lineTo(t+e+2*r,i),n.lineTo(e-t-r,i-t-2*r),n.closePath(),!0}class FU extends _i{constructor(){super(...arguments),this.type="triangleRight",this.pathStr="M-0.5,0.5 L0.5,0 L-0.5,-0.5 Z"}draw(t,e,i,r){return AM(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return AM(t,this.parseSize(e)/2,i,r,o)}}const zU=new FU;function MM(n,t,e,i,r=0){return n.moveTo(e-t-2*r,i-t-r),n.lineTo(e+t+2*r,i-t-r),n.lineTo(e,i+t+2*r),n.closePath(),!0}class NU extends _i{constructor(){super(...arguments),this.type="triangleDown",this.pathStr="M-0.5,-0.5 L0.5,-0.5 L0,0.5 Z"}draw(t,e,i,r){return MM(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o){return MM(t,this.parseSize(e)/2,i,r,o)}}const WU=new NU,O_=eo(3);function TM(n,t,e,i){const r=t*O_;return n.moveTo(e,i+-r/3*2),n.lineTo(t+e,i+r),n.lineTo(e-t,i+r),n.closePath(),!0}class jU extends _i{constructor(){super(...arguments),this.type="thinTriangle",this.pathStr="M0,-0.5773502691896257L-0.5,0.28867513459481287L0.5,0.28867513459481287Z"}draw(t,e,i,r){return TM(t,this.parseSize(e)/2/O_,i,r)}drawOffset(t,e,i,r,o){return TM(t,this.parseSize(e)/2/O_+o,i,r)}}const VU=new jU;function RM(n,t,e,i){const r=2*t;return n.moveTo(t+e,i-r),n.lineTo(e-t,i),n.lineTo(t+e,r+i),!0}class GU extends _i{constructor(){super(...arguments),this.type="arrow2Left",this.pathStr="M 0.25 -0.5 L -0.25 0 l 0.25 0.5"}draw(t,e,i,r){return RM(t,this.parseSize(e)/4,i,r)}drawOffset(t,e,i,r,o){return RM(t,this.parseSize(e)/4+o,i,r)}}const $U=new GU;function BM(n,t,e,i){const r=2*t;return n.moveTo(e-t,i-r),n.lineTo(e+t,i),n.lineTo(e-t,r+i),!0}class UU extends _i{constructor(){super(...arguments),this.type="arrow2Right",this.pathStr="M -0.25 -0.5 l 0.25 0 l -0.25 0.5"}draw(t,e,i,r){return BM(t,this.parseSize(e)/4,i,r)}drawOffset(t,e,i,r,o){return BM(t,this.parseSize(e)/4+o,i,r)}}const XU=new UU;function kM(n,t,e,i){const r=2*t;return n.moveTo(e-r,i+t),n.lineTo(e,i-t),n.lineTo(e+r,i+t),!0}class YU extends _i{constructor(){super(...arguments),this.type="arrow2Up",this.pathStr="M -0.5 0.25 L 0 -0.25 l 0.5 0.25"}draw(t,e,i,r){return kM(t,this.parseSize(e)/4,i,r)}drawOffset(t,e,i,r,o){return kM(t,this.parseSize(e)/4+o,i,r)}}const qU=new YU;function PM(n,t,e,i){const r=2*t;return n.moveTo(e-r,i-t),n.lineTo(e,i+t),n.lineTo(e+r,i-t),!0}class KU extends _i{constructor(){super(...arguments),this.type="arrow2Down",this.pathStr="M -0.5 -0.25 L 0 0.25 l 0.5 -0.25"}draw(t,e,i,r){return PM(t,this.parseSize(e)/4,i,r)}drawOffset(t,e,i,r,o){return PM(t,this.parseSize(e)/4+o,i,r)}}const ZU=new KU;function EM(n,t,e,i,r){return n.moveTo(e,i-t),n.lineTo(e,i+t),!0}class JU extends _i{constructor(){super(...arguments),this.type="lineV",this.pathStr="M0,-0.5L0,0.5"}draw(t,e,i,r,o){return EM(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o,s){return EM(t,this.parseSize(e)/2+o,i,r)}drawToSvgPath(t,e,i,r){const o=this.parseSize(t)/2;return`M ${e}, ${i-o} L ${e},${i+o}`}}const QU=new JU;function LM(n,t,e,i,r){return n.moveTo(e-t,i),n.lineTo(e+t,i),!0}class tX extends _i{constructor(){super(...arguments),this.type="lineH",this.pathStr="M-0.5,0L0.5,0"}draw(t,e,i,r,o){return LM(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o,s){return LM(t,this.parseSize(e)/2+o,i,r)}drawToSvgPath(t,e,i,r){const o=this.parseSize(t)/2;return`M ${e-o}, ${i} L ${e+o},${i}`}}const eX=new tX;function OM(n,t,e,i,r){return n.moveTo(e-t,i-t),n.lineTo(e+t,i+t),n.moveTo(e+t,i-t),n.lineTo(e-t,i+t),!0}class iX extends _i{constructor(){super(...arguments),this.type="close",this.pathStr="M-0.5,-0.5L0.5,0.5,M0.5,-0.5L-0.5,0.5"}draw(t,e,i,r,o){return OM(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,o,s){return OM(t,this.parseSize(e)/2+o,i,r)}drawToSvgPath(t,e,i,r){const o=this.parseSize(t)/2;return`M ${e-o}, ${i-o} L ${e+o},${i+o} M ${e+o}, ${i-o} L ${e-o},${i+o}`}}const nX=new iX;function IM(n,t,e,i){return n.rect(e-t[0]/2,i-t[1]/2,t[0],t[1]),!1}function HM(n,t,e,i){const r=t,o=t/2;return n.rect(e-r/2,i-o/2,r,o),!1}class rX extends _i{constructor(){super(...arguments),this.type="rect",this.pathStr="M -0.5,0.25 L 0.5,0.25 L 0.5,-0.25,L -0.5,-0.25 Z"}draw(t,e,i,r){return $i(e)?HM(t,e,i,r):IM(t,e,i,r)}drawWithClipRange(t,e,i,r,o,s,a){$i(e)&&(e=[e,e/2]);const l=2*(e[0]+e[1])*o,h=[{x:i+e[0]/2,y:r-e[1]/2},{x:i+e[0]/2,y:r+e[1]/2},{x:i-e[0]/2,y:r+e[1]/2},{x:i-e[0]/2,y:r-e[1]/2}];let u=0,d=h[3];t.moveTo(d.x,d.y);for(let c=0;c<h.length;c++){const g=h[c],f=Math.sqrt((g.x-d.x)*(g.x-d.x)+(g.y-d.y)*(g.y-d.y));if(u+f>l){const p=(g.x-d.x)*(l-u)/f,m=(g.y-d.y)*(l-u)/f;t.lineTo(d.x+p,d.y+m);break}t.lineTo(g.x,g.y),d=g,u+=f}return!1}drawOffset(t,e,i,r,o){return $i(e)?HM(t,e+2*o,i,r):IM(t,[e[0]+2*o,e[1]+2*o],i,r)}}const oX=new rX,Zu=new Zi;class DM{constructor(t,e,i=!1){this.pathStr="",this.type=t,ue(e)?this.svgCache=e:this.path=e,this.isSvg=i}drawOffset(t,e,i,r,o,s,a){return e=this.parseSize(e),this.isSvg?!!this.svgCache&&(this.svgCache.forEach((l=>{t.beginPath(),Bs(l.path.commandList,t,i,r,e,e),a&&a(l.path,l.attribute)})),!1):(Bs(this.path.commandList,t,i,r,e+o,e+o),!1)}draw(t,e,i,r,o,s){return e=this.parseSize(e),this.drawOffset(t,e,i,r,0,o,s)}parseSize(t){return $i(t)?t:Math.min(t[0],t[1])}drawWithClipRange(t,e,i,r,o,s,a){return e=this.parseSize(e),this.isSvg?!!this.svgCache&&(this.svgCache.forEach((l=>{l.path.drawWithClipRange(t,e,i,r,o),a&&a(l.path,l.attribute)})),!1):(this.path.drawWithClipRange(t,e,i,r,o),!1)}bounds(t,e){if(t=this.parseSize(t),this.isSvg)return this.svgCache?(e.clear(),void this.svgCache.forEach((({path:i})=>{Zu.x1=i.bounds.x1*t,Zu.y1=i.bounds.y1*t,Zu.x2=i.bounds.x2*t,Zu.y2=i.bounds.y2*t,e.union(Zu)}))):void 0;this.path.bounds&&(e.x1=this.path.bounds.x1*t,e.y1=this.path.bounds.y1*t,e.x2=this.path.bounds.x2*t,e.y2=this.path.bounds.y2*t)}}const sX=[dU,pU,vU,yU,VU,wU,MU,BU,PU,LU,IU,DU,zU,CU,WU,$U,XU,qU,ZU,oX,QU,eX,nX],bI={};sX.forEach((n=>{bI[n.type]=n}));const aX={arrowLeft:"M 0.25 -0.5 L -0.25 0 l 0.5 0.5",arrowRight:"M -0.25 -0.5 l 0.5 0.5 l -0.5 0.5",rectRound:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",roundLine:"M 1.2392 -0.258 L -1.3432 -0.258 C -1.4784 -0.258 -1.588 -0.1436 -1.588 -0.002 c 0 0.1416 0.1096 0.256 0.2448 0.256 l 2.5824 0 c 0.1352 0 0.2448 -0.1144 0.2448 -0.256 C 1.484 -0.1436 1.3744 -0.258 1.2392 -0.258 z"};function lX(n,t){const e=[];let i=t.exec(n);for(;i;){const r=[];r.startIndex=t.lastIndex-i[0].length;const o=i.length;for(let s=0;s<o;s++)r.push(i[s]);e.push(r),i=t.exec(n)}return e}class ty{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}function FM(n,t,e,i){const r=n.indexOf(t,e);if(r===-1)throw new Error(i);return r+t.length-1}function hX(n,t,e=">"){let i,r="";for(let o=t;o<n.length;o++){let s=n[o];if(i)s===i&&(i="");else if(s==='"'||s==="'")i=s;else if(s===e[0]){if(!e[1])return{data:r,index:o};if(n[o+1]===e[1])return{data:r,index:o}}else s==="	"&&(s=" ");r+=s}}function zM(n,t,e,i=">"){const r=hX(n,t+1,i);if(!r)return;let o=r.data;const s=r.index,a=o.search(/\s/);let l=o,h=!0;return a!==-1&&(l=o.substr(0,a).replace(/\s\s*$/,""),o=o.substr(a+1)),{tagName:l,tagExp:o,closeIndex:s,attrExpPresent:h,rawTagName:l}}const uX=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");class dX{constructor(t){this.currentNode=null,this.options=t,this.tagsNodeStack=[],this.docTypeEntities={}}addChild(t,e,i){const r=e.tagname;typeof r=="string"&&(e.tagname=r),t.addChild(e)}buildAttributesMap(t,e,i){const r={};if(!t)return;const o=lX(t,uX),s=o.length;for(let a=0;a<s;a++){const l=o[a][1],h=o[a][4],u=l;l&&(r[u]=h===void 0||(isNaN(h)?h:Number(h)))}return r}parseXml(t){t=t.replace(/\r\n?/g,`
`);const e=new ty("!xml");let i=e,r="",o="";for(let s=0;s<t.length;s++)if(t[s]==="<")if(t[s+1]==="/"){const a=FM(t,">",s,"Closing Tag is not closed."),l=o.lastIndexOf(".");o=o.substring(0,l),i=this.tagsNodeStack.pop(),i&&i.child&&r&&i.child[i.child.length-1][":@"]&&(i.child[i.child.length-1][":@"].text=r),r="",s=a}else if(t[s+1]==="?")s=zM(t,s,!1,"?>").closeIndex+1;else if(t.substr(s+1,3)==="!--")s=FM(t,"-->",s+4,"Comment is not closed.");else{const a=zM(t,s);let l=a.tagName,h=a.tagExp;const u=a.attrExpPresent,d=a.closeIndex;if(l!==e.tagname&&(o+=o?"."+l:l),h.length>0&&h.lastIndexOf("/")===h.length-1){l[l.length-1]==="/"?(l=l.substr(0,l.length-1),o=o.substr(0,o.length-1),h=l):h=h.substr(0,h.length-1);const c=new ty(l);l!==h&&u&&(c[":@"]=this.buildAttributesMap(h,o,l)),this.addChild(i,c,o),o=o.substr(0,o.lastIndexOf("."))}else{const c=new ty(l);this.tagsNodeStack.push(i),l!==h&&u&&(c[":@"]=this.buildAttributesMap(h,o,l)),this.addChild(i,c,o),i=c}r="",s=d}else r+=t[s];return e.child}}function cX(n,t){return yI(n)}function yI(n,t){const e={};for(let i=0;i<n.length;i++){const r=n[i],o=gX(r);if(o!==void 0&&r[o]){const s=yI(r[o]);pX(s),r[":@"]&&fX(s,r[":@"]),e[o]!==void 0&&e.hasOwnProperty(o)?(Array.isArray(e[o])||(e[o]=[e[o]]),e[o].push(s)):e[o]=s}}return e}function gX(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const i=t[e];if(i!==":@")return i}}function fX(n,t,e){if(t){const i=Object.keys(t),r=i.length;for(let o=0;o<r;o++){const s=i[o];n[s]=t[s]}}}function pX(n){return Object.keys(n).length===0}class lv{constructor(t){this.options=Object.assign({},lv.defaultOptions,t)}valid(t){return t.startsWith("<")}parse(t){if(!this.valid)return!1;const e=new dX(this.options).parseXml(t);return cX(e,this.options)}}lv.defaultOptions={};function mX(n){return n.startsWith("<svg")||n.startsWith("<?xml")}function Op(n,t,e,i=0){return n.expand(t+(i/2+(e?vX(e,t):0))),n}function vX(n,t){return n?t:0}let bX=0;function tn(){return bX++}var Ph;(function(n){n[n.HORIZONTAL=0]="HORIZONTAL",n[n.VERTICAL=1]="VERTICAL"})(Ph||(Ph={}));function yX(n){const t=[];let e=0,i="";for(let r=0;r<n.length;r++)wX(n[r])?e?i+=n[r]:(e=1,i=n[r]):(e&&(t.push({text:i,direction:Ph.VERTICAL}),i="",e=0),t.push({text:n[r],direction:Ph.HORIZONTAL}));return i&&t.push({text:i,direction:Ph.VERTICAL}),t}const CX=["…","（","）","—","【","】","「","」","《","》"],CI=new Map;CX.forEach((n=>CI.set(n,!0)));const _X=[""],_I=new Map;function wX(n){if(CI.has(n))return!0;if(_I.has(n))return!1;let t=!1;return n.codePointAt(0)<256&&(t=!0),t}_X.forEach((n=>_I.set(n,!0)));const hv=tn(),xX=tn(),wI=tn(),uv=tn();tn();const ux=tn(),dv=tn(),lg=tn(),cv=tn(),gv=tn();tn();const dx=tn();tn();const cx=tn();tn();const fv=tn(),pv=tn(),gx=Symbol.for("GraphicService"),xI=Symbol.for("GraphicCreator"),SI={"stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-width":"lineWidth","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity",stroke:"stroke",fill:"fill"},SX=Object.keys(SI),AX={duration:200,easing:"cubicOut"};function AI(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function MX(n,t,e){const i=Math.sin(e),r=Math.cos(e),o=t[4],s=t[5],a=t[6],l=t[7],h=t[8],u=t[9],d=t[10],c=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=o*r+h*i,n[5]=s*r+u*i,n[6]=a*r+d*i,n[7]=l*r+c*i,n[8]=h*r-o*i,n[9]=u*r-s*i,n[10]=d*r-a*i,n[11]=c*r-l*i,n}function TX(n,t,e){const i=Math.sin(e),r=Math.cos(e),o=t[0],s=t[1],a=t[2],l=t[3],h=t[8],u=t[9],d=t[10],c=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=o*r-h*i,n[1]=s*r-u*i,n[2]=a*r-d*i,n[3]=l*r-c*i,n[8]=o*i+h*r,n[9]=s*i+u*r,n[10]=a*i+d*r,n[11]=l*i+c*r,n}function RX(n,t,e){const i=Math.sin(e),r=Math.cos(e),o=t[0],s=t[1],a=t[2],l=t[3],h=t[4],u=t[5],d=t[6],c=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=o*r+h*i,n[1]=s*r+u*i,n[2]=a*r+d*i,n[3]=l*r+c*i,n[4]=h*r-o*i,n[5]=u*r-s*i,n[6]=d*r-a*i,n[7]=c*r-l*i,n}function Ju(n,t,e){const i=e[0],r=e[1],o=e[2];let s,a,l,h,u,d,c,g,f,p,m,v;return t===n?(n[12]=t[0]*i+t[4]*r+t[8]*o+t[12],n[13]=t[1]*i+t[5]*r+t[9]*o+t[13],n[14]=t[2]*i+t[6]*r+t[10]*o+t[14],n[15]=t[3]*i+t[7]*r+t[11]*o+t[15]):(s=t[0],a=t[1],l=t[2],h=t[3],u=t[4],d=t[5],c=t[6],g=t[7],f=t[8],p=t[9],m=t[10],v=t[11],n[0]=s,n[1]=a,n[2]=l,n[3]=h,n[4]=u,n[5]=d,n[6]=c,n[7]=g,n[8]=f,n[9]=p,n[10]=m,n[11]=v,n[12]=s*i+u*r+f*o+t[12],n[13]=a*i+d*r+p*o+t[13],n[14]=l*i+c*r+m*o+t[14],n[15]=h*i+g*r+v*o+t[15]),n}function I_(n,t){n[0]=t.a,n[1]=t.b,n[2]=0,n[3]=0,n[4]=t.c,n[5]=t.d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t.e,n[13]=t.f,n[14]=0,n[15]=1}function BX(n,t,e){const i=e[0],r=e[1],o=e[2];return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n[3]=t[3]*i,n[4]=t[4]*r,n[5]=t[5]*r,n[6]=t[6]*r,n[7]=t[7]*r,n[8]=t[8]*o,n[9]=t[9]*o,n[10]=t[10]*o,n[11]=t[11]*o,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function hg(n,t,e){const i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],l=t[5],h=t[6],u=t[7],d=t[8],c=t[9],g=t[10],f=t[11],p=t[12],m=t[13],v=t[14],b=t[15];let y=e[0],C=e[1],w=e[2],_=e[3];return n[0]=y*i+C*a+w*d+_*p,n[1]=y*r+C*l+w*c+_*m,n[2]=y*o+C*h+w*g+_*v,n[3]=y*s+C*u+w*f+_*b,y=e[4],C=e[5],w=e[6],_=e[7],n[4]=y*i+C*a+w*d+_*p,n[5]=y*r+C*l+w*c+_*m,n[6]=y*o+C*h+w*g+_*v,n[7]=y*s+C*u+w*f+_*b,y=e[8],C=e[9],w=e[10],_=e[11],n[8]=y*i+C*a+w*d+_*p,n[9]=y*r+C*l+w*c+_*m,n[10]=y*o+C*h+w*g+_*v,n[11]=y*s+C*u+w*f+_*b,y=e[12],C=e[13],w=e[14],_=e[15],n[12]=y*i+C*a+w*d+_*p,n[13]=y*r+C*l+w*c+_*m,n[14]=y*o+C*h+w*g+_*v,n[15]=y*s+C*u+w*f+_*b,n}function Nr(n,t,e){const i=t[0],r=t[1],o=t[2];let s=e[3]*i+e[7]*r+e[11]*o+e[15];return s=s||1,n[0]=(e[0]*i+e[4]*r+e[8]*o+e[12])/s,n[1]=(e[1]*i+e[5]*r+e[9]*o+e[13])/s,n[2]=(e[2]*i+e[6]*r+e[10]*o+e[14])/s,n}function NM(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}class kX{constructor(){this.pools=[]}allocate(t,e,i,r,o,s){if(!this.pools.length)return new wn(t,e,i,r,o,s);const a=this.pools.pop();return a.a=t,a.b=e,a.c=i,a.d=r,a.e=o,a.f=s,a}allocateByObj(t){if(!this.pools.length)return new wn(t.a,t.b,t.c,t.d,t.e,t.f);const e=this.pools.pop();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}}class fx{constructor(){this.pools=[]}static identity(t){return AI(t)}allocate(){if(!this.pools.length)return NM();const t=this.pools.pop();return fx.identity(t),t}allocateByObj(t){let e;e=this.pools.length?this.pools.pop():NM();for(let i=0;i<e.length;i++)e[i]=t[i];return e}free(t){t&&this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}}const Ki=new kX,Bi=new fx;var PX=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},EX=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};const LX=new wn(1,0,0,1,0,0),th={x:0,y:0};let H_=class{get nativeContext(){return this.path}constructor(n,t){this.matrix=new wn(1,0,0,1,0,0),this.stack=[],this.dpr=t,this.applyedMatrix=new wn(1,0,0,1,0,0),this.path=new Fi,this._clearMatrix=new wn(1,0,0,1,0,0)}getCanvas(){throw new Error("不支持getCanvas")}getContext(){throw new Error("不支持getContext")}setTransformForCurrent(n=!1){!n&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix=this.cloneMatrix(this.matrix))}get currentMatrix(){return this.matrix}cloneMatrix(n){return Ki.allocateByObj(n)}clear(){this.save(),this.resetTransform(),this.restore()}reset(){this.matrix.setValue(1,0,0,1,0,0),this.applyedMatrix=new wn(1,0,0,1,0,0),this.stack.length=0}restore(){this.stack.length>0&&(Ki.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent())}highPerformanceRestore(){this.stack.length>0&&(Ki.free(this.matrix),this.matrix=this.stack.pop())}rotate(n,t=!0){this.matrix.rotate(n),t&&this.setTransformForCurrent()}save(){const n=this.cloneMatrix(this.matrix);this.stack.push(n)}highPerformanceSave(){const n=this.cloneMatrix(this.matrix);this.stack.push(n)}scale(n,t,e=!0){this.matrix.scale(n,t),e&&this.setTransformForCurrent()}setScale(n,t,e=!0){this.matrix.setScale(n,t),e&&this.setTransformForCurrent()}scalePoint(n,t,e,i,r=!0){this.translate(e,i,!1),this.scale(n,t,!1),this.translate(-e,-i,!1),r&&this.setTransformForCurrent()}setTransform(n,t,e,i,r,o,s=!0,a=this.dpr){this.matrix.setValue(a*n,a*t,a*e,a*i,a*r,a*o),s&&this.setTransformForCurrent()}setTransformFromMatrix(n,t=!0,e=this.dpr){this.matrix.setValue(n.a*e,n.b*e,n.c*e,n.d*e,n.e*e,n.f*e),t&&this.setTransformForCurrent()}resetTransform(n=!0,t=this.dpr){this.setTransform(t,0,0,t,0,0),n&&this.setTransformForCurrent()}transform(n,t,e,i,r,o,s=!0){this.matrix.multiply(n,t,e,i,r,o),s&&this.setTransformForCurrent()}transformFromMatrix(n,t){this.matrix.multiply(n.a,n.b,n.c,n.d,n.e,n.f),t&&this.setTransformForCurrent()}translate(n,t,e=!0){this.matrix.translate(n,t),e&&this.setTransformForCurrent()}rotateDegrees(n,t=!0){const e=n*Math.PI/180;this.rotate(e,t)}rotateAbout(n,t,e,i=!0){this.translate(t,e,!1),this.rotate(n,!1),this.translate(-t,-e,!1),i&&this.setTransformForCurrent()}rotateDegreesAbout(n,t,e,i=!0){this.translate(t,e,!1),this.rotateDegrees(n,!1),this.translate(-t,-e,!1),i&&this.setTransformForCurrent()}beginPath(){this.path.clear()}clip(n,t){}arc(n,t,e,i,r,o){this.path.arc(n,t,e,i,r,o)}arcTo(n,t,e,i,r){this.path.arcTo(n,t,e,i,r)}bezierCurveTo(n,t,e,i,r,o){this.path.bezierCurveTo(n,t,e,i,r,o)}closePath(){this.path.closePath()}ellipse(n,t,e,i,r,o,s,a){}lineTo(n,t){this.path.lineTo(n,t)}moveTo(n,t){this.path.moveTo(n,t)}quadraticCurveTo(n,t,e,i){this.path.quadraticCurveTo(n,t,e,i)}rect(n,t,e,i){this.path.rect(n,t,e,i)}createImageData(n,t){return null}createLinearGradient(n,t,e,i){throw new Error("不支持createLinearGradient")}createPattern(n,t){throw new Error("不支持createPattern")}createRadialGradient(n,t,e,i,r,o){throw new Error("不支持createRadialGradient")}createConicGradient(n,t,e,i){return null}fill(n,t){}fillRect(n,t,e,i){this.path.rect(n,t,e,i)}clearRect(n,t,e,i){}fillText(n,t,e){}getImageData(n,t,e,i){return null}getLineDash(){return[]}isPointInPath(n,t){return this.matrix.transformPoint({x:n,y:t},th),q$(this.path.commandList,th.x,th.y)}isPointInStroke(n,t){if(!this.lineWidth)return!1;this.matrix.transformPoint({x:n,y:t},th);const e=jo(this,this.lineWidth,this.dpr);return K$(this.path.commandList,e,th.x,th.y)}measureText(n){throw new Error("不支持measureText")}putImageData(n,t,e){throw new Error("不支持measureText")}setLineDash(n){}stroke(n){}strokeRect(n,t,e,i){this.path.rect(n,t,e,i)}strokeText(n,t,e){}drawImage(){}setCommonStyle(n,t,e,i,r){}_setCommonStyle(n,t,e,i){}setStrokeStyle(n,t,e,i,r){}_setStrokeStyle(n,t,e,i){}setTextStyleWithoutAlignBaseline(n,t){}setTextStyle(n,t){}draw(){}clearMatrix(n=!0,t=this.dpr){this.setTransformFromMatrix(LX,n,t)}setClearMatrix(n,t,e,i,r,o){this._clearMatrix.setValue(n,t,e,i,r,o)}onlyTranslate(n=this.dpr){return this.matrix.a===n&&this.matrix.b===0&&this.matrix.c===0&&this.matrix.d===n}release(...n){this.stack.forEach((t=>Ki.free(t))),this.stack.length=0}};H_=PX([pt(),EX("design:paramtypes",[Object,Number])],H_);const ey={WIDTH:500,HEIGHT:500,DPR:1};class px{get displayWidth(){return this._pixelWidth/this._dpr}get displayHeight(){return this._pixelHeight/this._dpr}get id(){return this._id}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get nativeCanvas(){return this._nativeCanvas}set nativeCanvas(t){this._nativeCanvas=t}get width(){return this._pixelWidth}set width(t){this._pixelWidth=t,this._displayWidth=t/(this._dpr||1)}get height(){return this._pixelHeight}set height(t){this._pixelHeight=t,this._displayHeight=t/(this._dpr||1)}getContext(t){return this._context}get visiable(){return this._visiable}set visiable(t){this._visiable=t,t?this.show():this.hide()}get dpr(){return this._dpr}set dpr(t){this._dpr=t,this.resize(this._displayWidth,this._displayHeight)}constructor(t){var e;const{nativeCanvas:i,width:r=ey.WIDTH,height:o=ey.HEIGHT,dpr:s=ey.DPR,x:a,y:l,id:h,canvasControled:u=!0}=t;this._x=a??0,this._y=l??0,this._pixelWidth=r*s,this._pixelHeight=o*s,this._visiable=t.visiable!==!1,this.controled=u,this._displayWidth=r,this._displayHeight=o,this._dpr=s,this._nativeCanvas=i,this._id=(e=i.id)!==null&&e!==void 0?e:h,h&&(i.id=h),this.init(t)}getNativeCanvas(){return this._nativeCanvas}hide(){}show(){}applyPosition(){}resetStyle(t){}resize(t,e){}toDataURL(t,e){return""}readPixels(t,e,i,r){return this._context.getImageData(t,e,i,r)}convertToBlob(t){throw new Error("暂未实现")}transferToImageBitmap(){throw new Error("暂未实现")}release(...t){this.controled&&this._nativeCanvas.parentElement&&this._nativeCanvas.parentElement.removeChild(this._nativeCanvas)}}px.env="browser";var io;(function(n){n[n.Color255=0]="Color255",n[n.Color1=1]="Color1"})(io||(io={}));class Ai{static Get(t,e=io.Color1,i=[0,0,0,1]){if(e===io.Color1){const s=Ai.store1[t];if(s)return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i;const a=JA.parseColorString(t);if(a){const l=[a.r/255,a.g/255,a.b/255,a.opacity];Ai.store1[t]=l,Ai.store255[t]=[a.r,a.g,a.b,a.opacity],i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3]}return i}const r=Ai.store255[t];if(r)return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i;const o=JA.parseColorString(t);return o&&(Ai.store1[t]=[o.r/255,o.g/255,o.b/255,o.opacity],Ai.store255[t]=[o.r,o.g,o.b,o.opacity],i[0]=o.r,i[1]=o.g,i[2]=o.b,i[3]=o.opacity),i}static Set(t,e,i){if(e===io.Color1){if(Ai.store1[t])return;Ai.store1[t]=i,Ai.store255[t]=[Math.floor(255*i[0]),Math.floor(255*i[1]),Math.floor(255*i[2]),Math.floor(255*i[3])]}else{if(Ai.store255[t])return;Ai.store255[t]=i,Ai.store1[t]=[i[0]/255,i[1]/255,i[2]/255,i[3]]}}}Ai.store255={},Ai.store1={};function Zg(n,t=!1){return Array.isArray(n)&&$i(n[0])?t?`rgb(${Math.round(n[0])},${Math.round(n[1])},${Math.round(n[2])},${n[3].toFixed(2)})`:`rgb(${Math.round(n[0])},${Math.round(n[1])},${Math.round(n[2])})`:n}function Il(n,t,e,i,r){return Array.isArray(n)&&!$i(n[0])||Array.isArray(t)&&!$i(t[0])?new Array(4).fill(0).map(((o,s)=>{var a,l;return WM(ue(n)?(a=n[s])!==null&&a!==void 0?a:n[0]:n,ue(t)?(l=t[s])!==null&&l!==void 0?l:t[0]:t,e,i)})):WM(n,t,e,i)}function WM(n,t,e,i,r){if(!n||!t)return n&&Zg(n)||t&&Zg(t)||!1;let o,s,a=!1,l=!1;if(Array.isArray(n)?o=n:typeof n=="string"?o=Ai.Get(n,io.Color255):a=!0,Array.isArray(t)?s=t:typeof t=="string"?s=Ai.Get(t,io.Color255):l=!0,a!==l){const h=a?n:t,u=a?t:n,d=Object.assign(Object.assign({},h),{stops:h.stops.map((c=>Object.assign(Object.assign({},c),{color:Zg(u)})))});return a?Il(h,d,e,i):Il(d,h,e,i)}if(a){if(n.gradient===t.gradient){const h=n,u=t,d=h.stops,c=u.stops;if(d.length!==c.length)return!1;if(h.gradient==="linear")return OX(h,u,e);if(h.gradient==="radial")return IX(h,u,e);if(h.gradient==="conical")return HX(h,u,e)}return!1}return Zg(DX(o,s,e),i)}function OX(n,t,e){const i=n.stops,r=t.stops;return{gradient:"linear",x0:n.x0+(t.x0-n.x0)*e,x1:n.x1+(t.x1-n.x1)*e,y0:n.y0+(t.y0-n.y0)*e,y1:n.y1+(t.y1-n.y1)*e,stops:new Array(i.length).fill(0).map(((o,s)=>({color:mx(i[s].color,r[s].color,e),offset:i[s].offset+(r[s].offset-i[s].offset)*e})))}}function IX(n,t,e){const i=n.stops,r=t.stops;return{gradient:"radial",x0:n.x0+(t.x0-n.x0)*e,x1:n.x1+(t.x1-n.x1)*e,y0:n.y0+(t.y0-n.y0)*e,y1:n.y1+(t.y1-n.y1)*e,r0:n.r0+(t.r0-n.r0)*e,r1:n.r1+(t.r1-n.r1)*e,stops:new Array(i.length).fill(0).map(((o,s)=>({color:mx(i[s].color,r[s].color,e),offset:i[s].offset+(r[s].offset-i[s].offset)*e})))}}function HX(n,t,e){const i=n.stops,r=t.stops;return{gradient:"conical",startAngle:n.startAngle+(t.startAngle-n.startAngle)*e,endAngle:n.endAngle+(t.endAngle-n.endAngle)*e,x:n.x+(t.x-n.x)*e,y:n.y+(t.y-n.y)*e,stops:new Array(i.length).fill(0).map(((o,s)=>({color:mx(i[s].color,r[s].color,e),offset:i[s].offset+(r[s].offset-i[s].offset)*e})))}}function DX(n,t,e){return[n[0]+(t[0]-n[0])*e,n[1]+(t[1]-n[1])*e,n[2]+(t[2]-n[2])*e,n[3]+(t[3]-n[3])*e]}function jM(n,t,e){return`rgba(${n[0]+(t[0]-n[0])*e},${n[1]+(t[1]-n[1])*e},${n[2]+(t[2]-n[2])*e},${n[3]+(t[3]-n[3])*e})`}const Ko=[0,0,0,0],Qu=[0,0,0,0];function mx(n,t,e){return Ai.Get(n,io.Color255,Ko),Ai.Get(t,io.Color255,Qu),`rgba(${Math.round(Ko[0]+(Qu[0]-Ko[0])*e)},${Math.round(Ko[1]+(Qu[1]-Ko[1])*e)},${Math.round(Ko[2]+(Qu[2]-Ko[2])*e)},${Ko[3]+(Qu[3]-Ko[3])*e})`}class wr{static GetCanvas(){try{return wr.canvas||(wr.canvas=mt.global.createCanvas({})),wr.canvas}catch{return null}}static GetCtx(){if(!wr.ctx){const t=wr.GetCanvas();wr.ctx=t.getContext("2d")}return wr.ctx}}class tl extends AG{static getInstance(){return tl._instance||(tl._instance=new tl),tl._instance}constructor(t=[],e=100){super(),this.cacheParams={CLEAN_THRESHOLD:100,L_TIME:1e3},this.dataMap=new Map;const i=wr.GetCanvas(),r=wr.GetCtx();if(i.width=e,i.height=1,!r)return;if(r.translate(0,0),!r)throw new Error("获取ctx发生错误");const o=r.createLinearGradient(0,0,e,0);t.forEach((s=>{o.addColorStop(s[0],s[1])})),r.fillStyle=o,r.fillRect(0,0,e,1),this.rgbaSet=r.getImageData(0,0,e,1).data}getColor(t){const e=this.rgbaSet.slice(4*t,4*t+4);return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`}GetOrCreate(t,e,i,r,o=[],s=100){let a=`${t}${e}${i}${r}`;o.forEach((h=>a+=h.join())),a+=s;let l=this.dataMap.get(a);return l||(l={data:new tl(o,s),timestamp:[]},this.addLimitedTimestamp(l,Date.now(),{}),this.dataMap.set(a,l)),this.clearCache(this.dataMap,this.cacheParams),l.data}}class Cn{static GetSize(t){for(let e=0;e<Cn.ImageSize.length;e++)if(Cn.ImageSize[e]>=t)return Cn.ImageSize[e];return t}static Get(t,e,i,r,o,s,a){const l=Cn.GenKey(t,e,i,r,o),h=Cn.cache[l];if(!h||h.length===0)return null;for(let u=0;u<h.length;u++)if(h[u].width>=s&&h[u].height>=a)return h[u].pattern;return null}static Set(t,e,i,r,o,s,a,l){const h=Cn.GenKey(t,e,i,r,o);Cn.cache[h]?Cn.cache[h].push({width:a,height:l,pattern:s}):Cn.cache[h]=[{width:a,height:l,pattern:s}]}static GenKey(t,e,i,r,o){return`${e},${i},${r},${o},${t.join()}`}}Cn.cache={},Cn.ImageSize=[20,40,80,160,320,640,1280,2560];function FX(n,t,e,i){const{stops:r,startAngle:o,endAngle:s}=i;for(;e<0;)e+=zt;for(;e>zt;)e-=zt;if(e<o||e>s)return r[0].color;let a,l,h=(e-o)/(s-o);for(let u=0;u<r.length;u++)if(r[u].offset>=h){a=r[u-1],l=r[u];break}return h=(h-a.offset)/(l.offset-a.offset),Il(a.color,l.color,h,!1)}function zX(n,t,e,i,r,o,s,a,l){const h=Math.floor(180*r/Math.PI),u=wr.GetCanvas(),d=wr.GetCtx();if(!d)return null;const c=Cn.GetSize(a),g=Cn.GetSize(l);let f=Cn.Get(t,e,i,o,s,c,g);if(f)return f;const p=Math.sqrt(Math.max(Math.max(Math.pow(e,2)+Math.pow(i,2),Math.pow(c-e,2)+Math.pow(i,2)),Math.max(Math.pow(c-e,2)+Math.pow(g-i,2),Math.pow(e,2)+Math.pow(g-i,2)))),m=h+1,v=r/Math.max(1,m-1),b=tl.getInstance().GetOrCreate(e,i,c,g,t,m),y=2*Math.PI*p/360;u.width=c,u.height=g,d.setTransform(1,0,0,1,0,0),d.clearRect(0,0,c,g),d.translate(e,i),d.rotate(o);for(let w=0,_=m-1;w<_&&!(o+w*v>s);w++){const A=b.getColor(w);d.beginPath(),d.rotate(v),d.moveTo(0,0),d.lineTo(p,-2*y),d.lineTo(p,0),d.fillStyle=A,d.closePath(),d.fill()}const C=d.getImageData(0,0,c,g);return u.width=C.width,u.height=C.height,d.putImageData(C,0,0),f=n.createPattern(u,"no-repeat"),f&&Cn.Set(t,e,i,o,s,f,c,g),f}const Jg=new Zi,NX=new wn;new Zi;const Dr=["lineWidth","scaleX","scaleY","angle","anchor","visible"],VM=["x","y"],GM=["scaleX","scaleY"],$M=["angle"],td=new Te,go={strokeSeg:1,boundsPadding:2,pickMode:1,boundsMode:1,customPickShape:1,pickable:1,childrenPickable:1,visible:1,zIndex:1,layout:1,keepDirIn3d:1,globalZIndex:1,outerBorder:1,innerBorder:1,lineDash:1,lineCap:1,lineJoin:1,miterLimit:2,strokeBoundsBuffer:2,scaleCenter:1,anchor:1,anchor3d:1,postMatrix:1,backgroundMode:2,background:1,texture:1,cursor:1,html:1};class Ni extends nU{static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const r=e[i];Object.defineProperty(Ni.prototype,r,Object.getOwnPropertyDescriptor(t,r))}}get AABBBounds(){return this.tryUpdateAABBBounds()}get OBBBounds(){return this.tryUpdateOBBBounds()}get globalAABBBounds(){return this.tryUpdateGlobalAABBBounds()}get transMatrix(){return this.tryUpdateLocalTransMatrix(!0)}get globalTransMatrix(){return this.tryUpdateGlobalTransMatrix(!0)}constructor(t={}){var e;super(),this._AABBBounds=new Zi,this._updateTag=Ae.INIT,this.attribute=t,this.valid=this.isValid(),this.updateAABBBoundsStamp=0,t.background?this.loadImage((e=t.background.background)!==null&&e!==void 0?e:t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic)}getGraphicService(){var t,e;return(e=(t=this.stage)===null||t===void 0?void 0:t.graphicService)!==null&&e!==void 0?e:mt.graphicService}getAttributes(){return this.attribute}setMode(t){t==="3d"?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}getOffsetXY(t,e=!1){var i,r;const{dx:o=t.dx,dy:s=t.dy}=this.attribute;if(e&&this.parent){const a=this.parent.attribute;td.x=o+((i=a.scrollX)!==null&&i!==void 0?i:0),td.y=s+((r=a.scrollY)!==null&&r!==void 0?r:0)}else td.x=o,td.y=s;return td}onAnimateBind(t){this._emitCustomEvent("animate-bind",t)}tryUpdateAABBBounds(){const t=this.attribute.boundsMode==="imprecise";if(!this.shouldUpdateAABBBounds())return this._AABBBounds;if(!this.valid)return this._AABBBounds.clear(),this._AABBBounds;this.getGraphicService().beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const e=this.doUpdateAABBBounds(t);return this.getGraphicService().afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,!0),this.attribute.boundsMode==="empty"&&e.clear(),e}tryUpdateOBBBounds(){return this._OBBBounds||(this._OBBBounds=new nx),this.tryUpdateAABBBounds(),this.updateOBBBoundsStamp===this.updateAABBBoundsStamp?this._OBBBounds:(this.updateOBBBoundsStamp=this.updateAABBBoundsStamp,this.valid?this.doUpdateOBBBounds():(this._OBBBounds.clear(),this._OBBBounds))}combindShadowAABBBounds(t){if(this.shadowRoot){const e=this.shadowRoot.AABBBounds.clone();t.union(e)}}doUpdateOBBBounds(){return this._OBBBounds}getClipPath(){const{clipConfig:t}=this.attribute;if(!t)return null;this.clipPathMap||(this.clipPathMap=new Map);const{shape:e}=t;let i=this.clipPathMap.get(e)||null;return i||(this.clipPathMap.size>10&&this.clipPathMap.clear(),i=this.parsePath(e),i&&this.clipPathMap.set(e,i)),i}parsePath(t){if(!t)return null;let e=bI[t];if(e||(e=Ni.userSymbolMap[t],e))return e;const i=aX[t];if(mX(t=i||t)===!0){const h=new lv,{svg:u}=h.parse(t);if(!u)return null;const d=ue(u.path)?u.path:[u.path];Jg.clear();const c=[];d.forEach((v=>{const b=new Fi().fromString(v.d),y={};SX.forEach((C=>{v[C]&&(y[SI[C]]=v[C])})),c.push({path:b,attribute:y}),Jg.union(b.bounds)}));const g=Jg.width(),f=Jg.height(),p=1/_s(g,f);c.forEach((v=>v.path.transform(0,0,p,p)));const m=new DM(t,c,!0);return Ni.userSymbolMap[t]=m,m}const r=new Fi().fromString(t),o=r.bounds.width(),s=r.bounds.height(),a=1/_s(o,s);r.transform(0,0,a,a);const l=new DM(t,r);return Ni.userSymbolMap[t]=l,l}doUpdateAABBBounds(t){this.updateAABBBoundsStamp++;const e=this.getGraphicTheme();this._AABBBounds.clear();const i=this.attribute,r=this.updateAABBBounds(i,e,this._AABBBounds,t),{boundsPadding:o=e.boundsPadding}=i,s=Lp(o);return s&&r.expand(s),this.clearUpdateBoundTag(),r}updatePathProxyAABBBounds(t){const e=typeof this.pathProxy=="function"?this.pathProxy(this.attribute):this.pathProxy;if(!e)return!1;const i=new rx(t);return Bs(e.commandList,i,0,0),!0}tryUpdateGlobalAABBBounds(){const t=this.AABBBounds;return this._globalAABBBounds?this._globalAABBBounds.setValue(t.x1,t.y1,t.x2,t.y2):this._globalAABBBounds=t.clone(),this._globalAABBBounds.empty()||this.parent&&this._globalAABBBounds.transformWithMatrix(this.parent.globalTransMatrix),this._globalAABBBounds}tryUpdateGlobalTransMatrix(t=!0){if(this._globalTransMatrix){if(this.parent){const e=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();return this.shouldUpdateGlobalMatrix()&&this.doUpdateGlobalMatrix(),this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!0}tryUpdateLocalTransMatrix(t=!0){return this._transMatrix||(this._transMatrix=new wn),this.shouldUpdateLocalMatrix()&&(this.doUpdateLocalMatrix(),t&&this.clearUpdateLocalPositionTag()),this._transMatrix}shouldUpdateAABBBounds(){return this.shadowRoot?(!!(this._updateTag&Ae.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds())&&this.getGraphicService().validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this):!!(this._updateTag&Ae.UPDATE_BOUNDS)&&this.getGraphicService().validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this)}shouldSelfChangeUpdateAABBBounds(){return this.shadowRoot?!!(this._updateTag&Ae.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds():!!(this._updateTag&Ae.UPDATE_BOUNDS)}shouldUpdateLocalMatrix(){return!!(this._updateTag&Ae.UPDATE_LOCAL_MATRIX)}isValid(){var t,e;const i=this.attribute;return Number.isFinite(((t=i.x)!==null&&t!==void 0?t:0)+((e=i.y)!==null&&e!==void 0?e:0))}_validNumber(t){return t==null||Number.isFinite(t)}shouldUpdateShape(){return!!(this._updateTag&Ae.UPDATE_SHAPE)}clearUpdateShapeTag(){this._updateTag&=Ae.CLEAR_SHAPE}containsPoint(t,e,i,r){if(!r)return!1;if(i===_c.GLOBAL){const o=new Te(t,e);this.parent&&this.parent.globalTransMatrix.transformPoint(o,o),t=o.x,e=o.y}return r.containsPoint(this,{x:t,y:e})}setWidthHeightWithoutTransform(t){this.widthWithoutTransform=t.x2-t.x1,this.heightWithoutTransform=t.y2-t.y1}setAttributesAndPreventAnimate(t,e=!1,i,r){this.setAttributes(t,e,i),this.animates&&this.animates.forEach((o=>{(o.priority!==1/0||r)&&Object.keys(t).forEach((s=>{o.preventAttr(s)}))}))}setAttributes(t,e=!1,i){t&&((t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t).background?this.loadImage(t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic),this._setAttributes(t,e,i))}_setAttributes(t,e=!1,i){const r=Object.keys(t);for(let o=0;o<r.length;o++){const s=r[o];this.attribute[s]=t[s]}this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(r)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i)}setAttribute(t,e,i,r){var o;const s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,r);s?this._setAttributes(s,i,r):ze((o=this.normalAttrs)===null||o===void 0?void 0:o[t])?(this.attribute[t]=e,this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r)):this.normalAttrs[t]=e,t==="background"?this.loadImage(e,!0):t==="shadowGraphic"&&this.setShadowGraphic(e)}needUpdateTags(t,e=Dr){for(let i=0;i<e.length;i++){const r=e[i];if(t.indexOf(r)!==-1)return!0}return!1}needUpdateTag(t,e=Dr){for(let i=0;i<e.length;i++)if(t===e[i])return!0;return!1}initAttributes(t){const e={type:Tn.INIT};t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,e)||t,this.attribute=t,t.background?this.loadImage(t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic),this._updateTag=Ae.INIT,this.valid=this.isValid(),this.onAttributeUpdate(e)}translate(t,e){var i,r;if(t===0&&e===0)return this;const o={type:Tn.TRANSLATE},s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,VM,o);s&&(t=s.x,e=s.y,delete s.x,delete s.y,this._setAttributes(s));const a=this.attribute,l=a.postMatrix;return l?mt.transformUtil.fromMatrix(l,l).translate(t,e):(a.x=((i=a.x)!==null&&i!==void 0?i:Vi.x)+t,a.y=((r=a.y)!==null&&r!==void 0?r:Vi.y)+e),this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o),this}translateTo(t,e){const i=this.attribute;if(i.x===t&&i.y===e)return this;const r={type:Tn.TRANSLATE_TO},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,VM,r);return o?(this._setAttributes(o,!1,r),this):(i.x=t,i.y=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this)}scale(t,e,i){var r,o;if(t===1&&e===1)return this;const s={type:Tn.SCALE},a=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e,scaleCenter:i},this.attribute,GM,s);a&&(t=a.scaleX,e=a.scaleY,delete a.scaleX,delete a.scaleY,this._setAttributes(a));const l=this.attribute;if(i){let{postMatrix:h}=this.attribute;h||(h=new wn,l.postMatrix=h),mt.transformUtil.fromMatrix(h,h).scale(t,e,i)}else l.scaleX=((r=l.scaleX)!==null&&r!==void 0?r:Vi.scaleX)*t,l.scaleY=((o=l.scaleY)!==null&&o!==void 0?o:Vi.scaleY)*e;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(s),this}scaleTo(t,e){const i=this.attribute;if(i.scaleX===t&&i.scaleY===e)return this;const r={type:Tn.SCALE_TO},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e},this.attribute,GM,r);return o?(this._setAttributes(o,!1,r),this):(i.scaleX=t,i.scaleY=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this)}rotate(t,e){var i;if(t===0)return this;const r={type:Tn.ROTATE},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({angle:t,rotateCenter:e},this.attribute,$M,r);o&&(delete o.angle,this._setAttributes(o,!1,r));const s=this.attribute;if(e){let{postMatrix:a}=this.attribute;a||(a=new wn,s.postMatrix=a),mt.transformUtil.fromMatrix(a,a).rotate(t,e)}else s.angle=((i=s.angle)!==null&&i!==void 0?i:Vi.angle)+t;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this}rotateTo(t){const e=this.attribute;if(e.angle===t)return this;const i={type:Tn.ROTATE_TO},r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,$M,i);return r?(this._setAttributes(r,!1,i),this):(e.angle=t,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i),this)}skewTo(t,e){return this}onAttributeUpdate(t){t&&t.skipUpdateCallback||(this.getGraphicService().onAttributeUpdate(this),this._emitCustomEvent("afterAttributeUpdate",t))}update(t){t?(t.bounds&&this.tryUpdateAABBBounds(),t.trans&&this.tryUpdateLocalTransMatrix()):(this.tryUpdateAABBBounds(),this.tryUpdateLocalTransMatrix())}hasState(t){return!(!this.currentStates||!this.currentStates.length)&&(!!ze(t)||this.currentStates.includes(t))}getState(t){var e;return(e=this.states)===null||e===void 0?void 0:e[t]}applyStateAttrs(t,e,i,r){var o,s;if(i){const a=Object.keys(t),l=this.getNoWorkAnimateAttr(),h={};let u;a.forEach((c=>{l[c]?(u||(u={}),u[c]=t[c]):h[c]=r&&t[c]===void 0?this.getDefaultAttribute(c):t[c]}));const d=(s=(o=this.context&&this.context.stateAnimateConfig)!==null&&o!==void 0?o:this.stateAnimateConfig)!==null&&s!==void 0?s:AX;this.applyAnimationState(["state"],[{name:"state",animation:{type:"state",to:h,duration:d.duration,easing:d.easing}}]),u&&this.setAttributesAndPreventAnimate(u,!1,{type:Tn.STATE})}else this.stopStateAnimates(),this.setAttributesAndPreventAnimate(t,!1,{type:Tn.STATE}),this.finalAttribute&&Object.assign(this.finalAttribute,t);this._emitCustomEvent("afterStateUpdate",{type:Tn.STATE})}updateNormalAttrs(t){const e={};this.normalAttrs?(Object.keys(t).forEach((i=>{i in this.normalAttrs?(e[i]=this.normalAttrs[i],delete this.normalAttrs[i]):e[i]=this.getNormalAttribute(i)})),Object.keys(this.normalAttrs).forEach((i=>{t[i]=this.normalAttrs[i]}))):Object.keys(t).forEach((i=>{e[i]=this.getNormalAttribute(i)})),this.normalAttrs=e}stopStateAnimates(t="end"){this.animates&&this.animates.forEach((e=>{e.stateNames&&(e.stop(t),this.animates.delete(e.id))}))}getNormalAttribute(t){var e,i;const r=this.attribute[t];return this.animates?(e=this.finalAttribute)===null||e===void 0?void 0:e[t]:r??((i=this.finalAttribute)===null||i===void 0?void 0:i[t])}clearStates(t){this.hasState()&&this.normalAttrs?(this.currentStates=[],this.applyStateAttrs(this.normalAttrs,this.currentStates,t,!0)):this.currentStates=[],this.normalAttrs=null}removeState(t,e){if(this.currentStates){const i=ue(t)?o=>!t.includes(o):o=>o!==t,r=this.currentStates.filter(i);r.length!==this.currentStates.length&&this.useStates(r,e)}}toggleState(t,e){if(this.hasState(t))this.removeState(t,e);else if((this.currentStates?this.currentStates.indexOf(t):-1)<0){const i=this.currentStates?this.currentStates.slice():[];i.push(t),this.useStates(i,e)}}addState(t,e,i){var r;if(this.currentStates&&this.currentStates.includes(t)&&(e||this.currentStates.length===1))return;const o=e&&(!((r=this.currentStates)===null||r===void 0)&&r.length)?this.currentStates.concat([t]):[t];this.useStates(o,i)}useStates(t,e){var i;if(!t.length)return void this.clearStates(e);if(!(((i=this.currentStates)===null||i===void 0?void 0:i.length)!==t.length||t.some(((o,s)=>this.currentStates[s]!==o))))return;const r={};t.forEach((o=>{var s;const a=this.stateProxy?this.stateProxy(o,t):(s=this.states)===null||s===void 0?void 0:s[o];a&&Object.assign(r,a)})),this.updateNormalAttrs(r),this.currentStates=t,this.applyStateAttrs(r,t,e)}addUpdateBoundTag(){this._updateTag|=Ae.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}addUpdateShapeTag(){this._updateTag|=Ae.UPDATE_SHAPE}addUpdateShapeAndBoundsTag(){this._updateTag|=Ae.UPDATE_SHAPE_AND_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}updateShapeAndBoundsTagSetted(){return(this._updateTag&Ae.UPDATE_SHAPE_AND_BOUNDS)===Ae.UPDATE_SHAPE_AND_BOUNDS}clearUpdateBoundTag(){this._updateTag&=Ae.CLEAR_BOUNDS}addUpdatePositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=Ae.UPDATE_GLOBAL_LOCAL_MATRIX}addUpdateGlobalPositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=Ae.UPDATE_GLOBAL_MATRIX}clearUpdateLocalPositionTag(){this._updateTag&=Ae.CLEAR_LOCAL_MATRIX}clearUpdateGlobalPositionTag(){this._updateTag&=Ae.CLEAR_GLOBAL_MATRIX}addUpdateLayoutTag(){this._updateTag|=Ae.UPDATE_LAYOUT}clearUpdateLayoutTag(){this._updateTag&=Ae.CLEAR_LAYOUT}needUpdateLayout(){return!!(this._updateTag&Ae.UPDATE_LAYOUT)}getAnchor(t,e,i){const r=[0,0],o=()=>{if(e.b)return e.b;const s=this.clone();return s.attribute.angle=0,s.attribute.scaleCenter=null,i&&(s.attribute.scaleX=1,s.attribute.scaleY=1),e.b=s.AABBBounds,e.b};if(typeof t[0]=="string"){const s=parseFloat(t[0])/100,a=o();r[0]=a.x1+(a.x2-a.x1)*s}else r[0]=t[0];if(typeof t[1]=="string"){const s=parseFloat(t[1])/100,a=o();r[1]=a.y1+(a.y2-a.y1)*s}else r[1]=t[1];return r}doUpdateLocalMatrix(){const{x:t=Vi.x,y:e=Vi.y,scaleX:i=Vi.scaleX,scaleY:r=Vi.scaleY,angle:o=Vi.angle,scaleCenter:s,anchor:a,postMatrix:l}=this.attribute;let h=[0,0];const u={};if(a&&o&&(h=this.getAnchor(a,u)),!s||i===1&&r===1)SG(this._transMatrix,this._transMatrix.reset(),t,e,i,r,o,a&&h);else{const c=this._transMatrix;c.reset(),c.translate(h[0],h[1]),c.rotate(o),c.translate(-h[0],-h[1]),c.translate(t,e),h=this.getAnchor(s,u,!0),mt.transformUtil.fromMatrix(c,c).scale(i,r,{x:h[0],y:h[1]})}const d=this.getOffsetXY(Vi);if(this._transMatrix.e+=d.x,this._transMatrix.f+=d.y,l){const c=NX.setValue(l.a,l.b,l.c,l.d,l.e,l.f),g=this._transMatrix;c.multiply(g.a,g.b,g.c,g.d,g.e,g.f),g.setValue(c.a,c.b,c.c,c.d,c.e,c.f)}}doUpdateGlobalMatrix(){if(this.parent){this._globalTransMatrix.multiply(this.transMatrix.a,this.transMatrix.b,this.transMatrix.c,this.transMatrix.d,this.transMatrix.e,this.transMatrix.f);const{scrollX:t=0,scrollY:e=0}=this.parent.attribute;this._globalTransMatrix.translate(t,e)}}setStage(t,e){if(this.stage!==t){if(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this.animates&&this.animates.size){const i=t.getTimeline();this.animates.forEach((r=>{r.timeline.isGlobal&&(r.setTimeline(i),i.addAnimate(r))}))}this._onSetStage&&this._onSetStage(this,t,e),this.getGraphicService().onSetStage(this,t)}}setStageToShadowRoot(t,e){this.shadowRoot&&this.shadowRoot.setStage(t,e)}onAddStep(t){}onStop(t){t&&this.setAttributes(t,!1,{type:Tn.ANIMATE_END})}getDefaultAttribute(t){return this.getGraphicTheme()[t]}getComputedAttribute(t){var e;return(e=this.attribute[t])!==null&&e!==void 0?e:this.getDefaultAttribute(t)}onSetStage(t,e=!1){this._onSetStage=t,e&&this.stage&&t(this,this.stage)}attachShadow(t){return t&&(t.shadowHost=this),this.shadowRoot=t??mt.graphicService.creator.shadowRoot(this),this.addUpdateBoundTag(),this.shadowRoot.setStage(this.stage,this.layer),this.shadowRoot}detachShadow(){this.shadowRoot&&(this.addUpdateBoundTag(),this.shadowRoot.release(!0),this.shadowRoot=null)}toJson(){return{attribute:this.attribute,_uid:this._uid,type:this.type,name:this.name,children:this.children.map((t=>t.toJson()))}}createPathProxy(t){return Oo(t,!0)?this.pathProxy=new Fi().fromString(t):this.pathProxy=new Fi,this.pathProxy}loadImage(t,e=!1){if(!t||e&&WX(t))return;const i=t;this.resources||(this.resources=new Map);const r={data:"init",state:null};this.resources.set(i,r),typeof t=="string"?(r.state="loading",t.startsWith("<svg")?(Se.GetSvg(t,this),this.backgroundImg=this.backgroundImg||e):(hG(t)||t.includes("/")||uG(t))&&(Se.GetImage(t,this),this.backgroundImg=this.backgroundImg||e)):Ja(t)?(r.state="success",r.data=t,this.backgroundImg=this.backgroundImg||e):r.state="fail"}setShadowGraphic(t){t?this.attachShadow().add(t):this.detachShadow()}imageLoadSuccess(t,e,i){if(!this.resources)return;const r=this.resources.get(t);r&&(r.state="success",r.data=e,i&&i(),this.addUpdateBoundTag(),this.stage&&this.stage.renderNextFrame())}imageLoadFail(t,e){if(!this.resources)return;const i=this.resources.get(t);i&&(i.state="fail",e&&e())}_stopAnimates(t){t&&t.forEach((e=>{e.stop()}))}stopAnimates(t=!1){this._stopAnimates(this.animates),this.shadowRoot&&this.shadowRoot.stopAnimates(!0),this.isContainer&&t&&this.forEachChildren((e=>{e.stopAnimates(t)}))}release(){this.releaseStatus="released",this.stopAnimates(),mt.graphicService.onRelease(this)}_emitCustomEvent(t,e){var i,r;if(this._events&&t in this._events){const o=new lx(t,e);o.bubbles=!1,o.manager=(r=(i=this.stage)===null||i===void 0?void 0:i.eventSystem)===null||r===void 0?void 0:r.manager,this.dispatchEvent(o)}}toCustomPath(){var t,e,i;const r=(i=(e=((t=this.stage)===null||t===void 0?void 0:t.renderService)||mt.renderService)===null||e===void 0?void 0:e.drawContribution)===null||i===void 0?void 0:i.getRenderContribution(this);if(r){const o=new H_(null,1);return r.drawShape(this,o,0,0,{},{}),o.path}return null}}function WX(n){return!(!n.fill&&!n.stroke)}Ni.userSymbolMap={},Ni.mixin(oU);var UM;(function(n){n[n.LESS_GROUP=0]="LESS_GROUP",n[n.MORE_GROUP=1]="MORE_GROUP"})(UM||(UM={}));let Jt=class D_ extends Ni{constructor(t){super(t),this.type="group",this.parent=null,this.isContainer=!0,this.numberType=ux,this._childUpdateTag=Ae.UPDATE_BOUNDS}setMode(t){t==="3d"?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}setTheme(t){return this.theme||(this.theme=new Mc),this.theme.setTheme(t,this)}createTheme(){this.theme||(this.theme=new Mc)}visibleAll(t){this.setAttribute("visible",t),this.forEachChildren((e=>{e.isContainer&&e.visibleAll?e.visibleAll(t):e.setAttribute("visible",t)}))}hideAll(){this.visibleAll(!1)}showAll(){this.visibleAll(!0)}containsPoint(t,e,i){if(i===_c.GLOBAL){const r=new Te(t,e);return this.parent&&this.parent.globalTransMatrix.transformPoint(r,r),this.AABBBounds.contains(r.x,r.y)}return this.AABBBounds.contains(t,e)}shouldUpdateAABBBounds(){return!!super.shouldUpdateAABBBounds()||!!(this._childUpdateTag&Ae.UPDATE_BOUNDS)}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;this.getGraphicService().beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),this.getGraphicService().afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,t),this.attribute.boundsMode==="empty"&&e.clear(),e}doUpdateLocalMatrix(){const{x:t=Vi.x,y:e=Vi.y,dx:i=Vi.dx,dy:r=Vi.dy,scaleX:o=Vi.scaleX,scaleY:s=Vi.scaleY,angle:a=Vi.angle,postMatrix:l}=this.attribute;if(t!==0||e!==0||i!==0||r!==0||o!==1||s!==1||a!==0||l)return super.doUpdateLocalMatrix();this._transMatrix.reset()}getGraphicTheme(){return Wt(this).group}updateAABBBounds(t,e,i){const r=i;i=i.clone();const{width:o,height:s,path:a,clip:l=e.clip}=t;if(a&&a.length?a.forEach((h=>{i.union(h.AABBBounds)})):o!=null&&s!=null&&i.set(0,0,Math.max(0,o),Math.max(0,s)),!l){this.forEachChildren((d=>{i.union(d.AABBBounds)}));const{scrollX:h=0,scrollY:u=0}=t;i.translate(h,u)}return mt.graphicService.updateTempAABBBounds(i),mt.graphicService.transformAABBBounds(t,i,e,!1,this),r.copy(i),r}doUpdateAABBBounds(){this.updateAABBBoundsStamp++;const t=super.doUpdateAABBBounds();return this.parent&&this.parent.addChildUpdateBoundTag(),this._emitCustomEvent("AAABBBoundsChange"),t}clearUpdateBoundTag(){this._updateTag&=Ae.CLEAR_BOUNDS,this._childUpdateTag&=Ae.CLEAR_BOUNDS}addUpdateBoundTag(){this._updateTag|=Ae.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag()}addChildUpdateBoundTag(){this._childUpdateTag&Ae.UPDATE_BOUNDS||(this._childUpdateTag|=Ae.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag())}getTheme(){return this.theme.getTheme(this)}incrementalAppendChild(t){const e=super.appendChild(t);return this.stage&&e&&(e.stage=this.stage,e.layer=this.layer),this.addUpdateBoundTag(),this.getGraphicService().onAddIncremental(t,this,this.stage),e}incrementalClearChild(){super.removeAllChild(),this.addUpdateBoundTag(),this.getGraphicService().onClearIncremental(this,this.stage)}_updateChildToStage(t){return this.stage&&t&&t.setStage(this.stage,this.layer),this.addUpdateBoundTag(),t}appendChild(t,e=!0){const i=super.appendChild(t);return e&&this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}insertBefore(t,e){return this._updateChildToStage(super.insertBefore(t,e))}insertAfter(t,e){return this._updateChildToStage(super.insertAfter(t,e))}insertInto(t,e){return this._updateChildToStage(super.insertInto(t,e))}removeChild(t){const e=super.removeChild(t);return this.getGraphicService().onRemove(t),t.stage=null,this.addUpdateBoundTag(),e}removeAllChild(t=!1){this.forEachChildren((e=>{this.getGraphicService().onRemove(e),t&&e.isContainer&&e.removeAllChild(t)})),super.removeAllChild(),this.addUpdateBoundTag()}setStage(t,e){this.stage!==t&&(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this._onSetStage&&this._onSetStage(this,t,e),this.getGraphicService().onSetStage(this,t),this.forEachChildren((i=>{i.setStage(t,this.layer)})))}addUpdatePositionTag(){super.addUpdatePositionTag(),this.forEachChildren((t=>{t.isContainer&&t.addUpdateGlobalPositionTag()}))}addUpdateGlobalPositionTag(){super.addUpdateGlobalPositionTag(),this.forEachChildren((t=>{t.isContainer&&t.addUpdateGlobalPositionTag()}))}tryUpdateGlobalTransMatrix(t=!0){if(this.shouldUpdateGlobalMatrix()){if(this._globalTransMatrix){if(this.parent){const e=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!!(this._updateTag&Ae.UPDATE_GLOBAL_MATRIX)}_getChildByName(t,e){return this.find((i=>i.name===t),e)}createOrUpdateChild(t,e,i){let r=this._getChildByName(t);return r?r.setAttributes(e):(r=mt.graphicService.creator[i](e),r.name=t,this.add(r)),r}clone(){return new D_(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return D_.NOWORK_ANIMATE_ATTR}release(t){t&&this.forEachChildren((e=>{e.release(t)})),super.release()}};Jt.NOWORK_ANIMATE_ATTR=go;function Ip(n){return new Jt(n)}class jX extends Jt{get offscreen(){return this.layerHandler.offscreen}get layerMode(){return this.layerHandler.type}get width(){return this.stage?this.stage.width:0}get height(){return this.stage?this.stage.height:0}get viewWidth(){return this.stage?this.stage.viewWidth:0}get viewHeight(){return this.stage?this.stage.viewHeight:0}get dirtyBound(){throw new Error("暂不支持")}get dpr(){return this._dpr}constructor(t,e,i,r){var o;super({}),this.stage=t,this.global=e,this.window=i,this.main=r.main,this.layerHandler=r.layerHandler,this.layerHandler.init(this,i,{main:r.main,canvasId:r.canvasId,width:this.viewWidth,height:this.viewHeight,zIndex:(o=r.zIndex)!==null&&o!==void 0?o:0}),this.layer=this,this.subLayers=new Map,this.theme=new Mc,this.background="rgba(0, 0, 0, 0)",this.afterDrawCbs=[]}combineSubLayer(t=!0){const e=Array.from(this.subLayers.values()).sort(((i,r)=>i.zIndex-r.zIndex));this.layerHandler.merge(e.map((i=>(i.layer.subLayers.size&&i.layer.combineSubLayer(t),i.layer.getNativeHandler())))),t&&e.forEach((i=>{i.group&&(i.group.incremental=0)})),e.forEach((i=>{mt.layerService.releaseLayer(this.stage,i.layer)})),this.subLayers.clear()}getNativeHandler(){return this.layerHandler}setStage(t,e){super.setStage(t,this)}pick(t,e){throw new Error("暂不支持")}tryRenderSecondaryLayer(t,e){this.layerHandler.secondaryHandlers&&this.layerHandler.secondaryHandlers.length&&this.layerHandler.secondaryHandlers.forEach((i=>{i.layer.renderCount=this.renderCount,i.layer.render(t,e)}))}render(t,e){var i;this.layerHandler.render([this],{renderService:t.renderService,stage:this.stage,layer:this,viewBox:t.viewBox,transMatrix:t.transMatrix,background:(i=t.background)!==null&&i!==void 0?i:this.background,updateBounds:t.updateBounds},e),this.afterDrawCbs.forEach((r=>r(this))),this.tryRenderSecondaryLayer(t,e)}resize(t,e){this.layerHandler.resize(t,e)}resizeView(t,e){this.layerHandler.resizeView(t,e)}setDpr(t){this.layerHandler.setDpr(t)}afterDraw(t){this.afterDrawCbs.push(t)}startAnimate(t){throw new Error("暂不支持")}setToFrame(t){throw new Error("暂不支持")}prepare(t,e){}release(){super.release(),this.layerHandler.release(),this.subLayers&&this.subLayers.forEach((t=>{mt.layerService.releaseLayer(this.stage,t.layer)}))}drawTo(t,e){var i;this.layerHandler.drawTo(t,[this],Object.assign({background:(i=e.background)!==null&&i!==void 0?i:this.background,renderService:e.renderService,viewBox:e.viewBox,transMatrix:e.transMatrix,stage:this.stage,layer:this},e)),this.afterDrawCbs.forEach((r=>r(this)))}}const MI=Symbol.for("TransformUtil"),TI=Symbol.for("GraphicUtil"),vx=Symbol.for("LayerService"),RI=Symbol.for("StaticLayerHandlerContribution"),VX=Symbol.for("DynamicLayerHandlerContribution"),GX=Symbol.for("VirtualLayerHandlerContribution");var yd,$X=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},UX=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let Cd=yd=class{static GenerateLayerId(){return`${yd.idprefix}_${yd.prefix_count++}`}constructor(){this.layerMap=new Map,this.global=mt.global}tryInit(){this.inited||(this.staticLayerCountInEnv=this.global.getStaticCanvasCount(),this.dynamicLayerCountInEnv=this.global.getDynamicCanvasCount(),this.inited=!0)}getStageLayer(n){return this.layerMap.get(n)}getRecommendedLayerType(n){return n||(this.staticLayerCountInEnv!==0?"static":this.dynamicLayerCountInEnv!==0?"dynamic":"virtual")}getLayerHandler(n){let t;return t=n==="static"?Et.get(RI):n==="dynamic"?Et.get(VX):Et.get(GX),t}createLayer(n,t={main:!1}){var e;this.tryInit();let i=this.getRecommendedLayerType(t.layerMode);i=t.main||t.canvasId?"static":i;const r=this.getLayerHandler(i),o=new jX(n,this.global,n.window,Object.assign(Object.assign({main:!1},t),{layerMode:i,canvasId:(e=t.canvasId)!==null&&e!==void 0?e:yd.GenerateLayerId(),layerHandler:r})),s=this.layerMap.get(n)||[];return s.push(o),this.layerMap.set(n,s),this.staticLayerCountInEnv--,o}prepareStageLayer(n){let t;n.forEachChildren((e=>{const i=e.getNativeHandler();i.type==="virtual"?(i.mainHandler=t,t.secondaryHandlers.push(i)):(t=i,t.secondaryHandlers=[])}))}releaseLayer(n,t){t.release();const e=this.layerMap.get(n)||[];this.layerMap.set(n,e.filter((i=>i!==t)))}layerCount(n){return(this.layerMap.get(n)||[]).length}restLayerCount(n){return this.global.env==="browser"?10:0}releaseStage(n){this.layerMap.delete(n)}};Cd.idprefix="visactor_layer",Cd.prefix_count=0,Cd=yd=$X([pt(),UX("design:paramtypes",[])],Cd);const XX=new Ot((n=>{n(tx).to(x_).inSingletonScope(),n(Ac).to(B_),n(TI).to(k_).inSingletonScope(),n(MI).to(P_).inSingletonScope(),n(vx).to(Cd).inSingletonScope()}));function vu(n,t){return!(!n&&!t)}function Tc(n,t){let e;return e=ue(n)?n.some((i=>i||i===void 0)):!!n,e&&t>0}function Hl(n,t,e){return e&&n*t>0}function BI(n,t,e,i,r){return r&&n*t>0&&e!==0&&i!==0}function F_(n,t){return n*t>0}function kI(n,t,e,i,r){return r?n*t>0:n*t>0&&e!==0&&i!==0}function YX(n,t,e,i,r,o,s,a){const l=e-n,h=i-t,u=s-r,d=a-o;let c=d*l-u*h;return c*c<Pe?[]:(c=(u*(t-o)-d*(n-r))/c,[n+c*l,t+c*h])}function ia(n,t,e,i,r,o,s){const a=n-e,l=t-i,h=(s?o:-o)/Math.sqrt(a*a+l*l),u=h*l,d=-h*a,c=n+u,g=t+d,f=e+u,p=i+d,m=(c+f)/2,v=(g+p)/2,b=f-c,y=p-g,C=b*b+y*y,w=r-o,_=c*p-f*g,A=(y<0?-1:1)*Math.sqrt(Math.max(0,w*w*C-_*_));let x=(_*y-b*A)/C,S=(-_*b-y*A)/C;const T=(_*y+b*A)/C,M=(-_*b+y*A)/C,R=x-m,E=S-v,P=T-m,B=M-v;return R*R+E*E>P*P+B*B&&(x=T,S=M),{cx:x,cy:S,x01:-u,y01:-d,x11:x*(r/w-1),y11:S*(r/w-1)}}function PI(n,t,e,i,r){const o=ge(e-t),s=n.getParsedCornerRadius(),a=ue(s),{outerDeltaAngle:l,innerDeltaAngle:h,outerStartAngle:u,outerEndAngle:d,innerEndAngle:c,innerStartAngle:g}=n.getParsePadAngle(t,e),f=a?s[0]:s,p=a?s[1]:s,m=a?s[2]:s,v=a?s[3]:s,b=Math.max(p,f),y=Math.max(m,v);let C=b,w=y;const _=r*Mi(u),A=r*Ue(u),x=i*Mi(c),S=i*Ue(c);let T,M,R,E;if((y>Pe||b>Pe)&&(T=r*Mi(d),M=r*Ue(d),R=i*Mi(g),E=i*Ue(g),o<si)){const P=YX(_,A,R,E,T,M,x,S);if(P){const B=_-P[0],k=A-P[1],L=T-P[0],O=M-P[1],I=1/Ue(vG((B*L+k*O)/(eo(B*B+k*k)*eo(L*L+O*O)))/2),H=eo(P[0]*P[0]+P[1]*P[1]);w=gn(y,(i-H)/(I-1)),C=gn(b,(r-H)/(I+1))}}return{outerDeltaAngle:l,xors:_,yors:A,xirs:R,yirs:E,xore:T,yore:M,xire:x,yire:S,limitedOcr:C,limitedIcr:w,outerCornerRadiusStart:f,outerCornerRadiusEnd:p,maxOuterCornerRadius:b,maxInnerCornerRadius:y,outerStartAngle:u,outerEndAngle:d,innerDeltaAngle:h,innerEndAngle:c,innerStartAngle:g,innerCornerRadiusStart:v,innerCornerRadiusEnd:m}}function z_(n,t,e,i,r,o,s){const{startAngle:a,endAngle:l}=n.getParsedAngle(),h=ge(l-a),u=l>a;let d=!1;if(r<o){const c=r;r=o,o=c}if(r<=Pe)t.moveTo(e,i);else if(h>=zt-Pe)t.moveTo(e+r*Mi(a),i+r*Ue(a)),t.arc(e,i,r,a,l,!u),o>Pe&&(t.moveTo(e+o*Mi(l),i+o*Ue(l)),t.arc(e,i,o,l,a,u));else{const{outerDeltaAngle:c,xors:g,yors:f,xirs:p,yirs:m,limitedOcr:v,outerCornerRadiusStart:b,outerCornerRadiusEnd:y,maxOuterCornerRadius:C,xore:w,yore:_,xire:A,yire:x,outerStartAngle:S,outerEndAngle:T,limitedIcr:M,innerDeltaAngle:R,innerEndAngle:E,innerStartAngle:P,innerCornerRadiusStart:B,innerCornerRadiusEnd:k,maxInnerCornerRadius:L}=PI(n,a,l,o,r);if(c<.001)s&&(s[3]||s[1])&&t.moveTo(e+g,i+f),d=!0;else if(v>Pe){const O=gn(b,v),I=gn(y,v),H=ia(p,m,g,f,r,O,Number(u)),D=ia(w,_,A,x,r,I,Number(u));v<C&&O===I?!s||s[0]?(t.moveTo(e+H.cx+H.x01,i+H.cy+H.y01),t.arc(e+H.cx,i+H.cy,v,de(H.y01,H.x01),de(D.y01,D.x01),!u)):t.moveTo(e+H.cx+v*Mi(de(D.y01,D.x01)),i+H.cy+v*Ue(de(D.y01,D.x01))):!s||s[0]?(t.moveTo(e+H.cx+H.x01,i+H.cy+H.y01),O>0&&t.arc(e+H.cx,i+H.cy,O,de(H.y01,H.x01),de(H.y11,H.x11),!u),t.arc(e,i,r,de(H.cy+H.y11,H.cx+H.x11),de(D.cy+D.y11,D.cx+D.x11),!u),I>0&&t.arc(e+D.cx,i+D.cy,I,de(D.y11,D.x11),de(D.y01,D.x01),!u)):I>0?t.moveTo(e+D.cx+I*Mi(de(D.y01,D.x01)),i+D.cy+I*Ue(de(D.y01,D.x01))):t.moveTo(e+w,i+r*Ue(T))}else!s||s[0]?(t.moveTo(e+g,i+f),t.arc(e,i,r,S,T,!u)):t.moveTo(e+r*Mi(T),i+r*Ue(T));if(!(o>Pe)||R<.001)!s||s[1]?t.lineTo(e+A,i+x):t.moveTo(e+A,i+x),d=!0;else if(M>Pe){const O=gn(B,M),I=gn(k,M),H=ia(A,x,w,_,o,-I,Number(u)),D=ia(g,f,p,m,o,-O,Number(u));if(!s||s[1]?t.lineTo(e+H.cx+H.x01,i+H.cy+H.y01):t.moveTo(e+H.cx+H.x01,i+H.cy+H.y01),M<L&&O===I){const z=de(D.y01,D.x01);!s||s[2]?t.arc(e+H.cx,i+H.cy,M,de(H.y01,H.x01),z,!u):t.moveTo(e+H.cx+Mi(z),i+H.cy+Ue(z))}else!s||s[2]?(I>0&&t.arc(e+H.cx,i+H.cy,I,de(H.y01,H.x01),de(H.y11,H.x11),!u),t.arc(e,i,o,de(H.cy+H.y11,H.cx+H.x11),de(D.cy+D.y11,D.cx+D.x11),u),O>0&&t.arc(e+D.cx,i+D.cy,O,de(D.y11,D.x11),de(D.y01,D.x01),!u)):O>0?t.moveTo(e+D.cx+O*Mi(de(D.y01,D.x01)),i+D.cy+O*Ue(de(D.y01,D.x01))):t.moveTo(e+p,i+m)}else!s||s[1]?t.lineTo(e+A,i+x):t.moveTo(e+A,i+x),!s||s[2]?t.arc(e,i,o,E,P,u):t.moveTo(e+o*Mi(P),i+o*Ue(P))}return s?s[3]&&t.lineTo(e+r*Mi(a),i+r*Ue(a)):t.closePath(),d}const N_=Symbol.for("ArcRenderContribution"),qX=Symbol.for("AreaRenderContribution"),W_=Symbol.for("CircleRenderContribution"),mr=Symbol.for("GroupRenderContribution"),hl=Symbol.for("ImageRenderContribution"),j_=Symbol.for("PathRenderContribution"),V_=Symbol.for("PolygonRenderContribution"),ul=Symbol.for("RectRenderContribution"),G_=Symbol.for("SymbolRenderContribution"),Hp=Symbol.for("TextRenderContribution"),bx=Symbol.for("InteractiveSubRenderContribution");function bu(n,t){return n==="end"||n==="right"?-t:n==="center"?-t/2:0}function Rc(n,t,e,i=0){return n==="middle"?-t/2:n==="top"?0:n==="bottom"?i-t:n&&n!=="alphabetic"?0:(e||(e=t),-(t-e)/2-.79*e)}var KX=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},ZX=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},JX=function(n,t){return function(e,i){t(e,i,n)}};function EI(n,t,e){var i;const{x:r=e.x,y:o=e.y,z:s=e.z,dx:a=e.dx,dy:l=e.dy,dz:h=e.dz,scaleX:u=e.scaleX,scaleY:d=e.scaleY,scaleZ:c=e.scaleZ,alpha:g=e.alpha,beta:f=e.beta,angle:p=e.angle,anchor3d:m=t.attribute.anchor,anchor:v}=t.attribute,b=[0,0,0];if(m){if(typeof m[0]=="string"){const y=parseFloat(m[0])/100,C=t.AABBBounds;b[0]=C.x1+(C.x2-C.x1)*y}else b[0]=m[0];if(typeof m[1]=="string"){const y=parseFloat(m[1])/100,C=t.AABBBounds;b[1]=C.x1+(C.x2-C.x1)*y}else b[1]=m[1];b[2]=(i=m[2])!==null&&i!==void 0?i:0}if(AI(n),Ju(n,n,[r+a,o+l,s+h]),Ju(n,n,[b[0],b[1],b[2]]),MX(n,n,f),TX(n,n,g),Ju(n,n,[-b[0],-b[1],b[2]]),BX(n,n,[u,d,c]),p){const y=Bi.allocate(),C=[0,0];if(v){if(typeof m[0]=="string"){const w=parseFloat(m[0])/100,_=t.AABBBounds;C[0]=_.x1+(_.x2-_.x1)*w}else C[0]=m[0];if(typeof m[1]=="string"){const w=parseFloat(m[1])/100,_=t.AABBBounds;C[1]=_.x1+(_.x2-_.x1)*w}else C[1]=m[1]}Ju(y,y,[C[0],C[1],0]),RX(y,y,p),Ju(y,y,[-C[0],-C[1],0]),hg(n,n,y)}}function QX(n){const{alpha:t,beta:e}=n.attribute;return t||e}let $_=class{constructor(n){this.creator=n,this.hooks={onAttributeUpdate:new yn(["graphic"]),onSetStage:new yn(["graphic","stage"]),onRemove:new yn(["graphic"]),onRelease:new yn(["graphic"]),onAddIncremental:new yn(["graphic","group","stage"]),onClearIncremental:new yn(["graphic","group","stage"]),beforeUpdateAABBBounds:new yn(["graphic","stage","willUpdate","aabbBounds"]),afterUpdateAABBBounds:new yn(["graphic","stage","aabbBounds","globalAABBBounds","selfChange"]),clearAABBBounds:new yn(["graphic","stage","aabbBounds"])},this.tempAABBBounds1=new Zi,this.tempAABBBounds2=new Zi}onAttributeUpdate(n){this.hooks.onAttributeUpdate.taps.length&&this.hooks.onAttributeUpdate.call(n)}onSetStage(n,t){this.hooks.onSetStage.taps.length&&this.hooks.onSetStage.call(n,t)}onRemove(n){this.hooks.onRemove.taps.length&&this.hooks.onRemove.call(n)}onRelease(n){this.hooks.onRelease.taps.length&&this.hooks.onRelease.call(n)}onAddIncremental(n,t,e){this.hooks.onAddIncremental.taps.length&&this.hooks.onAddIncremental.call(n,t,e)}onClearIncremental(n,t){this.hooks.onClearIncremental.taps.length&&this.hooks.onClearIncremental.call(n,t)}beforeUpdateAABBBounds(n,t,e,i){this.hooks.beforeUpdateAABBBounds.taps.length&&this.hooks.beforeUpdateAABBBounds.call(n,t,e,i)}afterUpdateAABBBounds(n,t,e,i,r){this.hooks.afterUpdateAABBBounds.taps.length&&this.hooks.afterUpdateAABBBounds.call(n,t,e,i,r)}clearAABBBounds(n,t,e){this.hooks.clearAABBBounds.taps.length&&this.hooks.clearAABBBounds.call(n,t,e)}updatePathProxyAABBBounds(n,t){const e=typeof t.pathProxy=="function"?t.pathProxy(t.attribute):t.pathProxy;if(!e)return!1;const i=new rx(n);return Bs(e.commandList,i,0,0),!0}updateHTMLTextAABBBounds(n,t,e,i){const{textAlign:r,textBaseline:o}=n;if(n.forceBoundsHeight!=null){const s=$i(n.forceBoundsHeight)?n.forceBoundsHeight:n.forceBoundsHeight(),a=Rc(o,s,s);e.set(e.x1,a,e.x2,a+s)}if(n.forceBoundsWidth!=null){const s=$i(n.forceBoundsWidth)?n.forceBoundsWidth:n.forceBoundsWidth(),a=bu(r,s);e.set(a,e.y1,a+s,e.y2)}}combindShadowAABBBounds(n,t){if(t&&t.shadowRoot){const e=t.shadowRoot.AABBBounds;n.union(e)}}transformAABBBounds(n,t,e,i,r){if(!t.empty()){const{scaleX:a=e.scaleX,scaleY:l=e.scaleY,stroke:h=e.stroke,shadowBlur:u=e.shadowBlur,lineWidth:d=e.lineWidth,pickStrokeBuffer:c=e.pickStrokeBuffer,strokeBoundsBuffer:g=e.strokeBoundsBuffer}=n,f=this.tempAABBBounds1,p=this.tempAABBBounds2;if(h&&d){const m=(d+c)/Math.abs(a+l);Op(f,m,i,g),t.union(f),f.setValue(p.x1,p.y1,p.x2,p.y2)}if(u){const{shadowOffsetX:m=e.shadowOffsetX,shadowOffsetY:v=e.shadowOffsetY}=n,b=u/Math.abs(a+l)*2;Op(f,b,!1,g+1),f.translate(m,v),t.union(f)}}if(this.combindShadowAABBBounds(t,r),t.empty())return;let o=!0;const s=r.transMatrix;r&&r.isContainer&&(o=!(s.a===1&&s.b===0&&s.c===0&&s.d===1&&s.e===0&&s.f===0)),o&&ix(t,t,s)}validCheck(n,t,e,i){if(!i||n.forceBoundsHeight!=null||n.forceBoundsWidth!=null||i.shadowRoot||i.isContainer)return!0;const{visible:r=t.visible}=n;return!(!i.valid||!r)||(e.empty()||(i.parent&&e.transformWithMatrix(i.parent.globalTransMatrix),this.clearAABBBounds(i,i.stage,e),e.clear()),!1)}updateTempAABBBounds(n){const t=this.tempAABBBounds1,e=this.tempAABBBounds2;return t.setValue(n.x1,n.y1,n.x2,n.y2),e.setValue(n.x1,n.y1,n.x2,n.y2),{tb1:t,tb2:e}}};$_=KX([pt(),JX(0,Xt(xI)),ZX("design:paramtypes",[Object])],$_);const ug=(n,t,e)=>{const{outerBorder:i,shadowBlur:r=t.shadowBlur}=n;if(i){const o=t.outerBorder,{distance:s=o.distance,lineWidth:a=o.lineWidth}=i;e.expand(s+(r+a)/2)}return e},XM=["radius","startAngle","endAngle",...Dr];class ma extends Ni{constructor(t={radius:1}){super(t),this.type="circle",this.numberType=uv}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,radius:i}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)}getGraphicTheme(){return Wt(this).circle}updateAABBBounds(t,e,i,r){this.updatePathProxyAABBBounds(i)||(r?this.updateCircleAABBBoundsImprecise(t,e,i):this.updateCircleAABBBoundsAccurate(t,e,i));const{tb1:o,tb2:s}=mt.graphicService.updateTempAABBBounds(i);return ug(t,e,o),i.union(o),o.setValue(s.x1,s.y1,s.x2,s.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,mt.graphicService.transformAABBBounds(t,i,e,!1,this),i}updateCircleAABBBoundsImprecise(t,e,i){const{radius:r=e.radius}=t;return i.set(-r,-r,r,r),i}updateCircleAABBBoundsAccurate(t,e,i){const{startAngle:r=e.startAngle,endAngle:o=e.endAngle,radius:s=e.radius}=t;return o-r>zt-Pe?i.set(-s,-s,s,s):E_(r,o,s,i),i}needUpdateTags(t){return super.needUpdateTags(t,XM)}needUpdateTag(t){return super.needUpdateTag(t,XM)}toCustomPath(){var t,e,i;let r=super.toCustomPath();if(r)return r;const o=this.attribute,s=(t=o.radius)!==null&&t!==void 0?t:this.getDefaultAttribute("radius"),a=(e=o.startAngle)!==null&&e!==void 0?e:this.getDefaultAttribute("startAngle"),l=(i=o.endAngle)!==null&&i!==void 0?i:this.getDefaultAttribute("endAngle");return r=new Fi,r.arc(0,0,s,a,l),r}clone(){return new ma(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return ma.NOWORK_ANIMATE_ATTR}}ma.NOWORK_ANIMATE_ATTR=go;function LI(n){return new ma(n)}class U_{constructor(t,e,i){this.fontFamily=t,this.textOptions=e,this.textMeasure=i}LayoutBBox(t,e,i,r){if(t.xOffset=e==="left"||e==="start"?0:e==="center"?t.width/-2:e==="right"||e==="end"?-t.width:0,i==="top")t.yOffset=0;else if(i==="middle")t.yOffset=t.height/-2;else if(i==="alphabetic"){let o=.79;if(r.length===1){const s=r[0];o=s.ascent/(s.ascent+s.descent)}t.yOffset=t.height*-o}else t.yOffset=-t.height;return t}GetLayoutByLines(t,e,i,r,o="",s,a){const{lineWidth:l,suffixPosition:h="end",measureMode:u=Cl.actualBounding,keepCenterInLine:d=!1}=a??{};t=t.map((p=>p.toString()));const c=[],g=[0,0];if(typeof l=="number"&&l!==1/0){let p;for(let m=0,v=t.length;m<v;m++){const b=this.textMeasure.measureTextPixelADscentAndWidth(t[m],this.textOptions,u);let y=t[m].toString();if(b.width>l){const C=this.textMeasure.clipTextWithSuffix(t[m],this.textOptions,l,o,s,h);y=C.str,p=C.width}else p=b.width;c.push({str:y,width:p,ascent:b.ascent,descent:b.descent,keepCenterInLine:d})}g[0]=l}else{let p,m,v=0;for(let b=0,y=t.length;b<y;b++){m=t[b];const C=this.textMeasure.measureTextPixelADscentAndWidth(t[b],this.textOptions,u);p=C.width,v=Math.max(v,p),c.push({str:m,width:p,ascent:C.ascent,descent:C.descent,keepCenterInLine:d})}g[0]=v}g[1]=c.length*r,g[0]=c.reduce(((p,m)=>Math.max(p,m.width)),0);const f={xOffset:0,yOffset:0,width:g[0],height:g[1]};return this.LayoutBBox(f,e,i,c),this.layoutWithBBox(f,c,e,i,r)}layoutWithBBox(t,e,i,r,o){const s=[0,0],a=e.length*o;r==="top"||(r==="middle"?s[1]=(t.height-a)/2:r==="bottom"&&(s[1]=t.height-a));for(let l=0;l<e.length;l++)this.lineOffset(t,e[l],i,r,o,s);return{bbox:t,lines:e,fontFamily:this.fontFamily,fontSize:this.textOptions.fontSize,fontWeight:this.textOptions.fontWeight,lineHeight:o,textAlign:i,textBaseline:r}}lineOffset(t,e,i,r,o,s){if(i==="left"||i==="start"?e.leftOffset=0:i==="center"?e.leftOffset=(t.width-e.width)/2:i!=="right"&&i!=="end"||(e.leftOffset=t.width-e.width),e.topOffset=o/2+(e.ascent-e.descent)/2+s[1],!e.keepCenterInLine){const l=e.ascent+e.descent+0;if(l<o-0&&(r==="bottom"?e.topOffset+=(o-l)/2:r==="top"&&(e.topOffset-=(o-l)/2)),r==="alphabetic"){const h=o/(e.ascent+e.descent);e.topOffset=o/2+(e.ascent-e.descent)/2*h+s[1]}}return s[1]+=o,e}}const YM=["text","maxLineWidth","maxWidth","textAlign","textBaseline","heightLimit","lineClamp","fontSize","fontFamily","fontWeight","ellipsis","lineHeight","direction","wordBreak","heightLimit","lineClamp",...Dr];class Oe extends Ni{get font(){const t=this.getGraphicTheme();return this._font||(this._font=jO(this.attribute,t)),this._font}get clipedText(){var t;const e=this.attribute,i=this.getGraphicTheme(),r=this.getMaxWidth(i);return Number.isFinite(r)?(this.tryUpdateAABBBounds(),this.cache.clipedText):((t=e.text)!==null&&t!==void 0?t:i.text).toString()}get clipedWidth(){return this.tryUpdateAABBBounds(),this.cache.clipedWidth}get cliped(){var t,e;const i=this.getGraphicTheme(),r=this.attribute,o=this.getMaxWidth(i);if(!Number.isFinite(o))return!1;const{text:s}=this.attribute;if(this.tryUpdateAABBBounds(),(e=(t=this.cache)===null||t===void 0?void 0:t.layoutData)===null||e===void 0?void 0:e.lines){let a="";return this.cache.layoutData.lines.forEach((l=>{a+=l.str})),(Array.isArray(s)?s.join(""):s).toString()!==a}return r.direction==="vertical"&&this.cache.verticalList&&this.cache.verticalList[0]?this.cache.verticalList[0].map((a=>a.text)).join("")!==r.text.toString():this.clipedText!=null&&this.clipedText!==r.text.toString()}get multilineLayout(){return this.tryUpdateAABBBounds(),this.cache.layoutData}get isMultiLine(){return Array.isArray(this.attribute.text)||this.attribute.whiteSpace==="normal"}constructor(t={text:"",fontSize:16}){super(t),this.type="text",this.numberType=pv,this.cache={}}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{text:t}=this.attribute;return ue(t)?!t.every((e=>e==null||e==="")):t!=null&&t!==""}getGraphicTheme(){return Wt(this).text}doUpdateOBBBounds(){const t=this.getGraphicTheme();this._OBBBounds.clear();const e=this.attribute,{angle:i=t.angle}=e;if(!i){const h=this.AABBBounds;return this._OBBBounds.setValue(h.x1,h.y1,h.x2,h.y2),this._OBBBounds}this.obbText||(this.obbText=new Oe({})),this.obbText.setAttributes(Object.assign(Object.assign({},e),{angle:0}));const r=this.obbText.AABBBounds,{x:o,y:s}=e,a={x:(r.x1+r.x2)/2,y:(r.y1+r.y2)/2},l=vs(a,i,{x:o,y:s});return this._OBBBounds.copy(r),this._OBBBounds.translate(l.x-a.x,l.y-a.y),this._OBBBounds.angle=i,this._OBBBounds}updateAABBBounds(t,e,i){const{text:r=e.text}=this.attribute;Array.isArray(r)?this.updateMultilineAABBBounds(r):this.updateSingallineAABBBounds(r);const{tb1:o}=mt.graphicService.updateTempAABBBounds(i),{scaleX:s=e.scaleX,scaleY:a=e.scaleY,shadowBlur:l=e.shadowBlur,strokeBoundsBuffer:h=e.strokeBoundsBuffer}=t;if(l){const u=l/Math.abs(s+a);Op(o,u,!0,h),i.union(o)}return mt.graphicService.combindShadowAABBBounds(i,this),t.forceBoundsHeight==null&&t.forceBoundsWidth==null||mt.graphicService.updateHTMLTextAABBBounds(t,e,i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,ix(i,i,this.transMatrix),i}updateSingallineAABBBounds(t){this.updateMultilineAABBBounds([t]);const e=this.cache.layoutData;if(e&&e.lines&&e.lines.length){const i=e.lines[0];this.cache.clipedText=i.str,this.cache.clipedWidth=i.width}return this._AABBBounds}updateMultilineAABBBounds(t){const e=this.getGraphicTheme(),{direction:i=e.direction,underlineOffset:r=e.underlineOffset}=this.attribute,o=i==="horizontal"?this.updateHorizontalMultilineAABBBounds(t):this.updateVerticalMultilineAABBBounds(t);return i==="horizontal"&&r&&this._AABBBounds.add(this._AABBBounds.x1,this._AABBBounds.y2+r),o}guessLineHeightBuf(t){return t?.1*t:0}updateHorizontalMultilineAABBBounds(t){var e,i;const r=this.getGraphicTheme(),o=this.attribute,{fontFamily:s=r.fontFamily,textAlign:a=r.textAlign,textBaseline:l=r.textBaseline,fontSize:h=r.fontSize,fontWeight:u=r.fontWeight,ellipsis:d=r.ellipsis,maxLineWidth:c,stroke:g=r.stroke,wrap:f=r.wrap,measureMode:p=r.measureMode,lineWidth:m=r.lineWidth,whiteSpace:v=r.whiteSpace,suffixPosition:b=r.suffixPosition,ignoreBuf:y=r.ignoreBuf,keepCenterInLine:C=r.keepCenterInLine}=o,w=y?0:this.guessLineHeightBuf(h),_=this.getLineHeight(o,r,w);if(v==="normal"||f)return this.updateWrapAABBBounds(t);if(!this.shouldUpdateShape()&&(!((e=this.cache)===null||e===void 0)&&e.layoutData)){const T=this.cache.layoutData.bbox;return this._AABBBounds.set(T.xOffset,T.yOffset,T.xOffset+T.width,T.yOffset+T.height),g&&this._AABBBounds.expand(m/2),this._AABBBounds}const A=mt.graphicUtil.getTextMeasureInstance(this.textMeasureId||((i=this.stage)===null||i===void 0?void 0:i.textMeasureId)),x=new U_(s,{fontSize:h,fontWeight:u,fontFamily:s,lineHeight:_},A).GetLayoutByLines(t,a,l,_,d===!0?r.ellipsis:d||void 0,!1,{lineWidth:c,suffixPosition:b,measureMode:p,keepCenterInLine:C}),{bbox:S}=x;return this.cache.layoutData=x,this.clearUpdateShapeTag(),this._AABBBounds.set(S.xOffset,S.yOffset,S.xOffset+S.width,S.yOffset+S.height),g&&this._AABBBounds.expand(m/2),this._AABBBounds}updateWrapAABBBounds(t){var e,i,r,o;const s=this.getGraphicTheme(),{fontFamily:a=s.fontFamily,textAlign:l=s.textAlign,textBaseline:h=s.textBaseline,fontSize:u=s.fontSize,ellipsis:d=s.ellipsis,maxLineWidth:c,stroke:g=s.stroke,lineWidth:f=s.lineWidth,wordBreak:p=s.wordBreak,fontWeight:m=s.fontWeight,ignoreBuf:v=s.ignoreBuf,measureMode:b=s.measureMode,suffixPosition:y=s.suffixPosition,heightLimit:C=0,lineClamp:w,keepCenterInLine:_=s.keepCenterInLine}=this.attribute,A=v?0:this.guessLineHeightBuf(u),x=this.getLineHeight(this.attribute,s,A);if(!this.shouldUpdateShape()&&(!((e=this.cache)===null||e===void 0)&&e.layoutData)){const O=this.cache.layoutData.bbox;return this._AABBBounds.set(O.xOffset,O.yOffset,O.xOffset+O.width,O.yOffset+O.height),g&&this._AABBBounds.expand(f/2),this._AABBBounds}const S=mt.graphicUtil.getTextMeasureInstance(this.textMeasureId||((i=this.stage)===null||i===void 0?void 0:i.textMeasureId)),T={fontSize:u,fontWeight:m,fontFamily:a,lineHeight:x},M=new U_(a,T,S),R=ue(t)?t.map((O=>O.toString())):[t.toString()],E=[],P=[0,0];let B=1/0;if(C>0&&(B=Math.max(Math.floor(C/x),1)),w&&(B=Math.min(B,w)),typeof c=="number"&&c!==1/0){if(c>0)for(let I=0;I<R.length;I++){const H=R[I];let D=!0;if(I===B-1){const j=S.clipTextWithSuffix(H,T,c,d,!1,y,I!==R.length-1),X=S.measureTextPixelADscentAndWidth(j.str,T,b);E.push({str:j.str,width:j.width,ascent:X.ascent,descent:X.descent,keepCenterInLine:_});break}const z=S.clipText(H,T,c,p!=="break-all",p==="keep-all");if(H!==""&&z.str===""||z.wordBreaked){if(d){const j=S.clipTextWithSuffix(H,T,c,d,!1,y);z.str=(r=j.str)!==null&&r!==void 0?r:"",z.width=(o=j.width)!==null&&o!==void 0?o:0}else z.str="",z.width=0;D=!1}const G=S.measureTextPixelADscentAndWidth(z.str,T,b);E.push({str:z.str,width:z.width,ascent:G.ascent,descent:G.descent,keepCenterInLine:_});let U=z.str.length;if(!z.wordBreaked||H!==""&&z.str===""||(D=!0,U=z.wordBreaked),z.str.length!==H.length){if(D){let j=H.substring(U);p==="keep-all"&&(j=j.replace(/^\s+/g,"")),R.splice(I+1,0,j)}}}let O=0;E.forEach((I=>{O=Math.max(O,I.width)})),P[0]=O}else{let O,I,H=0;for(let D=0,z=R.length;D<z;D++){if(D===B-1){const U=S.clipTextWithSuffix(R[D],T,c,d,!1,y),j=S.measureTextPixelADscentAndWidth(U.str,T,b);E.push({str:U.str,width:U.width,ascent:j.ascent,descent:j.descent,keepCenterInLine:_}),H=Math.max(H,U.width);break}I=R[D],O=S.measureTextWidth(I,T),H=Math.max(H,O);const G=S.measureTextPixelADscentAndWidth(I,T,b);E.push({str:I,width:O,ascent:G.ascent,descent:G.descent,keepCenterInLine:_})}P[0]=H}P[1]=E.length*x;const k={xOffset:0,yOffset:0,width:P[0],height:P[1]};M.LayoutBBox(k,l,h,E);const L=M.layoutWithBBox(k,E,l,h,x);return this.cache.layoutData=L,this.clearUpdateShapeTag(),this._AABBBounds.set(k.xOffset,k.yOffset,k.xOffset+k.width,k.yOffset+k.height),g&&this._AABBBounds.expand(f/2),this._AABBBounds}updateVerticalMultilineAABBBounds(t){var e,i,r;const o=this.getGraphicTheme(),s=mt.graphicUtil.getTextMeasureInstance(this.textMeasureId||((e=this.stage)===null||e===void 0?void 0:e.textMeasureId));let a;const l=this.attribute,{maxLineWidth:h=o.maxLineWidth,ellipsis:u=o.ellipsis,fontFamily:d=o.fontFamily,fontSize:c=o.fontSize,fontWeight:g=o.fontWeight,stroke:f=o.stroke,lineWidth:p=o.lineWidth,verticalMode:m=o.verticalMode,suffixPosition:v=o.suffixPosition}=l,b=this.getLineHeight(l,o,0);let{textAlign:y=o.textAlign,textBaseline:C=o.textBaseline}=l;if(!m){const S=y;y=(i=Oe.baselineMapAlign[C])!==null&&i!==void 0?i:"left",C=(r=Oe.alignMapBaseline[S])!==null&&r!==void 0?r:"top"}if(a=0,!this.shouldUpdateShape()&&this.cache){this.cache.verticalList.forEach((R=>{const E=R.reduce(((P,B)=>P+B.width),0);a=_s(E,a)}));const S=bu(y,a),T=this.cache.verticalList.length*b,M=Rc(C,T,c);return this._AABBBounds.set(M,S,M+T,S+a),f&&this._AABBBounds.expand(p/2),this._AABBBounds}const w=t.map((S=>yX(S.toString())));w.forEach(((S,T)=>{if(Number.isFinite(h))if(u){const M=u===!0?o.ellipsis:u,R=s.clipTextWithSuffixVertical(S,{fontSize:c,fontWeight:g,fontFamily:d},h,M,!1,v);w[T]=R.verticalList,a=R.width}else{const M=s.clipTextVertical(S,{fontSize:c,fontWeight:g,fontFamily:d},h,!1);w[T]=M.verticalList,a=M.width}else a=0,S.forEach((M=>{const R=M.direction===Ph.HORIZONTAL?c:s.measureTextWidth(M.text,{fontSize:c,fontWeight:g,fontFamily:d});a+=R,M.width=R}))})),this.cache.verticalList=w,this.clearUpdateShapeTag(),this.cache.verticalList.forEach((S=>{const T=S.reduce(((M,R)=>M+R.width),0);a=_s(T,a)}));const _=bu(y,a),A=this.cache.verticalList.length*b,x=Rc(C,A,c);return this._AABBBounds.set(x,_,x+A,_+a),f&&this._AABBBounds.expand(p/2),this._AABBBounds}getMaxWidth(t){var e,i;const r=this.attribute;return(i=(e=r.maxLineWidth)!==null&&e!==void 0?e:r.maxWidth)!==null&&i!==void 0?i:t.maxWidth}getLineHeight(t,e,i){var r;return(r=ag(t.lineHeight,t.fontSize||e.fontSize))!==null&&r!==void 0?r:(t.fontSize||e.fontSize)+i}needUpdateTags(t,e=YM){return super.needUpdateTags(t,e)}needUpdateTag(t,e=YM){return super.needUpdateTag(t,e)}_interpolate(t,e,i,r,o){t==="text"&&(o.text=r)}clone(){return new Oe(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Oe.NOWORK_ANIMATE_ATTR}getBaselineMapAlign(){return Oe.baselineMapAlign}getAlignMapBaseline(){return Oe.alignMapBaseline}}Oe.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,direction:1,textAlign:1,textBaseline:1,fontFamily:1,fontWeight:1},go),Oe.baselineMapAlign={top:"left",bottom:"right",middle:"center"},Oe.alignMapBaseline={left:"top",right:"bottom",center:"middle"};function Bc(n){return new Oe(n)}const Qg=["heightLimit","lineClamp"];class yx extends Oe{constructor(t){super(Object.assign(Object.assign({},t),{wrap:!0}))}_isValid(){const{text:t}=this.attribute;return ue(t)?!t.every((e=>e==null||e==="")):t!=null&&t!==""}updateMultilineAABBBounds(t){var e,i,r,o,s;const a=this.getGraphicTheme(),{fontFamily:l=a.fontFamily,textAlign:h=a.textAlign,textBaseline:u=a.textBaseline,fontSize:d=a.fontSize,ellipsis:c=a.ellipsis,maxLineWidth:g,stroke:f=a.stroke,lineWidth:p=a.lineWidth,wordBreak:m=a.wordBreak,fontWeight:v=a.fontWeight,ignoreBuf:b=a.ignoreBuf,heightLimit:y=0,suffixPosition:C=a.suffixPosition,lineClamp:w}=this.attribute,_=(e=ag(this.attribute.lineHeight,this.attribute.fontSize||a.fontSize))!==null&&e!==void 0?e:this.attribute.fontSize||a.fontSize,A=b?0:2;if(!this.shouldUpdateShape()&&(!((i=this.cache)===null||i===void 0)&&i.layoutData)){const k=this.cache.layoutData.bbox;return this._AABBBounds.set(k.xOffset,k.yOffset,k.xOffset+k.width,k.yOffset+k.height),f&&this._AABBBounds.expand(p/2),this._AABBBounds}const x=mt.graphicUtil.getTextMeasureInstance(this.textMeasureId||((r=this.stage)===null||r===void 0?void 0:r.textMeasureId)),S=new U_(l,{fontSize:d,fontWeight:v,fontFamily:l},x),T=t.map((k=>k.toString())),M=[],R=[0,0];let E=1/0;if(y>0&&(E=Math.max(Math.floor(y/_),1)),w&&(E=Math.min(E,w)),typeof g=="number"&&g!==1/0){if(g>0)for(let L=0;L<T.length;L++){const O=T[L];let I=!0;if(L===E-1){const D=S.textMeasure.clipTextWithSuffix(O,S.textOptions,g,c,!1,C);M.push({str:D.str,width:D.width,ascent:0,descent:0,keepCenterInLine:!1});break}const H=S.textMeasure.clipText(O,S.textOptions,g,m==="break-word");if(O!==""&&H.str===""){if(c){const D=S.textMeasure.clipTextWithSuffix(O,S.textOptions,g,c,!1,C);H.str=(o=D.str)!==null&&o!==void 0?o:"",H.width=(s=D.width)!==null&&s!==void 0?s:0}else H.str="",H.width=0;I=!1}if(M.push({str:H.str,width:H.width,ascent:0,descent:0,keepCenterInLine:!1}),H.str.length!==O.length){if(I){const D=O.substring(H.str.length);T.splice(L+1,0,D)}}}let k=0;M.forEach((L=>{k=Math.max(k,L.width)})),R[0]=k}else{let k,L,O=0;for(let I=0,H=T.length;I<H;I++){if(I===E-1){const D=S.textMeasure.clipTextWithSuffix(T[I],S.textOptions,g,c,!1,C);M.push({str:D.str,width:D.width,ascent:0,descent:0,keepCenterInLine:!1}),O=Math.max(O,D.width);break}L=T[I],k=S.textMeasure.measureTextWidth(L,S.textOptions,m==="break-word"),O=Math.max(O,k),M.push({str:L,width:k,ascent:0,descent:0,keepCenterInLine:!1})}R[0]=O}R[1]=M.length*(_+A);const P={xOffset:0,yOffset:0,width:R[0],height:R[1]};S.LayoutBBox(P,h,u);const B=S.layoutWithBBox(P,M,h,u,_);return this.cache.layoutData=B,this.clearUpdateShapeTag(),this._AABBBounds.set(P.xOffset,P.yOffset,P.xOffset+P.width,P.yOffset+P.height),f&&this._AABBBounds.expand(p/2),this._AABBBounds}needUpdateTags(t){for(let e=0;e<Qg.length;e++){const i=Qg[e];if(t.indexOf(i)!==-1)return!0}return super.needUpdateTags(t)}needUpdateTag(t){for(let e=0;e<Qg.length;e++)if(t===Qg[e])return!0;return super.needUpdateTag(t)}getNoWorkAnimateAttr(){return yx.NOWORK_ANIMATE_ATTR}}function tY(n){return new yx(n)}const eY=(n,t,e)=>{const{outerBorder:i,shadowBlur:r=t.shadowBlur,strokeBoundsBuffer:o=t.strokeBoundsBuffer}=n;if(i){const s=t.outerBorder,{distance:a=s.distance,lineWidth:l=s.lineWidth}=i;Op(e,a+(r+l)/2,!0,o)}return e},qM=["symbolType","size",...Dr];let OI=class X_ extends Ni{constructor(t={symbolType:"circle"}){super(t),this.type="symbol",this.numberType=fv}getParsedPath(){return this.shouldUpdateShape()&&(this._parsedPath=this.doUpdateParsedPath(),this.clearUpdateShapeTag()),this._parsedPath}getParsedPath2D(t=0,e=0,i=1){let r=null;try{r=new Path2D}catch{return null}const o=this.getParsedPath();if(!o)return null;o.draw(r,i,t,e)}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{size:t}=this.attribute;return ue(t)?t.length===2&&t.every(this._validNumber):this._validNumber(t)}doUpdateParsedPath(){const{symbolType:t="circle"}=this.attribute;return super.parsePath(t)}getGraphicTheme(){return Wt(this).symbol}updateAABBBounds(t,e,i,r){this.updatePathProxyAABBBounds(i)||(r?this.updateSymbolAABBBoundsImprecise(t,e,i):this.updateSymbolAABBBoundsAccurate(t,e,i));const{tb1:o,tb2:s}=mt.graphicService.updateTempAABBBounds(i);eY(t,e,o),i.union(o),o.setValue(s.x1,s.y1,s.x2,s.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,this.x1WithoutTransform=i.x1,this.y1WithoutTransform=i.y1;const{lineJoin:a=e.lineJoin}=t;return mt.graphicService.transformAABBBounds(t,i,e,a==="miter",this),i}updateSymbolAABBBoundsImprecise(t,e,i){const{size:r=e.size}=t;if(ue(r))i.set(-r[0]/2,-r[1]/2,r[0]/2,r[1]/2);else{const o=r/2;i.set(-o,-o,o,o)}return i}updateSymbolAABBBoundsAccurate(t,e,i){const{size:r=e.size}=t;return this.getParsedPath().bounds(r,i),i}needUpdateTags(t){return super.needUpdateTags(t,qM)}needUpdateTag(t){return super.needUpdateTag(t,qM)}toCustomPath(){const t=this.getParsedPath(),e=this.attribute.size,i=ue(e)?e:[e,e];return t.path?new Fi().fromCustomPath2D(t.path,0,0,i[0],i[1]):new Fi().fromString(t.pathStr,0,0,i[0],i[1])}clone(){return new X_(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return X_.NOWORK_ANIMATE_ATTR}};OI.NOWORK_ANIMATE_ATTR=Object.assign({symbolType:1},go);function yu(n){return new OI(n)}const KM=["segments","points","curveType","curveTension",...Dr];let Cx=class Y_ extends Ni{constructor(t={}){super(t),this.type="line",this.numberType=lg}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:t,segments:e}=this.attribute;return e?e.length!==0:!!t&&!(t.length<=1)}_interpolate(t,e,i,r,o){t==="points"&&(o.points=hx(i,r,e))}getGraphicTheme(){return Wt(this).line}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||(t.segments?this.updateLineAABBBoundsBySegments(t,e,i):this.updateLineAABBBoundsByPoints(t,e,i)),mt.graphicService.updateTempAABBBounds(i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1;const{lineJoin:r=e.lineJoin}=t;return mt.graphicService.transformAABBBounds(t,i,e,r==="miter",this),i}updateLineAABBBoundsByPoints(t,e,i,r){const{points:o=e.points,connectedType:s}=t,a=i;return o.forEach((l=>{l.defined===!1&&s!=="connect"||a.add(l.x,l.y)})),a}updateLineAABBBoundsBySegments(t,e,i,r){const{segments:o=e.segments,connectedType:s}=t,a=i;return o.forEach((l=>{l.points.forEach((h=>{h.defined===!1&&s!=="connect"||a.add(h.x,h.y)}))})),a}needUpdateTags(t){return super.needUpdateTags(t,KM)}needUpdateTag(t){return super.needUpdateTag(t,KM)}toCustomPath(){let t=super.toCustomPath();if(t)return t;const e=this.attribute;t=new Fi;const i=e.segments,r=o=>{if(o&&o.length){let s=!0;o.forEach((a=>{a.defined!==!1&&(s?t.moveTo(a.x,a.y):t.lineTo(a.x,a.y),s=!1)}))}};return i&&i.length?i.forEach((o=>{r(o.points)})):e.points&&r(e.points),t}clone(){return new Y_(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Y_.NOWORK_ANIMATE_ATTR}};Cx.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},go);function Ke(n){return new Cx(n)}const iY=n=>{if(!n)return{x:0,y:0,width:0,height:0};let t=ze(n.width)?n.x1-n.x:n.width,e=ze(n.height)?n.y1-n.y:n.height,i=0,r=0;return t<0?(i=t,t=-t):Number.isNaN(t)&&(t=0),e<0?(r=e,e=-e):Number.isNaN(e)&&(e=0),{x:i,y:r,width:t,height:e}},ZM=["width","x1","y1","height","cornerRadius",...Dr];let dg=class q_ extends Ni{constructor(t){super(t),this.type="rect",this.numberType=dx}isValid(){return super.isValid()&&this._isValid()}_isValid(){return!0}getGraphicTheme(){return Wt(this).rect}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){let{width:s,height:a}=t;const{x1:l,y1:h,x:u,y:d}=t;s=s??l-u,a=a??h-d,(isFinite(s)||isFinite(a)||isFinite(u)||isFinite(d))&&i.set(0,0,s||0,a||0)}const{tb1:r,tb2:o}=mt.graphicService.updateTempAABBBounds(i);return ug(t,e,r),i.union(r),r.setValue(o.x1,o.y1,o.x2,o.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,mt.graphicService.transformAABBBounds(t,i,e,!1,this),i}needUpdateTags(t){return super.needUpdateTags(t,ZM)}needUpdateTag(t){return super.needUpdateTag(t,ZM)}toCustomPath(){let t=super.toCustomPath();if(t)return t;const e=this.attribute,{x:i,y:r,width:o,height:s}=iY(e);return t=new Fi,t.moveTo(i,r),t.rect(i,r,o,s),t}clone(){return new q_(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return q_.NOWORK_ANIMATE_ATTR}};dg.NOWORK_ANIMATE_ATTR=go;function be(n){return new dg(n)}class nY{constructor(t,e,i,r,o,s,a,l,h,u,d,c,g,f){this.left=t,this.top=e,this.width=i,this.height=r,this.actualHeight=0,this.bottom=e+r,this.right=t+i,this.ellipsis=o,this.wordBreak=s,this.verticalDirection=a,this.lines=[],this.globalAlign=l,this.globalBaseline=h,this.layoutDirection=u,this.directionKey=sx[this.layoutDirection],this.isWidthMax=d,this.isHeightMax=c,this.singleLine=g,f?(f.clear(),this.icons=f):this.icons=new Map}draw(t,e){const{width:i,height:r}=this.getActualSize(),o=this.isWidthMax?Math.min(this.width,i):this.width||i||0;let s=this.isHeightMax?Math.min(this.height,r):this.height||r||0;s=Math.min(s,r);let a=0;switch(this.globalBaseline){case"top":a=0;break;case"middle":a=-s/2;break;case"bottom":a=-s}let l=0;this.globalAlign==="right"||this.globalAlign==="end"?l=-o:this.globalAlign==="center"&&(l=-o/2);let h=this[this.directionKey.height];this.singleLine&&(h=this.lines[0].height+1);let u=!1;if(this.verticalDirection==="middle")if(this.actualHeight>=h&&h!==0)for(let d=0;d<this.lines.length;d++){const{top:c,height:g}=this.lines[d];if(c+g<this[this.directionKey.top]||c+g>this[this.directionKey.top]+h)return u;let f=!1;this.ellipsis&&this.lines[d+1]&&this.lines[d+1].top+this.lines[d+1].height>this[this.directionKey.top]+h&&(f=!0,u=!0),this.lines[d].draw(t,f,this.lines[d][this.directionKey.left]+l,this.lines[d][this.directionKey.top]+a,this.ellipsis,e)}else{const d=Math.floor((h-this.actualHeight)/2);this.layoutDirection==="vertical"?l+=d:a+=d;for(let c=0;c<this.lines.length;c++)this.lines[c].draw(t,!1,this.lines[c][this.directionKey.left]+l,this.lines[c][this.directionKey.top]+a,this.ellipsis,e)}else if(this.verticalDirection==="bottom"&&this.layoutDirection!=="vertical")for(let d=0;d<this.lines.length;d++){const{top:c,height:g}=this.lines[d],f=h-this.lines[d].top-this.lines[d].height;if(h===0)this.lines[d].draw(t,!1,l,f+a,this.ellipsis,e);else{if(f+g>this[this.directionKey.top]+h||f<this[this.directionKey.top])return u;{let p=!1;this.ellipsis&&this.lines[d+1]&&f-this.lines[d+1].height<this[this.directionKey.top]&&(p=!0,u=!0),this.lines[d].draw(t,p,l,f+a,this.ellipsis,e)}}}else{this.verticalDirection==="bottom"&&this.layoutDirection==="vertical"&&this.singleLine&&this.isWidthMax&&(l+=this.lines[0].height+1);for(let d=0;d<this.lines.length;d++){this.verticalDirection==="bottom"&&this.layoutDirection==="vertical"&&(l-=this.lines[d].height+this.lines[d].top);const{top:c,height:g}=this.lines[d];if(h===0)this.lines[d].draw(t,!1,this.lines[d][this.directionKey.left]+l,this.lines[d][this.directionKey.top]+a,this.ellipsis,e);else{if(c+g<this[this.directionKey.top]||c+g>this[this.directionKey.top]+h)return u;{let f=!1;this.ellipsis&&this.lines[d+1]&&this.lines[d+1].top+this.lines[d+1].height>this[this.directionKey.top]+h&&(f=!0,u=!0),this.lines[d].draw(t,f,this.lines[d][this.directionKey.left]+l,this.lines[d][this.directionKey.top]+a,this.ellipsis,e)}}}}return u}getActualSize(){return this.ellipsis?this.getActualSizeWidthEllipsis():this.getRawActualSize()}getRawActualSize(){let t=0,e=0;for(let i=0;i<this.lines.length;i++){const r=this.lines[i];r.actualWidth>t&&(t=r.actualWidth),e+=r.height}return{width:this.layoutDirection==="vertical"?e:t,height:this.layoutDirection==="vertical"?t:e}}getActualSizeWidthEllipsis(){let t=0,e=0;const{width:i,height:r}=this.getRawActualSize();this.width,this.height;let o=this[this.directionKey.height];if(this.singleLine&&(o=this.lines[0].height+1),this.verticalDirection==="middle")if(this.actualHeight>=o&&o!==0)for(let s=0;s<this.lines.length;s++){const{top:a,height:l}=this.lines[s];if(!(a+l<this[this.directionKey.top]||a+l>this[this.directionKey.top]+o))if(this.ellipsis&&this.lines[s+1]&&this.lines[s+1].top+this.lines[s+1].height>this[this.directionKey.top]+o){const h=this.ellipsis===!0?"...":this.ellipsis||"",u=this.lines[s].getWidthWithEllips(h);u>t&&(t=u),e+=this.lines[s].height}else this.lines[s].actualWidth>t&&(t=this.lines[s].actualWidth),e+=this.lines[s].height}else{Math.floor((o-this.actualHeight)/2);for(let s=0;s<this.lines.length;s++)this.lines[s].actualWidth>t&&(t=this.lines[s].actualWidth),e+=this.lines[s].height}else if(this.verticalDirection==="bottom")for(let s=0;s<this.lines.length;s++){const{top:a,height:l}=this.lines[s],h=o-this.lines[s].top-this.lines[s].height;if(o===0)this.lines[s].actualWidth>t&&(t=this.lines[s].actualWidth),e+=this.lines[s].height;else if(!(h+l>this[this.directionKey.top]+o||h<this[this.directionKey.top]))if(this.ellipsis&&this.lines[s+1]&&h-this.lines[s+1].height<this[this.directionKey.top]){const u=this.ellipsis===!0?"...":this.ellipsis||"",d=this.lines[s].getWidthWithEllips(u);d>t&&(t=d),e+=this.lines[s].height}else this.lines[s].actualWidth>t&&(t=this.lines[s].actualWidth),e+=this.lines[s].height}else for(let s=0;s<this.lines.length;s++){const{top:a,height:l}=this.lines[s];if(o===0)this.lines[s].actualWidth>t&&(t=this.lines[s].actualWidth),e+=this.lines[s].height;else if(!(a+l<this[this.directionKey.top]||a+l>this[this.directionKey.top]+o))if(this.ellipsis&&this.lines[s+1]&&this.lines[s+1].top+this.lines[s+1].height>this[this.directionKey.top]+o){const h=this.ellipsis===!0?"...":this.ellipsis||"",u=this.lines[s].getWidthWithEllips(h);u>t&&(t=u),e+=this.lines[s].height}else this.lines[s].actualWidth>t&&(t=this.lines[s].actualWidth),e+=this.lines[s].height}return{width:this.layoutDirection==="vertical"?e:t,height:this.layoutDirection==="vertical"?t:e}}}function ed(n,t,e,i){const r=Math.round(n),o=Math.round(e),s=Math.round(t),a=Math.round(i);return{left:n>r?r:r-.5,top:e>o?o:o-.5,right:s>t?s:s+.5,bottom:a>i?a:a+.5}}class dl{constructor(t,e,i,r){var o,s;this.fontSize=i.fontSize||16,this.textBaseline=i.textBaseline||"alphabetic",this.ascentDescentMode=r;const a=ag(i.lineHeight,this.fontSize);this.lineHeight=typeof a=="number"?a>this.fontSize?a:this.fontSize:Math.floor(1.2*this.fontSize),this.height=this.lineHeight;const{ascent:l,height:h,descent:u,width:d}=Qa(t,i,this.ascentDescentMode);let c=0,g=0,f=0;this.height>h&&(c=(this.height-h)/2,g=Math.ceil(c),f=Math.floor(c)),this.textBaseline==="top"?(this.ascent=c,this.descent=h-c):this.textBaseline==="bottom"?(this.ascent=h-c,this.descent=c):this.textBaseline==="middle"?(this.ascent=this.height/2,this.descent=this.height/2):(this.ascent=l+g,this.descent=u+f),this.length=t.length,this.width=d||0,this.text=t||"",this.newLine=e||!1,this.character=i,this.left=0,this.top=0,this.ellipsis="normal",this.ellipsisWidth=0,this.ellipsisOtherParagraphWidth=0,this.space=i.space,this.dx=(o=i.dx)!==null&&o!==void 0?o:0,this.dy=(s=i.dy)!==null&&s!==void 0?s:0,i.direction==="vertical"&&(this.direction=i.direction,this.widthOrigin=this.width,this.heightOrigin=this.height,this.width=this.heightOrigin,this.height=this.widthOrigin,this.lineHeight=this.height),this.ellipsisStr="..."}updateWidth(){const{width:t}=Qa(this.text,this.character,this.ascentDescentMode);this.width=t,this.direction==="vertical"&&(this.widthOrigin=this.width,this.width=this.heightOrigin,this.height=this.widthOrigin)}drawBackground(t,e,i,r,o,s,a){if(this.text===""||this.text===`
`||!this.character.background||this.character.backgroundOpacity&&!(this.character.backgroundOpacity>0))return;let l=e+i,h=this.text,u=this.left+r;l+=this.top;let d=this.direction;if(this.verticalEllipsis)h=this.ellipsisStr,d="vertical",l-=this.ellipsisWidth/2;else{if(this.ellipsis==="hide")return;if(this.ellipsis==="add")h+=this.ellipsisStr,s!=="right"&&s!=="end"||(u-=this.ellipsisWidth);else if(this.ellipsis==="replace"){const g=zf(h,(d==="vertical"?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,h.length-1);if(h=h.slice(0,g),h+=this.ellipsisStr,(s==="right"||s==="end")&&d!=="vertical"){const{width:f}=Qa(this.text.slice(g),this.character,this.ascentDescentMode);u-=this.ellipsisWidth-f}}}const c=ed(u,u+(this.widthOrigin||this.width),e,e+a);return Object.assign(Object.assign({},c),{fillStyle:this.character.background,globalAlpha:this.character.backgroundOpacity})}draw(t,e,i,r,o,s,a){var l;let h=e+i,u=this.text,d=this.left+r+((l=this.space)!==null&&l!==void 0?l:0)/2;h+=this.top;let c=this.direction;if(this.verticalEllipsis)u=this.ellipsisStr,c="vertical",h-=this.ellipsisWidth/2;else{if(this.ellipsis==="hide")return;if(this.ellipsis==="add")u+=this.ellipsisStr,s!=="right"&&s!=="end"||(d-=this.ellipsisWidth);else if(this.ellipsis==="replace"){const f=zf(u,(c==="vertical"?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,u.length-1);if(u=u.slice(0,f),u+=this.ellipsisStr,(s==="right"||s==="end")&&c!=="vertical"){const{width:p}=Qa(this.text.slice(f),this.character,this.ascentDescentMode);d-=this.ellipsisWidth-p}}}switch(this.character.script){case"super":h-=this.ascent*(1/3);break;case"sub":h+=this.descent/2}c==="vertical"&&(t.save(),t.rotateAbout(Math.PI/2,d,h),t.translate(-this.heightOrigin||-this.lineHeight/2,-this.descent/2),t.translate(d,h),d=0,h=0);const{lineWidth:g=1}=this.character;if(this.character.stroke&&g&&t.strokeText(u,d+this.dx,h+this.dy),this.character.fill&&t.fillText(u,d+this.dx,h+this.dy),this.character.fill){if(this.character.lineThrough||this.character.underline){if(this.character.underline){const f=1+h,p=ed(d,d+(this.widthOrigin||this.width),f,f+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(p.left,1+h,p.right-p.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}if(this.character.lineThrough){const f=1+h-this.ascent/2,p=ed(d,d+(this.widthOrigin||this.width),f,f+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(p.left,1+h-this.ascent/2,p.right-p.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}}else if(this.character.textDecoration==="underline"){const f=1+h,p=ed(d,d+(this.widthOrigin||this.width),f,f+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(p.left,1+h,p.right-p.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}else if(this.character.textDecoration==="line-through"){const f=1+h-this.ascent/2,p=ed(d,d+(this.widthOrigin||this.width),f,f+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(p.left,1+h-this.ascent/2,p.right-p.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}}c==="vertical"&&t.restore()}getWidthWithEllips(t){let e=this.text;const i=t==="vertical"?this.height:this.width;if(this.ellipsis==="hide")return i;if(this.ellipsis==="add")return i+this.ellipsisWidth;if(this.ellipsis==="replace"){const r=zf(e,i-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,e.length-1);e=e.slice(0,r),e+=this.ellipsisStr;const{width:o}=Qa(this.text.slice(r),this.character,this.ascentDescentMode);return i+this.ellipsisWidth-o}return i}}function rY(n,t){const e=n.text.slice(0,t),i=n.text.slice(t);return[new dl(e,n.newLine,n.character,n.ascentDescentMode),new dl(i,!0,n.character,n.ascentDescentMode)]}const JM=["width","height","image",...Dr];let zo=class K_ extends Ni{constructor(t){super(t),this.type="image",this.numberType=dv,this.loadImage(this.attribute.image)}getImageElement(){const{image:t}=this.attribute;if(!t||!this.resources)return null;const e=this.resources.get(t);return e.state!=="success"?null:e.data}get width(){return this.tryUpdateAABBBounds(),this._actualWidth}get height(){return this.tryUpdateAABBBounds(),this._actualHeight}get repeatX(){var t;return(t=this.attribute.repeatX)!==null&&t!==void 0?t:"no-repeat"}set repeatX(t){this.attribute.repeatX===t&&(this.attribute.repeatX=t)}get repeatY(){var t;return(t=this.attribute.repeatY)!==null&&t!==void 0?t:"no-repeat"}set repeatY(t){this.attribute.repeatY===t&&(this.attribute.repeatY=t)}get image(){return this.attribute.image}set image(t){t!==this.attribute.image&&(this.attribute.image=t,this.loadImage(this.attribute.image))}imageLoadSuccess(t,e,i){super.imageLoadSuccess(t,e,(()=>{this.successCallback&&this.successCallback()})),this.addUpdateBoundTag()}imageLoadFail(t,e){super.imageLoadFail(t,(()=>{this.failCallback&&this.failCallback()}))}setAttributes(t,e,i){return t.image&&this.loadImage(t.image),super.setAttributes(t,e,i)}setAttribute(t,e,i,r){return t==="image"&&this.loadImage(e),super.setAttribute(t,e,i,r)}getGraphicTheme(){return Wt(this).image}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){const{maxWidth:s=e.maxWidth,maxHeight:a=e.maxHeight}=t;let{width:l,height:h}=t;if(l==null||h==null){const u=this.getImageElement();if(u){const d=u.width,c=u.height;if(l!=null)h=l*(c/d);else if(h!=null)l=h*(d/c);else{const g=d/c;g>s/a?(l=s,h=s/g):(h=a,l=a*g)}}else l=s,h=a}this._actualWidth=l,this._actualHeight=h,i.set(0,0,l,h)}const{tb1:r,tb2:o}=mt.graphicService.updateTempAABBBounds(i);return ug(t,e,r),i.union(r),r.setValue(o.x1,o.y1,o.x2,o.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,mt.graphicService.transformAABBBounds(t,i,e,!1,this),i}getDefaultAttribute(t){return xc[t]}needUpdateTags(t){return super.needUpdateTags(t,JM)}needUpdateTag(t){return super.needUpdateTag(t,JM)}clone(){return new K_(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return K_.NOWORK_ANIMATE_ATTR}};zo.NOWORK_ANIMATE_ATTR=Object.assign({image:1,repeatX:1,repeatY:1},go);function mv(n){return new zo(n)}class xo extends zo{constructor(t){if(super(t),this._x=0,this._y=0,this._hovered=!1,this._marginArray=[0,0,0,0],t.backgroundShowMode==="always"&&(this._hovered=!0),t.margin){const e=Lp(t.margin);this._marginArray=typeof e=="number"?[e,e,e,e]:e}this.onBeforeAttributeUpdate=(e,i,r)=>{if(ue(r)&&r.indexOf("margin")!==-1||r==="margin")if(i.margin){const o=Lp(i.margin);this._marginArray=typeof o=="number"?[o,o,o,o]:o}else this._marginArray=[0,0,0,0]}}get width(){var t;return((t=this.attribute.width)!==null&&t!==void 0?t:0)+this._marginArray[1]+this._marginArray[3]}get height(){var t;return((t=this.attribute.height)!==null&&t!==void 0?t:0)+this._marginArray[0]+this._marginArray[2]}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;this.doUpdateAABBBounds();const{width:t=xc.width,height:e=xc.height}=this.attribute,{backgroundWidth:i=t,backgroundHeight:r=e}=this.attribute,o=(i-t)/2,s=(r-e)/2;return this._AABBBounds.expand([0,2*o,2*s,0]),this._AABBBounds}setHoverState(t){this.attribute.backgroundShowMode==="hover"&&this._hovered!==t&&(this._hovered=t)}}class oY{constructor(t,e,i,r,o,s,a,l){this.left=t,this.width=e,this.baseline=i,this.ascent=r,this.descent=o,this.top=i-r,this.paragraphs=s.map((u=>u)),this.textAlign=(this.paragraphs[0]instanceof xo?this.paragraphs[0].attribute.textAlign:this.paragraphs[0].character.textAlign)||"left",this.direction=a,this.directionKey=sx[this.direction],this.actualWidth=0;let h=0;this.paragraphs.forEach(((u,d)=>{if(d===0&&u instanceof dl){const c=T$.exec(u.text);c?.index!==0&&(u.text=u.text.slice(c?.index),u.updateWidth())}this.actualWidth+=u[this.directionKey.width],h=Math.max(u[this.directionKey.height],h)})),this.height=h,this.blankWidth=l?0:this.width-this.actualWidth,this.calcOffset(e,l)}calcOffset(t,e){const i=this.directionKey,r=this.height;let o=this.left,s=0;this.actualWidth<t&&!e&&(this.textAlign==="right"||this.textAlign==="end"?o=t-this.actualWidth:this.textAlign==="center"?o=(t-this.actualWidth)/2:this.textAlign==="justify"&&(this.paragraphs.length<2?o=(t-this.actualWidth)/2:s=(t-this.actualWidth)/(this.paragraphs.length-1))),this.paragraphs.map((function(a){a instanceof xo?(a["_"+i.x]=o,o+=a[i.width]+s,a["_"+i.y]=a.attribute.textBaseline==="top"?0:a.attribute.textBaseline==="bottom"?r-a.height:(r-a.height)/2):(a[i.left]=o,o+=a[i.width]+s)}))}draw(t,e,i,r,o,s){if(o&&(e||this.paragraphs.some((d=>d.overflow)))){let d=!0,c=!1;for(let f=this.paragraphs.length-1;f>=0;f--){const p=this.paragraphs[f];if(p.overflow)d=d&&p.text==="";else if(d){c=!0;break}}let g=0;if(!c)for(let f=this.paragraphs.length-1;f>=0;f--){const p=this.paragraphs[f];if(p.overflow){if(p.text==="")break;continue}if(p instanceof xo)break;if(this.direction==="vertical"&&p.direction!=="vertical"){p.verticalEllipsis=!0;break}const m=o===!0?"...":o||"";p.ellipsisStr=m;const{width:v}=Qa(m,p.character,p.ascentDescentMode),b=v||0;if(b<=this.blankWidth+g){e&&(p.ellipsis="add");break}if(b<=this.blankWidth+g+p.width){p.ellipsis="replace",p.ellipsisWidth=b,p.ellipsisOtherParagraphWidth=this.blankWidth+g;break}p.ellipsis="hide",g+=p.width}}let a="",l=-1,h=[];const u=[h];this.paragraphs.forEach(((d,c)=>{if(d instanceof xo)return;const g=d.drawBackground(t,r,this.ascent,i,c===0,this.textAlign,this.height);g&&(a===g.fillStyle&&l===g.globalAlpha||(h=[],u.push(h),a=g.fillStyle,l=g.globalAlpha),h.push(g))})),u.forEach((d=>{if(d.length===0)return;const c=d[0],g=d[d.length-1];t.fillStyle=c.fillStyle,t.globalAlpha=c.globalAlpha,t.fillRect(c.left,c.top,g.right-c.left,g.bottom-c.top)})),this.paragraphs.forEach(((d,c)=>{if(d instanceof xo)return d.setAttributes({x:i+d._x,y:r+d._y}),void s(d,t,i+d._x,r+d._y,this.ascent);const g={x1:this.left,y1:this.top,x2:this.left+this.actualWidth,y2:this.top+this.height};B$(t,d.character),R$(t,d.character,g),d.draw(t,r,this.ascent,i,c===0,this.textAlign,this.height)}))}getWidthWithEllips(t){let e=0;for(let r=this.paragraphs.length-1;r>=0;r--){const o=this.paragraphs[r];if(o instanceof xo)break;const{width:s}=Qa(t,o.character,o.ascentDescentMode),a=s||0;if(a<=this.blankWidth+e){o.ellipsis="add",o.ellipsisWidth=a;break}if(a<=this.blankWidth+e+o.width){o.ellipsis="replace",o.ellipsisWidth=a,o.ellipsisOtherParagraphWidth=this.blankWidth+e;break}o.ellipsis="hide",e+=o.width}let i=0;return this.paragraphs.forEach(((r,o)=>{i+=r instanceof xo?r.width:r.getWidthWithEllips(this.direction)})),i}}class sY{constructor(t){this.frame=t,this.width=this.frame.width,this.height=this.frame.height,this.lineWidth=0,this.y=this.frame.top,this.maxAscent=0,this.maxDescent=0,this.maxAscentForBlank=0,this.maxDescentForBlank=0,this.lineBuffer=[],this.direction=t.layoutDirection,this.directionKey=sx[this.direction]}store(t){if(t instanceof xo){this.frame.icons.set(t.richtextId,t),this.lineBuffer.push(t),this.lineWidth+=t[this.directionKey.width];let e=0,i=0;t.attribute.textBaseline==="top"?(e=0,i=t.height):t.attribute.textBaseline==="bottom"?(e=t.height,i=0):(e=t.height/2,i=t.height/2),this.maxAscent=Math.max(this.maxAscent,e),this.maxDescent=Math.max(this.maxDescent,i)}else this.lineBuffer.push(t),t.text.length!==0?(this.lineWidth+=t[this.directionKey.width],this.maxAscent=Math.max(this.maxAscent,t.ascent),this.maxDescent=Math.max(this.maxDescent,t.descent)):(this.maxAscentForBlank=Math.max(this.maxAscentForBlank,t.ascent),this.maxDescentForBlank=Math.max(this.maxDescentForBlank,t.descent))}send(){if(this.lineBuffer.length===0)return;const t=this.maxAscent===0?this.maxAscentForBlank:this.maxAscent,e=this.maxDescent===0?this.maxDescentForBlank:this.maxDescent,i=new oY(this.frame.left,this[this.directionKey.width],this.y+t,t,e,this.lineBuffer,this.direction,this.direction==="horizontal"?this.frame.isWidthMax:this.frame.isHeightMax);this.frame.lines.push(i),this.frame.actualHeight+=i.height,this.y+=i.height,this.lineBuffer.length=0,this.lineWidth=this.maxAscent=this.maxDescent=this.maxAscentForBlank=this.maxDescentForBlank=0}deal(t,e=!1){t instanceof xo?this.direction==="horizontal"&&this.width===0||this.direction==="vertical"&&this.height===0||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):this.lineBuffer.length===0?(this.store(t),this.send()):(this.send(),this.deal(t)):typeof this.width!="number"||this.width<0||(t.newLine&&this.send(),(t.text.length!==0||this.newLine)&&(this.direction==="horizontal"&&this.width===0||this.direction==="vertical"&&this.height===0||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):this.lineWidth===this[this.directionKey.width]?(this.send(),this.deal(t)):this.cut(t,e)))}cut(t,e){const i=this[this.directionKey.width]-this.lineWidth||0,r=Math.ceil(i/t[this.directionKey.width]*t.length)||0,o=zf(t.text,i,t.character,r,this.frame.wordBreak==="break-word");if(o!==0){const[s,a]=rY(t,o);this.store(s),e?this.send():this.deal(a)}else this.lineBuffer.length!==0&&(this.send(),this.deal(t))}}let Z_=!1;try{Z_=Intl&&typeof Intl.Segmenter=="function"}catch{Z_=!1}const QM=["width","height","ellipsis","wordBreak","verticalDirection","maxHeight","maxWidth","textAlign","textBaseline","textConfig","layoutDirection","fill","stroke","fontSize","fontFamily","fontStyle","fontWeight","lineWidth","opacity","fillOpacity","strokeOpacity",...Dr];class ti extends Ni{constructor(t){super(t),this.type="richtext",this._currentHoverIcon=null,this.numberType=cx,this.onBeforeAttributeUpdate=(e,i,r)=>{for(const o in e)if(o==="hoverIconId"){if(e[o]===i[o])continue;const s=this._frameCache.icons.get(e[o]);this.updateHoverIconState(s)}}}get width(){var t;return(t=this.attribute.width)!==null&&t!==void 0?t:as.width}set width(t){this.attribute.width!==t&&(this.attribute.width=t,this.addUpdateShapeAndBoundsTag())}get height(){var t;return(t=this.attribute.height)!==null&&t!==void 0?t:as.height}set height(t){this.attribute.height!==t&&(this.attribute.height=t,this.addUpdateShapeAndBoundsTag())}get maxWidth(){return this.attribute.maxWidth}set maxWidth(t){this.attribute.maxWidth!==t&&(this.attribute.maxWidth=t,this.addUpdateShapeAndBoundsTag())}get maxHeight(){return this.attribute.maxHeight}set maxHeight(t){this.attribute.maxHeight!==t&&(this.attribute.maxHeight=t,this.addUpdateShapeAndBoundsTag())}get ellipsis(){var t;return(t=this.attribute.ellipsis)!==null&&t!==void 0?t:as.ellipsis}set ellipsis(t){this.attribute.ellipsis!==t&&(this.attribute.ellipsis=t,this.addUpdateShapeAndBoundsTag())}get wordBreak(){var t;return(t=this.attribute.wordBreak)!==null&&t!==void 0?t:as.wordBreak}set wordBreak(t){this.attribute.wordBreak!==t&&(this.attribute.wordBreak=t,this.addUpdateShapeAndBoundsTag())}get verticalDirection(){var t;return(t=this.attribute.verticalDirection)!==null&&t!==void 0?t:as.verticalDirection}set verticalDirection(t){this.attribute.verticalDirection!==t&&(this.attribute.verticalDirection=t,this.addUpdateShapeAndBoundsTag())}get textAlign(){var t;return(t=this.attribute.textAlign)!==null&&t!==void 0?t:as.textAlign}set textAlign(t){this.attribute.textAlign!==t&&(this.attribute.textAlign=t,this.addUpdateShapeAndBoundsTag())}get textBaseline(){var t;return(t=this.attribute.textBaseline)!==null&&t!==void 0?t:as.textBaseline}set textBaseline(t){this.attribute.textBaseline!==t&&(this.attribute.textBaseline=t,this.addUpdateShapeAndBoundsTag())}get textConfig(){var t;return(t=this.attribute.textConfig)!==null&&t!==void 0?t:as.textConfig}set textConfig(t){this.attribute.textConfig=t,this.addUpdateShapeAndBoundsTag()}getGraphicTheme(){return Wt(this).richtext}static AllSingleCharacter(t){return t.lines?t.lines.every((e=>e.paragraphs.every((i=>!(i.text&&Oo(i.text)&&ti.splitText(i.text).length>1))))):t.every((e=>e.isComposing||!(e.text&&Oo(e.text)&&ti.splitText(e.text).length>1)))}static splitText(t){if(Z_){const e=new Intl.Segmenter(void 0,{granularity:"grapheme"}),i=[];for(const{segment:r}of e.segment(t))i.push(r);return i}return Array.from(t)}static TransformTextConfig2SingleCharacter(t){const e=[];return t.forEach((i=>{const r=ti.splitText(i.text.toString());if(Oo(i.text)&&r.length>1)for(let o=0;o<r.length;o++){const s=r[o];e.push(Object.assign(Object.assign({},i),{text:s}))}else e.push(i)})),e}updateAABBBounds(t,e,i){var r,o,s,a;const{width:l=e.width,height:h=e.height,maxWidth:u=e.maxWidth,maxHeight:d=e.maxHeight,textAlign:c=e.textAlign,textBaseline:g=(o=(r=t.textBaseline)!==null&&r!==void 0?r:e.textBaseline)!==null&&o!==void 0?o:"top",editOptions:f}=t;if(l>0&&h>0)i.set(0,0,l,h);else{const v=this.getFrameCache(),{width:b,height:y}=v.getActualSize();let C=l||b||0,w=h||y||0;w=typeof d=="number"&&w>d?d:w||0,C=typeof u=="number"&&C>u?u:C||0,i.set(0,0,C,w)}f&&f.keepHeightWhileEmpty&&!i.height()&&!(!((s=t.textConfig)===null||s===void 0)&&s.length)&&(i.y2=i.y1+((a=t.fontSize)!==null&&a!==void 0?a:12),i.x2=i.x1+2);let p=0;switch(g){case"top":p=0;break;case"middle":p=-i.height()/2;break;case"bottom":p=-i.height()}let m=0;switch(c){case"left":m=0;break;case"center":m=-i.width()/2;break;case"right":m=-i.width()}return h||(this.verticalDirection==="middle"?p-=i.height()/2:this.verticalDirection==="bottom"&&(p-=i.height())),i.translate(m,p),mt.graphicService.updateTempAABBBounds(i),t.forceBoundsHeight==null&&t.forceBoundsWidth==null||mt.graphicService.updateHTMLTextAABBBounds(t,e,i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,mt.graphicService.transformAABBBounds(t,i,e,!1,this),i.width()===0&&i.height()===0&&i.clear(),i}needUpdateTags(t){return super.needUpdateTags(t,QM)}needUpdateTag(t){return super.needUpdateTag(t,QM)}getFrameCache(){return this.shouldUpdateShape()&&(this.doUpdateFrameCache(),this.clearUpdateShapeTag()),this._frameCache}get cliped(){const t=this.getFrameCache();if(t.actualHeight>t.height)return!0;const{disableAutoWrapLine:e}=this.attribute;if(e)for(let i=0;i<t.lines.length;i++){const r=t.lines[i];for(let o=0;o<r.paragraphs.length;o++){const s=r.paragraphs[o];if(s.overflow&&s.text!=="")return!0}}return!1}combinedStyleToCharacter(t){const{fill:e,stroke:i,fontSize:r,fontFamily:o,fontStyle:s,fontWeight:a,lineWidth:l,opacity:h,fillOpacity:u,lineHeight:d,strokeOpacity:c,upgradeAttrs:g}=this.attribute,f=Object.assign({fill:e,stroke:i,fontSize:r,fontFamily:o,fontStyle:s,fontWeight:a,lineWidth:l,opacity:h,fillOpacity:u,strokeOpacity:c},t);return g?.lineHeight&&(f.lineHeight=d),f}doUpdateFrameCache(t){var e;const{maxWidth:i,maxHeight:r,width:o,height:s,ellipsis:a,wordBreak:l,verticalDirection:h,textAlign:u,textBaseline:d,layoutDirection:c,singleLine:g,disableAutoWrapLine:f,editable:p,ascentDescentMode:m,upgradeAttrs:v}=this.attribute,b=v&&v.multiBreakLine;let{textConfig:y=[]}=this.attribute;p&&y.length>0&&!ti.AllSingleCharacter(y)&&(y=ti.TransformTextConfig2SingleCharacter(y),this.attribute.textConfig=y);const C=[],w=t??y;for(let R=0;R<w.length;R++)if("image"in w[R]){const E=this.combinedStyleToCharacter(w[R]);E.lineWidth=void 0;const P=E.id&&this._frameCache&&this._frameCache.icons&&this._frameCache.icons.get(E.id);if(P)C.push(P);else{const B=new xo(E);B.successCallback=()=>{var k;this.addUpdateBoundTag(),(k=this.stage)===null||k===void 0||k.renderNextFrame()},B.richtextId=E.id,C.push(B)}}else{const E=this.combinedStyleToCharacter(w[R]);if($i(E.text)&&(E.text=`${E.text}`),E.text&&E.text.includes(`
`)){const P=E.text.split(`
`);for(let B=0;B<P.length;B++)if(B===0)C.push(new dl(P[B],!1,E,m));else if(P[B]||R===w.length-1)C.push(new dl(P[B],!0,E,m));else{const k=this.combinedStyleToCharacter(w[R+1]);C.push(new dl(P[B],!0,k,m))}}else E.text&&C.push(new dl(E.text,!1,E,m))}const _=typeof i=="number"&&Number.isFinite(i)&&i>0,A=typeof r=="number"&&Number.isFinite(r)&&r>0,x=typeof o=="number"&&Number.isFinite(o)&&o>0&&(!_||o<=i),S=typeof s=="number"&&Number.isFinite(s)&&s>0&&(!A||s<=r),T=new nY(0,0,(x?o:_?i:0)||0,(S?s:A?r:0)||0,a,l,h,u,d,c||"horizontal",!x&&_,!S&&A,g||!1,(e=this._frameCache)===null||e===void 0?void 0:e.icons),M=new sY(T);if(M.newLine=b,f){let R=0,E=!1;for(let P=0;P<C.length;P++){const B=C[P];E?(B.overflow=!0,B.left=1/0,B.top=1/0,!B.newLine&&T.lines[T.lines.length-1].paragraphs.push(B)):M.deal(B,!0),T.lines.length!==R&&(R=T.lines.length,M.lineBuffer.length=0,B.overflow=!0,B.left=1e3,B.top=1e3,T.lines[T.lines.length-1].paragraphs.push(B),E=!0),B.newLine&&(E=!1,M.lineWidth=0),M.send()}}else for(let R=0;R<C.length;R++)M.deal(C[R]);if(M.send(),!(T.layoutDirection==="horizontal"?x:S)){const R=T.getActualSizeWidthEllipsis();let E=T.layoutDirection==="horizontal"?R.width:R.height;(T.layoutDirection==="horizontal"?_:A)&&(E=Math.min(E,T.layoutDirection==="horizontal"?i:r)),T.lines.forEach((function(P){P.calcOffset(E,!1)}))}b&&T.lines.forEach((R=>{const E=R.paragraphs;R.paragraphs=R.paragraphs.filter((P=>P.text!=="")),R.paragraphs.length===0&&E.length&&(E[0].text=`
`,R.paragraphs.push(E[0]))})),this._frameCache=T}clone(){return new ti(Object.assign({},this.attribute))}setStage(t,e){super.setStage(t,e),this.getFrameCache().icons.forEach((i=>{i.setStage(t,e)}))}bindIconEvent(){this.addEventListener("pointermove",(t=>{const e=this.pickIcon(t.global);e&&e===this._currentHoverIcon||(e?this.setAttribute("hoverIconId",e.richtextId):!e&&this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0))})),this.addEventListener("pointerleave",(t=>{this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0)}))}updateHoverIconState(t){var e,i,r,o,s;t?((e=this._currentHoverIcon)===null||e===void 0||e.setHoverState(!1),this._currentHoverIcon=t,this._currentHoverIcon.setHoverState(!0),(i=this.stage)===null||i===void 0||i.setCursor(t.attribute.cursor),(r=this.stage)===null||r===void 0||r.renderNextFrame()):(this._currentHoverIcon.setHoverState(!1),this._currentHoverIcon=null,(o=this.stage)===null||o===void 0||o.setCursor(),(s=this.stage)===null||s===void 0||s.renderNextFrame())}pickIcon(t){const e=this.getFrameCache(),{e:i,f:r}=this.globalTransMatrix;let o;return e.icons.forEach(((s,a)=>{var l,h;const u=s.AABBBounds.clone();u.translate(s._marginArray[3],s._marginArray[0]),u.containsPoint({x:t.x-i,y:t.y-r})&&(o=s,o.globalX=((l=o.attribute.x)!==null&&l!==void 0?l:0)+i+s._marginArray[3],o.globalY=((h=o.attribute.y)!==null&&h!==void 0?h:0)+r+s._marginArray[0])})),o}getNoWorkAnimateAttr(){return ti.NOWORK_ANIMATE_ATTR}}ti.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,verticalDirection:1,textAlign:1,textBaseline:1,textConfig:1,layoutDirection:1},go);function aY(n){return new ti(n)}const tT=["path","customPath",...Dr];class kc extends Ni{constructor(t){super(t),this.type="path",this.numberType=cv}get pathShape(){return this.tryUpdateAABBBounds(),this.getParsedPathShape()}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{path:t}=this.attribute;return t!=null&&t!==""}getParsedPathShape(){const t=this.getGraphicTheme();if(!this.valid)return t.path;const e=this.attribute;return e.path instanceof Fi?e.path:(ze(this.cache)&&this.doUpdatePathShape(),this.cache instanceof Fi?this.cache:t.path)}getGraphicTheme(){return Wt(this).path}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){const a=this.getParsedPathShape();i.union(a.getBounds())}const{tb1:r,tb2:o}=mt.graphicService.updateTempAABBBounds(i);ug(t,e,r),i.union(r),r.setValue(o.x1,o.y1,o.x2,o.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1;const{lineJoin:s=e.lineJoin}=t;return mt.graphicService.transformAABBBounds(t,i,e,s==="miter",this),i}doUpdateAABBBounds(t){return this.doUpdatePathShape(),super.doUpdateAABBBounds(t)}doUpdatePathShape(){const t=this.attribute;Oo(t.path,!0)?this.cache=new Fi().fromString(t.path):t.customPath&&(this.cache=new Fi,t.customPath(this.cache,this))}needUpdateTags(t){return super.needUpdateTags(t,tT)}needUpdateTag(t){return super.needUpdateTag(t,tT)}toCustomPath(){return new Fi().fromCustomPath2D(this.getParsedPathShape(),0,0)}clone(){return new kc(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return kc.NOWORK_ANIMATE_ATTR}}kc.NOWORK_ANIMATE_ATTR=Object.assign({path:1,customPath:1},go);function lY(n){return new kc(n)}const eT=["innerRadius","outerRadius","startAngle","endAngle","cornerRadius","padAngle","padRadius","cap",...Dr];class Cu extends Ni{constructor(t){super(t),this.type="arc",this.numberType=hv}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,outerRadius:i,innerRadius:r}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)&&this._validNumber(r)}getParsedCornerRadius(){const t=this.getGraphicTheme(),{cornerRadius:e=t.cornerRadius,innerPadding:i=t.innerPadding,outerPadding:r=t.outerPadding}=this.attribute;let{outerRadius:o=t.outerRadius,innerRadius:s=t.innerRadius}=this.attribute;if(o+=r,s-=i,e===0||e==="0%")return 0;const a=Math.abs(o-s),l=h=>Math.min($i(h,!0)?h:a*parseFloat(h)/100,a/2);if(ue(e)){const h=e.map((u=>l(u)||0));return h.length===0?[h[0],h[0],h[0],h[0]]:h.length===2?[h[0],h[1],h[0],h[1]]:(h.length===3&&h.push(0),h)}return l(e)}getParsedAngle(){const t=this.getGraphicTheme();let{startAngle:e=t.startAngle,endAngle:i=t.endAngle}=this.attribute;const{cap:r=t.cap}=this.attribute,o=i-e>=0?1:-1,s=i-e;if(e=CG(e),i=e+s,r&&ge(s)<zt-Pe){let a=1,l=1;r.length&&(a=Number(r[0]),l=Number(r[1]));let{outerRadius:h=t.outerRadius,innerRadius:u=t.innerRadius}=this.attribute;const{outerPadding:d=t.outerPadding,innerPadding:c=t.innerPadding}=this.attribute;h+=d,u-=c;const g=Math.abs(h-u)/2,f=g/h;if(g>Pe&&h>Pe)return{startAngle:e-o*f*a,endAngle:i+o*f*l,sc:o*f*a,ec:o*f*l}}return{startAngle:e,endAngle:i}}getParsePadAngle(t,e){const i=this.getGraphicTheme(),{innerPadding:r=i.innerPadding,outerPadding:o=i.outerPadding,padAngle:s=i.padAngle}=this.attribute;let{outerRadius:a=i.outerRadius,innerRadius:l=i.innerRadius}=this.attribute;a+=o,l-=r;const{padRadius:h=eo(a*a+l*l)}=this.attribute,u=ge(e-t);let d=t,c=e,g=t,f=e;const p=s/2;let m=u,v=u;if(p>Pe&&h>Pe){const b=e>t?1:-1;let y=VA(Number(h)/l*Ue(p)),C=VA(Number(h)/a*Ue(p));return(m-=2*y)>Pe?(y*=b,g+=y,f-=y):(m=0,g=f=(t+e)/2),(v-=2*C)>Pe?(C*=b,d+=C,c-=C):(v=0,d=c=(t+e)/2),{outerStartAngle:d,outerEndAngle:c,innerStartAngle:g,innerEndAngle:f,innerDeltaAngle:m,outerDeltaAngle:v}}return{outerStartAngle:d,outerEndAngle:c,innerStartAngle:g,innerEndAngle:f,innerDeltaAngle:m,outerDeltaAngle:v}}getGraphicTheme(){return Wt(this).arc}updateAABBBounds(t,e,i,r){this.updatePathProxyAABBBounds(i)||(r?this.updateArcAABBBoundsImprecise(t,e,i):this.updateArcAABBBoundsAccurate(t,e,i));const{tb1:o,tb2:s}=mt.graphicService.updateTempAABBBounds(i);ug(t,e,o),i.union(o),o.setValue(s.x1,s.y1,s.x2,s.y2),this.setWidthHeightWithoutTransform(i);const{lineJoin:a=e.lineJoin}=t;return mt.graphicService.transformAABBBounds(t,i,e,a==="miter",this),i}updateArcAABBBoundsImprecise(t,e,i){let{outerRadius:r=e.outerRadius,innerRadius:o=e.innerRadius}=t;const{outerPadding:s=e.outerPadding,innerPadding:a=e.innerPadding}=t;return r+=s,o-=a,r<o&&(r=o),i.set(-r,-r,r,r),i}updateArcAABBBoundsAccurate(t,e,i){let{outerRadius:r=e.outerRadius,innerRadius:o=e.innerRadius}=t;const{outerPadding:s=e.outerPadding,innerPadding:a=e.innerPadding}=t;if(r+=s,o-=a,r<o){const u=r;r=o,o=u}let{endAngle:l=e.endAngle,startAngle:h=e.startAngle}=t;if(h>l){const u=h;h=l,l=u}return r<=Pe?i.set(0,0,0,0):Math.abs(l-h)>zt-Pe?i.set(-r,-r,r,r):(E_(h,l,r,i),E_(h,l,o,i)),i}needUpdateTags(t){return super.needUpdateTags(t,eT)}needUpdateTag(t){return super.needUpdateTag(t,eT)}toCustomPath(){var t,e,i,r;let o=super.toCustomPath();if(o)return o;const s=this.attribute,{startAngle:a,endAngle:l}=this.getParsedAngle();let h=((t=s.innerRadius)!==null&&t!==void 0?t:0)-((e=s.innerPadding)!==null&&e!==void 0?e:0),u=((i=s.outerRadius)!==null&&i!==void 0?i:0)-((r=s.outerPadding)!==null&&r!==void 0?r:0);const d=ge(l-a),c=l>a;if(u<h){const g=u;u=h,h=g}if(o=new Fi,u<=Pe)o.moveTo(0,0);else if(d>=zt-Pe)o.moveTo(0+u*Mi(a),0+u*Ue(a)),o.arc(0,0,u,a,l,!c),h>Pe&&(o.moveTo(0+h*Mi(l),0+h*Ue(l)),o.arc(0,0,h,l,a,c));else{const g=u*Mi(a),f=u*Ue(a),p=h*Mi(l),m=h*Ue(l);o.moveTo(0+g,0+f),o.arc(0,0,u,a,l,!c),o.lineTo(0+p,0+m),o.arc(0,0,h,l,a,c),o.closePath()}return o}clone(){return new Cu(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Cu.NOWORK_ANIMATE_ATTR}}Cu.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},go);function Dp(n){return new Cu(n)}const iT=["points","cornerRadius",...Dr];class Dl extends Ni{constructor(t){super(t),this.type="polygon",this.numberType=gv}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{points:t}=this.attribute;return t&&t.length>=2}getGraphicTheme(){return Wt(this).polygon}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||this.updatePolygonAABBBoundsImprecise(t,e,i),mt.graphicService.updateTempAABBBounds(i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1;const{lineJoin:r=e.lineJoin}=t;return mt.graphicService.transformAABBBounds(t,i,e,r==="miter",this),i}updatePolygonAABBBoundsImprecise(t,e,i){const{points:r=e.points}=t;return r.forEach((o=>{i.add(o.x,o.y)})),i}_interpolate(t,e,i,r,o){t==="points"&&(o.points=hx(i,r,e))}needUpdateTags(t){return super.needUpdateTags(t,iT)}needUpdateTag(t){return super.needUpdateTag(t,iT)}toCustomPath(){let t=super.toCustomPath();if(t)return t;const e=this.attribute.points;return t=new Fi,e.forEach(((i,r)=>{r===0?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y)})),t.closePath(),t}clone(){return new Dl(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Dl.NOWORK_ANIMATE_ATTR}}Dl.NOWORK_ANIMATE_ATTR=go;function II(n){return new Dl(n)}class hY extends Jt{constructor(t){super({x:0,y:0}),this.type="shadowroot",this.shadowHost=t}clearUpdateBoundTag(){super.clearUpdateBoundTag(),this.shadowHost&&this.shadowHost.clearUpdateBoundTag()}addUpdateBoundTag(){super.addUpdateBoundTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}addUpdateShapeAndBoundsTag(){super.addUpdateShapeAndBoundsTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}tryUpdateGlobalTransMatrix(t=!0){if(this.shouldUpdateGlobalMatrix()){const e=this.transMatrix;this._globalTransMatrix?this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f):this._globalTransMatrix=e.clone(),this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}doUpdateGlobalMatrix(){if(this.shadowHost){const t=this.shadowHost.globalTransMatrix;this._globalTransMatrix.multiply(t.a,t.b,t.c,t.d,t.e,t.f)}}tryUpdateGlobalAABBBounds(){return this._globalAABBBounds?this._globalAABBBounds.setValue(this._AABBBounds.x1,this._AABBBounds.y1,this._AABBBounds.x2,this._AABBBounds.y2):this._globalAABBBounds=this._AABBBounds.clone(),this.shadowHost&&this._globalAABBBounds.transformWithMatrix(this.shadowHost.globalTransMatrix),this._globalAABBBounds}}function uY(n){return new hY(n)}class dY{constructor(){this.store=new Map}RegisterGraphicCreator(t,e){this.store.set(t,e),this[t]=e}CreateGraphic(t,e){const i=this.store.get(t);return i?i(e):null}}const At=new dY;let tf;function vv(n){return tf||(tf=At.CreateGraphic("text",{})),tf.initAttributes(n),tf.AABBBounds}var cY=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},gY=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},nT=function(n,t){return function(e,i){t(e,i,n)}};class bv{constructor(){this.time=ne.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,s,a,l,h,u,d,c,g){var f;const{background:p,backgroundOpacity:m=(f=t.attribute.fillOpacity)!==null&&f!==void 0?f:h.backgroundOpacity,opacity:v=h.opacity,backgroundMode:b=h.backgroundMode,backgroundFit:y=h.backgroundFit,backgroundKeepAspectRatio:C=h.backgroundKeepAspectRatio,backgroundScale:w=h.backgroundScale,backgroundOffsetX:_=h.backgroundOffsetX,backgroundOffsetY:A=h.backgroundOffsetY,backgroundClip:x=h.backgroundClip}=t.attribute;if(p)if(t.backgroundImg&&t.resources){const S=t.resources.get(p);if(S.state!=="success"||!S.data)return;if(e.save(),t.parent&&!t.transMatrix.onlyTranslate()){const M=Wt(t.parent).group,{scrollX:R=M.scrollX,scrollY:E=M.scrollY}=t.parent.attribute;e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.translate(R,E)}x&&e.clip();const T=t.AABBBounds;e.setCommonStyle(t,t.attribute,i,r,h),e.globalAlpha=m*v,this.doDrawImage(e,S.data,T,{backgroundMode:b,backgroundFit:y,backgroundKeepAspectRatio:C,backgroundScale:w,backgroundOffsetX:_,backgroundOffsetY:A}),e.restore(),t.transMatrix.onlyTranslate()||e.setTransformForCurrent()}else e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,r,h),e.globalAlpha=m*v,e.fillStyle=p,e.fill(),e.highPerformanceRestore()}doDrawImage(t,e,i,r){const{backgroundMode:o,backgroundFit:s,backgroundKeepAspectRatio:a,backgroundScale:l=1,backgroundOffsetX:h=0,backgroundOffsetY:u=0}=r,d=i.width(),c=i.height();let g=d,f=c;if(o==="no-repeat")if(s)if(a){const p=Math.max(d/e.width,c/e.height);t.drawImage(e,i.x1+h,i.y1+u,e.width*p*l,e.height*p*l)}else t.drawImage(e,i.x1,i.y1,i.width(),i.height());else{const p=e.width*l,m=e.height*l;t.drawImage(e,i.x1+h,i.y1+u,p,m)}else{if(s&&o!=="repeat"&&(e.width||e.height)){const v=e.width,b=e.height;o==="repeat-x"?(g=v*(c/b),f=c):o==="repeat-y"&&(f=b*(d/v),g=d);const y=t.dpr,C=_l.allocate({width:g,height:f,dpr:y}),w=C.getContext("2d");w&&(w.inuse=!0,w.clearMatrix(),w.setTransformForCurrent(!0),w.clearRect(0,0,g,f),w.drawImage(e,0,0,g,f),e=C.nativeCanvas),_l.free(C)}const p=t.dpr,m=t.createPattern(e,o);m.setTransform&&m.setTransform(new DOMMatrix([1/p,0,0,1/p,0,0])),t.fillStyle=m,t.translate(i.x1,i.y1),t.fillRect(0,0,d,c),t.translate(-i.x1,-i.y1)}}}const Ma=new bv;let so=class{constructor(n){this.subRenderContribitions=n,this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){this._subRenderContribitions||(this._subRenderContribitions=this.subRenderContribitions.getContributions()),this._subRenderContribitions.forEach((g=>{g.render(n,t,e,i,r,o,s,a,l,h,u,d,c)}))}};so=cY([pt(),nT(0,Xt(li)),nT(0,Li(bx)),gY("design:paramtypes",[Object])],so);class fY{constructor(){this.time=ne.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,s,a,l,h,u,d,c,g){var f,p;const{clipConfig:m}=t.attribute;if(!m)return;const v=t.getClipPath();if(!v)return;const b=!(d||c),y=t.AABBBounds,C=(f=t.attribute.width)!==null&&f!==void 0?f:y.width(),w=(p=t.attribute.height)!==null&&p!==void 0?p:y.height();b&&e.save(),e.beginPath(),v.draw(e,[C,w],i+C/2,r+w/2,0)===!1&&e.closePath(),d&&d(e,t.attribute,h,!0),b&&e.clip()}}const pY=new fY;class mY{constructor(){this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,s,a,l,h,u,d,c,g){const{clipConfig:f}=t.attribute;f&&t.getClipPath()&&(d||c||e.restore())}}const vY=new mY;function bY(n){return n<=.5?4*n-1:-4*n+3}function yY(n,t,e,i,r,o,s){const{fill:a="orange",percent:l=.6,frequency:h=4,opacity:u,phi:d=0}=r;let{amplitude:c=10}=r;c*=bY(t);const g=i*(1-l),f=e,p=Math.max(Math.round(f/70),2);n.beginPath(),n.moveTo(0+o,i+s),n.lineTo(0+o,g+s);const m=f/h*t,v=f/Math.PI/(2*h);for(let b=0;b<f;b+=p){const y=c*Math.sin((b+m+d)/v+d);n.lineTo(b+o,g+y+s)}n.lineTo(f+o,i+s),n.closePath(),n.fillStyle=a,isFinite(u)&&(n.globalAlpha=u),n.fill()}class _x{constructor(){this.time=ne.afterFillStroke,this.useStyle=!0,this.order=10,this._tempSymbolGraphic=null}createCommonPattern(t,e,i,r,o){const s=(t-2*e)/2,a=r.dpr,l=_l.allocate({width:t,height:t,dpr:a}),h=l.getContext("2d");if(!h)return null;h.inuse=!0,h.clearMatrix(),h.setTransformForCurrent(!0),h.clearRect(0,0,t,t),o(s,h);const u=r.createPattern(l.nativeCanvas,"repeat");return u.setTransform&&u.setTransform(new DOMMatrix([1/a,0,0,1/a,0,0])),_l.free(l),u}createCirclePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((o,s)=>{s.fillStyle=i,s.arc(o,o,o,0,zt),s.fill()}))}createDiamondPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((o,s)=>{const a=t/2,l=a;s.fillStyle=i,s.moveTo(a,l-o),s.lineTo(o+a,l),s.lineTo(a,l+o),s.lineTo(a-o,l),s.closePath(),s.fill()}))}createRectPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((o,s)=>{const a=e,l=a;s.fillStyle=i,s.fillRect(a,l,2*o,2*o)}))}createVerticalLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((o,s)=>{const a=e;s.fillStyle=i,s.fillRect(a,0,2*o,t)}))}createHorizontalLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((o,s)=>{const a=e;s.fillStyle=i,s.fillRect(0,a,t,2*o)}))}createBiasLRLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((o,s)=>{s.strokeStyle=i,s.lineWidth=o,s.moveTo(0,0),s.lineTo(t,t);const a=t/2,l=-a;s.moveTo(a,l),s.lineTo(a+t,l+t),s.moveTo(-a,-l),s.lineTo(-a+t,-l+t),s.stroke()}))}createBiasRLLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((o,s)=>{s.strokeStyle=i,s.lineWidth=o,s.moveTo(t,0),s.lineTo(0,t);const a=t/2,l=a;s.moveTo(t+a,l),s.lineTo(a,l+t),s.moveTo(t-a,-l),s.lineTo(-a,-l+t),s.stroke()}))}createGridPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,((o,s)=>{const a=e,l=a;s.fillStyle=i,s.fillRect(a,l,o,o),s.fillRect(a+o,l+o,o,o)}))}initTextureMap(t,e){this.textureMap=new Map}drawShape(t,e,i,r,o,s,a,l,h,u,d,c,g){this.textureMap||this.initTextureMap(e,t.stage);const{texture:f=h.texture,textureColor:p=h.textureColor,textureSize:m=h.textureSize,texturePadding:v=h.texturePadding}=t.attribute;f&&this.drawTexture(f,t,e,i,r,h,p,m,v)}drawTexture(t,e,i,r,o,s,a,l,h){var u;const{textureRatio:d=s.textureRatio,textureOptions:c=null}=e.attribute;let g=this.textureMap.get(t);if(!g)switch(t){case"circle":g=this.createCirclePattern(l,h,a,i);break;case"diamond":g=this.createDiamondPattern(l,h,a,i);break;case"rect":g=this.createRectPattern(l,h,a,i);break;case"vertical-line":g=this.createVerticalLinePattern(l,h,a,i);break;case"horizontal-line":g=this.createHorizontalLinePattern(l,h,a,i);break;case"bias-lr":g=this.createBiasLRLinePattern(l,h,a,i);break;case"bias-rl":g=this.createBiasRLLinePattern(l,h,a,i);break;case"grid":g=this.createGridPattern(l,h,a,i)}if(c&&c.dynamicTexture){const{gridConfig:f={},useNewCanvas:p}=c,m=e.AABBBounds;r=m.x1,o=m.y1;const v=i;let b;if(p){b=_l.allocate({width:m.width(),height:m.height(),dpr:i.dpr});const P=b.getContext("2d");P.clearRect(0,0,m.width(),m.height()),r=0,o=0,i=P}if(v.save(),e.parent&&!e.transMatrix.onlyTranslate()){const{scrollX:P=0,scrollY:B=0}=e.parent.attribute;v.setTransformFromMatrix(e.parent.globalTransMatrix),v.translate(P,B,!0)}v.setCommonStyle(e,e.attribute,r,o,s),v.clip();const y=m.width(),C=m.height(),w=h,_=l,A=f.columns?f.columns:Math.ceil(y/_),x=f.rows?f.rows:Math.ceil(C/_),S=f.gutterColumn?f.gutterColumn:2*w,T=f.gutterRow?f.gutterRow:2*w;this._tempSymbolGraphic||(this._tempSymbolGraphic=yu({}));const M=f.columns?y/f.columns:_,R=f.rows?C/f.rows:_;this._tempSymbolGraphic.setAttributes({size:[M-S,R-T],symbolType:t});const E=this._tempSymbolGraphic.getParsedPath();for(let P=0;P<x;P++)for(let B=0;B<A;B++){const k=r+_/2+B*_,L=o+_/2+P*_;(u=c.beforeDynamicTexture)===null||u===void 0||u.call(c,i,P,B,x,A,d,e,m.width(),m.height()),i.beginPath(),E.draw(i,Math.min(M-S,R-T),k,L,0)===!1&&i.closePath(),i.fillStyle=a,c.dynamicTexture(i,P,B,x,A,d,e,m.width(),m.height())}p&&(v.globalAlpha=1,v.drawImage(b.nativeCanvas,0,0,b.nativeCanvas.width,b.nativeCanvas.height,m.x1,m.y1,m.width()*v.dpr,m.height()*v.dpr)),v.restore()}else if(g)i.highPerformanceSave(),i.setCommonStyle(e,e.attribute,r,o,s),i.fillStyle=g,i.fill(),i.highPerformanceRestore();else if(t==="wave"){i.save(),i.setCommonStyle(e,e.attribute,r,o,s),i.clip();const f=e.AABBBounds;yY(i,d,f.width(),f.height(),Object.assign(Object.assign({},c||{}),{fill:a}),r+f.x1-r,o+f.y1-o),i.restore()}}}const Iu=new _x;class CY{constructor(){this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,s,a,l,h,u,d,c){const{outerBorder:g,innerBorder:f}=t.attribute,p=g&&g.visible!==!1,m=f&&f.visible!==!1;if(!p&&!m)return;const{innerPadding:v=h.innerPadding,outerPadding:b=h.outerPadding,startAngle:y=h.startAngle,endAngle:C=h.endAngle,opacity:w=h.opacity,x:_=h.x,y:A=h.y,scaleX:x=h.scaleX,scaleY:S=h.scaleY,keepStrokeScale:T=h.keepStrokeScale}=t.attribute;let{innerRadius:M=h.innerRadius,outerRadius:R=h.outerRadius}=t.attribute;R+=b,M-=v;const E=(P,B)=>{const k=!(!P||!P.stroke),{distance:L=h[B].distance}=P,O=T?L:jo(e,L,e.dpr),I=L/R,H=B==="outerBorder"?1:-1;if(t.setAttributes({outerRadius:R+H*O,innerRadius:M-H*O,startAngle:y-H*I,endAngle:C+H*I}),e.beginPath(),z_(t,e,i,r,R+H*O,M-H*O),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,P,h[B]);else if(k){const D=h[B].opacity;h[B].opacity=w,e.setStrokeStyle(t,P,(_-i)/x,(A-r)/S,h[B]),h[B].opacity=D,e.stroke()}};p&&E(g,"outerBorder"),m&&E(f,"innerBorder"),t.setAttributes({outerRadius:R,innerRadius:M,startAngle:y,endAngle:C})}}const _Y=new CY,wY=Iu,xY=Ma;class SY{constructor(){this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,s,a,l,h,u,d,c){const{outerBorder:g,innerBorder:f}=t.attribute,p=g&&g.visible!==!1,m=f&&f.visible!==!1;if(!p&&!m)return;const{radius:v=h.radius,startAngle:b=h.startAngle,endAngle:y=h.endAngle,opacity:C=h.opacity,x:w=h.x,y:_=h.y,scaleX:A=h.scaleX,scaleY:x=h.scaleY,keepStrokeScale:S=h.keepStrokeScale}=t.attribute,T=(M,R)=>{const E=!(!M||!M.stroke),{distance:P=h[R].distance}=M,B=S?P:jo(e,P,e.dpr),k=R==="outerBorder"?1:-1;if(e.beginPath(),e.arc(i,r,v+k*B,b,y),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,M,h[R]);else if(E){const L=h[R].opacity;h[R].opacity=C,e.setStrokeStyle(t,M,(w-i)/A,(_-r)/x,h[R]),h[R].opacity=L,e.stroke()}};p&&T(g,"outerBorder"),m&&T(f,"innerBorder")}}const AY=new SY,MY=Iu,TY=Ma;class RY extends bv{constructor(){super(...arguments),this.time=ne.beforeFillStroke}drawShape(t,e,i,r,o,s,a,l,h,u,d,c){const{background:g,backgroundMode:f=h.backgroundMode,backgroundFit:p=h.backgroundFit,backgroundKeepAspectRatio:m=h.backgroundKeepAspectRatio,backgroundScale:v=h.backgroundScale,backgroundOffsetX:b=h.backgroundOffsetX,backgroundOffsetY:y=h.backgroundOffsetY}=t.attribute;if(g)if(t.backgroundImg&&t.resources){const C=t.resources.get(g);if(C.state!=="success"||!C.data)return;e.highPerformanceSave(),e.setTransformFromMatrix(t.parent.globalTransMatrix,!0);const w=t.AABBBounds;this.doDrawImage(e,C.data,w,{backgroundMode:f,backgroundFit:p,backgroundKeepAspectRatio:m,backgroundScale:v,backgroundOffsetX:b,backgroundOffsetY:y}),e.highPerformanceRestore(),e.setTransformForCurrent()}else e.highPerformanceSave(),e.fillStyle=g,e.fill(),e.highPerformanceRestore()}}const rT=new RY,ef=si/2;function Vo(n,t,e,i,r,o,s=!0,a){let l;if(Array.isArray(s)&&(a=s,s=!0),i<0&&(t+=i,i=-i),r<0&&(e+=r,r=-r),$i(o,!0))l=[o=ge(o),o,o,o];else if(Array.isArray(o)){const A=o;let x,S;switch(A.length){case 0:l=[0,0,0,0];break;case 1:x=ge(A[0]),l=[x,x,x,x];break;case 2:case 3:x=ge(A[0]),S=ge(A[1]),l=[x,S,x,S];break;default:l=A,l[0]=ge(l[0]),l[1]=ge(l[1]),l[2]=ge(l[2]),l[3]=ge(l[3])}}else l=[0,0,0,0];if(i<0||l[0]+l[1]+l[2]+l[3]<1e-12)return n.rect(t,e,i,r);const[h,u,d,c]=[[t,e],[t+i,e],[t+i,e+r],[t,e+r]],g=Math.min(i/2,r/2),f=[Math.min(g,l[0]),Math.min(g,l[1]),Math.min(g,l[2]),Math.min(g,l[3])],p=[h[0]+f[0],h[1]],m=[h[0],h[1]+f[0]],v=[u[0]-f[1],u[1]],b=[u[0],u[1]+f[1]],y=[d[0]-f[2],d[1]],C=[d[0],d[1]-f[2]],w=[c[0]+f[3],c[1]],_=[c[0],c[1]-f[3]];if(n.moveTo(p[0],p[1]),s){if(a&&a[0]?a[0](p[0],p[1],v[0],v[1]):n.lineTo(v[0],v[1]),!Wg(v,b)){a&&a[0]&&n.moveTo(v[0],v[1]);const A=v[0],x=v[1]+f[1];n.arc(A,x,f[1],-ef,0,!1)}if(a&&a[1]?a[1](b[0],b[1],C[0],C[1]):n.lineTo(C[0],C[1]),!Wg(y,C)){const A=C[0]-f[2],x=C[1];a&&a[1]&&n.moveTo(C[0],C[1]),n.arc(A,x,f[2],0,ef,!1)}if(a&&a[2]?a[2](y[0],y[1],w[0],w[1]):n.lineTo(w[0],w[1]),!Wg(w,_)){const A=w[0],x=w[1]-f[3];a&&a[2]&&n.moveTo(w[0],w[1]),n.arc(A,x,f[3],ef,si,!1)}if(a&&a[3]?a[3](_[0],_[1],m[0],m[1]):n.lineTo(m[0],m[1]),!Wg(p,m)){const A=p[0],x=p[1]+f[0];a&&a[3]&&n.moveTo(m[0],m[1]),n.arc(A,x,f[0],si,si+ef,!1)}}else a&&a[0]?a[0](p[0],p[1],v[0],v[1]):n.lineTo(v[0],v[1]),a&&a[1]?a[1](v[0],v[1],y[0],y[1]):n.lineTo(y[0],y[1]),a&&a[2]?a[2](y[0],y[1],w[0],w[1]):n.lineTo(w[0],w[1]),a&&a[2]?a[2](w[0],w[1],p[0],p[1]):n.lineTo(p[0],p[1]);return!a&&n.closePath(),n}var HI=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};class DI{constructor(){this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,s,a,l,h,u,d,c){const{outerBorder:g,innerBorder:f}=t.attribute,p=g&&g.visible!==!1,m=f&&f.visible!==!1;if(!p&&!m)return;const{cornerRadius:v=h.cornerRadius,cornerType:b=h.cornerType,opacity:y=h.opacity,x:C=h.x,y:w=h.y,scaleX:_=h.scaleX,scaleY:A=h.scaleY,x1:x,y1:S,keepStrokeScale:T=h.keepStrokeScale}=t.attribute;let{width:M,height:R}=t.attribute;M=(M??x-i)||0,R=(R??S-r)||0;const E=(P,B)=>{const k=!(!P||!P.stroke),L=B==="outerBorder"?-1:1,{distance:O=h[B].distance}=P,I=T?O:jo(e,O,e.dpr),H=i+L*I,D=r+L*I,z=2*I;if(v===0||ue(v)&&v.every((G=>G===0))?(e.beginPath(),e.rect(H,D,M-L*z,R-L*z)):(e.beginPath(),Vo(e,H,D,M-L*z,R-L*z,v,b!=="bevel")),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,P,h[B]);else if(k){const G=h[B].opacity;h[B].opacity=y,e.setStrokeStyle(t,P,(C-i)/_,(w-r)/A,h[B]),h[B].opacity=G,e.stroke()}};p&&E(g,"outerBorder"),m&&E(f,"innerBorder")}}let _u=class{constructor(){this.time=ne.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,s,a,l,h,u,d,c,g){const{stroke:f=h.stroke}=t.attribute;Array.isArray(f)&&f.some((p=>p===!1))&&(g.doStroke=!1)}};_u=HI([pt()],_u);let wu=class{constructor(){this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,s,a,l,h,u,d,c){const{x1:g,y1:f,x:p=h.x,y:m=h.y,stroke:v=h.stroke,cornerRadius:b=h.cornerRadius,cornerType:y=h.cornerType}=t.attribute;let{width:C,height:w}=t.attribute;if(C=(C??g-p)||0,w=(w??f-m)||0,Array.isArray(v)&&v.some((_=>_===!1))){if(e.setStrokeStyle(t,t.attribute,i,r,h),!(b===0||ue(b)&&b.every((_=>_===0)))){let _,A=0;return Vo(e,i,r,C,w,b,y!=="bevel",new Array(4).fill(0).map(((x,S)=>(T,M,R,E)=>{v[S]&&(A===S-1&&v[S]===_||(e.setStrokeStyle(t,Object.assign(Object.assign({},t.attribute),{stroke:v[S]}),i,r,h),e.beginPath(),e.moveTo(T,M),_=v[S]),A=S,e.lineTo(R,E),e.stroke(),S===3&&e.beginPath())}))),void e.stroke()}if(e.beginPath(),e.moveTo(i,r),v[0]?e.lineTo(i+C,r):e.moveTo(i+C,r),v[1]?e.lineTo(i+C,r+w):e.moveTo(i+C,r+w),v[2]?e.lineTo(i,r+w):e.moveTo(i,r+w),v[3]){const _=v[0]?r-e.lineWidth/2:r;e.lineTo(i,_)}else e.moveTo(i,r);e.stroke()}}};wu=HI([pt()],wu);const BY=new DI,kY=Iu,PY=Ma;class EY extends DI{constructor(){super(...arguments),this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,s,a,l,h,u,d,c){return super.drawShape(t,e,i,r,o,s,a,l,h,u,d,c)}}const LY=new EY,OY=Ma;class IY{constructor(){this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,s,a,l,h,u,d,c){const g=t.getParsedPath();if(!g)return;const{outerBorder:f,innerBorder:p}=t.attribute,m=f&&f.visible!==!1,v=p&&p.visible!==!1;if(!m&&!v)return;const{size:b=h.size,opacity:y=h.opacity,x:C=h.x,y:w=h.y,scaleX:_=h.scaleX,scaleY:A=h.scaleY,keepStrokeScale:x=h.keepStrokeScale}=t.attribute,S=(T,M)=>{const R=!(!T||!T.stroke),{distance:E=h[M].distance}=T,P=x?E:jo(e,E,e.dpr),B=M==="outerBorder"?1:-1;if(e.beginPath(),g.drawOffset(e,b,i,r,B*P)===!1&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,T,h[M]);else if(R){const k=h[M].opacity;h[M].opacity=y,e.setStrokeStyle(t,T,(C-i)/_,(w-r)/A,h[M]),h[M].opacity=k,e.stroke()}};m&&S(f,"outerBorder"),v&&S(p,"innerBorder")}}class HY{constructor(){this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,o,s,a,l,h,u,d,c,g){const{clipRange:f=h.clipRange,x:p=h.x,y:m=h.y,z:v=h.z,size:b=h.size,scaleX:y=h.scaleX,scaleY:C=h.scaleY}=t.attribute,w=t.getParsedPath();w&&f<1&&f>0&&(e.beginPath(),w.drawWithClipRange&&w.drawWithClipRange(e,b,i,r,f,v,((_,A)=>{var x,S,T,M;if(t._parsedPath.svgCache){const R=Object.assign({},A);R.fill=(x=A.fill)!==null&&x!==void 0?x:t.attribute.fill,R.opacity=(S=A.opacity)!==null&&S!==void 0?S:t.attribute.opacity,R.fillOpacity=t.attribute.fillOpacity,R.stroke=(T=A.stroke)!==null&&T!==void 0?T:t.attribute.stroke,R.lineWidth=(M=A.lineWidth)!==null&&M!==void 0?M:t.attribute.lineWidth,A=R}A.stroke&&(c?c(e,t.attribute,h):l&&(e.setStrokeStyle(t,A,(p-i)/y,(m-r)/C,h),e.stroke()))})),s&&!w.isSvg&&(c?c(e,t.attribute,h):l&&(e.setStrokeStyle(t,t.attribute,(p-i)/y,(m-r)/C,h),e.stroke())))}}const DY=new IY,FY=new HY,zY=Iu,NY=Ma;class WY extends _x{constructor(){super(...arguments),this.time=ne.afterFillStroke}drawShape(t,e,i,r,o,s,a,l,h,u,d,c,g){var f,p,m,v;this.textureMap||this.initTextureMap(e,t.stage);const{attribute:b=t.attribute}=g||{},{texture:y=(f=t.attribute.texture)!==null&&f!==void 0?f:Kg(h,"texture"),textureColor:C=(p=t.attribute.textureColor)!==null&&p!==void 0?p:Kg(h,"textureColor"),textureSize:w=(m=t.attribute.textureSize)!==null&&m!==void 0?m:Kg(h,"textureSize"),texturePadding:_=(v=t.attribute.texturePadding)!==null&&v!==void 0?v:Kg(h,"texturePadding")}=b;y&&this.drawTexture(y,t,e,i,r,h,C,w,_)}}const ui={x:0,y:0,z:0,lastModelMatrix:null};class Gn{init(t){t&&(this._renderContribitions=t.getContributions()),this._renderContribitions||(this._renderContribitions=[]),this.builtinContributions||(this.builtinContributions=[]),this.builtinContributions.push(pY),this.builtinContributions.push(vY),this.builtinContributions.forEach((e=>this._renderContribitions.push(e))),this._renderContribitions.length&&(this._renderContribitions.sort(((e,i)=>i.order-e.order)),this._beforeRenderContribitions=this._renderContribitions.filter((e=>e.time===ne.beforeFillStroke)),this._afterRenderContribitions=this._renderContribitions.filter((e=>e.time===ne.afterFillStroke)))}reInit(){this.init(this.graphicRenderContributions)}beforeRenderStep(t,e,i,r,o,s,a,l,h,u,d,c,g){this._beforeRenderContribitions&&this._beforeRenderContribitions.forEach((f=>{f.supportedAppName&&t.stage&&t.stage.params&&t.stage.params.context&&t.stage.params.context.appName&&!(Array.isArray(f.supportedAppName)?f.supportedAppName:[f.supportedAppName]).includes(t.stage.params.context.appName)||f.drawShape(t,e,i,r,o,s,a,l,h,u,d,c,g)}))}afterRenderStep(t,e,i,r,o,s,a,l,h,u,d,c,g){this._afterRenderContribitions&&this._afterRenderContribitions.forEach((f=>{f.supportedAppName&&t.stage&&t.stage.params&&t.stage.params.context&&t.stage.params.context.appName&&!(Array.isArray(f.supportedAppName)?f.supportedAppName:[f.supportedAppName]).includes(t.stage.params.context.appName)||f.drawShape(t,e,i,r,o,s,a,l,h,u,d,c,g)}))}drawPathProxy(t,e,i,r,o,s,a,l){if(!t.pathProxy)return!1;const h=Wt(t,s?.theme)[t.type.replace("3d","")],{fill:u=h.fill,stroke:d=h.stroke,opacity:c=h.opacity,fillOpacity:g=h.fillOpacity,lineWidth:f=h.lineWidth,strokeOpacity:p=h.strokeOpacity,visible:m=h.visible,x:v=h.x,y:b=h.y}=t.attribute,y=Hl(c,g,u),C=F_(c,p),w=vu(u),_=Tc(d,f);if(!m||!w&&!_||!(y||C||a||l))return!0;e.beginPath();const A=typeof t.pathProxy=="function"?t.pathProxy(t.attribute):t.pathProxy;return Bs(A.commandList,e,i,r),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),this.beforeRenderStep(t,e,i,r,w,_,y,C,h,o,a,l),_&&(l?l(e,t.attribute,h):C&&(e.setStrokeStyle(t,t.attribute,i-v,r-b,h),e.stroke())),w&&(a?a(e,t.attribute,h):y&&(e.setCommonStyle(t,t.attribute,i-v,r-b,h),e.fill())),this.afterRenderStep(t,e,i,r,w,_,y,C,h,o,a,l),!0}valid(t,e,i,r){const{fill:o=e.fill,background:s,stroke:a=e.stroke,opacity:l=e.opacity,fillOpacity:h=e.fillOpacity,lineWidth:u=e.lineWidth,strokeOpacity:d=e.strokeOpacity,visible:c=e.visible}=t.attribute,g=Hl(l,h,o),f=F_(l,d),p=vu(o,s),m=Tc(a,u);return!(!t.valid||!c)&&!(!p&&!m)&&!!(g||f||i||r||s)&&{fVisible:g,sVisible:f,doFill:p,doStroke:m}}transform(t,e,i,r=!1){const{x:o=e.x,y:s=e.y,z:a=e.z,scaleX:l=e.scaleX,scaleY:h=e.scaleY,angle:u=e.angle,postMatrix:d}=t.attribute,c=i.modelMatrix,g=i.camera;ui.x=o,ui.y=s,ui.z=a,ui.lastModelMatrix=c;const f=g&&(r||QX(t)),p=f?t.transMatrix.onlyTranslate()&&!d:l===1&&h===1&&u===0&&!d;if(f){const m=Bi.allocate(),v=Bi.allocate();EI(v,t,e),hg(m,c||m,v),ui.x=0,ui.y=0,ui.z=0,i.modelMatrix=m,i.setTransform(1,0,0,1,0,0,!0),Bi.free(v)}if(p&&!c){const m=t.getOffsetXY(e);ui.x+=m.x,ui.y+=m.y,ui.z=a,i.setTransformForCurrent()}else if(f)ui.x=0,ui.y=0,ui.z=0,i.setTransform(1,0,0,1,0,0,!0);else if(g&&i.project){const m=t.getOffsetXY(e);ui.x+=m.x,ui.y+=m.y,this.transformWithoutTranslate(i,ui.x,ui.y,ui.z,l,h,u)}else i.transformFromMatrix(t.transMatrix,!0),ui.x=0,ui.y=0,ui.z=0;return ui}transformUseContext2d(t,e,i,r){const o=r.camera;if(this.camera=o,o){const s=t.AABBBounds,a=s.x2-s.x1,l=s.y2-s.y1,h=r.project(0,0,i),u=r.project(a,0,i),d=r.project(a,l,i),c={x:0,y:0},g={x:a,y:0},f={x:a,y:l};r.camera=null;const p=1/(c.x*(f.y-g.y)-g.x*f.y+f.x*g.y+(g.x-f.x)*c.y),m=-(c.y*(d.x-u.x)-g.y*d.x+f.y*u.x+(g.y-f.y)*h.x)*p,v=(g.y*d.y+c.y*(u.y-d.y)-f.y*u.y+(f.y-g.y)*h.y)*p,b=(c.x*(d.x-u.x)-g.x*d.x+f.x*u.x+(g.x-f.x)*h.x)*p,y=-(g.x*d.y+c.x*(u.y-d.y)-f.x*u.y+(f.x-g.x)*h.y)*p,C=(c.x*(f.y*u.x-g.y*d.x)+c.y*(g.x*d.x-f.x*u.x)+(f.x*g.y-g.x*f.y)*h.x)*p,w=(c.x*(f.y*u.y-g.y*d.y)+c.y*(g.x*d.y-f.x*u.y)+(f.x*g.y-g.x*f.y)*h.y)*p;r.setTransform(m,v,b,y,C,w,!0)}}restoreTransformUseContext2d(t,e,i,r){this.camera&&(r.camera=this.camera)}transformWithoutTranslate(t,e,i,r,o,s,a){const l=t.project(e,i,r);t.translate(l.x,l.y,!1),t.scale(o,s,!1),t.rotate(a,!1),t.translate(-l.x,-l.y,!1),t.setTransformForCurrent()}_draw(t,e,i,r,o,s){const{context:a}=r;if(!a)return;const{renderable:l}=t.attribute;if(l===!1)return;a.highPerformanceSave();const h=this.transform(t,e,a,i),{x:u,y:d,z:c,lastModelMatrix:g}=h;this.z=c,this.drawPathProxy(t,a,u,d,r,o)||(this.drawShape(t,a,u,d,r,o,null,null,s),this.z=0,a.modelMatrix!==g&&Bi.free(a.modelMatrix),a.modelMatrix=g),a.highPerformanceRestore()}}var jY=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},VY=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},oT=function(n,t){return function(e,i){t(e,i,n)}};let Fp=class extends Gn{constructor(n){super(),this.graphicRenderContributions=n,this.numberType=hv,this.builtinContributions=[_Y,xY,wY],this.init(n)}drawArcTailCapPath(n,t,e,i,r,o,s,a){const l=a-s,h=n.getParsedAngle(),u=h.startAngle;let d=h.endAngle;d=a;const c=d>u;let g=!1;if(r<o){const k=r;r=o,o=k}const{xors:f,yors:p,xirs:m,yirs:v,limitedOcr:b,outerCornerRadiusStart:y,outerCornerRadiusEnd:C,maxOuterCornerRadius:w,xore:_,yore:A,xire:x,yire:S,limitedIcr:T,innerDeltaAngle:M,innerStartAngle:R,innerCornerRadiusStart:E,innerCornerRadiusEnd:P,maxInnerCornerRadius:B}=PI(n,u,d,o,r);if(b>Pe){const k=gn(y,b),L=gn(C,b),O=ia(m,v,f,p,r,k,Number(c)),I=ia(_,A,x,S,r,L,Number(c));if(b<w&&k===L)t.moveTo(e+O.cx+O.x01,i+O.cy+O.y01),t.arc(e+O.cx,i+O.cy,b,de(O.y01,O.x01),de(I.y01,I.x01),!c);else{const H=d-l-.03,D=de(I.y11,I.x11);t.arc(e,i,r,H,D,!c),L>0&&t.arc(e+I.cx,i+I.cy,L,de(I.y11,I.x11),de(I.y01,I.x01),!c)}}else t.moveTo(e+f,i+p);if(!(o>Pe)||M<.001)t.lineTo(e+x,i+S),g=!0;else if(T>Pe){const k=gn(E,T),L=gn(P,T),O=ia(x,S,_,A,o,-L,Number(c)),I=ia(f,p,m,v,o,-k,Number(c));if(t.lineTo(e+O.cx+O.x01,i+O.cy+O.y01),T<B&&k===L){const H=de(I.y01,I.x01);t.arc(e+O.cx,i+O.cy,T,de(O.y01,O.x01),H,!c)}else{L>0&&t.arc(e+O.cx,i+O.cy,L,de(O.y01,O.x01),de(O.y11,O.x11),!c);const H=de(O.cy+O.y11,O.cx+O.x11),D=d-l-.03;t.arc(e,i,o,H,D,c)}}else t.lineTo(e+o*Mi(R),i+o*Ue(R));return g}drawShape(n,t,e,i,r,o,s,a,l){l=l??Wt(n,o?.theme).arc;const{fill:h=l.fill,stroke:u=l.stroke,x:d=l.x,y:c=l.y,fillStrokeOrder:g=l.fillStrokeOrder}=n.attribute,f=this.valid(n,l,s,a);if(!f)return;const{fVisible:p,sVisible:m,doFill:v,doStroke:b}=f,{outerPadding:y=l.outerPadding,innerPadding:C=l.innerPadding,cap:w=l.cap,forceShowCap:_=l.forceShowCap}=n.attribute;let{outerRadius:A=l.outerRadius,innerRadius:x=l.innerRadius}=n.attribute;A+=y,x-=C;let S=0;const T=(yc(w)&&w||w[0])&&h.gradient==="conical";if(T){const{sc:P,startAngle:B,endAngle:k}=n.getParsedAngle();ge(k-B)<zt-Pe&&(S=P||0,h.startAngle-=S,h.endAngle-=S)}let M=!1;const{isFullStroke:R,stroke:E}=lU(u);if((v||R)&&(t.beginPath(),z_(n,t,e,i,A,x),M=!0,t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),this.beforeRenderStep(n,t,e,i,v,b,p,m,l,r,s,a),g?(this._runStroke(n,t,e,i,l,b,R,m,a),this._runFill(n,t,e,i,l,v,p,d,c,s)):(this._runFill(n,t,e,i,l,v,p,d,c,s),this._runStroke(n,t,e,i,l,b,R,m,a))),!R&&b&&(t.beginPath(),z_(n,t,e,i,A,x,E),M||this.beforeRenderStep(n,t,e,i,v,b,p,m,l,r,s,a),a?a(t,n.attribute,l):m&&(t.setStrokeStyle(n,n.attribute,e,i,l),t.stroke())),(yc(w)&&w||w[1])&&_){const{startAngle:P,endAngle:B}=n.getParsedAngle();if(ge(B-P)>=zt-Pe){t.beginPath();const k=Math.abs(A-x)/2/A,{endAngle:L=l.endAngle,fill:O=l.fill}=n.attribute,I=L;this.drawArcTailCapPath(n,t,e,i,A,x,I,I+k),M||this.beforeRenderStep(n,t,e,i,v,b,p,m,l,r,s,a);const H=()=>{if(v){const z=O;if(z.gradient==="conical"){const G=FX(0,0,L,z);s||Hl&&(t.setCommonStyle(n,n.attribute,e,i,l),t.fillStyle=G,t.fill())}}},D=()=>{b&&(a||m&&(t.setStrokeStyle(n,n.attribute,e,i,l),t.stroke()))};H(),D()}}this.afterRenderStep(n,t,e,i,v,b,p,m,l,r,s,a),T&&(h.startAngle+=S,h.endAngle+=S)}_runFill(n,t,e,i,r,o,s,a,l,h){o&&(h?h(t,n.attribute,r):s&&(t.setCommonStyle(n,n.attribute,a-e,l-i,r),t.fill()))}_runStroke(n,t,e,i,r,o,s,a,l){o&&s&&(l?l(t,n.attribute,r):a&&(t.setStrokeStyle(n,n.attribute,e,i,r),t.stroke()))}draw(n,t,e,i){const r=Wt(n,i?.theme).arc;this._draw(n,r,!1,e,i,r)}};Fp=jY([pt(),oT(0,Xt(li)),oT(0,Li(N_)),VY("design:paramtypes",[Object])],Fp);var GY=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},$Y=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},sT=function(n,t){return function(e,i){t(e,i,n)}};let zp=class extends Gn{constructor(n){super(),this.graphicRenderContributions=n,this.numberType=uv,this.builtinContributions=[AY,TY,MY],this.init(n)}drawShape(n,t,e,i,r,o,s,a){const l=Wt(n,o?.theme).circle,{radius:h=l.radius,startAngle:u=l.startAngle,endAngle:d=l.endAngle,x:c=l.x,y:g=l.y,fillStrokeOrder:f=l.fillStrokeOrder}=n.attribute,p=this.valid(n,l,s,a);if(!p)return;const{fVisible:m,sVisible:v,doFill:b,doStroke:y}=p;t.beginPath(),t.arc(e,i,h,u,d),t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),this.beforeRenderStep(n,t,e,i,b,y,m,v,l,r,s,a);const C=()=>{b&&(s?s(t,n.attribute,l):m&&(t.setCommonStyle(n,n.attribute,c-e,g-i,l),t.fill()))},w=()=>{y&&(a?a(t,n.attribute,l):v&&(t.setStrokeStyle(n,n.attribute,c-e,g-i,l),t.stroke()))};f?(w(),C()):(C(),w()),this.afterRenderStep(n,t,e,i,b,y,m,v,l,r,s,a)}draw(n,t,e,i){const r=Wt(n,i?.theme).circle;this._draw(n,r,!1,e,i)}};zp=GY([pt(),sT(0,Xt(li)),sT(0,Li(W_)),$Y("design:paramtypes",[Object])],zp);function Np(n,t,e,i){if(!t.p1)return;const{offsetX:r=0,offsetY:o=0,offsetZ:s=0}=i||{};if(e===1)t.p2&&t.p3?n.bezierCurveTo(r+t.p1.x,o+t.p1.y,r+t.p2.x,o+t.p2.y,r+t.p3.x,o+t.p3.y,s):n.lineTo(r+t.p1.x,o+t.p1.y,s);else if(t.p2&&t.p3){const[a]=pu(t,e);n.bezierCurveTo(r+a.p1.x,o+a.p1.y,r+a.p2.x,o+a.p2.y,r+a.p3.x,o+a.p3.y,s)}else{const a=t.getPointAt(e);n.lineTo(r+a.x,o+a.y,s)}}function aT(n,t,e,i,r,o,s){var a;let l=t.p0,h=i;if(e&&e.originP1===e.originP2&&(l=e.p0),t.defined)i||(n.lineTo(l.x+r,l.y+o,s),h=!i);else{const{originP1:u,originP2:d}=t;let c;if(u&&u.defined!==!1&&!e?c=l:u&&d.defined!==!1&&(c=(a=t.p3)!==null&&a!==void 0?a:t.p1),i){h=!i;const g=c?c.x:t.p0.x,f=c?c.y:t.p0.y;n.moveTo(g+r,f+o,s)}else c&&(h=!i,n.lineTo(c.x+r,c.y+o,s))}return h}function FI(n,t,e,i,r){const{offsetX:o=0,offsetY:s=0,offsetZ:a=0,mode:l="none",drawConnect:h=!1}=r||{};if(h&&l==="none"||!t)return;let u=!0;const{curves:d}=t;if(e>=1){if(h){let v,b=!0;d.forEach(((y,C)=>{y.originP1!==y.originP2&&(b=aT(n,y,v,b,o,s,a)),v=y}))}else d.forEach((v=>{v.defined?(u&&n.moveTo(v.p0.x+o,v.p0.y+s,a),Np(n,v,1,r),u=!1):u=!0}));return}if(e<=0)return;let c;i==="x"?c=ve.ROW:i==="y"?c=ve.COLUMN:i==="auto"&&(c=t.direction);const g=e*t.tryUpdateLength(c);let f=0,p=!0,m=null;for(let v=0,b=d.length;v<b;v++){const y=d[v],C=y.getLength(c),w=(g-f)/C;if(f+=C,w<0)break;if(h){if(y.originP1===y.originP2){m=y;continue}p=aT(n,y,m,p,o,s,a),m=y}else{if(!y.defined){u=!0;continue}u&&n.moveTo(y.p0.x+o,y.p0.y+s,a),Np(n,y,gn(w,1),r),u=!1}}}function UY(n,t,e,i){const{offsetX:r=0,offsetY:o=0}=i||{},s=t?t.points[t.points.length-1]:e.points[0];n.moveTo(s.x+r,s.y+o),e.points.forEach((a=>{a.defined!==!1?n.lineTo(a.x+r,a.y+o):n.moveTo(a.x+r,a.y+o)}))}function XY(n,t,e,i){const{offsetX:r=0,offsetY:o=0}=i||{},{points:s}=e,a=[];for(let l=0;l<s.length;l++)s[l].defined;a.push(s),a.forEach(((l,h)=>{var u,d,c,g;const f=t&&h===0?t.points[t.points.length-1]:l[0];n.moveTo(f.x+r,f.y+o),l.forEach((p=>{p.defined!==!1?n.lineTo(p.x+r,p.y+o):n.moveTo(p.x+r,p.y+o)}));for(let p=l.length-1;p>=0;p--){const m=l[p];n.lineTo((u=m.x1)!==null&&u!==void 0?u:m.x,(d=m.y1)!==null&&d!==void 0?d:m.y)}n.lineTo((c=f.x1)!==null&&c!==void 0?c:f.x,(g=f.y1)!==null&&g!==void 0?g:f.y),n.closePath()}))}var YY=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let Pc=class extends Gn{constructor(){super(...arguments),this.numberType=lg}draw(n,t,e,i){const r=Wt(n,i?.theme).line;this._draw(n,r,!1,e,i)}drawSegmentItem(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f){var p;if(!t)return;n.beginPath();const m=(p=this.z)!==null&&p!==void 0?p:0;FI(n,t,l,h,{offsetX:u,offsetY:d,offsetZ:m}),c.cache&&!ue(c.cache)&&c.cache.curves.every((y=>y.defined))&&c.attribute.curveType&&c.attribute.curveType.includes("Closed")&&n.closePath(),n.setShadowBlendStyle&&n.setShadowBlendStyle(c,s,a);const{x:v=0,x:b=0}=s;return e!==!1&&(g?g(n,s,a):r&&(n.setCommonStyle(c,s,v-u,b-d,a),n.fill())),i!==!1&&(f?f(n,s,a):o&&(n.setStrokeStyle(c,s,v-u,b-d,a),n.stroke())),!1}drawLinearLineHighPerformance(n,t,e,i,r,o,s,a,l,h,u,d,c){var g;t.beginPath();const f=(g=this.z)!==null&&g!==void 0?g:0,{points:p}=n.attribute,m=p[0];t.moveTo(m.x+s,m.y+a,f);for(let y=1;y<p.length;y++){const C=p[y];t.lineTo(C.x+s,C.y+a,f)}t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l);const{x:v=0,x:b=0}=n.attribute;e!==!1&&(d?d(t,n.attribute,l):r&&(t.setCommonStyle(n,n.attribute,v-s,b-a,l),t.fill())),i!==!1&&(c?c(t,n.attribute,l):o&&(t.setStrokeStyle(n,n.attribute,v-s,b-a,l),t.stroke()))}drawShape(n,t,e,i,r,o,s,a){const l=Wt(n,o?.theme).line,{fill:h=l.fill,stroke:u=l.stroke,fillOpacity:d=l.fillOpacity,strokeOpacity:c=l.strokeOpacity,segments:g,points:f,closePath:p,curveTension:m=l.curveTension,connectedType:v=l.connectedType}=n.attribute;if(!this.valid(n,l,s,a))return;let{curveType:b=l.curveType}=n.attribute;p&&b==="linear"&&(b="linearClosed");const{clipRange:y=l.clipRange,clipRangeByDimension:C=l.clipRangeByDimension}=n.attribute;if(y===1&&!g&&!f.some((_=>_.defined===!1))&&b==="linear")return this.drawLinearLineHighPerformance(n,t,!!h,!!u,d,c,e,i,l,r,o,s,a);function w(_,A){return A==="none"?_:_.filter((x=>x.defined!==!1))}if(n.shouldUpdateShape()){const{points:_,segments:A}=n.attribute,x=_;if(A&&A.length){let S,T;if(n.cache=A.map(((M,R)=>{if(M.points.length<=1&&R===0)return M.points[0]&&(T={endX:M.points[0].x,endY:M.points[0].y,curves:[{defined:M.points[0].defined!==!1}]}),null;R===1?S={x:T.endX,y:T.endY,defined:T.curves[T.curves.length-1].defined}:R>1&&(S.x=T.endX,S.y=T.endY,S.defined=T.curves[T.curves.length-1].defined);const E=al(w(M.points,v),b,{startPoint:S,curveTension:m});return T=E,E})).filter((M=>!!M)),b==="linearClosed"){let M;for(let R=0;R<n.cache.length;R++){const E=n.cache[R];for(let P=0;P<E.curves.length;P++)if(E.curves[P].defined){M=E.curves[P].p0;break}if(M)break}n.cache[n.cache.length-1]&&n.cache[n.cache.length-1].lineTo(M.x,M.y,!0)}}else{if(!_||!_.length)return n.cache=null,void n.clearUpdateShapeTag();n.cache=al(w(x,v),b,{curveTension:m})}n.clearUpdateShapeTag()}if(Array.isArray(n.cache)){const _=n.attribute.segments.filter((A=>A.points.length));if(_[0].points.length===1&&_.shift(),y===1){let A=!1;n.cache.forEach(((x,S)=>{A||(A=this.drawSegmentItem(t,x,!!h,!!u,d,c,_[S],[l,n.attribute],y,C,e,i,n,s,a))}))}else{const A=n.cache.reduce(((M,R)=>M+R.getLength()),0),x=y*A;let S=0,T=!1;n.cache.forEach(((M,R)=>{if(T)return;const E=M.getLength(),P=(x-S)/E;S+=E,P>0&&(T=this.drawSegmentItem(t,M,!!h,!!u,d,c,_[R],[l,n.attribute],gn(P,1),C,e,i,n,s,a))}))}}else this.drawSegmentItem(t,n.cache,!!h,!!u,d,c,n.attribute,l,y,C,e,i,n,s,a)}};Pc=YY([pt()],Pc);function qY(n,t,e,i){var r;const{top:o,bottom:s}=t;if(o.curves.length!==s.curves.length)return;if(e>=1){const v=[],b=[];let y=!0;for(let C=0,w=o.curves.length;C<w;C++){const _=o.curves[C];y!==_.defined?(y?(nf(n,v,b,i),v.length=0,b.length=0):(v.push(_),b.push(s.curves[w-C-1])),y=!y):y&&(v.push(_),b.push(s.curves[w-C-1]))}return void nf(n,v,b,i)}if(e<=0)return;let{direction:a}=i||{};const{curves:l}=o,h=(r=l[l.length-1].p3)!==null&&r!==void 0?r:l[l.length-1].p1,u=ge(h.x-l[0].p0.x),d=ge(h.y-l[0].p0.y);a=a??(u>d?ve.ROW:ve.COLUMN),Number.isFinite(u)||(a=ve.COLUMN),Number.isFinite(d)||(a=ve.ROW);const c=e*(a===ve.ROW?u:d);let g=0,f=!0;const p=[],m=[];for(let v=0,b=o.curves.length;v<b;v++){const y=o.curves[v],C=y.getLength(a),w=(c-g)/C;if(w<0)break;g+=C;let _=null,A=null;f!==y.defined?(f?(nf(n,p,m,i),p.length=0,m.length=0):(_=y,A=s.curves[b-v-1]),f=!f):f&&(_=y,A=s.curves[b-v-1]),_&&A&&(w<1&&(_=_.p2&&_.p3?pu(_,w)[0]:rM(_,w)[0],A=A.p2&&A.p3?pu(A,1-w)[1]:rM(A,1-w)[1]),_.defined=f,A.defined=f,p.push(_),m.push(A)),_=null,A=null}nf(n,p,m,i)}function nf(n,t,e,i){const{offsetX:r=0,offsetY:o=0,offsetZ:s=0}=i||{};let a=!0;t.forEach((l=>{l.defined?(a&&n.moveTo(l.p0.x+r,l.p0.y+o,s),Np(n,l,1,i),a=!1):a=!0})),a=!0;for(let l=e.length-1;l>=0;l--){const h=e[l];h.defined?(a&&n.lineTo(h.p0.x+r,h.p0.y+o,s),Np(n,h,1,i),a=!1):a=!0}n.closePath()}const KY=new WY,ZY=Ma;var JY=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},QY=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},lT=function(n,t){return function(e,i){t(e,i,n)}};let J_=class extends Gn{constructor(n){super(),this.graphicRenderContributions=n,this.numberType=wI,this.builtinContributions=[KY,ZY],this.init(n)}drawLinearAreaHighPerformance(n,t,e,i,r,o,s,a,l,h,u,d,c){var g,f,p;const{points:m}=n.attribute;if(m.length<2)return;t.beginPath();const v=(g=this.z)!==null&&g!==void 0?g:0,b=m[0];t.moveTo(b.x+s,b.y+a,v);for(let w=1;w<m.length;w++){const _=m[w];t.lineTo(_.x+s,_.y+a,v)}for(let w=m.length-1;w>=0;w--){const _=m[w];t.lineTo(((f=_.x1)!==null&&f!==void 0?f:_.x)+s,((p=_.y1)!==null&&p!==void 0?p:_.y)+a,v)}t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),this.beforeRenderStep(n,t,s,a,!!r,!1,e,!1,l,h,d,null,{attribute:n.attribute});const{x:y=0,x:C=0}=n.attribute;e!==!1&&(d?d(t,n.attribute,l):r&&(t.setCommonStyle(n,n.attribute,y-s,C-a,l),t.fill())),this.afterRenderStep(n,t,s,a,!!r,!1,e,!1,l,h,d,null,{attribute:n.attribute}),(()=>{var w,_;if(i){const{stroke:A=l&&l.stroke}=n.attribute;if(ue(A)&&(A[0]||A[2])&&A[1]===!1){if(t.beginPath(),A[0]){t.moveTo(b.x+s,b.y+a,v);for(let x=1;x<m.length;x++){const S=m[x];t.lineTo(S.x+s,S.y+a,v)}}else if(A[2]){const x=m[m.length-1];t.moveTo(x.x+s,x.y+a,v);for(let S=m.length-2;S>=0;S--){const T=m[S];t.lineTo(((w=T.x1)!==null&&w!==void 0?w:T.x)+s,((_=T.y1)!==null&&_!==void 0?_:T.y)+a,v)}}}c?c(t,n.attribute,l):(t.setStrokeStyle(n,n.attribute,y-s,C-a,l),t.stroke())}})()}drawShape(n,t,e,i,r,o,s,a){var l,h,u,d,c,g;const f=Wt(n,o?.theme).area,{fill:p=f.fill,stroke:m=f.stroke,fillOpacity:v=f.fillOpacity,z:b=f.z,strokeOpacity:y=f.strokeOpacity,curveTension:C=f.curveTension,connectedType:w=f.connectedType}=n.attribute,_=this.valid(n,f,s,a);if(!_)return;const{doFill:A}=_,x=_.doStroke&&_.sVisible,{clipRange:S=f.clipRange,closePath:T,points:M,segments:R}=n.attribute;let{curveType:E=f.curveType}=n.attribute;function P(B,k){return k!=="connect"?B:B.filter((L=>L.defined!==!1))}if(T&&E==="linear"&&(E="linearClosed"),S===1&&!R&&!M.some((B=>B.defined===!1))&&E==="linear")return this.drawLinearAreaHighPerformance(n,t,!!p,x,v,y,e,i,f,r,o,s,a);if(n.shouldUpdateShape()){if(R&&R.length){let B,k;const L=R.map(((H,D)=>{if(H.points.length<=1&&D===0)return H.points[0]&&(k={endX:H.points[0].x,endY:H.points[0].y}),null;D===1?B={x:k.endX,y:k.endY}:D>1&&(B.x=k.endX,B.y=k.endY);const z=al(P(H.points,w),E,{startPoint:B,curveTension:C});return k=z,z})).filter((H=>!!H));let O;const I=[];for(let H=R.length-1;H>=0;H--){const D=R[H].points,z=[];for(let G=D.length-1;G>=0;G--)z.push({x:(l=D[G].x1)!==null&&l!==void 0?l:D[G].x,y:(h=D[G].y1)!==null&&h!==void 0?h:D[G].y});if(H!==0){const G=R[H-1].points,U=G[G.length-1];U&&z.push({x:(u=U.x1)!==null&&u!==void 0?u:U.x,y:(d=U.y1)!==null&&d!==void 0?d:U.y})}z.length>1&&(O=al(P(z,w),E==="stepBefore"?"stepAfter":E==="stepAfter"?"stepBefore":E,{curveTension:C}),I.unshift(O))}n.cacheArea=I.map(((H,D)=>({top:L[D],bottom:H})))}else{if(!M||!M.length)return n.cacheArea=null,void n.clearUpdateShapeTag();{const B=P(M,w),k=[];for(let I=B.length-1;I>=0;I--)k.push({x:(c=B[I].x1)!==null&&c!==void 0?c:B[I].x,y:(g=B[I].y1)!==null&&g!==void 0?g:B[I].y});const L=al(B,E,{curveTension:C}),O=al(k,E==="stepBefore"?"stepAfter":E==="stepAfter"?"stepBefore":E,{curveTension:C});n.cacheArea={top:L,bottom:O}}}n.clearUpdateShapeTag()}if(Array.isArray(n.cacheArea)){const B=n.attribute.segments.filter((k=>k.points.length));if(B[0].points.length===1&&B.shift(),S===1){let k=!1;n.cacheArea.forEach(((L,O)=>{k||(k=this.drawSegmentItem(t,L,A,v,x,y,B[O],[f,n.attribute],S,e,i,b,n,r,s,a))}))}else{const k=n.cacheArea.reduce(((H,D)=>H+D.top.getLength()),0),L=S*k;let O=0,I=!1;n.cacheArea.forEach(((H,D)=>{if(I)return;const z=H.top.getLength(),G=(L-O)/z;O+=z,G>0&&(I=this.drawSegmentItem(t,H,A,v,x,y,B[D],[f,n.attribute],gn(G,1),e,i,b,n,r,s,a))}))}}else this.drawSegmentItem(t,n.cacheArea,A,v,x,y,n.attribute,f,S,e,i,b,n,r,s,a)}draw(n,t,e,i){const r=Wt(n,i?.theme).area;this._draw(n,r,!1,e,i)}drawSegmentItem(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p){return this._drawSegmentItem(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p)}_drawSegmentItem(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p){if(!(t&&t.top&&t.bottom&&t.top.curves&&t.top.curves.length&&t.bottom.curves&&t.bottom.curves.length))return;n.beginPath();const{points:m,segments:v}=c.attribute;let b,y,C=ve.ROW;if(v){const S=v[v.length-1];y=v[0].points[0],b=S.points[S.points.length-1]}else y=m[0],b=m[m.length-1];const w=ge(b.x-y.x),_=ge(b.y-y.y);C=b.x1==null?ve.ROW:b.y1==null?ve.COLUMN:Number.isFinite(w+_)?w>_?ve.ROW:ve.COLUMN:ve.ROW,qY(n,t,l,{offsetX:h,offsetY:u,offsetZ:d,direction:C}),this.beforeRenderStep(c,n,h,u,!!i,!1,e,!1,a,g,f,null,{attribute:s}),n.setShadowBlendStyle&&n.setShadowBlendStyle(c,s,a);const{x:A=0,x=0}=s;return e!==!1&&(f?f(n,s,a):i&&(n.setCommonStyle(c,s,A-h,x-u,a),n.fill())),this.afterRenderStep(c,n,h,u,!!i,!1,e,!1,a,g,f,null,{attribute:s}),(()=>{if(r!==!1)if(p)p(n,s,a);else{const{stroke:S=a&&a[1]&&a[1].stroke}=s;ue(S)&&(S[0]||S[2])&&S[1]===!1&&(n.beginPath(),FI(n,S[0]?t.top:t.bottom,l,C===ve.ROW?"x":"y",{offsetX:h,offsetY:u,offsetZ:d})),n.setStrokeStyle(c,s,A-h,x-u,a),n.stroke()}})(),!1}};J_=JY([pt(),lT(0,Xt(li)),lT(0,Li(qX)),QY("design:paramtypes",[Object])],J_);const tq=Iu,eq=Ma;var iq=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},nq=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},hT=function(n,t){return function(e,i){t(e,i,n)}};let Wp=class extends Gn{constructor(n){super(),this.graphicRenderContributions=n,this.numberType=cv,this.builtinContributions=[eq,tq],this.init(n)}drawShape(n,t,e,i,r,o,s,a){var l,h,u;const d=(l=this.tempTheme)!==null&&l!==void 0?l:Wt(n,o?.theme).path,{x:c=d.x,y:g=d.y,fillStrokeOrder:f=d.fillStrokeOrder}=n.attribute,p=(h=this.z)!==null&&h!==void 0?h:0,m=this.valid(n,d,s,a);if(!m)return;const{fVisible:v,sVisible:b,doFill:y,doStroke:C}=m;if(t.beginPath(),n.pathShape)Bs(n.pathShape.commandList,t,e,i,1,1,p);else{const A=(u=n.attribute.path)!==null&&u!==void 0?u:d.path;Bs(A.commandList,t,e,i,1,1,p)}t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,d),this.beforeRenderStep(n,t,e,i,y,C,v,b,d,r,s,a);const w=()=>{C&&(a?a(t,n.attribute,d):b&&(t.setStrokeStyle(n,n.attribute,c-e,g-i,d),t.stroke()))},_=()=>{y&&(s?s(t,n.attribute,d):v&&(t.setCommonStyle(n,n.attribute,c-e,g-i,d),t.fill()))};f?(w(),_()):(_(),w()),this.afterRenderStep(n,t,e,i,y,C,v,b,d,r,s,a)}draw(n,t,e,i){const r=Wt(n,i?.theme).path;this.tempTheme=r,this._draw(n,r,!1,e,i),this.tempTheme=null}};Wp=iq([pt(),hT(0,Xt(li)),hT(0,Li(j_)),nq("design:paramtypes",[Object])],Wp);var rq=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},oq=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},uT=function(n,t){return function(e,i){t(e,i,n)}};let jp=class extends Gn{constructor(n){super(),this.graphicRenderContributions=n,this.type="rect",this.numberType=dx,this.builtinContributions=[BY,PY,kY],this.init(n)}drawShape(n,t,e,i,r,o,s,a,l){l=l??Wt(n,o?.theme).rect;const{fill:h=l.fill,background:u,stroke:d=l.stroke,cornerRadius:c=l.cornerRadius,cornerType:g=l.cornerType,opacity:f=l.opacity,fillOpacity:p=l.fillOpacity,lineWidth:m=l.lineWidth,strokeOpacity:v=l.strokeOpacity,visible:b=l.visible,x1:y,y1:C,x:w=l.x,y:_=l.y,fillStrokeOrder:A=l.fillStrokeOrder,drawStrokeWhenZeroWH:x=l.drawStrokeWhenZeroWH}=n.attribute;let{width:S,height:T}=n.attribute;S=(S??y-w)||0,T=(T??C-_)||0;const M=BI(f,p,S,T,h),R=kI(f,v,S,T,x),E=vu(h,u),P=Tc(d,m);if(!n.valid||!b||!E&&!P||!(M||R||s||a||u))return;c===0||ue(c)&&c.every((k=>k===0))?(t.beginPath(),t.rect(e,i,S,T)):(t.beginPath(),Vo(t,e,i,S,T,c,g!=="bevel"));const B={doFill:E,doStroke:P};t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),this.beforeRenderStep(n,t,e,i,E,P,M,R,l,r,s,a,B),A?(this._runStroke(n,t,e,i,l,B,R,w,_,a),this._runFill(n,t,e,i,l,B,M,w,_,s)):(this._runFill(n,t,e,i,l,B,M,w,_,s),this._runStroke(n,t,e,i,l,B,R,w,_,a)),this.afterRenderStep(n,t,e,i,E,P,M,R,l,r,s,a)}_runFill(n,t,e,i,r,o,s,a,l,h){o.doFill&&(h?h(t,n.attribute,r):s&&(t.setCommonStyle(n,n.attribute,a-e,l-i,r),t.fill()))}_runStroke(n,t,e,i,r,o,s,a,l,h){o.doStroke&&(h?h(t,n.attribute,r):s&&(t.setStrokeStyle(n,n.attribute,a-e,l-i,r),t.stroke()))}draw(n,t,e,i){const r=Wt(n,i?.theme).rect;this._draw(n,r,!1,e,i,r)}};jp=rq([pt(),uT(0,Xt(li)),uT(0,Li(ul)),oq("design:paramtypes",[Object])],jp);var sq=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},aq=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},dT=function(n,t){return function(e,i){t(e,i,n)}};let Vp=class extends Gn{constructor(n){super(),this.graphicRenderContributions=n,this.numberType=fv,this.builtinContributions=[DY,NY,zY,FY],this.init(n)}drawShape(n,t,e,i,r,o,s,a,l){var h;l=l??Wt(n,o?.theme).symbol;const{size:u=l.size,x:d=l.x,y:c=l.y,scaleX:g=l.scaleX,scaleY:f=l.scaleY,fillStrokeOrder:p=l.fillStrokeOrder,clipRange:m=l.clipRange}=n.attribute,v=this.valid(n,l,s,a);if(!v)return;const{fVisible:b,sVisible:y,doFill:C,doStroke:w}=v,_=n.getParsedPath();if(!_)return;const{keepDirIn3d:A=l.keepDirIn3d}=n.attribute,x=(h=this.z)!==null&&h!==void 0?h:0;t.beginPath();let S=e,T=i,M=x;const R=t.camera;if(A&&R&&t.project){const E=t.project(e,i,x);t.camera=null,ue(u)?(u[0]*g,u[1]*f):u*g,S=E.x,T=E.y,M=void 0}_.draw(t,u,S,T,M,((E,P)=>{var B,k,L,O;if(n._parsedPath.svgCache){const D=Object.assign({},P);D.fill=(B=P.fill)!==null&&B!==void 0?B:n.attribute.fill,D.opacity=(k=P.opacity)!==null&&k!==void 0?k:n.attribute.opacity,D.fillOpacity=n.attribute.fillOpacity,D.stroke=(L=P.stroke)!==null&&L!==void 0?L:n.attribute.stroke,D.lineWidth=(O=P.lineWidth)!==null&&O!==void 0?O:n.attribute.lineWidth,P=D}const I=()=>{P.fill&&(s?s(t,n.attribute,l):(t.setCommonStyle(n,P,d-e,c-i,l),t.fill()))},H=()=>{P.stroke&&(a?a(t,n.attribute,l):y&&m>=1&&(t.setStrokeStyle(n,P,(d-e)/g,(c-i)/f,l),t.stroke()))};p?(H(),I()):(I(),H())}))===!1&&t.closePath(),t.camera=R,t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),this.beforeRenderStep(n,t,e,i,C,w,b,y,l,r,s,a),p?(this._runStroke(n,t,e,i,l,w,y,d,c,_,m,g,f,a),this._runFill(n,t,e,i,l,C,b,d,c,_,s)):(this._runFill(n,t,e,i,l,C,b,d,c,_,s),this._runStroke(n,t,e,i,l,w,y,d,c,_,m,g,f,a)),this.afterRenderStep(n,t,e,i,C,w,b,y,l,r,s,a)}_runFill(n,t,e,i,r,o,s,a,l,h,u){o&&!h.isSvg&&(u?u(t,n.attribute,r):s&&(t.setCommonStyle(n,n.attribute,a-e,l-i,r),t.fill()))}_runStroke(n,t,e,i,r,o,s,a,l,h,u,d,c,g){o&&!h.isSvg&&(g?g(t,n.attribute,r):s&&u>=1&&(t.setStrokeStyle(n,n.attribute,(a-e)/d,(l-i)/c,r),t.stroke()))}draw(n,t,e,i){const r=Wt(n,i?.theme).symbol;this._draw(n,r,!1,e,i)}};Vp=sq([pt(),dT(0,Xt(li)),dT(0,Li(G_)),aq("design:paramtypes",[Object])],Vp);class lq{constructor(){this.pools=[];for(let t=0;t<10;t++)this.pools.push(new Zi)}allocate(t,e,i,r){if(!this.pools.length)return new Zi().setValue(t,e,i,r);const o=this.pools.pop();return o.x1=t,o.y1=e,o.x2=i,o.y2=r,o}allocateByObj(t){if(!this.pools.length)return new Zi(t);const e=this.pools.pop();return e.x1=t.x1,e.y1=t.y1,e.x2=t.x2,e.y2=t.y2,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}}const Gp=new lq;class hq extends bv{constructor(){super(...arguments),this.time=ne.beforeFillStroke}drawShape(t,e,i,r,o,s,a,l,h,u,d,c){var g,f,p,m,v,b,y,C,w,_;const{backgroundMode:A=h.backgroundMode,backgroundFit:x=h.backgroundFit,backgroundKeepAspectRatio:S=h.backgroundKeepAspectRatio}=t.attribute;let T,{background:M}=t.attribute;if(!M)return;const R=()=>{t.type==="richtext"&&(e.restore(),e.save(),T&&e.setTransformFromMatrix(T,!0,1))};let E;t.type==="richtext"&&(T=e.currentMatrix.clone(),e.restore(),e.save(),e.setTransformForCurrent());const P=Ja(M)&&M.background,B=t.transMatrix.onlyTranslate();if(P){const k=t.AABBBounds,L=((g=M.x)!==null&&g!==void 0?g:k.x1)+((f=M.dx)!==null&&f!==void 0?f:0),O=((p=M.y)!==null&&p!==void 0?p:k.y1)+((m=M.dy)!==null&&m!==void 0?m:0),I=(v=M.width)!==null&&v!==void 0?v:k.width(),H=(b=M.height)!==null&&b!==void 0?b:k.height();if(E=Gp.allocate(L,O,L+I,O+H),M=M.background,!B){const D=E.width(),z=E.height();E.set(((y=M.x)!==null&&y!==void 0?y:0)+((C=M.dx)!==null&&C!==void 0?C:0),((w=M.y)!==null&&w!==void 0?w:0)+((_=M.dy)!==null&&_!==void 0?_:0),D,z)}}else E=t.AABBBounds,B||(E=vv(Object.assign(Object.assign({},t.attribute),{angle:0,scaleX:1,scaleY:1,x:0,y:0,dx:0,dy:0})).clone());if(t.backgroundImg&&t.resources){const k=t.resources.get(M);if(k.state!=="success"||!k.data)return void R();e.highPerformanceSave(),B&&e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.setCommonStyle(t,t.attribute,i,r,h),this.doDrawImage(e,k.data,E,{backgroundMode:A,backgroundFit:x,backgroundKeepAspectRatio:S}),e.highPerformanceRestore(),e.setTransformForCurrent()}else{const{backgroundCornerRadius:k}=t.attribute;e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,r,h),e.fillStyle=M,k?(Vo(e,E.x1,E.y1,E.width(),E.height(),k,!0),e.fill()):e.fillRect(E.x1,E.y1,E.width(),E.height()),e.highPerformanceRestore()}P&&Gp.free(E),R()}}const zI=new hq;var uq=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},dq=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},cT=function(n,t){return function(e,i){t(e,i,n)}};let Q_=class extends Gn{constructor(n){super(),this.graphicRenderContributions=n,this.numberType=pv,this.builtinContributions=[zI],this.init(n)}drawShape(n,t,e,i,r,o,s,a){var l,h,u;const d=Wt(n,o?.theme).text,{text:c,underline:g=d.underline,lineThrough:f=d.lineThrough,keepDirIn3d:p=d.keepDirIn3d,direction:m=d.direction,fontSize:v=d.fontSize,verticalMode:b=d.verticalMode,x:y=d.x,y:C=d.y}=n.attribute,w=(l=ag(n.attribute.lineHeight,v))!==null&&l!==void 0?l:v,_=this.valid(n,d,s,a);if(!_)return;const{fVisible:A,sVisible:x,doFill:S,doStroke:T}=_,M=!p,R=this.z||0;t.beginPath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,d),this.beforeRenderStep(n,t,e,i,S,T,A,x,d,r,s,a),M&&this.transformUseContext2d(n,d,R,t);const E=(P,B,k,L)=>{let O=e+B;const I=i+k;if(L){t.highPerformanceSave(),O+=v;const H=Ki.allocate(1,0,0,1,0,0);H.rotateByCenter(Math.PI/2,O,I),t.transformFromMatrix(H,!0),Ki.free(H)}T&&(a?a(t,n.attribute,d):x&&(t.setStrokeStyle(n,n.attribute,y-e,C-i,d),t.strokeText(P,O,I,R))),S&&(s?s(t,n.attribute,d):A&&(t.setCommonStyle(n,n.attribute,y-e,C-i,d),t.fillText(P,O,I,R))),L&&(t.highPerformanceRestore(),t.setTransformForCurrent())};if(t.setTextStyleWithoutAlignBaseline(n.attribute,d,R),m==="horizontal"){const{multilineLayout:P}=n;if(!P)return void t.highPerformanceRestore();const{xOffset:B,yOffset:k}=P.bbox;T&&(a?a(t,n.attribute,d):x&&(t.setStrokeStyle(n,n.attribute,y-e,C-i,d),P.lines.forEach((L=>{t.strokeText(L.str,(L.leftOffset||0)+B+e,(L.topOffset||0)+k+i,R)})))),S&&(s?s(t,n.attribute,d):A&&(t.setCommonStyle(n,n.attribute,y-e,C-i,d),P.lines.forEach((L=>{t.fillText(L.str,(L.leftOffset||0)+B+e,(L.topOffset||0)+k+i,R),this.drawUnderLine(g,f,n,(L.leftOffset||0)+B+e,(L.topOffset||0)+k+i,L.descent,(L.descent-L.ascent)/2,R,d,t,{width:L.width})}))))}else{let{textAlign:P=d.textAlign,textBaseline:B=d.textBaseline}=n.attribute;if(!b){const z=P;P=(h=n.getBaselineMapAlign()[B])!==null&&h!==void 0?h:"left",B=(u=n.getAlignMapBaseline()[z])!==null&&u!==void 0?u:"top"}n.tryUpdateAABBBounds();const k=n.cache,{verticalList:L}=k;t.textAlign="left",t.textBaseline="top";const O=w*L.length;let I=0;L.forEach((z=>{const G=z.reduce(((U,j)=>U+(j.width||0)),0);I=_s(G,I)}));let H=0,D=0;B==="bottom"?D=-O:B==="middle"&&(D=-O/2),P==="center"?H-=I/2:P==="right"&&(H-=I),L.forEach(((z,G)=>{const U=z.reduce(((Z,J)=>Z+(J.width||0)),0),j=I-U;let X=H;P==="center"?X+=j/2:P==="right"&&(X+=j),z.forEach((Z=>{const{text:J,width:q,direction:st}=Z;E(J,O-(G+1)*w+D,X,st),X+=q}))}))}M&&this.restoreTransformUseContext2d(n,d,R,t),this.afterRenderStep(n,t,e,i,S,T,A,x,d,r,s,a)}draw(n,t,e,i){const r=Wt(n,i?.theme).text,{keepDirIn3d:o=r.keepDirIn3d}=n.attribute,s=!o;this._draw(n,r,s,e,i)}drawUnderLine(n,t,e,i,r,o,s,a,l,h,u){if(t+n<=0)return;const{textAlign:d=l.textAlign,fill:c=l.fill,opacity:g=l.opacity,underlineOffset:f=l.underlineOffset,underlineDash:p=l.underlineDash,fillOpacity:m=l.fillOpacity}=e.attribute,v=!ze(u),b=v?u.width:e.clipedWidth,y=v?0:bu(d,b),C={lineWidth:0,stroke:c,opacity:g,strokeOpacity:m};if(n){C.lineWidth=n,h.setStrokeStyle(e,C,i,r,l),p&&h.setLineDash(p),h.beginPath();const w=r+o+f;h.moveTo(i+y,w,a),h.lineTo(i+y+b,w,a),h.stroke()}if(t){C.lineWidth=t,h.setStrokeStyle(e,C,i,r,l),h.beginPath();const w=r+s;h.moveTo(i+y,w,a),h.lineTo(i+y+b,w,a),h.stroke()}}};Q_=uq([pt(),cT(0,Xt(li)),cT(0,Li(Hp)),dq("design:paramtypes",[Object])],Q_);function NI(n,t,e,i){if(t&&t.length){n.moveTo(t[0].x+e,t[0].y+i);for(let r=1;r<t.length;r++)n.lineTo(t[r].x+e,t[r].y+i)}}function cq(n,t,e,i,r,o=!0){var s;if(t.length<3)return void NI(n,t,e,i);let a=0,l=t.length-1;o||(a+=1,l-=1,n.moveTo(t[0].x+e,t[0].y+i));for(let h=a;h<=l;h++){const u=t[h===0?l:(h-1)%t.length],d=t[h%t.length],c=t[(h+1)%t.length],g=d.x-u.x,f=d.y-u.y,p=d.x-c.x,m=d.y-c.y,v=(Math.atan2(f,g)-Math.atan2(m,p))/2,b=Math.abs(Math.tan(v));let y=Array.isArray(r)?(s=r[h%t.length])!==null&&s!==void 0?s:0:r,C=y/b;const w=rf(g,f),_=rf(p,m),A=Math.min(w,_);C>A&&(C=A,y=A*b);const x=iy(d,C,w,g,f),S=iy(d,C,_,p,m),T=2*d.x-x.x-S.x,M=2*d.y-x.y-S.y,R=rf(T,M),E=iy(d,rf(C,y),R,T,M);let P=Math.atan2(x.y-E.y,x.x-E.x);const B=Math.atan2(S.y-E.y,S.x-E.x);let k=B-P;k<0&&(P=B,k=-k),k>Math.PI&&(k-=Math.PI),h===0?n.moveTo(x.x+e,x.y+i):n.lineTo(x.x+e,x.y+i),k&&n.arcTo(d.x+e,d.y+i,S.x+e,S.y+i,y),n.lineTo(S.x+e,S.y+i)}o||n.lineTo(t[l+1].x+e,t[l+1].y+i)}function rf(n,t){return Math.sqrt(n*n+t*t)}function iy(n,t,e,i,r){const o=t/e;return{x:n.x-i*o,y:n.y-r*o}}const gq=Iu,fq=Ma;var pq=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},mq=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},gT=function(n,t){return function(e,i){t(e,i,n)}};let tw=class extends Gn{constructor(n){super(),this.graphicRenderContributions=n,this.numberType=gv,this.builtinContributions=[fq,gq],this.init(n)}drawShape(n,t,e,i,r,o,s,a){const l=Wt(n,o?.theme).polygon,{points:h=l.points,cornerRadius:u=l.cornerRadius,x:d=l.x,y:c=l.y,closePath:g=l.closePath,fillStrokeOrder:f=l.fillStrokeOrder}=n.attribute,p=this.valid(n,l,s,a);if(!p)return;const{fVisible:m,sVisible:v,doFill:b,doStroke:y}=p;t.beginPath(),u<=0||ue(u)&&u.every((_=>_===0))?NI(t.camera?t:t.nativeContext,h,e,i):cq(t.camera?t:t.nativeContext,h,e,i,u,g),g&&t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),this.beforeRenderStep(n,t,e,i,b,y,m,v,l,r,s,a);const C=()=>{b&&(s?s(t,n.attribute,l):m&&(t.setCommonStyle(n,n.attribute,d-e,c-i,l),t.fill()))},w=()=>{y&&(a?a(t,n.attribute,l):v&&(t.setStrokeStyle(n,n.attribute,d-e,c-i,l),t.stroke()))};f?(w(),C()):(C(),w()),this.afterRenderStep(n,t,e,i,b,y,m,v,l,r,s,a)}draw(n,t,e,i){const r=Wt(n,i?.theme).polygon;this._draw(n,r,!1,e,i)}};tw=pq([pt(),gT(0,Xt(li)),gT(0,Li(V_)),mq("design:paramtypes",[Object])],tw);var vq=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},bq=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},fT=function(n,t){return function(e,i){t(e,i,n)}};let ew=class{constructor(n){this.groupRenderContribitions=n,this.numberType=ux}reInit(){this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(rT)}drawShape(n,t,e,i,r,o,s,a,l){const{clip:h,fill:u,stroke:d,background:c}=n.attribute;if(!(h||u||d||c))return;l=l??Wt(n,o?.theme).group;const{opacity:g=l.opacity,width:f=l.width,height:p=l.height,fillOpacity:m=l.fillOpacity,strokeOpacity:v=l.strokeOpacity,cornerRadius:b=l.cornerRadius,path:y=l.path,lineWidth:C=l.lineWidth,visible:w=l.visible,fillStrokeOrder:_=l.fillStrokeOrder,cornerType:A=l.cornerType,x=l.x,y:S=l.y}=n.attribute,T=BI(g,m,f,p,u),M=kI(g,v,f,p),R=vu(u,c),E=Tc(d,C);if(!n.valid||!w||!h&&(!R&&!E||!(T||M||s||a||c)))return;if(y&&y.length&&r.drawContribution){const L=t.disableFill,O=t.disableStroke,I=t.disableBeginPath;t.disableFill=!0,t.disableStroke=!0,t.disableBeginPath=!0,y.forEach((H=>{r.drawContribution.getRenderContribution(H).draw(H,r.renderService,r,o)})),t.disableFill=L,t.disableStroke=O,t.disableBeginPath=I}else b===0||ue(b)&&b.every((L=>L===0))?(t.beginPath(),t.rect(e,i,f,p)):(t.beginPath(),Vo(t,e,i,f,p,b,A!=="bevel"));this._groupRenderContribitions||(this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(rT));const P={doFill:R,doStroke:E};t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),this._groupRenderContribitions.forEach((L=>{L.time===ne.beforeFillStroke&&L.drawShape(n,t,e,i,R,E,T,M,l,r,s,a,P)})),h&&t.clip();const B=()=>{P.doFill&&(s?s(t,n.attribute,l):T&&(t.setCommonStyle(n,n.attribute,x-e,S-i,l),t.fill()))},k=()=>{P.doStroke&&(a?a(t,n.attribute,l):M&&(t.setStrokeStyle(n,n.attribute,x-e,S-i,l),t.stroke()))};_?(k(),B()):(B(),k()),this._groupRenderContribitions.forEach((L=>{L.time===ne.afterFillStroke&&L.drawShape(n,t,e,i,R,E,T,M,l,r,s,a)}))}draw(n,t,e,i){var r,o;const{context:s}=e;if(!s)return;const{clip:a,baseOpacity:l=1,drawMode:h}=n.attribute,u=s.nativeContext,d=s.canvas.nativeCanvas;if(h>0){const{x:v,y:b,width:y,height:C}=n.attribute,w=s.canvas,_=mt.global.createCanvas({width:w.width,height:w.height,dpr:1}),A=_.getContext("2d"),x=s.nativeContext.getTransform();A.setTransform(x.a,x.b,x.c,x.d,x.e,x.f),h===1&&(A.save(),A.clearRect(0,0,w.width,w.height),A.beginPath(),A.rect(v,b,y,C),A.clip(),A.drawImage(w.nativeCanvas,0,0,w.width,w.height,0,0,w.displayWidth,w.displayHeight),A.restore()),s.nativeContext=A,w.nativeCanvas=_}a?s.save():s.highPerformanceSave();const c=s.baseGlobalAlpha;s.baseGlobalAlpha*=l;const g=s.modelMatrix;if(s.camera){const v=Wt(n,i?.theme).group,b=Bi.allocate(),y=Bi.allocate();EI(y,n,v),hg(b,g||b,y),s.modelMatrix=b,Bi.free(y),s.setTransform(1,0,0,1,0,0,!0)}else s.transformFromMatrix(n.transMatrix,!0);s.beginPath(),i.skipDraw?this.drawShape(n,s,0,0,e,i,(()=>!1),(()=>!1)):this.drawShape(n,s,0,0,e,null,null,null);const{scrollX:f,scrollY:p}=n.attribute;let m;if((f||p)&&s.translate(f,p),i&&i.renderInGroup&&(m=i.renderInGroup((r=i.renderInGroupParams)===null||r===void 0?void 0:r.skipSort,n,e,(o=i.renderInGroupParams)===null||o===void 0?void 0:o.nextM)),s.modelMatrix!==g&&Bi.free(s.modelMatrix),s.modelMatrix=g,s.baseGlobalAlpha=c,h>0){const{x:v,y:b,width:y,height:C}=n.attribute,w=s.nativeContext,_=s.canvas.nativeCanvas;u.save(),u.setTransform(s.dpr,0,0,s.dpr,0,0,!0),h===1&&w.rect(v,b,y,C),u.drawImage(_,0,0,_.width,_.height,0,0,s.canvas.displayWidth,s.canvas.displayHeight);const A=w.getTransform();u.setTransform(A.a,A.b,A.c,A.d,A.e,A.f),s.nativeContext=u,s.canvas.nativeCanvas=d,u.restore()}m&&m.then?m.then((()=>{a?s.restore():s.highPerformanceRestore()})):a?s.restore():s.highPerformanceRestore()}};ew=vq([pt(),fT(0,Xt(li)),fT(0,Li(mr)),bq("design:paramtypes",[Object])],ew);var yq=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},Cq=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},pT=function(n,t){return function(e,i){t(e,i,n)}};const _q=["","repeat-x","repeat-y","repeat"];let iw=class extends Gn{constructor(n){super(),this.graphicRenderContributions=n,this.numberType=dv,this.builtinContributions=[LY,OY],this.init(n)}drawShape(n,t,e,i,r,o,s,a){const l=Wt(n).image,{repeatX:h=l.repeatX,repeatY:u=l.repeatY,x:d=l.x,y:c=l.y,cornerRadius:g=l.cornerRadius,fillStrokeOrder:f=l.fillStrokeOrder,cornerType:p=l.cornerType,image:m}=n.attribute,v=this.valid(n,l,s);if(!v)return;const{fVisible:b,sVisible:y,doFill:C,doStroke:w}=v;if(!m||!n.resources)return;const _=n.resources.get(m);if(_.state!=="success")return;const A=n.width,x=n.height;t.beginPath();let S=!1;g===0||ue(g)&&g.every((R=>R===0))?t.rect(e,i,A,x):(Vo(t,e,i,A,x,g,p!=="bevel"),S=!0),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l);const T=()=>{if(C){if(s)s(t,n.attribute,l);else if(b){t.setCommonStyle(n,n.attribute,e,i,l);let R=0;if(h==="repeat"&&(R|=1),u==="repeat"&&(R|=2),R){const E=t.createPattern(_.data,_q[R]);t.fillStyle=E,t.translate(e,i,!0),t.fillRect(0,0,A,x),t.translate(-e,-i,!0)}else t.drawImage(_.data,e,i,A,x)}}},M=()=>{w&&(a?a(t,n.attribute,l):y&&(t.setStrokeStyle(n,n.attribute,d-e,c-i,l),t.stroke()))};f?(M(),S&&(t.save(),t.clip()),this.beforeRenderStep(n,t,e,i,C,!1,b,!1,l,r,s),T(),S&&t.restore()):(S&&(t.save(),t.clip()),this.beforeRenderStep(n,t,e,i,C,!1,b,!1,l,r,s),T(),S&&t.restore(),M()),this.afterRenderStep(n,t,e,i,C,!1,b,!1,l,r,s)}draw(n,t,e){const{image:i}=n.attribute;if(!i||!n.resources)return;const r=n.resources.get(i);if(r.state==="loading"&&Oo(i))return void Se.improveImageLoading(i);if(r.state!=="success")return;const{context:o}=t.drawParams;if(!o)return;const s=Wt(n).image;this._draw(n,s,!1,e)}};iw=yq([pt(),pT(0,Xt(li)),pT(0,Li(hl)),Cq("design:paramtypes",[Object])],iw);const WI=Symbol.for("IncrementalDrawContribution"),$p=Symbol.for("ArcRender"),Up=Symbol.for("CircleRender"),Ln=Symbol.for("GraphicRender"),mT=Symbol.for("GroupRender"),Xp=Symbol.for("LineRender"),Yp=Symbol.for("PathRender"),qp=Symbol.for("PolygonRender"),Kp=Symbol.for("RectRender"),Zp=Symbol.for("SymbolRender"),nw=Symbol.for("TextRender"),rw=Symbol.for("RichTextRender"),ow=Symbol.for("ImageRender"),wx=Symbol.for("DrawContribution"),jI=(n,t,e,i)=>{let r,o=!1,s=!1;if(t.forEachChildren((a=>(o=a.numberType===xX,!o))),t.forEachChildren((a=>(s=!!a.findFace,!s))),o){const a=t.getChildren(),l=[...a];l.sort(((h,u)=>{var d,c,g,f;let p=((c=(d=h.attribute.startAngle)!==null&&d!==void 0?d:0+h.attribute.endAngle)!==null&&c!==void 0?c:0)/2,m=((f=(g=u.attribute.startAngle)!==null&&g!==void 0?g:0+u.attribute.endAngle)!==null&&f!==void 0?f:0)/2;for(;p<0;)p+=zt;for(;m<0;)m+=zt;return m-p})),l.forEach((h=>{h._next=null,h._prev=null})),t.removeAllChild(),t.update(),l.forEach((h=>{t.appendChild(h)})),i.hack_pieFace="outside",r=e(o,s),r&&r.graphic||(i.hack_pieFace="inside",r=e(o,s)),r&&r.graphic||(i.hack_pieFace="top",r=e(o,s)),t.removeAllChild(),a.forEach((h=>{h._next=null,h._prev=null})),a.forEach((h=>{t.appendChild(h)}))}else if(s){const a=t.getChildren(),l=a.map((h=>({ave_z:h.findFace().vertices.map((u=>{var d;return n.view(u[0],u[1],(d=u[2]+h.attribute.z)!==null&&d!==void 0?d:0)[2]})).reduce(((u,d)=>u+d),0),g:h})));l.sort(((h,u)=>u.ave_z-h.ave_z)),t.removeAllChild(),l.forEach((h=>{h.g._next=null,h.g._prev=null})),t.update(),l.forEach((h=>{t.add(h.g)})),r=e(o,s),t.removeAllChild(),a.forEach((h=>{h._next=null,h._prev=null})),t.update(),a.forEach((h=>{t.add(h)}))}else r=e(o,s);return r};var wq=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},xq=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};const Ec=Symbol.for("DrawItemInterceptor"),vT=new Zi,bT=new Zi;class Sq{constructor(){this.order=1}afterDrawItem(t,e,i,r,o){return t.attribute.shadowRootIdx==null&&t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx<0||(t.attribute.shadowRootIdx>0||!t.attribute.shadowRootIdx||t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx>0)&&this.drawItem(t,e,i,r,o),!1}beforeDrawItem(t,e,i,r,o){return t.attribute.shadowRootIdx==null&&t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx>0||(t.attribute.shadowRootIdx<0||t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx<0)&&this.drawItem(t,e,i,r,o),!1}drawItem(t,e,i,r,o){if(!t.shadowRoot)return!1;const{context:s}=i;if(s.highPerformanceSave(),s.transformFromMatrix(t.transMatrix,!0),r.dirtyBounds&&r.backupDirtyBounds){vT.copy(r.dirtyBounds),bT.copy(r.backupDirtyBounds);const a=t.globalTransMatrix.getInverse();r.dirtyBounds.copy(r.backupDirtyBounds).transformWithMatrix(a),r.backupDirtyBounds.copy(r.dirtyBounds)}return r.renderGroup(t.shadowRoot,i,Ki.allocate(1,0,0,1,0,0)),s.highPerformanceRestore(),r.dirtyBounds&&r.backupDirtyBounds&&(r.dirtyBounds.copy(vT),r.backupDirtyBounds.copy(bT)),!0}}class Aq{constructor(){this.order=1}afterDrawItem(t,e,i,r,o){return t.attribute._debug_bounds&&this.drawItem(t,e,i,r,o),!1}drawItem(t,e,i,r,o){if(!t.attribute._debug_bounds)return!1;const{context:s}=i;s.highPerformanceSave(),t.parent&&s.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&s.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);const a=t.AABBBounds;return t.attribute._debug_bounds!==!0&&t.attribute._debug_bounds(s,t),s.strokeRect(a.x1,a.y1,a.width(),a.height()),s.highPerformanceRestore(),!0}}let Jp=class{constructor(){this.order=1,this.interceptors=[new Sq,new Tq,new Mq,new Aq]}afterDrawItem(n,t,e,i,r){if((!n.in3dMode||e.in3dInterceptor)&&!n.shadowRoot&&!n.attribute._debug_bounds&&!(n.baseGraphic||n.attribute.globalZIndex||n.interactiveGraphic))return!1;for(let o=0;o<this.interceptors.length;o++)if(this.interceptors[o].afterDrawItem&&this.interceptors[o].afterDrawItem(n,t,e,i,r))return!0;return!1}beforeDrawItem(n,t,e,i,r){if((!n.in3dMode||e.in3dInterceptor)&&!n.shadowRoot&&!n.attribute._debug_bounds&&!(n.baseGraphic||n.attribute.globalZIndex||n.interactiveGraphic))return!1;for(let o=0;o<this.interceptors.length;o++)if(this.interceptors[o].beforeDrawItem&&this.interceptors[o].beforeDrawItem(n,t,e,i,r))return!0;return!1}};Jp=wq([pt(),xq("design:paramtypes",[])],Jp);class Mq{constructor(){this.order=1}beforeDrawItem(t,e,i,r,o){return!this.processing&&(t.baseGraphic?this.beforeDrawInteractive(t,e,i,r,o):this.beforeSetInteractive(t,e,i,r,o))}beforeSetInteractive(t,e,i,r,o){let s=t.interactiveGraphic;if(t.attribute.globalZIndex){s||(s=t.clone(),t.interactiveGraphic=s,s.baseGraphic=t),s.setAttributes({globalZIndex:0,zIndex:t.attribute.globalZIndex},!1,{skipUpdateCallback:!0}),i.stage.tryInitInteractiveLayer();const a=i.stage.getLayer("_builtin_interactive");return a&&this.getShadowRoot(a).add(s),!0}if(s){i.stage.tryInitInteractiveLayer();const a=i.stage.getLayer("_builtin_interactive");a&&this.getShadowRoot(a).removeChild(s),t.interactiveGraphic=null,s.baseGraphic=null}return!1}beforeDrawInteractive(t,e,i,r,o){const s=t.baseGraphic;let a=!!s.stage,l=s.parent;for(;a&&l&&l.stage!==l;)a=!!l.stage,l=l.parent;if(!a){const h=i.stage.getLayer("_builtin_interactive");return h&&this.getShadowRoot(h).removeChild(t),!0}if(s){this.processing=!0;const{context:h}=i;return h.highPerformanceSave(),h.setTransformFromMatrix(s.parent.globalTransMatrix,!0),s.isContainer?r.renderGroup(s,i,s.parent.globalTransMatrix):r.renderItem(s,i),h.highPerformanceRestore(),this.processing=!1,!0}return!1}getShadowRoot(t){var e;let i=t.getElementById("_interactive_group");return i||(i=At.CreateGraphic("group",{}),i.id="_interactive_group",t.add(i)),(e=i.shadowRoot)!==null&&e!==void 0?e:i.attachShadow()}}class Tq{constructor(){this.order=1}beforeDrawItem(t,e,i,r,o){if(!t.in3dMode||i.in3dInterceptor)return!1;i.in3dInterceptor=!0;const{context:s,stage:a}=e.drawParams;s.canvas,s.save(),this.initCanvasCtx(s),s.camera=a.camera;const l=s.currentMatrix;l.a/=s.dpr,l.b/=s.dpr,l.c/=s.dpr,l.d/=s.dpr,l.e/=s.dpr,l.f/=s.dpr;const h=Bi.allocate();I_(h,l);const u=s.modelMatrix;if(u){if(h){const d=Bi.allocate();s.modelMatrix=hg(d,u,h)}}else s.modelMatrix=h;return s.setTransform(1,0,0,1,0,0,!0),t.isContainer?jI(s,t,((d,c)=>r.renderGroup(t,i,t.parent.globalTransMatrix,!d&&c)),i):r.renderItem(t,i),s.camera=null,s.restore(),s.modelMatrix!==u&&Bi.free(s.modelMatrix),s.modelMatrix=u,i.in3dInterceptor=!1,!0}initCanvasCtx(t){t.setTransformForCurrent()}}var Rq=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},Bq=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},kq=function(n,t){return function(e,i){t(e,i,n)}};let sw=class{constructor(n){this.drawContribution=n}prepare(n){n&&this.renderTreeRoots.forEach((t=>{this._prepare(t,n)}))}_prepare(n,t){n.forEachChildren((e=>{this._prepare(e,t)})),n.update({bounds:t,trans:!0})}prepareRenderList(){}beforeDraw(n){}draw(n){this.drawContribution.draw(this,Object.assign({},this.drawParams))}afterDraw(n){this.drawContribution.afterDraw&&this.drawContribution.afterDraw(this,Object.assign({},this.drawParams))}reInit(){this.drawContribution.reInit()}render(n,t){this.renderTreeRoots=n,this.drawParams=t;const e=t.updateBounds;this.prepare(e),this.prepareRenderList(),this.beforeDraw(t),this.draw(t),this.afterDraw(t),this.drawParams=null}};sw=Rq([pt(),kq(0,Xt(wx)),Bq("design:paramtypes",[Object])],sw);const Pq=new Ot((n=>{n(ex).to(sw)})),Eh=Symbol.for("PickerService"),yT=Symbol.for("GlobalPickerService"),vh=Symbol.for("PickItemInterceptor"),Qp=Symbol.for("PickServiceInterceptor");var yv=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let t0=class{constructor(){this.order=1}afterPickItem(n,t,e,i,r){if(n.graphic){let o=n.graphic;for(;o.parent;)o=o.parent;o.shadowHost&&(n.params={shadowTarget:n.graphic},n.graphic=o.shadowHost)}return n}};t0=yv([pt()],t0);let e0=class{constructor(){this.order=1}afterPickItem(n,t,e,i,r){return n.attribute.shadowRootIdx>0||!n.attribute.shadowRootIdx?this._pickItem(n,t,e,i,r):null}beforePickItem(n,t,e,i,r){return n.attribute.shadowRootIdx<0?this._pickItem(n,t,e,i,r):null}_pickItem(n,t,e,i,r){var o;if(!n.shadowRoot)return null;const{parentMatrix:s}=r||{};if(!s)return null;const a=t.pickContext;a.highPerformanceSave();const l=(o=Wt(n))===null||o===void 0?void 0:o[n.type],{shadowPickMode:h=l?.shadowPickMode}=n.attribute,u=n.shadowRoot,d=Ki.allocateByObj(s),c=new Te(d.a*e.x+d.c*e.y+d.e,d.b*e.x+d.d*e.y+d.f),g=t.pickGroup(u,c,d,i);return a.highPerformanceRestore(),!g.graphic&&g.group&&h==="full"&&(g.graphic=g.group),g}};e0=yv([pt()],e0);let i0=class{constructor(){this.order=1}beforePickItem(n,t,e,i,r){const o=n.baseGraphic;if(o&&o.parent){const s=new Te(e.x,e.y),a=t.pickContext;a.highPerformanceSave();const l=o.parent.globalTransMatrix;l.transformPoint(s,s);const h=o.isContainer?t.pickGroup(o,s.clone(),l,i):t.pickItem(o,s.clone(),l,i);return a.highPerformanceRestore(),h}return null}};i0=yv([pt()],i0);let n0=class{constructor(){this.order=1}beforePickItem(n,t,e,i,r){if(!n.in3dMode||i.in3dInterceptor)return null;const o=t.pickContext,s=n.stage;if(!o||!s)return null;if(i.in3dInterceptor=!0,o.save(),this.initCanvasCtx(o),o.camera=s.camera,n.isContainer){const a=jI(o,n,(()=>t.pickGroup(n,e,r.parentMatrix,i)),i);return o.camera=null,i.in3dInterceptor=!1,o.restore(),a}return o.restore(),null}initCanvasCtx(n){n.setTransformForCurrent()}};n0=yv([pt()],n0);const Eq=new Ot(((n,t,e)=>{e(Eh)||(n(yT).toSelf(),n(Eh).toService(yT)),n(n0).toSelf().inSingletonScope(),n(vh).toService(n0),n(e0).toSelf().inSingletonScope(),n(vh).toService(e0),n(i0).toSelf().inSingletonScope(),n(vh).toService(i0),cn(n,vh),n(t0).toSelf().inSingletonScope(),n(Qp).toService(t0),cn(n,Qp)})),Lq=new Ot((n=>{n(gx).to($_),n(xI).toConstantValue(At)})),Lc=Symbol.for("AutoEnablePlugins"),VI=Symbol.for("PluginService");var Oq=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},Iq=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},CT=function(n,t){return function(e,i){t(e,i,n)}};let aw=class{constructor(n){this.autoEnablePlugins=n,this.onStartupFinishedPlugin=[],this.onRegisterPlugin=[],this.actived=!1}active(n,t){this.stage=n,this.actived=!0;const{pluginList:e}=t;e&&Et.isBound(Lc)&&this.autoEnablePlugins.getContributions().forEach((i=>{e.includes(i.name)&&this.register(i)}))}findPluginsByName(n){const t=[];return this.onStartupFinishedPlugin.forEach((e=>{e.name===n&&t.push(e)})),this.onRegisterPlugin.forEach((e=>{e.name===n&&t.push(e)})),t}register(n){n.activeEvent==="onStartupFinished"?this.onStartupFinishedPlugin.push(n):n.activeEvent==="onRegister"&&(this.onRegisterPlugin.push(n),n.activate(this))}unRegister(n){n.activeEvent==="onStartupFinished"?this.onStartupFinishedPlugin.splice(this.onStartupFinishedPlugin.indexOf(n),1):n.activeEvent==="onRegister"&&this.onRegisterPlugin.splice(this.onStartupFinishedPlugin.indexOf(n),1),n.deactivate(this)}release(...n){this.onStartupFinishedPlugin.forEach((t=>{t.deactivate(this)})),this.onStartupFinishedPlugin=[],this.onRegisterPlugin.forEach((t=>{t.deactivate(this)})),this.onRegisterPlugin=[]}};aw=Oq([pt(),CT(0,Xt(li)),CT(0,Li(Lc)),Iq("design:paramtypes",[Object])],aw);const Hq=new Ot((n=>{n(VI).to(aw),Q7(n,Lc)})),Dq=new Ot((n=>{cn(n,ov)})),Fq=new Ot((n=>{n(ws).to(mu).inSingletonScope(),cn(n,ws)}));var zq=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},Nq=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let r0=class{constructor(){this.type="static",this.offscreen=!1,this.global=mt.global}setDpr(n){this.canvas.dpr=n}init(n,t,e){if(this.layer=n,this.window=t,e.main)this.main=!0,this.context=t.getContext(),this.canvas=this.context.getCanvas();else{let i;this.main=!1,e.canvasId&&(i=this.global.getElementById(e.canvasId)),i||(i=this.global.createCanvas({width:t.width,height:t.height})),i.style&&(i.style["pointer-events"]="none");const r=t.getContext().getCanvas().nativeCanvas,o=R_({nativeCanvas:i,width:t.width,height:t.height,dpr:t.dpr,id:e.canvasId,canvasControled:!0,container:t.getContainer(),x:r.offsetLeft,y:r.offsetTop});o.applyPosition(),this.canvas=o,this.context=o.getContext()}}resize(n,t){this.canvas.resize(n,t)}resizeView(n,t){}render(n,t,e){var i;if(!this.main){const r=this.window.getContext().getCanvas().nativeCanvas;!r||this.canvas.x===r.offsetLeft&&this.canvas.y===r.offsetTop||(this.canvas.x=r.offsetLeft,this.canvas.y=r.offsetTop,this.canvas.applyPosition())}t.renderService.render(n,Object.assign(Object.assign({context:this.context,clear:(i=t.background)!==null&&i!==void 0?i:"#ffffff"},t),e))}merge(n){n.forEach((t=>{const e=t.getContext().canvas.nativeCanvas;this.context.drawImage(e,0,0)}))}prepare(n,t){}drawTo(n,t,e){var i;const r=n.getContext();e.renderService.render(t,Object.assign(Object.assign({context:r},e),{clear:e.clear?(i=e.background)!==null&&i!==void 0?i:"#fff":void 0}))}getContext(){return this.context}release(){this.canvas.release()}};r0=zq([pt(),Nq("design:paramtypes",[])],r0);const Wq=new Ot((n=>{n(r0).toSelf(),n(RI).toService(r0)}));function jq(n){n.load(Dq),n.load(Fq),n.load(Wq)}var Vq=function(n,t,e,i){return new(e||(e=Promise))((function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e((function(d){d(u)}))).then(s,a)}l((i=i.apply(n,t||[])).next())}))};function GI(n,t,e){const i={},r=[];return n.forEachChildren((o=>{const{zIndex:s=t}=o.attribute;i[s]?i[s].push(o):(i[s]=[o],r.push(s))}),e),r.sort(((o,s)=>e?s-o:o-s)),{childMap:i,zIdxArray:r}}function $I(n,t,e,i=!1,r=!1){let o=!1;if(r)o=!0;else{let s;n.forEachChildren(((a,l)=>{const{zIndex:h=t}=a.attribute;if(l===0)s=h;else if(s!==h)return o=!0,!0;return!1}),i)}if(o){const{childMap:s,zIdxArray:a}=GI(n,t,i);let l=!1;for(let h=0;h<a.length&&!l;h++){const u=s[a[h]];r&&u.sort(((d,c)=>{var g,f;return(i?-1:1)*(((g=c.attribute.z)!==null&&g!==void 0?g:0)-((f=d.attribute.z)!==null&&f!==void 0?f:0))}));for(let d=0;d<u.length;d++)if(e(u[d],d)){l=!0;break}}}else n.forEachChildren(e,i)}function _T(n,t,e,i=!1){return Vq(this,void 0,void 0,(function*(){yield n.forEachChildrenAsync(e,i)}))}function Gq(n,t,e,i=!1){let r=!1;n.forEachChildren(((a,l)=>{const{zIndex:h=e}=a.attribute;if(l!==0){if(h!==void 0)return r=!0,!0}return!1}),i);let o=null,s=!1;if(r){const{childMap:a,zIdxArray:l}=GI(n,e,i);let h=!1;for(let u=0;u<l.length&&!h;u++){const d=a[l[u]];for(let c=0;c<d.length;c++){if(s){h=!0,o=d[c];break}d[c]._uid!==t||(s=!0)}}}else n.forEachChildren((a=>s?(o=a,!0):(a._uid===t&&(s=!0),!1)),i);return o}var $q=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},Uq=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},ny=function(n,t){return function(e,i){t(e,i,n)}};let o0=class{constructor(n,t){this.contributions=n,this.drawItemInterceptorContributions=t,this._renderInGroup=(e,i,r,o)=>{var s;e?i.forEachChildren((a=>{r.break||(a.isContainer?this.renderGroup(a,r,o):this.renderItem(a,r))})):$I(i,ei.zIndex,(a=>{r.break||(a.isContainer?this.renderGroup(a,r,o):this.renderItem(a,r))}),!1,!!(!((s=r.context)===null||s===void 0)&&s.camera))},this.currentRenderMap=new Map,this.defaultRenderMap=new Map,this.styleRenderMap=new Map,this.dirtyBounds=new Cc,this.backupDirtyBounds=new Cc,this.global=mt.global,this.layerService=mt.layerService,ue(this.contributions)||(this.contributions=[this.contributions]),this.init()}reInit(){this.init(),this.contributions.forEach((n=>{n.reInit()}))}init(){this.contributions.forEach((n=>{if(n.style){const t=this.styleRenderMap.get(n.style)||new Map;t.set(n.numberType,n),this.styleRenderMap.set(n.style,t)}else this.defaultRenderMap.set(n.numberType,n)})),this.InterceptorContributions=this.drawItemInterceptorContributions.getContributions().sort(((n,t)=>n.order-t.order))}prepareForDraw(n,t){t.updateBounds?this.useDirtyBounds=!0:this.useDirtyBounds=!t.stage.params.optimize.disableCheckGraphicWidthOutRange}draw(n,t){var e;this.prepareForDraw(n,t),t.drawContribution=this,this.currentRenderMap=this.styleRenderMap.get(t.renderStyle)||this.defaultRenderMap,this.currentRenderService=n;const{context:i,stage:r,viewBox:o,transMatrix:s}=t;if(!i)return;const a=this.dirtyBounds.setValue(0,0,o.width(),o.height());if(r.dirtyBounds&&!r.dirtyBounds.empty()){const h=_G(a,r.dirtyBounds);a.x1=Math.floor(h.x1),a.y1=Math.floor(h.y1),a.x2=Math.ceil(h.x2),a.y2=Math.ceil(h.y2)}const l=i.dpr%1;(l||l!==.5)&&(a.x1=Math.floor(a.x1*i.dpr)/i.dpr,a.y1=Math.floor(a.y1*i.dpr)/i.dpr,a.x2=Math.ceil(a.x2*i.dpr)/i.dpr,a.y2=Math.ceil(a.y2*i.dpr)/i.dpr),this.backupDirtyBounds.copy(a),i.reset(!1),i.save(),i.setClearMatrix(s.a,s.b,s.c,s.d,s.e,s.f),i.clearMatrix(!1),i.translate(o.x1,o.y1,!0),i.beginPath(),i.rect(a.x1,a.y1,a.width(),a.height()),i.clip(),r.camera&&(this.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),this.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0)),this.clearScreen(n,i,t),!((e=n.drawParams)===null||e===void 0)&&e.stage&&n.drawParams.stage.hooks.afterClearScreen.call(n.drawParams),n.renderTreeRoots.sort(((h,u)=>{var d,c;return((d=h.attribute.zIndex)!==null&&d!==void 0?d:ei.zIndex)-((c=u.attribute.zIndex)!==null&&c!==void 0?c:ei.zIndex)})).forEach((h=>{h.isContainer?this.renderGroup(h,t,Ki.allocate(1,0,0,1,0,0)):this.renderItem(h,t)})),i.restore(),i.draw()}doRegister(){throw new Error("暂不支持")}_findNextGraphic(n){let t=n.parent,e=n._uid;for(;t;){const i=Gq(t,e,ei.zIndex);if(i)return i;e=t._uid,t=t.parent}return null}renderGroup(n,t,e,i){if(t.break||n.attribute.visibleAll===!1)return;if(n.incremental&&(t.startAtId==null||t.startAtId===n._uid))return t.break=!0,void this._increaseRender(n,t);if(this.useDirtyBounds&&!UA(n.AABBBounds,this.dirtyBounds)&&n.attribute.boundsMode!=="empty")return;let r,o=e;if(this.useDirtyBounds){r=Gp.allocateByObj(this.dirtyBounds);const s=n.transMatrix;o=Ki.allocateByObj(e).multiply(s.a,s.b,s.c,s.d,s.e,s.f),this.dirtyBounds.copy(this.backupDirtyBounds).transformWithMatrix(o.getInverse())}t.isGroupScroll=!(!n.attribute.scrollX&&!n.attribute.scrollY),this.renderItem(n,t,{renderInGroupParams:{skipSort:i,nextM:o},renderInGroup:this._renderInGroup}),this.useDirtyBounds&&(this.dirtyBounds.copy(r),Gp.free(r),Ki.free(o))}_increaseRender(n,t){const{layer:e,stage:i}=t,{subLayers:r}=e;let o=r.get(n._uid);o||(o={layer:this.layerService.createLayer(i),zIndex:r.size,group:n},r.set(n._uid,o));const s=o.layer.getNativeHandler().getContext(),a=o.drawContribution||Et.get(WI);a.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),a.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0),a.draw(this.currentRenderService,Object.assign(Object.assign({},t),{drawContribution:a,clear:"transparent",layer:o.layer,context:s,startAtId:n._uid,break:!1})),o.drawContribution=a;const l=this._findNextGraphic(n);if(l)if(l.isContainer&&l.incremental)this._increaseRender(l,t);else{let h=r.get(l._uid);h||(h={layer:this.layerService.createLayer(i),zIndex:r.size},r.set(l._uid,h));const u=h.layer.getNativeHandler().getContext();this.draw(this.currentRenderService,Object.assign(Object.assign({},t),{drawContribution:a,clear:"transparent",layer:h.layer,context:u,startAtId:l._uid,break:!1}))}}getRenderContribution(n){let t;return t||(t=this.selectRenderByNumberType(n.numberType,n)),t||(t=this.selectRenderByType(n.type)),t}renderItem(n,t,e){if(this.InterceptorContributions.length)for(let a=0;a<this.InterceptorContributions.length;a++){const l=this.InterceptorContributions[a];if(l.beforeDrawItem&&l.beforeDrawItem(n,this.currentRenderService,t,this,e))return}const i=this.getRenderContribution(n);if(!i)return;let r,o=!1;if(t.isGroupScroll){const{scrollX:a=0,scrollY:l=0}=n.parent.attribute;o=!0,this.scrollMatrix||(this.scrollMatrix=Ki.allocate(1,0,0,1,0,0)),this.scrollMatrix.translate(-a,-l)}if(o&&(r=this.dirtyBounds.clone().transformWithMatrix(this.scrollMatrix)),this.useDirtyBounds&&!n.isContainer&&n.attribute.boundsMode!=="empty"&&!UA(n.AABBBounds,r??this.dirtyBounds)){if(o&&n.parent){const{scrollX:a=0,scrollY:l=0}=n.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(a,l)}return}const s=t.startAtId!=null&&n._uid!==t.startAtId;if(n._uid===t.startAtId&&(t.startAtId=null),e&&(e.skipDraw=s),s?n.isContainer&&i.draw(n,this.currentRenderService,t,e):i.draw(n,this.currentRenderService,t,e),o&&n.parent){const{scrollX:a=0,scrollY:l=0}=n.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(a,l)}if(this.InterceptorContributions.length)for(let a=0;a<this.InterceptorContributions.length;a++){const l=this.InterceptorContributions[a];if(l.afterDrawItem&&l.afterDrawItem(n,this.currentRenderService,t,this))return}}selectRenderByType(n){return Hn.getInstance().warn("未知错误，不应该走到这里"),null}selectRenderByNumberType(n,t){let e;if(t.attribute.renderStyle){const i=this.styleRenderMap.get(t.attribute.renderStyle);e=i&&i.get(n)}return e||this.currentRenderMap.get(n)||this.defaultRenderMap.get(n)}clearScreen(n,t,e){var i,r,o;const{clear:s,viewBox:a}=e,l=a.width(),h=a.height();if(s){t.clearRect(0,0,l,h),!((i=n.drawParams)===null||i===void 0)&&i.stage&&n.drawParams.stage.hooks.afterClearRect.call(n.drawParams);const u=(r=n.drawParams)===null||r===void 0?void 0:r.stage;if(u&&(t.globalAlpha=(o=u.attribute.opacity)!==null&&o!==void 0?o:1),u&&u.backgroundImg&&u.resources){const d=u.resources.get(s);d&&d.state==="success"&&d.data&&t.drawImage(d.data,0,0,l,h)}else t.fillStyle=kp(t,s,{AABBBounds:{x1:0,y1:0,x2:0+l,y2:0+h}},0,0),t.fillRect(0,0,l,h)}}afterDraw(n,t){}};o0=$q([pt(),ny(0,HO(Ln)),ny(1,Xt(li)),ny(1,Li(Ec)),Uq("design:paramtypes",[Array,Object])],o0);var Xq=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let s0=class extends Pc{constructor(){super(...arguments),this.numberType=lg}drawShape(n,t,e,i,r,o,s,a){if(n.incremental&&r.multiGraphicOptions){const{startAtIdx:l,length:h}=r.multiGraphicOptions,{segments:u=[]}=n.attribute;if(l>u.length)return;const d=Wt(n).line,{fill:c=d.fill,stroke:g=d.stroke,opacity:f=d.opacity,fillOpacity:p=d.fillOpacity,strokeOpacity:m=d.strokeOpacity,lineWidth:v=d.lineWidth,visible:b=d.visible}=n.attribute,y=Hl(f,p,c),C=F_(f,m),w=vu(c),_=Tc(g,v);if(!n.valid||!b||!w&&!_||!(y||C||s||a))return;const{context:A}=r;for(let x=l;x<l+h;x++)this.drawIncreaseSegment(n,A,u[x-1],u[x],n.attribute.segments[x],[d,n.attribute],e,i)}else super.drawShape(n,t,e,i,r,o,s,a)}drawIncreaseSegment(n,t,e,i,r,o,s,a){i&&(t.beginPath(),UY(t.nativeContext,e,i,{offsetX:s,offsetY:a}),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,r,o),t.setStrokeStyle(n,r,s,a,o),t.stroke())}};s0=Xq([pt()],s0);var Yq=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let lw=class extends J_{constructor(){super(...arguments),this.numberType=wI}drawShape(n,t,e,i,r,o,s){if(n.incremental&&r.multiGraphicOptions){const{startAtIdx:a,length:l}=r.multiGraphicOptions,{segments:h=[]}=n.attribute;if(a>h.length)return;const u=Wt(n).area,{fill:d=u.fill,fillOpacity:c=u.fillOpacity,opacity:g=u.opacity,visible:f=u.visible}=n.attribute,p=Hl(g,c,d),m=vu(d);if(!n.valid||!f||!m||!p&&!s)return;for(let v=a;v<a+l;v++)this.drawIncreaseSegment(n,t,h[v-1],h[v],n.attribute.segments[v],[u,n.attribute],e,i)}else super.drawShape(n,t,e,i,r,o,s)}drawIncreaseSegment(n,t,e,i,r,o,s,a){i&&(t.beginPath(),XY(t.camera?t:t.nativeContext,e,i,{offsetX:s,offsetY:a}),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,r,o),t.setCommonStyle(n,r,s,a,o),t.fill())}};lw=Yq([pt()],lw);var bh,qq=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},Kq=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},id=function(n,t){return function(e,i){t(e,i,n)}},vo=function(n,t,e,i){return new(e||(e=Promise))((function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e((function(d){d(u)}))).then(s,a)}l((i=i.apply(n,t||[])).next())}))};(function(n){n[n.NORMAL=0]="NORMAL",n[n.STOP=1]="STOP"})(bh||(bh={}));let hw=class extends o0{constructor(n,t,e,i){super(n,i),this.contributions=n,this.lineRender=t,this.areaRender=e,this.drawItemInterceptorContributions=i,this.rendering=!1,this.currFrameStartAt=0,this.currentIdx=0,this.status=bh.NORMAL,this.checkingForDrawPromise=null,this.hooks={completeDraw:new yn([])},this.defaultRenderMap.set(this.lineRender.numberType,this.lineRender),this.defaultRenderMap.set(this.areaRender.numberType,this.areaRender)}draw(n,t){return vo(this,void 0,void 0,(function*(){if(this.checkingForDrawPromise)return;this.lastRenderService=n,this.lastDrawContext=t,this.checkingForDrawPromise=this.checkForDraw(t);const e=yield this.checkingForDrawPromise;if(this.checkingForDrawPromise=null,e)return;this.currentRenderService=n;const{context:i,viewBox:r}=t;i&&(i.inuse=!0,i.clearMatrix(),i.setTransformForCurrent(!0),i.save(),t.restartIncremental&&this.clearScreen(this.currentRenderService,i,t),i.translate(r.x1,r.y1,!0),i.save(),n.renderTreeRoots.sort(((o,s)=>{var a,l;return((a=o.attribute.zIndex)!==null&&a!==void 0?a:ei.zIndex)-((l=s.attribute.zIndex)!==null&&l!==void 0?l:ei.zIndex)})).forEach((o=>{this.renderGroup(o,t)})),this.hooks.completeDraw.tap("top-draw",(()=>{i.restore(),i.restore(),i.draw(),i.inuse=!1,this.rendering=!1})))}))}_increaseRender(n,t){return vo(this,void 0,void 0,(function*(){this.rendering=!0,yield this._renderIncrementalGroup(n,t)}))}_renderIncrementalGroup(n,t){return vo(this,void 0,void 0,(function*(){this.count=n.count,yield new Promise((e=>{this.renderItem(n,t,{drawingCb:()=>vo(this,void 0,void 0,(function*(){if(n.count!==2)yield _T(n,ei.zIndex,((i,r)=>{if(this.status===bh.STOP)return!0;if(i.isContainer||r<this.currentIdx)return!1;const o=this.currFrameStartAt+n.incremental;return r<o&&(this.currentIdx=r+1,this.renderItem(i,t)),r===o-1&&(this.currFrameStartAt=this.currentIdx,this.waitToNextFrame())})),e(!1);else{const i=n.getChildAt(0);if(i.incremental&&i.attribute.segments)for(i.incrementalAt||(i.incrementalAt=0);i.incrementalAt<i.attribute.segments.length;)t.multiGraphicOptions={startAtIdx:i.incrementalAt,length:i.incremental},this.renderItem(i,t),i.incrementalAt+=i.incremental,yield this.waitToNextFrame();else this.renderItem(i,t);e(!1)}}))})})),this.hooks.completeDraw.call()}))}waitToNextFrame(){return vo(this,void 0,void 0,(function*(){return new Promise((n=>{this.global.getRequestAnimationFrame()((()=>{n(!1)}))}))}))}checkForDraw(n){return vo(this,void 0,void 0,(function*(){let t=this.rendering;return n.restartIncremental&&(t=!1,yield this.forceStop(),this.resetToInit()),t}))}forceStop(){return vo(this,void 0,void 0,(function*(){this.rendering&&(this.status=bh.STOP,yield new Promise((n=>{this.hooks.completeDraw.tap("stopCb",(()=>{this.status=bh.NORMAL,this.hooks.completeDraw.taps=this.hooks.completeDraw.taps.filter((t=>t.name!=="stopCb")),n(!1)}))})))}))}resetToInit(){this.currFrameStartAt=0,this.currentIdx=0}renderGroup(n,t){return vo(this,void 0,void 0,(function*(){if(!t.break&&n.attribute.visibleAll!==!1)return n.incremental&&t.startAtId===n._uid?(yield this._increaseRender(n,t),void(t.break=!0)):void(yield new Promise((e=>{this.renderItem(n,t,{drawingCb:()=>vo(this,void 0,void 0,(function*(){yield _T(n,ei.zIndex,(i=>vo(this,void 0,void 0,(function*(){t.break||i.isContainer&&(yield this.renderGroup(i,t))})))),e(!1)}))})})))}))}};hw=qq([pt(),id(0,HO(Ln)),id(1,Xt(s0)),id(2,Xt(lw)),id(3,Xt(li)),id(3,Li(Ec)),Kq("design:paramtypes",[Array,Object,Object,Object])],hw);const Zq=new Ot((n=>{n(bv).toSelf().inSingletonScope(),n(_x).toSelf().inSingletonScope(),n(wx).to(o0),n(WI).to(hw),n(mT).to(ew).inSingletonScope(),n(Ln).toService(mT),cn(n,mr),n(so).toSelf().inSingletonScope(),cn(n,bx),cn(n,Ln),n(Jp).toSelf().inSingletonScope(),n(Ec).toService(Jp),cn(n,Ec)}));function Jq(n){n.load(Zq)}function Oc(){Oc.__loaded||(Oc.__loaded=!0,Et.load(XX),Et.load(Lq),Et.load(Pq),Et.load(Eq),Et.load(Hq),jq(Et),Jq(Et))}Oc.__loaded=!1,Oc();const Bt=Et.get(tx);mt.global=Bt;const Qq=Et.get(TI);mt.graphicUtil=Qq;const tK=Et.get(MI);mt.transformUtil=tK;const eK=Et.get(gx);mt.graphicService=eK;const iK=Et.get(vx);mt.layerService=iK;class nK{constructor(){this.name="AutoRenderPlugin",this.activeEvent="onRegister",this._uid=Ci.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=t=>{t.glyphHost&&(t=t.glyphHost),t.stage===this.pluginService.stage&&t.stage!=null&&t.stage.renderNextFrame()}}activate(t){this.pluginService=t;const e=this.pluginService.stage;e&&(e.graphicService.hooks.onAttributeUpdate.tap(this.key,this.handleChange),e.graphicService.hooks.onSetStage.tap(this.key,this.handleChange),e.graphicService.hooks.onRemove.tap(this.key,this.handleChange))}deactivate(t){const e=r=>r.filter((o=>o.name!==this.key)),i=this.pluginService.stage;i&&(i.graphicService.hooks.onAttributeUpdate.taps=e(i.graphicService.hooks.onAttributeUpdate.taps),i.graphicService.hooks.onSetStage.taps=e(i.graphicService.hooks.onSetStage.taps),i.graphicService.hooks.onRemove.taps=e(i.graphicService.hooks.onRemove.taps))}}class rK{constructor(){this.name="AutoRefreshPlugin",this.activeEvent="onRegister",this._uid=Ci.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=t=>{t.glyphHost&&(t=t.glyphHost),t.stage===this.pluginService.stage&&t.stage!=null&&t.stage.renderNextFrame()}}activate(t){this.pluginService=t,this.dpr=mt.global.devicePixelRatio,this.refresh()}refresh(){this._refreshByMediaQuery()||this._refreshByRaf()}_refreshByRaf(){const t=mt.global.getRequestAnimationFrame();this.rafId=t((()=>{mt.global.devicePixelRatio!==this.dpr&&(this.dpr=mt.global.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0)),this.refresh()}))}_refreshByMediaQuery(){try{const t=`(resolution: ${window.devicePixelRatio}dppx)`,e=()=>{window.devicePixelRatio!==this.dpr&&(this.dpr=window.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0))},i=matchMedia(t);i&&i.addEventListener("change",e),this.autoRefreshCbs||(this.autoRefreshCbs=[]),this.autoRefreshCbs.push((()=>{i&&i.removeEventListener("change",e)}))}catch{return!1}return!0}deactivate(t){var e;const i=mt.global.getCancelAnimationFrame();i&&this.rafId&&i(this.rafId),(e=this.autoRefreshCbs)===null||e===void 0||e.forEach((r=>{r()})),this.autoRefreshCbs=void 0}}class oK{constructor(){this.name="IncrementalAutoRenderPlugin",this.activeEvent="onRegister",this.nextFrameRenderGroupSet=new Set,this.willNextFrameRender=!1,this.nextUserParams={},this._uid=Ci.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t;const e=this.pluginService.stage;e&&(e.graphicService.hooks.onAddIncremental.tap(this.key,((i,r,o)=>{i.glyphHost&&(i=i.glyphHost),i.stage===t.stage&&i.stage!=null&&(this.nextUserParams.startAtId=r._uid,this.renderNextFrame(r))})),e.graphicService.hooks.onClearIncremental.tap(this.key,((i,r)=>{i.stage===t.stage&&i.stage!=null&&(this.nextUserParams.startAtId=i._uid,this.nextUserParams.restartIncremental=!0,this.renderNextFrame(i))})))}deactivate(t){const e=this.pluginService.stage;e&&(e.graphicService.hooks.onAddIncremental.taps=e.graphicService.hooks.onAddIncremental.taps.filter((i=>i.name!==this.key)),e.graphicService.hooks.onClearIncremental.taps=e.graphicService.hooks.onClearIncremental.taps.filter((i=>i.name!==this.key)))}renderNextFrame(t){this.nextFrameRenderGroupSet.add(t),this.willNextFrameRender||(this.willNextFrameRender=!0,mt.global.getRequestAnimationFrame()((()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1})))}_doRenderInThisFrame(){const t=this.pluginService.stage;this.nextFrameRenderGroupSet.size&&(this.nextFrameRenderGroupSet.forEach((e=>{const i=e.layer;if(!i||!e.layer.subLayers)return;const r=e.layer.subLayers.get(e._uid);r&&r.drawContribution&&r.drawContribution.draw(t.renderService,Object.assign({stage:t,layer:i,viewBox:t.window.getViewBox(),transMatrix:t.window.getViewBoxTransform(),clear:"transparent",renderService:t.renderService,updateBounds:!1,startAtId:e._uid,context:r.layer.getNativeHandler().getContext()},this.nextUserParams))})),this.nextUserParams={},this.nextFrameRenderGroupSet.clear())}}const wT=new Zi;class sK{constructor(){this.name="DirtyBoundsPlugin",this.activeEvent="onRegister",this._uid=Ci.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,t.stage.hooks.afterRender.tap(this.key,(i=>{i&&i===this.pluginService.stage&&i.dirtyBounds.clear()}));const e=this.pluginService.stage;e&&(e.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,((i,r,o,s)=>{i.glyphHost&&(i=i.glyphHost),r&&r===this.pluginService.stage&&r.renderCount&&(i.isContainer&&!i.shouldSelfChangeUpdateAABBBounds()||o&&(wT.setValue(s.x1,s.y1,s.x2,s.y2),r.dirty(wT,i.parent&&i.parent.globalTransMatrix)))})),e.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,((i,r,o,s,a)=>{r&&r===this.pluginService.stage&&r.renderCount&&(i.isContainer&&!a||r.dirty(s.globalAABBBounds))})),e.graphicService.hooks.clearAABBBounds.tap(this.key,((i,r,o)=>{r&&r===this.pluginService.stage&&r.renderCount&&r&&r.dirty(o)})),e.graphicService.hooks.onRemove.tap(this.key,(i=>{const r=i.stage;r&&r===this.pluginService.stage&&r.renderCount&&r&&r.dirty(i.globalAABBBounds)})))}deactivate(t){const e=this.pluginService.stage;e&&(e.graphicService.hooks.beforeUpdateAABBBounds.taps=e.graphicService.hooks.beforeUpdateAABBBounds.taps.filter((i=>i.name!==this.key)),e.graphicService.hooks.afterUpdateAABBBounds.taps=e.graphicService.hooks.afterUpdateAABBBounds.taps.filter((i=>i.name!==this.key)),e.graphicService.hooks.clearAABBBounds.taps=e.graphicService.hooks.clearAABBBounds.taps.filter((i=>i.name!==this.key)),e.hooks.afterRender.taps=e.hooks.afterRender.taps.filter((i=>i.name!==this.key)),e.graphicService.hooks.onRemove.taps=e.graphicService.hooks.onRemove.taps.filter((i=>i.name!==this.key)))}}let el;function UI(){if(el==null)try{const n=document.createElement("canvas"),t=n.getContext("2d");el=!!(window&&n.getBoundingClientRect&&requestAnimationFrame&&window.devicePixelRatio&&t&&t.isPointInPath&&t.isPointInStroke),el&&(el=!!document.createElement)}catch{el=!1}}function xx(){UI();const n=mt.global&&mt.global.env;return n?n==="browser":el}function aK(){UI();const n=mt.global&&mt.global.env;return n?n==="node":!el}let Xs=class uw{static registerPlugin(t,e){uw._pluginClasses[t]=e}static getPlugin(t){return uw._pluginClasses[t]}};Xs._pluginClasses={};const xT={BACKGROUND:"white"};class lK extends Jt{set viewBox(t){this.window.setViewBox(t)}get viewBox(){return this.window.getViewBox()}get x(){return this.window.getViewBox().x1}set x(t){const e=this.window.getViewBox();e.translate(t-e.x1,0),this.window.setViewBox(e)}get y(){return this.window.getViewBox().y1}set y(t){const e=this.window.getViewBox();e.translate(0,t-e.y1),this.window.setViewBox(e)}get width(){return this.window.width}set width(t){this.resize(t,this.height)}get viewWidth(){return this.window.getViewBox().width()}set viewWidth(t){this.resizeView(t,this.viewHeight)}get viewHeight(){return this.window.getViewBox().height()}set viewHeight(t){this.resizeView(this.viewWidth,t)}get height(){return this.window.height}set height(t){this.resize(this.width,t)}get dpr(){return this.window.dpr}set dpr(t){this.setDpr(t)}get background(){var t;return(t=this._background)!==null&&t!==void 0?t:xT.BACKGROUND}set background(t){this._background=t}get defaultLayer(){return this.at(0)}get eventSystem(){return this._eventSystem}get ticker(){return this._ticker}set ticker(t){t.bindStage(this),this._ticker&&this._ticker.removeListener("tick",this.afterTickCb),t.addTimeline(this.timeline),this._ticker=t,this._ticker.on("tick",this.afterTickCb)}constructor(t={}){var e,i;super({}),this.tickedBeforeRender=!0,this._onVisibleChange=r=>{if(!(this._skipRender<0))if(r){if(this.dirtyBounds){const o=this.window.getViewBox();this.dirtyBounds.setValue(o.x1,o.y1,o.width(),o.height())}this._skipRender>1&&this.renderNextFrame(),this._skipRender=0}else this._skipRender=1},this.beforeRender=r=>{this._beforeRenderList.forEach((o=>o(r)))},this.afterClearScreen=r=>{this._afterClearScreen&&this._afterClearScreen(r)},this.afterClearRect=r=>{this._afterClearRect&&this._afterClearRect(r)},this.afterRender=r=>{this.renderCount++,this._afterRenderList.forEach((o=>o(r))),this._afterNextRenderCbs&&this._afterNextRenderCbs.forEach((o=>o(r))),this._afterNextRenderCbs=null,this.tickedBeforeRender=!1},this.afterTickCb=()=>{this.tickedBeforeRender=!0,this.state!=="rendering"&&this.renderNextFrame()},this.params=t,this.theme=new Mc,this.hooks={beforeRender:new yn(["stage"]),afterRender:new yn(["stage"]),afterClearScreen:new yn(["stage"]),afterClearRect:new yn(["stage"])},this.global=mt.global,!this.global.env&&xx()&&this.global.setEnv("browser"),this.window=Et.get(Ac),this.renderService=Et.get(ex),this.pluginService=Et.get(VI),this.layerService=Et.get(vx),this.graphicService=Et.get(gx),this.pluginService.active(this,t),this._beforeRenderList=[],this._afterRenderList=[],this.window.create({width:t.width,height:t.height,viewBox:t.viewBox,container:t.container,dpr:t.dpr||this.global.devicePixelRatio,canvasControled:t.canvasControled!==!1,title:t.title||"",canvas:t.canvas}),this.state="normal",this.renderCount=0,this.tryInitEventSystem(),this._background=(e=t.background)!==null&&e!==void 0?e:xT.BACKGROUND,this.appendChild(this.layerService.createLayer(this,{main:!0})),this.nextFrameRenderLayerSet=new Set,this.willNextFrameRender=!1,this.stage=this,this.renderStyle=t.renderStyle,t.autoRender&&this.enableAutoRender(),t.autoRefresh&&this.enableAutoRefresh(),t.disableDirtyBounds===!1&&this.enableDirtyBounds(),t.enableHtmlAttribute&&this.enableHtmlAttribute(t.enableHtmlAttribute),t.ReactDOM&&this.enableReactAttribute(t.ReactDOM),t.enableLayout&&this.enableLayout(),this.hooks.beforeRender.tap("constructor",this.beforeRender),this.hooks.afterRender.tap("constructor",this.afterRender),t.beforeRender&&this._beforeRenderList.push(t.beforeRender),t.afterRender&&this._afterRenderList.push(t.afterRender),this.hooks.afterClearScreen.tap("constructor",this.afterClearScreen),this.hooks.afterClearRect.tap("constructor",this.afterClearRect),this._afterClearScreen=t.afterClearScreen,this._afterClearRect=t.afterClearRect,this.supportInteractiveLayer=t.interactiveLayer!==!1,t.optimize||(t.optimize={tickRenderMode:"effect"}),this.optmize(t.optimize),t.background&&Oo(this._background)&&this._background.includes("/")&&this.setAttributes({background:this._background}),this.initAnimate(t),this.rafId=(i=t.rafId)!==null&&i!==void 0?i:Math.floor(6*Math.random())}initAnimate(t){var e;this.createTicker&&this.createTimeline&&(this._ticker=t.ticker||this.createTicker(this),this._ticker.bindStage(this),((e=this.params.optimize)===null||e===void 0?void 0:e.tickRenderMode)==="performance"&&this._ticker.setFPS(30),this.timeline=this.createTimeline(),this._ticker.addTimeline(this.timeline),this._ticker.on("tick",this.afterTickCb))}startAnimate(){this._ticker&&this.timeline&&(this._ticker.start(),this.timeline.resume())}pauseRender(t=-1){this._skipRender=t}resumeRender(){this._skipRender=0}tryInitEventSystem(){this.global.supportEvent&&!this._eventSystem&&(this._eventSystem=new aU(Object.assign({targetElement:this.window,resolution:this.window.dpr||this.global.devicePixelRatio,rootNode:this,global:this.global,supportsPointerEvents:this.params.supportsPointerEvents,supportsTouchEvents:this.params.supportsTouchEvents},this.params.event)))}preventRender(t){t?this._skipRender=-1/0:this.params.optimize.skipRenderWithOutRange!==!1?this._skipRender=this.window.isVisible()?0:1:this._skipRender=0}optmize(t){this.optmizeRender(t.skipRenderWithOutRange),this.params.optimize=t}optmizeRender(t=!1){t&&(this._skipRender=this._skipRender<0?this._skipRender:this.window.isVisible()?0:1,this.window.onVisibleChange(this._onVisibleChange))}getTimeline(){return this.timeline}get3dOptions(t){const{center:e={x:this.width/2,y:this.height/2,z:0,dx:0,dy:0,dz:0},light:i={},alpha:r=0,beta:o=0,camera:s,fieldRatio:a=1,fieldDepth:l}=t;return Object.assign(Object.assign({},t),{center:e,light:i,alpha:r,beta:o,camera:s,fieldRatio:a,fieldDepth:l})}set3dOptions(t){var e,i,r,o,s,a;this.option3d=t;const l=this.get3dOptions(t),{light:h,center:u,camera:d,alpha:c,beta:g,fieldRatio:f,fieldDepth:p}=l,{dir:m=[1,1,-1],color:v="white",ambient:b}=h,y=((e=u.x)!==null&&e!==void 0?e:this.width/2)+((i=u.dx)!==null&&i!==void 0?i:0),C=((r=u.y)!==null&&r!==void 0?r:this.height/2)+((o=u.dy)!==null&&o!==void 0?o:0),w=[y,C,((s=u.z)!==null&&s!==void 0?s:0)+((a=u.dz)!==null&&a!==void 0?a:0)];let _=0,A=0,x=0;d||(_=Math.sin(c)+y,A=Math.sin(g)+C,x=Math.cos(c)*Math.cos(g)*1);const S=Xs.getPlugin("DirectionalLight");S&&(this.light=new S(m,v,b));const T={left:0,right:this.width,top:0,bottom:this.height,fieldRatio:f,fieldDepth:p,viewParams:{pos:[_,A,x],center:w,up:[0,1,0]}};if(this.camera)this.camera.params=T;else{const M=Xs.getPlugin("OrthoCamera");M&&(this.camera=new M(T))}t.enableView3dTransform&&this.enableView3dTransform()}setBeforeRender(t){this._beforeRenderList.push(t)}removeBeforeRender(t){this._beforeRenderList=this._beforeRenderList.filter((e=>e!==t))}setAfterRender(t){this._afterRenderList.push(t)}removeAfterRender(t){this._afterRenderList=this._afterRenderList.filter((e=>e!==t))}afterNextRender(t){this._afterNextRenderCbs||(this._afterNextRenderCbs=[]),this._afterNextRenderCbs.push(t)}enableView3dTransform(){if(this.view3dTranform)return;this.view3dTranform=!0;const t=Xs.getPlugin("ViewTransform3dPlugin");t&&this.pluginService.register(new t)}disableView3dTranform(){this.view3dTranform&&(this.view3dTranform=!1,this.pluginService.findPluginsByName("ViewTransform3dPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableAutoRender(){this.autoRender||(this.autoRender=!0,this.pluginService.register(new nK))}disableAutoRender(){this.autoRender&&(this.autoRender=!1,this.pluginService.findPluginsByName("AutoRenderPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableAutoRefresh(){this.autoRefresh||(this.autoRefresh=!0,this.pluginService.register(new rK))}disableAutoRefresh(){this.autoRefresh&&(this.autoRefresh=!1,this.pluginService.findPluginsByName("AutoRefreshPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableIncrementalAutoRender(){this.increaseAutoRender||(this.increaseAutoRender=!0,this.pluginService.register(new oK))}disableIncrementalAutoRender(){this.increaseAutoRender&&(this.increaseAutoRender=!1,this.pluginService.findPluginsByName("IncrementalAutoRenderPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableDirtyBounds(){if(this.dirtyBounds)return;this.dirtyBounds=new Cc;let t=this.pluginService.findPluginsByName("DirtyBoundsPlugin")[0];t?t.activate(this.pluginService):(t=new sK,this.pluginService.register(t))}disableDirtyBounds(){this.dirtyBounds&&(this.dirtyBounds=null,this.pluginService.findPluginsByName("DirtyBoundsPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableLayout(){if(this._enableLayout)return;this._enableLayout=!0;const t=Xs.getPlugin("FlexLayoutPlugin");t&&this.pluginService.register(new t)}disableLayout(){this._enableLayout&&(this._enableLayout=!1,this.pluginService.findPluginsByName("FlexLayoutPlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableHtmlAttribute(t){if(this.htmlAttribute)return;const e=Xs.getPlugin("HtmlAttributePlugin");e&&(this.htmlAttribute=t,this.pluginService.register(new e))}disableHtmlAttribute(){this.htmlAttribute&&(this.htmlAttribute=!1,this.pluginService.findPluginsByName("HtmlAttributePlugin").forEach((t=>{this.pluginService.unRegister(t)})))}enableReactAttribute(t){if(this.reactAttribute)return;const e=Xs.getPlugin("ReactAttributePlugin");e&&(this.reactAttribute=t,this.pluginService.register(new e))}disableReactAttribute(){this.reactAttribute&&(this.reactAttribute=!1,this.pluginService.findPluginsByName("ReactAttributePlugin").forEach((t=>{this.pluginService.unRegister(t)})))}getPluginsByName(t){return this.pluginService.findPluginsByName(t)}tryUpdateAABBBounds(){const t=this.window.getViewBox();return this._AABBBounds.setValue(t.x1,t.y1,t.x2,t.y2),this._AABBBounds}combineLayer(t,e){throw new Error("暂不支持")}createLayer(t,e){if(this.releaseStatus==="released")return;const i=this.layerService.createLayer(this,{main:!1,layerMode:e,canvasId:t});return this.appendChild(i),i}sortLayer(t){const e=this.children;e.sort(t),this.removeAllChild(),e.forEach((i=>{this.appendChild(i)}))}removeLayer(t){return this.removeChild(this.findChildByUid(t))}tryInitInteractiveLayer(){this.releaseStatus!=="released"&&this.supportInteractiveLayer&&!this.interactiveLayer&&(this.interactiveLayer=this.createLayer(),this.interactiveLayer.name="_builtin_interactive",this.interactiveLayer.attribute.pickable=!1,this.nextFrameRenderLayerSet.add(this.interactiveLayer))}clearViewBox(t){this.window.clearViewBox(t)}render(t,e){if(this.releaseStatus==="released")return;this.startAnimate();const i=this.state;this.state="rendering",this.layerService.prepareStageLayer(this),this._skipRender||(this.lastRenderparams=e,this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(this.children),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=i,this._skipRender&&this._skipRender++}combineLayersToWindow(){if(this.global.env==="harmony"){const t=this.window.getContext().nativeContext;this.forEachChildren(((e,i)=>{if(i>0){const r=e.getNativeHandler().getContext().canvas.nativeCanvas.nativeCanvas._c.transferToImageBitmap();t.transferFromImageBitmap(r)}}))}}renderNextFrame(t,e){this.nextFrameRenderLayerSet.size!==this.childrenCount&&(t||this).forEach((i=>{this.nextFrameRenderLayerSet.add(i)})),this.willNextFrameRender||(this.willNextFrameRender=!0,this.global.getSpecifiedRequestAnimationFrame(this.rafId)((()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1})))}_doRenderInThisFrame(){if(this.releaseStatus==="released")return;this.startAnimate();const t=this.state;this.state="rendering",this.layerService.prepareStageLayer(this),this.nextFrameRenderLayerSet.size&&!this._skipRender&&(this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(Array.from(this.nextFrameRenderLayerSet.values()),this.lastRenderparams||{}),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=t,this._skipRender&&this._skipRender++}renderLayerList(t,e){const i=[];for(let r=0;r<t.length;r++){let o=t[r];o.layerMode==="virtual"&&(o=o.getNativeHandler().mainHandler.layer),i.includes(o)||i.push(o)}i.forEach((r=>{r.renderCount>this.renderCount||(r.renderCount=this.renderCount+1,r===this.interactiveLayer&&this.dirtyBounds&&this.dirtyBounds.clear(),r.render({renderService:this.renderService,background:r===this.defaultLayer?this.background:void 0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))})),this.interactiveLayer&&!t.includes(this.interactiveLayer)&&(this.dirtyBounds&&this.dirtyBounds.clear(),this.interactiveLayer.render({renderService:this.renderService,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))}resizeWindow(t,e,i=!0){this.window.resize(t,e),i&&this.render()}resize(t,e,i=!0){this.releaseStatus!=="released"&&(this.window.hasSubView()||this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.window.resize(t,e),this.forEachChildren((r=>{r.resize(t,e)})),this.camera&&this.option3d&&this.set3dOptions(this.option3d),i&&this.render())}resizeView(t,e,i=!0){this.releaseStatus!=="released"&&(this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.forEachChildren((r=>{r.resizeView(t,e)})),this.camera&&(this.camera.params=Object.assign(Object.assign({},this.camera.params),{right:this.width,bottom:this.height})),i&&this.render())}setViewBox(t,e,i,r,o){let s=!0;typeof t=="object"?(this.viewBox.setValue(t.x1,t.y1,t.x2,t.y2),e===!1&&(s=!1)):(this.viewBox.setValue(t,e,t+i,e+r),o===!1&&(s=!1)),this.forEachChildren((a=>{a.resizeView(this.viewBox.width(),this.viewBox.height())})),s&&this.render()}setDpr(t,e=!0){this.forEachChildren((i=>{i.setDpr(t)})),e&&this.render()}setOrigin(t,e){throw new Error("暂不支持")}export(t){throw new Error("暂不支持")}pick(t,e){if(this.releaseStatus==="released")return;const i=this.getPickerService().pick(this.children,new Te(t,e),{bounds:this.AABBBounds});return!(!i?.graphic&&!i?.group)&&i}setToFrame(t){throw new Error("暂不支持")}release(){var t,e;super.release(),this.hooks.beforeRender.unTap("constructor",this.beforeRender),this.hooks.afterRender.unTap("constructor",this.afterRender),this.eventSystem&&this.eventSystem.release(),this.layerService.releaseStage(this),this.pluginService.release(),this.forEach((i=>{i.release()})),this.interactiveLayer&&(this.interactiveLayer.forEachChildren((i=>{i.setStage&&i.setStage(null,null),this.interactiveLayer.removeChild(i)})),this.interactiveLayer.release()),this.window.release(),(t=this._ticker)===null||t===void 0||t.remTimeline(this==null?void 0:this.timeline),(e=this._ticker)===null||e===void 0||e.removeListener("tick",this.afterTickCb),this.renderService.renderTreeRoots=[]}setStage(t){}dirty(t,e){this.releaseStatus!=="released"&&(e&&t.transformWithMatrix(e),this.dirtyBounds.empty()&&this.dirtyBounds.setValue(t.x1,t.y1,t.x2,t.y2),this.dirtyBounds.union(t))}getLayer(t){return this.children.filter((e=>e.name===t))[0]}renderTo(t){this.releaseStatus!=="released"&&this.forEachChildren(((e,i)=>{e.drawTo(t,{renderService:this.renderService,viewBox:t.getViewBox(),transMatrix:t.getViewBoxTransform(),background:e===this.defaultLayer?this.background:void 0,clear:i===0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty())})}))}renderToNewWindow(t=!0,e){if(this.releaseStatus==="released")return;const i=Et.get(Ac),r=e?-e.x1:0,o=e?-e.y1:0,s=e?e.x2:this.viewWidth,a=e?e.y2:this.viewHeight,l=e?e.width():this.viewWidth,h=e?e.height():this.viewHeight;return i.create({viewBox:{x1:r,y1:o,x2:s,y2:a},width:l,height:h,dpr:this.window.dpr,canvasControled:!0,offscreen:!0,title:""}),this.renderTo(i),i}toCanvas(t=!0,e){if(this.releaseStatus==="released")return;const i=this.renderToNewWindow(t,e).getNativeHandler();return i.nativeCanvas?i.nativeCanvas:null}setCursor(t){this._cursor=t,this.eventSystem.setCursor(t,"ignore")}getCursor(){return this._cursor}eventPointTransform(t){const e=this.global.mapToCanvasPoint(t,this.window);return this.stage.window.pointTransform(e.x,e.y)}pauseTriggerEvent(){this._eventSystem&&this._eventSystem.pauseTriggerEvent()}resumeTriggerEvent(){this._eventSystem&&this._eventSystem.resumeTriggerEvent()}getPickerService(){return this.pickerService||(this.pickerService=Et.get(Eh)),this.pickerService}reInit(){this.renderService.reInit(),this.pickerService.reInit()}}function XI(n){return new lK(n)}var hK=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},uK=function(n,t,e,i){return new(e||(e=Promise))((function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e((function(d){d(u)}))).then(s,a)}l((i=i.apply(n,t||[])).next())}))};let a0=class{configure(n,...t){n.env===this.type&&n.setActiveEnvContribution(this)}getNativeAABBBounds(n){return new Zi}removeDom(n){return!1}createDom(n){return null}updateDom(n,t){return!1}getDynamicCanvasCount(){return 999}getStaticCanvasCount(){return 999}getElementById(n){return document.getElementById(n)}getRootElement(){return document.body}loadJson(n){const t=fetch(n).then((e=>e.json()));return t.then((e=>({data:e,state:"success"}))).catch((()=>({data:null,state:"fail"}))),t}loadArrayBuffer(n){return fetch(n).then((t=>t.arrayBuffer())).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}loadBlob(n){return fetch(n).then((t=>t.blob())).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}getElementTop(n,t){return 0}getElementLeft(n,t){return 0}getElementTopLeft(n,t){return{top:0,left:0}}loadFont(n,t,e){return uK(this,void 0,void 0,(function*(){return{loadState:"fail"}}))}isMacOS(){return!1}copyToClipBoard(n){return Promise.resolve(null)}};a0=hK([pt()],a0);var dK=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},cK=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let l0=class{constructor(){this._uid=Ci.GenAutoIncrementId(),this.viewBox=new Zi,this.modelMatrix=new wn(1,0,0,1,0,0)}onChange(n){this._onChangeCb=n}configure(n,t){t.env===this.type&&n.setWindowHandler(this)}release(...n){this.releaseWindow()}isVisible(n){return!0}onVisibleChange(n){}getTopLeft(n){return{top:0,left:0}}setViewBox(n){this.viewBox.setValue(n.x1,n.y1,n.x2,n.y2)}getViewBox(){return this.viewBox}setViewBoxTransform(n,t,e,i,r,o){this.modelMatrix.setValue(n,t,e,i,r,o)}getViewBoxTransform(){return this.modelMatrix}};l0=dK([pt(),cK("design:paramtypes",[])],l0);var gK=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},fK=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},of=function(n,t){return function(e,i){t(e,i,n)}};let dw=class{constructor(n,t){this.pickItemInterceptorContributions=n,this.pickServiceInterceptorContributions=t,this.type="default",this.global=mt.global}reInit(){this._init()}_init(){this.InterceptorContributions=this.pickItemInterceptorContributions.getContributions().sort(((n,t)=>n.order-t.order)),this.pickerServiceInterceptorContributions=this.pickServiceInterceptorContributions.getContributions().sort(((n,t)=>n.order-t.order))}pick(n,t,e){let i={graphic:null,group:null};e.pickerService=this;const r=e.bounds.width(),o=e.bounds.height();if(!new Zi().setValue(0,0,r,o).containsPoint(t))return i;this.pickContext&&(this.pickContext.inuse=!0),e.pickContext=this.pickContext,this.pickContext&&this.pickContext.clearMatrix(!0,1);const s=new wn(1,0,0,1,0,0);let a;for(let l=n.length-1;l>=0&&(i=n[l].isContainer?this.pickGroup(n[l],t,s,e):this.pickItem(n[l],t,s,e),!i.graphic);l--)a||(a=i.group);if(i.graphic||(i.group=a),this.pickContext&&(this.pickContext.inuse=!1),this.pickerServiceInterceptorContributions.length)for(let l=0;l<this.pickerServiceInterceptorContributions.length;l++){const h=this.pickerServiceInterceptorContributions[l];h.afterPickItem&&(i=h.afterPickItem(i,this,t,e,{parentMatrix:s}))}return i}containsPoint(n,t,e){var i;return!!(!((i=this.pickItem(n,t,null,e??{pickContext:this.pickContext,pickerService:this}))===null||i===void 0)&&i.graphic)}pickGroup(n,t,e,i){let r={group:null,graphic:null};if(n.attribute.visibleAll===!1)return r;const o=i.pickContext,s=o.modelMatrix;if(o.camera){const g=n.transMatrix,f=Bi.allocate();if(I_(f,g),s){if(f){const p=Bi.allocate();o.modelMatrix=hg(p,s,f),Bi.free(f)}}else I_(f,n.globalTransMatrix),o.modelMatrix=f}if(this.InterceptorContributions.length)for(let g=0;g<this.InterceptorContributions.length;g++){const f=this.InterceptorContributions[g];if(f.beforePickItem){const p=f.beforePickItem(n,this,t,i,{parentMatrix:e});if(p)return o.modelMatrix!==s&&Bi.free(o.modelMatrix),o.modelMatrix=s,p}}const a=n.transMatrix,l=Ki.allocateByObj(e),h=new Te(t.x,t.y);l.transformPoint(h,h);const u=n.AABBBounds.containsPoint(h);if(!u&&!n.stage.camera)return r;const d=this.pickItem(n,h.clone(),e,i);d&&d.graphic&&(r.graphic=d.graphic,r.params=d.params);const c=n.attribute.pickable!==!1&&u;return l.multiply(a.a,a.b,a.c,a.d,a.e,a.f),n.attribute.childrenPickable===!1||d&&d.graphic||$I(n,ei.zIndex,(g=>{if(g.isContainer){const f=new Te(t.x,t.y),p=Wt(n).group,{scrollX:m=p.scrollX,scrollY:v=p.scrollY}=n.attribute;f.x-=m,f.y-=v,r=this.pickGroup(g,f,l,i)}else{const f=new Te(t.x,t.y);l.transformPoint(f,f);const p=Wt(n).group,{scrollX:m=p.scrollX,scrollY:v=p.scrollY}=n.attribute;f.x-=m,f.y-=v;const b=this.pickItem(g,f,e,i);b&&b.graphic&&(r.graphic=b.graphic,r.params=b.params)}return!!r.graphic||!!r.group}),!0,!!o.camera),o.modelMatrix!==s&&Bi.free(o.modelMatrix),o.modelMatrix=s,r.graphic||r.group||!c||n.stage.camera||(r.group=n),Ki.free(l),r}selectPicker(n){return this.pickerMap.get(n.numberType)||null}};dw=gK([pt(),of(0,Xt(li)),of(0,Li(vh)),of(1,Xt(li)),of(1,Li(Qp)),fK("design:paramtypes",[Object,Object])],dw);function pK(n,t,e){const i={};for(const r in t)r in n&&S_(n[r],t[r])||(i[r]=t[r]);return i}let ST=!1;const mK=new Ot((n=>{ST||(ST=!0,n(Fp).toSelf().inSingletonScope(),n($p).to(Fp).inSingletonScope(),n(Ln).toService($p),n(N_).toService(so),cn(n,N_))}));let AT=!1;const vK=new Ot((n=>{AT||(AT=!0,n(jp).toSelf().inSingletonScope(),n(Kp).to(jp).inSingletonScope(),n(Ln).toService(Kp),n(wu).toSelf(),n(_u).toSelf(),n(ul).toService(wu),n(ul).toService(_u),n(ul).toService(so),cn(n,ul))}));let MT=!1;const bK=new Ot((n=>{MT||(MT=!0,n(Pc).toSelf().inSingletonScope(),n(s0).toSelf().inSingletonScope(),n(Xp).to(Pc).inSingletonScope(),n(Ln).toService(Xp))}));let TT=!1;const yK=new Ot((n=>{TT||(TT=!0,n(Vp).toSelf().inSingletonScope(),n(Zp).to(Vp).inSingletonScope(),n(Ln).toService(Zp),n(G_).toService(so),cn(n,G_))}));let RT=!1;const CK=new Ot((n=>{RT||(RT=!0,n(zp).toSelf().inSingletonScope(),n(Up).to(zp).inSingletonScope(),n(Ln).toService(Up),n(W_).toService(so),cn(n,W_))}));let BT=!1;const _K=new Ot((n=>{BT||(BT=!0,n(nw).to(Q_).inSingletonScope(),n(Ln).toService(nw),n(Hp).toService(so),cn(n,Hp))}));let kT=!1;const wK=new Ot((n=>{kT||(kT=!0,n(Wp).toSelf().inSingletonScope(),n(Yp).to(Wp).inSingletonScope(),n(Ln).toService(Yp),n(j_).toService(so),cn(n,j_))}));let PT=!1;const xK=new Ot((n=>{PT||(PT=!0,n(qp).to(tw).inSingletonScope(),n(Ln).toService(qp),n(V_).toService(so),cn(n,V_))}));var SK=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},AK=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let cw=class extends Gn{constructor(){super(),this.numberType=cx,this.builtinContributions=[zI],this.init()}drawShape(n,t,e,i,r){const o=Wt(n).richtext,{strokeOpacity:s=o.strokeOpacity,opacity:a=o.opacity,fillOpacity:l=o.fillOpacity,visible:h=o.visible}=n.attribute;if(!n.valid||!h)return;const u=Hl(a,l,!0),d=Hl(a,s,!0);u&&(t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,o),t.translate(e,i),this.beforeRenderStep(n,t,e,i,u,d,u,d,o,r),n.getFrameCache().draw(t,this.drawIcon),this.afterRenderStep(n,t,e,i,u,d,u,d,o,r))}drawIcon(n,t,e,i,r){var o;const s=Wt(n).richtextIcon,{width:a=s.width,height:l=s.height,opacity:h=s.opacity,image:u,backgroundFill:d=s.backgroundFill,backgroundFillOpacity:c=s.backgroundFillOpacity,backgroundStroke:g=s.backgroundStroke,backgroundStrokeOpacity:f=s.backgroundStrokeOpacity,backgroundRadius:p=s.backgroundRadius,margin:m}=n.attribute,{backgroundWidth:v=a,backgroundHeight:b=l}=n.attribute;if(m&&(e+=n._marginArray[3],i+=n._marginArray[0]),n._hovered){const C=(v-a)/2,w=(b-l)/2;p===0?(t.beginPath(),t.rect(e-C,i-w,v,b)):(t.beginPath(),Vo(t,e-C,i-w,v,b,p,!0)),d&&(t.globalAlpha=c,t.fillStyle=d,t.fill()),g&&(t.globalAlpha=f,t.strokeStyle=g,t.stroke())}const y=u&&((o=n?.resources)===null||o===void 0?void 0:o.get(u));y&&y.state==="success"&&(t.globalAlpha=h,t.drawImage(y.data,e,i,a,l))}draw(n,t,e){const i=Wt(n).richtext;this._draw(n,i,!1,e)}};cw=SK([pt(),AK("design:paramtypes",[])],cw);let ET=!1;const MK=new Ot((n=>{ET||(ET=!0,n(rw).to(cw).inSingletonScope(),n(Ln).toService(rw))}));let LT=!1;const TK=new Ot((n=>{LT||(LT=!0,n(ow).to(iw).inSingletonScope(),n(Ln).toService(ow),n(hl).toService(so),cn(n,hl))}));function RK(){At.RegisterGraphicCreator("arc",Dp)}function BK(){At.RegisterGraphicCreator("circle",LI)}function kK(){At.RegisterGraphicCreator("group",Ip)}function PK(){At.RegisterGraphicCreator("image",mv)}function EK(){At.RegisterGraphicCreator("line",Ke)}function LK(){At.RegisterGraphicCreator("path",lY)}function OK(){At.RegisterGraphicCreator("polygon",II)}function IK(){At.RegisterGraphicCreator("rect",be)}function HK(){At.RegisterGraphicCreator("richtext",aY)}function DK(){At.RegisterGraphicCreator("symbol",yu)}function FK(){At.RegisterGraphicCreator("text",Bc)}function zK(){At.RegisterGraphicCreator("shadowRoot",uY)}function NK(){At.RegisterGraphicCreator("wrapText",tY)}const OT=new Zi;class WK{constructor(){this.name="FlexLayoutPlugin",this.activeEvent="onRegister",this.id=Ci.GenAutoIncrementId(),this.key=this.name+this.id,this.tempBounds=new Zi}pauseLayout(t){this.pause=t}tryLayoutChildren(t){t.firstChild&&this.tryLayout(t.firstChild)}tryLayout(t,e=!0){if(this.pause)return;const i=t.parent;if(!(e||i&&t.needUpdateLayout()))return;const r=Wt(i).group,{display:o=r.display}=i.attribute;if(o!=="flex")return;const{flexDirection:s=r.flexDirection,flexWrap:a=r.flexWrap,alignItems:l=r.alignItems,clip:h=r.clip}=i.attribute,{alignContent:u=l??r.alignContent}=i.attribute;let{width:d,height:c,justifyContent:g=r.justifyContent}=i.attribute;const f=i.getChildren();if(d==null||c==null){let x=0,S=0,T=0;if(f.forEach((M=>{const R=this.getAABBBounds(M);R.empty()||(s==="column"||s==="column-reverse"?(S+=R.height(),x=Math.max(x,R.width())):(x+=R.width(),S=Math.max(S,R.height())),T+=R.x1,T+=R.y1,T+=R.x2,T+=R.y2)})),!isFinite(T))return;d=x,c=S}i.attribute.width==null?i.attribute.width=d:d=i.attribute.width,i.attribute.height==null?i.attribute.height=c:c=i.attribute.height,this.tempBounds.copy(i._AABBBounds);const p={main:{len:d,field:"x"},cross:{len:c,field:"y"}},m=p.main,v=p.cross;s!=="column"&&s!=="column-reverse"||(m.len=c,v.len=d,m.field="y",v.field="x"),s!=="row-reverse"&&s!=="column-reverse"||(g==="flex-start"?g="flex-end":g==="flex-end"?g="flex-start":f.reverse());let b=0,y=0;const C=[];f.forEach((x=>{const S=this.getAABBBounds(x);if(S.empty())return;const T=m.field==="x"?S.width():S.height(),M=v.field==="x"?S.width():S.height();C.push({mainLen:T,crossLen:M}),b+=T,y=Math.max(y,M)}));const w=[];if(b>m.len&&a==="wrap"){let x=0,S=0;C.forEach((({mainLen:T,crossLen:M},R)=>{x+T>m.len?x===0?(w.push({idx:R,mainLen:x+T,crossLen:M}),x=0,S=0):(w.push({idx:R-1,mainLen:x,crossLen:S}),x=T,S=M):(x+=T,S=Math.max(S,M))})),w.push({idx:C.length-1,mainLen:x,crossLen:S})}else w.push({idx:C.length-1,mainLen:b,crossLen:y});let _=0;if(w.forEach((x=>{this.layoutMain(i,f,g,m,C,_,x),_=x.idx+1})),y=w.reduce(((x,S)=>x+S.crossLen),0),w.length===1){const x={"flex-start":0,"flex-end":v.len,center:v.len/2};this.layoutCross(f,l,v,x,C,w[0],0)}else if(u==="flex-start"){_=0;let x=0;w.forEach(((S,T)=>{const M={"flex-start":x,"flex-end":x+S.crossLen,center:x+S.crossLen/2};this.layoutCross(f,"flex-start",v,M,C,w[T],_),_=S.idx+1,x+=S.crossLen}))}else if(u==="center"){_=0;let x=Math.max(0,(v.len-y)/2);w.forEach(((S,T)=>{const M={"flex-start":x,"flex-end":x+S.crossLen,center:x+S.crossLen/2};this.layoutCross(f,"center",v,M,C,w[T],_),_=S.idx+1,x+=S.crossLen}))}else if(u==="space-around"){_=0;const x=Math.max(0,(v.len-y)/w.length/2);let S=x;w.forEach(((T,M)=>{const R={"flex-start":S,"flex-end":S+T.crossLen,center:S+T.crossLen/2};this.layoutCross(f,"flex-start",v,R,C,w[M],_),_=T.idx+1,S+=T.crossLen+2*x}))}else if(u==="space-between"){_=0;const x=Math.max(0,(v.len-y)/(2*w.length-2));let S=0;w.forEach(((T,M)=>{const R={"flex-start":S,"flex-end":S+T.crossLen,center:S+T.crossLen/2};this.layoutCross(f,"flex-start",v,R,C,w[M],_),_=T.idx+1,S+=T.crossLen+2*x}))}f.forEach(((x,S)=>{x.addUpdateBoundTag(),x.addUpdatePositionTag(),x.clearUpdateLayoutTag()})),i.addUpdateLayoutTag();const A=this.getAABBBounds(i);h||this.tempBounds.equals(A)||this.tryLayout(i,!1)}getAABBBounds(t){this.skipBoundsTrigger=!0;const e=t.AABBBounds;return this.skipBoundsTrigger=!1,e}updateChildPos(t,e,i){return t+(e??0)-i}layoutMain(t,e,i,r,o,s,a){if(i==="flex-start"){let l=0;for(let h=s;h<=a.idx;h++){const u=l+bo(e[h],r.field),d=this.getAABBBounds(e[h]);!d.empty()&&(e[h].attribute[r.field]=this.updateChildPos(u,e[h].attribute[r.field],d[`${r.field}1`])),l+=o[h].mainLen}}else if(i==="flex-end"){let l=r.len;for(let h=a.idx;h>=s;h--){l-=o[h].mainLen;const u=l+bo(e[h],r.field),d=this.getAABBBounds(e[h]);!d.empty()&&(e[h].attribute[r.field]=this.updateChildPos(u,e[h].attribute[r.field],d[`${r.field}1`]))}}else if(i==="space-around")if(a.mainLen>=r.len){let l=0;for(let h=s;h<=a.idx;h++){const u=l+bo(e[h],r.field),d=this.getAABBBounds(e[h]);!d.empty()&&(e[h].attribute[r.field]=this.updateChildPos(u,e[h].attribute[r.field],d[`${r.field}1`])),l+=o[h].mainLen}}else{const l=a.idx-s+1,h=(r.len-a.mainLen)/l/2;let u=h;for(let d=s;d<=a.idx;d++){const c=u+bo(e[d],r.field),g=this.getAABBBounds(e[d]);!g.empty()&&(e[d].attribute[r.field]=this.updateChildPos(c,e[d].attribute[r.field],g[`${r.field}1`])),u+=o[d].mainLen+2*h}}else if(i==="space-between")if(a.mainLen>=r.len){let l=0;for(let h=s;h<=a.idx;h++){const u=l+bo(e[h],r.field),d=this.getAABBBounds(e[h]);!d.empty()&&(e[h].attribute[r.field]=this.updateChildPos(u,e[h].attribute[r.field],d[`${r.field}1`])),l+=o[h].mainLen}}else{const l=a.idx-s+1,h=(r.len-a.mainLen)/(2*l-2);let u=0;for(let d=s;d<=a.idx;d++){const c=u+bo(e[d],r.field),g=this.getAABBBounds(e[d]);!g.empty()&&(e[d].attribute[r.field]=this.updateChildPos(c,e[d].attribute[r.field],g[`${r.field}1`])),u+=o[d].mainLen+2*h}}else if(i==="center"){let l=(r.len-a.mainLen)/2;for(let h=s;h<=a.idx;h++){const u=l+bo(e[h],r.field),d=this.getAABBBounds(e[h]);!d.empty()&&(e[h].attribute[r.field]=this.updateChildPos(u,e[h].attribute[r.field],d[`${r.field}1`])),l+=o[h].mainLen}}}layoutCross(t,e,i,r,o,s,a){var l;for(let h=a;h<=s.idx;h++){const u=t[h];let{alignSelf:d}=u.attribute;d&&d!=="auto"||(d=e);const c=this.getAABBBounds(u),g=(l=r[d])!==null&&l!==void 0?l:r["flex-start"];d==="flex-end"?!c.empty()&&(u.attribute[i.field]=this.updateChildPos(g-o[h].crossLen+bo(u,i.field),u.attribute[i.field],c[`${i.field}1`])):d==="center"?!c.empty()&&(u.attribute[i.field]=this.updateChildPos(g-o[h].crossLen/2+bo(u,i.field),u.attribute[i.field],c[`${i.field}1`])):!c.empty()&&(u.attribute[i.field]=this.updateChildPos(g+bo(u,i.field),u.attribute[i.field],c[`${i.field}1`]))}}activate(t){this.pluginService=t;const e=this.pluginService.stage;e&&(e.graphicService.hooks.onAttributeUpdate.tap(this.key,(i=>{i.glyphHost&&(i=i.glyphHost),i.stage&&i.stage===this.pluginService.stage&&this.tryLayout(i,!1)})),e.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,((i,r,o,s)=>{i.glyphHost&&(i=i.glyphHost),r&&r===this.pluginService.stage&&i.isContainer&&!this.skipBoundsTrigger&&OT.copy(s)})),e.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,((i,r,o,s,a)=>{r&&r===this.pluginService.stage&&i.isContainer&&!this.skipBoundsTrigger&&(OT.equals(o)||this.tryLayout(i,!1))})),e.graphicService.hooks.onSetStage.tap(this.key,(i=>{i.glyphHost&&(i=i.glyphHost),this.tryLayout(i,!1)})))}deactivate(t){const e=this.pluginService.stage;e&&(e.graphicService.hooks.onAttributeUpdate.taps=e.graphicService.hooks.onAttributeUpdate.taps.filter((i=>i.name!==this.key)),e.graphicService.hooks.beforeUpdateAABBBounds.taps=e.graphicService.hooks.beforeUpdateAABBBounds.taps.filter((i=>i.name!==this.key)),e.graphicService.hooks.afterUpdateAABBBounds.taps=e.graphicService.hooks.afterUpdateAABBBounds.taps.filter((i=>i.name!==this.key)),e.graphicService.hooks.onSetStage.taps=e.graphicService.hooks.onSetStage.taps.filter((i=>i.name!==this.key)))}}function bo(n,t){return 0}const IT=()=>{Xs.registerPlugin("FlexLayoutPlugin",WK)},Hu=(n,t)=>Object.prototype.toString.call(n)===`[object ${t}]`,h0=(n,t=!1)=>t?typeof n=="boolean":n===!0||n===!1||Hu(n,"Boolean"),ai=n=>typeof n=="function",jt=n=>n==null,_t=n=>n!=null,ao=n=>{const t=typeof n;return n!==null&&t==="object"||t==="function"},jK=n=>typeof n=="object"&&n!==null,zd=function(n){if(!jK(n)||!Hu(n,"Object"))return!1;if(Object.getPrototypeOf(n)===null)return!0;let t=n;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(n)===t},Sx=(n,t=!1)=>{const e=typeof n;return t?e==="string":e==="string"||Hu(n,"String")},_e=n=>Array.isArray?Array.isArray(n):Hu(n,"Array"),Ax=function(n){return n!==null&&typeof n!="function"&&Number.isFinite(n.length)},VK=n=>Hu(n,"Date"),rn=(n,t=!1)=>{const e=typeof n;return t?e==="number":e==="number"||Hu(n,"Number")},pi=n=>rn(n)&&Number.isFinite(n),GK=n=>({}).toString.call(n).replace(/^\[object /,"").replace(/]$/,""),$K=Object.prototype,UK=function(n){const t=n&&n.constructor;return n===(typeof t=="function"&&t.prototype||$K)},XK=Object.prototype.hasOwnProperty;function Re(n){if(jt(n))return!0;if(Ax(n))return!n.length;const t=GK(n);if(t==="Map"||t==="Set")return!n.size;if(UK(n))return!Object.keys(n).length;for(const e in n)if(XK.call(n,e))return!1;return!0}const Bn=(n,t,e)=>{const i=Sx(t)?t.split("."):t;for(let r=0;r<i.length;r++)n=n?n[i[r]]:void 0;return n===void 0?e:n};function YI(n,t,e){let i;if(!_t(n)||typeof n!="object"||t)return n;const r=_e(n),o=n.length;i=r?new Array(o):typeof n=="object"?{}:h0(n)||rn(n)||Sx(n)?n:VK(n)?new Date(+n):void 0;const s=r?void 0:Object.keys(Object(n));let a=-1;if(i)for(;++a<(s||n).length;){const l=s?s[a]:a,h=n[l];i[l]=YI(h,t)}return i}function qI(n,t,e=!1,i=!1){if(t){if(n===t)return;if(_t(t)&&typeof t=="object"){const r=Object(t),o=[];for(const l in r)o.push(l);let{length:s}=o,a=-1;for(;s--;){const l=o[++a];!_t(r[l])||typeof r[l]!="object"||i&&_e(n[l])?KI(n,l,r[l]):YK(n,t,l,e,i)}}}}function YK(n,t,e,i=!1,r=!1){const o=n[e],s=t[e];let a=t[e],l=!0;if(_e(s)){if(i)a=[];else if(_e(o))a=o;else if(Ax(o)){a=new Array(o.length);let h=-1;const u=o.length;for(;++h<u;)a[h]=o[h]}}else zd(s)?(a=o??{},typeof o!="function"&&typeof o=="object"||(a={})):l=!1;l&&qI(a,s,i,r),KI(n,e,a)}function KI(n,t,e){(e!==void 0&&!qK(n[t],e)||e===void 0&&!(t in n))&&(n[t]=e)}function qK(n,t){return n===t||Number.isNaN(n)&&Number.isNaN(t)}function Lt(n,...t){let e=-1;const i=t.length;for(;++e<i;)qI(n,t[e],!0);return n}function KK(n){if(!n)return[];if(Object.keys)return Object.keys(n);const t=[];for(const e in n)n.hasOwnProperty(e)&&t.push(e);return t}function ZK(n,t,e){const i=KK(t);for(let r=0;r<i.length;r++){const o=i[r];(e?t[o]!=null:n[o]==null)&&(n[o]=t[o])}return n}function JK(n,t,e=!0){if(n="prototype"in n?n.prototype:n,t="prototype"in t?t.prototype:t,Object.getOwnPropertyNames){const i=Object.getOwnPropertyNames(t);for(let r=0;r<i.length;r++){const o=i[r];o!=="constructor"&&(e?t[o]!=null:n[o]==null)&&(n[o]=t[o])}}else ZK(n,t,e)}function u0(n){return _t(n)?_e(n)?n:[n]:[]}function yh(n){if(Ax(n))return n[n.length-1]}const ZI=(n,t)=>{var e;if(n.length===0)return;let i=n[0];for(let r=1;r<n.length;r++){const o=n[r];((e=void 0)!==null&&e!==void 0?e:o-i)>0&&(i=o)}return i},Mx=(n,t)=>{var e;if(n.length===0)return;let i=n[0];for(let r=1;r<n.length;r++){const o=n[r];((e=void 0)!==null&&e!==void 0?e:o-i)<0&&(i=o)}return i};function gw(n){if(!_e(n))return[n];const t=[];for(const e of n)t.push(...gw(e));return t}function QK(n,t,e){_t(t)||(t=n,n=0),_t(e)||(e=1);let i=-1;const r=0|Math.max(0,Math.ceil((t-n)/e)),o=new Array(r);for(;++i<r;)o[i]=n+i*e;return o}function tZ(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function eZ(n){return Number(n)}function iZ(n,t,e=0,i){for(jt(i)&&(i=n.length);e<i;){const r=e+i>>>1;tZ(n[r],t)>0?i=r:e=r+1}return e}const nZ=(n,t,e)=>{let i=n,r=t;for(;i<r;){const o=Math.floor((i+r)/2);e(o)>=0?r=o:i=o+1}return i},rZ=1e-10,oZ=1e-10;function cl(n,t,e=oZ,i=rZ){const r=i,o=e*Math.max(n,t);return Math.abs(n-t)<=Math.max(r,o)}const JI=n=>{let t=null,e=null;return(...i)=>(t&&i.every(((r,o)=>r===t[o]))||(t=i,e=n(...i)),e)},Qn=function(n,t,e){return n<t?t:n>e?e:n},za=(n,t,e)=>{let[i,r]=n;r<i&&(i=n[1],r=n[0]);const o=r-i;return o>=e-t?[t,e]:(i=Math.min(Math.max(i,t),e-o),[i,i+o])};function sZ(n,t){let e;return n>t&&(e=n,n=t,t=e),i=>Math.max(n,Math.min(t,i))}let d0=!1;try{d0=typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"}catch{d0=!1}function QI(n,t,e){let i,r,o,s,a,l,h=0,u=!1,d=!1,c=!0;const g=!t&&t!==0&&d0;if(typeof n!="function")throw new TypeError("Expected a function");function f(C){const w=i,_=r;return i=r=void 0,h=C,s=n.apply(_,w),s}function p(C,w){return g?(cancelAnimationFrame(a),requestAnimationFrame(C)):setTimeout(C,w)}function m(C){const w=C-l;return l===void 0||w>=t||w<0||d&&C-h>=o}function v(){const C=Date.now();if(m(C))return b(C);a=p(v,(function(w){const _=w-h,A=t-(w-l);return d?Math.min(A,o-_):A})(C))}function b(C){return a=void 0,c&&i?f(C):(i=r=void 0,s)}function y(...C){const w=Date.now(),_=m(w);if(i=C,r=this,l=w,_){if(a===void 0)return(function(A){return h=A,a=p(v,t),u?f(A):s})(l);if(d)return a=p(v,t),f(l)}return a===void 0&&(a=p(v,t)),s}return t=+t||0,ao(e)&&(u=!!e.leading,d="maxWait"in e,d&&(o=Math.max(pi(e.maxWait)?e.maxWait:0,t)),c="trailing"in e?!!e.trailing:c),y.cancel=function(){a!==void 0&&(function(C){if(g)return cancelAnimationFrame(C);clearTimeout(C)})(a),h=0,i=l=r=a=void 0},y.flush=function(){return a===void 0?s:b(Date.now())},y.pending=function(){return a!==void 0},y}d0=!1;function tH(n,t,e){let i=!0,r=!0;if(typeof n!="function")throw new TypeError("Expected a function");return ao(e)&&(i="leading"in e?!!e.leading:i,r="trailing"in e?!!e.trailing:r),QI(n,t,{leading:i,trailing:r,maxWait:t})}function Wf(n,t){return e=>n*(1-e)+t*e}function aZ(n,t){return function(e){return Math.round(n*(1-e)+t*e)}}function lZ(n,t){const e=n.valueOf(),i=t.valueOf(),r=new Date;return o=>(r.setTime(e*(1-o)+i*o),r)}const vr=Math.PI,HT=vr/2,sf=2*Math.PI,DT=Math.abs,af=Math.max,c0=Math.min;function hZ(n,t){return n[0]*t[1]-n[1]*t[0]}function gl(n){return n*(Math.PI/180)}function uZ(n,t,e){return t?{x:n.x+t*Math.cos(e),y:n.y+t*Math.sin(e)}:{x:n.x,y:n.y}}function FT(n){for(;n<0;)n+=2*Math.PI;for(;n>=2*Math.PI;)n-=2*Math.PI;return n}function dZ(n,t,e){if(n===null)return t;if(t===null)return n;const{x11:i,x12:r,y11:o,y12:s,x21:a,x22:l,y21:h,y22:u}=eH(n,t);return i>=l||r<=a||o>=u||s<=h?{x1:0,y1:0,x2:0,y2:0}:{x1:Math.max(i,a),y1:Math.max(o,h),x2:Math.min(r,l),y2:Math.min(s,u)}}var Ch;(function(n){n[n.NONE=0]="NONE",n[n.BBOX1=1]="BBOX1",n[n.BBOX2=2]="BBOX2"})(Ch||(Ch={}));const eH=(n,t,e)=>{let i=n.x1,r=n.x2,o=n.y1,s=n.y2,a=t.x1,l=t.x2,h=t.y1,u=t.y2;return{x11:i,x12:r,y11:o,y12:s,x21:a,x22:l,y21:h,y22:u}};function cZ(n,t,e){if(!n||!t)return Ch.NONE;const{x11:i,x12:r,y11:o,y12:s,x21:a,x22:l,y21:h,y22:u}=eH(n,t);return i>a&&r<l&&o>h&&s<u?Ch.BBOX1:a>i&&l<r&&h>o&&u<s?Ch.BBOX2:Ch.NONE}function gZ(n,t,e){return n&&t?!(n.x1>t.x2||n.x2<t.x1||n.y1>t.y2||n.y2<t.y1):!0}function ry(n,t){return Math.abs(t[0]*n[0]+t[1]*n[1])}function _d({x:n,y:t},e,i={x:0,y:0}){return{x:(n-i.x)*Math.cos(e)-(t-i.y)*Math.sin(e)+i.x,y:(n-i.x)*Math.sin(e)+(t-i.y)*Math.cos(e)+i.y}}function fw(n){return{x:(n.x1+n.x2)/2,y:(n.y1+n.y2)/2}}function zT(n,t){const e=t?gl(n.angle):n.angle,i=fw(n);return[_d({x:n.x1,y:n.y1},e,i),_d({x:n.x2,y:n.y1},e,i),_d({x:n.x2,y:n.y2},e,i),_d({x:n.x1,y:n.y2},e,i)]}function fZ(n,t,e=!1){const i=zT(n,e),r=zT(t,e),o=(m,v)=>[v.x-m.x,v.y-m.y],s=o(fw(n),fw(t)),a=o(i[0],i[1]),l=o(i[1],i[2]),h=o(r[0],r[1]),u=o(r[1],r[2]),d=e?gl(n.angle):n.angle;let c=e?gl(90-n.angle):n.angle+HT;const g=e?gl(t.angle):t.angle;let f=e?gl(90-t.angle):t.angle+HT;c>sf&&(c-=sf),f>sf&&(f-=sf);const p=(m,v,b,y)=>{const C=[Math.cos(v),Math.sin(v)];return m+(ry(C,b)+ry(C,y))/2>ry(C,s)};return p((n.x2-n.x1)/2,d,h,u)&&p((n.y2-n.y1)/2,c,h,u)&&p((t.x2-t.x1)/2,g,a,l)&&p((t.y2-t.y1)/2,f,a,l)}const NT=n=>{let t=n.charCodeAt(0),e=n.length===2?n.charCodeAt(1):0,i=t;return 55296<=t&&t<=56319&&56320<=e&&e<=57343&&(t&=1023,e&=1023,i=t<<10|e,i+=65536),i===12288||65281<=i&&i<=65376||65504<=i&&i<=65510?"F":i===8361||65377<=i&&i<=65470||65474<=i&&i<=65479||65482<=i&&i<=65487||65490<=i&&i<=65495||65498<=i&&i<=65500||65512<=i&&i<=65518?"H":4352<=i&&i<=4447||4515<=i&&i<=4519||4602<=i&&i<=4607||9001<=i&&i<=9002||11904<=i&&i<=11929||11931<=i&&i<=12019||12032<=i&&i<=12245||12272<=i&&i<=12283||12289<=i&&i<=12350||12353<=i&&i<=12438||12441<=i&&i<=12543||12549<=i&&i<=12589||12593<=i&&i<=12686||12688<=i&&i<=12730||12736<=i&&i<=12771||12784<=i&&i<=12830||12832<=i&&i<=12871||12880<=i&&i<=13054||13056<=i&&i<=19903||19968<=i&&i<=42124||42128<=i&&i<=42182||43360<=i&&i<=43388||44032<=i&&i<=55203||55216<=i&&i<=55238||55243<=i&&i<=55291||63744<=i&&i<=64255||65040<=i&&i<=65049||65072<=i&&i<=65106||65108<=i&&i<=65126||65128<=i&&i<=65131||110592<=i&&i<=110593||127488<=i&&i<=127490||127504<=i&&i<=127546||127552<=i&&i<=127560||127568<=i&&i<=127569||131072<=i&&i<=194367||177984<=i&&i<=196605||196608<=i&&i<=262141?"W":32<=i&&i<=126||162<=i&&i<=163||165<=i&&i<=166||i===172||i===175||10214<=i&&i<=10221||10629<=i&&i<=10630?"Na":i===161||i===164||167<=i&&i<=168||i===170||173<=i&&i<=174||176<=i&&i<=180||182<=i&&i<=186||188<=i&&i<=191||i===198||i===208||215<=i&&i<=216||222<=i&&i<=225||i===230||232<=i&&i<=234||236<=i&&i<=237||i===240||242<=i&&i<=243||247<=i&&i<=250||i===252||i===254||i===257||i===273||i===275||i===283||294<=i&&i<=295||i===299||305<=i&&i<=307||i===312||319<=i&&i<=322||i===324||328<=i&&i<=331||i===333||338<=i&&i<=339||358<=i&&i<=359||i===363||i===462||i===464||i===466||i===468||i===470||i===472||i===474||i===476||i===593||i===609||i===708||i===711||713<=i&&i<=715||i===717||i===720||728<=i&&i<=731||i===733||i===735||768<=i&&i<=879||913<=i&&i<=929||931<=i&&i<=937||945<=i&&i<=961||963<=i&&i<=969||i===1025||1040<=i&&i<=1103||i===1105||i===8208||8211<=i&&i<=8214||8216<=i&&i<=8217||8220<=i&&i<=8221||8224<=i&&i<=8226||8228<=i&&i<=8231||i===8240||8242<=i&&i<=8243||i===8245||i===8251||i===8254||i===8308||i===8319||8321<=i&&i<=8324||i===8364||i===8451||i===8453||i===8457||i===8467||i===8470||8481<=i&&i<=8482||i===8486||i===8491||8531<=i&&i<=8532||8539<=i&&i<=8542||8544<=i&&i<=8555||8560<=i&&i<=8569||i===8585||8592<=i&&i<=8601||8632<=i&&i<=8633||i===8658||i===8660||i===8679||i===8704||8706<=i&&i<=8707||8711<=i&&i<=8712||i===8715||i===8719||i===8721||i===8725||i===8730||8733<=i&&i<=8736||i===8739||i===8741||8743<=i&&i<=8748||i===8750||8756<=i&&i<=8759||8764<=i&&i<=8765||i===8776||i===8780||i===8786||8800<=i&&i<=8801||8804<=i&&i<=8807||8810<=i&&i<=8811||8814<=i&&i<=8815||8834<=i&&i<=8835||8838<=i&&i<=8839||i===8853||i===8857||i===8869||i===8895||i===8978||9312<=i&&i<=9449||9451<=i&&i<=9547||9552<=i&&i<=9587||9600<=i&&i<=9615||9618<=i&&i<=9621||9632<=i&&i<=9633||9635<=i&&i<=9641||9650<=i&&i<=9651||9654<=i&&i<=9655||9660<=i&&i<=9661||9664<=i&&i<=9665||9670<=i&&i<=9672||i===9675||9678<=i&&i<=9681||9698<=i&&i<=9701||i===9711||9733<=i&&i<=9734||i===9737||9742<=i&&i<=9743||9748<=i&&i<=9749||i===9756||i===9758||i===9792||i===9794||9824<=i&&i<=9825||9827<=i&&i<=9829||9831<=i&&i<=9834||9836<=i&&i<=9837||i===9839||9886<=i&&i<=9887||9918<=i&&i<=9919||9924<=i&&i<=9933||9935<=i&&i<=9953||i===9955||9960<=i&&i<=9983||i===10045||i===10071||10102<=i&&i<=10111||11093<=i&&i<=11097||12872<=i&&i<=12879||57344<=i&&i<=63743||65024<=i&&i<=65039||i===65533||127232<=i&&i<=127242||127248<=i&&i<=127277||127280<=i&&i<=127337||127344<=i&&i<=127386||917760<=i&&i<=917999||983040<=i&&i<=1048573||1048576<=i&&i<=1114109?"A":"N"};function pZ(n,t={},e){e||(e=1);const{fontStyle:i=t.fontStyle,fontVariant:r=t.fontVariant,fontWeight:o=t.fontWeight,fontSize:s=t.fontSize,fontFamily:a=t.fontFamily}=n;return(i?i+" ":"")+(r?r+" ":"")+(o?o+" ":"")+s*e+"px "+(a||"sans-serif")}let Lh=class Na{constructor(t,e){this._numberCharSize=null,this._fullCharSize=null,this._letterCharSize=null,this._specialCharSizeMap={},this._canvas=null,this._context=null,this._contextSaved=!1,this._notSupportCanvas=!1,this._notSupportVRender=!1,this._userSpec={},this.specialCharSet=`-/: .,@%'"~`,this._option=t,this._userSpec=e??{},this.textSpec=this._initSpec(),_t(t.specialCharSet)&&(this.specialCharSet=t.specialCharSet),this._standardMethod=_t(t.getTextBounds)?this.fullMeasure.bind(this):this.measureWithNaiveCanvas.bind(this)}initContext(){if(this._notSupportCanvas)return!1;if(jt(this._canvas)&&(_t(this._option.getCanvasForMeasure)&&(this._canvas=this._option.getCanvasForMeasure()),jt(this._canvas)&&typeof window<"u"&&window.document!==void 0&&globalThis&&_t(globalThis.document)&&(this._canvas=globalThis.document.createElement("canvas"))),jt(this._context)&&_t(this._canvas)){const t=this._canvas.getContext("2d");_t(t)&&(t.save(),t.font=pZ(this.textSpec),this._contextSaved=!0,this._context=t)}return!jt(this._context)||(this._notSupportCanvas=!0,!1)}_initSpec(){var t,e,i;const{defaultFontParams:r={}}=this._option,{fontStyle:o=r.fontStyle,fontVariant:s=r.fontVariant,fontWeight:a=(t=r.fontWeight)!==null&&t!==void 0?t:"normal",fontSize:l=(e=r.fontSize)!==null&&e!==void 0?e:12,fontFamily:h=(i=r.fontFamily)!==null&&i!==void 0?i:"sans-serif",align:u,textAlign:d=u??"center",baseline:c,textBaseline:g=c??"middle",ellipsis:f,limit:p}=this._userSpec;let{lineHeight:m=l}=this._userSpec;if(Sx(m)&&m[m.length-1]==="%"){const v=Number.parseFloat(m.substring(0,m.length-1))/100;m=l*v}return{fontStyle:o,fontVariant:s,fontFamily:h,fontSize:l,fontWeight:a,textAlign:d,textBaseline:g,ellipsis:f,limit:p,lineHeight:m}}measure(t,e){switch(e){case"vrender":case"canopus":return this.fullMeasure(t);case"canvas":return this.measureWithNaiveCanvas(t);case"simple":return this.quickMeasureWithoutCanvas(t);default:return this.quickMeasure(t)}}fullMeasure(t){if(jt(t))return{width:0,height:0};if(jt(this._option.getTextBounds)||!this._notSupportVRender)return this.measureWithNaiveCanvas(t);const{fontFamily:e,fontSize:i,fontWeight:r,textAlign:o,textBaseline:s,ellipsis:a,limit:l,lineHeight:h}=this.textSpec;let u;try{const d=this._option.getTextBounds({text:t,fontFamily:e,fontSize:i,fontWeight:r,textAlign:o,textBaseline:s,ellipsis:!!a,maxLineWidth:l||1/0,lineHeight:h});u={width:d.width(),height:d.height()}}catch{this._notSupportVRender=!0,u=this.measureWithNaiveCanvas(t)}return u}measureWithNaiveCanvas(t){return this._measureReduce(t,this._measureWithNaiveCanvas.bind(this))}_measureWithNaiveCanvas(t){var e;if(!this.initContext())return this._quickMeasureWithoutCanvas(t);const i=this._context.measureText(t),{fontSize:r,lineHeight:o}=this.textSpec;return{width:i.width,height:(e=o)!==null&&e!==void 0?e:r,fontBoundingBoxAscent:i.fontBoundingBoxAscent,fontBoundingBoxDescent:i.fontBoundingBoxDescent}}quickMeasure(t){return this._measureReduce(t,this._quickMeasure.bind(this))}_quickMeasure(t){const e={width:0,height:0};for(let i=0;i<t.length;i++){const r=t[i];let o=this._measureSpecialChar(r);jt(o)&&Na.NUMBERS_CHAR_SET.includes(r)&&(o=this._measureNumberChar()),jt(o)&&["F","W"].includes(NT(r))&&(o=this._measureFullSizeChar()),jt(o)&&(o=this._measureLetterChar()),e.width+=o.width,e.height=Math.max(e.height,o.height),!jt(o.fontBoundingBoxAscent)&&(e.fontBoundingBoxAscent=o.fontBoundingBoxAscent),!jt(o.fontBoundingBoxDescent)&&(e.fontBoundingBoxDescent=o.fontBoundingBoxDescent)}return e}quickMeasureWithoutCanvas(t){return this._measureReduce(t,this._quickMeasureWithoutCanvas.bind(this))}_quickMeasureWithoutCanvas(t){var e;const i={width:0,height:0},{fontSize:r,lineHeight:o}=this.textSpec;for(let s=0;s<t.length;s++){const a=t[s],l=["F","W"].includes(NT(a))?1:.53;i.width+=l*r}return i.height=(e=o)!==null&&e!==void 0?e:r,i}_measureReduce(t,e){var i;const{fontSize:r,lineHeight:o}=this.textSpec,s={width:0,height:0};if(jt(t))return s;if(_e(t)){const a=t.filter(_t).map((l=>l.toString()));return a.length===0?s:a.length===1?e(a[0]):{width:a.reduce(((l,h)=>Math.max(l,e(h).width)),0),height:a.length*(((i=o)!==null&&i!==void 0?i:r)+1)+1}}return e(t.toString())}_measureNumberChar(){if(jt(this._numberCharSize)){const t=this._standardMethod(Na.NUMBERS_CHAR_SET);this._numberCharSize={width:t.width/Na.NUMBERS_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._numberCharSize}_measureFullSizeChar(){return jt(this._fullCharSize)&&(this._fullCharSize=this._standardMethod(Na.FULL_SIZE_CHAR)),this._fullCharSize}_measureLetterChar(){if(jt(this._letterCharSize)){const t=this._standardMethod(Na.ALPHABET_CHAR_SET);this._letterCharSize={width:t.width/Na.ALPHABET_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._letterCharSize}_measureSpecialChar(t){return _t(this._specialCharSizeMap[t])?this._specialCharSizeMap[t]:this.specialCharSet.includes(t)?(this._specialCharSizeMap[t]=this._standardMethod(t),this._specialCharSizeMap[t]):null}release(){_t(this._canvas)&&(this._canvas=null),_t(this._context)&&(this._contextSaved&&(this._context.restore(),this._contextSaved=!1),this._context=null)}};Lh.ALPHABET_CHAR_SET="abcdefghijklmnopqrstuvwxyz",Lh.NUMBERS_CHAR_SET="0123456789",Lh.FULL_SIZE_CHAR="字";const WT=(n,t)=>Math.max(t.x1-n.x2,n.x1-t.x2,t.y1-n.y2,n.y1-t.y2),mZ=(n,t)=>{const e=[{x:Math.cos(n.angle),y:Math.sin(n.angle)},{x:-Math.sin(n.angle),y:Math.cos(n.angle)},{x:Math.cos(t.angle),y:Math.sin(n.angle)},{x:-Math.sin(t.angle),y:Math.cos(n.angle)}];function i(o,s,a){const l=o.getRotatedCorners().map((h=>h.x*s+h.y*a));return{min:Math.min(...l),max:Math.max(...l)}}let r=0;for(const o of e){const s=i(n,o.x,o.y),a=i(t,o.x,o.y);let l;l=s.max<a.min?a.min-s.max:a.max<s.min?s.min-a.max:0,r=Math.max(r,l)}return r};function vZ(n,t,e){const{x1:i,y1:r,x2:o,y2:s}=t;return e.onlyTranslate()?(n!==t&&n.setValue(t.x1,t.y1,t.x2,t.y2),n.translate(e.e,e.f),t):(n.clear(),n.add(e.a*i+e.c*r+e.e,e.b*i+e.d*r+e.f),n.add(e.a*o+e.c*r+e.e,e.b*o+e.d*r+e.f),n.add(e.a*o+e.c*s+e.e,e.b*o+e.d*s+e.f),n.add(e.a*i+e.c*s+e.e,e.b*i+e.d*s+e.f),t)}let iH=class nH{constructor(t){t?this.setValue(t.x1,t.y1,t.x2,t.y2):this.clear()}clone(){return new nH(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}setValue(t=0,e=0,i=0,r=0){return this.x1=t,this.y1=e,this.x2=i,this.y2=r,this}set(t=0,e=0,i=0,r=0){return i<t?(this.x2=t,this.x1=i):(this.x1=t,this.x2=i),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this}add(t=0,e=0){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this}expand(t=0){return _e(t)?(this.y1-=t[0],this.x2+=t[1],this.y2+=t[2],this.x1-=t[3]):(this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(t=0,e=0){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this}rotate(t=0,e=0,i=0){const r=this.rotatedPoints(t,e,i);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])}scale(t=0,e=0,i=0,r=0){const o=this.scalePoints(t,e,i,r);return this.clear().add(o[0],o[1]).add(o[2],o[3])}union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this}intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this}encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2}alignsWith(t){return t&&(this.x1===t.x1||this.x2===t.x2||this.y1===t.y1||this.y2===t.y2)}intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)}contains(t=0,e=0){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)}containsPoint(t){return!(t.x<this.x1||t.x>this.x2||t.y<this.y1||t.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(t=0){return this.x1*=t,this.x2*=t,this}scaleY(t=0){return this.y1*=t,this.y2*=t,this}transformWithMatrix(t){return vZ(this,this,t),this}copy(t){return this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this}rotatedPoints(t,e,i){const{x1:r,y1:o,x2:s,y2:a}=this,l=Math.cos(t),h=Math.sin(t),u=e-e*l+i*h,d=i-e*h-i*l;return[l*r-h*o+u,h*r+l*o+d,l*r-h*a+u,h*r+l*a+d,l*s-h*o+u,h*s+l*o+d,l*s-h*a+u,h*s+l*a+d]}scalePoints(t,e,i,r){const{x1:o,y1:s,x2:a,y2:l}=this;return[t*o+(1-t)*i,e*s+(1-e)*r,t*a+(1-t)*i,e*l+(1-e)*r]}},Ic=class extends iH{};function pw(n,t,e){t/=100,e/=100;const i=(1-Math.abs(2*e-1))*t,r=i*(1-Math.abs(n/60%2-1)),o=e-i/2;let s=0,a=0,l=0;return 0<=n&&n<60?(s=i,a=r,l=0):60<=n&&n<120?(s=r,a=i,l=0):120<=n&&n<180?(s=0,a=i,l=r):180<=n&&n<240?(s=0,a=r,l=i):240<=n&&n<300?(s=r,a=0,l=i):300<=n&&n<360&&(s=i,a=0,l=r),s=Math.round(255*(s+o)),a=Math.round(255*(a+o)),l=Math.round(255*(l+o)),{r:s,g:a,b:l}}function Tx(n,t,e){n/=255,t/=255,e/=255;const i=Math.min(n,t,e),r=Math.max(n,t,e),o=r-i;let s=0,a=0,l=0;return s=o===0?0:r===n?(t-e)/o%6:r===t?(e-n)/o+2:(n-t)/o+4,s=Math.round(60*s),s<0&&(s+=360),l=(r+i)/2,a=o===0?0:o/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:s,s:a,l}}const bZ=/^#([0-9a-f]{3,8})$/,jT={transparent:4294967040},jf={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function lf(n){return((n=Math.max(0,Math.min(255,Math.round(n)||0)))<16?"0":"")+n.toString(16)}function rH(n){return rn(n)?new Pn(n>>16,n>>8&255,255&n,1):_e(n)?new Pn(n[0],n[1],n[2]):new Pn(255,255,255)}function yZ(n){return rn(n)?new Pn(n>>>24,n>>>16&255,n>>>8&255,255&n):_e(n)?new Pn(n[0],n[1],n[2],n[3]):new Pn(255,255,255,1)}function oy(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function sy(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}const VT=(n,t)=>{const e=bZ.exec(n);if(t||e){const i=parseInt(e[1],16),r=e[1].length;return r===3?new Pn((i>>8&15)+((i>>8&15)<<4),(i>>4&15)+((i>>4&15)<<4),(15&i)+((15&i)<<4),1):r===6?rH(i):r===8?new Pn(i>>24&255,i>>16&255,i>>8&255,(255&i)/255):null}};let Vf=class Wa{static Brighter(t,e=1){return e===1?t:new Wa(t).brighter(e).toRGBA()}static SetOpacity(t,e=1){return e===1?t:new Wa(t).setOpacity(e).toRGBA()}static getColorBrightness(t,e="hsl"){const i=t instanceof Wa?t:new Wa(t);switch(e){case"hsv":default:return i.getHSVBrightness();case"hsl":return i.getHSLBrightness();case"lum":return i.getLuminance();case"lum2":return i.getLuminance2();case"lum3":return i.getLuminance3();case"wcag":return i.getLuminanceWCAG()}}static parseColorString(t){if(_t(jT[t]))return yZ(jT[t]);if(_t(jf[t]))return rH(jf[t]);const e=`${t}`.trim().toLowerCase(),i=VT(e);if(i!==void 0)return i;if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const r=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new Pn(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10),parseFloat(r[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const r=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),o=pw(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10));return new Pn(o.r,o.g,o.b,parseFloat(r[3]))}}constructor(t){const e=Wa.parseColorString(t);e?this.color=e:this.color=new Pn(255,255,255)}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t))),this}add(t){const{r:e,g:i,b:r}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,r+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return .5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const r=this.color.opacity,o=Tx(this.color.r,this.color.g,this.color.b),s=pw(jt(t)?o.h:Qn(t,0,360),jt(e)?o.s:e>=0&&e<=1?100*e:e,jt(i)?o.l:i<=1&&i>=0?100*i:i);return this.color=new Pn(s.r,s.g,s.b,r),this}setRGB(t,e,i){return!jt(t)&&(this.color.r=t),!jt(e)&&(this.color.g=e),!jt(i)&&(this.color.b=i),this}setHex(t){const e=`${t}`.trim().toLowerCase(),i=VT(e,!0);return i??this}setColorName(t){const e=jf[t.toLowerCase()];return e!==void 0&&this.setHex(e),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(t=1){return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}getLuminanceWCAG(){const t=this.color.r/255,e=this.color.g/255,i=this.color.b/255;let r,o,s;return r=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),o=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),s=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),.2126*r+.7152*o+.0722*s}clone(){return new Wa(this.color.toString())}copyGammaToLinear(t,e=2){return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t,e=2){const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=oy(t.color.r),this.color.g=oy(t.color.g),this.color.b=oy(t.color.b),this}copyLinearToSRGB(t){return this.color.r=sy(t.color.r),this.color.g=sy(t.color.g),this.color.b=sy(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}},Pn=class{constructor(t,e,i,r){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),_t(r)?this.opacity=isNaN(+r)?1:Math.max(0,Math.min(1,+r)):this.opacity=1}formatHex(){return`#${lf(this.r)+lf(this.g)+lf(this.b)+(this.opacity===1?"":lf(255*this.opacity))}`}formatRgb(){const t=this.opacity;return`${t===1?"rgb(":"rgba("}${this.r},${this.g},${this.b}${t===1?")":`,${t})`}`}formatHsl(){const t=this.opacity,{h:e,s:i,l:r}=Tx(this.r,this.g,this.b);return`${t===1?"hsl(":"hsla("}${e},${i}%,${r}%${t===1?")":`,${t})`}`}toString(){return this.formatHex()}};function CZ(n){let t="",e="",i="";const r=n[0]==="#"?1:0;for(let o=r;o<n.length;o++)n[o]!=="#"&&(o<r+2?t+=n[o]:o<r+4?e+=n[o]:o<r+6&&(i+=n[o]));return[parseInt(t,16),parseInt(e,16),parseInt(i,16)]}function _Z(n,t,e){return Number((1<<24)+(n<<16)+(t<<8)+e).toString(16).slice(1)}function wZ(n,t){const e=n.r,i=t.r,r=n.g,o=t.g,s=n.b,a=t.b,l=n.opacity,h=t.opacity;return u=>{const d=Math.round(e*(1-u)+i*u),c=Math.round(r*(1-u)+o*u),g=Math.round(s*(1-u)+a*u);return new Pn(d,c,g,l*(1-u)+h*u)}}const xZ=Object.freeze(Object.defineProperty({__proto__:null,Color:Vf,DEFAULT_COLORS:jf,RGB:Pn,hexToRgb:CZ,hslToRgb:pw,interpolateRgb:wZ,rgbToHex:_Z,rgbToHsl:Tx},Symbol.toStringTag,{value:"Module"}));function No(n){if(pi(n))return[n,n,n,n];if(_e(n)){const t=n.length;if(t===1){const e=n[0];return[e,e,e,e]}if(t===2){const[e,i]=n;return[e,i,e,i]}if(t===3){const[e,i,r]=n;return[e,i,r,i]}if(t===4)return n}if(ao(n)){const{top:t=0,right:e=0,bottom:i=0,left:r=0}=n;return[t,e,i,r]}return[0,0,0,0]}const SZ=["x","y","dx","dy","scaleX","scaleY","angle","anchor","postMatrix","visible","clip","pickable","childrenPickable","zIndex","cursor"];class hr extends Jt{constructor(t,e){super(t),this._skipRenderAttributes=SZ,e?.mode&&(this.mode=e.mode,this.setMode(e.mode)),e?.skipDefault&&(this.skipDefault=!0),this.setTheme({common:{strokeBoundsBuffer:0}}),this.attribute=t,this.onSetStage((()=>{this.render(),this.bindEvents()}))}setAttribute(t,e,i,r){const o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,r);if(o)return this._setAttributes(o,i);zd(this.attribute[t])&&zd(e)&&!ai(this.attribute[t])&&!ai(e)?Lt(this.attribute[t],e):this.attribute[t]=e,this._skipRenderAttributes.includes(t)||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}setAttributes(t,e,i){return t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t,this._setAttributes(t,e)}_setAttributes(t,e){const i=Object.keys(t);this._mergeAttributes(t,i),i.every((r=>this._skipRenderAttributes.includes(r)))||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(i)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}_mergeAttributes(t,e){jt(e)&&(e=Object.keys(t));for(let i=0;i<e.length;i++){const r=e[i];!zd(this.attribute[r])||ai(this.attribute[r])||ai(t[r])?this.attribute[r]=t[r]:Lt(this.attribute[r],t[r])}}bindEvents(){}_getNodeId(t){var e;return`${(e=this.id)!==null&&e!==void 0?e:this._uid}-${this.name}-${t}`}_dispatchEvent(t,e){var i;const r=new lx(t,e);r.manager=(i=this.stage)===null||i===void 0?void 0:i.eventSystem.manager,this.dispatchEvent(r)}eventPosToStagePos(t){var e,i;const r={x:0,y:0},o=(i=(e=this.stage)===null||e===void 0?void 0:e.eventPointTransform(t))!==null&&i!==void 0?i:{x:0,y:0};return this.globalTransMatrix.transformPoint(o,r),r}}const Ta=Symbol.for("MathPickerContribution"),GT=Symbol.for("MathArcPicker"),$T=Symbol.for("MathCirclePicker"),g0=Symbol.for("MathImagePicker"),UT=Symbol.for("MathLinePicker"),XT=Symbol.for("MathPathPicker"),YT=Symbol.for("MathRectPicker"),qT=Symbol.for("MathSymbolPicker"),KT=Symbol.for("MathTextPicker"),ZT=Symbol.for("MathPolygonPicker"),JT=Symbol.for("CanvasArcPicker"),QT=Symbol.for("CanvasCirclePicker"),tR=Symbol.for("CanvasImagePicker"),eR=Symbol.for("CanvasLinePicker"),iR=Symbol.for("CanvasPathPicker"),nR=Symbol.for("CanvasRectPicker"),rR=Symbol.for("CanvasSymbolPicker"),oR=Symbol.for("CanvasTextPicker"),sR=Symbol.for("CanvasPolygonPicker"),aR=Symbol.for("CanvasRichTextPicker"),lR=Symbol.for("CanvasGroupPicker"),Vn=Symbol.for("CanvasPickerContribution"),Rx=(n,t)=>Object.prototype.toString.call(n)===`[object ${t}]`,AZ=n=>typeof n=="function",ay=(n,t=!1)=>{const e=typeof n;return t?e==="string":e==="string"||Rx(n,"String")},oH=n=>Array.isArray?Array.isArray(n):Rx(n,"Array"),Bx=(n,t=!1)=>{const e=typeof n;return t?e==="number":e==="number"||Rx(n,"Number")},hR=n=>Bx(n)&&Number.isFinite(n),MZ=typeof console<"u";function hf(n,t,e){const i=[t].concat([].slice.call(e))}var Gr;(function(n){n[n.None=0]="None",n[n.Error=1]="Error",n[n.Warn=2]="Warn",n[n.Info=3]="Info",n[n.Debug=4]="Debug"})(Gr||(Gr={}));let sH=class Yn{static getInstance(t,e){return Yn._instance&&Bx(t)?Yn._instance.level(t):Yn._instance||(Yn._instance=new Yn(t,e)),Yn._instance}static setInstance(t){return Yn._instance=t}static setInstanceLevel(t){Yn._instance?Yn._instance.level(t):Yn._instance=new Yn(t)}static clearInstance(){Yn._instance=null}constructor(t=Gr.None,e){this._onErrorHandler=[],this._level=t,this._method=e}addErrorHandler(t){this._onErrorHandler.find((e=>e===t))||this._onErrorHandler.push(t)}removeErrorHandler(t){const e=this._onErrorHandler.findIndex((i=>i===t));e<0||this._onErrorHandler.splice(e,1)}callErrorHandler(...t){this._onErrorHandler.forEach((e=>e(...t)))}canLogInfo(){return this._level>=Gr.Info}canLogDebug(){return this._level>=Gr.Debug}canLogError(){return this._level>=Gr.Error}canLogWarn(){return this._level>=Gr.Warn}level(t){return arguments.length?(this._level=+t,this):this._level}error(...t){var e;return this._level>=Gr.Error&&(this._onErrorHandler.length?this.callErrorHandler(...t):hf((e=this._method)!==null&&e!==void 0?e:"error","ERROR",t)),this}warn(...t){return this._level>=Gr.Warn&&hf(this._method||"warn","WARN",t),this}info(...t){return this._level>=Gr.Info&&hf(this._method||"log","INFO",t),this}debug(...t){return this._level>=Gr.Debug&&hf(this._method||"log","DEBUG",t),this}};sH._instance=null;const TZ=Math.PI,uR=2*Math.PI;function RZ(n){return 180*n/Math.PI}function dR(n,t={},e){e||(e=1);const{fontStyle:i=t.fontStyle,fontVariant:r=t.fontVariant,fontWeight:o=t.fontWeight,fontSize:s=t.fontSize,fontFamily:a=t.fontFamily}=n;return(i?i+" ":"")+(r?r+" ":"")+(o?o+" ":"")+s*e+"px "+(a||"sans-serif")}function BZ(n,t,e){const{x1:i,y1:r,x2:o,y2:s}=t;return e.onlyTranslate()?(n!==t&&n.setValue(t.x1,t.y1,t.x2,t.y2),n.translate(e.e,e.f),t):(n.clear(),n.add(e.a*i+e.c*r+e.e,e.b*i+e.d*r+e.f),n.add(e.a*o+e.c*r+e.e,e.b*o+e.d*r+e.f),n.add(e.a*o+e.c*s+e.e,e.b*o+e.d*s+e.f),n.add(e.a*i+e.c*s+e.e,e.b*i+e.d*s+e.f),t)}let kZ=class aH{constructor(t){t?this.setValue(t.x1,t.y1,t.x2,t.y2):this.clear()}clone(){return new aH(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}setValue(t=0,e=0,i=0,r=0){return this.x1=t,this.y1=e,this.x2=i,this.y2=r,this}set(t=0,e=0,i=0,r=0){return i<t?(this.x2=t,this.x1=i):(this.x1=t,this.x2=i),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this}add(t=0,e=0){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this}expand(t=0){return oH(t)?(this.y1-=t[0],this.x2+=t[1],this.y2+=t[2],this.x1-=t[3]):(this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(t=0,e=0){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this}rotate(t=0,e=0,i=0){const r=this.rotatedPoints(t,e,i);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])}scale(t=0,e=0,i=0,r=0){const o=this.scalePoints(t,e,i,r);return this.clear().add(o[0],o[1]).add(o[2],o[3])}union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this}intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this}encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2}alignsWith(t){return t&&(this.x1===t.x1||this.x2===t.x2||this.y1===t.y1||this.y2===t.y2)}intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)}contains(t=0,e=0){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)}containsPoint(t){return!(t.x<this.x1||t.x>this.x2||t.y<this.y1||t.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(t=0){return this.x1*=t,this.x2*=t,this}scaleY(t=0){return this.y1*=t,this.y2*=t,this}transformWithMatrix(t){return BZ(this,this,t),this}copy(t){return this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this}rotatedPoints(t,e,i){const{x1:r,y1:o,x2:s,y2:a}=this,l=Math.cos(t),h=Math.sin(t),u=e-e*l+i*h,d=i-e*h-i*l;return[l*r-h*o+u,h*r+l*o+d,l*r-h*a+u,h*r+l*a+d,l*s-h*o+u,h*s+l*o+d,l*s-h*a+u,h*s+l*a+d]}scalePoints(t,e,i,r){const{x1:o,y1:s,x2:a,y2:l}=this;return[t*o+(1-t)*i,e*s+(1-e)*r,t*a+(1-t)*i,e*l+(1-e)*r]}},kx=class extends kZ{};class Bo{constructor(t=1,e=0,i=0,r=1,o=0,s=0){this.a=t,this.b=e,this.c=i,this.d=r,this.e=o,this.f=s}equalToMatrix(t){return!(this.e!==t.e||this.f!==t.f||this.a!==t.a||this.d!==t.d||this.b!==t.b||this.c!==t.c)}equalTo(t,e,i,r,o,s){return!(this.e!==o||this.f!==s||this.a!==t||this.d!==r||this.b!==e||this.c!==i)}setValue(t,e,i,r,o,s){return this.a=t,this.b=e,this.c=i,this.d=r,this.e=o,this.f=s,this}reset(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}getInverse(){const t=this.a,e=this.b,i=this.c,r=this.d,o=this.e,s=this.f,a=new Bo,l=t*r-e*i;return a.a=r/l,a.b=-e/l,a.c=-i/l,a.d=t/l,a.e=(i*s-r*o)/l,a.f=-(t*s-e*o)/l,a}rotate(t){const e=Math.cos(t),i=Math.sin(t),r=this.a*e+this.c*i,o=this.b*e+this.d*i,s=this.a*-i+this.c*e,a=this.b*-i+this.d*e;return this.a=r,this.b=o,this.c=s,this.d=a,this}rotateByCenter(t,e,i){const r=Math.cos(t),o=Math.sin(t),s=(1-r)*e+o*i,a=(1-r)*i-o*e,l=r*this.a-o*this.b,h=o*this.a+r*this.b,u=r*this.c-o*this.d,d=o*this.c+r*this.d,c=r*this.e-o*this.f+s,g=o*this.e+r*this.f+a;return this.a=l,this.b=h,this.c=u,this.d=d,this.e=c,this.f=g,this}scale(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this}setScale(t,e){return this.b=this.b/this.a*t,this.c=this.c/this.d*e,this.a=t,this.d=e,this}transform(t,e,i,r,o,s){return this.multiply(t,e,i,r,o,s),this}translate(t,e){return this.e+=this.a*t+this.c*e,this.f+=this.b*t+this.d*e,this}transpose(){const{a:t,b:e,c:i,d:r,e:o,f:s}=this;return this.a=e,this.b=t,this.c=r,this.d=i,this.e=s,this.f=o,this}multiply(t,e,i,r,o,s){const a=this.a,l=this.b,h=this.c,u=this.d,d=a*t+h*e,c=l*t+u*e,g=a*i+h*r,f=l*i+u*r,p=a*o+h*s+this.e,m=l*o+u*s+this.f;return this.a=d,this.b=c,this.c=g,this.d=f,this.e=p,this.f=m,this}interpolate(t,e){const i=new Bo;return i.a=this.a+(t.a-this.a)*e,i.b=this.b+(t.b-this.b)*e,i.c=this.c+(t.c-this.c)*e,i.d=this.d+(t.d-this.d)*e,i.e=this.e+(t.e-this.e)*e,i.f=this.f+(t.f-this.f)*e,i}transformPoint(t,e){const{a:i,b:r,c:o,d:s,e:a,f:l}=this,h=i*s-r*o,u=s/h,d=-r/h,c=-o/h,g=i/h,f=(o*l-s*a)/h,p=-(i*l-r*a)/h,{x:m,y:v}=t;e.x=m*u+v*c+f,e.y=m*d+v*g+p}onlyTranslate(t=1){return this.a===t&&this.b===0&&this.c===0&&this.d===t}clone(){return new Bo(this.a,this.b,this.c,this.d,this.e,this.f)}toTransformAttrs(){const t=this.a,e=this.b,i=this.c,r=this.d,o=t*r-e*i,s={x:this.e,y:this.f,rotateDeg:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(t!==0||e!==0){const a=Math.sqrt(t*t+e*e);s.rotateDeg=e>0?Math.acos(t/a):-Math.acos(t/a),s.scaleX=a,s.scaleY=o/a,s.skewX=(t*i+e*r)/o,s.skewY=0}else if(i!==0||r!==0){const a=Math.sqrt(i*i+r*r);s.rotateDeg=Math.PI/2-(r>0?Math.acos(-i/a):-Math.acos(i/a)),s.scaleX=o/a,s.scaleY=a,s.skewX=0,s.skewY=(t*i+e*r)/o}return s.rotateDeg=RZ(s.rotateDeg),s}}const PZ={onPointerDown:"pointerdown",onPointerUp:"pointerup",onPointerUpOutside:"pointerupoutside",onPointerTap:"pointertap",onPointerOver:"pointerover",onPointerMove:"pointermove",onPointerEnter:"pointerenter",onPointerLeave:"pointerleave",onPointerOut:"pointerout",onMouseDown:"mousedown",onMouseUp:"mouseup",onMouseUpOutside:"mouseupoutside",onMouseMove:"mousemove",onMouseOver:"mouseover",onMouseOut:"mouseout",onMouseEnter:"mouseenter",onMouseLeave:"mouseleave",onPinch:"pinch",onPinchStart:"pinchstart",onPinchEnd:"pinchend",onPan:"pan",onPanStart:"panstart",onPanEnd:"panend",onDrag:"drag",onDragStart:"dragstart",onDragEnter:"dragenter",onDragLeave:"dragleave",onDragOver:"dragover",onDragEnd:"dragend",onRightDown:"rightdown",onRightUp:"rightup",onRightUpOutside:"rightupoutside",onTouchStart:"touchstart",onTouchEnd:"touchend",onTouchEndOutside:"touchendoutside",onTouchMove:"touchmove",onTouchCancel:"touchcancel",onPress:"press",onPressUp:"pressup",onPressEnd:"pressend",onSwipe:"swipe",onDrop:"drop",onWeel:"wheel",onClick:"click",onDblClick:"dblclick"},cR=(n,t)=>{const e=t.x-n.x,i=t.y-n.y;return Math.abs(e)>Math.abs(i)?e>0?"right":"left":i>0?"down":"up"},uf=(n,t)=>{const e=Math.abs(t.x-n.x),i=Math.abs(t.y-n.y);return Math.sqrt(e*e+i*i)},EZ=n=>{const t=n.length;if(t===1)return{x:Math.round(n[0].x),y:Math.round(n[0].y)};let e=0,i=0,r=0;for(;r<t;)e+=n[r].x,i+=n[r].y,r++;return{x:Math.round(e/t),y:Math.round(i/t)}};class LZ extends Gl{constructor(t,e={}){var i,r,o,s,a,l,h,u,d,c;super(),this.cachedEvents=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this.lastTapTarget=null,this.onStart=g=>{this.startTime=ll.now();const{cachedEvents:f,startPoints:p}=this;g&&f.push(g.clone()),p.length=f.length;for(let m=0;m<f.length;m++){const{x:v,y:b}=f[m],y={x:v,y:b};p[m]=y}if(p.length!==1)this.startDistance=uf(p[0],p[1]),this.center=EZ([p[0],p[1]]);else{const m=f[0];this.pressTimeout=setTimeout((()=>{m.direction="none",m.deltaX=0,m.deltaY=0,m.points=p,this.triggerStartEvent("press",m),this.triggerEvent("press",m),this.eventType="press",this.direction="none",this.pressTimeout=null}),this.config.press.time)}},this.onMove=g=>{this.clearPressTimeout();const{startPoints:f,cachedEvents:p}=this;if(!f.length)return;const m=g.clone(),{x:v,y:b,pointerId:y}=m;for(let S=0,T=p.length;S<T;S++)if(y===p[S].pointerId){p[S]=m;break}const C={x:v,y:b},w=p.map((S=>({x:S.x,y:S.y}))),_=ll.now();if(this.prevMoveTime=this.lastMoveTime,this.prevMovePoint=this.lastMovePoint,this.lastMoveTime=_,this.lastMovePoint=C,f.length===1){const S=f[0],T=v-S.x,M=b-S.y,R=this.direction||cR(S,C);this.direction=R;const E=this.getEventType(C);return m.direction=R,m.deltaX=T,m.deltaY=M,m.points=w,this.triggerStartEvent(E,m),void this.triggerEvent(E,m)}const{startDistance:A}=this,x=uf(w[0],w[1]);m.scale=x/A,m.center=this.center,m.points=w,this.triggerStartEvent("pinch",m),this.triggerEvent("pinch",m)},this.onEnd=g=>{const f=g.clone(),{cachedEvents:p,startPoints:m}=this,v=p.map((b=>({x:b.x,y:b.y})));if(f.points=v,this.triggerEndEvent(f),p.length===1){const b=ll.now(),y=this.lastMoveTime;if(b-y<100){const C=y-(this.prevMoveTime||this.startTime);if(C>0){const w=this.prevMovePoint||m[0],_=this.lastMovePoint||m[0],A=uf(w,_),x=A/C;if(x>this.config.swipe.velocity&&A>this.config.swipe.threshold)return f.velocity=x,f.direction=cR(w,_),this.triggerEvent("swipe",f),this.cachedEvents=[],this.startPoints=[],void this.reset()}}b-this.startTime<this.config.press.time&&(b-this.lastTapTime<this.config.tap.interval&&g.target===this.lastTapTarget?this.tapCount++:this.tapCount=1,this.lastTapTime=b,this.lastTapTarget=g.target,this.tapCount===1?this.triggerEvent("tap",f):this.tapCount===2&&(this.triggerEvent("doubletap",f),this.tapCount=0))}for(let b=0,y=p.length;b<y;b++)if(p[b].pointerId===f.pointerId){p.splice(b,1),m.splice(b,1);break}this.reset(),p.length>0&&this.onStart()},this.element=t,this.tapCount=0,this.lastTapTime=0,this.config={press:{time:(r=(i=e?.press)===null||i===void 0?void 0:i.time)!==null&&r!==void 0?r:251,threshold:(s=(o=e?.press)===null||o===void 0?void 0:o.threshold)!==null&&s!==void 0?s:9},swipe:{threshold:(l=(a=e?.swipe)===null||a===void 0?void 0:a.threshold)!==null&&l!==void 0?l:10,velocity:(u=(h=e?.swipe)===null||h===void 0?void 0:h.velocity)!==null&&u!==void 0?u:.3},tap:{interval:(c=(d=e?.tap)===null||d===void 0?void 0:d.interval)!==null&&c!==void 0?c:300}},this.initEvents()}initEvents(){const{element:t}=this;t&&(t.addEventListener("pointerdown",this.onStart),t.addEventListener("pointermove",this.onMove),t.addEventListener("pointerup",this.onEnd),t.addEventListener("pointerleave",this.onEnd),t.addEventListener("pointerupoutside",this.onEnd))}removeEvents(){const{element:t}=this;t&&(t.removeEventListener("pointerdown",this.onStart),t.removeEventListener("pointermove",this.onMove),t.removeEventListener("pointerup",this.onEnd),t.removeEventListener("pointerleave",this.onEnd),t.removeEventListener("pointerupoutside",this.onEnd))}release(){this.removeEvents(),this.element=null}getEventType(t){const{eventType:e,startTime:i,startPoints:r}=this;if(e==="press")return e;let o;return o=ll.now()-i>this.config.press.time&&uf(r[0],t)<this.config.press.threshold?"press":"pan",this.eventType=o,o}enable(t){this.processEvent[t]=!0}isProcess(t){return this.processEvent[t]}pushEvent(t,e){const{emitThrottles:i}=this,r={type:t,ev:e};for(let o=0,s=i.length;o<s;o++)if(i[o].type===t)return void i.splice(o,1,r);i.push(r)}clearPressTimeout(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}reset(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null}triggerEvent(t,e){this.pushEvent(t,e);const{throttleTimer:i,emitThrottles:r}=this;i||(this.throttleTimer=mt.global.getRequestAnimationFrame()((()=>{mt.global.getCancelAnimationFrame()(this.throttleTimer),this.throttleTimer=null;for(let o=0,s=r.length;o<s;o++){const{type:a,ev:l}=r[o];this.emitEvent(a,l)}this.emitThrottles.length=0})))}triggerStartEvent(t,e){this.isProcess(t)||(this.enable(t),this.triggerEvent(`${t}start`,e))}triggerEndEvent(t){const e=this.processEvent;Object.keys(e).forEach((i=>{this.triggerEvent(`${i}end`,t),i==="press"&&this.triggerEvent(`${i}up`,t),delete e[i]}))}emitEvent(t,e){if(!this.element)return;const i=this.element._events[pI];if(i)if("fn"in i)i.fn.call(i.context,e,t);else for(let r=0,o=i.length;r<o&&!e.propagationImmediatelyStopped;r++)i[r].fn.call(i[r].context,e,t);this.emit(t,e)}}var OZ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},IZ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};const $t=[0,0,0],HZ=(n,t,e,i,r,o,s,a)=>{if(a)for(;e>t;)e-=uR;else for(;e<t;)e+=uR;const l=TZ/3*(e>t?1:-1);let h=t,u=h;for(;u!==e;){u=l>0?Math.min(u+l,e):Math.max(u+l,e);const d=Math.abs(u-h),c=4*Math.tan(d/4)/3,g=u<h?-1:1,f=Math.cos(h),p=Math.sin(h),m=Math.cos(u),v=Math.sin(u),b=f*o+i,y=p*s+r,C=m*o+i,w=v*s+r,_=o*c*g,A=s*c*g;n.push([b-_*p,y+A*f,C+_*v,w-A*m,C,w]),h=u}};let Oh=class{set fillStyle(n){this.nativeContext.fillStyle=n}get fillStyle(){return this.nativeContext.fillStyle}set font(n){n!==this._font&&(this._font=n,this.nativeContext.font=n)}get font(){var n;return(n=this._font)!==null&&n!==void 0?n:this.nativeContext.font}set globalAlpha(n){this.nativeContext.globalAlpha=n*this.baseGlobalAlpha}get globalAlpha(){return this.nativeContext.globalAlpha}set lineCap(n){this.nativeContext.lineCap=n}get lineCap(){return this.nativeContext.lineCap}set lineDashOffset(n){this.nativeContext.lineDashOffset=n}get lineDashOffset(){return this.nativeContext.lineDashOffset}set lineJoin(n){this.nativeContext.lineJoin=n}get lineJoin(){return this.nativeContext.lineJoin}set lineWidth(n){this.nativeContext.lineWidth=n}get lineWidth(){return this.nativeContext.lineWidth}set miterLimit(n){this.nativeContext.miterLimit=n}get miterLimit(){return this.nativeContext.miterLimit}set shadowBlur(n){this.nativeContext.shadowBlur=n}get shadowBlur(){return this.nativeContext.shadowBlur}set shadowColor(n){this.nativeContext.shadowColor=n}get shadowColor(){return this.nativeContext.shadowColor}set shadowOffsetX(n){this.nativeContext.shadowOffsetX=n}get shadowOffsetX(){return this.nativeContext.shadowOffsetX}set shadowOffsetY(n){this.nativeContext.shadowOffsetY=n}get shadowOffsetY(){return this.nativeContext.shadowOffsetY}set strokeStyle(n){this.nativeContext.strokeStyle=n}get strokeStyle(){return this.nativeContext.strokeStyle}set textAlign(n){this.nativeContext.textAlign=n}get textAlign(){return this.nativeContext.textAlign}set textBaseline(n){this.nativeContext.textBaseline=n}get textBaseline(){return this.nativeContext.textBaseline}get inuse(){return!!this._inuse}set inuse(n){n!==!!this._inuse&&(this._inuse=n,n?(this.nativeContext.save(),this.reset()):this.nativeContext.restore())}constructor(n,t){this.fillAttributes=Object.assign(Object.assign({},eI),{opacity:1}),this.strokeAttributes=Object.assign(Object.assign({},iI),{opacity:1}),this.textAttributes=Object.assign(Object.assign({},zn),{opacity:1}),this._clearShadowStyle=!1,this._clearFilterStyle=!1,this._clearGlobalCompositeOperationStyle=!1;const e=n.nativeCanvas.getContext("2d");if(!e)throw new Error("发生错误，获取2d上下文失败");this.nativeContext=e,this.canvas=n,this.matrix=new Bo(1,0,0,1,0,0),this.stack=[],this.dpr=t,this.applyedMatrix=new Bo(1,0,0,1,0,0),this._clearMatrix=new Bo(1,0,0,1,0,0),this.baseGlobalAlpha=1}reset(n=!0){this.stack.length&&sH.getInstance().warn("可能存在bug，matrix没有清空"),this.matrix.setValue(1,0,0,1,0,0),this.applyedMatrix=new Bo(1,0,0,1,0,0),this.stack.length=0,n&&this.nativeContext.setTransform(1,0,0,1,0,0)}getCanvas(){return this.canvas}getContext(){return this.nativeContext}setTransformForCurrent(n=!1){!n&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix.setValue(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f),this.nativeContext.setTransform(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f))}get currentMatrix(){return this.matrix}cloneMatrix(n){return Ki.allocateByObj(n)}clear(){this.save(),this.resetTransform(),this.nativeContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.restore()}restore(){this.nativeContext.restore(),this.stack.length>0&&(Ki.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent(!0)),this.font="",this._clearFilterStyle=!1,this._clearShadowStyle=!1}highPerformanceRestore(){this.stack.length>0&&(Ki.free(this.matrix),this.matrix=this.stack.pop())}rotate(n,t=!0){this.matrix.rotate(n),t&&this.setTransformForCurrent()}save(){const n=this.cloneMatrix(this.matrix);this.stack.push(n),this.nativeContext.save()}highPerformanceSave(){const n=this.cloneMatrix(this.matrix);this.stack.push(n)}scale(n,t,e=!0){this.matrix.scale(n,t),e&&this.setTransformForCurrent()}setScale(n,t,e=!0){this.matrix.setScale(n,t),e&&this.setTransformForCurrent()}scalePoint(n,t,e,i,r=!0){this.translate(e,i,!1),this.scale(n,t,!1),this.translate(-e,-i,!1),r&&this.setTransformForCurrent()}setTransform(n,t,e,i,r,o,s=!0,a=this.dpr){this.matrix.setValue(a*n,a*t,a*e,a*i,a*r,a*o),s&&this.setTransformForCurrent()}setTransformFromMatrix(n,t=!0,e=this.dpr){this.matrix.setValue(n.a*e,n.b*e,n.c*e,n.d*e,n.e*e,n.f*e),t&&this.setTransformForCurrent()}resetTransform(n=!0,t=this.dpr){this.setTransform(t,0,0,t,0,0),n&&this.setTransformForCurrent()}transform(n,t,e,i,r,o,s=!0){this.matrix.multiply(n,t,e,i,r,o),s&&this.setTransformForCurrent()}transformFromMatrix(n,t){this.matrix.multiply(n.a,n.b,n.c,n.d,n.e,n.f),t&&this.setTransformForCurrent()}translate(n,t,e=!0){this.matrix.translate(n,t),e&&this.setTransformForCurrent()}rotateDegrees(n,t=!0){const e=n*Math.PI/180;this.rotate(e,t)}rotateAbout(n,t,e,i=!0){this.translate(t,e,!1),this.rotate(n,!1),this.translate(-t,-e,!1),i&&this.setTransformForCurrent()}rotateDegreesAbout(n,t,e,i=!0){this.translate(t,e,!1),this.rotateDegrees(n,!1),this.translate(-t,-e,!1),i&&this.setTransformForCurrent()}beginPath(){this.disableBeginPath||this.nativeContext.beginPath()}clip(n,t){n?typeof n=="string"?this.nativeContext.clip(n):this.nativeContext.clip(n,t):this.nativeContext.clip()}arc(n,t,e,i,r,o,s){if(s=s||0,this.camera){const a=[];HZ(a,i,r,n,t,e,e,o);for(let l=0;l<a.length;++l){const h=a[l];this.bezierCurveTo(h[0],h[1],h[2],h[3],h[4],h[5],s)}}else this.nativeContext.arc(n,t,Math.max(0,e),i,r,o)}arcTo(n,t,e,i,r){this.nativeContext.arcTo(n,t,e,i,r)}bezierCurveTo(n,t,e,i,r,o,s){if(s=s||0,this.camera){let a=s,l=s;this.modelMatrix&&(Nr($t,[n,t,s],this.modelMatrix),n=$t[0],t=$t[1],a=$t[2],Nr($t,[e,i,s],this.modelMatrix),e=$t[0],i=$t[1],l=$t[2],Nr($t,[r,o,s],this.modelMatrix),r=$t[0],o=$t[1],s=$t[2]);let h=this.camera.vp(r,o,s);r=h.x,o=h.y,h=this.camera.vp(n,t,a),n=h.x,t=h.y,h=this.camera.vp(e,i,l),e=h.x,i=h.y}this.nativeContext.bezierCurveTo(n,t,e,i,r,o)}closePath(){this.nativeContext.closePath()}ellipse(n,t,e,i,r,o,s,a){a==null?this.nativeContext.ellipse(n,t,e,i,r,o,s):this.nativeContext.ellipse(n,t,e,i,r,o,s,a)}lineTo(n,t,e){if(e=e||0,this.camera){this.modelMatrix&&(Nr($t,[n,t,e],this.modelMatrix),n=$t[0],t=$t[1],e=$t[2]);const i=this.camera.vp(n,t,e);n=i.x,t=i.y}this.nativeContext.lineTo(n,t)}moveTo(n,t,e){if(e=e||0,this.camera){this.modelMatrix&&(Nr($t,[n,t,e],this.modelMatrix),n=$t[0],t=$t[1],e=$t[2]);const i=this.camera.vp(n,t,e);n=i.x,t=i.y}this.nativeContext.moveTo(n,t)}quadraticCurveTo(n,t,e,i,r){if(r=r||0,this.camera){let o=r;this.modelMatrix&&(Nr($t,[n,t,r],this.modelMatrix),n=$t[0],t=$t[1],o=$t[2],Nr($t,[e,i,r],this.modelMatrix),e=$t[0],i=$t[1],r=$t[2]);let s=this.camera.vp(e,i,r);e=s.x,i=s.y,s=this.camera.vp(n,t,o),n=s.x,t=s.y}this.nativeContext.quadraticCurveTo(n,t,e,i)}rect(n,t,e,i,r){r=r||0,this.camera?(this.moveTo(n,t,r),this.lineTo(n+e,t,r),this.lineTo(n+e,t+i,r),this.lineTo(n,t+i,r),this.closePath()):this.nativeContext.rect(n,t,e,i)}createImageData(){const n=arguments;return n.length===2?this.nativeContext.createImageData(n[0],n[1]):n.length===1?this.nativeContext.createImageData(n[0]):null}createLinearGradient(n,t,e,i){return isFinite(n+t+e+i)||(n=0,t=0,e=0,i=0),this.nativeContext.createLinearGradient(n,t,e,i)}createPattern(n,t){return n.width===0||n.height===0?null:this.nativeContext.createPattern(n,t)}createRadialGradient(n,t,e,i,r,o){return this.nativeContext.createRadialGradient(n,t,e,i,r,o)}createConicGradient(n,t,e,i){if(this.nativeContext.createConicGradient&&Math.abs(i-e-2*Math.PI)<.001)return this.nativeContext.createConicGradient(e,n,t);let r,o=!1;const s=this;return{stops:[],addColorStop(a,l){this.stops.push([a,l]),o=!0},GetPattern(a,l,h){return o&&(h||(h=i-e),r=zX(s,this.stops,n,t,h,e,i,a,l),o=!1),r}}}fill(n,t){this.disableFill||(n?this.nativeContext.fill(n):this.nativeContext.fill())}fillRect(n,t,e,i){this.nativeContext.fillRect(n,t,e,i)}clearRect(n,t,e,i){this.nativeContext.clearRect(n,t,e,i)}project(n,t,e){if(e=e||0,this.camera){this.modelMatrix&&(Nr($t,[n,t,e],this.modelMatrix),n=$t[0],t=$t[1],e=$t[2]);const i=this.camera.vp(n,t,e);n=i.x,t=i.y}return{x:n,y:t}}view(n,t,e){return e=e||0,this.camera?(this.modelMatrix&&(Nr($t,[n,t,e],this.modelMatrix),n=$t[0],t=$t[1],e=$t[2]),this.camera.view(n,t,e)):[n,t,e]}fillText(n,t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(Nr($t,[t,e,i],this.modelMatrix),t=$t[0],e=$t[1],i=$t[2]);const r=this.camera.vp(t,e,i);t=r.x,e=r.y}this.nativeContext.fillText(n,t,e)}getImageData(n,t,e,i){return this.nativeContext.getImageData(n,t,e,i)}getLineDash(){return this.nativeContext.getLineDash()}isPointInPath(n,t){return this.nativeContext.isPointInPath(n,t)}isPointInStroke(n,t){return this.nativeContext.isPointInStroke(n,t)}measureText(n,t=mt.global.measureTextMethod){var e,i;if(!t||t==="native")return this.nativeContext.measureText(n);this.mathTextMeasure||(this.mathTextMeasure=mt.graphicUtil.createTextMeasureInstance({},{},(()=>this.canvas.nativeCanvas)));const r=(e=this.fontFamily)!==null&&e!==void 0?e:zn.fontFamily,o=(i=this.fontSize)!==null&&i!==void 0?i:zn.fontSize;return this.mathTextMeasure.textSpec.fontFamily===r&&this.mathTextMeasure.textSpec.fontSize===o||(this.mathTextMeasure.textSpec.fontFamily=r,this.mathTextMeasure.textSpec.fontSize=o,this.mathTextMeasure._numberCharSize=null,this.mathTextMeasure._fullCharSize=null,this.mathTextMeasure._letterCharSize=null,this.mathTextMeasure._specialCharSizeMap={}),this.mathTextMeasure.measure(n,t)}putImageData(n,t,e){this.nativeContext.putImageData(n,t,e)}setLineDash(n){const t=arguments,e=this.nativeContext;this.nativeContext.setLineDash?t[0]&&e.setLineDash(t[0]):"mozDash"in e?e.mozDash=t[0]:"webkitLineDash"in e&&(e.webkitLineDash=t[0])}stroke(n){this.disableStroke||(n?this.nativeContext.stroke(n):this.nativeContext.stroke())}strokeRect(n,t,e,i){this.nativeContext.strokeRect(n,t,e,i)}strokeText(n,t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(Nr($t,[t,e,i],this.modelMatrix),t=$t[0],e=$t[1],i=$t[2]);const r=this.camera.vp(t,e,i);t=r.x,e=r.y}this.nativeContext.strokeText(n,t,e)}drawImage(){const n=this.nativeContext,t=arguments;t.length===3?n.drawImage(t[0],t[1],t[2]):t.length===5?n.drawImage(t[0],t[1],t[2],t[3],t[4]):t.length===9&&n.drawImage(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}setCommonStyle(n,t,e,i,r){if(Array.isArray(r)){if(r.length<=1)return this._setCommonStyle(n,t,e,i,r[0]);const o=Object.create(r[0]);return r.forEach(((s,a)=>{a!==0&&Object.assign(o,s)})),this._setCommonStyle(n,t,e,i,o)}return this._setCommonStyle(n,t,e,i,r)}_setCommonStyle(n,t,e,i,r){const o=this.nativeContext;r||(r=this.fillAttributes);const{fillOpacity:s=r.fillOpacity,opacity:a=r.opacity,fill:l=r.fill}=t;o.globalAlpha=s*a*this.baseGlobalAlpha,s>1e-12&&a>1e-12&&(o.fillStyle=kp(this,l,n,e,i))}setShadowBlendStyle(n,t,e){if(Array.isArray(e)){if(e.length<=1)return this._setShadowBlendStyle(n,e[0]);const i=Object.create(e[0]);return e.forEach(((r,o)=>{o!==0&&Object.assign(i,r)})),this._setShadowBlendStyle(n,t,i)}return this._setShadowBlendStyle(n,t,e)}_setShadowBlendStyle(n,t,e){const i=this.nativeContext;e||(e=this.fillAttributes);const{opacity:r=e.opacity,shadowBlur:o=e.shadowBlur,shadowOffsetX:s=e.shadowOffsetX,shadowOffsetY:a=e.shadowOffsetY,blur:l=e.blur,globalCompositeOperation:h=e.globalCompositeOperation}=t;if(!(r<=1e-12)){if(s||a||o){const{shadowColor:u=e.shadowColor,shadowOffsetX:d=e.shadowOffsetX,shadowOffsetY:c=e.shadowOffsetY}=t;i.shadowBlur=o*this.dpr,i.shadowColor=u,i.shadowOffsetX=d*this.dpr,i.shadowOffsetY=c*this.dpr,this._clearShadowStyle=!0}else this._clearShadowStyle&&(i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0);l?(i.filter=`blur(${l}px)`,this._clearFilterStyle=!0):this._clearFilterStyle&&(i.filter="blur(0px)",this._clearFilterStyle=!1),h?(i.globalCompositeOperation=h,this._clearGlobalCompositeOperationStyle=!0):this._clearGlobalCompositeOperationStyle&&(i.globalCompositeOperation="source-over",this._clearGlobalCompositeOperationStyle=!1)}}setStrokeStyle(n,t,e,i,r){if(Array.isArray(r)){if(r.length<=1)return this._setStrokeStyle(n,t,e,i,r[0]);const o=Object.create(r[0]);return r.forEach(((s,a)=>{a!==0&&Object.assign(o,s)})),this._setStrokeStyle(n,t,e,i,o)}return this._setStrokeStyle(n,t,e,i,r)}_setStrokeStyle(n,t,e,i,r){const o=this.nativeContext;r||(r=this.strokeAttributes);const{strokeOpacity:s=r.strokeOpacity,opacity:a=r.opacity}=t;if(o.globalAlpha=s*a*this.baseGlobalAlpha,s>1e-12&&a>1e-12){const{lineWidth:l=r.lineWidth,stroke:h=r.stroke,lineJoin:u=r.lineJoin,lineDash:d=r.lineDash,lineDashOffset:c=r.lineDashOffset,lineCap:g=r.lineCap,miterLimit:f=r.miterLimit,keepStrokeScale:p=r.keepStrokeScale}=t;o.lineWidth=p?l:jo(this,l,this.dpr),o.strokeStyle=kp(this,h,n,e,i),o.lineJoin=u,d&&(o.setLineDash(d),o.lineDashOffset=c),o.lineCap=g,o.miterLimit=f}}setTextStyleWithoutAlignBaseline(n,t,e){const i=this.nativeContext;t||(t=this.textAttributes);const{scaleIn3d:r=t.scaleIn3d}=n;n.font?this.font=n.font:this.font=dR(n,t,r&&this.camera&&this.camera.getProjectionScale(e));const{fontFamily:o=t.fontFamily,fontSize:s=t.fontSize}=n;this.fontFamily=o,this.fontSize=s,i.textAlign="left",i.textBaseline="alphabetic"}setTextStyle(n,t,e){var i,r;const o=this.nativeContext;t||(t=this.textAttributes),n.font?this.font=n.font:this.font=dR(n,t,this.camera&&this.camera.getProjectionScale(e));const{fontFamily:s=t.fontFamily,fontSize:a=t.fontSize}=n;this.fontFamily=s,this.fontSize=a,o.textAlign=(i=n.textAlign)!==null&&i!==void 0?i:t.textAlign,o.textBaseline=(r=n.textBaseline)!==null&&r!==void 0?r:t.textBaseline}draw(){}clearMatrix(n=!0,t=this.dpr){this.setTransformFromMatrix(this._clearMatrix,n,t)}setClearMatrix(n,t,e,i,r,o){this._clearMatrix.setValue(n,t,e,i,r,o)}onlyTranslate(n=this.dpr){return this.matrix.a===n&&this.matrix.b===0&&this.matrix.c===0&&this.matrix.d===n}release(...n){this.stack.forEach((t=>Ki.free(t))),this.stack.length=0}};Oh.env="browser",Oh=OZ([pt(),IZ("design:paramtypes",[Object,Number])],Oh);var DZ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},FZ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let Ih=class extends px{constructor(n){super(n)}init(n){const{container:t}=n;if(typeof t=="string"){const e=mt.global.getElementById(t);e&&(this._container=e)}else this._container=t;this._context=new Oh(this,this._dpr),this.initStyle()}initStyle(){if(!this.controled)return;const{nativeCanvas:n}=this;n.width=this._pixelWidth,n.height=this._pixelHeight,!n.style||this.setCanvasStyle(n,this._x,this._y,this._displayWidth,this._displayHeight),this._container&&this._container.appendChild(n),this.visiable||this.hide()}hide(){this._nativeCanvas&&(this._nativeCanvas.style.display="none")}show(){this._nativeCanvas&&(this._nativeCanvas.style.display="block")}applyPosition(){const n=this._nativeCanvas;n.style.position="absolute",n.style.top=`${this._y}px`,n.style.left=`${this._x}px`}resetStyle(n){if(!this.controled)return;const{width:t=this._displayWidth,height:e=this._displayHeight,dpr:i=this._dpr,x:r=this._x,y:o=this._y}=n,{nativeCanvas:s}=this;s.width=t*i,s.height=e*i,!s.style||this.setCanvasStyle(s,r,o,t,e),n.id&&(s.id=n.id),this.visiable||this.hide()}setCanvasStyle(n,t,e,i,r){this.controled&&(n.style.width=`${i}px`,n.style.height=`${r}px`)}toDataURL(n,t){return n==="image/jpeg"?this._nativeCanvas.toDataURL(n,t):n==="image/png"?this._nativeCanvas.toDataURL(n):this._nativeCanvas.toDataURL(n,t)}resize(n,t){this.controled&&(this._pixelWidth=n*this._dpr,this._pixelHeight=t*this._dpr,this._displayWidth=n,this._displayHeight=t,this._nativeCanvas.style&&(this._nativeCanvas.style.width=`${n}px`,this._nativeCanvas.style.height=`${t}px`),this._nativeCanvas.width=this._pixelWidth,this._nativeCanvas.height=this._pixelHeight,this._context.dpr=this._dpr)}};Ih.env="browser",Ih=DZ([pt(),FZ("design:paramtypes",[Object])],Ih);function lH(n,t){return new Ot((e=>{e(lI).toDynamicValue((()=>i=>new n(i))).whenTargetNamed(n.env),e(L$).toDynamicValue((()=>(i,r)=>new t(i,r))).whenTargetNamed(t.env)}))}const zZ=lH(Ih,Oh);var NZ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},WZ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Ea=function(n,t){return function(e,i){t(e,i,n)}};let _h=class extends dw{constructor(n,t,e,i){super(e,i),this.contributions=n,this.drawContribution=t,this.pickItemInterceptorContributions=e,this.pickServiceInterceptorContributions=i,this.global.hooks.onSetEnv.tap("canvas-picker-service",((r,o,s)=>{this.configure(s,o)})),this.configure(this.global,this.global.env),this.pickerMap=new Map,this.init()}init(){this.contributions.getContributions().forEach((n=>{this.pickerMap.set(n.numberType,n)})),super._init()}configure(n,t){this.pickCanvas=_l.shareCanvas(),this.pickContext=this.pickCanvas.getContext("2d")}pickItem(n,t,e,i){if(n.attribute.pickable===!1)return null;if(this.InterceptorContributions.length)for(let l=0;l<this.InterceptorContributions.length;l++){const h=this.InterceptorContributions[l];if(h.beforePickItem){const u=h.beforePickItem(n,this,t,i,{parentMatrix:e});if(u)return u}}const r=this.pickerMap.get(n.numberType);if(!r)return null;const o=r.contains(n,t,i),s=o?n:null,a={graphic:s,params:o};if(s)return a;if(this.InterceptorContributions.length)for(let l=0;l<this.InterceptorContributions.length;l++){const h=this.InterceptorContributions[l];if(h.afterPickItem){const u=h.afterPickItem(n,this,t,i,{parentMatrix:e});if(u)return u}}return a}};_h=NZ([pt(),Ea(0,Xt(li)),Ea(0,Li(Vn)),Ea(1,Xt(wx)),Ea(2,Xt(li)),Ea(2,Li(vh)),Ea(3,Xt(li)),Ea(3,Li(Qp)),WZ("design:paramtypes",[Object,Object,Object,Object])],_h);var jZ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let mw=class{constructor(){this.type="group",this.numberType=ux}contains(n,t,e){return!1}};mw=jZ([pt()],mw);const f0=new Ot(((n,t,e,i)=>{f0.__vloaded||(f0.__vloaded=!0,n(lR).to(mw).inSingletonScope(),n(Vn).toService(lR),cn(n,Vn))}));f0.__vloaded=!1;const VZ=new Ot(((n,t,e,i)=>{e(_h)||n(_h).toSelf().inSingletonScope(),e(Eh)?i(Eh).toService(_h):n(Eh).toService(_h)}));function GZ(n){n.load(f0),n.load(VZ)}var wd,$Z=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},UZ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let qs=wd=class extends l0{get container(){return this.canvas.nativeCanvas.parentElement}static GenerateCanvasId(){return`${wd.idprefix}_${wd.prefix_count++}`}constructor(){super(),this.type="browser",this._canvasIsIntersecting=!0,this.global=mt.global,this.viewBox=new kx,this.modelMatrix=new Bo(1,0,0,1,0,0)}getTitle(){return this.canvas.id&&this.canvas.id.toString()}getWH(){return{width:this.canvas.width/(this.canvas.dpr||1),height:this.canvas.height/(this.canvas.dpr||1)}}getXY(){return this.canvas.nativeCanvas.getBoundingClientRect()}createWindow(n){n.canvas?this.createWindowByCanvas(n):this.createWindowByConfig(n),this.postInit()}postInit(){if(this.global.optimizeVisible)try{this.observerCanvas()}catch{}}isElementVisible(n){const t=n.getBoundingClientRect(),e=window.innerWidth||document.documentElement.clientWidth,i=window.innerHeight||document.documentElement.clientHeight;return!(t.right<0||t.bottom<0||t.left>e||t.top>i)}observerCanvas(){this._canvasIsIntersecting=this.isElementVisible(this.canvas.nativeCanvas);const n=new IntersectionObserver(((t,e)=>{t.forEach((i=>{this._canvasIsIntersecting!==i.isIntersecting?(this._canvasIsIntersecting=i.isIntersecting,this._onVisibleChangeCb&&this._onVisibleChangeCb(i.isIntersecting)):this._canvasIsIntersecting=i.isIntersecting}))}));n&&n.observe(this.canvas.nativeCanvas)}createWindowByConfig(n){const t=this.global.createCanvas({width:n.width,height:n.height});let e;if(e=typeof n.container=="string"?this.global.getElementById(n.container):n.container?n.container:this.global.getRootElement(),!e)throw new Error("发生错误，containerId可能传入有误");n.offscreen?e=null:e.appendChild(t);const i={width:n.width,height:n.height,dpr:n.dpr,nativeCanvas:t,container:e,id:wd.GenerateCanvasId(),canvasControled:!0};this.canvas=new Ih(i)}createWindowByCanvas(n){var t;let e;if(typeof n.canvas=="string"){if(e=this.global.getElementById(n.canvas),!e)throw new Error("canvasId 参数不正确，请确认canvas存在并插入dom")}else e=n.canvas;if(!e)throw new Error("发生错误，传入的canvas不正确");let i=n.width,r=n.height;if(i==null||r==null||!n.canvasControled){const s=e.getBoundingClientRect();i=s.width,r=s.height}let o=n.dpr;o==null&&(o=(t=e.getContext("2d").pixelRatio)!==null&&t!==void 0?t:e.width/i),this.canvas=new Ih({width:i,height:r,dpr:o,nativeCanvas:e,canvasControled:n.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(n,t){this.canvas.resize(n,t)}setDpr(n){this.canvas.dpr=n}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}addEventListener(n,t,e){return this.canvas.nativeCanvas.addEventListener(n,t,e)}removeEventListener(n,t,e){return this.canvas.nativeCanvas.removeEventListener(n,t,e)}dispatchEvent(n){return this.canvas.nativeCanvas.dispatchEvent(n)}getStyle(){var n;return(n=this.canvas.nativeCanvas.style)!==null&&n!==void 0?n:{}}setStyle(n){this.canvas.nativeCanvas.style=n}getBoundingClientRect(){const n=this.canvas.nativeCanvas,t=this.getWH();return n.parentElement?this.canvas.nativeCanvas.getBoundingClientRect():{x:0,y:0,width:t.width,height:t.height,left:0,top:0,right:0,bottom:0}}clearViewBox(n){const t=this.viewBox,e=this.getContext(),i=this.getDpr();e.nativeContext.save(),e.nativeContext.setTransform(i,0,0,i,0,0),e.clearRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1),n&&(e.fillStyle=n,e.fillRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1)),e.nativeContext.restore()}isVisible(n){return this._canvasIsIntersecting}onVisibleChange(n){this._onVisibleChangeCb=n}getTopLeft(n){return this.global.getElementTopLeft(this.canvas.nativeCanvas,n)}};qs.env="browser",qs.idprefix="visactor_window",qs.prefix_count=0,qs=wd=$Z([pt(),UZ("design:paramtypes",[])],qs);const XZ=new Ot((n=>{n(qs).toSelf(),n(ax).toDynamicValue((t=>t.container.get(qs))).whenTargetNamed(qs.env)}));var YZ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},qZ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},KZ=function(n,t,e,i){return new(e||(e=Promise))((function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e((function(d){d(u)}))).then(s,a)}l((i=i.apply(n,t||[])).next())}))};class ZZ{get x1(){return this.dom.getBoundingClientRect().left}get x2(){return this.dom.getBoundingClientRect().right}get y1(){return this.dom.getBoundingClientRect().top}get y2(){return this.dom.getBoundingClientRect().bottom}get width(){return this.dom.getBoundingClientRect().width}get height(){return this.dom.getBoundingClientRect().height}constructor(t){this.dom=t}}function gR(n,t=!1){const e=document.createElement("img");if(mt.global.isImageAnonymous&&(e.crossOrigin="anonymous"),t){const i=new Blob([n],{type:"image/svg+xml"});n=window.URL.createObjectURL(i)}return e.src=n,e.complete?Promise.resolve(e):new Promise(((i,r)=>{e.onload=()=>{i(e)},e.onerror=()=>{r(new Error("加载失败"))}}))}let p0=class extends a0{constructor(){super(),this.type="browser",this.supportEvent=!0;try{this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.supportsMouseEvents=!!globalThis.MouseEvent}catch{this.supportsTouchEvents=!1,this.supportsPointerEvents=!1,this.supportsPointerEvents=!1}this.applyStyles=!0}mapToCanvasPoint(n,t){var e,i;let r=0,o=0,s=0,a=0;if(n.changedTouches){const l=(e=n.changedTouches[0])!==null&&e!==void 0?e:{};r=l.clientX||0,o=l.clientY||0,s=r,a=o}else r=n.clientX||0,o=n.clientY||0,s=n.offsetX||0,a=n.offsetY||0;if(t){const l=r,h=o,u=t.getBoundingClientRect(),d=(i=t.getNativeHandler)===null||i===void 0?void 0:i.call(t).nativeCanvas;let c,g;return d&&(c=u.width/d.offsetWidth,g=u.height/d.offsetHeight),{x:(l-u.left)/(hR(c)?c:1),y:(h-u.top)/(hR(g)?g:1)}}return{x:s,y:a}}getNativeAABBBounds(n){let t=n;if(typeof n=="string"&&(t=new DOMParser().parseFromString(n,"text/html").firstChild,t.lastChild&&(t=t.lastChild.firstChild)),t.getBoundingClientRect){const e=t.getBoundingClientRect();return new ZZ(e)}return new kx}removeDom(n){return n.parentElement.removeChild(n),!0}updateDom(n,t){const{width:e,height:i,style:r}=t;return r&&(ay(r)?n.setAttribute("style",r):Object.keys(r).forEach((o=>{n.style[o]=r[o]}))),e!=null&&(n.style.width=`${e}px`),i!=null&&(n.style.height=`${i}px`),!0}createDom(n){const{tagName:t="div",parent:e}=n,i=document.createElement(t);if(this.updateDom(i,n),e){const r=ay(e)?this.getElementById(e):e;r&&r.appendChild&&r.appendChild(i)}return i}loadImage(n){return gR(n,!1).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}loadSvg(n){return gR(n,!0).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}createCanvas(n){var t,e;const i=document.createElement("canvas");n.id&&(i.id=(t=n.id)!==null&&t!==void 0?t:Ci.GenAutoIncrementId().toString());const r=(e=n.dpr)!==null&&e!==void 0?e:window.devicePixelRatio;return n.width&&n.height&&(i.style.width=`${n.width}px`,i.style.height=`${n.height}px`,i.width=n.width*r,i.height=n.height*r),i}createOffscreenCanvas(n){var t;const e=(t=n.dpr)!==null&&t!==void 0?t:window.devicePixelRatio;return new OffscreenCanvas(n.width*e,n.height*e)}releaseCanvas(n){let t;t=typeof n=="string"?document.getElementById(n):n,t&&t.parentElement&&t.parentElement.removeChild(t)}getDevicePixelRatio(){return window.devicePixelRatio}getRequestAnimationFrame(){return window.requestAnimationFrame}getCancelAnimationFrame(){return window.cancelAnimationFrame}addEventListener(n,t,e){return document.addEventListener(n,t,e)}removeEventListener(n,t,e){return document.removeEventListener(n,t,e)}dispatchEvent(n){return document.dispatchEvent(n)}getElementById(n){return document.getElementById(n)}getRootElement(){return document.body}getDocument(){return document}release(...n){}getElementTop(n,t){let e=n.offsetTop,i=n.offsetParent;for(;i!==null;)e+=i.offsetTop,i=i.offsetParent;return e}getElementLeft(n,t){let e=n.offsetLeft,i=n.offsetParent;for(;i!==null;)e+=i.offsetLeft,i=i.offsetParent;return e}getElementTopLeft(n,t){let e=n.offsetTop,i=n.offsetLeft,r=n.offsetParent;for(;r!==null;)e+=r.offsetTop,i+=r.offsetLeft,r=r.offsetParent;return{top:e,left:i}}loadFont(n,t,e){return KZ(this,void 0,void 0,(function*(){return new FontFace(n,ay(t)?`url(${t})`:t,e).load().then((function(i){return document.fonts.add(i),{loadState:"success"}})).catch((function(i){return{loadState:"fail"}}))}))}isMacOS(){if(this._isMacOS===void 0)try{this._isMacOS=navigator.platform.toUpperCase().indexOf("MAC")>=0}catch{this._isMacOS=!1}return this._isMacOS}copyToClipBoard(n){return navigator.clipboard.writeText(n).then((()=>{})).catch((t=>{}))}};p0=YZ([pt(),qZ("design:paramtypes",[])],p0);const m0=new Ot((n=>{m0.isBrowserBound||(m0.isBrowserBound=!0,n(p0).toSelf().inSingletonScope(),n(ov).toService(p0))}));m0.isBrowserBound=!1;function v0(n,t=!0){v0.__loaded||(v0.__loaded=!0,n.load(m0),n.load(zZ),n.load(XZ),t&&GZ(n))}v0.__loaded=!1;class Go{contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise"||!this.canvasRenderer)return!0;const{pickContext:r}=i??{};if(!r)return!1;const o=t.getGraphicTheme();r.highPerformanceSave();let{x:s=o.x,y:a=o.y}=t.attribute;if(t.transMatrix.onlyTranslate()){const u=t.getOffsetXY(o);s+=u.x,a+=u.y,r.setTransformForCurrent()}else s=0,a=0,r.transformFromMatrix(t.transMatrix,!0);let l=!1,h=!1;return this.canvasRenderer.drawShape(t,r,s,a,{},null,((u,d,c,g)=>!(!l&&!h)||(l=u.isPointInPath(e.x,e.y),h=g||h,l)),((u,d,c,g)=>{if(l||h)return!0;const f=d.lineWidth||c.lineWidth,p=d.pickStrokeBuffer||c.pickStrokeBuffer,m=d.keepStrokeScale||c.keepStrokeScale;return r.lineWidth=m?f+p:jo(r,f+p,r.dpr),l=u.isPointInStroke(e.x,e.y),h=g||h,l})),r.highPerformanceRestore(),l}}var JZ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},QZ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},tJ=function(n,t){return function(e,i){t(e,i,n)}};let vw=class extends Go{constructor(n){super(),this.canvasRenderer=n,this.type="arc",this.numberType=hv}};vw=JZ([pt(),tJ(0,Xt($p)),QZ("design:paramtypes",[Object])],vw);let fR=!1;const eJ=new Ot(((n,t,e,i)=>{fR||(fR=!0,n(GT).to(vw).inSingletonScope(),n(Ta).toService(GT))}));var iJ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},nJ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},rJ=function(n,t){return function(e,i){t(e,i,n)}};let bw=class extends Go{constructor(n){super(),this.canvasRenderer=n,this.type="circle",this.numberType=uv}};bw=iJ([pt(),rJ(0,Xt(Up)),nJ("design:paramtypes",[Object])],bw);let pR=!1;const oJ=new Ot(((n,t,e,i)=>{pR||(pR=!0,n($T).to(bw).inSingletonScope(),n(Ta).toService($T))}));var sJ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let xu=class{constructor(){this.type="image",this.numberType=dv}contains(n,t,e){const{pickContext:i}=e??{};return!!i&&!!n.AABBBounds.containsPoint(t)}};xu=sJ([pt()],xu);let mR=!1;const aJ=new Ot(((n,t,e,i)=>{mR||(mR=!0,n(g0).to(xu).inSingletonScope(),n(xu).toService(g0))}));var lJ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},hJ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},uJ=function(n,t){return function(e,i){t(e,i,n)}};let yw=class extends Go{constructor(n){super(),this.canvasRenderer=n,this.type="line",this.numberType=lg}};yw=lJ([pt(),uJ(0,Xt(Xp)),hJ("design:paramtypes",[Object])],yw);let vR=!1;const dJ=new Ot(((n,t,e,i)=>{vR||(vR=!0,n(UT).to(yw).inSingletonScope(),n(Ta).toService(UT))}));var cJ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},gJ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},fJ=function(n,t){return function(e,i){t(e,i,n)}};let Cw=class extends Go{constructor(n){super(),this.canvasRenderer=n,this.type="polygon",this.numberType=gv}};Cw=cJ([pt(),fJ(0,Xt(qp)),gJ("design:paramtypes",[Object])],Cw);let bR=!1;const pJ=new Ot(((n,t,e,i)=>{bR||(bR=!0,n(ZT).to(Cw).inSingletonScope(),n(Ta).toService(ZT))}));var mJ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},vJ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},bJ=function(n,t){return function(e,i){t(e,i,n)}};let _w=class extends Go{constructor(n){super(),this.canvasRenderer=n,this.type="path",this.numberType=cv}};_w=mJ([pt(),bJ(0,Xt(Yp)),vJ("design:paramtypes",[Object])],_w);let yR=!1;const yJ=new Ot(((n,t,e,i)=>{yR||(yR=!0,n(XT).to(_w).inSingletonScope(),n(Ta).toService(XT))})),ly=new kx;class hH{constructor(){this.type="rect",this.numberType=dx}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise")return!0;const{pickContext:r}=i??{};if(!r)return!1;const o=t.getGraphicTheme(),{cornerRadius:s=o.cornerRadius}=t.attribute;let{x:a=o.x,y:l=o.y}=t.attribute;r.highPerformanceSave();let h=!0;if(t.transMatrix.onlyTranslate()){const d=t.getOffsetXY(o);a+=d.x,l+=d.y,r.setTransformForCurrent()}else a=0,l=0,h=!1,r.transformFromMatrix(t.transMatrix,!0);let u=!0;if(!h||t.shadowRoot||Bx(s,!0)&&s!==0||oH(s)&&s.some((d=>d!==0)))u=!1,this.canvasRenderer.drawShape(t,r,a,l,{},null,((d,c,g)=>!!u||(u=d.isPointInPath(e.x,e.y),u)),((d,c,g)=>{if(u)return!0;const f=c.lineWidth||g.lineWidth,p=c.pickStrokeBuffer||g.pickStrokeBuffer,m=c.keepStrokeScale||g.keepStrokeScale;return r.lineWidth=m?f+p:jo(r,f+p,r.dpr),u=d.isPointInStroke(e.x,e.y),u}));else{const{fill:d=o.fill,stroke:c=o.stroke,lineWidth:g=o.lineWidth}=t.attribute;if(d)u=!0;else if(c){const f=t.AABBBounds;ly.setValue(f.x1,f.y1,f.x2,f.y2),ly.expand(-g/2),u=!ly.containsPoint(e)}}return r.highPerformanceRestore(),u}}var CJ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},_J=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},wJ=function(n,t){return function(e,i){t(e,i,n)}};let ww=class extends hH{constructor(n){super(),this.canvasRenderer=n}};ww=CJ([pt(),wJ(0,Xt(Kp)),_J("design:paramtypes",[Object])],ww);let CR=!1;const xJ=new Ot(((n,t,e,i)=>{CR||(CR=!0,n(YT).to(ww).inSingletonScope(),n(Ta).toService(YT))}));let _R=!1;const SJ=new Ot(((n,t,e,i)=>{_R||(_R=!0,n(g0).to(xu).inSingletonScope(),n(xu).toService(g0))}));var AJ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},MJ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},TJ=function(n,t){return function(e,i){t(e,i,n)}};let xw=class extends Go{constructor(n){super(),this.canvasRenderer=n,this.type="symbol",this.numberType=fv}};xw=AJ([pt(),TJ(0,Xt(Zp)),MJ("design:paramtypes",[Object])],xw);let wR=!1;const RJ=new Ot(((n,t,e,i)=>{wR||(wR=!0,n(qT).to(xw).inSingletonScope(),n(Ta).toService(qT))}));var BJ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let Sw=class{constructor(){this.type="text",this.numberType=pv}contains(n,t,e){return!!n.AABBBounds.containsPoint(t)}};Sw=BJ([pt()],Sw);let xR=!1;const kJ=new Ot(((n,t,e,i)=>{xR||(xR=!0,n(KT).to(Sw).inSingletonScope(),n(Ta).toService(KT))}));var PJ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},EJ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let Nd=class extends Oh{constructor(n,t){super(n,t);const e=n.nativeCanvas.getContext("2d");if(!e)throw new Error("发生错误，获取2d上下文失败");this.nativeContext=e,this.canvas=n,this.matrix=new Bo(1,0,0,1,0,0),this.stack=[],this.dpr=t??1}release(...n){}};Nd.env="node",Nd=PJ([pt(),EJ("design:paramtypes",[Object,Number])],Nd);var LJ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},OJ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let Hh=class extends px{constructor(n){super(n)}init(){this._context=new Nd(this,this._dpr),this.nativeCanvas.width=this._pixelWidth,this.nativeCanvas.height=this._pixelHeight}release(...n){this._nativeCanvas.release&&AZ(this._nativeCanvas.release)&&this._nativeCanvas.release()}};Hh.env="node",Hh=LJ([pt(),OJ("design:paramtypes",[Object])],Hh);const IJ=lH(Hh,Nd);var HJ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},DJ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},FJ=function(n,t){return function(e,i){t(e,i,n)}};let Dh=class extends l0{get container(){return null}constructor(n){super(),this.global=n,this.type="node"}getTitle(){return""}getWH(){return{width:this.canvas.displayWidth,height:this.canvas.displayHeight}}getXY(){return{x:0,y:0}}createWindow(n){n.canvas?this.createWindowByCanvas(n):this.createWindowByConfig(n)}createWindowByConfig(n){const t=this.global.createCanvas({width:n.width,height:n.height}),e={width:n.width,height:n.height,dpr:n.dpr,nativeCanvas:t,id:Ci.GenAutoIncrementId().toString(),canvasControled:!0};this.canvas=new Hh(e)}createWindowByCanvas(n){var t;const e=n.canvas,i=(t=n.dpr)!==null&&t!==void 0?t:1;let r=n.width,o=n.height;r!=null&&o!=null&&n.canvasControled||(r=e.width/i,o=e.height/i),this.canvas=new Hh({width:r,height:o,dpr:i,nativeCanvas:e,canvasControled:n.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(n,t){this.canvas.resize(n,t)}setDpr(n){this.canvas.dpr=n}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}getImageBuffer(n="image/png"){return this.canvas.nativeCanvas.toBuffer(n)}addEventListener(n,t,e){}dispatchEvent(n){return!0}removeEventListener(n,t,e){}getStyle(){}setStyle(n){}getBoundingClientRect(){return null}clearViewBox(n){}};Dh.env="node",Dh=HJ([pt(),FJ(0,Xt(tx)),DJ("design:paramtypes",[Object])],Dh);const zJ=new Ot((n=>{n(Dh).toSelf(),n(ax).toDynamicValue((t=>t.container.get(Dh))).whenTargetNamed(Dh.env)}));var NJ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let b0=class extends a0{constructor(){super(...arguments),this.type="node",this._lastTime=0,this.supportEvent=!1}configure(n,t){n.env===this.type&&(n.setActiveEnvContribution(this),this.pkg=t)}getDynamicCanvasCount(){return 0}getStaticCanvasCount(){return 999}loadJson(n){const t=fetch(n).then((e=>e.json()));return t.then((e=>({data:e,state:"success"}))).catch((()=>({data:null,state:"fail"}))),t}loadArrayBuffer(n){return fetch(n).then((t=>t.arrayBuffer())).then((t=>({data:t,loadState:"success"}))).catch((()=>({data:null,loadState:"fail"})))}loadImage(n){const{loadImage:t}=this.pkg;return t?t(n).then((e=>({loadState:e?"success":"fail",data:e}))).catch((()=>({loadState:"fail",data:null}))):Promise.reject(new Error("node-canvas loadImage could not be found!"))}loadSvg(n){const t=this.pkg.Resvg;if(!t)return Promise.reject(new Error("@resvg/resvg-js svgParser could not be found!"));const e=new t(n).render().asPng();return this.loadImage(e)}createCanvas(n){return this.pkg.createCanvas(n.width,n.height)}releaseCanvas(n){}getDevicePixelRatio(){return 1}getRequestAnimationFrame(){return function(n){return fM.call(n)}}getCancelAnimationFrame(){return n=>{fM.clear(n)}}addEventListener(n,t,e){}removeEventListener(n,t,e){}getElementById(n){return null}getRootElement(){return null}dispatchEvent(n){}release(...n){}createOffscreenCanvas(n){}};b0=NJ([pt()],b0);const y0=new Ot((n=>{y0.isNodeBound||(y0.isNodeBound=!0,n(b0).toSelf().inSingletonScope(),n(ov).toService(b0))}));y0.isNodeBound=!1;function C0(n,t=!0){C0.__loaded||(C0.__loaded=!0,n.load(y0),n.load(IJ),n.load(zJ))}C0.__loaded=!1;var WJ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},jJ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},VJ=function(n,t){return function(e,i){t(e,i,n)}};let Aw=class extends Go{constructor(n){super(),this.canvasRenderer=n,this.type="arc",this.numberType=hv}};Aw=WJ([pt(),VJ(0,Xt($p)),jJ("design:paramtypes",[Object])],Aw);let SR=!1;const GJ=new Ot(((n,t,e,i)=>{SR||(SR=!0,n(JT).to(Aw).inSingletonScope(),n(Vn).toService(JT))}));var $J=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},UJ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},XJ=function(n,t){return function(e,i){t(e,i,n)}};let Mw=class extends hH{constructor(n){super(),this.canvasRenderer=n}};Mw=$J([pt(),XJ(0,Xt(Kp)),UJ("design:paramtypes",[Object])],Mw);let AR=!1;const YJ=new Ot(((n,t,e,i)=>{AR||(AR=!0,n(nR).to(Mw).inSingletonScope(),n(Vn).toService(nR))}));class uH extends Gn{contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise")return!0;const{pickContext:r}=i??{};if(!r)return!1;r.highPerformanceSave();const o=t.getGraphicTheme(),s=this.transform(t,o,r),{x:a,y:l,z:h,lastModelMatrix:u}=s;let d=e;if(r.camera){d=e.clone();const g=t.parent.globalTransMatrix;d.x=g.a*e.x+g.c*e.y+g.e,d.y=g.b*e.x+g.d*e.y+g.f}this.canvasRenderer.z=h;let c=!1;return this.canvasRenderer.drawShape(t,r,a,l,{},null,(g=>!!c||(c=g.isPointInPath(d.x,d.y),c)),((g,f,p)=>{if(c)return!0;const m=f.lineWidth||p.lineWidth,v=f.pickStrokeBuffer||p.pickStrokeBuffer,b=f.keepStrokeScale||p.keepStrokeScale;return r.lineWidth=b?m+v:jo(r,m+v,r.dpr),c=g.isPointInStroke(d.x,d.y),c})),this.canvasRenderer.z=0,r.modelMatrix!==u&&Bi.free(r.modelMatrix),r.modelMatrix=u,r.highPerformanceRestore(),c}}var qJ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},KJ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},ZJ=function(n,t){return function(e,i){t(e,i,n)}};let Tw=class extends uH{constructor(n){super(),this.canvasRenderer=n,this.type="line",this.numberType=lg}};Tw=qJ([pt(),ZJ(0,Xt(Xp)),KJ("design:paramtypes",[Object])],Tw);let MR=!1;const JJ=new Ot(((n,t,e,i)=>{MR||(MR=!0,n(eR).to(Tw).inSingletonScope(),n(Vn).toService(eR))}));class dH extends Gn{contains(t,e,i){const{pickContext:r}=i??{};if(!r)return!1;const o=t.getGraphicTheme();r.highPerformanceSave();const s=this.transform(t,o,r),{x:a,y:l,z:h,lastModelMatrix:u}=s;let d=e;if(r.camera){d=e.clone();const g=t.parent.globalTransMatrix;d.x=g.a*e.x+g.c*e.y+g.e,d.y=g.b*e.x+g.d*e.y+g.f}this.canvasRenderer.z=h;let c=!1;return this.canvasRenderer.drawShape(t,r,a,l,i,null,((g,f,p)=>!!c||(c=g.isPointInPath(d.x,d.y),c))),this.canvasRenderer.z=0,r.modelMatrix!==u&&Bi.free(r.modelMatrix),r.modelMatrix=u,r.highPerformanceRestore(),c}}var QJ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},tQ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},eQ=function(n,t){return function(e,i){t(e,i,n)}};let Rw=class extends dH{constructor(n){super(),this.canvasRenderer=n,this.type="symbol",this.numberType=fv}contains(n,t,e){const{pickContext:i}=e??{};if(!i)return!1;const r=n.getParsedPath();if(!i.camera){if(!n.AABBBounds.containsPoint(t))return!1;if(r.isSvg||n.attribute.pickMode==="imprecise")return!0}i.highPerformanceSave();const o=n.getGraphicTheme(),s=this.transform(n,o,i),{x:a,y:l,z:h,lastModelMatrix:u}=s;let d=t;if(i.camera){d=t.clone();const g=n.parent.globalTransMatrix;d.x=g.a*t.x+g.c*t.y+g.e,d.y=g.b*t.x+g.d*t.y+g.f}this.canvasRenderer.z=h;let c=!1;return this.canvasRenderer.drawShape(n,i,a,l,{},null,((g,f,p)=>!!c||(c=g.isPointInPath(d.x,d.y),c)),((g,f,p)=>{if(c)return!0;const m=f.lineWidth||p.lineWidth,v=f.pickStrokeBuffer||p.pickStrokeBuffer,b=f.keepStrokeScale||p.keepStrokeScale;return i.lineWidth=b?m+v:jo(i,m+v,i.dpr),c=g.isPointInStroke(d.x,d.y),c})),this.canvasRenderer.z=0,i.modelMatrix!==u&&Bi.free(i.modelMatrix),i.modelMatrix=u,i.highPerformanceRestore(),c}};Rw=QJ([pt(),eQ(0,Xt(Zp)),tQ("design:paramtypes",[Object])],Rw);let TR=!1;const iQ=new Ot(((n,t,e,i)=>{TR||(TR=!0,n(rR).to(Rw).inSingletonScope(),n(Vn).toService(rR))}));var nQ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},rQ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},oQ=function(n,t){return function(e,i){t(e,i,n)}};let Bw=class extends Go{constructor(n){super(),this.canvasRenderer=n,this.type="circle",this.numberType=uv}};Bw=nQ([pt(),oQ(0,Xt(Up)),rQ("design:paramtypes",[Object])],Bw);let RR=!1;const sQ=new Ot(((n,t,e,i)=>{RR||(RR=!0,n(QT).to(Bw).inSingletonScope(),n(Vn).toService(QT))}));var aQ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},lQ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},hQ=function(n,t){return function(e,i){t(e,i,n)}};let kw=class extends dH{constructor(n){super(),this.canvasRenderer=n,this.type="text",this.numberType=pv}contains(n,t,e){const{pickContext:i}=e??{};if(!i)return!1;const r=n.AABBBounds;if(!i.camera)return!!r.containsPoint(t);i.highPerformanceSave();const o=n.getGraphicTheme(),{keepDirIn3d:s=o.keepDirIn3d}=n.attribute,a=!s,l=this.transform(n,o,i,a),{x:h,y:u,z:d,lastModelMatrix:c}=l;this.canvasRenderer.z=d;let g=t;if(i.camera){g=t.clone();const p=n.parent.globalTransMatrix;g.x=p.a*t.x+p.c*t.y+p.e,g.y=p.b*t.x+p.d*t.y+p.f}let f=!1;return this.canvasRenderer.drawShape(n,i,h,u,{},null,((p,m,v)=>{if(f)return!0;const{fontSize:b=o.fontSize,textBaseline:y=o.textBaseline,textAlign:C=o.textAlign}=n.attribute,w=n.AABBBounds,_=w.height(),A=w.width(),x=Rc(y,_,b),S=bu(C,A);return p.rect(S+h,x+u,A,_,d),f=p.isPointInPath(g.x,g.y),f}),((p,m,v)=>f)),this.canvasRenderer.z=0,i.modelMatrix!==c&&Bi.free(i.modelMatrix),i.modelMatrix=c,i.highPerformanceRestore(),f}};kw=aQ([pt(),hQ(0,Xt(nw)),lQ("design:paramtypes",[Object])],kw);let BR=!1;const uQ=new Ot(((n,t,e,i)=>{BR||(BR=!0,n(oR).to(kw).inSingletonScope(),n(Vn).toService(oR))}));var dQ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},cQ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},gQ=function(n,t){return function(e,i){t(e,i,n)}};let Pw=class extends uH{constructor(n){super(),this.canvasRenderer=n,this.type="path",this.numberType=cv}};Pw=dQ([pt(),gQ(0,Xt(Yp)),cQ("design:paramtypes",[Object])],Pw);let kR=!1;const fQ=new Ot(((n,t,e,i)=>{kR||(kR=!0,n(iR).to(Pw).inSingletonScope(),n(Vn).toService(iR))}));var pQ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},mQ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},vQ=function(n,t){return function(e,i){t(e,i,n)}};let Ew=class extends Go{constructor(n){super(),this.canvasRenderer=n,this.type="polygon",this.numberType=gv}};Ew=pQ([pt(),vQ(0,Xt(qp)),mQ("design:paramtypes",[Object])],Ew);let PR=!1;const bQ=new Ot(((n,t,e,i)=>{PR||(PR=!0,n(sR).to(Ew).inSingletonScope(),n(Vn).toService(sR))}));var yQ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},CQ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},_Q=function(n,t){return function(e,i){t(e,i,n)}};let Lw=class{constructor(n){this.canvasRenderer=n,this.type="richtext",this.numberType=cx}contains(n,t,e){return!!n.AABBBounds.containsPoint(t)}};Lw=yQ([pt(),_Q(0,Xt(rw)),CQ("design:paramtypes",[Object])],Lw);let ER=!1;const wQ=new Ot(((n,t,e,i)=>{ER||(ER=!0,n(aR).to(Lw).inSingletonScope(),n(Vn).toService(aR))}));var xQ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s},SQ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},AQ=function(n,t){return function(e,i){t(e,i,n)}};let Ow=class extends Go{constructor(n){super(),this.canvasRenderer=n,this.type="image",this.numberType=dv}};Ow=xQ([pt(),AQ(0,Xt(ow)),SQ("design:paramtypes",[Object])],Ow);let LR=!1;const MQ=new Ot(((n,t,e,i)=>{LR||(LR=!0,n(tR).to(Ow).inSingletonScope(),n(Vn).toService(tR))}));var Zo={},hy={},Jo={},OR;function cH(){if(OR)return Jo;OR=1,Object.defineProperty(Jo,"__esModule",{value:!0}),Jo.loop=Jo.conditional=Jo.parse=void 0;var n=function i(r,o){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:s;if(Array.isArray(o))o.forEach(function(h){return i(r,h,s,a)});else if(typeof o=="function")o(r,s,a,i);else{var l=Object.keys(o)[0];Array.isArray(o[l])?(a[l]={},i(r,o[l],s,a[l])):a[l]=o[l](r,s,a,i)}return s};Jo.parse=n;var t=function(r,o){return function(s,a,l,h){o(s,a,l)&&h(s,r,a,l)}};Jo.conditional=t;var e=function(r,o){return function(s,a,l,h){for(var u=[],d=s.pos;o(s,a,l);){var c={};if(h(s,r,a,c),s.pos===d)break;d=s.pos,u.push(c)}return u}};return Jo.loop=e,Jo}var xi={},IR;function gH(){if(IR)return xi;IR=1,Object.defineProperty(xi,"__esModule",{value:!0}),xi.readBits=xi.readArray=xi.readUnsigned=xi.readString=xi.peekBytes=xi.readBytes=xi.peekByte=xi.readByte=xi.buildStream=void 0;var n=function(d){return{data:d,pos:0}};xi.buildStream=n;var t=function(){return function(d){return d.data[d.pos++]}};xi.readByte=t;var e=function(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(c){return c.data[c.pos+d]}};xi.peekByte=e;var i=function(d){return function(c){return c.data.subarray(c.pos,c.pos+=d)}};xi.readBytes=i;var r=function(d){return function(c){return c.data.subarray(c.pos,c.pos+d)}};xi.peekBytes=r;var o=function(d){return function(c){return Array.from(i(d)(c)).map(function(g){return String.fromCharCode(g)}).join("")}};xi.readString=o;var s=function(d){return function(c){var g=i(2)(c);return d?(g[1]<<8)+g[0]:(g[0]<<8)+g[1]}};xi.readUnsigned=s;var a=function(d,c){return function(g,f,p){for(var m=typeof c=="function"?c(g,f,p):c,v=i(d),b=new Array(m),y=0;y<m;y++)b[y]=v(g);return b}};xi.readArray=a;var l=function(d,c,g){for(var f=0,p=0;p<g;p++)f+=d[c+p]&&Math.pow(2,g-p-1);return f},h=function(d){return function(c){for(var g=t()(c),f=new Array(8),p=0;p<8;p++)f[7-p]=!!(g&1<<p);return Object.keys(d).reduce(function(m,v){var b=d[v];return b.length?m[v]=l(f,b.index,b.length):m[v]=f[b.index],m},{})}};return xi.readBits=h,xi}var HR;function TQ(){return HR||(HR=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var t=cH(),e=gH(),i={blocks:function(c){for(var g=0,f=[],p=c.data.length,m=0,v=(0,e.readByte)()(c);v!==g&&v;v=(0,e.readByte)()(c)){if(c.pos+v>=p){var b=p-c.pos;f.push((0,e.readBytes)(b)(c)),m+=b;break}f.push((0,e.readBytes)(v)(c)),m+=v}for(var y=new Uint8Array(m),C=0,w=0;w<f.length;w++)y.set(f[w],C),C+=f[w].length;return y}},r=(0,t.conditional)({gce:[{codes:(0,e.readBytes)(2)},{byteSize:(0,e.readByte)()},{extras:(0,e.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,e.readUnsigned)(!0)},{transparentColorIndex:(0,e.readByte)()},{terminator:(0,e.readByte)()}]},function(d){var c=(0,e.peekBytes)(2)(d);return c[0]===33&&c[1]===249}),o=(0,t.conditional)({image:[{code:(0,e.readByte)()},{descriptor:[{left:(0,e.readUnsigned)(!0)},{top:(0,e.readUnsigned)(!0)},{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{lct:(0,e.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,t.conditional)({lct:(0,e.readArray)(3,function(d,c,g){return Math.pow(2,g.descriptor.lct.size+1)})},function(d,c,g){return g.descriptor.lct.exists}),{data:[{minCodeSize:(0,e.readByte)()},i]}]},function(d){return(0,e.peekByte)()(d)===44}),s=(0,t.conditional)({text:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{preData:function(c,g,f){return(0,e.readBytes)(f.text.blockSize)(c)}},i]},function(d){var c=(0,e.peekBytes)(2)(d);return c[0]===33&&c[1]===1}),a=(0,t.conditional)({application:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{id:function(c,g,f){return(0,e.readString)(f.blockSize)(c)}},i]},function(d){var c=(0,e.peekBytes)(2)(d);return c[0]===33&&c[1]===255}),l=(0,t.conditional)({comment:[{codes:(0,e.readBytes)(2)},i]},function(d){var c=(0,e.peekBytes)(2)(d);return c[0]===33&&c[1]===254}),h=[{header:[{signature:(0,e.readString)(3)},{version:(0,e.readString)(3)}]},{lsd:[{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{gct:(0,e.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,e.readByte)()},{pixelAspectRatio:(0,e.readByte)()}]},(0,t.conditional)({gct:(0,e.readArray)(3,function(d,c){return Math.pow(2,c.lsd.gct.size+1)})},function(d,c){return c.lsd.gct.exists}),{frames:(0,t.loop)([r,a,l,o,s],function(d){var c=(0,e.peekByte)()(d);return c===33||c===44})}],u=h;n.default=u})(hy)),hy}var nd={},DR;function RQ(){if(DR)return nd;DR=1,Object.defineProperty(nd,"__esModule",{value:!0}),nd.deinterlace=void 0;var n=function(e,i){for(var r=new Array(e.length),o=e.length/i,s=function(g,f){var p=e.slice(f*i,(f+1)*i);r.splice.apply(r,[g*i,i].concat(p))},a=[0,4,2,1],l=[8,8,4,2],h=0,u=0;u<4;u++)for(var d=a[u];d<o;d+=l[u])s(d,h),h++;return r};return nd.deinterlace=n,nd}var rd={},FR;function BQ(){if(FR)return rd;FR=1,Object.defineProperty(rd,"__esModule",{value:!0}),rd.lzw=void 0;var n=function(e,i,r){var o=4096,s=-1,a=r,l,h,u,d,c,g,f,A,p,m,_,v,x,S,M,T,b=new Array(r),y=new Array(o),C=new Array(o),w=new Array(o+1);for(v=e,h=1<<v,c=h+1,l=h+2,f=s,d=v+1,u=(1<<d)-1,p=0;p<h;p++)y[p]=0,C[p]=p;var _,A,x,S,T,M;for(_=A=x=S=T=M=0,m=0;m<a;){if(S===0){if(A<d){_+=i[M]<<A,A+=8,M++;continue}if(p=_&u,_>>=d,A-=d,p>l||p==c)break;if(p==h){d=v+1,u=(1<<d)-1,l=h+2,f=s;continue}if(f==s){w[S++]=C[p],f=p,x=p;continue}for(g=p,p==l&&(w[S++]=x,p=f);p>h;)w[S++]=C[p],p=y[p];x=C[p]&255,w[S++]=x,l<o&&(y[l]=f,C[l]=x,l++,(l&u)===0&&l<o&&(d++,u+=l)),f=g}S--,b[T++]=w[S],m++}for(m=T;m<a;m++)b[m]=0;return b};return rd.lzw=n,rd}var zR;function kQ(){if(zR)return Zo;zR=1,Object.defineProperty(Zo,"__esModule",{value:!0}),Zo.decompressFrames=Zo.decompressFrame=Zo.parseGIF=void 0;var n=o(TQ()),t=cH(),e=gH(),i=RQ(),r=BQ();function o(u){return u&&u.__esModule?u:{default:u}}var s=function(d){var c=new Uint8Array(d);return(0,t.parse)((0,e.buildStream)(c),n.default)};Zo.parseGIF=s;var a=function(d){for(var c=d.pixels.length,g=new Uint8ClampedArray(c*4),f=0;f<c;f++){var p=f*4,m=d.pixels[f],v=d.colorTable[m]||[0,0,0];g[p]=v[0],g[p+1]=v[1],g[p+2]=v[2],g[p+3]=m!==d.transparentIndex?255:0}return g},l=function(d,c,g){if(d.image){var f=d.image,p=f.descriptor.width*f.descriptor.height,m=(0,r.lzw)(f.data.minCodeSize,f.data.blocks,p);f.descriptor.lct.interlaced&&(m=(0,i.deinterlace)(m,f.descriptor.width));var v={pixels:m,dims:{top:d.image.descriptor.top,left:d.image.descriptor.left,width:d.image.descriptor.width,height:d.image.descriptor.height}};return f.descriptor.lct&&f.descriptor.lct.exists?v.colorTable=f.lct:v.colorTable=c,d.gce&&(v.delay=(d.gce.delay||10)*10,v.disposalType=d.gce.extras.disposal,d.gce.extras.transparentColorGiven&&(v.transparentIndex=d.gce.transparentColorIndex)),g&&(v.patch=a(v)),v}};Zo.decompressFrame=l;var h=function(d,c){return d.frames.filter(function(g){return g.image}).map(function(g){return l(g,d.gct,c)})};return Zo.decompressFrames=h,Zo}var NR=kQ();const $o=xx();function _0(){_0.__loaded||(_0.__loaded=!0,RK(),Et.load(mK),Et.load($o?GJ:eJ))}_0.__loaded=!1;const PQ=_0;function w0(){w0.__loaded||(w0.__loaded=!0,BK(),Et.load(CK),Et.load($o?sQ:oJ))}w0.__loaded=!1;const fH=w0;function x0(){x0.__loaded||(x0.__loaded=!0,kK())}x0.__loaded=!1;const $n=x0;function S0(){S0.__loaded||(S0.__loaded=!0,PK(),Et.load(TK),Et.load($o?MQ:aJ))}S0.__loaded=!1;const Cv=S0;function A0(){A0.__loaded||(A0.__loaded=!0,EK(),Et.load(bK),Et.load($o?JJ:dJ))}A0.__loaded=!1;const Px=A0;function M0(){M0.__loaded||(M0.__loaded=!0,LK(),Et.load(wK),Et.load($o?fQ:yJ))}M0.__loaded=!1;const EQ=M0;function T0(){T0.__loaded||(T0.__loaded=!0,OK(),Et.load(xK),Et.load($o?bQ:pJ))}T0.__loaded=!1;const LQ=T0;function R0(){R0.__loaded||(R0.__loaded=!0,IK(),Et.load(vK),Et.load($o?YJ:xJ))}R0.__loaded=!1;const Os=R0;function B0(){B0.__loaded||(B0.__loaded=!0,HK(),Et.load(MK),Et.load($o?wQ:SJ))}B0.__loaded=!1;const _v=B0;function k0(){k0.__loaded||(k0.__loaded=!0,zK())}k0.__loaded=!1;const OQ=k0;function P0(){P0.__loaded||(P0.__loaded=!0,DK(),Et.load(yK),Et.load($o?iQ:RJ))}P0.__loaded=!1;const Du=P0;function E0(){E0.__loaded||(E0.__loaded=!0,FK(),Et.load(_K),Et.load($o?uQ:kJ))}E0.__loaded=!1;const Uo=E0;function L0(){L0.__loaded||(L0.__loaded=!0,NK())}L0.__loaded=!1;const IQ=L0;function pH(){$n(),Os()}const mH="PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol",HQ=14;var kn;(function(n){n.selected="selected",n.selectedReverse="selected_reverse",n.hover="hover",n.hoverReverse="hover_reverse"})(kn||(kn={}));const eh={[kn.selectedReverse]:{},[kn.selected]:{},[kn.hover]:{},[kn.hoverReverse]:{}},WR={container:"",width:30,height:30,style:{}},DQ="scrollDown",FQ="scrollDrag",zQ="scrollUp";function Wd(){return Bt.env==="browser"?["pointerup","pointerleave","pointercancel"]:["pointerup","pointerleave","pointerupoutside"]}const jR={debounce:QI,throttle:tH};pH();class ks extends hr{constructor(t,e){super(e?.skipDefault?t:Lt({},ks.defaultAttributes,t)),this.name="scrollbar",this._handleTouchMove=i=>{_t(this._prePos)&&i.preventDefault()},this._onRailPointerDown=i=>{const{viewX:r,viewY:o}=i,{direction:s,width:a,height:l,range:h}=this.attribute,u=this._sliderSize,[d,c]=this._getScrollRange();let g;if(s==="vertical"){const f=o-this._viewPosition.y,p=Qn(f-u/2,d,c);g=f/l,this._slider.setAttribute("y",p,!0)}else{const f=r-this._viewPosition.x,p=Qn(f-u/2,d,c);g=f/a,this._slider.setAttribute("x",p,!0)}this.setScrollRange([g-(h[1]-h[0])/2,g+(h[1]-h[0])/2],!1),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()},this._onSliderPointerDown=i=>{this._clearDragEvents();const{stopSliderDownPropagation:r=!0}=this.attribute;r&&i.stopPropagation();const{direction:o}=this.attribute,{x:s,y:a}=this.stage.eventPointTransform(i);this._prePos=o==="horizontal"?s:a,this._dispatchEvent(DQ,{pos:this._prePos,event:i});const l=Wd(),h=Bt.env==="browser"?Bt:this.stage;h.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),l.forEach((u=>{h.addEventListener(u,this._onSliderPointerUp)}))},this._computeScrollValue=i=>{const{direction:r}=this.attribute,{x:o,y:s}=this.stage.eventPointTransform(i);let a,l,h=0;const{width:u,height:d}=this.getSliderRenderBounds();return r==="vertical"?(l=s,h=l-this._prePos,a=h/d):(l=o,h=l-this._prePos,a=h/u),[l,a]},this._onSliderPointerMove=i=>{const{stopSliderMovePropagation:r=!0}=this.attribute;r&&i.stopPropagation();const o=this.getScrollRange(),[s,a]=this._computeScrollValue(i);this.setScrollRange([o[0]+a,o[1]+a],!0),this._prePos=s},this._onSliderPointerMoveWithDelay=this.attribute.delayTime===0?this._onSliderPointerMove:jR[this.attribute.delayType](this._onSliderPointerMove,this.attribute.delayTime),this._onSliderPointerUp=i=>{const{range:r,limitRange:o=[0,1]}=this.attribute,s=this.getScrollRange(),[a,l]=this._computeScrollValue(i),h=[s[0]+l,s[1]+l];this._prePos=null,this._dispatchEvent(zQ,{pre:r,value:za(h,o[0],o[1])}),this._clearDragEvents()}}setScrollRange(t,e=!0){const{direction:i="horizontal",limitRange:r=[0,1],range:o,realTime:s=!0}=this.attribute,a=za(t,r[0],r[1]);if(e){const l=this._getSliderPos(a);if(this._slider){const h=l[1]-l[0];this._sliderSize=h,i==="horizontal"?this._slider.setAttributes({x:l[0],width:h},!0):this._slider.setAttributes({y:l[0],height:h},!0),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()}}this.attribute.range=a,s&&this._dispatchEvent(FQ,{pre:o,value:a})}getScrollRange(){return this.attribute.range}bindEvents(){if(this.attribute.disableTriggerEvent)return;const{delayType:t="throttle",delayTime:e=0}=this.attribute;this._rail&&this._rail.addEventListener("pointerdown",jR[t](this._onRailPointerDown,e)),this._slider&&this._slider.addEventListener("pointerdown",this._onSliderPointerDown),(Bt.env==="browser"?Bt:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1})}render(){this._reset();const{direction:t="horizontal",width:e,height:i,range:r,limitRange:o=[0,1],railStyle:s,sliderStyle:a,padding:l=2}=this.attribute,h=this.createOrUpdateChild("scrollbar-container",{},"group"),u=h.createOrUpdateChild("scrollbar-rail",Object.assign({x:0,y:0,width:e,height:i},s),"rect");this._rail=u;const d=this.getSliderRenderBounds(),c=this._getSliderPos(za(r,o[0],o[1])),g=c[1]-c[0];let f;this._sliderSize=g,f=t==="horizontal"?{x:c[0],y:d.y1,width:g,height:d.height}:{x:d.x1,y:c[0],width:d.width,height:g};const p=h.createOrUpdateChild("slider",Object.assign(Object.assign(Object.assign(Object.assign({},f),{cornerRadius:this._getDefaultSliderCornerRadius()}),a),{boundsPadding:No(l),pickMode:"imprecise"}),"rect");this._slider=p,this._container=h;const m=this._container.AABBBounds;this._viewPosition={x:m.x1,y:m.y1}}getSliderRenderBounds(){if(this._sliderRenderBounds)return this._sliderRenderBounds;const{width:t,height:e,padding:i=2}=this.attribute,[r,o,s,a]=No(i),l={x1:a,y1:r,x2:t-o,y2:e-s,width:Math.max(0,t-(a+o)),height:Math.max(0,e-(r+s))};return this._sliderRenderBounds=l,l}_getDefaultSliderCornerRadius(){const{direction:t,round:e}=this.attribute;if(e){const{width:i,height:r}=this.getSliderRenderBounds();return t==="horizontal"?r:i}return 0}_getSliderPos(t){const{direction:e}=this.attribute,{width:i,height:r,x1:o,y1:s}=this.getSliderRenderBounds();return e==="horizontal"?[i*t[0]+o,i*t[1]+o]:[r*t[0]+s,r*t[1]+s]}_getScrollRange(){if(this._sliderLimitRange)return this._sliderLimitRange;const{limitRange:t=[0,1],direction:e}=this.attribute,[i,r]=za(t,0,1),{width:o,height:s,x1:a,y1:l}=this.getSliderRenderBounds(),h=this._sliderSize;return e==="horizontal"?za([a+i*o,a+r*o],a,o-h):za([l+i*s,l+r*s],l,s-h)}_clearDragEvents(){const t=Wd(),e=Bt.env==="browser"?Bt:this.stage;e.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),t.forEach((i=>{e.removeEventListener(i,this._onSliderPointerUp)}))}_reset(){this._sliderRenderBounds=null,this._sliderLimitRange=null}release(t){super.release(t),(Bt.env==="browser"?Bt:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1}),this._clearDragEvents()}}ks.defaultAttributes={direction:"horizontal",round:!0,sliderSize:20,sliderStyle:{fill:"rgba(0, 0, 0, .5)"},railStyle:{fill:"rgba(0, 0, 0, .0)"},padding:2,scrollRange:[0,1],delayType:"throttle",delayTime:0,realTime:!0};function Fl(n,t){n.forEachChildren((e=>{const i=t(e);e.isContainer&&!i&&Fl(e,t)}))}function vH(n,t){return[n[0]*t,n[1]*t]}function bH(n){const[t,e]=n;return Math.sqrt(t*t+e*e)}function NQ(n){let t=bH(n);return t>0&&(t=1/t),[n[0]*t,n[1]*t]}function WQ(n,t){const[e,i]=n,[r,o]=t,s=Math.sqrt((e*e+i*i)*(r*r+o*o)),a=s&&(e*r+i*o)/s;return Math.acos(Math.min(Math.max(a,-1),1))}function jQ(n,t,e){const i=WQ(n,t),r=hZ(n,t)>=0;return e?r?2*Math.PI-i:i:r?i:2*Math.PI-i}const yH=(n,t,e,i)=>new Lh(Object.assign({defaultFontParams:Object.assign({fontFamily:mH,fontSize:HQ},i),getTextBounds:vv,specialCharSet:`-/: .,@%'"~`+Lh.ALPHABET_CHAR_SET+Lh.ALPHABET_CHAR_SET.toUpperCase()},{}),n);function wv(n,t,e={}){if(!n)return{width:0,height:0};const i=vv({text:n,fontFamily:t.fontFamily||e.fontFamily||mH,fontSize:t.fontSize||e.fontSize||12,fontWeight:t.fontWeight||e.fontWeight,textAlign:t.textAlign||"center",textBaseline:t.textBaseline,ellipsis:!!t.ellipsis,maxLineWidth:t.maxLineWidth||1/0,lineHeight:t.fontSize||e.fontSize||12});return{width:i.width(),height:i.height()}}function VQ(n,t="type"){return CH(n,t)==="rich"}function CH(n,t="type"){var e,i;return ao(n.text)&&"type"in n.text?(e=n.text.type)!==null&&e!==void 0?e:"text":t in n&&(i=n[t])!==null&&i!==void 0?i:"text"}function _H(n){var t,e;return _t(n.maxLineWidth)&&(n.maxWidth=n.maxLineWidth,delete n.maxLineWidth),n.width=(t=n.width)!==null&&t!==void 0?t:0,n.height=(e=n.height)!==null&&e!==void 0?e:0,n.textConfig=n.text.text||n.text,n}function GQ(n){const{text:t,_originText:e}=n,{text:i}=t;return n.html=i,n.text=e,n.renderable=!1,n}function $Q(n){const{text:t,_originText:e}=n,{text:i}=t;return n.react=i,n.text=e,n.renderable=!1,n}function Iw(n,t="type"){const e=CH(n,t);return e==="rich"?At.richtext(_H(n)):(e==="html"?n=GQ(n):e==="react"&&(n=$Q(n)),At.text(n))}function wH(){$n(),Os(),Du(),_v(),Uo()}var VR=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};wH();class va extends hr{getBgRect(){return this._bgRect}getTextShape(){return this._textShape}constructor(t,e){super(e?.skipDefault?t:Lt({},va.defaultAttributes,t)),this.name="tag",this._tagStates=[],this._rectStates=[],this._symbolStates=[],this._textStates=[]}render(){var t,e,i;this.cacheStates();const{text:r="",textStyle:o={},shape:s={},panel:a={},space:l=4,minWidth:h,maxWidth:u,padding:d=4,visible:c,state:g,type:f,textAlwaysCenter:p,containerTextAlign:m}=this.attribute,v=No(d),b=this.createOrUpdateChild("tag-content",{x:0,y:0,zIndex:1},"group");let y,C=-v[3],w=-v[0],_=v[1]+v[3],A=v[0]+v[2],x=0,S=0;const{visible:T}=s,M=VR(s,["visible"]);if(h0(T)){const j=M?.size||10,X=rn(j)?j:Math.max(j[0],j[1]);y=b.createOrUpdateChild("tag-shape",Object.assign(Object.assign({symbolType:"circle",size:j,strokeBoundsBuffer:0},M),{visible:T,x:X/2,y:X/2}),"symbol"),Re(g?.shape)||(y.states=g.shape),T&&(S=X+l)}let R,E,P;if(_+=S,x+=S,VQ({text:r})||f==="rich"){const j=Object.assign(Object.assign(Object.assign({},_H(Object.assign({type:f,text:r},o))),o),{visible:_t(r)&&c!==!1,x,y:0});jt(j.lineHeight)&&(j.lineHeight=o.fontSize),R=b.createOrUpdateChild("tag-text",j,"richtext"),E=R.AABBBounds.width(),P=R.AABBBounds.height()}else{const j=Object.assign(Object.assign({text:ao(r)&&"type"in r&&r.type==="text"?r.text:r,visible:_t(r)&&c!==!1,lineHeight:o?.fontSize},o),{x,y:0});jt(j.lineHeight)&&(j.lineHeight=o.fontSize),R=b.createOrUpdateChild("tag-text",j,"text");const X=wv(j.text,o,(e=(t=this.stage)===null||t===void 0?void 0:t.getTheme())===null||e===void 0?void 0:e.text);E=X.width,P=X.height}_+=E;const B=(i=s.size)!==null&&i!==void 0?i:10,k=rn(B)?B:Math.max(B[0],B[1]);A+=Math.max(P,s.visible?k:0);const{textAlign:L,textBaseline:O}=o;(_t(h)||_t(u))&&(_t(h)&&_<h&&(_=h),_t(u)&&_>u&&(_=u,R.setAttribute("maxLineWidth",u-v[1]-v[2]))),C=0,w=0;let I=0;L==="left"||L==="start"?I=1:L==="right"||L==="end"?I=-1:L==="center"&&(I=0),I?I<0?(C-=_,y&&y.setAttribute("x",(y.attribute.x||0)-E),b.setAttribute("x",-v[1]-S)):I>0&&b.setAttribute("x",v[3]):(C-=_/2,y&&y.setAttribute("x",(y.attribute.x||0)-E/2),b.setAttribute("x",-S/2));const H=m==="right"||m==="end",D=m==="left"||m==="start",z=(j,X)=>{R.type==="richtext"?R.setAttributes({x:j,textAlign:X,textConfig:u0(R.attribute.textConfig).map((Z=>Object.assign(Object.assign({},Z),{textAlign:X})))}):R.setAttributes({x:j,textAlign:X})};if((m?m==="center":p)&&I){const j=_-v[1]-v[3],X=E+S,Z=I===1?(j-X)/2+S+E/2:v[0]+S-(_/2+X/2-S)+E/2;if(z(Z,"center"),y){const J=Z-E/2-S+k/2;y.setAttributes({x:J})}}if(D&&I!==1){const j=_-v[1]-v[3],X=I===0?-j/2+S/2:-_+v[3]+v[1]+S;if(z(X+S,"left"),y){const Z=X+k/2;y.setAttributes({x:Z})}}if(H&&I!==-1){const j=_-v[1]-v[3],X=I===0?j/2+S/2:j;if(z(X,"right"),y){const Z=X-E-S+k/2;y.setAttributes({x:Z})}}O==="middle"?(w-=A/2,y&&y.setAttribute("y",0)):O==="bottom"?(w-=A,y&&y.setAttribute("y",-P/2),b.setAttribute("y",-v[2])):O==="top"&&(b.setAttribute("y",v[0]),y&&y.setAttribute("y",P/2)),Re(g?.text)||(R.states=g.text);const{visible:G}=a,U=VR(a,["visible"]);if(c&&h0(G)){const j=this.createOrUpdateChild("tag-panel",Object.assign(Object.assign({},U),{visible:G&&!!r,width:_,height:A,x:C,y:w}),"rect");if(Re(g?.panel)||(j.states=g.panel),U.customShape){const X=U.customShape;j.pathProxy=Z=>X(this,Z,new Fi)}this._bgRect=j}this._textShape=R,this._symbol=y,this.resetStates()}initAttributes(t,e){t=e?.skipDefault?t:Lt({},va.defaultAttributes,t),super.initAttributes(t),this.render()}addState(t,e,i){super.addState(t,e,i),this._textShape&&this._textShape.addState(t,e,i),this._bgRect&&this._bgRect.addState(t,e,i),this._symbol&&this._symbol.addState(t,e,i)}removeState(t,e){super.removeState(t,e),this._textShape&&this._textShape.removeState(t,e),this._bgRect&&this._bgRect.removeState(t,e),this._symbol&&this._symbol.removeState(t,e)}cacheStates(){var t,e,i,r,o,s,a,l,h,u,d,c,g,f;this._tagStates=(e=(t=this.currentStates)===null||t===void 0?void 0:t.slice())!==null&&e!==void 0?e:[],this._rectStates=(o=(r=(i=this._bgRect)===null||i===void 0?void 0:i.currentStates)===null||r===void 0?void 0:r.slice())!==null&&o!==void 0?o:[],this._symbolStates=(l=(a=(s=this._symbol)===null||s===void 0?void 0:s.currentStates)===null||a===void 0?void 0:a.slice())!==null&&l!==void 0?l:[],this._textStates=(d=(u=(h=this._textShape)===null||h===void 0?void 0:h.currentStates)===null||u===void 0?void 0:u.slice())!==null&&d!==void 0?d:[],this.clearStates(),(c=this._bgRect)===null||c===void 0||c.clearStates(),(g=this._symbol)===null||g===void 0||g.clearStates(),(f=this._textShape)===null||f===void 0||f.clearStates()}resetStates(){var t,e,i;this._tagStates.length&&this.useStates(this._tagStates),this._rectStates.length&&((t=this._bgRect)===null||t===void 0||t.useStates(this._rectStates)),this._symbolStates.length&&((e=this._symbol)===null||e===void 0||e.useStates(this._symbolStates)),this._textStates.length&&((i=this._textShape)===null||i===void 0||i.useStates(this._textStates))}}va.defaultAttributes={visible:!0,textStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},space:4,padding:4,shape:{fill:"#000"}};const xH={visible:!0,position:"auto",titleStyle:{fontSize:16,fill:"#08979c"},contentStyle:{fontSize:12,fill:"green"},panel:{visible:!0,fill:"#e6fffb",size:12,space:0,stroke:"#87e8de",lineWidth:1,cornerRadius:4}},SH={poptip:Lt({},xH)};function UQ(){$n(),Uo(),Du(),Os()}function XQ(n){Lt(SH.poptip,xH,n)}var YQ=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const GR=new Ic;UQ();const $R="M -0.5 -0.5, L -0.5 0.5, L 0.5 -0.5, Z",UR="M -0.5 -0.5, L -0.5 0.5, L 0.5 0.5, Z",XR="M -0.5 -0.5, L 0.5 -0.5, L 0.5 0.5, Z",YR="M 0.5 -0.5, L 0.5 0.5, L -0.5 0.5, Z",qQ={tl:$R,tr:XR,bl:UR,br:YR,lt:$R,lb:UR,rt:XR,rb:YR};class Su extends hr{constructor(t,e){super(e?.skipDefault?t:Lt({},Su.defaultAttributes,t)),this.name="poptip",this.positionList=["top","tl","tr","bottom","bl","br","left","lt","lb","right","rt","rb"]}render(){var t,e,i,r,o,s,a,l,h;const{titleStyle:u={},position:d,contentStyle:c={},panel:g,logoSymbol:f,poptipAnchor:p="position",logoText:m,logoTextStyle:v={},triangleMode:b="default",space:y=4,minWidth:C=0,maxWidth:w=1/0,padding:_=4,maxWidthPercent:A,visible:x,state:S,dx:T=0,dy:M=0,positionBounds:R}=this.attribute;let{title:E="",content:P=""}=this.attribute;E=this.attribute.titleFormatMethod?this.attribute.titleFormatMethod(E):E,P=this.attribute.contentFormatMethod?this.attribute.contentFormatMethod(P):P;const B=No(_),k=this.createOrUpdateChild("poptip-content",{x:0,y:0,zIndex:1},"group");this.group=k;const L=w-B[1]-B[3],O=_t(E)&&x!==!1,I=Object.assign(Object.assign({text:_e(E)?E:[E],visible:O,wrap:!0},u),{x:B[3],y:B[0],maxLineWidth:L,textAlign:"left",textBaseline:"top"}),H=k.createOrUpdateChild("poptip-title",I,"text");Re(S?.title)||(H.states=S.title);const D=H.AABBBounds,z=D.height(),G=D.width();let U=z+y;O||(U=0);const j=_t(P)&&x!==!1,X=Object.assign(Object.assign({text:_e(P)?P:[P],visible:j,wrap:!0},c),{x:B[3],y:B[0]+U,maxLineWidth:L,textAlign:"left",textBaseline:"top"}),Z=k.createOrUpdateChild("poptip-content",X,"text");Re(S?.content)||(Z.states=S.content);const J=Z.AABBBounds,q=J.height(),st=J.width();j&&(U+=q),this.titleShape=H,this.contentShape=Z;let Q=af(G+B[1]+B[3],st+B[1]+B[3]);Q>w?Q=w:Q<C&&(Q=C);let ot=B[0]+B[2]+U;const{visible:nt,square:F}=g,N=YQ(g,["visible","square"]);if(F){const ut=af(Q,ot);Q=ut;const gt=ut-ot;ot=ut,H.setAttributes({dy:gt/2}),Z.setAttributes({dy:gt/2})}const W=(t=N.size)!==null&&t!==void 0?t:12,V=_e(W)?[W[0]+((e=N.space)!==null&&e!==void 0?e:0),W[1]+((i=N.space)!==null&&i!==void 0?i:0)]:W+((r=N.space)!==null&&r!==void 0?r:0),K=(o=N.lineWidth)!==null&&o!==void 0?o:1,et=this.stage?[(s=this.stage.viewWidth)!==null&&s!==void 0?s:this.stage.width,(a=this.stage.viewHeight)!==null&&a!==void 0?a:this.stage.height]:void 0;if(et){const ut=this.AABBBounds,gt=(l=this.attribute.x)!==null&&l!==void 0?l:ut.x1,Gt=et[0]-ut.x1;let re=Math.max(gt,Gt);const Fe=(_e(W)?W[0]:12)+3;if(re=Math.min(re-Fe,re*A),re<Q){Q=re;const Qt=B[1]+B[3];H.setAttribute("maxLineWidth",re-Qt),Z.setAttribute("maxLineWidth",re-Qt),ot=B[0]+B[2],O&&(ot+=H.AABBBounds.height()+y),ot+=Z.AABBBounds.height()}}const it=d==="auto"||_e(d),rt=_e(d)?d:this.positionList;let lt,ct=-1/0;for(let ut=0;ut<rt.length+1;ut++){const gt=it?rt[ut===rt.length?lt:ut]:d;let Gt="arrow2Left",re=(_e(W)?W[0]:W)/4,Fe=0;gt==="top"||gt==="bottom"||gt==="left"||gt==="right"?Gt="arrow2Left":b==="concise"&&(Gt=qQ[gt],re=["tl","bl","rt","rb"].includes(gt)?(_e(W)?W[0]:W)/2:-(_e(W)?W[0]:W)/2,Fe=["tl","tr","lb","rb"].includes(gt)?-(_e(W)?W[1]:W)/2:(_e(W)?W[1]:W)/2);const{angle:Qt,offset:Ii}=this.getAngleAndOffset(gt,Q,ot,_e(V)?V:[V,V-K],Gt);let hi,ri={x:0,y:0};if(p==="bounds"&&R&&(ri=this.calculateAnchorPoint(gt,R)),h0(nt)){let Ht;hi=k.createOrUpdateChild("poptip-symbol-panel",Object.assign(Object.assign({},N),{visible:nt&&(j||O),x:re,y:Fe,strokeBoundsBuffer:-1,boundsPadding:-2,anchor:[0,0],symbolType:Gt,angle:Qt,dx:Ii[0],dy:Ii[1]-((h=N.space)!==null&&h!==void 0?h:0),size:W,zIndex:9}),"symbol"),Re(S?.panel)||(hi.states=S.panel),Ht=g.panelSymbolType?k.createOrUpdateChild("poptip-rect-panel",Object.assign(Object.assign({},N),{visible:nt&&(j||O),x:0,y:0,symbolType:"rect",size:[Q,ot],zIndex:-8}),"symbol"):k.createOrUpdateChild("poptip-rect-panel",Object.assign(Object.assign({},N),{visible:nt&&(j||O),x:0,y:0,width:Q,height:ot,zIndex:-8}),"rect"),Re(S?.panel)||(Ht.states=S.panel)}if(k.setAttributes({x:-Ii[0]+T+ri.x,y:-Ii[1]+M+ri.y,anchor:[re,Fe]}),f){const{size:Ht=12}=f,Ie=_e(Ht)?Ht:[Ht,Ht];Ie[1]==="auto"&&(Ie[1]=ot),Ie[0]==="auto"&&(Ie[0]=ot);const ye=Ie[0];k.createOrUpdateChild("poptip-logo",Object.assign(Object.assign({},f),{x:0,y:ot/2,visible:nt&&(j||O),zIndex:10,size:Ie}),"symbol"),k.setAttributes({x:-Ii[0]+T+ye/2,y:-Ii[1]+M}),m&&k.createOrUpdateChild("poptip-logo-text",Object.assign(Object.assign({},v),{x:0,y:ot/2,visible:nt&&(j||O),text:m,textAlign:"center",textBaseline:"middle",zIndex:10}),"text")}if(!et)break;{GR.setValue(0,0,Q,ot).transformWithMatrix(k.globalTransMatrix);const Ht=GR,Ie=new iH().setValue(0,0,et[0],et[1]);if(it){if(cZ(Ht,Ie))break;{const ye=dZ(Ht,Ie),oi=(ye.x2-ye.x1)*(ye.y2-ye.y1);oi>ct&&(ct=oi,lt=ut)}}if(["top","bottom","left","right"].includes(gt)){const ye=gt==="top"||gt==="bottom",oi=gt==="left"||gt==="right";let Sn=!1;if(ye?Sn=gt==="top"&&Ht.y1<0||gt==="bottom"&&Ht.y2>Ie.y2:oi&&(Sn=gt==="left"&&Ht.x1<0||gt==="right"&&Ht.x2>Ie.x2),!Sn){let Ct=0;const Ve=(_e(W)?W[1]:W)/2;ye?(Ht.x1<0?Ct=-Ht.x1:Ht.x2>Ie.x2&&(Ct=Ie.x2-Ht.x2),k.setAttribute("x",k.attribute.x+Ct),hi.setAttribute("dx",c0(af(hi.attribute.dx-Ct,Ve),Ht.width()-Ve))):oi&&(Ht.y1<0?Ct=-Ht.y1:Ht.y2>Ie.y2&&(Ct=Ie.y2-Ht.y2),k.setAttribute("y",k.attribute.y+Ct),hi.setAttribute("dy",c0(af(hi.attribute.dy-Ct,Ve),Ht.height()-Ve)));break}}if(!it)break}}}calculateAnchorPoint(t,e){if(!e)return{x:0,y:0};const{x:i,y:r}=this.attribute,{x1:o,y1:s,x2:a,y2:l}=e,h=a-o,u=l-s;switch(t){case"top":case"tl":case"tr":return{x:o+h/2-i,y:s-r};case"bottom":case"bl":case"br":return{x:o+h/2-i,y:l-r};case"left":case"lt":case"lb":return{x:o-i,y:s+u/2-r};case"right":case"rt":case"rb":return{x:a-i,y:s+u/2-r};default:return{x:0,y:0}}}getAngleAndOffset(t,e,i,r,o){const s=o==="arrow2Left"?r[1]/2:r[1];switch(t){case"tl":return{angle:o==="arrow2Left"?vr/2*3:0,offset:o==="arrow2Left"?[e/4,i+s]:[0,i+s]};case"top":return{angle:vr/2*3,offset:[e/2,i+s]};case"tr":return{angle:o==="arrow2Left"?vr/2*3:0,offset:o==="arrow2Left"?[e/4*3,i+s]:[e,i+s]};case"rt":return{angle:0,offset:o==="arrow2Left"?[-s,i/5]:[-s,0]};case"right":return{angle:0,offset:[-s,i/2]};case"rb":return{angle:0,offset:o==="arrow2Left"?[-s,i/5*4]:[-s,i]};case"bl":return{angle:o==="arrow2Left"?vr/2:0,offset:o==="arrow2Left"?[e/4,-s]:[0,-s]};case"bottom":return{angle:vr/2,offset:[e/2,-s]};case"br":return{angle:o==="arrow2Left"?vr/2:0,offset:o==="arrow2Left"?[e/4*3,-s]:[e,-s]};case"lt":return{angle:o==="arrow2Left"?vr:0,offset:o==="arrow2Left"?[e+s,i/5]:[e+s,0]};case"left":return{angle:vr,offset:[e+s,i/2]};case"lb":return{angle:o==="arrow2Left"?vr:0,offset:o==="arrow2Left"?[e+s,i/5*4]:[e+s,i]}}}}Su.defaultAttributes={position:"rt",visible:!0,title:null,content:null,titleStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},contentStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},panel:{},maxWidthPercent:.8,space:8,padding:10};var KQ=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};function ZQ(n,t){return Lt(n,SH.poptip,t),n}let jd=class{render(n,t,e,i,r,o,s,a,l,h,u,d,c){var g,f;if(n._showPoptip===1){const{visible:p,visibleCb:m}=n.attribute.poptip||{};if(p===!1||m&&m(n)===!1)return;const v={};Lt(v,Su.defaultAttributes,n.attribute.poptip?n.attribute.poptip:{}),this.poptipComponent?this.poptipComponent.initAttributes(v):this.poptipComponent=new Su(v);let b=n.attribute.poptip||{};if(n.type==="text"&&b.title==null&&b.content==null){const w={};ZQ(w,b),b=w,b.content=(g=b.content)!==null&&g!==void 0?g:n.attribute.text}const y=n.globalTransMatrix;this.poptipComponent.setAttributes(Object.assign(Object.assign({visibleAll:!0,pickable:!1,childrenPickable:!1,poptipAnchor:"bounds"},b),{x:y.e,y:y.f,positionBounds:n.globalAABBBounds})),h.stage.tryInitInteractiveLayer();const C=h.stage.getLayer("_builtin_interactive");C&&C.add(this.poptipComponent)}else n._showPoptip===2&&(n._showPoptip=0,this.poptipComponent&&(this.poptipComponent.setAttributes({visibleAll:!1}),(f=this.poptipComponent.parent)===null||f===void 0||f.removeChild(this.poptipComponent),this.poptipComponent=null))}};jd=KQ([pt()],jd);var AH=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};class MH{constructor(){this.activeEvent="onRegister",this._uid=Ci.GenAutoIncrementId(),this.poptip=t=>{const e=t.target;this.needHide(e)?this.unpoptip(t):e!==this.activeGraphic&&(this.needShow(e)&&(e.setAttributes({}),e._showPoptip=1),this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2),this.setActiveGraphic(e,!0))},this.unpoptip=t=>{this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2,this.setActiveGraphic(null,!0))}}activate(t){this.pluginService=t;const{stage:e}=this.pluginService;e.addEventListener("pointerover",this.poptip)}needHide(t){return t.isContainer||!t.attribute}needShow(t){return!!t.attribute.poptip}setActiveGraphic(t,e){this.activeGraphic=t,this.pluginService.stage.renderNextFrame()}deactivate(t){const{stage:e}=this.pluginService;e.removeEventListener("pointerover",this.poptip)}}let Vd=class extends MH{constructor(){super(...arguments),this.name="poptip",this.key=this.name+this._uid}};Vd=AH([pt()],Vd);let Gd=class extends MH{constructor(){super(...arguments),this.name="poptipForText",this.key=this.name+this._uid,this.pointerlave=n=>{const{stage:t}=this.pluginService;n.target===t&&this.unpoptip(n)}}activate(n){super.activate(n);const{stage:t}=this.pluginService;t.addEventListener("pointerleave",this.pointerlave)}needHide(n){return n.type!=="text"||!n.cliped||n.isContainer||!n.attribute||n.attribute.disableAutoClipedPoptip}needShow(n){return!0}deactivate(n){const{stage:t}=this.pluginService;super.deactivate(n),t.removeEventListener("pointerleave",this.pointerlave)}};Gd=AH([pt()],Gd);const JQ=new Ot(((n,t,e,i)=>{e(jd)||(n(jd).toSelf().inSingletonScope(),n(bx).toService(jd)),e(Vd)||(n(Vd).toSelf(),n(Lc).toService(Vd)),e(Gd)||(n(Gd).toSelf(),n(Lc).toService(Gd))}));function QQ(){Et.load(JQ)}function ttt(){$n(),Px(),LQ(),Du()}ttt();class xv extends hr{getStartAngle(){return FT(this._startAngle)}getEndAngle(){return FT(this._endAngle)}getMainSegmentPoints(){return this._mainSegmentPoints}constructor(t,e){super(e?.skipDefault?t:Lt({},xv.defaultAttributes,t)),this.name="segment",this.key="segment",this.lines=[]}render(){this.removeAllChild(!0),this._reset();const{startSymbol:t,endSymbol:e,lineStyle:i,state:r,visible:o=!0,multiSegment:s,mainSegmentIndex:a}=this.attribute;if(!o)return;this._computeLineAngle();const l=this._getMainSegmentPoints(),h=this._renderSymbol(t,l,"start"),u=this._renderSymbol(e,l,"end");if(this.startSymbol=h,this.endSymbol=u,s){const d=[...this.attribute.points];if(pi(a))d[a]=this._clipPoints(d[a]);else{const c=this._clipPoints(gw(d));d[0][0]=c[0],d[d.length-1][d[d.length-1].length-1]=c[c.length-1]}d.forEach(((c,g)=>{var f,p;const m=At.line(Object.assign(Object.assign({points:c},_e(i)?(f=i[g])!==null&&f!==void 0?f:i[i.length-1]:i),{fill:!1}));m.name=`${this.name}-line`,m.id=this._getNodeId("line"+g),Re(r?.line)||(m.states=_e(r.line)?(p=r.line[g])!==null&&p!==void 0?p:r.line[r.line.length-1]:r.line),this.add(m),this.lines.push(m)}))}else{let d=At.line;u0(i)[0].cornerRadius&&(d=At.polygon);const c=d(Object.assign(Object.assign({points:this._clipPoints(this.attribute.points)},u0(i)[0]),{fill:!1,closePath:!1}));c.name=`${this.name}-line`,c.id=this._getNodeId("line"),Re(r?.line)||(c.states=[].concat(r.line)[0]),this.add(c),this.lines.push(c)}}_computeStartRotate(t){return t+Math.PI/2}_computeEndRotate(t){return t+Math.PI/2}_renderSymbol(t,e,i){if(!e.length)return;const{autoRotate:r=!0}=t;let o;if(t&&t.visible){const s=this.getStartAngle(),a=this.getEndAngle(),{state:l}=this.attribute,h=e[0],u=e[e.length-1],{refX:d=0,refY:c=0,refAngle:g=0,style:f,symbolType:p,size:m=12}=t;let v,b;i==="start"?(v={x:h.x+(pi(s)?d*Math.cos(s)+c*Math.cos(s-Math.PI/2):0),y:h.y+(pi(s)?d*Math.sin(s)+c*Math.sin(s-Math.PI/2):0)},b=this._computeStartRotate(this._startAngle)):(v={x:u.x+(pi(a)?d*Math.cos(a)+c*Math.cos(a-Math.PI/2):0),y:u.y+(pi(a)?d*Math.sin(a)+c*Math.sin(a-Math.PI/2):0)},b=this._computeEndRotate(this._endAngle)),o=At.symbol(Object.assign(Object.assign(Object.assign({},v),{symbolType:p,size:m,angle:r?b+g:0,strokeBoundsBuffer:0}),f)),o.name=`${this.name}-${i}-symbol`,o.id=this._getNodeId(`${i}-symbol`),Re(l?.symbol)||(o.states=l.symbol),i==="start"?Re(l?.startSymbol)||(o.states=l.startSymbol):Re(l?.endSymbol)||(o.states=l.endSymbol),this.add(o)}return o}_getMainSegmentPoints(){if(this._mainSegmentPoints)return this._mainSegmentPoints;const{points:t,multiSegment:e,mainSegmentIndex:i}=this.attribute;let r;return r=e?pi(i)?t[i]:gw(t):t,this._mainSegmentPoints=r,r}_clipPoints(t){const{startSymbol:e={},endSymbol:i={}}=this.attribute;let r=t;if(e.visible){const o=e.clip?e.size||10:0;r=[{x:t[0].x-o/2*(Math.cos(this._startAngle)||0),y:t[0].y-o/2*(Math.sin(this._startAngle)||0)},...r.slice(1)]}if(i.visible){const o=i.clip?i.size||10:0,s={x:t[t.length-1].x-o/2*(Math.cos(this._endAngle)||0),y:t[t.length-1].y-o/2*(Math.sin(this._endAngle)||0)};r=[...r.slice(0,r.length-1),s]}return r}_computeLineAngle(){const t=this._getMainSegmentPoints();if(t.length<=1)return;const e=t[0],i=t[1],r=t[t.length-2],o=t[t.length-1],s=[e.x-i.x,e.y-i.y],a=Math.atan2(s[1],s[0]),l=[o.x-r.x,o.y-r.y],h=Math.atan2(l[1],l[0]);this._startAngle=a,this._endAngle=h}_reset(){this.startSymbol=null,this.endSymbol=null,this._startAngle=null,this._endAngle=null,this._mainSegmentPoints=null}}xv.defaultAttributes={visible:!0,lineStyle:{lineWidth:1,stroke:"#000"},startSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}},endSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}}};var an;(function(n){n.innerView="inner-view",n.axisContainer="axis-container",n.labelContainer="axis-label-container",n.tickContainer="axis-tick-container",n.tick="axis-tick",n.subTick="axis-sub-tick",n.label="axis-label",n.title="axis-title",n.gridContainer="axis-grid-container",n.grid="axis-grid",n.gridRegion="axis-grid-region",n.line="axis-line",n.background="axis-background",n.axisLabelBackground="axis-label-background",n.axisBreak="axis-break",n.axisBreakSymbol="axis-break-symbol"})(an||(an={}));var wh;(function(n){n.selected="selected",n.selectedReverse="selected_reverse",n.hover="hover",n.hoverReverse="hover_reverse"})(wh||(wh={}));const ih={[wh.selectedReverse]:{},[wh.selected]:{},[wh.hover]:{},[wh.hoverReverse]:{}},ett=999,Hw={title:{space:4,padding:0,textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1}},label:{visible:!0,inside:!1,space:4,padding:0,style:{fontSize:12,fill:"#333",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#999",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}}},qR={size:8,stroke:"#000",lineWidth:1,zIndex:1};function itt(n){const t=n.AABBBounds;return{x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,centerX:n.attribute.x,centerY:n.attribute.y,angle:n.attribute.angle}}function ntt(n){n.forEach((t=>{if(t.rotatedBounds||!t.attribute.angle)return;const e=itt(t),i=_d({x:t.attribute.x,y:t.attribute.y},e.angle,{x:e.centerX,y:e.centerY}),r=i.x-e.centerX,o=i.y-e.centerY;e.x1+=r,e.x2+=r,e.y1+=o,e.y2+=o,e.centerX+=r,e.centerY+=o,t.rotatedBounds=e}))}function rtt(n,t){var e,i;return!((e=n.OBBBounds)===null||e===void 0)&&e.empty()||!((i=t.OBBBounds)===null||i===void 0)&&i.empty()?gZ(n.AABBBounds,t.AABBBounds)&&(!n.rotatedBounds||!t.rotatedBounds||fZ(n.rotatedBounds,t.rotatedBounds,!0)):n.OBBBounds.intersects(t.OBBBounds)}const TH=Math.sin(Math.PI/10);function RH(n,t=TH){const e=!jt(n)&&n!==0,i=e?Math.cos(n):1;return e&&Math.abs(i)<=t}function Ex(n,t=TH){const e=!jt(n)&&n!==0,i=e?Math.sin(n):0;return!e||Math.abs(i)<=t}function ott(n,t){return{x:n.x+t[0],y:n.y+t[1]}}function stt(n={}){var t,e;const{style:i={},angle:r=.5*Math.PI}=n,o=Lt({},qR,i),s=(t=o.size)!==null&&t!==void 0?t:qR.size;return Object.assign(Object.assign({},o),{symbolType:(e=o.symbolType)!==null&&e!==void 0?e:`M ${-s/2} ${s*Math.sin(r)} L ${s/2} ${-s*Math.sin(r)}`,symbolSize:s})}function att(n){const t={};return Fl(n,(e=>{e.type!=="group"&&e.id&&(t[e.id]=e)})),t}function BH(n,t){return{x:n.x+t[0],y:n.y+t[1]}}function KR(n,t,e,i=!1,r=!1){const o=[t.x-e.x,t.y-e.y];return vH(o,(i?-1:1)*(r?-1:1)*n/bH(o))}function ltt(n,t,e,i,r){const o=uZ({x:0,y:0},e,n),s=BH(o,KR(i,o,t,r));return ott(s,KR(i||1,s,t,r))}function Jr(n,t,e){var i;const r=(i=n.attribute)===null||i===void 0?void 0:i.angle;if(Ex(r,Number.EPSILON))return e>WT(n.AABBBounds,t.AABBBounds);const o=n.OBBBounds,s=t.OBBBounds;return!o||!s||o.empty()||s.empty()?e>WT(n.AABBBounds,t.AABBBounds):o.intersects(s)||e>mZ(o,s)}function Dw(n,t){for(let e,i=1,r=n.length,o=n[0];i<r;o=e,++i)if(e=n[i],Jr(o,e,t))return!0;return!1}const htt=(n,t,e)=>{const i=n.target;return i!==e&&i.name&&!Re(i.states)?(i.addState(kn.hover,!0),Fl(t,(r=>{r!==i&&r.name&&!Re(r.states)&&r.addState(kn.hoverReverse,!0)})),i):e},utt=(n,t,e)=>e&&(Fl(t,(i=>{i.name&&!Re(i.states)&&(i.removeState(kn.hoverReverse),i.removeState(kn.hover))})),null),dtt=(n,t,e)=>{const i=n.target;return e===i&&i.hasState(kn.selected)?(Fl(t,(r=>{r.name&&!Re(r.states)&&(r.removeState(kn.selectedReverse),r.removeState(kn.selected))})),null):i.name&&!Re(i.states)?(i.addState(kn.selected,!0),Fl(t,(r=>{r!==i&&r.name&&!Re(r.states)&&r.addState(kn.selectedReverse,!0)})),i):e};class ctt extends hr{_prepareAnimate(t){if(this.attribute.animation!==!1){const{animation:e,animationEnter:i,animationExit:r,animationUpdate:o}=this.attribute,s=ao(e)?e:{};this._animationConfig={enter:i!==!1&&Lt({},t,s,i??{}),exit:r!==!1&&Lt({},t,s,r??{}),update:o!==!1&&(_e(o)?o:Lt({},t,s,o??{}))}}else this._animationConfig={enter:!1,exit:!1,update:!1}}}const gtt={type:"default",duration:300,easing:"linear"};class ftt extends ctt{constructor(){super(...arguments),this.name="axis",this.data=[],this.tickLineItems=[],this.subTickLineItems=[],this.axisLabelLayerSize={},this.axisLabelsContainer=null,this._onHover=t=>{this._lastHover=htt(t,this.axisContainer,this._lastHover)},this._onUnHover=t=>{this._lastHover=utt(t,this.axisContainer,this._lastHover)},this._onClick=t=>{this._lastSelect=dtt(t,this.axisContainer,this._lastSelect)}}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}getBoundsWithoutRender(t){const e=YI(this.attribute);e.scale=this.attribute.scale,this.attribute=t;const i=At.group({x:this.attribute.x,y:this.attribute.y});return this.add(i),this._renderInner(i),this.removeChild(i),this.attribute=e,i.AABBBounds}render(){this._prepare(),this._prevInnerView=this._innerView&&att(this._innerView),this.removeAllChild(!0),this._innerView=At.group({x:0,y:0,pickable:!1}),this.add(this._innerView),this._renderInner(this._innerView),this._bindEvent(),this.runAnimation()}_prepare(){this._prepareAnimate(gtt)}_bindEvent(){if(this.attribute.disableTriggerEvent)return;const{hover:t,select:e}=this.attribute;t&&(this._innerView.addEventListener("pointermove",this._onHover),this._innerView.addEventListener("pointerout",this._onUnHover)),e&&this._innerView.addEventListener("pointerdown",this._onClick)}_renderInner(t){const{title:e,label:i,tick:r,line:o,items:s}=this.attribute,a=At.group({x:0,y:0,zIndex:1,pickable:!1});if(a.name=an.axisContainer,a.id=this._getNodeId("container"),a.setMode(this.mode),this.axisContainer=a,t.add(a),o&&o.visible&&this.renderLine(a),s&&s.length&&(this.data=this._transformItems(s[0]),r&&r.visible&&this.renderTicks(a),i&&i.visible)){const l=At.group({x:0,y:0,pickable:!1});l.name=an.labelContainer,l.id=this._getNodeId("label-container"),this.axisLabelsContainer=l,a.add(l),s.forEach(((h,u)=>{const d=this.renderLabels(l,h,u),c=d.getChildren();this.beforeLabelsOverlap(c,h,d,u,s.length),this.handleLabelsOverlap(c,h,d,u,s.length),this.afterLabelsOverlap(c,h,d,u,s.length);let g=0,f=0,p="center",m="middle",v=0;c.forEach(((b,y)=>{var C;const w=b.attribute,_=(C=w.angle)!==null&&C!==void 0?C:0,A=b.AABBBounds;let x=A.width(),S=A.height();_&&(x=Math.abs(x*Math.cos(_)),S=Math.abs(S*Math.sin(_))),g=Math.max(g,x),f=Math.max(f,S),p=w.textAlign,m=w.textBaseline,y===0&&(v=w.x)})),this.axisLabelLayerSize[u]={width:g,height:f,labelPos:v,textAlign:p,textBaseline:m}}))}e&&e.visible&&this.renderTitle(a)}renderTicks(t){const e=this.getTickLineItems(),i=At.group({x:0,y:0,pickable:!1});i.name=an.tickContainer,i.id=this._getNodeId("tick-container"),t.add(i),e.forEach(((o,s)=>{var a;const l=At.line(Object.assign({},this._getTickLineAttribute("tick",o,s,e)));if(l.name=an.tick,l.id=this._getNodeId(o.id),Re((a=this.attribute.tick)===null||a===void 0?void 0:a.state))l.states=eh;else{const h=this.data[s],u=Lt({},eh,this.attribute.tick.state);Object.keys(u).forEach((d=>{ai(u[d])&&(u[d]=u[d](h.rawValue,s,h,this.data))})),l.states=u}i.add(l)})),this.tickLineItems=e;const{subTick:r}=this.attribute;if(r&&r.visible){const o=this.getSubTickLineItems();o.length&&o.forEach(((s,a)=>{const l=At.line(Object.assign({},this._getTickLineAttribute("subTick",s,a,e)));if(l.name=an.subTick,l.id=this._getNodeId(`${a}`),Re(r.state))l.states=eh;else{const h=Lt({},eh,r.state);Object.keys(h).forEach((u=>{ai(h[u])&&(h[u]=h[u](s.value,a,s,e))})),l.states=h}i.add(l)})),this.subTickLineItems=o}}renderLabels(t,e,i){const{dataFilter:r}=this.attribute.label;r&&ai(r)&&(e=r(e,i));const o=this._transformItems(e),s=At.group({x:0,y:0,pickable:!1});return s.name=`${an.labelContainer}-layer-${i}`,s.id=this._getNodeId(`label-container-layer-${i}`),t.add(s),o.forEach(((a,l)=>{var h;const u=this._getLabelAttribute(a,l,o,i),d=Iw(u);if(d.name=an.label,d.id=this._getNodeId(`layer${i}-label-${a.id}`),Re((h=this.attribute.label)===null||h===void 0?void 0:h.state))d.states=eh;else{const c=Lt({},eh,this.attribute.label.state);Object.keys(c).forEach((g=>{ai(c[g])&&(c[g]=c[g](a,l,o,i))})),d.states=c}d.data=Object.assign(Object.assign({},a),{index:l,layer:i}),s.add(d)})),s}renderTitle(t){const e=this.getTitleAttribute(),i=new va(Object.assign({},e));i.name=an.title,i.id=this._getNodeId("title"),t.add(i)}getVerticalCoord(t,e,i){return BH(t,this.getVerticalVector(e,i,t))}getTickLineItems(){const{tick:t}=this.attribute,e=this.data,i=[],{alignWithLabel:r,inside:o=!1,length:s,dataFilter:a}=t;let l=1;return e.length>=2&&(l=e[1].value-e[0].value),(a&&ai(a)?a(e):e).forEach((h=>{let u=h.point,d=h.value;if(!r){const g=h.value-l/2;if(this.isInValidValue(g))return;u=this.getTickCoord(g),d=g}const c=this.getVerticalCoord(u,s,o);if(this.mode==="3d"){const g=this.getVerticalVector(s,o,u);let f=0,p=0;DT(g[0])>DT(g[1])?f=vr/2*(c.x>u.x?1:-1):p=vr/2*(c.y>u.y?-1:1),i.push({start:u,end:c,value:d,id:`tick-${h.id}`,anchor:[u.x,u.y],alpha:f,beta:p})}else i.push({start:u,end:c,value:d,id:`tick-${h.id}`})})),i}getSubTickLineItems(){const{subTick:t}=this.attribute,e=[],{count:i=4,inside:r=!1,length:o=2}=t,s=this.tickLineItems,a=s.length;if(a>=2)for(let l=0;l<a-1;l++){const h=s[l],u=s[l+1];for(let d=0;d<i;d++){const c=(d+1)/(i+1),g=(1-c)*h.value+c*u.value,f=this.getTickCoord(g),p=this.getVerticalCoord(f,o,r);e.push({start:f,end:p,value:g,id:`sub-tick-${g}`})}}return e}_getTickLineAttribute(t,e,i,r){let o=Bn(this.attribute,`${t}.style`);const s=this.data[i];o=ai(o)?Lt({},Bn(Hw,`${t}.style`),t==="tick"?o(s.rawValue,i,s,this.data):o(e.value,i,e,r)):o;const{start:a,end:l,anchor:h,alpha:u,beta:d}=e;return Object.assign({points:[a,l],anchor:h,alpha:u,beta:d},o)}_getLabelAttribute(t,e,i,r){var o,s;const{space:a=4,inside:l=!1,formatMethod:h,type:u="text",text:d}=this.attribute.label;let c=a,g=0;!((o=this.attribute.tick)===null||o===void 0)&&o.visible&&this.attribute.tick.inside===l&&(g=this.attribute.tick.length||4),!((s=this.attribute.subTick)===null||s===void 0)&&s.visible&&this.attribute.subTick.inside===l&&(g=Math.max(g,this.attribute.subTick.length||2)),c+=g;const f=this.getRelativeVector(t.point);r>0&&(f[1]===0?c+=(this.axisLabelLayerSize[r-1].height+Bn(this.attribute,"label.space",4))*r:c+=(this.axisLabelLayerSize[r-1].width+Bn(this.attribute,"label.space",4))*r);const p=this.getVerticalCoord(t.point,c,l),m=this.getVerticalVector(c||1,l,p),v=h?h(`${t.label}`,t,e,i,r):t.label;let{style:b}=this.attribute.label;b=ai(b)?Lt({},Hw.label.style,b(t,e,i,r)):b;const y=this.getLabelAlign(m,l,b.angle);return b=Lt(y,b),ai(b.text)&&(b.text=b.text({label:t.label,value:t.rawValue,index:t.index,layer:r})),Object.assign(Object.assign(Object.assign({},this.getLabelPosition(p,m,v,b)),{text:d??v,_originText:t.label,lineHeight:b?.fontSize,type:u}),b)}getLabelPosition(t,e,i,r){return t}_transformItems(t){const e=[];return t.forEach((i=>{var r;e.push(Object.assign(Object.assign({},i),{point:this.getTickCoord(i.value),id:(r=i.id)!==null&&r!==void 0?r:i.label}))})),e}runAnimation(){const t=this.lastScale;if(this.attribute.scale){const e=this.attribute.scale;this.lastScale=e.clone(),this.lastScale.range([0,1])}if(this.attribute.animation&&this.applyAnimationState){const e=this.getInnerView(),i=this.getPrevInnerView();if(!i)return;const r=this._animationConfig;this._newElementAttrMap={},Fl(e,(o=>{var s;if(o.type!=="group"&&o.id){const a=i[o.id];if(o.setFinalAttributes(o.attribute),a){a.release();const l=a.attribute,h=o.getFinalAttribute(),u=pK(l,h);let d=Object.keys(u).length>0;if("opacity"in l&&h.opacity!==l.opacity&&(u.opacity=(s=h.opacity)!==null&&s!==void 0?s:1,d=!0),r.update&&d){this._newElementAttrMap[o.id]={state:"update",node:o,attrs:o.attribute};const c=a.attribute;o.setAttributes(c),o.applyAnimationState(["update"],[{name:"update",animation:Object.assign(Object.assign({selfOnly:!0},r.update),{type:"axisUpdate",customParameters:{config:r.update,diffAttrs:u,lastScale:t}})}])}}else r.enter&&(this._newElementAttrMap[o.id]={state:"enter",node:o,attrs:o.attribute},o.applyAnimationState(["enter"],[{name:"enter",animation:Object.assign(Object.assign({},r.enter),{type:"axisEnter",selfOnly:!0,customParameters:{config:r.enter,lastScale:t,getTickCoord:this.getTickCoord.bind(this)}})}]))}}))}}release(){super.release(),this._prevInnerView=null,this._innerView=null}}const ZR={parity:function(n){return n.filter(((t,e)=>e%2?t.setAttribute("opacity",0):1))},greedy:function(n,t){let e;return n.filter(((i,r)=>r&&Jr(e,i,t)?i.setAttribute("opacity",0):(e=i,1)))}};function ptt(n){let t;return t=n.OBBBounds.empty()?n.AABBBounds:n.OBBBounds,t.width()>1&&t.height()>1}function mtt(n){return n.forEach((t=>t.setAttribute("opacity",1))),n}function JR(n,t,e,i,r=!1){if(e&&!n.attribute.opacity){const o=t.length;if(o>1){n.setAttribute("opacity",1);for(let s=0;s<o;s++){const a=r?t[o-1-s]:t[s];if(!i(a))break;a.setAttribute("opacity",0)}}}}function vtt(n,t){if(Re(n))return;const e=n.filter(ptt);if(Re(e))return;let i;i=mtt(e);const{method:r="parity",separation:o=0}=t,s=ai(r)?r:ZR[r]||ZR.parity;if(i.length>=3&&Dw(i,o)){do i=s(i,o);while(i.length>=3&&Dw(i,o));const a=(c,g,f=!0)=>f&&c<3||g,l=a(i.length,t.firstVisible,!1);let h=a(i.length,t.lastVisible);const u=e[0],d=yh(e);Jr(u,d,o)&&l&&h&&(d.setAttribute("opacity",0),h=!1),JR(u,i,l,(c=>Jr(c,u,o))),JR(d,i,h,(c=>Jr(c,d,o)||!(!l||c===u)&&Jr(c,u,o)),!0)}e.forEach((a=>{a.setAttribute("visible",!!a.attribute.opacity)}))}function btt(n,t){if(Re(n))return;const{orient:e,labelRotateAngle:i=[0,45,90]}=t;if(i.length===0||n.some((s=>!!s.attribute.angle)))return;let r=0,o=0;for(i&&i.length>0&&(o=i.length);r<o;){const s=i[r++];if(n.forEach((a=>{a.attribute.angle=gl(s)})),Ctt(e,n),!ytt(n))break}}function ytt(n){for(let t=1;t<n.length;t++)if(rtt(n[t-1],n[t]))return!0;return!1}function Ctt(n,t){n!=="bottom"&&n!=="top"||wtt(n,t),n!=="left"&&n!=="right"||_tt(n,t),ntt(t)}function Sv(n=0){if(n<0)for(;n<0;)n+=2*Math.PI;if(n>0)for(;n>=2*Math.PI;)n-=2*Math.PI;return n}function _tt(n,t){t.forEach(((e,i)=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},PH(n,e.attribute.angle)),{angle:Sv(e.attribute.angle)}))}))}function wtt(n,t){t.forEach((e=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},kH(n,e.attribute.angle)),{angle:Sv(e.attribute.angle)}))}))}function kH(n,t=0){let e=["center","left","left","left","center","right","right","right","left"],i=["top","top","middle","bottom","bottom","bottom","middle","top","top"];n==="top"&&(e=["center","right","right","right","center","left","left","left","right"],i=["bottom","bottom","middle","top","top","top","middle","bottom","bottom"]);const r=(t=Sv(t))/(.5*Math.PI);let o;return o=r===Math.floor(r)?2*Math.floor(r):2*Math.floor(r)+1,{textAlign:e[o],textBaseline:i[o]}}function PH(n,t=0){let e=["right","right","center","left","left","left","center","right","right"],i=["middle","middle","top","top","middle","middle","bottom","bottom","middle"];n==="right"&&(e=["left","left","center","right","right","right","center","left","left"],i=["middle","middle","bottom","bottom","middle","middle","top","middle","middle"]);const r=(t=Sv(t))/(.5*Math.PI);let o;return o=r===Math.floor(r)?2*Math.floor(r):2*Math.floor(r)+1,{textAlign:e[o],textBaseline:i[o]}}function xtt(n){return pi(n)?{left:n,right:n}:ao(n)?{left:n.left||0,right:n.right||0}:{left:0,right:0}}function Stt(n,t){const{limitLength:e,verticalLimitLength:i,ellipsis:r="...",orient:o,axisLength:s}=t;if(Re(n)||!pi(e))return;const a=xtt(t.overflowLimitLength),l=n[0],h=l.attribute.angle,u=!jt(h),d=u?Math.cos(h):1,c=u?Math.sin(h):0,g=Ex(h),f=RH(h),p=o==="top"||o==="bottom",m=l.attribute.direction,v=!g&&!f&&p&&(n.length<2||n.some((b=>Math.abs(b.AABBBounds.width()-l.AABBBounds.width())>=2)))&&l.AABBBounds.width()>Math.abs(e/c);n.forEach((b=>{var y;if(p&&(f&&Math.floor(b.AABBBounds.height())<=e||g&&Math.floor(b.AABBBounds.width())<=i)||!p&&(m==="vertical"&&Math.floor(b.AABBBounds.height())<=i||m!=="vertical"&&(g&&Math.floor(b.AABBBounds.width())<=e||f&&Math.floor(b.AABBBounds.height())<=i)))return;let C=null;if(g||f)C=p?g?i:e:m==="vertical"||f?i:e;else if(p){const{x1:w,x2:_}=b.AABBBounds,A=c/d,x=Math.abs(e/c);if(v&&A>0&&w<=s+a.right&&e/A+w>s+a.right){const S=(s-w+a.right)/Math.abs(d);C=Math.min(S,x)}else if(v&&A<0&&_>=-a.left&&e/A+_<-a.left){const S=(_+a.left)/Math.abs(d);C=Math.min(S,x)}else C=x}else C=Math.abs(e/d);pi(b.attribute.maxLineWidth)&&(C=pi(C)?Math.min(b.attribute.maxLineWidth,C):b.attribute.maxLineWidth),b.setAttributes({maxLineWidth:C,ellipsis:(y=b.attribute.ellipsis)!==null&&y!==void 0?y:r})}))}function Att(n,t){const{limitLength:e,axisLength:i,ellipsis:r="...",orient:o}=t;if(Re(n)||!pi(e))return;const s=n[0].attribute.angle,a=Ex(s),l=RH(s),h=o==="top"||o==="bottom";let u=i/n.length;n.forEach(((d,c)=>{var g,f,p,m,v;if(h){if(l&&Math.floor(d.AABBBounds.height())<=e)return;if(a){const C=QR(d.attribute.x,(g=n[c+1])===null||g===void 0?void 0:g.attribute.x,(f=n[c-1])===null||f===void 0?void 0:f.attribute.x);pi(C)&&(u=c0(u,C))}}else{if(l){const C=QR(d.attribute.y,(p=n[c+1])===null||p===void 0?void 0:p.attribute.y,(m=n[c-1])===null||m===void 0?void 0:m.attribute.y);pi(C)&&(u=c0(u,C))}if(a&&Math.floor(d.AABBBounds.width())<=e)return}let b=null,y=null;h?l?(b=e,y=u):(b=u,y=e):l?(b=u,y=e):(b=e,y=u),d.setAttributes({maxLineWidth:b,ellipsis:(v=d.attribute.ellipsis)!==null&&v!==void 0?v:r,whiteSpace:"normal",heightLimit:y})}))}function QR(n,t,e){let i;return pi(t)&&(i=Math.abs(t-n)),pi(e)&&(i=pi(i)?Math.min(Math.abs(n-e),i):Math.abs(n-e)),i}function Mtt(n,t,e,i,r){i==="left"||i==="right"?r==="left"?n.forEach((o=>{var s;o.setAttributes({dx:((s=o.attribute.dx)!==null&&s!==void 0?s:0)+t-o.AABBBounds.x1})})):r==="right"?n.forEach((o=>{var s;o.setAttributes({dx:((s=o.attribute.dx)!==null&&s!==void 0?s:0)+t+e-o.AABBBounds.x2})})):r==="center"&&n.forEach((o=>{var s;o.setAttributes({dx:((s=o.attribute.dx)!==null&&s!==void 0?s:0)+t+e/2-(o.AABBBounds.x1+o.AABBBounds.x2)/2})})):i!=="bottom"&&i!=="top"||(r==="top"?n.forEach((o=>{var s;o.setAttributes({dy:((s=o.attribute.dy)!==null&&s!==void 0?s:0)+t-o.AABBBounds.y1})})):r==="bottom"?n.forEach((o=>{var s;o.setAttributes({dy:((s=o.attribute.dy)!==null&&s!==void 0?s:0)+t+e-o.AABBBounds.y2})})):r==="middle"&&n.forEach((o=>{var s;o.setAttributes({dy:((s=o.attribute.dy)!==null&&s!==void 0?s:0)+t+e/2-(o.AABBBounds.y1+o.AABBBounds.y2)/2})})))}class Ttt{isInValidValue(t){return t<0||t>1}getTickCoord(t){const{start:e}=this.attribute,i=this.getRelativeVector();return{x:e.x+i[0]*t,y:e.y+i[1]*t}}getRelativeVector(t){const{start:e,end:i}=this.attribute;return[i.x-e.x,i.y-e.y]}getVerticalVector(t,e=!1,i){const{verticalFactor:r=1}=this.attribute,o=this.getRelativeVector(),s=NQ(o),a=[s[1],-1*s[0]];return vH(a,t*(e?1:-1)*r)}}const Lx=(n,t)=>Object.prototype.toString.call(n)===`[object ${t}]`,hs=n=>typeof n=="function",ii=n=>n==null,xn=n=>n!=null,tB=(n,t=!1)=>{const e=typeof n;return t?e==="string":e==="string"||Lx(n,"String")},Fw=n=>Array.isArray?Array.isArray(n):Lx(n,"Array"),fn=(n,t=!1)=>{const e=typeof n;return t?e==="number":e==="number"||Lx(n,"Number")},ba=n=>fn(n)&&Number.isFinite(n);function Rtt(n){if(!n)return[];if(Object.keys)return Object.keys(n);const t=[];for(const e in n)n.hasOwnProperty(e)&&t.push(e);return t}function Btt(n,t,e){const i=Rtt(t);for(let r=0;r<i.length;r++){const o=i[r];(e?t[o]!=null:n[o]==null)&&(n[o]=t[o])}return n}function eB(n,t,e=!0){if(n="prototype"in n?n.prototype:n,t="prototype"in t?t.prototype:t,Object.getOwnPropertyNames){const i=Object.getOwnPropertyNames(t);for(let r=0;r<i.length;r++){const o=i[r];o!=="constructor"&&(e?t[o]!=null:n[o]==null)&&(n[o]=t[o])}}else Btt(n,t,e)}const ktt=1e-10,Ptt=1e-10;function EH(n,t,e=Ptt,i=ktt){const r=i,o=e*Math.max(n,t);return Math.abs(n-t)<=Math.max(r,o)}const La=2*Math.PI,uy=Math.sqrt,nh=Math.pow;class Ox{constructor(t=0,e=0,i,r){this.x=0,this.y=0,this.x=t,this.y=e,this.x1=i,this.y1=r}clone(){return new Ox(this.x,this.y)}copyFrom(t){return this.x=t.x,this.y=t.y,this.x1=t.x1,this.y1=t.y1,this.defined=t.defined,this.context=t.context,this}set(t,e){return this.x=t,this.y=e,this}add(t){return fn(t)?(this.x+=t,void(this.y+=t)):(this.x+=t.x,this.y+=t.y,this)}sub(t){return fn(t)?(this.x-=t,void(this.y-=t)):(this.x-=t.x,this.y-=t.y,this)}multi(t){throw new Error("暂不支持")}div(t){throw new Error("暂不支持")}}class df{static distancePP(t,e){return uy(nh(t.x-e.x,2)+nh(t.y-e.y,2))}static distanceNN(t,e,i,r){return uy(nh(t-i,2)+nh(e-r,2))}static distancePN(t,e,i){return uy(nh(e-t.x,2)+nh(i-t.y,2))}static pointAtPP(t,e,i){return new Ox((e.x-t.x)*i+t.x,(e.y-t.y)*i+t.y)}}class Dt{constructor(){}static linear(t){return t}static none(){return this.linear}static get(t){return t<-1?t=-1:t>1&&(t=1),function(e){return t===0?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}}static getPowIn(t){return function(e){return Math.pow(e,t)}}static getPowOut(t){return function(e){return 1-Math.pow(1-e,t)}}static getPowInOut(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}}static getBackIn(t){return function(e){return e*e*((t+1)*e-t)}}static getBackOut(t){return function(e){return--e*e*((t+1)*e+t)+1}}static getBackInOut(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}static sineIn(t){return 1-Math.cos(t*Math.PI/2)}static sineOut(t){return Math.sin(t*Math.PI/2)}static sineInOut(t){return-(Math.cos(Math.PI*t)-1)/2}static expoIn(t){return t===0?0:Math.pow(2,10*t-10)}static expoOut(t){return t===1?1:1-Math.pow(2,-10*t)}static expoInOut(t){return t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}static circIn(t){return-(Math.sqrt(1-t*t)-1)}static circOut(t){return Math.sqrt(1- --t*t)}static circInOut(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}static bounceOut(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}static bounceIn(t){return 1-Dt.bounceOut(1-t)}static bounceInOut(t){return t<.5?.5*Dt.bounceIn(2*t):.5*Dt.bounceOut(2*t-1)+.5}static getElasticIn(t,e){return function(i){if(i===0||i===1)return i;const r=e/La*Math.asin(1/t);return-t*Math.pow(2,10*(i-=1))*Math.sin((i-r)*La/e)}}static getElasticOut(t,e){return function(i){if(i===0||i===1)return i;const r=e/La*Math.asin(1/t);return t*Math.pow(2,-10*i)*Math.sin((i-r)*La/e)+1}}static getElasticInOut(t,e){return function(i){const r=e/La*Math.asin(1/t);return(i*=2)<1?t*Math.pow(2,10*(i-=1))*Math.sin((i-r)*La/e)*-.5:t*Math.pow(2,-10*(i-=1))*Math.sin((i-r)*La/e)*.5+1}}static registerFunc(t,e){Dt[t]=e}}function Ett(n,t){const e=1/t;let i=1;for(;n>e;)n-=e,i*=-1;const r=i*n/e;return r>0?r:1+r}Dt.quadIn=Dt.getPowIn(2),Dt.quadOut=Dt.getPowOut(2),Dt.quadInOut=Dt.getPowInOut(2),Dt.cubicIn=Dt.getPowIn(3),Dt.cubicOut=Dt.getPowOut(3),Dt.cubicInOut=Dt.getPowInOut(3),Dt.quartIn=Dt.getPowIn(4),Dt.quartOut=Dt.getPowOut(4),Dt.quartInOut=Dt.getPowInOut(4),Dt.quintIn=Dt.getPowIn(5),Dt.quintOut=Dt.getPowOut(5),Dt.quintInOut=Dt.getPowInOut(5),Dt.backIn=Dt.getBackIn(1.7),Dt.backOut=Dt.getBackOut(1.7),Dt.backInOut=Dt.getBackInOut(1.7),Dt.elasticIn=Dt.getElasticIn(1,.3),Dt.elasticOut=Dt.getElasticOut(1,.3),Dt.elasticInOut=Dt.getElasticInOut(1,.3*1.5),Dt.easeInOutQuad=n=>(n/=.5)<1?.5*Math.pow(n,2):-.5*((n-=2)*n-2),Dt.easeOutElastic=n=>{const t=2*Math.PI/3;return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((10*n-.75)*t)+1},Dt.easeInOutElastic=n=>{const t=2*Math.PI/4.5;return n===0?0:n===1?1:n<.5?-Math.pow(2,20*n-10)*Math.sin((20*n-11.125)*t)/2:Math.pow(2,-20*n+10)*Math.sin((20*n-11.125)*t)/2+1};for(let n=0;n<10;n++)Dt[`flicker${n}`]=t=>Ett(t,n);for(let n=2;n<10;n++)Dt[`aIn${n}`]=t=>n*t*t+(1-n)*t;function Ge(n,t,e){return n+(t-n)*e}class Ltt{constructor(){this.opacity=(t,e,i,r,o,s)=>{s.attribute.opacity=Ge(e,i,r)},this.baseOpacity=(t,e,i,r,o,s)=>{s.attribute.baseOpacity=Ge(e,i,r)},this.fillOpacity=(t,e,i,r,o,s)=>{s.attribute.fillOpacity=Ge(e,i,r)},this.strokeOpacity=(t,e,i,r,o,s)=>{s.attribute.strokeOpacity=Ge(e,i,r)},this.zIndex=(t,e,i,r,o,s)=>{s.attribute.zIndex=Ge(e,i,r)},this.backgroundOpacity=(t,e,i,r,o,s)=>{s.attribute.backgroundOpacity=Ge(e,i,r)},this.shadowOffsetX=(t,e,i,r,o,s)=>{s.attribute.shadowOffsetX=Ge(e,i,r)},this.shadowOffsetY=(t,e,i,r,o,s)=>{s.attribute.shadowOffsetY=Ge(e,i,r)},this.shadowBlur=(t,e,i,r,o,s)=>{s.attribute.shadowBlur=Ge(e,i,r)},this.fill=(t,e,i,r,o,s)=>{s.attribute.fill=Il(e,i,r,!1)},this.fillPure=(t,e,i,r,o,s)=>{s.attribute.fill=o.fromParsedProps.fill?jM(o.fromParsedProps.fill,o.toParsedProps.fill,r):o.toParsedProps.fill},this.stroke=(t,e,i,r,o,s)=>{s.attribute.stroke=Il(e,i,r,!1)},this.strokePure=(t,e,i,r,o,s)=>{s.attribute.stroke=o.fromParsedProps.stroke?jM(o.fromParsedProps.stroke,o.toParsedProps.stroke,r):o.toParsedProps.stroke},this.width=(t,e,i,r,o,s)=>{s.attribute.width=Ge(e,i,r),s.addUpdateBoundTag()},this.height=(t,e,i,r,o,s)=>{s.attribute.height=Ge(e,i,r),s.addUpdateBoundTag()},this.x=(t,e,i,r,o,s)=>{s.attribute.x=Ge(e,i,r),s.addUpdateBoundTag(),s.addUpdatePositionTag()},this.y=(t,e,i,r,o,s)=>{s.attribute.y=Ge(e,i,r),s.addUpdateBoundTag(),s.addUpdatePositionTag()},this.dx=(t,e,i,r,o,s)=>{s.attribute.dx=Ge(e,i,r),s.addUpdateBoundTag(),s.addUpdatePositionTag()},this.dy=(t,e,i,r,o,s)=>{s.attribute.dy=Ge(e,i,r),s.addUpdateBoundTag(),s.addUpdatePositionTag()},this.angle=(t,e,i,r,o,s)=>{s.attribute.angle=Ge(e,i,r),s.addUpdateBoundTag(),s.addUpdatePositionTag()},this.scaleX=(t,e,i,r,o,s)=>{s.attribute.scaleX=Ge(e,i,r),s.addUpdateBoundTag(),s.addUpdatePositionTag()},this.scaleY=(t,e,i,r,o,s)=>{s.attribute.scaleY=Ge(e,i,r),s.addUpdateBoundTag(),s.addUpdatePositionTag()},this.lineWidth=(t,e,i,r,o,s)=>{s.attribute.lineWidth=Ge(e,i,r),s.addUpdateBoundTag()},this.startAngle=(t,e,i,r,o,s)=>{s.attribute.startAngle=Ge(e,i,r),s.addUpdateBoundTag()},this.endAngle=(t,e,i,r,o,s)=>{s.attribute.endAngle=Ge(e,i,r),s.addUpdateBoundTag()},this.radius=(t,e,i,r,o,s)=>{s.attribute.radius=Ge(e,i,r),s.addUpdateBoundTag()},this.outerRadius=(t,e,i,r,o,s)=>{s.attribute.outerRadius=Ge(e,i,r),s.addUpdateBoundTag()},this.innerRadius=(t,e,i,r,o,s)=>{s.attribute.innerRadius=Ge(e,i,r),s.addUpdateBoundTag()},this.size=(t,e,i,r,o,s)=>{s.attribute.size=Ge(e,i,r),s.addUpdateBoundTag()},this.points=(t,e,i,r,o,s)=>{s.attribute.points=hx(e,i,r),s.addUpdateBoundTag()}}}const od=new Ltt;function iB(n,t,e,i,r,o){if(Number.isFinite(e)&&Number.isFinite(t))return o.attribute[n]=t+(e-t)*i,!0;if(Array.isArray(e)&&Array.isArray(t)&&e.length===t.length){const s=[];let a=!0;for(let l=0;l<e.length;l++){const h=t[l],u=h+(e[l]-h)*i;if(!Number.isFinite(u)){a=!1;break}s.push(u)}return a&&(o.attribute[n]=s),!0}return!1}function nB(){}class O0{constructor(t,e,i,r){var o;this._startTime=0,this._hasFirstRun=!1,this._syncAttributeUpdate=()=>{this.target.setAttributes(this.target.attribute)},this.type=t,this.props=e,this.duration=i,this.easing=r?typeof r=="function"?r:(o=Dt[r])!==null&&o!==void 0?o:Dt.linear:Dt.linear,t==="wait"&&(this.onUpdate=nB),this.id=Ci.GenAutoIncrementId(),this.syncAttributeUpdate=nB}bind(t,e){this.target=t,this.animate=e,this.onBind(),this.syncAttributeUpdate()}append(t){this.next=t,t.prev=this,t.setStartTime(this.getStartTime()+this.duration,!1)}updateDownstreamStartTimes(){let t=this.next,e=this._startTime+this.duration;for(;t;)t.setStartTime(e,!1),e+=t.duration,t=t.next;this.animate.updateDuration()}getLastProps(){return this.prev?this.prev.props||{}:this.animate.getStartProps()}setDuration(t,e=!0){this.duration=t,e&&this.updateDownstreamStartTimes()}getDuration(){return this.duration}determineInterpolateUpdateFunction(){if(!this.props)return;const t=[];this.propKeys.forEach((e=>{if(e==="fill"||e==="stroke"){const i=this.fromProps[e],r=this.props[e];if(tB(i)&&tB(r)){const o=Ai.Get(i,io.Color255),s=Ai.Get(r,io.Color255);this.fromParsedProps||(this.fromParsedProps={}),this.toParsedProps||(this.toParsedProps={}),this.fromParsedProps[e]=o,this.toParsedProps[e]=s,t.push(od[e==="fill"?"fillPure":"strokePure"])}else od[e]?t.push(od[e]):t.push(iB)}else od[e]?t.push(od[e]):t.push(iB)})),this.interpolateUpdateFunctions=t}setStartTime(t,e=!0){this._startTime=t,e&&this.updateDownstreamStartTimes()}getStartTime(){return this._startTime}onBind(){this.target.type==="glyph"&&(this.syncAttributeUpdate=this._syncAttributeUpdate)}onFirstRun(){}onStart(){if(!this._hasFirstRun){this._hasFirstRun=!0,this.fromProps=this.getLastProps();const t=this.animate.getStartProps();this.propKeys&&this.propKeys.forEach((e=>{var i;this.fromProps[e]=(i=this.fromProps[e])!==null&&i!==void 0?i:t[e]})),this.determineInterpolateUpdateFunction(),this.tryPreventConflict(),this.trySyncStartProps(),this.onFirstRun()}}tryPreventConflict(){const t=this.animate;this.target.animates.forEach((e=>{if(e===t||e.priority>t.priority||e.priority===1/0)return;const i=e.getStartProps();this.propKeys.forEach((r=>{i[r]!=null&&e.preventAttr(r)}))}))}deleteSelfAttr(t){var e;delete this.props[t],this.fromProps&&delete this.fromProps[t];const i=this.propKeys.indexOf(t);i!==-1&&(this.propKeys.splice(i,1),(e=this.interpolateUpdateFunctions)===null||e===void 0||e.splice(i,1))}trySyncStartProps(){this.propKeys.forEach((t=>{this.fromProps[t]=this.animate.target.getComputedAttribute(t)}))}update(t,e,i){if(this.onStart(),!this.props||!this.propKeys)return;const r=this.easing(e);this.animate.interpolateUpdateFunction?this.animate.interpolateUpdateFunction(this.fromProps,this.props,r,this,this.target):this.interpolateUpdateFunctions.forEach(((o,s)=>{if(!this.animate.validAttr(this.propKeys[s]))return;const a=this.propKeys[s];o(a,this.fromProps[a],this.props[a],r,this,this.target)})),this.onUpdate(t,r,i),this.syncAttributeUpdate()}onUpdate(t,e,i){}onEnd(t){this.target.setAttributes(this.props),t?this._endCb=t:this._endCb&&this._endCb(this.animate,this)}getEndProps(){return this.props}getFromProps(){return this.fromProps}getMergedEndProps(){return this.getEndProps()}stop(){}release(){}}class Ott extends O0{constructor(t,e,i,r){super(t,e,i,r)}onStart(){super.onStart();const t=this.getFromProps();this.target.setAttributes(t)}update(t,e,i){this.onStart()}determineInterpolateUpdateFunction(){}}class Ix extends Gl{get animateCount(){return this._animateCount}constructor(){super(),this.head=null,this.tail=null,this.animateMap=new Map,this._animateCount=0,this._playSpeed=1,this._totalDuration=0,this._startTime=0,this._currentTime=0,this._animationEndFlag=!0,this.id=Ci.GenAutoIncrementId(),this.paused=!1}isRunning(){return!this.paused&&this._animateCount>0}forEachAccessAnimate(t){let e=this.head,i=0;for(;e;){const r=e.next;t(e.animate,i),i++,e=r}}addAnimate(t){const e={animate:t,next:null,prev:null};this.head?this.tail&&(this.tail.next=e,e.prev=this.tail,this.tail=e):(this.head=e,this.tail=e),this.animateMap.set(t,e),this._animateCount++,this._totalDuration=Math.max(this._totalDuration,t.getStartTime()+t.getDuration())}pause(){this.paused=!0}resume(){this.paused=!1}tick(t){if(this.paused)return;this._animationEndFlag&&(this._animationEndFlag=!1,this.emit("animationStart"));const e=t*this._playSpeed;this._currentTime+=e,this.forEachAccessAnimate(((i,r)=>{i.status===bn.END?this.removeAnimate(i,!0):i.status!==bn.RUNNING&&i.status!==bn.INITIAL||i.advance(e)})),this._animateCount===0&&(this._animationEndFlag=!0,this.emit("animationEnd"))}clear(){this.forEachAccessAnimate((t=>{t.release()})),this.head=null,this.tail=null,this.animateMap.clear(),this._animateCount=0,this._totalDuration=0}removeAnimate(t,e=!0){const i=this.animateMap.get(t);i&&(e&&(t._onRemove&&t._onRemove.forEach((r=>r())),t.release()),i.prev?i.prev.next=i.next:this.head=i.next,i.next?i.next.prev=i.prev:this.tail=i.prev,this.animateMap.delete(t),this._animateCount--,t.getStartTime()+t.getDuration()>=this._totalDuration&&this.recalculateTotalDuration())}recalculateTotalDuration(){this._totalDuration=0,this.forEachAccessAnimate((t=>{this._totalDuration=Math.max(this._totalDuration,t.getStartTime()+t.getDuration())}))}getTotalDuration(){return this._totalDuration}getPlaySpeed(){return this._playSpeed}setPlaySpeed(t){this._playSpeed=t}getPlayState(){return this.paused?"paused":this.animateCount===0?"stopped":"playing"}setStartTime(t){this._startTime=t}getStartTime(){return this._startTime}getCurrentTime(){return this._currentTime}setCurrentTime(t){this._currentTime=t}}const Hx=new Ix;Hx.isGlobal=!0;class LH{constructor(t=Ci.GenAutoIncrementId(),e=Hx,i){this.id=t,this.status=bn.INITIAL,this._timeline=e,e.addAnimate(this),this.slience=i,this._startTime=0,this._duration=0,this._totalDuration=0,this._loopCount=0,this._currentLoop=0,this._bounce=!1,this._firstStep=null,this._lastStep=null,this._startProps={},this._endProps={},this._preventAttrs=new Set,this.currentTime=0,this.interpolateUpdateFunction=null,this.priority=0}getStartProps(){return this._startProps}getEndProps(){return this._endProps}setTimeline(t){this._timeline=t}getTimeline(){return this._timeline}get timeline(){return this._timeline}bind(t){return this.target=t,this.target.animates||(this.target.animates=new Map),this.target.animates.set(this.id,this),this.onRemove((()=>{this.stop(),this.target.animates.delete(this.id)})),this.target.onAnimateBind&&!this.slience&&this.target.onAnimateBind(this),this.target.animationAttribute||(this.target.animationAttribute={}),this}to(t,e=300,i="linear"){const r=new O0(Fd.to,t,e,i);return r.bind(this.target,this),this.updateStepAfterAppend(r),this}wait(t){const e=new Ott(Fd.wait,{},t,"linear");return e.bind(this.target,this),this.updateStepAfterAppend(e),this}updateStepAfterAppend(t){this._firstStep?(this._lastStep.append(t),this._lastStep=t):(this._firstStep=t,this._lastStep=t),this.parseStepProps(t),this.updateDuration()}parseStepProps(t){this._lastStep&&(t.propKeys=t.propKeys||Object.keys(t.props),Object.keys(this._endProps).forEach((e=>{var i;t.props[e]=(i=t.props[e])!==null&&i!==void 0?i:this._endProps[e]})),t.propKeys.forEach((e=>{this._endProps[e]=t.props[e]})))}reSyncProps(){if(!this._lastStep)return;this._endProps={};let t=this._firstStep;for(;t;)Object.keys(this._endProps).forEach((e=>{var i;t.props[e]=(i=t.props[e])!==null&&i!==void 0?i:this._endProps[e]})),t.propKeys.forEach((e=>{this._endProps[e]=t.props[e]})),t=t.next}from(t,e=300,i="linear"){const r=new O0(Fd.from,t,e,i);return this._firstStep?(this._lastStep.append(r),this._lastStep=r):(this._firstStep=r,this._lastStep=r),this.updateDuration(),this}play(t){return t.bind(this.target,this),this.updateStepAfterAppend(t),this}pause(){this.status===bn.RUNNING&&(this.status=bn.PAUSED)}resume(){this.status===bn.PAUSED&&(this.status=bn.RUNNING)}onStart(t){var e;t?(this._onStart||(this._onStart=[]),this._onStart.push(t)):((e=this._onStart)===null||e===void 0||e.forEach((i=>i())),Object.keys(this._endProps).forEach((i=>{this._startProps[i]=this.target.getComputedAttribute(i)})))}onEnd(t){var e;t?(this._onEnd||(this._onEnd=[]),this._onEnd.push(t)):(e=this._onEnd)===null||e===void 0||e.forEach((i=>i()))}onFrame(t){t&&(this._onFrame||(this._onFrame=[]),this._onFrame.push(t))}onRemove(t){var e;t?(this._onRemove||(this._onRemove=[]),this._onRemove.push(t)):(e=this._onRemove)===null||e===void 0||e.forEach((i=>i()))}preventAttr(t){this._preventAttrs.add(t),delete this._startProps[t],delete this._endProps[t];let e=this._firstStep;for(;e;)e.deleteSelfAttr(t),e=e.next}preventAttrs(t){t.forEach((e=>this._preventAttrs.add(e)))}validAttr(t){return!this._preventAttrs.has(t)}runCb(t){var e;return(e=this._lastStep)===null||e===void 0||e.onEnd(t),this}startAt(t){return this._startTime=t,this}customInterpolate(t,e,i,r,o,s){return!1}getFromValue(){return this._startProps}getToValue(){return this._endProps}stop(t){let e=this._firstStep;for(;e;)e.stop(),e=e.next;this.status!==bn.END&&this.onEnd(),this.status=bn.END,this.target&&(t==="start"?this.target.setAttributes(this._startProps):t==="end"?this.target.setAttributes(this._endProps):t&&this.target.setAttributes(t))}release(){this.status=bn.END,this._onRemove&&this._onRemove.forEach((t=>t())),this._onStart=[],this._onFrame=[],this._onEnd=[],this._onRemove=[],this.forEachStep((t=>{t.release()}))}getDuration(){return this._duration}getStartTime(){return this._startTime}afterAll(t){if(!t||t.length===0)return this;let e=0;return t.forEach((i=>{const r=i.getStartTime()+i.getTotalDuration();e=Math.max(e,r)})),this.startAt(e)}after(t){if(!t)return this;const e=t.getStartTime()+t.getTotalDuration();return this.startAt(e)}parallel(t){return t?(this.startAt(t.getStartTime()),this):this}loop(t){return t===!0?t=1/0:t===!1&&(t=0),this._loopCount=t,this.updateDuration(),this}bounce(t){return this._bounce=t,this}advance(t){var e,i,r;if(this.status===bn.END)return;const o=this.currentTime+t;if(o<this._startTime)return void(this.currentTime=o);if(o>=this._startTime+this._totalDuration)return(e=this._lastStep)===null||e===void 0||e.onUpdate(!0,1,{}),(i=this._lastStep)===null||i===void 0||i.onEnd(),this.onEnd(),void(this.status=bn.END);this.status=bn.RUNNING,this.currentTime<=this._startTime&&this.onStart(),this.currentTime=o;let s=o-this._startTime,a=!1,l=!1;if(this._loopCount>0){s=(o-this._startTime)%this._duration;const c=Math.floor((o-this._startTime)/this._duration);a=c>this._currentLoop,this._currentLoop=c,l=this._bounce&&c%2==1,l&&(s=this._duration-s)}a&&!l&&this.target.setAttributes(this._startProps);let h=null;if(this._lastStep===this._firstStep)h=this._firstStep;else{let c=this._firstStep;for(;c;){const g=c.getStartTime(),f=c.getDuration();if(s>=g&&s<=g+f){h=c;break}c=c.next}}if(!h)return;h!==this.lastRunStep&&((r=this.lastRunStep)===null||r===void 0||r.onEnd()),this.lastRunStep=h;const u=(s-h.getStartTime())/h.getDuration(),d=u>=1;h.update(d,u,{}),d&&(h.onEnd(),this.lastRunStep=null)}updateDuration(){this._lastStep?(this._duration=this._lastStep.getStartTime()+this._lastStep.getDuration(),this._totalDuration=this._duration*(this._loopCount+1)):this._duration=0}getTotalDuration(){return this._totalDuration}getLoop(){return this._loopCount}forEachStep(t){let e=this._firstStep;for(;e;)t(e),e=e.next}}const Itt=new zO;class Htt{constructor(){this.released=!1}tick(t,e){Itt.addAnimationFrameCb((()=>{if(!this.released)return e(this)}))}release(){this.released=!0}getTime(){return Date.now()}}class OH extends Gl{constructor(t){super(),this.timelines=[],this.frameTimeHistory=[],this.handleTick=(e,i)=>{const{once:r=!1}=i??{};if(this.ifCanStop())return this.stop(),!1;const o=e.getTime();this._lastTickTime=o,this.lastFrameTime<0&&(this.lastFrameTime=o-this.interval+this.timeOffset,this.frameTimeHistory.push(this.lastFrameTime));const s=o-this.lastFrameTime,a=this.checkSkip(s);return a||(this._handlerTick(s),this.lastFrameTime=o,this.frameTimeHistory.push(this.lastFrameTime)),r||e.tick(this.interval,this.handleTick),!a},this._handlerTick=e=>{this.status===In.RUNNING&&(this.tickCounts++,this.timelines.forEach((i=>{i.tick(e)})),this.emit("tick",e))},this.init(),this.lastFrameTime=-1,this.tickCounts=0,this.stage=t,this.autoStop=!0,this.interval=16,this.computeTimeOffsetAndJitter()}bindStage(t){this.stage=t}computeTimeOffsetAndJitter(){this.timeOffset=Math.floor(Math.random()*this.interval),this._jitter=Math.min(Math.max(.2*this.interval,6),.7*this.interval)}init(){this.interval=16,this.status=In.INITIAL,mt.global.hooks.onSetEnv.tap("graph-ticker",(()=>{this.initHandler(!1)})),mt.global.env&&this.initHandler(!1)}addTimeline(t){this.timelines.push(t)}remTimeline(t){this.timelines=this.timelines.filter((e=>e!==t))}getTimelines(){return this.timelines}initHandler(t=!1){this.setupTickHandler(t)}setupTickHandler(t=!1){if(!t&&this.tickerHandler)return!0;const e=new Htt;return this.tickerHandler&&this.tickerHandler.release(),this.tickerHandler=e,!0}setInterval(t){this.interval=t,this.computeTimeOffsetAndJitter()}getInterval(){return this.interval}setFPS(t){this.setInterval(Math.floor(1e3/t))}getFPS(){return 1e3/this.interval}tick(t){this.tickerHandler.tick(t,(e=>this.handleTick(e,{once:!0})))}tickTo(t){this.tickerHandler.tickTo&&this.tickerHandler.tickTo(t,(e=>{this.handleTick(e,{once:!0})}))}pause(){return this.status!==In.INITIAL&&(this.status=In.PAUSE,!0)}resume(){return this.status!==In.INITIAL&&(this.status=In.RUNNING,!0)}ifCanStop(){return!!(this.autoStop&&(!this.timelines.length||this.timelines.every((t=>!t.isRunning()))))}start(t=!1){return this.status===In.RUNNING||!this.tickerHandler||!t&&(this.status===In.PAUSE||this.ifCanStop())?!1:(this.status=In.RUNNING,this.tickerHandler.tick(0,this.handleTick),!0)}stop(){this.status=In.INITIAL,this.setupTickHandler(!0),this.lastFrameTime=-1}trySyncTickStatus(){this.status===In.INITIAL&&this.timelines.some((t=>t.isRunning()))?this.start():this.status===In.RUNNING&&this.timelines.every((t=>!t.isRunning()))&&this.stop()}release(){var t;this.stop(),this.timelines=[],(t=this.tickerHandler)===null||t===void 0||t.release(),this.tickerHandler=null,this.lastFrameTime=-1}checkSkip(t){var e,i,r;return((r=(i=(e=this.stage)===null||e===void 0?void 0:e.params)===null||i===void 0?void 0:i.optimize)===null||r===void 0?void 0:r.tickRenderMode)==="performance"?!1:t<this.interval+2*(Math.random()-.5)*this._jitter}}class fl{constructor(){this.transitions=new Map,this.registerDefaultTransitions()}static getInstance(){return fl.instance||(fl.instance=new fl),fl.instance}registerDefaultTransitions(){this.registerTransition("appear","*",(()=>({allowTransition:!0,stopOriginalTransition:!1}))),this.registerTransition("appear","appear",(()=>({allowTransition:!1,stopOriginalTransition:!1}))),this.registerTransition("appear","disappear",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("appear","exit",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("normal","*",(()=>({allowTransition:!0,stopOriginalTransition:!1}))),this.registerTransition("normal","normal",(()=>({allowTransition:!1,stopOriginalTransition:!1}))),this.registerTransition("normal","disappear",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("normal","exit",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("exit","*",(()=>({allowTransition:!1,stopOriginalTransition:!1}))),this.registerTransition("exit","disappear",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("exit","enter",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("exit","exit",(()=>({allowTransition:!1,stopOriginalTransition:!1}))),this.registerTransition("enter","*",(()=>({allowTransition:!0,stopOriginalTransition:!1}))),this.registerTransition("enter","enter",(()=>({allowTransition:!1,stopOriginalTransition:!1}))),this.registerTransition("enter","disappear",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("enter","exit",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("disappear","*",(()=>({allowTransition:!1,stopOriginalTransition:!1}))),this.registerTransition("disappear","appear",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("update","*",(()=>({allowTransition:!0,stopOriginalTransition:!1}))),this.registerTransition("update","disappear",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("update","exit",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("state","*",(()=>({allowTransition:!0,stopOriginalTransition:!1}))),this.registerTransition("state","disappear",(()=>({allowTransition:!0,stopOriginalTransition:!0}))),this.registerTransition("state","exit",(()=>({allowTransition:!0,stopOriginalTransition:!0})))}isTransitionAllowed(t,e,i){var r,o,s,a;let l=(r=this.transitions.get(t))===null||r===void 0?void 0:r.get(e);return l?l(i,t):(l=(o=this.transitions.get(t))===null||o===void 0?void 0:o.get("*"),l?l(i,t):(l=(s=this.transitions.get("*"))===null||s===void 0?void 0:s.get(e),l?l(i,t):(l=(a=this.transitions.get("*"))===null||a===void 0?void 0:a.get("*"),l?l(i,t):{allowTransition:!0,stopOriginalTransition:!0})))}registerTransition(t,e,i){let r=this.transitions.get(t);r||(r=new Map,this.transitions.set(t,r)),r.set(e,i)}}fl.getInstance();class yt{static registerBuiltInAnimate(t,e){yt.builtInAnimateMap[t]=e}constructor(t){this._animates=[],this._startCallbacks=[],this._endCallbacks=[],this._started=!1,this._activeCount=0,this._target=t}get started(){return this._started}onStart(t){t?(this._startCallbacks.push(t),this._started&&this._activeCount>0&&t()):this._startCallbacks.forEach((e=>{e()}))}onEnd(t){t?this._endCallbacks.push(t):this._endCallbacks.forEach((e=>{e()}))}_trackAnimation(t){this._animates.push(t),this._activeCount++,this._activeCount!==1||this._started||(this._started=!0,this.onStart()),t.onEnd((()=>{this._activeCount--;const e=this._animates.indexOf(t);e>=0&&this._animates.splice(e,1),this._activeCount===0&&this._started&&(this._started=!1,this.onEnd())}))}parseParams(t,e,i){var r,o;const s=this.resolveValue(t.totalTime,void 0,void 0),a=this.resolveValue(t.startTime,void 0,0),l=Object.assign({},t);l.oneByOneDelay=0,l.startTime=a,l.totalTime=s;const h=this.resolveValue(t.oneByOne,i,!1);if(e){const u=l.timeSlices;Fw(u)||(l.timeSlices=[u]);let d=0;l.timeSlices=l.timeSlices.map((f=>{const p=this.resolveValue(f.delay,i,0),m=this.resolveValue(f.delayAfter,i,0),v=this.resolveValue(f.duration,i,300);return d+=p+v+m,Object.assign(Object.assign({},f),{delay:p,delayAfter:m,duration:v})}));let c=0;h&&(c=typeof h=="number"?h:h?d:0),l.oneByOneDelay=c;let g=1;if(s){const f=d+c*(this._target.count-2);g=s?s/f:1}l.timeSlices=l.timeSlices.map((f=>{let p=f.effects;return Array.isArray(p)||(p=[p]),Object.assign(Object.assign({},f),{delay:f.delay*g,delayAfter:f.delayAfter*g,duration:f.duration*g,effects:p.map((m=>{var v,b;const y=(v=m.custom)!==null&&v!==void 0?v:yt.builtInAnimateMap[(b=m.type)!==null&&b!==void 0?b:"fromTo"],C=y&&hs(y)?/^class\s/.test(Function.prototype.toString.call(y))?1:2:0;return Object.assign(Object.assign({},m),{custom:y,customType:C})}))})})),l.oneByOneDelay=c*g,l.startTime=a*g}else{const u=this.resolveValue(t.delay,i,0),d=this.resolveValue(t.delayAfter,i,0),c=this.resolveValue(t.duration,i,300);let g=0;h&&(g=typeof h=="number"?h:h?u+d+c:0),l.oneByOneDelay=g,l.custom=(r=t.custom)!==null&&r!==void 0?r:yt.builtInAnimateMap[(o=t.type)!==null&&o!==void 0?o:"fromTo"];const f=l.custom&&hs(l.custom)?/^class\s/.test(Function.prototype.toString.call(l.custom))?1:2:0;if(l.customType=f,s){const p=u+d+c+g*(this._target.count-2),m=s?s/p:1;l.delay=u*m,l.delayAfter=d*m,l.duration=c*m,l.oneByOneDelay=g*m,l.startTime=a}}return l}execute(t){Array.isArray(t)?t.forEach((e=>this._execute(e))):this._execute(t)}_execute(t){if(t.selfOnly)return this._executeItem(t,this._target,0,1);const e="timeSlices"in t;let i;e&&t.partitioner&&(i=(i??this._target.getChildren()).filter((o=>{var s,a;return t.partitioner((a=(s=o.context)===null||s===void 0?void 0:s.data)===null||a===void 0?void 0:a[0],o,{})}))),e&&t.sort&&(i=i??this._target.getChildren(),i.sort(((o,s)=>{var a,l,h,u;return t.sort((l=(a=o.context)===null||a===void 0?void 0:a.data)===null||l===void 0?void 0:l[0],(u=(h=s.context)===null||h===void 0?void 0:h.data)===null||u===void 0?void 0:u[0],o,s,{})})));const r=e?(o,s,a)=>{const l=this.parseParams(t,e,o),h=this.executeTimelineItem(l,o,s,a);h&&this._trackAnimation(h)}:(o,s,a)=>{const l=this.parseParams(t,e,o),h=this.executeTypeConfigItem(l,o,s,a);h&&this._trackAnimation(h)};i?i.forEach(((o,s)=>r(o,s,i.length))):this._target.count<=1?r(this._target,0,1):this._target.forEachChildren(((o,s)=>r(o,s,this._target.count-1)))}executeTypeConfigItem(t,e,i,r){var o,s,a,l,h,u,d,c;const{type:g="fromTo",channel:f,customParameters:p,easing:m="linear",delay:v=0,delayAfter:b=0,duration:y=300,startTime:C=0,oneByOneDelay:w=0,loop:_,bounce:A,priority:x=0,options:S,custom:T,customType:M,controlOptions:R}=t,E=e.animate();E.priority=x;const P=hs(v)?v((s=(o=e.context)===null||o===void 0?void 0:o.data)===null||s===void 0?void 0:s[0],e,{}):v,B=(l=(a=e.context)===null||a===void 0?void 0:a.data)===null||l===void 0?void 0:l[0],k=(h=e.context)===null||h===void 0?void 0:h.indexKey;B&&k&&(i=(u=B[k])!==null&&u!==void 0?u:i),E.startAt(C);const L=i*w+P;L>0&&E.wait(L);let O=null,I=t.to,H=t.from;I||(O||(O=this.createPropsFromChannel(f,e)),I=O.props),H||(O||(O=this.createPropsFromChannel(f,e)),H=O.from),this._handleRunAnimate(E,T,M,H,I,y,m,p,R,S,g,e);let D=0;w&&(D=w*(r-i-1));const z=hs(b)?b((c=(d=e.context)===null||d===void 0?void 0:d.data)===null||c===void 0?void 0:c[0],e,{}):b;return z>0&&(D+=z),D>0&&E.wait(D),_&&_>0&&E.loop(_),A&&E.bounce(!0),E}_handleRunAnimate(t,e,i,r,o,s,a,l,h,u,d,c){var g,f,p,m,v,b;if(e&&i){const y=Object.assign({width:((g=c.stage)===null||g===void 0?void 0:g.width)||0,height:((f=c.stage)===null||f===void 0?void 0:f.height)||0,group:this._target.parent},this.resolveValue(l,c)),C=hs(u)?u.call(null,(m=y&&((p=y.data)===null||p===void 0?void 0:p[0]))!==null&&m!==void 0?m:(b=(v=c.context)===null||v===void 0?void 0:v.data)===null||b===void 0?void 0:b[0],c,y):u;y.options=C,y.controlOptions=h,i===1?this.createCustomAnimation(t,e,r,o,s,a,y):i===2&&this.createCustomInterpolatorAnimation(t,e,o,s,a,y)}else d==="to"?t.to(o,s,a):d==="from"&&t.from(o,s,a)}executeTimelineItem(t,e,i,r){var o,s,a,l;const{timeSlices:h,startTime:u=0,loop:d,bounce:c,oneByOneDelay:g,priority:f,controlOptions:p}=t,m=(s=(o=e.context)===null||o===void 0?void 0:o.data)===null||s===void 0?void 0:s[0],v=(a=e.context)===null||a===void 0?void 0:a.indexKey;m&&v&&(i=(l=m[v])!==null&&l!==void 0?l:i);const b=e.animate();return b.priority=f,b.startAt(u),b.wait(i*g),d&&d>0&&b.loop(d),c&&b.bounce(!0),(Array.isArray(h)?h:[h]).forEach((y=>{this.applyTimeSliceToAnimate(y,b,e,p)})),g&&b.wait(g*(r-i-1)),b}applyTimeSliceToAnimate(t,e,i,r){var o,s,a,l;const{effects:h,duration:u=300,delay:d=0,delayAfter:c=0}=t,g=hs(d)?d((s=(o=i.context)===null||o===void 0?void 0:o.data)===null||s===void 0?void 0:s[0],i,{}):d,f=hs(c)?c((l=(a=i.context)===null||a===void 0?void 0:a.data)===null||l===void 0?void 0:l[0],i,{}):c;g>0&&e.wait(g),(Array.isArray(h)?h:[h]).forEach((p=>{var m;const{type:v="fromTo",channel:b,customParameters:y,easing:C="linear",options:w}=p;let _=null,A=p.to,x=p.from;A||(_||(_=this.createPropsFromChannel(b,i)),A=_.props),x||(_||(_=this.createPropsFromChannel(b,i)),x=_.from);const S=(m=p.custom)!==null&&m!==void 0?m:yt.builtInAnimateMap[v],T=p.customType;this._handleRunAnimate(e,S,T,x,A,u,C,y,r,w,v,i)})),f>0&&e.wait(f)}createCustomInterpolatorAnimation(t,e,i,r,o,s){Object.keys(i).forEach((l=>{t.target.getComputedAttribute(l)})),t.interpolateUpdateFunction=(l,h,u,d,c)=>{e(u,l,h,d,c,t.target,s)},t.to(i,r,o)}createCustomAnimation(t,e,i,r,o,s,a){const l=new e(i,r,o,s,a);t.play(l)}createPropsFromChannel(t,e){const i={};let r=null;return t?(Array.isArray(t)?t.forEach((o=>{var s,a;const l=(a=(s=e.context)===null||s===void 0?void 0:s.diffAttrs)===null||a===void 0?void 0:a[o];l!==void 0&&(i[o]=l)})):Object.keys(t).forEach((o=>{var s,a,l,h;const u=t[o];u.to!==void 0&&(typeof u.to=="function"?i[o]=u.to((a=(s=e.context)===null||s===void 0?void 0:s.data)===null||a===void 0?void 0:a[0],e,{}):i[o]=u.to),u.from!==void 0&&(r||(r={}),typeof u.from=="function"?r[o]=u.from((h=(l=e.context)===null||l===void 0?void 0:l.data)===null||h===void 0?void 0:h[0],e,{}):r[o]=u.from)})),{from:r,props:i}):{from:r,props:i}}resolveValue(t,e,i){var r,o;return t===void 0?i:typeof t=="function"&&e?t((o=(r=e.context)===null||r===void 0?void 0:r.data)===null||o===void 0?void 0:o[0],e,{}):t}executeItem(t,e,i=0,r=1){return Array.isArray(t)?t.map((o=>this._executeItem(o,e,i,r))).filter(Boolean):[this._executeItem(t,e,i,r)].filter(Boolean)}_executeItem(t,e,i=0,r=1){if(!e)return null;const o="timeSlices"in t;let s=null;const a=this.parseParams(t,o);return s=o?this.executeTimelineItem(a,e,i,r):this.executeTypeConfigItem(a,e,i,r),s&&this._trackAnimation(s),s}stop(t){for(;this._animates.length>0;){const e=this._animates.pop();e?.stop(t)}this._animates=[],this._activeCount=0,this._started&&(this._started=!1,this.onEnd())}}yt.builtInAnimateMap={};const yo={APPEAR:"appear",DISAPPEAR:"disappear",UPDATE:"update",HIGHLIGHT:"highlight",UNHIGHLIGHT:"unhighlight"};class Dtt{constructor(t){this.graphic=t}registerState(t){this.states||(this.states=new Map),this.states.set(t.name,t)}clearStates(){var t;(t=this.states)===null||t===void 0||t.clear()}}class Ftt{constructor(t){this.stateList=null,this.graphic=t}applyState(t,e,i){const r=fl.getInstance(),o=[],s=[];if(this.stateList&&this.stateList.length?t.forEach(((a,l)=>{const h={allowTransition:!0};this.stateList.forEach((u=>{const d=r.isTransitionAllowed(u.state,a,this.graphic);h.allowTransition=h.allowTransition&&d.allowTransition})),h.allowTransition&&(s.push({state:a,animationConfig:Fw(e[l])?e[l].map((u=>u.animation)):e[l].animation,executor:new yt(this.graphic)}),this.stateList.forEach((u=>{r.isTransitionAllowed(u.state,a,this.graphic).stopOriginalTransition&&o.push(u)})))})):t.forEach(((a,l)=>{s.push({state:a,animationConfig:Fw(e[l])?e[l].map((h=>h.animation)):e[l].animation,executor:new yt(this.graphic)})})),o.forEach((a=>{a.executor.stop()})),s.length){s[0].executor.execute(s[0].animationConfig);for(let a=0;a<s.length;a++){const l=s[a+1],h=s[a];h.executor.onEnd((()=>{l&&l.executor.execute(l.animationConfig),this.stateList=this.stateList.filter((u=>u!==h)),a===s.length-1&&i&&i(!1)}))}}else i&&i(!0);this.stateList?this.stateList=this.stateList.filter((a=>!o.includes(a))):this.stateList=[],this.stateList.push(...s)}applyAppearState(t,e){this.applyState([yo.APPEAR],[{name:yo.APPEAR,animation:t}],e)}applyDisappearState(t,e){this.applyState([yo.DISAPPEAR],[{name:yo.DISAPPEAR,animation:t}],e)}applyUpdateState(t,e){this.applyState([yo.UPDATE],[{name:yo.UPDATE,animation:t}],e)}applyHighlightState(t,e){this.applyState([yo.HIGHLIGHT],[{name:yo.HIGHLIGHT,animation:t}],e)}applyUnhighlightState(t,e){this.applyState([yo.UNHIGHLIGHT],[{name:yo.UNHIGHLIGHT,animation:t}],e)}stopState(t,e){var i;const r=(i=this.stateList)===null||i===void 0?void 0:i.find((o=>o.state===t));r&&r.executor.stop(e)}clearState(){var t;(t=this.stateList)===null||t===void 0||t.forEach((e=>{e.executor.stop()})),this.stateList=null}reApplyState(t){var e;const i=(e=this.stateList)===null||e===void 0?void 0:e.find((r=>r.state===t));if(i&&i.executor.started){const r=this.stateList.slice();i.executor.stop(),this.stateList=r,i.executor.execute(i.animationConfig)}}}class Dx{_getAnimationStateManager(t){return t._animationStateManager||(t._animationStateManager=new Ftt(t)),t._animationStateManager}_getAnimationStateStore(t){return t._animationStateStore||(t._animationStateStore=new Dtt(t)),t._animationStateStore}registerAnimationState(t){return this._getAnimationStateStore(this).registerState(t),this}applyAnimationState(t,e,i){return this._getAnimationStateManager(this).applyState(t,e,i),this}applyAppearState(t,e){return this._getAnimationStateManager(this).applyAppearState(t,e),this}applyDisappearState(t,e){return this._getAnimationStateManager(this).applyDisappearState(t,e),this}applyUpdateState(t,e){return this._getAnimationStateManager(this).applyUpdateState(t,e),this}applyHighlightState(t,e){return this._getAnimationStateManager(this).applyHighlightState(t,e),this}applyUnhighlightState(t,e){return this._getAnimationStateManager(this).applyUnhighlightState(t,e),this}stopAnimationState(t,e,i=!1){return this._getAnimationStateManager(this).stopState(t,e),i&&this.isContainer&&this.forEachChildren((r=>{r.stopAnimationState(t,e,i)})),this}clearAnimationStates(){const t=this._animationStateManager;return t&&t.clearState(),this}reApplyAnimationState(t,e=!1){const i=this._animationStateManager;return i&&i.reApplyState(t),e&&this.isContainer&&this.forEachChildren((r=>{r.reApplyAnimationState(t,e)})),this}static extend(t){return new Dx()._getAnimationStateManager(t),t}}class ztt{getAttributes(t=!1){return t&&this.finalAttribute?this.finalAttribute:this.attribute}animate(t){var e,i,r;const o=new LH(t?.id,(i=(e=t?.timeline)!==null&&e!==void 0?e:this.stage&&this.stage.getTimeline())!==null&&i!==void 0?i:Hx,t?.slience);if(o.bind(this),t){const{onStart:s,onEnd:a,onRemove:l}=t;s!=null&&o.onStart(s),a!=null&&o.onEnd(a),l!=null&&o.onRemove(l)}return(r=this.stage)===null||r===void 0||r.ticker.start(),o}createTimeline(){return new Ix}createTicker(t){return new OH(t)}setFinalAttributes(t){this.finalAttribute||(this.finalAttribute={}),Object.assign(this.finalAttribute,t)}initFinalAttributes(t){this.finalAttribute=t}initAnimateExecutor(){this._animateExecutor||(this._animateExecutor=new yt(this))}executeAnimation(t){return this.initAnimateExecutor(),this._animateExecutor.execute(t),this}executeAnimations(t){return this.initAnimateExecutor(),t.forEach((e=>{this._animateExecutor.execute(e)})),this}getFinalAttribute(){return this.finalAttribute}getGraphicAttribute(t,e=!1){return!e&&this.finalAttribute?this.finalAttribute[t]:this.attribute[t]}pauseAnimation(t=!1){this.animates&&this.animates.forEach((e=>e.pause())),t&&this.isContainer&&this.forEachChildren((e=>{e.pauseAnimation(t)}))}resumeAnimation(t=!1){this.animates&&this.animates.forEach((e=>e.resume())),t&&this.isContainer&&this.forEachChildren((e=>{e.resumeAnimation(t)}))}stopAnimation(t=!1){this.animates&&this.animates.forEach((e=>e.stop())),t&&this.isContainer&&this.forEachChildren((e=>{e.stopAnimation(t)}))}}function Ntt(){eB(Ni,Dx),eB(Ni,ztt)}class Zt extends O0{constructor(t,e,i,r,o){super("customAnimate",e,i,r),this.type="customAnimate",this.customFrom=t,this.params=o,this.from=t,this.to=e}update(t,e,i){if(this.onStart(),!this.props||!this.propKeys)return;const r=this.easing(e);this.onUpdate(t,r,i),this.syncAttributeUpdate()}setProps(t){this.props=t,this.propKeys=Object.keys(t),this.animate.reSyncProps()}}class Fu extends Zt{completeBind(t){this.setStartTime(0),this._animator&&this._animator.start(),this.setDuration(t.getDuration())}stop(){this._animator&&this._animator.stop()}}class IH extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o),this.willCallBeforeStageRender=!0,this.willCallAfterStageRender=!0,this._beforeStageRender=()=>{if(!this.willCallBeforeStageRender)return;this.willCallBeforeStageRender=!1;const s=this.target.stage,a=s.window.getContext().canvas.nativeCanvas,l=this.beforeStageRender(s,a);l&&this.renderToStage(s,l)},this._afterStageRender=()=>{if(!this.willCallAfterStageRender)return;this.willCallAfterStageRender=!1;const s=this.target.stage,a=s.window.getContext().canvas.nativeCanvas,l=this.afterStageRender(s,a);l&&this.renderToStage(s,l)},this.props={}}beforeStageRender(t,e){return!1}afterStageRender(t,e){return!1}onFirstRun(){super.onFirstRun(),this.target.stage.setBeforeRender(this._beforeStageRender),this.target.stage.setAfterRender(this._afterStageRender),this.target.stage.disableDirtyBounds()}stop(){super.stop(),this.target.stage.removeBeforeRender(this._beforeStageRender),this.target.stage.removeAfterRender(this._afterStageRender)}onUpdate(t,e,i){super.onUpdate(t,e,i),this.willCallBeforeStageRender=!0,this.willCallAfterStageRender=!0}renderToStage(t,e){const i=t.window.getContext().canvas.nativeCanvas,r=i.getContext("2d");return!!r&&(r.clearRect(0,0,i.width,i.height),r.drawImage(e,0,0),i)}}class Wtt{constructor(t){this.tasks=[],this.started=!1,this.completed=0,this.totalDuration=0,this.onStartCallbacks=[],this.onEndCallbacks=[],this.onUpdateCallbacks=[],this.component=t}animate(t,e){return this.started?this:(this.tasks.push({graphic:t,config:e}),this)}onStart(t){return this.onStartCallbacks.push(t),this}onEnd(t){return this.onEndCallbacks.push(t),this}onUpdate(t){return this.onUpdateCallbacks.push(t),this}start(){return this.started?this:(this.started=!0,this.completed=0,this.onStartCallbacks.forEach((t=>t())),this.tasks.length===0?(setTimeout((()=>{this.onEndCallbacks.forEach((t=>t()))}),0),this):(this.tasks.forEach((t=>{const e=new yt(t.graphic);e.onEnd((()=>{this.completed++,this.completed===this.tasks.length&&this.onEndCallbacks.forEach((r=>r()))}));const i=e.executeItem(t.config,t.graphic);t.animate=i,i.forEach((r=>{this.totalDuration=Math.max(this.totalDuration,r.getStartTime()+r.getDuration())}))})),this))}deleteSelfAttr(t){this.tasks.forEach((e=>{e.animate&&e.animate.forEach((i=>i.preventAttr(t)))}))}stop(t){return this.tasks.forEach((e=>{e.animate&&e.animate.forEach((i=>i.stop(t)))})),this.started&&this.completed!==this.tasks.length&&(this.onEndCallbacks.forEach((e=>e())),this.completed=this.tasks.length),this}getDuration(){return this.totalDuration}}function zu(n){return new Wtt(n)}class jtt extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o),this.formatTemplate=null,this.decimalLength=o?.decimalLength,o?.formatTemplate&&o.formatTemplate.includes("{{var}}")&&(this.formatTemplate=o.formatTemplate)}onFirstRun(){var t,e,i;const r=this.getLastProps(),o=this.getEndProps(),s=(t=r.text)!==null&&t!==void 0?t:0,a=(e=o.text)!==null&&e!==void 0?e:0;this.valid=!0;let l=0,h=0,u="",d="",c=0;if(typeof s=="number"){l=s;const g=s.toString().split(".")[1]||"";c=Math.max(c,g.length)}else{if(typeof s!="string")return void(this.valid=!1);if(s.endsWith("%")){u="%";const g=s.substring(0,s.length-1).replace(/,/g,"");if(l=parseFloat(g)/100,isNaN(l))return void(this.valid=!1);const f=g.split(".")[1]||"";c=Math.max(c,f.length+2)}else{const g=s.replace(/,/g,"");if(l=parseFloat(g),isNaN(l))return void(this.valid=!1);s.includes(",")&&(u=",");const f=g.split(".")[1]||"";c=Math.max(c,f.length)}}if(typeof a=="number"){h=a;const g=a.toString().split(".")[1]||"";c=Math.max(c,g.length)}else{if(typeof a!="string")return void(this.valid=!1);if(a.endsWith("%")){d="%";const g=a.substring(0,a.length-1).replace(/,/g,"");if(h=parseFloat(g)/100,isNaN(h))return void(this.valid=!1);const f=g.split(".")[1]||"";c=Math.max(c,f.length+2)}else{const g=a.replace(/,/g,"");if(h=parseFloat(g),isNaN(h))return void(this.valid=!1);a.includes(",")&&(d=",");const f=g.split(".")[1]||"";c=Math.max(c,f.length)}}if(!((i=this.params)===null||i===void 0)&&i.format){switch(this.params.format){case"percent":this.format="%";break;case"thousandth":this.format=",";break;case"none":this.format="";break;default:this.format=d||u}this.format==="%"&&d!=="%"&&u!=="%"&&this.decimalLength===void 0&&(this.decimalLength=2),this.format==="%"||d!=="%"&&u!=="%"||(l*=100,h*=100)}else this.format=d||u;this.fromNumber=l,this.toNumber=h,this.decimalLength===void 0&&(this.decimalLength=c)}onEnd(t){super.onEnd(t),t||this.props&&this.target.setAttributes(this.props)}onUpdate(t,e,i){if(!this.valid)return;const r=this.fromNumber+(this.toNumber-this.fromNumber)*e;let o="";const s=this.format,a=(s==="%"?100*r:r).toFixed(this.decimalLength);let l,h=a;if(parseFloat(a)===Math.floor(parseFloat(a))&&(h=Math.floor(parseFloat(a))),s==="%")l=`${h}%`;else if(s===","){const u=h.toString().split(".");u[0]=u[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),l=u.join(".")}else l=h;o=this.formatTemplate?this.formatTemplate.replace("{{var}}",l.toString()):l,this.target.setAttribute("text",o)}}class Hc extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o),this.fromText="",this.toText="",this.showCursor=!1,this.cursorChar="|",this.blinkCursor=!0,this.beforeText="",this.afterText="",o?.showCursor!==void 0&&(this.showCursor=o.showCursor),o?.cursorChar!==void 0&&(this.cursorChar=o.cursorChar),o?.blinkCursor!==void 0&&(this.blinkCursor=o.blinkCursor),o?.beforeText!==void 0&&(this.beforeText=o.beforeText),o?.afterText!==void 0&&(this.afterText=o.afterText)}onFirstRun(){var t,e;const i=this.getLastProps(),r=this.getEndProps(),o=(t=i.text)!==null&&t!==void 0?t:"",s=(e=r.text)!==null&&e!==void 0?e:"";this.valid=!0,this.fromText=o.toString(),this.toText=s.toString(),this.toText||this.toText===""||(this.valid=!1)}onEnd(t){super.onEnd(t),t||(this.showCursor&&!this.blinkCursor?this.target.setAttribute("text",this.beforeText+this.toText+this.cursorChar+this.afterText):this.target.setAttribute("text",this.beforeText+this.toText+this.afterText))}onUpdate(t,e,i){if(!this.valid)return;const r=this.toText.length,o=this.fromText.length;let s,a;o>r?(s=Math.round(o-(o-r)*e),a=this.fromText.substring(0,s)):(s=Math.round(o+(r-o)*e),a=this.toText.startsWith(this.fromText)?this.toText.substring(0,s):s<=o?this.fromText.substring(0,s):this.toText.substring(0,s-o+Math.min(o,s)));let l=this.beforeText+a+this.afterText;this.showCursor&&(this.blinkCursor?Math.floor(e/.1)%2==0&&(l=this.beforeText+a+this.cursorChar+this.afterText):l=this.beforeText+a+this.cursorChar+this.afterText),this.target.setAttribute("text",l)}}class HH extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i;super.onBind();const r=this.target.getFinalAttribute(),o=(t=this.target.attribute)!==null&&t!==void 0?t:{},s={},a=(e=this.from)!==null&&e!==void 0?e:{};this.keys.forEach((h=>{var u,d,c;s[h]=(u=r?.[h])!==null&&u!==void 0?u:1,a[h]=(c=(d=a[h])!==null&&d!==void 0?d:o[h])!==null&&c!==void 0?c:0}));const l=this.target.getFinalAttribute();l&&this.target.setAttributes(l),this.props=s,this.propKeys=this.keys,this.from=a,this.to=s,((i=this.params.controlOptions)===null||i===void 0?void 0:i.immediatelyApply)!==!1&&this.target.setAttributes(a)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class DH extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){super.onBind();const t=this.target.attribute,e={},i={};this.keys.forEach((r=>{var o;e[r]=0,i[r]=(o=t[r])!==null&&o!==void 0?o:1})),this.props=e,this.propKeys=this.keys,this.from=i,this.to=e,Object.assign(this.target.attribute,i),this.target.addUpdatePositionTag(),this.target.addUpdateBoundTag()}onEnd(t){super.onEnd(t)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class Vtt extends HH{constructor(t,e,i,r,o){super(t,e,i,r,o),this.keys=["clipRange"],this.from={clipRange:0}}onFirstRun(){var t;super.onFirstRun();const{clipDimension:e}=((t=this.params)===null||t===void 0?void 0:t.options)||{};e&&(this.target.attribute.clipRangeByDimension=e)}}class Gtt extends DH{constructor(t,e,i,r,o){super(t,e,i,r,o),this.keys=["clipRange"]}}class $tt extends HH{constructor(t,e,i,r,o){super(t,e,i,r,o),this.keys=["opacity","fillOpacity","strokeOpacity"],this.from={opacity:0,fillOpacity:0,strokeOpacity:0}}}class Utt extends DH{constructor(t,e,i,r,o){super(t,e,i,r,o),this.keys=["opacity","fillOpacity","strokeOpacity"]}}const Xtt=(n,t,e)=>{const i=n.getFinalAttribute();return t&&t.orient==="anticlockwise"?{from:{startAngle:i?.endAngle},to:{startAngle:i?.startAngle}}:{from:{endAngle:i?.startAngle},to:{endAngle:i?.endAngle}}},Ytt=(n,t,e)=>{const i=n.getFinalAttribute();if(t&&t.orient==="anticlockwise"){const o=fn(t.overall)?t.overall:2*Math.PI;return{from:{startAngle:o,endAngle:o},to:{startAngle:i?.startAngle,endAngle:i?.endAngle}}}const r=fn(t?.overall)?t.overall:0;return{from:{startAngle:r,endAngle:r},to:{startAngle:i?.startAngle,endAngle:i?.endAngle}}},qtt=(n,t,e)=>{var i;return((i=t?.overall)!==null&&i!==void 0&&i)!==!1?Ytt(n,t):Xtt(n,t)},Ktt=(n,t,e)=>{const i=n.attribute;return t&&t.orient==="anticlockwise"?{from:{startAngle:i.startAngle},to:{startAngle:i?.endAngle}}:{from:{endAngle:i.endAngle},to:{endAngle:i?.startAngle}}},Ztt=(n,t,e)=>{const i=n.attribute;if(t&&t.orient==="anticlockwise"){const o=fn(t.overall)?t.overall:2*Math.PI;return{from:{startAngle:i.startAngle,endAngle:i.endAngle},to:{startAngle:o,endAngle:o}}}const r=fn(t?.overall)?t.overall:0;return{from:{startAngle:i.startAngle,endAngle:i.endAngle},to:{startAngle:r,endAngle:r}}};class FH extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}determineUpdateFunction(){this.propKeys?this.propKeys&&this.propKeys.length>1?this._updateFunction=this.updateAngle:this.propKeys[0]==="startAngle"?this._updateFunction=this.updateStartAngle:this.propKeys[0]==="endAngle"?this._updateFunction=this.updateEndAngle:this.valid=!1:this.valid=!1}deleteSelfAttr(t){delete this.props[t],this.fromProps&&delete this.fromProps[t];const e=this.propKeys.indexOf(t);e!==-1&&this.propKeys.splice(e,1),this.propKeys&&this.propKeys.length>1?this._updateFunction=this.updateAngle:this.propKeys[0]==="startAngle"?this._updateFunction=this.updateStartAngle:this.propKeys[0]==="endAngle"?this._updateFunction=this.updateEndAngle:this._updateFunction=null}updateStartAngle(t){this.target.attribute.startAngle=this.from.startAngle+(this.to.startAngle-this.from.startAngle)*t}updateEndAngle(t){this.target.attribute.endAngle=this.from.endAngle+(this.to.endAngle-this.from.endAngle)*t}updateAngle(t){this.updateStartAngle(t),this.updateEndAngle(t)}onUpdate(t,e,i){this._updateFunction&&(this._updateFunction(e),this.target.addUpdateShapeAndBoundsTag())}}class Jtt extends FH{onBind(){var t,e,i;super.onBind();const{from:r,to:o}=qtt(this.target,this.params.options,this.params),s=(e=(t=this.target.context)===null||t===void 0?void 0:t.lastAttrs)!==null&&e!==void 0?e:r;this.props=o,this.propKeys=Object.keys(o).filter((l=>o[l]!=null)),this.from=s,this.to=o;const a=this.target.getFinalAttribute();a&&this.target.setAttributes(a),((i=this.params.controlOptions)===null||i===void 0?void 0:i.immediatelyApply)!==!1&&this.target.setAttributes(s),this.determineUpdateFunction()}}class Qtt extends FH{onBind(){super.onBind();const{from:t,to:e}=(i=this.target,r=this.params.options,this.params,((o=r?.overall)!==null&&o!==void 0&&o)!==!1?Ztt(i,r):Ktt(i,r));var i,r,o;const s=t;this.props=e,this.propKeys=Object.keys(e).filter((a=>e[a]!=null)),this.from=s??this.target.attribute,this.to=e,this.determineUpdateFunction()}}const tet=(n,t,e)=>{const i=n.getFinalAttribute();switch(t?.direction){case"x":{const r=i.x,o=i.x1,s=i.width;return{from:xn(s)?{x:r+s/2,x1:void 0,width:0}:{x:(r+o)/2,x1:(r+o)/2,width:void 0},to:{x:r,x1:o,width:s}}}case"y":{const r=i.y,o=i.y1,s=i.height;return{from:xn(s)?{y:r+s/2,y1:void 0,height:0}:{y:(r+o)/2,y1:(r+o)/2,height:void 0},to:{y:r,y1:o,height:s}}}default:{const r=i.x,o=i.x1,s=i.width,a=i.y,l=i.y1,h=i.height,u={};return xn(s)?(u.x=r+s/2,u.width=0,u.x1=void 0):(u.x=(r+o)/2,u.x1=(r+o)/2,u.width=void 0),xn(h)?(u.y=a+h/2,u.height=0,u.y1=void 0):(u.y=(a+l)/2,u.y1=(a+l)/2,u.height=void 0),{from:u,to:{x:r,y:a,x1:o,y1:l,width:s,height:h}}}}},eet=(n,t,e)=>{const i=n.attribute;switch(t?.direction){case"x":{const r=i.x,o=i.x1,s=i.width;return{to:xn(s)?{x:r+s/2,x1:void 0,width:0}:{x:(r+o)/2,x1:(r+o)/2,width:void 0}}}case"y":{const r=i.y,o=i.y1,s=i.height;return{to:xn(s)?{y:r+s/2,y1:void 0,height:0}:{y:(r+o)/2,y1:(r+o)/2,height:void 0}}}default:{const r=i.x,o=i.y,s=i.x1,a=i.y1,l=i.width,h=i.height,u={};return xn(l)?(u.x=r+l/2,u.width=0,u.x1=void 0):(u.x=(r+s)/2,u.x1=(r+s)/2,u.width=void 0),xn(h)?(u.y=o+h/2,u.height=0,u.y1=void 0):(u.y=(o+a)/2,u.y1=(o+a)/2,u.height=void 0),{to:u}}}};class iet extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i;super.onBind();const{from:r,to:o}=tet(this.target,this.params.options,this.params),s=(e=(t=this.target.context)===null||t===void 0?void 0:t.lastAttrs)!==null&&e!==void 0?e:r;this.props=o,this.propKeys=Object.keys(o).filter((l=>o[l]!=null)),this.from=s,this.to=o;const a=this.target.getFinalAttribute();a&&this.target.setAttributes(a),((i=this.params.controlOptions)===null||i===void 0?void 0:i.immediatelyApply)!==!1&&this.target.setAttributes(s)}onEnd(t){super.onEnd(t)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class net extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){super.onBind();const{from:t,to:e}=eet(this.target,this.params.options,this.params);this.props=e,this.propKeys=Object.keys(e).filter((i=>e[i]!=null)),this.from=t??this.target.attribute,this.to=e}onEnd(t){super.onEnd(t)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}function ret(n,t,e){const i=n.getFinalAttribute(),r=i.y,o=i.y1,s=i.height;if(t&&t.orient==="negative"){const l=xn(s)?Math.max(r,r+s):Math.max(r,o);return{from:{y:l,y1:ii(o)?void 0:l,height:ii(s)?void 0:0},to:{y:r,y1:o,height:s}}}const a=xn(s)?Math.min(r,r+s):Math.min(r,o);return{from:{y:a,y1:ii(o)?void 0:a,height:ii(s)?void 0:0},to:{y:r,y1:o,height:s}}}function oet(n,t,e){var i,r,o;const s=n.getFinalAttribute(),a=s.y,l=s.y1,h=s.height;let u;return t&&t.orient==="negative"?fn(t.overall)?u=t.overall:e.group?(u=(o=(i=e.groupHeight)!==null&&i!==void 0?i:(r=t.layoutRect)===null||r===void 0?void 0:r.height)!==null&&o!==void 0?o:e.group.getBounds().height(),e.groupHeight=u):u=e.height:u=fn(t?.overall)?t.overall:0,{from:{y:u,y1:ii(l)?void 0:u,height:ii(h)?void 0:0},to:{y:a,y1:l,height:h}}}const set=(n,t,e)=>{var i;return((i=t?.overall)!==null&&i!==void 0&&i)!==!1?oet(n,t,e):ret(n,t)};class aet extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i;super.onBind();const{from:r,to:o}=set(this.target,this.params.options,this.params),s=(e=(t=this.target.context)===null||t===void 0?void 0:t.lastAttrs)!==null&&e!==void 0?e:r;this.props=o,this.propKeys=Object.keys(o).filter((l=>o[l]!=null)),this.from=s,this.to=o;const a=this.target.getFinalAttribute();a&&this.target.setAttributes(a),((i=this.params.controlOptions)===null||i===void 0?void 0:i.immediatelyApply)!==!1&&this.target.setAttributes(s)}onEnd(t){super.onEnd(t)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}function het(n,t,e){const i=n.getFinalAttribute(),r=i.y,o=i.y1,s=i.height;if(t&&t.orient==="negative"){const l=xn(s)?Math.max(r,r+s):Math.max(r,o);return{to:{y:l,y1:ii(o)?void 0:l,height:ii(s)?void 0:0}}}const a=xn(s)?Math.min(r,r+s):Math.min(r,o);return{to:{y:a,y1:ii(o)?void 0:a,height:ii(s)?void 0:0}}}function uet(n,t,e){var i,r,o;const s=n.getFinalAttribute(),a=s.y1,l=s.height;let h;return t&&t.orient==="negative"?fn(t.overall)?h=t.overall:e.group?(h=(o=(i=e.groupHeight)!==null&&i!==void 0?i:(r=t.layoutRect)===null||r===void 0?void 0:r.height)!==null&&o!==void 0?o:e.group.getBounds().height(),e.groupHeight=h):h=e.height:h=fn(t?.overall)?t.overall:0,{to:{y:h,y1:ii(a)?void 0:h,height:ii(l)?void 0:0}}}class det extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){super.onBind();const{from:t,to:e}=(i=this.target,r=this.params.options,o=this.params,((s=r?.overall)!==null&&s!==void 0&&s)!==!1?uet(i,r,o):het(i,r));var i,r,o,s;this.props=e,this.propKeys=Object.keys(e).filter((a=>e[a]!=null)),this.from=t??this.target.attribute,this.to=e}onEnd(t){super.onEnd(t)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}const zH=(n,t,e)=>{const i=n.getFinalAttribute().points,r={x:0,y:0};return i.forEach((o=>{r.x+=o.x,r.y+=o.y})),r.x/=i.length,r.y/=i.length,t&&t.center&&(ba(t.center.x)&&(r.x=t.center.x),ba(t.center.y)&&(r.y=t.center.y)),n.type==="area"&&(r.x1=r.x,r.y1=r.y),i.map((o=>Object.assign({},o,r)))},cet=(n,t,e)=>{const i=n.getFinalAttribute();return{from:{points:zH(n,t)},to:{points:i.points}}};class Nu extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onUpdate(t,e,i){var r,o;const s=(r=this.from)===null||r===void 0?void 0:r.points,a=(o=this.to)===null||o===void 0?void 0:o.points;s&&a&&(this.target.attribute.points=s.map(((l,h)=>L_(s[h],a[h],e))),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag())}}class get extends Nu{onBind(){var t;if(super.onBind(),["area","line","polygon"].includes(this.target.type)){const{from:e,to:i}=cet(this.target,this.params.options,this.params);this.props=i,this.propKeys=Object.keys(i).filter((o=>i[o]!=null)),this.from=e,this.to=i;const r=this.target.getFinalAttribute();r&&this.target.setAttributes(r),((t=this.params.controlOptions)===null||t===void 0?void 0:t.immediatelyApply)!==!1&&this.target.setAttributes(e)}else this.valid=!1}}class fet extends Nu{onBind(){if(super.onBind(),["area","line"].includes(this.target.type)){const i=this.target.getFinalAttribute(),{from:r,to:o}=(t=this.target,e=this.params.options,this.params,{from:{points:t.getFinalAttribute().points},to:{points:zH(t,e)}});this.props=o,this.propKeys=Object.keys(o).filter((s=>o[s]!=null)),this.from=r||i,this.to=o}else this.valid=!1;var t,e}}const NH=(n,t,e)=>n.getFinalAttribute().points.map((i=>{if(t&&t.orient==="negative"){let r=n.stage.viewWidth;return n.parent.parent.parent&&(r=n.parent.parent.parent.AABBBounds.width()),Object.assign(Object.assign({},i),{x:r,y:i.y,x1:r,y1:i.y1,defined:i.defined!==!1})}return Object.assign(Object.assign({},i),{x:0,y:i.y,x1:0,y1:i.y1,defined:i.defined!==!1})})),pet=(n,t,e)=>{const i=n.getFinalAttribute();return{from:{points:NH(n,t)},to:{points:i.points}}};class met extends Nu{onBind(){var t;if(super.onBind(),["area","line","polygon"].includes(this.target.type)){const{from:e,to:i}=pet(this.target,this.params.options,this.params);this.props=i,this.propKeys=Object.keys(i).filter((o=>i[o]!=null)),this.from=e,this.to=i;const r=this.target.getFinalAttribute();r&&this.target.setAttributes(r),((t=this.params.controlOptions)===null||t===void 0?void 0:t.immediatelyApply)!==!1&&this.target.setAttributes(e)}else this.valid=!1}}class vet extends Nu{onBind(){if(super.onBind(),["area","line"].includes(this.target.type)){const i=this.target.getFinalAttribute(),{from:r,to:o}=(t=this.target,e=this.params.options,this.params,{from:{points:t.getFinalAttribute().points},to:{points:NH(t,e)}});this.props=o,this.propKeys=Object.keys(o).filter((s=>o[s]!=null)),this.from=r||i,this.to=o}else this.valid=!1;var t,e}}const WH=(n,t,e)=>n.getFinalAttribute().points.map((i=>{if(t&&t.orient==="negative"){let r=n.stage.viewHeight;return n.parent.parent.parent&&(r=n.parent.parent.parent.AABBBounds.height()),Object.assign(Object.assign({},i),{x:i.x,y:r,x1:i.x1,y1:r,defined:i.defined!==!1})}return Object.assign(Object.assign({},i),{x:i.x,y:0,x1:i.x1,y1:0,defined:i.defined!==!1})})),bet=(n,t,e)=>{const i=n.getFinalAttribute();return{from:{points:WH(n,t)},to:{points:i.points}}};class yet extends Nu{onBind(){var t;if(super.onBind(),["area","line","polygon"].includes(this.target.type)){const{from:e,to:i}=bet(this.target,this.params.options,this.params);this.props=i,this.propKeys=Object.keys(i).filter((o=>i[o]!=null)),this.from=e,this.to=i;const r=this.target.getFinalAttribute();r&&this.target.setAttributes(r),((t=this.params.controlOptions)===null||t===void 0?void 0:t.immediatelyApply)!==!1&&this.target.setAttributes(e)}else this.valid=!1}}class Cet extends Nu{onBind(){if(super.onBind(),["area","line","polygon"].includes(this.target.type)){const{from:i,to:r}=(t=this.target,e=this.params.options,this.params,{from:{points:t.getFinalAttribute().points},to:{points:WH(t,e)}});this.props=r,this.propKeys=Object.keys(r).filter((o=>r[o]!=null)),this.from=i??this.target.attribute,this.to=r}else this.valid=!1;var t,e}}const _et=(n,t,e)=>{const i=n.getFinalAttribute();return t&&t.orient==="inside"?{from:{innerRadius:i?.outerRadius},to:{innerRadius:i?.innerRadius}}:{from:{outerRadius:i?.innerRadius},to:{outerRadius:i?.outerRadius}}},wet=(n,t,e)=>{const i=n.getFinalAttribute(),r=fn(t?.overall)?t.overall:0;return{from:{innerRadius:r,outerRadius:r},to:{innerRadius:i?.innerRadius,outerRadius:i?.outerRadius}}},xet=(n,t,e)=>{var i;return((i=t?.overall)!==null&&i!==void 0&&i)!==!1?wet(n,t):_et(n,t)},Aet=(n,t,e)=>{const i=n.getFinalAttribute();return t&&t.orient==="inside"?{from:{innerRadius:i?.innerRadius},to:{innerRadius:i?.outerRadius}}:{from:{outerRadius:i?.outerRadius},to:{outerRadius:i?.innerRadius}}},Met=(n,t,e)=>{const i=n.getFinalAttribute(),r=fn(t?.overall)?t.overall:0;return{from:{innerRadius:i?.innerRadius,outerRadius:i?.outerRadius},to:{innerRadius:r,outerRadius:r}}};class jH extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class Tet extends jH{onBind(){var t,e,i;super.onBind();const{from:r,to:o}=xet(this.target,this.params.options,this.params),s=(e=(t=this.target.context)===null||t===void 0?void 0:t.lastAttrs)!==null&&e!==void 0?e:r;this.props=o,this.propKeys=Object.keys(o).filter((l=>o[l]!=null)),this.from=s,this.to=o;const a=this.target.getFinalAttribute();a&&this.target.setAttributes(a),((i=this.params.controlOptions)===null||i===void 0?void 0:i.immediatelyApply)!==!1&&this.target.setAttributes(s)}}class Ret extends jH{onBind(){super.onBind();const{to:t}=(e=this.target,i=this.params.options,this.params,((r=i?.overall)!==null&&r!==void 0&&r)!==!1?Met(e,i):Aet(e,i));var e,i,r;this.props=t,this.propKeys=Object.keys(t).filter((o=>t[o]!=null)),this.from=this.target.attribute,this.to=t}}function Bet(n,t,e){const i=n.getFinalAttribute(),r=i.x,o=i.x1,s=i.width;if(t&&t.orient==="negative"){const l=xn(s)?Math.max(r,r+s):Math.max(r,o);return{from:{x:l,x1:ii(o)?void 0:l,width:ii(s)?void 0:0},to:{x:r,x1:o,width:s}}}const a=xn(s)?Math.min(r,r+s):Math.min(r,o);return{from:{x:a,x1:ii(o)?void 0:a,width:ii(s)?void 0:0},to:{x:r,x1:o,width:s}}}function ket(n,t,e){var i;const r=n.getFinalAttribute(),o=r.x,s=r.x1,a=r.width;let l;return t&&t.orient==="negative"?fn(t.overall)?l=t.overall:e.group?(l=(i=e.groupWidth)!==null&&i!==void 0?i:e.group.getBounds().width(),e.groupWidth=l):l=e.width:l=fn(t?.overall)?t?.overall:0,{from:{x:l,x1:ii(s)?void 0:l,width:ii(a)?void 0:0},to:{x:o,x1:s,width:a}}}const Pet=(n,t,e)=>{var i;return((i=t?.overall)!==null&&i!==void 0&&i)!==!1?ket(n,t,e):Bet(n,t)};function Eet(n,t,e){const i=n.getFinalAttribute(),r=i.x,o=i.x1,s=i.width;if(t&&t.orient==="negative"){const l=xn(s)?Math.max(r,r+s):Math.max(r,o);return{to:{x:l,x1:ii(o)?void 0:l,width:ii(s)?void 0:0}}}const a=xn(s)?Math.min(r,r+s):Math.min(r,o);return{to:{x:a,x1:ii(o)?void 0:a,width:ii(s)?void 0:0}}}function Let(n,t,e){var i;const r=n.getFinalAttribute(),o=r.x1,s=r.width;let a;return t&&t.orient==="negative"?fn(t.overall)?a=t.overall:e.group?(a=(i=e.groupWidth)!==null&&i!==void 0?i:e.group.getBounds().width(),e.groupWidth=a):a=e.width:a=fn(t?.overall)?t.overall:0,{to:{x:a,x1:ii(o)?void 0:a,width:ii(s)?void 0:0}}}class Oet extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i;super.onBind();const{from:r,to:o}=Pet(this.target,this.params.options,this.params),s=(e=(t=this.target.context)===null||t===void 0?void 0:t.lastAttrs)!==null&&e!==void 0?e:r;this.props=o,this.propKeys=Object.keys(o).filter((l=>o[l]!=null)),this.from=s,this.to=o;const a=this.target.getFinalAttribute();a&&this.target.setAttributes(a),((i=this.params.controlOptions)===null||i===void 0?void 0:i.immediatelyApply)!==!1&&this.target.setAttributes(s)}onEnd(t){super.onEnd(t)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class Iet extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){super.onBind();const{from:t,to:e}=(i=this.target,r=this.params.options,o=this.params,((s=r?.overall)!==null&&s!==void 0&&s)!==!1?Let(i,r,o):Eet(i,r));var i,r,o,s;this.props=e,this.propKeys=Object.keys(e).filter((a=>e[a]!=null)),this.from=t??this.target.attribute,this.to=e}onEnd(t){super.onEnd(t)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class Het extends Fu{onBind(){super.onBind();const t=zu(this.target);this._animator=t;const e=this.duration,i=this.easing,r=this.target,{symbolStartOuterType:o="scale",titleType:s="typewriter",titlePanelType:a="scale"}=this.params,l=e/10;let h,u;if(r._symbolStart.setAttributes({scaleX:0,scaleY:0}),t.animate(r._symbolStart,{type:"to",to:{scaleX:1,scaleY:1},duration:5*l,easing:i}),o==="scale"?(h={scaleX:0,scaleY:0},u={scaleX:1,scaleY:1}):(h={clipRange:0},u={clipRange:1}),r._symbolStartOuter.setAttributes(h),t.animate(r._symbolStartOuter,{type:"to",to:u,duration:5*l,easing:i}),r._symbolEnd.setAttributes({scaleX:0,scaleY:0}),t.animate(r._symbolEnd,{type:"to",to:{scaleX:1,scaleY:1},duration:2*l,delay:8*l,easing:i}),r._line.setAttributes({clipRange:0}),t.animate(r._line,{type:"to",to:{clipRange:1},duration:9*l,easing:i}),s==="typewriter"){const d=r._titleTop.attribute.text;r._titleTop.setAttributes({text:""}),t.animate(r._titleTop,{type:"custom",delay:5*l,duration:4*l,easing:"linear",to:{text:d},custom:Hc});const c=r._titleBottom.attribute.text;r._titleBottom.setAttributes({text:""}),t.animate(r._titleBottom,{type:"custom",delay:5*l,duration:4*l,easing:"linear",to:{text:c},custom:Hc})}else r._titleTop.setAttributes({dy:r._titleTop.AABBBounds.height()+10}),t.animate(r._titleTop,{type:"to",to:{dy:0},delay:5*l,duration:4*l,easing:"linear"}),r._titleBottom.setAttributes({dy:-(10+r._titleBottom.AABBBounds.height())}),t.animate(r._titleBottom,{type:"to",to:{dy:0},delay:5*l,duration:4*l,easing:"linear"});a==="scale"?[r._titleTopPanel,r._titleBottomPanel].forEach((d=>{var c;const g=(c=d.attribute.scaleX)!==null&&c!==void 0?c:1;d.setAttributes({scaleX:0}),t.animate(d,{type:"to",to:{scaleX:g},duration:e,easing:i})})):a==="stroke"&&[r._titleTopPanel,r._titleBottomPanel].forEach((d=>{const c=d.AABBBounds,g=2*(c.width()+c.height());d.setAttributes({lineDash:[0,10*g]}),t.animate(d,{type:"to",to:{lineDash:[g,10*g]},duration:e,easing:i})})),this.completeBind(t)}}class Det extends Fu{onBind(){super.onBind();const t=zu(this.target);this._animator=t;const e=this.duration,i=this.easing,r=this.target,{mode:o}=this.params;o==="scale"?t.animate(r._symbolStart,{type:"to",to:{scaleX:0,scaleY:0},duration:e,easing:i}):(t.animate(r._line,{type:"to",to:{clipRange:0},duration:e,easing:i}),t.animate(r._symbolStart,{type:"to",to:{scaleX:0,scaleY:0},duration:e/2,delay:e/2,easing:i}),t.animate(r._symbolEnd,{type:"to",to:{scaleX:0,scaleY:0},duration:e,easing:i}),t.animate(r._titleTop,{type:"to",to:{dy:r._titleTop.AABBBounds.height()+10},duration:e/2,easing:i}),t.animate(r._titleBottom,{type:"to",to:{dy:-(10+r._titleBottom.AABBBounds.height())},duration:e/2,easing:i}),t.animate(r._symbolStartOuter,{type:"to",to:{clipRange:0},duration:e/2,delay:e/2,easing:i}),t.animate(r._titleTopPanel,{type:"to",to:{scaleX:0},duration:e,easing:i}),t.animate(r._titleBottomPanel,{type:"to",to:{scaleX:0},duration:e,easing:i})),this.completeBind(t)}}class Fet extends Fu{onBind(){super.onBind();const t=zu(this.target);this._animator=t;const e=this.duration,i=this.easing,r=this.target,{wave:o}=this.params;if(r.setAttributes({scaleX:0,scaleY:0}),t.animate(r,{type:"to",to:{scaleX:1,scaleY:1},duration:e/3*2,easing:i}),r.titleShape&&t.animate(r.titleShape,{type:"custom",to:{text:r.titleShape.attribute.text},duration:e,easing:i,custom:Hc}),r.contentShape&&t.animate(r.contentShape,{type:"custom",to:{text:r.contentShape.attribute.text},duration:e,easing:i,custom:Hc}),o){const s=e/6;t.animate(r.group,{timeSlices:[{duration:s,effects:{type:"to",to:{angle:o},easing:i}},{duration:2*s,effects:{type:"to",to:{angle:-o},easing:i}},{duration:2*s,effects:{type:"to",to:{angle:o},easing:i}},{duration:s,effects:{type:"to",to:{angle:0},easing:i}}]})}this.completeBind(t)}}class zet extends Fu{onBind(){super.onBind();const t=zu(this.target);this._animator=t;const e=this.duration,i=this.easing,r=this.target;t.animate(r,{type:"to",to:{scaleX:0,scaleY:0},duration:e,easing:i}),this.completeBind(t)}}class Net extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o),this.fromTextConfig=[],this.toTextConfig=[],this.originalTextConfig=[],this.showCursor=!1,this.cursorChar="|",this.blinkCursor=!0,this.fadeInChars=!1,this.fadeInDuration=.3,this.strokeFirst=!1,this.strokeToFillRatio=.3,o?.showCursor!==void 0&&(this.showCursor=o.showCursor),o?.cursorChar!==void 0&&(this.cursorChar=o.cursorChar),o?.blinkCursor!==void 0&&(this.blinkCursor=o.blinkCursor),o?.fadeInChars!==void 0&&(this.fadeInChars=o.fadeInChars),o?.fadeInDuration!==void 0&&(this.fadeInDuration=o.fadeInDuration),o?.strokeFirst!==void 0&&(this.strokeFirst=o.strokeFirst),o?.strokeToFillRatio!==void 0&&(this.strokeToFillRatio=o.strokeToFillRatio)}onFirstRun(){const t=this.getLastProps(),e=this.getEndProps();this.originalTextConfig=e.textConfig?[...e.textConfig]:[],this.valid=!0,this.originalTextConfig&&this.originalTextConfig.length!==0?(this.fromTextConfig=t.textConfig&&t.textConfig.length>0?ti.TransformTextConfig2SingleCharacter(t.textConfig):[],this.toTextConfig=ti.TransformTextConfig2SingleCharacter(this.originalTextConfig)):this.valid=!1}onEnd(t){super.onEnd(t),t||this.target.setAttribute("textConfig",this.originalTextConfig)}onUpdate(t,e,i){if(!this.valid)return;const r=this.toTextConfig.length,o=this.fromTextConfig.length,s=this.fadeInChars?1-this.fadeInDuration:1;let a,l;if(o>r)a=Math.round(o-(o-r)*e);else if(this.fadeInChars){const h=Math.min(1,e/s);a=Math.round(o+(r-o)*h)}else a=Math.round(o+(r-o)*e);if(l=o>r?this.fromTextConfig.slice(0,a):this.toTextConfig.slice(0,a).map(((h,u)=>{if("text"in h){const d=Object.assign({},h);if(this.strokeFirst){const c=u/r*s,g=Math.max(0,e-c),f=1-c,p=Math.min(1,g/(this.strokeToFillRatio*f));if("fill"in d&&d.fill&&(d.stroke=d.fill,p<1&&(d.fillOpacity=p)),this.fadeInChars){const m=Math.min(1,g/(this.fadeInDuration*f));d.opacity=Math.max(0,Math.min(1,m))}}else if(this.fadeInChars){const c=(e-u/r*s)/this.fadeInDuration;d.opacity=Math.max(0,Math.min(1,c))}return d}return h})),this.showCursor&&a<r){let h=!0;if(this.blinkCursor&&(h=Math.floor(e/.1)%2==0),h&&l.length>0){const u=l.length-1,d=l[u];if("text"in d)l[u]=Object.assign(Object.assign({},d),{text:String(d.text)+this.cursorChar});else{const c={text:this.cursorChar,fontSize:16};l.push(c)}}}this.target.setAttribute("textConfig",l)}}class Wet extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o),this.fromTextConfig=[],this.toTextConfig=[],this.originalTextConfig=[],this.showCursor=!1,this.cursorChar="|",this.blinkCursor=!0,this.beforeText="",this.afterText="",this.fadeOutChars=!1,this.fadeOutDuration=.3,this.direction="backward",o?.showCursor!==void 0&&(this.showCursor=o.showCursor),o?.cursorChar!==void 0&&(this.cursorChar=o.cursorChar),o?.blinkCursor!==void 0&&(this.blinkCursor=o.blinkCursor),o?.beforeText!==void 0&&(this.beforeText=o.beforeText),o?.afterText!==void 0&&(this.afterText=o.afterText),o?.fadeOutChars!==void 0&&(this.fadeOutChars=o.fadeOutChars),o?.fadeOutDuration!==void 0&&(this.fadeOutDuration=o.fadeOutDuration),o?.direction!==void 0&&(this.direction=o.direction),this.propKeys=["textConfig"]}onFirstRun(){const t=this.getLastProps(),e=this.getEndProps();this.originalTextConfig=t.textConfig?[...t.textConfig]:[],this.valid=!0,this.originalTextConfig&&this.originalTextConfig.length!==0?(this.fromTextConfig=ti.TransformTextConfig2SingleCharacter(this.originalTextConfig),this.toTextConfig=e.textConfig&&e.textConfig.length>0?ti.TransformTextConfig2SingleCharacter(e.textConfig):[]):this.valid=!1}onEnd(t){super.onEnd(t),t||(this.toTextConfig.length>0?this.target.setAttribute("textConfig",this.toTextConfig):this.target.setAttribute("textConfig",[]))}onUpdate(t,e,i){if(!this.valid)return;const r=this.fromTextConfig.length,o=this.fadeOutChars?1-this.fadeOutDuration:1;let s;if(this.direction==="forward"){if(this.fadeOutChars){const l=Math.min(1,e/o);s=Math.round(r*(1-l))}else s=Math.round(r*(1-e));let a=this.direction==="forward"?this.fromTextConfig.slice(r-s):this.fromTextConfig.slice(0,s);this.fadeOutChars&&(a=this.applyFadeEffect(a,e,r,s)),this.showCursor&&s>0&&(a=this.addCursor(a,e)),this.target.setAttribute("textConfig",a)}else{if(this.fadeOutChars){const l=Math.min(1,e/o);s=Math.round(r*(1-l))}else s=Math.round(r*(1-e));let a=this.fromTextConfig.slice(0,s);this.fadeOutChars&&(a=this.applyFadeEffect(a,e,r,s)),this.showCursor&&s>0&&(a=this.addCursor(a,e)),this.target.setAttribute("textConfig",a)}}applyFadeEffect(t,e,i,r){this.direction==="forward"&&i-r;const o=(e-(1-this.fadeOutDuration))/this.fadeOutDuration,s=Math.max(0,1-Math.min(1,o));return t.map(((a,l)=>{if(this.direction==="forward"){if(l===0&&"text"in a)return Object.assign(Object.assign({},a),{opacity:s})}else if(l===t.length-1&&"text"in a)return Object.assign(Object.assign({},a),{opacity:s});return a}))}addCursor(t,e){let i=!0;if(this.blinkCursor&&(i=Math.floor(e/.1)%2==0),i&&t.length>0){const r=this.direction==="forward"?0:t.length-1,o=t[r];if("text"in o){const s=[...t];return this.direction==="forward"?s[r]=Object.assign(Object.assign({},o),{text:this.cursorChar+String(o.text)}):s[r]=Object.assign(Object.assign({},o),{text:String(o.text)+this.cursorChar}),s}}return t}}class jet extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o),this.fromTextConfig=[],this.toTextConfig=[],this.originalTextConfig=[],this.singleCharConfig=[],this.fadeInDuration=.3,this.slideDirection="right",this.slideDistance=30,this.wordByWord=!1,this.wordRegex=/[a-zA-Z]+(-[a-zA-Z]+)*|[\u4e00-\u9fa5]+|[0-9]+|[^\s\w\u4e00-\u9fa5]/g,this.wordGroups=[],o?.fadeInDuration!==void 0&&(this.fadeInDuration=o.fadeInDuration),o?.slideDirection!==void 0&&(this.slideDirection=o.slideDirection),o?.slideDistance!==void 0&&(this.slideDistance=o.slideDistance),o?.wordByWord!==void 0&&(this.wordByWord=o.wordByWord),o?.wordRegex!==void 0&&(this.wordRegex=o.wordRegex)}onFirstRun(){const t=this.getLastProps(),e=this.getEndProps();this.originalTextConfig=e.textConfig?[...e.textConfig]:[],this.valid=!0,this.originalTextConfig&&this.originalTextConfig.length!==0?(this.fromTextConfig=t.textConfig&&t.textConfig.length>0?ti.TransformTextConfig2SingleCharacter(t.textConfig):[],this.toTextConfig=ti.TransformTextConfig2SingleCharacter(this.originalTextConfig),this.singleCharConfig=this.toTextConfig.map((i=>"text"in i?Object.assign(Object.assign({},i),{opacity:0,dx:this.getInitialDx(),dy:this.getInitialDy()}):Object.assign(Object.assign({},i),{opacity:0}))),this.wordByWord&&this.calculateWordGroups()):this.valid=!1}calculateWordGroups(){this.wordGroups=[];let t="";const e={};let i,r=0;for(this.toTextConfig.forEach(((s,a)=>{if("text"in s){const l=String(s.text);t+=l,e[r]=a,r++}})),this.wordRegex.lastIndex=0;(i=this.wordRegex.exec(t))!==null;){const s=i.index,a=i.index+i[0].length,l=[];for(let h=s;h<a;h++)e[h]!==void 0&&l.push(e[h]);l.length>0&&this.wordGroups.push(l)}const o=new Set;this.wordGroups.forEach((s=>{s.forEach((a=>o.add(a)))}));for(let s=0;s<this.toTextConfig.length;s++)"text"in this.toTextConfig[s]&&!o.has(s)&&this.wordGroups.push([s])}getInitialDx(){switch(this.slideDirection){case"left":return-this.slideDistance;case"right":return this.slideDistance;default:return 0}}getInitialDy(){switch(this.slideDirection){case"up":return-this.slideDistance;case"down":return this.slideDistance;default:return 0}}onEnd(t){super.onEnd(t),t||this.target.setAttribute("textConfig",this.originalTextConfig)}onUpdate(t,e,i){if(!this.valid)return;const r=1-this.fadeInDuration;let o;o=this.wordByWord&&this.wordGroups.length>0?this.updateByWord(e,r):this.updateByCharacter(e,r),this.target.setAttribute("textConfig",o)}updateByWord(t,e){const i=this.wordGroups.length,r=[...this.singleCharConfig];for(let o=0;o<this.wordGroups.length;o++){let s;if(s=this.slideDirection==="left"?(i-1-o)/i*e:o/i*e,t<s){for(const d of this.wordGroups[o]){const c=r[d];"text"in c&&(r[d]=Object.assign(Object.assign({},c),{opacity:0,dx:this.getInitialDx(),dy:this.getInitialDy()}))}continue}const a=(t-s)/this.fadeInDuration,l=Math.max(0,Math.min(1,a)),h=this.getInitialDx()*(1-l),u=this.getInitialDy()*(1-l);for(const d of this.wordGroups[o]){const c=r[d];"text"in c&&(r[d]=Object.assign(Object.assign({},c),{opacity:l,dx:h,dy:u}))}}return r}updateByCharacter(t,e){const i=this.toTextConfig.length,r=[...this.singleCharConfig];for(let o=0;o<r.length;o++){const s=r[o];if("text"in s){let a;if(a=this.slideDirection==="left"?(i-1-o)/i*e:o/i*e,t<a){r[o]=Object.assign(Object.assign({},s),{opacity:0,dx:this.getInitialDx(),dy:this.getInitialDy()});continue}const l=(t-a)/this.fadeInDuration,h=Math.max(0,Math.min(1,l)),u=this.getInitialDx()*(1-h),d=this.getInitialDy()*(1-h);r[o]=Object.assign(Object.assign({},s),{opacity:h,dx:u,dy:d})}}return r}}class Vet extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o),this.fromTextConfig=[],this.toTextConfig=[],this.originalTextConfig=[],this.singleCharConfig=[],this.fadeOutDuration=.3,this.slideDirection="right",this.slideDistance=30,this.wordByWord=!1,this.wordRegex=/[a-zA-Z]+(-[a-zA-Z]+)*|[\u4e00-\u9fa5]+|[0-9]+|[^\s\w\u4e00-\u9fa5]/g,this.wordGroups=[],this.reverseOrder=!1,o?.fadeOutDuration!==void 0&&(this.fadeOutDuration=o.fadeOutDuration),o?.slideDirection!==void 0&&(this.slideDirection=o.slideDirection),o?.slideDistance!==void 0&&(this.slideDistance=o.slideDistance),o?.wordByWord!==void 0&&(this.wordByWord=o.wordByWord),o?.wordRegex!==void 0&&(this.wordRegex=o.wordRegex),o?.reverseOrder!==void 0&&(this.reverseOrder=o.reverseOrder),this.propKeys=["textConfig"]}onFirstRun(){const t=this.getLastProps(),e=this.getEndProps();this.originalTextConfig=t.textConfig?[...t.textConfig]:[],this.valid=!0,this.originalTextConfig&&this.originalTextConfig.length!==0?(this.fromTextConfig=ti.TransformTextConfig2SingleCharacter(this.originalTextConfig),this.toTextConfig=e.textConfig&&e.textConfig.length>0?ti.TransformTextConfig2SingleCharacter(e.textConfig):[],this.singleCharConfig=this.fromTextConfig.map((i=>"text"in i?Object.assign(Object.assign({},i),{opacity:1,dx:0,dy:0}):Object.assign(Object.assign({},i),{opacity:1}))),this.wordByWord&&this.calculateWordGroups()):this.valid=!1}calculateWordGroups(){this.wordGroups=[];let t="";const e={};let i,r=0;for(this.fromTextConfig.forEach(((s,a)=>{if("text"in s){const l=String(s.text);t+=l,e[r]=a,r++}})),this.wordRegex.lastIndex=0;(i=this.wordRegex.exec(t))!==null;){const s=i.index,a=i.index+i[0].length,l=[];for(let h=s;h<a;h++)e[h]!==void 0&&l.push(e[h]);l.length>0&&this.wordGroups.push(l)}const o=new Set;this.wordGroups.forEach((s=>{s.forEach((a=>o.add(a)))}));for(let s=0;s<this.fromTextConfig.length;s++)"text"in this.fromTextConfig[s]&&!o.has(s)&&this.wordGroups.push([s])}getTargetDx(){switch(this.slideDirection){case"left":return-this.slideDistance;case"right":return this.slideDistance;default:return 0}}getTargetDy(){switch(this.slideDirection){case"up":return-this.slideDistance;case"down":return this.slideDistance;default:return 0}}onEnd(t){super.onEnd(t),t||(this.toTextConfig.length>0?this.target.setAttribute("textConfig",this.toTextConfig):this.target.setAttribute("textConfig",[]))}onUpdate(t,e,i){if(!this.valid)return;const r=1-this.fadeOutDuration;let o;o=this.wordByWord&&this.wordGroups.length>0?this.updateByWord(e,r):this.updateByCharacter(e,r),this.target.setAttribute("textConfig",o)}updateByWord(t,e){const i=this.wordGroups.length,r=[...this.singleCharConfig];for(let o=0;o<this.wordGroups.length;o++){let s;if(s=this.reverseOrder?this.slideDirection==="left"?o/i*e:(i-1-o)/i*e:this.slideDirection==="left"?(i-1-o)/i*e:o/i*e,t<s){for(const c of this.wordGroups[o]){const g=r[c];"text"in g&&(r[c]=Object.assign(Object.assign({},g),{opacity:1,dx:0,dy:0}))}continue}const a=(t-s)/this.fadeOutDuration,l=Math.max(0,Math.min(1,a)),h=this.getTargetDx()*l,u=this.getTargetDy()*l,d=1-l;for(const c of this.wordGroups[o]){const g=r[c];"text"in g&&(r[c]=Object.assign(Object.assign({},g),{opacity:d,dx:h,dy:u}))}}return r}updateByCharacter(t,e){const i=this.fromTextConfig.length,r=[...this.singleCharConfig];for(let o=0;o<r.length;o++){const s=r[o];if("text"in s){let a;if(a=this.reverseOrder?this.slideDirection==="left"?o/i*e:(i-1-o)/i*e:this.slideDirection==="left"?(i-1-o)/i*e:o/i*e,t<a){r[o]=Object.assign(Object.assign({},s),{opacity:1,dx:0,dy:0});continue}const l=(t-a)/this.fadeOutDuration,h=Math.max(0,Math.min(1,l)),u=this.getTargetDx()*h,d=this.getTargetDy()*h,c=1-h;r[o]=Object.assign(Object.assign({},s),{opacity:c,dx:u,dy:d})}}return r}}class Get extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i,r,o,s,a,l,h,u,d;let c,g;super.onBind();const f=this.target.getFinalAttribute(),p=(t=this.target.attribute)!==null&&t!==void 0?t:{};switch((e=this.params)===null||e===void 0?void 0:e.direction){case"x":c={scaleX:(i=p.scaleX)!==null&&i!==void 0?i:0},g={scaleX:(r=f?.scaleX)!==null&&r!==void 0?r:1},this._updateFunction=this.updateX;break;case"y":c={scaleY:(o=p.scaleY)!==null&&o!==void 0?o:0},g={scaleY:(s=f?.scaleY)!==null&&s!==void 0?s:1},this._updateFunction=this.updateY;break;default:c={scaleX:(a=p.scaleX)!==null&&a!==void 0?a:0,scaleY:(l=p.scaleY)!==null&&l!==void 0?l:0},g={scaleX:(h=f?.scaleX)!==null&&h!==void 0?h:1,scaleY:(u=f?.scaleY)!==null&&u!==void 0?u:1},this._updateFunction=this.updateXY}const m=this.target.getFinalAttribute();m&&this.target.setAttributes(m),this.props=g,this.from=c,this.to=g,((d=this.params.controlOptions)===null||d===void 0?void 0:d.immediatelyApply)!==!1&&this.target.setAttributes(c)}onEnd(t){super.onEnd(t)}updateX(t){this.target.attribute.scaleX=this.from.scaleX+(this.to.scaleX-this.from.scaleX)*t}updateY(t){this.target.attribute.scaleY=this.from.scaleY+(this.to.scaleY-this.from.scaleY)*t}updateXY(t){this.updateX(t),this.updateY(t)}deleteSelfAttr(t){delete this.props[t],this.fromProps&&delete this.fromProps[t];const e=this.propKeys.indexOf(t);e!==-1&&this.propKeys.splice(e,1),this.propKeys&&this.propKeys.length>1?this._updateFunction=this.updateXY:this.propKeys[0]==="scaleX"?this._updateFunction=this.updateX:this.propKeys[0]==="scaleY"?this._updateFunction=this.updateY:this._updateFunction=null}onUpdate(t,e,i){this._updateFunction&&(this._updateFunction(e),this.target.addUpdatePositionTag(),this.target.addUpdateBoundTag())}}class $et extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i,r,o;let s,a;super.onBind();const l=this.target.attribute;switch((t=this.params)===null||t===void 0?void 0:t.direction){case"x":s={scaleX:(e=l?.scaleX)!==null&&e!==void 0?e:1},a={scaleX:0};break;case"y":s={scaleY:(i=l?.scaleY)!==null&&i!==void 0?i:1},a={scaleY:0};break;default:s={scaleX:(r=l?.scaleX)!==null&&r!==void 0?r:1,scaleY:(o=l?.scaleY)!==null&&o!==void 0?o:1},a={scaleX:0,scaleY:0}}this.props=a,this.from=s,this.to=a}onEnd(t){super.onEnd(t)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateBoundTag()}}class Uet extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}update(t,e,i){if(this.onStart(),!this.props||!this.propKeys)return;const r=this.easing(e);this.animate.interpolateUpdateFunction?this.animate.interpolateUpdateFunction(this.fromProps,this.props,r,this,this.target):this.interpolateUpdateFunctions.forEach(((o,s)=>{if(!this.animate.validAttr(this.propKeys[s]))return;const a=this.propKeys[s];o(a,this.fromProps[a],this.props[a],r,this,this.target)})),this.onUpdate(t,r,i),this.syncAttributeUpdate()}}class Fx extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i,r,o,s,a,l,h,u,d,c;super.onBind();const g=this.target.getFinalAttribute(),f=((t=this.params)===null||t===void 0?void 0:t.direction)||"right",p=((e=this.params)===null||e===void 0?void 0:e.distance)||50,m=(r=(i=this.params)===null||i===void 0?void 0:i.fromOpacity)!==null&&r!==void 0?r:0,v={opacity:m,baseOpacity:m},b={opacity:1,baseOpacity:1};f==="top"?(v.y=((o=g.y)!==null&&o!==void 0?o:0)-p,b.y=(s=g.y)!==null&&s!==void 0?s:0,this.propKeys=["opacity","baseOpacity","y"]):f==="bottom"?(v.y=((a=g.y)!==null&&a!==void 0?a:0)+p,b.y=(l=g.y)!==null&&l!==void 0?l:0,this.propKeys=["opacity","baseOpacity","y"]):f==="left"?(v.x=((h=g.x)!==null&&h!==void 0?h:0)-p,b.x=(u=g.x)!==null&&u!==void 0?u:0,this.propKeys=["opacity","baseOpacity","x"]):(v.x=((d=g.x)!==null&&d!==void 0?d:0)+p,b.x=(c=g.x)!==null&&c!==void 0?c:0,this.propKeys=["opacity","baseOpacity","x"]),this.from=v,this.to=b,this.props=b,this.target.setAttributes(v)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class VH extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i,r,o,s,a;super.onBind();const l=this.target.getFinalAttribute(),h=(e=(t=this.params)===null||t===void 0?void 0:t.fromScale)!==null&&e!==void 0?e:0,u=((i=this.params)===null||i===void 0?void 0:i.direction)||"xy",d=(o=(r=this.params)===null||r===void 0?void 0:r.fromOpacity)!==null&&o!==void 0?o:0,c={opacity:d,baseOpacity:d},g={opacity:1,baseOpacity:1};this.propKeys=["opacity","baseOpacity"],u!=="x"&&u!=="xy"||(c.scaleX=h,g.scaleX=(s=l.scaleX)!==null&&s!==void 0?s:1,this.propKeys.push("scaleX")),u!=="y"&&u!=="xy"||(c.scaleY=h,g.scaleY=(a=l.scaleY)!==null&&a!==void 0?a:1,this.propKeys.push("scaleY")),this.from=c,this.to=g,this.props=g,this.target.setAttributes(c)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class GH extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e,i,r,o,s,a,l,h;super.onBind();const u=this.target.getFinalAttribute(),d=(e=(t=this.params)===null||t===void 0?void 0:t.fromAngle)!==null&&e!==void 0?e:2*Math.PI,c=(r=(i=this.params)===null||i===void 0?void 0:i.fromScale)!==null&&r!==void 0?r:0,g=(s=(o=this.params)===null||o===void 0?void 0:o.fromOpacity)!==null&&s!==void 0?s:0,f={opacity:g,baseOpacity:g,angle:d,scaleX:c,scaleY:c},p={opacity:1,baseOpacity:1,angle:(a=u.angle)!==null&&a!==void 0?a:0,scaleX:(l=u.scaleX)!==null&&l!==void 0?l:1,scaleY:(h=u.scaleY)!==null&&h!==void 0?h:1};this.propKeys=["opacity","baseOpacity","angle","scaleX","scaleY"],this.from=f,this.to=p,this.props=p,this.target.setAttributes(f)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class Xet extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o),this.perimeter=0,this.originalAttributes={}}onBind(){var t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b;if(super.onBind(),this.originalAttributes=Object.assign({},this.target.getAttributes()),this.target.type==="rect"){const S=this.target.attribute,T=(t=S.width)!==null&&t!==void 0?t:100,M=(e=S.height)!==null&&e!==void 0?e:100;this.perimeter=2*(T+M)}else if(this.target.type==="circle"){const S=(i=this.target.attribute.radius)!==null&&i!==void 0?i:50;this.perimeter=2*Math.PI*S}else if(this.target.type==="ellipse"){const S=this.target.attribute,T=(r=S.radiusX)!==null&&r!==void 0?r:50,M=(o=S.radiusY)!==null&&o!==void 0?o:50;this.perimeter=2*Math.PI*Math.sqrt((T*T+M*M)/2)}else this.perimeter=1e3;const y=(a=(s=this.params)===null||s===void 0?void 0:s.lineWidth)!==null&&a!==void 0?a:2,C=(h=(l=this.params)===null||l===void 0?void 0:l.strokeColor)!==null&&h!==void 0?h:"black",w=(d=(u=this.params)===null||u===void 0?void 0:u.fromOpacity)!==null&&d!==void 0?d:1,_=(g=(c=this.params)===null||c===void 0?void 0:c.dashLength)!==null&&g!==void 0?g:this.perimeter,A=(p=(f=this.params)===null||f===void 0?void 0:f.showFill)!==null&&p!==void 0&&p,x=(v=(m=this.params)===null||m===void 0?void 0:m.fillOpacity)!==null&&v!==void 0?v:0;this.from={lineDash:[_,_],lineDashOffset:_,lineWidth:y,stroke:C,strokeOpacity:w},this.to={lineDash:[_,_],lineDashOffset:0,lineWidth:y,stroke:C,strokeOpacity:w},A?(this.from.fillOpacity=x,this.to.fillOpacity=(b=this.originalAttributes.fillOpacity)!==null&&b!==void 0?b:1):(this.from.fillOpacity=0,this.to.fillOpacity=0),this.propKeys=["lineDash","lineDashOffset","lineWidth","stroke","strokeOpacity","fillOpacity"],this.props=this.to,this.target.setAttributes(this.from)}onUpdate(t,e,i){var r;const o=this.target.attribute;o.lineDashOffset=this.from.lineDashOffset+(this.to.lineDashOffset-this.from.lineDashOffset)*e,!((r=this.params)===null||r===void 0)&&r.showFill&&(o.fillOpacity=this.from.fillOpacity+(this.to.fillOpacity-this.from.fillOpacity)*e)}onEnd(){var t;if(super.onEnd(),!(!((t=this.params)===null||t===void 0)&&t.showFill)){const e=Object.assign({},this.originalAttributes);e.fillOpacity=0,this.target.setAttributes(e)}}}class Yet extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o),this.perimeter=0,this.originalAttributes={}}onFirstRun(){var t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m;if(this.originalAttributes=Object.assign({},this.target.getAttributes()),this.target.type==="rect"){const _=this.target.attribute,A=(t=_.width)!==null&&t!==void 0?t:100,x=(e=_.height)!==null&&e!==void 0?e:100;this.perimeter=2*(A+x)}else if(this.target.type==="circle"){const _=(i=this.target.attribute.radius)!==null&&i!==void 0?i:50;this.perimeter=2*Math.PI*_}else if(this.target.type==="ellipse"){const _=this.target.attribute,A=(r=_.radiusX)!==null&&r!==void 0?r:50,x=(o=_.radiusY)!==null&&o!==void 0?o:50;this.perimeter=2*Math.PI*Math.sqrt((A*A+x*x)/2)}else this.perimeter=1e3;const v=(a=(s=this.params)===null||s===void 0?void 0:s.lineWidth)!==null&&a!==void 0?a:2,b=(h=(l=this.params)===null||l===void 0?void 0:l.strokeColor)!==null&&h!==void 0?h:"black",y=(d=(u=this.params)===null||u===void 0?void 0:u.fromOpacity)!==null&&d!==void 0?d:1,C=(g=(c=this.params)===null||c===void 0?void 0:c.dashLength)!==null&&g!==void 0?g:this.perimeter,w=(p=(f=this.params)===null||f===void 0?void 0:f.showFill)!==null&&p!==void 0&&p;this.from={lineDash:[C,C],lineDashOffset:0,lineWidth:v,stroke:b,strokeOpacity:y},this.to={lineDash:[C,C],lineDashOffset:-C,lineWidth:v,stroke:b,strokeOpacity:y},w?(this.from.fillOpacity=(m=this.originalAttributes.fillOpacity)!==null&&m!==void 0?m:1,this.to.fillOpacity=0):(this.from.fillOpacity=0,this.to.fillOpacity=0),this.propKeys=["lineDash","lineDashOffset","lineWidth","stroke","strokeOpacity","fillOpacity"],this.props=this.to,this.target.setAttributes(this.from)}onUpdate(t,e,i){var r;const o=this.target.attribute;o.lineDashOffset=this.from.lineDashOffset+(this.to.lineDashOffset-this.from.lineDashOffset)*e,!((r=this.params)===null||r===void 0)&&r.showFill&&(o.fillOpacity=this.from.fillOpacity+(this.to.fillOpacity-this.from.fillOpacity)*e)}}class qet extends Zt{constructor(t,e,i,r,o){var s;super(t,e,i,r,o);const a=(s=o?.slideRatio)!==null&&s!==void 0?s:.5;this.slideInDuration=i*a,this.growInDuration=i*(1-a)}onBind(){var t,e,i,r,o,s;super.onBind();const a=new yt(this.target);a.execute({type:"custom",custom:Fx,customParameters:{direction:((t=this.params)===null||t===void 0?void 0:t.slideDirection)||"right",distance:((e=this.params)===null||e===void 0?void 0:e.slideDistance)||50,fromOpacity:(r=(i=this.params)===null||i===void 0?void 0:i.fromOpacity)!==null&&r!==void 0?r:0},duration:this.slideInDuration,easing:this.easing}),a.execute({type:"custom",custom:VH,customParameters:{fromScale:((o=this.params)===null||o===void 0?void 0:o.fromScale)||.5,direction:((s=this.params)===null||s===void 0?void 0:s.scaleDirection)||"xy",fromOpacity:1},duration:this.growInDuration,easing:this.easing,delay:this.slideInDuration})}onUpdate(t,e,i){}}class Ket extends Zt{constructor(t,e,i,r,o){var s;super(t,e,i,r,o);const a=(s=o?.slideRatio)!==null&&s!==void 0?s:.5;this.slideInDuration=i*a,this.spinInDuration=i*(1-a)}onBind(){var t,e,i,r,o,s;super.onBind();const a=new yt(this.target);a.execute({type:"custom",custom:Fx,customParameters:{direction:((t=this.params)===null||t===void 0?void 0:t.slideDirection)||"right",distance:((e=this.params)===null||e===void 0?void 0:e.slideDistance)||50,fromOpacity:(r=(i=this.params)===null||i===void 0?void 0:i.fromOpacity)!==null&&r!==void 0?r:0},duration:this.slideInDuration,easing:this.easing}),a.execute({type:"custom",custom:GH,customParameters:{fromAngle:((o=this.params)===null||o===void 0?void 0:o.fromAngle)||Math.PI,fromScale:((s=this.params)===null||s===void 0?void 0:s.fromScale)||.5,fromOpacity:1},duration:this.spinInDuration,easing:this.easing,delay:this.slideInDuration})}onUpdate(t,e,i){}}class zx extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onFirstRun(){var t,e,i,r,o,s,a,l,h,u,d,c,g,f;const p=this.target.getAttributes(),m=((t=this.params)===null||t===void 0?void 0:t.direction)||"right",v=((e=this.params)===null||e===void 0?void 0:e.distance)||50,b=(r=(i=this.params)===null||i===void 0?void 0:i.fromOpacity)!==null&&r!==void 0?r:1,y=(s=(o=this.params)===null||o===void 0?void 0:o.toOpacity)!==null&&s!==void 0?s:0,C={opacity:b,baseOpacity:b},w={opacity:y,baseOpacity:y};m==="top"?(C.y=(a=p.y)!==null&&a!==void 0?a:0,w.y=((l=p.y)!==null&&l!==void 0?l:0)-v,this.propKeys=["opacity","baseOpacity","y"]):m==="bottom"?(C.y=(h=p.y)!==null&&h!==void 0?h:0,w.y=((u=p.y)!==null&&u!==void 0?u:0)+v,this.propKeys=["opacity","baseOpacity","y"]):m==="left"?(C.x=(d=p.x)!==null&&d!==void 0?d:0,w.x=((c=p.x)!==null&&c!==void 0?c:0)-v,this.propKeys=["opacity","baseOpacity","x"]):(C.x=(g=p.x)!==null&&g!==void 0?g:0,w.x=((f=p.x)!==null&&f!==void 0?f:0)+v,this.propKeys=["opacity","baseOpacity","x"]),this.from=C,this.to=w,this.props=w}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class $H extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onFirstRun(){var t,e,i,r,o,s,a,l,h;const u=this.target.getAttributes(),d=(e=(t=this.params)===null||t===void 0?void 0:t.fromScale)!==null&&e!==void 0?e:0,c=((i=this.params)===null||i===void 0?void 0:i.direction)||"xy",g=(o=(r=this.params)===null||r===void 0?void 0:r.fromOpacity)!==null&&o!==void 0?o:1,f=(a=(s=this.params)===null||s===void 0?void 0:s.toOpacity)!==null&&a!==void 0?a:0,p={opacity:g,baseOpacity:g},m={opacity:f,baseOpacity:f};this.propKeys=["opacity","baseOpacity"],c!=="x"&&c!=="xy"||(p.scaleX=(l=u.scaleX)!==null&&l!==void 0?l:1,m.scaleX=d,this.propKeys.push("scaleX")),c!=="y"&&c!=="xy"||(p.scaleY=(h=u.scaleY)!==null&&h!==void 0?h:1,m.scaleY=d,this.propKeys.push("scaleY")),this.from=p,this.to=m,this.props=m}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class UH extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onFirstRun(){var t,e,i,r,o,s,a,l,h,u,d;const c=this.target.getAttributes(),g=(e=(t=this.params)===null||t===void 0?void 0:t.fromAngle)!==null&&e!==void 0?e:2*Math.PI,f=(r=(i=this.params)===null||i===void 0?void 0:i.fromScale)!==null&&r!==void 0?r:0,p=(s=(o=this.params)===null||o===void 0?void 0:o.fromOpacity)!==null&&s!==void 0?s:1,m=(l=(a=this.params)===null||a===void 0?void 0:a.toOpacity)!==null&&l!==void 0?l:0,v={opacity:p,baseOpacity:p,angle:(h=c.angle)!==null&&h!==void 0?h:0,scaleX:(u=c.scaleX)!==null&&u!==void 0?u:1,scaleY:(d=c.scaleY)!==null&&d!==void 0?d:1},b={opacity:m,baseOpacity:m,angle:g,scaleX:f,scaleY:f};this.propKeys=["opacity","baseOpacity","angle","scaleX","scaleY"],this.from=v,this.to=b,this.props=b}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class Zet extends Zt{constructor(t,e,i,r,o){var s;super(t,e,i,r,o);const a=(s=o?.slideRatio)!==null&&s!==void 0?s:.5;this.growOutDuration=i*(1-a),this.slideOutDuration=i*a}onFirstRun(){var t,e,i,r;const o=new yt(this.target);o.execute({type:"custom",custom:$H,customParameters:{fromScale:((t=this.params)===null||t===void 0?void 0:t.fromScale)||.5,direction:((e=this.params)===null||e===void 0?void 0:e.scaleDirection)||"xy",fromOpacity:1,toOpacity:1},duration:this.growOutDuration,easing:this.easing}),o.execute({type:"custom",custom:zx,customParameters:{direction:((i=this.params)===null||i===void 0?void 0:i.slideDirection)||"right",distance:((r=this.params)===null||r===void 0?void 0:r.slideDistance)||50,fromOpacity:1},duration:this.slideOutDuration,easing:this.easing,delay:this.growOutDuration})}onUpdate(t,e,i){}}class Jet extends Zt{constructor(t,e,i,r,o){var s;super(t,e,i,r,o);const a=(s=o?.slideRatio)!==null&&s!==void 0?s:.5;this.spinOutDuration=i*(1-a),this.slideOutDuration=i*a}onFirstRun(){var t,e,i,r;const o=new yt(this.target);o.execute({type:"custom",custom:UH,customParameters:{fromAngle:((t=this.params)===null||t===void 0?void 0:t.fromAngle)||Math.PI,fromScale:((e=this.params)===null||e===void 0?void 0:e.fromScale)||.5,fromOpacity:1,toOpacity:1},duration:this.spinOutDuration,easing:this.easing}),o.execute({type:"custom",custom:zx,customParameters:{direction:((i=this.params)===null||i===void 0?void 0:i.slideDirection)||"right",distance:((r=this.params)===null||r===void 0?void 0:r.slideDistance)||50,fromOpacity:1},duration:this.slideOutDuration,easing:this.easing,delay:this.spinOutDuration})}onUpdate(t,e,i){}}class Qet extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o),this.originalAttributes={},this.pulseCount=3,this.pulseOpacity=.3,this.pulseScale=1.05,this.pulseColor=null,this.pulseColorIntensity=.2,this.strokeOnly=!1,this.fillOnly=!1,this.useScale=!0,this.useOpacity=!0,this.useStroke=!0,this.useFill=!0,this.useColor=!1,this.originalFill=null,this.originalStroke=null,o?.pulseCount!==void 0&&(this.pulseCount=o.pulseCount),o?.pulseScale!==void 0&&(this.pulseScale=o.pulseScale),o?.pulseColor!==void 0&&(this.pulseColor=o.pulseColor),o?.pulseColorIntensity!==void 0&&(this.pulseColorIntensity=o.pulseColorIntensity),o?.strokeOnly!==void 0&&(this.strokeOnly=o.strokeOnly),o?.fillOnly!==void 0&&(this.fillOnly=o.fillOnly),o?.useScale!==void 0&&(this.useScale=o.useScale),o?.useOpacity!==void 0&&(this.useOpacity=o.useOpacity),o?.useStroke!==void 0&&(this.useStroke=o.useStroke),o?.useFill!==void 0&&(this.useFill=o.useFill),o?.useColor!==void 0&&(this.useColor=o.useColor)}onBind(){super.onBind(),this.originalAttributes=Object.assign({},this.target.getAttributes()),this.useColor&&(this.originalFill=this.originalAttributes.fill||null,this.originalStroke=this.originalAttributes.stroke||null,this.pulseColor||(this.fillOnly&&this.originalFill?this.pulseColor=this.originalFill:this.strokeOnly&&this.originalStroke?this.pulseColor=this.originalStroke:this.originalFill?this.pulseColor=this.originalFill:this.originalStroke?this.pulseColor=this.originalStroke:this.pulseColor="#FFFFFF"))}onUpdate(t,e,i){const r=e*Math.PI*this.pulseCount,o=Math.abs(Math.sin(r)),s=this.target.attribute;if(this.useOpacity){const a=1+(this.pulseOpacity-1)*o;this.useStroke&&(s.strokeOpacity=(this.originalAttributes.strokeOpacity||1)*a),this.useFill&&(s.fillOpacity=(this.originalAttributes.fillOpacity||1)*a)}if(this.useScale){const a=1+(this.pulseScale-1)*o;s.scaleX=(this.originalAttributes.scaleX||1)*a,s.scaleY=(this.originalAttributes.scaleY||1)*a}this.useColor&&this.pulseColor&&this.applyColorPulse(s,o),this.target.addUpdateShapeAndBoundsTag(),this.target.addUpdatePositionTag()}applyColorPulse(t,e){const i=this.pulseColorIntensity*e;this.useFill&&this.originalFill&&this.pulseColor&&(t.fill=Il(this.originalFill,this.pulseColor,i,!0)),this.useStroke&&this.originalStroke&&this.pulseColor&&(t.stroke=Il(this.originalStroke,this.pulseColor,i,!0))}onEnd(){super.onEnd(),this.target.setAttributes(this.originalAttributes)}}class tit extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onBind(){var t,e;super.onBind();let{diffAttrs:i={}}=(t=this.target.context)!==null&&t!==void 0?t:{};const{options:r}=this.params;i=Object.assign({},i),!((e=r?.excludeChannels)===null||e===void 0)&&e.length&&r.excludeChannels.forEach((o=>{delete i[o]})),this.props=i}update(t,e,i){if(this.onStart(),!this.props||!this.propKeys)return;const r=this.easing(e);this.animate.interpolateUpdateFunction?this.animate.interpolateUpdateFunction(this.fromProps,this.props,r,this,this.target):this.interpolateUpdateFunctions.forEach(((o,s)=>{if(!this.animate.validAttr(this.propKeys[s]))return;const a=this.propKeys[s];o(a,this.fromProps[a],this.props[a],r,this,this.target)})),this.onUpdate(t,r,i)}}const eit=(n,t,e)=>{var i,r,o,s;const{offset:a=0,orient:l,direction:h,point:u,excludeChannels:d=[],layoutRect:c={}}=t??{};let g=0,f=0;l==="negative"&&(g=(i=c.width)!==null&&i!==void 0?i:n.stage.viewWidth,f=(r=c.height)!==null&&r!==void 0?r:n.stage.viewHeight),g+=a,f+=a;const p=hs(u)?u.call(null,(s=(o=n.context)===null||o===void 0?void 0:o.data)===null||s===void 0?void 0:s[0],n,e):u,m=n.getGraphicAttribute("x"),v=n.getGraphicAttribute("y"),b=d.includes("x")?m:p&&ba(p.x)?p.x:g,y=d.includes("y")?v:p&&ba(p.y)?p.y:f;switch(h){case"x":return{from:{x:d.includes("x")?m:b},to:{x:m}};case"y":return{from:{y},to:{y:v}};default:return{from:{x:b,y},to:{x:m,y:v}}}},iit=(n,t,e)=>{var i,r,o,s;const{offset:a=0,orient:l,direction:h,point:u}=t??{},d=e.group?e.group.AABBBounds:null,c=(i=d.width())!==null&&i!==void 0?i:e.width,g=(r=d.height())!==null&&r!==void 0?r:e.height,f=(l==="negative"?c:0)+a,p=(l==="negative"?g:0)+a,m=hs(u)?u.call(null,(s=(o=n.context)===null||o===void 0?void 0:o.data)===null||s===void 0?void 0:s[0],n,e):u,v=m&&ba(m.x)?m.x:f,b=m&&ba(m.y)?m.y:p;switch(h){case"x":return{from:{x:n.getGraphicAttribute("x")},to:{x:v}};case"y":return{from:{y:n.getGraphicAttribute("y")},to:{y:b}};default:return{from:{x:n.getGraphicAttribute("x"),y:n.getGraphicAttribute("y")},to:{x:v,y:b}}}};class XH extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class nit extends XH{onBind(){var t;super.onBind();const{from:e,to:i}=eit(this.target,this.params.options,this.params);this.props=i,this.propKeys=Object.keys(i).filter((o=>i[o]!=null)),this.from=e,this.to=i;const r=this.target.getFinalAttribute();r&&this.target.setAttributes(r),((t=this.params.controlOptions)===null||t===void 0?void 0:t.immediatelyApply)!==!1&&this.target.setAttributes(e)}}class rit extends XH{onBind(){super.onBind();const{from:t,to:e}=iit(this.target,this.params.options,this.params);this.props=e,this.propKeys=Object.keys(e).filter((i=>e[i]!=null)),this.from=t,this.to=e}}const oit=(n,t)=>{var e;const i=(e=n.getFinalAttribute().angle)!==null&&e!==void 0?e:0;let r=0;return r=EH(i/(2*Math.PI),0)?Math.round(i/(2*Math.PI))*Math.PI*2:ba(t?.angle)?t.angle:t?.orient==="anticlockwise"?Math.ceil(i/(2*Math.PI))*Math.PI*2:Math.floor(i/(2*Math.PI))*Math.PI*2,{from:{angle:r},to:{angle:i}}},sit=(n,t)=>{var e;const i=(e=n.getFinalAttribute().angle)!==null&&e!==void 0?e:0;let r=0;return r=EH(i/(2*Math.PI),0)?Math.round(i/(2*Math.PI))*Math.PI*2:ba(t?.angle)?t.angle:t?.orient==="anticlockwise"?Math.ceil(i/(2*Math.PI))*Math.PI*2:Math.floor(i/(2*Math.PI))*Math.PI*2,{from:{angle:i},to:{angle:r}}};class YH extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}onUpdate(t,e,i){const r=this.target.attribute;this.propKeys.forEach((o=>{r[o]=this.from[o]+(this.to[o]-this.from[o])*e})),this.target.addUpdatePositionTag(),this.target.addUpdateShapeAndBoundsTag()}}class ait extends YH{onBind(){var t;super.onBind();const{from:e,to:i}=oit(this.target,this.params.options);this.props=i,this.propKeys=["angle"],this.from=e,this.to=i;const r=this.target.getFinalAttribute();r&&this.target.setAttributes(r),((t=this.params.controlOptions)===null||t===void 0?void 0:t.immediatelyApply)!==!1&&this.target.setAttributes(e)}}class lit extends YH{onBind(){super.onBind();const{from:t,to:e}=sit(this.target,this.params.options);this.props=e,this.propKeys=["angle"],this.from=t,this.to=e}}class hit extends Zt{constructor(t,e,i,r,o){var s;super(t,e,i,r,o),o&&(this.pathLength=o.path.getLength(),this.path=o.path,this.distance=o.distance,this.totalLength=this.distance*this.pathLength,this.initAngle=(s=o.initAngle)!==null&&s!==void 0?s:0,this.changeAngle=!!o.changeAngle,this.cb=o.cb)}onBind(){this.from={x:0,y:0},this.to=this.path.getAttrAt(this.totalLength).pos,this.props=this.to}onUpdate(t,e,i){const r={},o=this.totalLength*e,{pos:s,angle:a}=this.path.getAttrAt(o);r.x=s.x,r.y=s.y,this.changeAngle&&(r.angle=a+this.initAngle),this.cb&&this.cb(this.from,this.to,e,this.target),this.target.setAttributes(r)}}class uit extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o),this.from=t??{}}onBind(){var t,e;super.onBind(),Object.keys(this.from).forEach((r=>{this.props[r]==null&&(this.props[r]=this.target.getGraphicAttribute(r))}));const i=this.target.getFinalAttribute();((t=this.target.context)===null||t===void 0?void 0:t.animationState)==="appear"&&i&&this.target.setAttributes(i),((e=this.params.controlOptions)===null||e===void 0?void 0:e.immediatelyApply)!==!1&&this.target.setAttributes(this.from)}onFirstRun(){this.from=Object.assign(Object.assign({},this.getLastProps()),this.from);const t=this.animate.getStartProps();this.propKeys&&this.propKeys.forEach((e=>{var i;this.from[e]=(i=this.from[e])!==null&&i!==void 0?i:t[e]})),this.target.setAttributes(this.from)}deleteSelfAttr(t){super.deleteSelfAttr(t),delete this.from[t]}update(t,e,i){if(this.onStart(),!this.props||!this.propKeys)return;const r=this.easing(e);this.animate.interpolateUpdateFunction?this.animate.interpolateUpdateFunction(this.from,this.props,r,this,this.target):this.interpolateUpdateFunctions.forEach(((o,s)=>{if(!this.animate.validAttr(this.propKeys[s]))return;const a=this.propKeys[s];o(a,this.from[a],this.props[a],r,this,this.target)})),this.onUpdate(t,r,i),this.syncAttributeUpdate()}}class dit extends Zt{constructor(t,e,i,r,o){super(t,e,i,r,o)}getEndProps(){return{}}onStart(){this.target&&(this.target.type==="rect"?this.onStartRect():this.target.type==="line"?this.onStartLineOrArea("line"):this.target.type==="area"&&this.onStartLineOrArea("area"))}onStartLineOrArea(t){var e;const i=this.target.attachShadow(),r=mt.graphicService.creator[t](Object.assign({},(e=this.params)===null||e===void 0?void 0:e.attribute));this[t]=r,r.pathProxy=new Fi,i.add(r)}onStartRect(){var t,e,i;const r=this.target.attachShadow(),o=(e=(t=this.params)===null||t===void 0?void 0:t.isHorizontal)===null||e===void 0||e,s=o?"height":"width",a=o?"width":"height",l=this.target.AABBBounds[s](),h=o?0:this.target.AABBBounds.y1,u=mt.graphicService.creator.rect(Object.assign(Object.assign({[s]:l,fill:"#bcdeff",shadowBlur:30,shadowColor:"#bcdeff"},(i=this.params)===null||i===void 0?void 0:i.attribute),{x:0,y:h,[a]:0}));this.rect=u,r.add(u)}onBind(){}onEnd(){this.target.detachShadow()}onUpdate(t,e,i){return this.rect?this.onUpdateRect(t,e,i):this.line||this.area?this.onUpdateLineOrArea(t,e,i):void 0}onUpdateRect(t,e,i){var r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y;const C=(o=(r=this.params)===null||r===void 0?void 0:r.isHorizontal)===null||o===void 0||o,w=this.target.attribute;if(C){const _=(a=(s=w.width)!==null&&s!==void 0?s:Math.abs(w.x1-w.x))!==null&&a!==void 0?a:250,A=(h=(l=this.params)===null||l===void 0?void 0:l.streamLength)!==null&&h!==void 0?h:_,x=(c=(d=(u=this.params)===null||u===void 0?void 0:u.attribute)===null||d===void 0?void 0:d.width)!==null&&c!==void 0?c:60,S=-x,T=S+(A-S)*e,M=Math.max(T,0),R=Math.min(Math.min(T+x,x),A-T),E=R+M>_?Math.max(_-M,0):R;this.rect.setAttributes({x:M+Math.min(w.x1-w.x,0),width:E},!1,{type:Tn.ANIMATE_PLAY,animationState:{ratio:e,end:t}})}else{const _=(f=(g=w.height)!==null&&g!==void 0?g:Math.abs(w.y1-w.y))!==null&&f!==void 0?f:250,A=(m=(p=this.params)===null||p===void 0?void 0:p.streamLength)!==null&&m!==void 0?m:_,x=(y=(b=(v=this.params)===null||v===void 0?void 0:v.attribute)===null||b===void 0?void 0:b.height)!==null&&y!==void 0?y:60,S=_-(A+x)*e;let T=Math.min(S,_);const M=Math.min(_-S,x);let R;T<=0?(R=Math.max(T+M,0),T=0):R=M,this.rect.setAttributes({y:T+Math.min(w.y1-w.y,0),height:R},!1,{type:Tn.ANIMATE_PLAY,animationState:{ratio:e,end:t}})}}onUpdateLineOrArea(t,e,i){const r=this.line||this.area;if(!r)return;const o=r.pathProxy,s=this.target;s.cache||s.cacheArea?this._onUpdateLineOrAreaWithCache(o,s,t,e,i):this._onUpdateLineWithoutCache(o,s,t,e,i);const a=s.attribute;r.setAttributes(Object.assign({stroke:a.stroke},r.attribute)),r.addUpdateBoundTag()}_onUpdateLineOrAreaWithCache(t,e,i,r,o){var s,a;if(t.clear(),e.type==="line"){let l=e.cache;Array.isArray(l)||(l=[l]);const h=l.reduce(((d,c)=>d+c.getLength()),0),u=[];return l.forEach((d=>{d.curves.forEach((c=>u.push(c)))})),this._updateCurves(t,u,h,r)}if(e.type==="area"&&(!((a=(s=e.cacheArea)===null||s===void 0?void 0:s.top)===null||a===void 0)&&a.curves)){const l=e.cacheArea,h=l.top.curves.reduce(((u,d)=>u+d.getLength()),0);return this._updateCurves(t,l.top.curves,h,r)}}_updateCurves(t,e,i,r){var o,s;const a=i*r,l=Math.min(a+((s=(o=this.params)===null||o===void 0?void 0:o.streamLength)!==null&&s!==void 0?s:10),i);let h=0,u=!1;for(let d=0;d<e.length;d++)if(e[d].defined!==!1){const c=e[d],g=c.getLength(),f=1-(h+g-a)/g;let p,m=1-(h+g-l)/g;if(h<a&&h+g>a)if(u=!0,c.p2&&c.p3){const[v,b]=pu(c,f);t.moveTo(b.p0.x,b.p0.y),p=b}else{const v=c.getPointAt(f);t.moveTo(v.x,v.y)}if(h<l&&h+g>l){if(c.p2&&c.p3){p&&(m=(l-a)/p.getLength());const[v]=pu(p||c,m);t.bezierCurveTo(v.p1.x,v.p1.y,v.p2.x,v.p2.y,v.p3.x,v.p3.y)}else{const v=c.getPointAt(m);t.lineTo(v.x,v.y)}break}if(u)if(c.p2&&c.p3){const v=p||c;t.bezierCurveTo(v.p1.x,v.p1.y,v.p2.x,v.p2.y,v.p3.x,v.p3.y)}else t.lineTo(c.p1.x,c.p1.y);h+=g}}_onUpdateLineWithoutCache(t,e,i,r,o){var s,a;const{points:l,curveType:h}=e.attribute;if(!l||l.length<2||h!=="linear")return;let u=0;for(let p=1;p<l.length;p++)u+=df.distancePP(l[p],l[p-1]);const d=u*r,c=Math.min(d+((a=(s=this.params)===null||s===void 0?void 0:s.streamLength)!==null&&a!==void 0?a:10),u),g=[];let f=0;for(let p=1;p<l.length;p++){const m=df.distancePP(l[p],l[p-1]);if(f<d&&f+m>d&&g.push(df.pointAtPP(l[p-1],l[p],1-(f+m-d)/m)),f<c&&f+m>c){g.push(df.pointAtPP(l[p-1],l[p],1-(f+m-c)/m));break}g.length&&g.push(l[p]),f+=m}if(g.length&&!(g.length<2)){t.clear(),t.moveTo(g[0].x,g[0].y);for(let p=1;p<g.length;p++)t.lineTo(g[p].x,g[p].y)}}}class cg extends IH{constructor(t,e,i,r,o){super(t,e,i,r,o),this.webglCanvas=null,this.gl=null,this.program=null,this.currentAnimationRatio=0,this.animationTime=0}onUpdate(t,e,i){super.onUpdate(t,e,i),this.currentAnimationRatio=e,this.animationTime=e*Math.PI*2}getAnimationTime(){return this.currentAnimationRatio>0?this.animationTime:Date.now()/1e3}getDurationFromParent(){return this.duration||1e3}initWebGL(t){try{if(this.webglCanvas=Bt.createCanvas({width:t.width,height:t.height,dpr:Bt.devicePixelRatio}),!this.webglCanvas)return!1;this.webglCanvas.style.width=t.style.width||`${t.width}px`,this.webglCanvas.style.height=t.style.height||`${t.height}px`;let e=null;try{e=this.webglCanvas.getContext("webgl"),e||(e=this.webglCanvas.getContext("experimental-webgl"))}catch{}if(this.gl=e,!this.gl)return!1;const i=this.getShaderSources();return this.program=this.createShaderProgram(i.vertex,i.fragment),this.program!==null}catch{return!1}}createShaderProgram(t,e){if(!this.gl)return null;const i=this.createShader(this.gl.VERTEX_SHADER,t),r=this.createShader(this.gl.FRAGMENT_SHADER,e);if(!i||!r)return null;const o=this.gl.createProgram();return o?(this.gl.attachShader(o,i),this.gl.attachShader(o,r),this.gl.linkProgram(o),this.gl.getProgramParameter(o,this.gl.LINK_STATUS)?o:null):null}createShader(t,e){if(!this.gl)return null;const i=this.gl.createShader(t);return i?(this.gl.shaderSource(i,e),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?i:(this.gl.deleteShader(i),null)):null}setupWebGLState(t){this.gl&&this.webglCanvas&&(this.webglCanvas.width===t.width&&this.webglCanvas.height===t.height||(this.webglCanvas.width=t.width,this.webglCanvas.height=t.height),this.gl.viewport(0,0,this.webglCanvas.width,this.webglCanvas.height),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT))}createFullScreenQuad(){if(!this.gl)return null;const t=new Float32Array([-1,-1,0,1,1,-1,1,1,-1,1,0,0,1,1,1,0]),e=this.gl.createBuffer();return this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.bufferData(this.gl.ARRAY_BUFFER,t,this.gl.STATIC_DRAW),e}createTextureFromCanvas(t){if(!this.gl)return null;const e=this.gl.createTexture();return this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),e}setupVertexAttributes(){if(!this.gl||!this.program)return;const t=this.gl.getAttribLocation(this.program,"a_position"),e=this.gl.getAttribLocation(this.program,"a_texCoord");this.gl.enableVertexAttribArray(t),this.gl.vertexAttribPointer(t,2,this.gl.FLOAT,!1,16,0),this.gl.enableVertexAttribArray(e),this.gl.vertexAttribPointer(e,2,this.gl.FLOAT,!1,16,8)}createOutputCanvas(t){const e=Bt.createCanvas({width:t.width,height:t.height,dpr:Bt.devicePixelRatio}),i=e.getContext("2d");return i?(i.clearRect(0,0,t.width,t.height),i.drawImage(t,0,0),{canvas:e,ctx:i}):null}getShaderSources(){return null}applyWebGLEffect(t){return null}applyCanvas2DEffect(t){return null}supportsWebGL(){return this.getShaderSources()!==null}supportsCanvas2D(){return this.applyCanvas2DEffect!==cg.prototype.applyCanvas2DEffect}release(){super.release(),this.gl&&(this.program&&(this.gl.deleteProgram(this.program),this.program=null),this.gl=null),this.webglCanvas&&(this.webglCanvas=null),this.currentAnimationRatio=0,this.animationTime=0}afterStageRender(t,e){let i=null;return this.supportsWebGL()&&(this.gl||this.initWebGL(e),this.gl)&&(i=this.applyWebGLEffect(e),i)||this.supportsCanvas2D()&&(i=this.applyCanvas2DEffect(e),i)?i:(this.supportsWebGL()||this.supportsCanvas2D(),e)}}class cit extends cg{constructor(t,e,i,r,o){super(t,e,i,r,o)}getShaderSources(){return null}applyWebGLEffect(t){return null}}class zl extends cg{constructor(t,e,i,r,o){super(t,e,i,r,o)}getShaderSources(){return null}applyWebGLEffect(t){return null}applyCanvas2DEffect(t){return null}supportsWebGL(){return this.getShaderSources!==zl.prototype.getShaderSources&&this.getShaderSources()!==null}supportsCanvas2D(){return this.applyCanvas2DEffect!==zl.prototype.applyCanvas2DEffect}afterStageRender(t,e){var i,r;let o=null;if(((r=(i=this.params)===null||i===void 0?void 0:i.options)===null||r===void 0?void 0:r.useWebGL)!==!1){if(this.supportsWebGL()&&(this.gl||this.initWebGL(e),this.gl)&&(o=this.applyWebGLEffect(e),o)||this.supportsCanvas2D()&&(o=this.applyCanvas2DEffect(e),o))return o}else if(this.supportsCanvas2D()&&(o=this.applyCanvas2DEffect(e),o))return o;return this.supportsWebGL()||this.supportsCanvas2D(),e}}class Ee{static createTempCanvas(t,e,i){return Bt.createCanvas({width:t,height:e,dpr:i||Bt.devicePixelRatio})}static cloneImageData(t){const e=new Uint8ClampedArray(t.data);return new ImageData(e,t.width,t.height)}static lerp(t,e,i){return t*(1-i)+e*i}static smoothstep(t,e,i){const r=Math.max(0,Math.min(1,(i-t)/(e-t)));return r*r*(3-2*r)}static distance(t,e,i,r){const o=i-t,s=r-e;return Math.sqrt(o*o+s*s)}static normalizeAngle(t){return(t+Math.PI)/(2*Math.PI)}static pixelNoise(t,e,i){if(i<=0)return 0;const r=Math.floor(t/i)*i,o=Math.floor(e/i)*i,s=43758.5453*Math.sin(12.9898*r+78.233*o);return s-Math.floor(s)}static generateNoiseTexture(t,e){const i=new Uint8Array(t*e);for(let r=0;r<i.length;r++)i[r]=Math.floor(256*Math.random());return i}static applyCSSFilter(t,e){const i=this.createTempCanvas(t.width,t.height),r=i.getContext("2d");return r?(r.filter=e,r.drawImage(t,0,0),r.filter="none",i):t}static extractChannel(t,e){const{data:i,width:r,height:o}=t,s=new Uint8ClampedArray(i.length);for(let a=0;a<i.length;a+=4)s[a]=0,s[a+1]=0,s[a+2]=0,s[a+3]=i[a+3],e>=0&&e<=2&&(s[a+e]=i[a+e]);return new ImageData(s,r,o)}static blendImageData(t,e,i){const{data:r,width:o,height:s}=t,{data:a}=e,l=new Uint8ClampedArray(r.length);for(let h=0;h<r.length;h+=4)l[h]=Math.round(this.lerp(r[h],a[h],i)),l[h+1]=Math.round(this.lerp(r[h+1],a[h+1],i)),l[h+2]=Math.round(this.lerp(r[h+2],a[h+2],i)),l[h+3]=Math.round(this.lerp(r[h+3],a[h+3],i));return new ImageData(l,o,s)}static getLuminance(t,e,i){return .299*t+.587*e+.114*i}static applySepiaToPixel(t,e,i){return[Math.min(255,.393*t+.769*e+.189*i),Math.min(255,.349*t+.686*e+.168*i),Math.min(255,.272*t+.534*e+.131*i)]}static calculateDynamicStrength(t,e){return t*(e/(2*Math.PI))}}class Au{}Au.STANDARD_VERTEX_SHADER=`
    attribute vec2 a_position;
    attribute vec2 a_texCoord;
    varying vec2 v_texCoord;

    void main() {
      gl_Position = vec4(a_position, 0.0, 1.0);
      v_texCoord = a_texCoord;
    }
  `,Au.SHADER_FUNCTIONS=`
    // 亮度计算函数
    float luminance(vec3 color) {
      return dot(color, vec3(0.299, 0.587, 0.114));
    }

    // 褐色调函数
    vec3 sepia(vec3 color) {
      float r = color.r * 0.393 + color.g * 0.769 + color.b * 0.189;
      float g = color.r * 0.349 + color.g * 0.686 + color.b * 0.168;
      float b = color.r * 0.272 + color.g * 0.534 + color.b * 0.131;
      return vec3(r, g, b);
    }

    // 线性插值函数
    float lerp(float a, float b, float t) {
      return a * (1.0 - t) + b * t;
    }


    // 简单噪声函数
    float pixelNoise(vec2 coord, float pixelSize) {
      vec2 gridCoord = floor(coord / pixelSize) * pixelSize;
      return fract(sin(dot(gridCoord, vec2(12.9898, 78.233))) * 43758.5453123);
    }

    // 动态强度计算
    float calculateDynamicStrength(float baseStrength, float time) {
      return baseStrength * (time / 6.28318531); // 2π
    }
  `;class git extends zl{constructor(t,e,i,r,o){var s,a,l,h;super(t,e,i,r,o),this.noiseData=null;const u=(s=o?.options)===null||s===void 0?void 0:s.noiseScale,d=u!==void 0?Math.max(0,Math.floor(u)):8;this.dissolveConfig={dissolveType:((a=o?.options)===null||a===void 0?void 0:a.dissolveType)||"outward",useWebGL:((l=o?.options)===null||l===void 0?void 0:l.useWebGL)===void 0||o.options.useWebGL,noiseScale:d,fadeEdge:((h=o?.options)===null||h===void 0?void 0:h.fadeEdge)===void 0||o.options.fadeEdge}}getShaderSources(){return{vertex:Au.STANDARD_VERTEX_SHADER,fragment:`
      precision mediump float;
      uniform sampler2D u_texture;
      uniform sampler2D u_noiseTexture;
      uniform float u_time;
      uniform int u_dissolveType;
      uniform vec2 u_resolution;
      uniform float u_noiseScale;
      uniform bool u_fadeEdge;
      varying vec2 v_texCoord;

      ${Au.SHADER_FUNCTIONS}

      // 向外溶解函数
      float outwardDissolve(vec2 uv, float time, float pixelSize, vec2 resolution) {
        vec2 center = vec2(0.5, 0.5);
        float distFromCenter = length(uv - center);
        float maxDist = length(vec2(0.5, 0.5));

        // 归一化距离 (0为中心，1为边缘)
        float normalizedDist = distFromCenter / maxDist;

        // 向外溶解：从边缘开始溶解，time控制溶解进度
        // 增加安全边距，确保动画结束时完全溶解
        float edgeThreshold = 1.2 - time * 1.5;

        // 当pixelSize > 0时添加颗粒效果
        if (pixelSize > 0.0) {
          // 添加基于像素大小的噪声，让边缘呈现颗粒状
          vec2 pixelCoord = uv * resolution; // 转换为像素坐标
          float noiseValue = pixelNoise(pixelCoord, pixelSize);
          float noiseInfluence = (noiseValue - 0.5) * 0.4; // 增强噪声影响
          edgeThreshold += noiseInfluence;
          return normalizedDist > edgeThreshold ? 0.0 : 1.0;
        } else {
          // 平滑溶解：根据fadeEdge决定是否使用渐变
          if (u_fadeEdge) {
            // 柔和边缘：返回渐变值
            float fadeWidth = 0.15; // 渐变宽度
            return 1.0 - smoothstep(edgeThreshold - fadeWidth, edgeThreshold, normalizedDist);
          } else {
            // 硬边缘：返回0或1
            return normalizedDist > edgeThreshold ? 0.0 : 1.0;
          }
        }
      }

      // 向内溶解函数
      float inwardDissolve(vec2 uv, float time, float pixelSize, vec2 resolution) {
        vec2 center = vec2(0.5, 0.5);
        float distFromCenter = length(uv - center);
        float maxDist = length(vec2(0.5, 0.5));

        float normalizedDist = distFromCenter / maxDist;

        // 向内溶解：从中心开始溶解，time控制溶解进度
        // 增加系数，确保动画结束时完全溶解
        float centerThreshold = time * 1.4;

        // 当pixelSize > 0时添加颗粒效果
        if (pixelSize > 0.0) {
          vec2 pixelCoord = uv * resolution;
          float noiseValue = pixelNoise(pixelCoord, pixelSize);
          float noiseInfluence = (noiseValue - 0.5) * 0.4;
          centerThreshold += noiseInfluence;
          return normalizedDist < centerThreshold ? 0.0 : 1.0;
        } else {
          // 平滑溶解：根据fadeEdge决定是否使用渐变
          if (u_fadeEdge) {
            // 柔和边缘：返回渐变值
            float fadeWidth = 0.15; // 渐变宽度
            return smoothstep(centerThreshold, centerThreshold + fadeWidth, normalizedDist);
          } else {
            // 硬边缘：返回0或1
            return normalizedDist < centerThreshold ? 0.0 : 1.0;
          }
        }
      }

      // 径向溶解函数
      float radialDissolve(vec2 uv, float time, float pixelSize, vec2 resolution) {
        vec2 center = vec2(0.5, 0.5);
        float angle = atan(uv.y - center.y, uv.x - center.x);
        float normalizedAngle = (angle + 3.14159) / (2.0 * 3.14159);

        // 径向溶解：按角度顺序溶解，time控制溶解进度
        // 增加系数，确保动画结束时完全溶解
        float angleThreshold = time * 1.2;

        // 当pixelSize > 0时添加颗粒效果
        if (pixelSize > 0.0) {
          vec2 pixelCoord = uv * resolution;
          float noiseValue = pixelNoise(pixelCoord, pixelSize);
          float noiseInfluence = (noiseValue - 0.5) * 0.3;
          angleThreshold += noiseInfluence;
          return normalizedAngle < angleThreshold ? 0.0 : 1.0;
        } else {
          // 平滑溶解：根据fadeEdge决定是否使用渐变
          if (u_fadeEdge) {
            // 柔和边缘：返回渐变值
            float fadeWidth = 0.08; // 渐变宽度
            return smoothstep(angleThreshold, angleThreshold + fadeWidth, normalizedAngle);
          } else {
            // 硬边缘：返回0或1
            return normalizedAngle < angleThreshold ? 0.0 : 1.0;
          }
        }
      }

      // 从左到右溶解函数
      float leftToRightDissolve(vec2 uv, float time, float pixelSize, vec2 resolution) {
        // 左到右溶解：从x=0开始向x=1溶解
        float dissolvePosition = time * 1.2; // 增加系数确保完全溶解

        // 当pixelSize > 0时添加颗粒效果
        if (pixelSize > 0.0) {
          vec2 pixelCoord = uv * resolution;
          float noiseValue = pixelNoise(pixelCoord, pixelSize);
          float noiseInfluence = (noiseValue - 0.5) * 0.3;
          dissolvePosition += noiseInfluence;
          return uv.x < dissolvePosition ? 0.0 : 1.0;
        } else {
          // 平滑溶解：根据fadeEdge决定是否使用渐变
          if (u_fadeEdge) {
            // 柔和边缘：返回渐变值
            float fadeWidth = 0.08; // 渐变宽度
            return smoothstep(dissolvePosition, dissolvePosition + fadeWidth, uv.x);
          } else {
            // 硬边缘：返回0或1
            return uv.x < dissolvePosition ? 0.0 : 1.0;
          }
        }
      }

      // 从右到左溶解函数
      float rightToLeftDissolve(vec2 uv, float time, float pixelSize, vec2 resolution) {
        // 右到左溶解：从x=1开始向x=0溶解
        float dissolvePosition = 1.0 - time * 1.2; // 增加系数确保完全溶解

        // 当pixelSize > 0时添加颗粒效果
        if (pixelSize > 0.0) {
          vec2 pixelCoord = uv * resolution;
          float noiseValue = pixelNoise(pixelCoord, pixelSize);
          float noiseInfluence = (noiseValue - 0.5) * 0.3;
          dissolvePosition += noiseInfluence;
          return uv.x > dissolvePosition ? 0.0 : 1.0;
        } else {
          // 平滑溶解：根据fadeEdge决定是否使用渐变
          if (u_fadeEdge) {
            // 柔和边缘：返回渐变值
            float fadeWidth = 0.08; // 渐变宽度
            return smoothstep(dissolvePosition - fadeWidth, dissolvePosition, uv.x);
          } else {
            // 硬边缘：返回0或1
            return uv.x > dissolvePosition ? 0.0 : 1.0;
          }
        }
      }

      // 从上到下溶解函数
      float topToBottomDissolve(vec2 uv, float time, float pixelSize, vec2 resolution) {
        // 上到下溶解：从y=0开始向y=1溶解
        float dissolvePosition = time * 1.2; // 增加系数确保完全溶解

        // 当pixelSize > 0时添加颗粒效果
        if (pixelSize > 0.0) {
          vec2 pixelCoord = uv * resolution;
          float noiseValue = pixelNoise(pixelCoord, pixelSize);
          float noiseInfluence = (noiseValue - 0.5) * 0.3;
          dissolvePosition += noiseInfluence;
          return uv.y < dissolvePosition ? 0.0 : 1.0;
        } else {
          // 平滑溶解：根据fadeEdge决定是否使用渐变
          if (u_fadeEdge) {
            // 柔和边缘：返回渐变值
            float fadeWidth = 0.08; // 渐变宽度
            return smoothstep(dissolvePosition, dissolvePosition + fadeWidth, uv.y);
          } else {
            // 硬边缘：返回0或1
            return uv.y < dissolvePosition ? 0.0 : 1.0;
          }
        }
      }

      // 从下到上溶解函数
      float bottomToTopDissolve(vec2 uv, float time, float pixelSize, vec2 resolution) {
        // 下到上溶解：从y=1开始向y=0溶解
        float dissolvePosition = 1.0 - time * 1.2; // 增加系数确保完全溶解

        // 当pixelSize > 0时添加颗粒效果
        if (pixelSize > 0.0) {
          vec2 pixelCoord = uv * resolution;
          float noiseValue = pixelNoise(pixelCoord, pixelSize);
          float noiseInfluence = (noiseValue - 0.5) * 0.3;
          dissolvePosition += noiseInfluence;
          return uv.y > dissolvePosition ? 0.0 : 1.0;
        } else {
          // 平滑溶解：根据fadeEdge决定是否使用渐变
          if (u_fadeEdge) {
            // 柔和边缘：返回渐变值
            float fadeWidth = 0.08; // 渐变宽度
            return smoothstep(dissolvePosition - fadeWidth, dissolvePosition, uv.y);
          } else {
            // 硬边缘：返回0或1
            return uv.y > dissolvePosition ? 0.0 : 1.0;
          }
        }
      }

      void main() {
        vec2 uv = v_texCoord;
        vec4 texColor = texture2D(u_texture, uv);

        float alpha = 1.0;

        // 根据溶解类型选择对应的溶解函数
        if (u_dissolveType == 0) {
          alpha = outwardDissolve(uv, u_time, u_noiseScale, u_resolution);
        } else if (u_dissolveType == 1) {
          alpha = inwardDissolve(uv, u_time, u_noiseScale, u_resolution);
        } else if (u_dissolveType == 2) {
          alpha = radialDissolve(uv, u_time, u_noiseScale, u_resolution);
        } else if (u_dissolveType == 3) {
          alpha = leftToRightDissolve(uv, u_time, u_noiseScale, u_resolution);
        } else if (u_dissolveType == 4) {
          alpha = rightToLeftDissolve(uv, u_time, u_noiseScale, u_resolution);
        } else if (u_dissolveType == 5) {
          alpha = topToBottomDissolve(uv, u_time, u_noiseScale, u_resolution);
        } else if (u_dissolveType == 6) {
          alpha = bottomToTopDissolve(uv, u_time, u_noiseScale, u_resolution);
        }

        gl_FragColor = vec4(texColor.rgb, texColor.a * alpha);
      }
    `}}applyWebGLEffect(t){if(!this.gl||!this.program||!this.webglCanvas)return t;this.setupWebGLState(t);const e=this.createTextureFromCanvas(t);if(!e)return t;this.noiseData||(this.noiseData=Ee.generateNoiseTexture(256,256));const i=this.gl.createTexture();this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,i),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.LUMINANCE,256,256,0,this.gl.LUMINANCE,this.gl.UNSIGNED_BYTE,this.noiseData),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);const r=this.createFullScreenQuad();return r?(this.gl.useProgram(this.program),this.setupVertexAttributes(),this.setUniforms(),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.gl.deleteTexture(e),this.gl.deleteTexture(i),this.gl.deleteBuffer(r),this.webglCanvas):t}setUniforms(){if(!this.gl||!this.program||!this.webglCanvas)return;const t=this.gl.getUniformLocation(this.program,"u_texture"),e=this.gl.getUniformLocation(this.program,"u_noiseTexture"),i=this.gl.getUniformLocation(this.program,"u_time"),r=this.gl.getUniformLocation(this.program,"u_dissolveType"),o=this.gl.getUniformLocation(this.program,"u_resolution"),s=this.gl.getUniformLocation(this.program,"u_noiseScale"),a=this.gl.getUniformLocation(this.program,"u_fadeEdge");this.gl.uniform1i(t,0),this.gl.uniform1i(e,1),this.gl.uniform1f(i,this.currentAnimationRatio),this.gl.uniform2f(o,this.webglCanvas.width,this.webglCanvas.height),this.gl.uniform1f(s,this.dissolveConfig.noiseScale),this.gl.uniform1i(a,this.dissolveConfig.fadeEdge?1:0),this.gl.uniform1i(r,{outward:0,inward:1,radial:2,leftToRight:3,rightToLeft:4,topToBottom:5,bottomToTop:6}[this.dissolveConfig.dissolveType]||0)}applyCanvas2DEffect(t){const e=this.createOutputCanvas(t);if(!e)return t;const{canvas:i,ctx:r}=e,o=r.getImageData(0,0,t.width,t.height),s=this.currentAnimationRatio;let a;switch(this.dissolveConfig.dissolveType){case"outward":a=this.applyOutwardDissolve(o,s);break;case"inward":a=this.applyInwardDissolve(o,s);break;case"radial":a=this.applyRadialDissolve(o,s);break;case"leftToRight":a=this.applyLeftToRightDissolve(o,s);break;case"rightToLeft":a=this.applyRightToLeftDissolve(o,s);break;case"topToBottom":a=this.applyTopToBottomDissolve(o,s);break;case"bottomToTop":a=this.applyBottomToTopDissolve(o,s);break;default:a=o}return r.putImageData(a,0,0),i}applyOutwardDissolve(t,e){const{data:i,width:r,height:o}=t,s=new Uint8ClampedArray(i.length);s.set(i);const a=r/2,l=o/2,h=Math.sqrt(a*a+l*l),u=this.dissolveConfig.noiseScale;for(let d=0;d<o;d++)for(let c=0;c<r;c++){const g=c-a,f=d-l,p=Math.sqrt(g*g+f*f)/h;let m=1.2-1.4*e,v=1;if(u>0)m+=.4*(Ee.pixelNoise(c,d,u)-.5),v=p>m?0:1;else if(this.dissolveConfig.fadeEdge){const y=m-.15;v=p<y?1:p>m?0:1-(p-y)/(m-y)}else v=p>m?0:1;const b=4*(d*r+c);s[b+3]=Math.floor(s[b+3]*v)}return new ImageData(s,r,o)}applyInwardDissolve(t,e){const{data:i,width:r,height:o}=t,s=new Uint8ClampedArray(i.length);s.set(i);const a=r/2,l=o/2,h=Math.sqrt(a*a+l*l),u=this.dissolveConfig.noiseScale;for(let d=0;d<o;d++)for(let c=0;c<r;c++){const g=c-a,f=d-l,p=Math.sqrt(g*g+f*f)/h;let m=1.4*e,v=1;if(u>0)m+=.4*(Ee.pixelNoise(c,d,u)-.5),v=p<m?0:1;else if(this.dissolveConfig.fadeEdge){const y=m+.15;v=p<m?0:p>y?1:(p-m)/(y-m)}else v=p<m?0:1;const b=4*(d*r+c);s[b+3]=Math.floor(s[b+3]*v)}return new ImageData(s,r,o)}applyRadialDissolve(t,e){const{data:i,width:r,height:o}=t,s=new Uint8ClampedArray(i.length);s.set(i);const a=r/2,l=o/2,h=this.dissolveConfig.noiseScale;for(let u=0;u<o;u++)for(let d=0;d<r;d++){const c=d-a,g=u-l,f=(Math.atan2(g,c)+Math.PI)/(2*Math.PI);let p=1.2*e,m=1;if(h>0)p+=.3*(Ee.pixelNoise(d,u,h)-.5),m=f<p?0:1;else if(this.dissolveConfig.fadeEdge){const b=p+.08;m=f<p?0:f>b?1:(f-p)/(b-p)}else m=f<p?0:1;const v=4*(u*r+d);s[v+3]=Math.floor(s[v+3]*m)}return new ImageData(s,r,o)}applyLeftToRightDissolve(t,e){const{data:i,width:r,height:o}=t,s=new Uint8ClampedArray(i.length);s.set(i);const a=this.dissolveConfig.noiseScale;for(let l=0;l<o;l++)for(let h=0;h<r;h++){const u=h/r;let d=1.2*e,c=1;if(a>0)d+=.3*(Ee.pixelNoise(h,l,a)-.5),c=u<d?0:1;else if(this.dissolveConfig.fadeEdge){const f=d+.08;c=u<d?0:u>f?1:(u-d)/(f-d)}else c=u<d?0:1;const g=4*(l*r+h);s[g+3]=Math.floor(s[g+3]*c)}return new ImageData(s,r,o)}applyRightToLeftDissolve(t,e){const{data:i,width:r,height:o}=t,s=new Uint8ClampedArray(i.length);s.set(i);const a=this.dissolveConfig.noiseScale;for(let l=0;l<o;l++)for(let h=0;h<r;h++){const u=h/r;let d=1-1.2*e,c=1;if(a>0)d+=.3*(Ee.pixelNoise(h,l,a)-.5),c=u>d?0:1;else if(this.dissolveConfig.fadeEdge){const f=d-.08;c=u<f?1:u>d?0:1-(u-f)/(d-f)}else c=u>d?0:1;const g=4*(l*r+h);s[g+3]=Math.floor(s[g+3]*c)}return new ImageData(s,r,o)}applyTopToBottomDissolve(t,e){const{data:i,width:r,height:o}=t,s=new Uint8ClampedArray(i.length);s.set(i);const a=this.dissolveConfig.noiseScale;for(let l=0;l<o;l++)for(let h=0;h<r;h++){const u=l/o;let d=1.2*e,c=1;if(a>0)d+=.3*(Ee.pixelNoise(h,l,a)-.5),c=u<d?0:1;else if(this.dissolveConfig.fadeEdge){const f=d+.08;c=u<d?0:u>f?1:(u-d)/(f-d)}else c=u<d?0:1;const g=4*(l*r+h);s[g+3]=Math.floor(s[g+3]*c)}return new ImageData(s,r,o)}applyBottomToTopDissolve(t,e){const{data:i,width:r,height:o}=t,s=new Uint8ClampedArray(i.length);s.set(i);const a=this.dissolveConfig.noiseScale;for(let l=0;l<o;l++)for(let h=0;h<r;h++){const u=l/o;let d=1-1.2*e,c=1;if(a>0)d+=.3*(Ee.pixelNoise(h,l,a)-.5),c=u>d?0:1;else if(this.dissolveConfig.fadeEdge){const f=d-.08;c=u<f?1:u>d?0:1-(u-f)/(d-f)}else c=u>d?0:1;const g=4*(l*r+h);s[g+3]=Math.floor(s[g+3]*c)}return new ImageData(s,r,o)}}class fit extends zl{constructor(t,e,i,r,o){var s,a,l;super(t,e,i,r,o);const h=((s=o?.options)===null||s===void 0?void 0:s.strength)!==void 0?o.options.strength:1,u=Math.max(0,Math.min(1,h));this.colorConfig={effectType:((a=o?.options)===null||a===void 0?void 0:a.effectType)||"grayscale",strength:u,useWebGL:((l=o?.options)===null||l===void 0?void 0:l.useWebGL)===void 0||o.options.useWebGL}}getShaderSources(){return{vertex:Au.STANDARD_VERTEX_SHADER,fragment:`
      precision mediump float;
      uniform sampler2D u_texture;
      uniform float u_time;
      uniform float u_strength;
      uniform int u_effectType;
      uniform vec2 u_resolution;
      varying vec2 v_texCoord;

      ${Au.SHADER_FUNCTIONS}

      void main() {
        vec2 uv = v_texCoord;
        vec4 originalColor = texture2D(u_texture, uv);
        vec3 color = originalColor.rgb;

        // 计算动态强度
        float dynamicStrength = calculateDynamicStrength(u_strength, u_time);

        if (u_effectType == 0) {
          // 灰度效果
          float gray = luminance(color);
          vec3 grayColor = vec3(gray);
          color = mix(color, grayColor, dynamicStrength);
        } else if (u_effectType == 1) {
          // 褐色调效果
          vec3 sepiaColor = sepia(color);
          color = mix(color, sepiaColor, dynamicStrength);
        }

        gl_FragColor = vec4(color, originalColor.a);
      }
    `}}applyWebGLEffect(t){if(!this.gl||!this.program||!this.webglCanvas)return null;this.setupWebGLState(t);const e=this.createTextureFromCanvas(t);if(!e)return null;const i=this.createFullScreenQuad();if(!i)return this.gl.deleteTexture(e),null;try{return this.gl.useProgram(this.program),this.setupVertexAttributes(),this.setColorUniforms(),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.webglCanvas}finally{this.gl.deleteTexture(e),this.gl.deleteBuffer(i)}}setColorUniforms(){if(!this.gl||!this.program)return;const t=this.getAnimationTime(),e=this.gl.getUniformLocation(this.program,"u_time"),i=this.gl.getUniformLocation(this.program,"u_strength"),r=this.gl.getUniformLocation(this.program,"u_effectType"),o=this.gl.getUniformLocation(this.program,"u_resolution");this.gl.uniform1f(e,t),this.gl.uniform1f(i,this.colorConfig.strength),this.gl.uniform2f(o,this.webglCanvas.width,this.webglCanvas.height),this.gl.uniform1i(r,{grayscale:0,sepia:1}[this.colorConfig.effectType]||0)}applyCanvas2DEffect(t){if(this.colorConfig.strength<=0){const r=this.createOutputCanvas(t);return r?r.canvas:null}if(this.canUseCSSFilter())return this.applyCSSFilter(t);const e=this.createOutputCanvas(t);if(!e)return null;const{ctx:i}=e;try{const r=i.getImageData(0,0,t.width,t.height),o=this.getAnimationTime();let s;switch(this.colorConfig.effectType){case"grayscale":default:s=this.applyGrayscaleEffect(r,this.colorConfig.strength,o);break;case"sepia":s=this.applySepiaEffect(r,this.colorConfig.strength,o)}return i.clearRect(0,0,t.width,t.height),i.putImageData(s,0,0),e.canvas}catch{return null}}canUseCSSFilter(){var t;return!!window.useFilterAPI&&typeof CSS<"u"&&((t=CSS.supports)===null||t===void 0?void 0:t.call(CSS,"filter","grayscale(1)"))}applyCSSFilter(t){try{const e=Ee.createTempCanvas(t.width,t.height),i=e.getContext("2d");if(!i)return null;const r=this.getAnimationTime(),o=Ee.calculateDynamicStrength(this.colorConfig.strength,r);let s="";return this.colorConfig.effectType==="grayscale"?s=`grayscale(${Math.min(1,o)})`:this.colorConfig.effectType==="sepia"&&(s=`sepia(${Math.min(1,o)})`),i.filter=s,i.drawImage(t,0,0),i.filter="none",e}catch{return null}}applyGrayscaleEffect(t,e,i){const{data:r,width:o,height:s}=t,a=new Uint8ClampedArray(r.length),l=Ee.calculateDynamicStrength(e,i);for(let h=0;h<r.length;h+=4){const u=r[h],d=r[h+1],c=r[h+2],g=r[h+3],f=Ee.getLuminance(u,d,c);a[h]=Math.round(Ee.lerp(u,f,l)),a[h+1]=Math.round(Ee.lerp(d,f,l)),a[h+2]=Math.round(Ee.lerp(c,f,l)),a[h+3]=g}return new ImageData(a,o,s)}applySepiaEffect(t,e,i){const{data:r,width:o,height:s}=t,a=new Uint8ClampedArray(r.length),l=Ee.calculateDynamicStrength(e,i);for(let h=0;h<r.length;h+=4){const u=r[h],d=r[h+1],c=r[h+2],g=r[h+3],[f,p,m]=Ee.applySepiaToPixel(u,d,c);a[h]=Math.round(Ee.lerp(u,f,l)),a[h+1]=Math.round(Ee.lerp(d,p,l)),a[h+2]=Math.round(Ee.lerp(c,m,l)),a[h+3]=g}return new ImageData(a,o,s)}afterStageRender(t,e){if(this.canUseCSSFilter()&&this.colorConfig.strength>0){const i=this.applyCSSFilter(e);if(i)return i}return super.afterStageRender(t,e)}}class pit extends zl{constructor(t,e,i,r,o){var s,a,l;super(t,e,i,r,o),this.distortionConfig={distortionType:((s=o?.options)===null||s===void 0?void 0:s.distortionType)||"wave",strength:((a=o?.options)===null||a===void 0?void 0:a.strength)||.3,useWebGL:((l=o?.options)===null||l===void 0?void 0:l.useWebGL)===void 0||o.options.useWebGL}}getShaderSources(){return{vertex:`
      attribute vec2 a_position;
      attribute vec2 a_texCoord;
      varying vec2 v_texCoord;

      void main() {
        gl_Position = vec4(a_position, 0.0, 1.0);
        v_texCoord = a_texCoord;
      }
    `,fragment:`
      precision mediump float;
      uniform sampler2D u_texture;
      uniform float u_time;
      uniform float u_strength;
      uniform int u_distortionType;
      uniform vec2 u_resolution;
      varying vec2 v_texCoord;

      // 波浪扭曲函数
      vec2 wave(vec2 uv, float time, float strength) {
        float waveX = sin(uv.y * 10.0 + time * 3.0) * strength * 0.1;
        float waveY = sin(uv.x * 10.0 + time * 2.0) * strength * 0.1;
        return uv + vec2(waveX, waveY);
      }

      // 涟漪扭曲函数
      vec2 ripple(vec2 uv, float time, float strength) {
        vec2 center = vec2(0.5, 0.5);
        float distance = length(uv - center);
        float ripple = sin(distance * 20.0 - time * 5.0) * strength * 0.1;
        vec2 direction = normalize(uv - center);
        return uv + direction * ripple;
      }

      // 漩涡扭曲函数
      vec2 swirl(vec2 uv, float time, float strength) {
        vec2 center = vec2(0.5, 0.5);
        vec2 delta = uv - center;
        float dist = length(delta);
        float originalAngle = atan(delta.y, delta.x);
        float rotationAngle = dist * strength * time * 2.0;
        float finalAngle = originalAngle + rotationAngle;
        return center + dist * vec2(cos(finalAngle), sin(finalAngle));
      }

      void main() {
        vec2 uv = v_texCoord;

        // 根据扭曲类型应用相应变换
        if (u_distortionType == 0) {
          uv = wave(uv, u_time, u_strength);
        } else if (u_distortionType == 1) {
          uv = ripple(uv, u_time, u_strength);
        } else if (u_distortionType == 2) {
          uv = swirl(uv, u_time, u_strength);
        }

        // 边界检查
        if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        } else {
          gl_FragColor = texture2D(u_texture, uv);
        }
      }
    `}}applyWebGLEffect(t){if(!this.gl||!this.program||!this.webglCanvas)return null;this.setupWebGLState(t);const e=this.createTextureFromCanvas(t);if(!e)return null;const i=this.createFullScreenQuad();if(!i)return this.gl.deleteTexture(e),null;try{return this.gl.useProgram(this.program),this.setupVertexAttributes(),this.setDistortionUniforms(),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),this.webglCanvas}finally{this.gl.deleteTexture(e),this.gl.deleteBuffer(i)}}setDistortionUniforms(){if(!this.gl||!this.program)return;const t=this.getAnimationTime(),e=this.gl.getUniformLocation(this.program,"u_time"),i=this.gl.getUniformLocation(this.program,"u_strength"),r=this.gl.getUniformLocation(this.program,"u_distortionType"),o=this.gl.getUniformLocation(this.program,"u_resolution");this.gl.uniform1f(e,t),this.gl.uniform1f(i,this.distortionConfig.strength),this.gl.uniform2f(o,this.webglCanvas.width,this.webglCanvas.height),this.gl.uniform1i(r,{wave:0,ripple:1,swirl:2}[this.distortionConfig.distortionType]||0)}applyCanvas2DEffect(t){const e=this.createOutputCanvas(t);if(!e)return null;const{ctx:i}=e;try{const r=i.getImageData(0,0,t.width,t.height),o=this.getAnimationTime();let s;switch(this.distortionConfig.distortionType){case"wave":s=this.applyWaveDistortion(r,this.distortionConfig.strength,o);break;case"ripple":s=this.applyRippleDistortion(r,this.distortionConfig.strength,o);break;case"swirl":s=this.applySwirlDistortion(r,this.distortionConfig.strength,o);break;default:s=r}return i.clearRect(0,0,t.width,t.height),i.putImageData(s,0,0),e.canvas}catch{return null}}applyWaveDistortion(t,e,i){const{data:r,width:o,height:s}=t,a=new Uint8ClampedArray(r.length);for(let l=0;l<s;l++)for(let h=0;h<o;h++){const u=Math.sin(.1*l+3*i)*e*20,d=Math.sin(.1*h+2*i)*e*20,c=Math.round(h-u),g=Math.round(l-d),f=4*(l*o+h);if(c>=0&&c<o&&g>=0&&g<s){const p=4*(g*o+c);a[f]=r[p],a[f+1]=r[p+1],a[f+2]=r[p+2],a[f+3]=r[p+3]}else a[f+3]=0}return new ImageData(a,o,s)}applyRippleDistortion(t,e,i){const{data:r,width:o,height:s}=t,a=new Uint8ClampedArray(r.length),l=o/2,h=s/2;for(let u=0;u<s;u++)for(let d=0;d<o;d++){const c=d-l,g=u-h,f=Math.sqrt(c*c+g*g),p=Math.sin(.2*f-5*i)*e*10,m=Math.atan2(g,c),v=Math.round(d-Math.cos(m)*p),b=Math.round(u-Math.sin(m)*p),y=4*(u*o+d);if(v>=0&&v<o&&b>=0&&b<s){const C=4*(b*o+v);a[y]=r[C],a[y+1]=r[C+1],a[y+2]=r[C+2],a[y+3]=r[C+3]}else a[y+3]=0}return new ImageData(a,o,s)}applySwirlDistortion(t,e,i){const{data:r,width:o,height:s}=t,a=new Uint8ClampedArray(r.length),l=o/2,h=s/2;for(let u=0;u<s;u++)for(let d=0;d<o;d++){const c=d-l,g=u-h,f=Math.sqrt(c*c+g*g),p=Math.atan2(g,c)+f*e*i*.02,m=Math.round(l+f*Math.cos(p)),v=Math.round(h+f*Math.sin(p)),b=4*(u*o+d);if(m>=0&&m<o&&v>=0&&v<s){const y=4*(v*o+m);a[b]=r[y],a[b+1]=r[y+1],a[b+2]=r[y+2],a[b+3]=r[y+3]}else a[b+3]=0}return new ImageData(a,o,s)}afterStageRender(t,e){return this.distortionConfig.strength<=0?e:super.afterStageRender(t,e)}}class mit extends zl{constructor(t,e,i,r,o){var s,a,l,h,u;super(t,e,i,r,o),this.particles=[],this.positionBuffer=null,this.colorBuffer=null,this.particleConfig={effectType:((s=o?.options)===null||s===void 0?void 0:s.effectType)||"gravity",count:((a=o?.options)===null||a===void 0?void 0:a.count)||4e3,size:((l=o?.options)===null||l===void 0?void 0:l.size)||20,strength:((h=o?.options)===null||h===void 0?void 0:h.strength)||1.5,useWebGL:((u=o?.options)===null||u===void 0?void 0:u.useWebGL)===void 0||o.options.useWebGL}}getShaderSources(){return{vertex:`
      attribute vec2 a_position;
      attribute vec4 a_color;
      attribute float a_size;

      uniform vec2 u_resolution;
      uniform float u_time;
      uniform float u_forceStrength;
      uniform int u_effectType;

      varying vec4 v_color;

      void main() {
        // 将像素坐标转换为剪辑空间坐标
        vec2 clipSpace = ((a_position / u_resolution) * 2.0) - 1.0;
        clipSpace.y = -clipSpace.y; // 翻转Y轴

        gl_Position = vec4(clipSpace, 0.0, 1.0);
        gl_PointSize = a_size;
        v_color = a_color;
      }
    `,fragment:`
      precision mediump float;
      varying vec4 v_color;

      void main() {
        // 创建圆形粒子
        vec2 coord = gl_PointCoord - vec2(0.5);
        float distance = length(coord);

        if (distance > 0.5) {
          discard;
        }

        // 保持原始颜色，只调整透明度渐变
        gl_FragColor = vec4(v_color.rgb, v_color.a);
      }
    `}}applyWebGLEffect(t){if(!this.gl||!this.program||!this.webglCanvas)return null;this.setupWebGLState(t),this.particles.length===0&&this.extractParticles(t),this.updateParticles(t);const e=this.gl;return e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.useProgram(this.program),this.prepareAndDrawParticles(e),this.webglCanvas}applyCanvas2DEffect(t){const e=this.createOutputCanvas(t);if(!e)return null;const{canvas:i,ctx:r}=e,o=this.currentAnimationRatio;switch(this.particleConfig.effectType){case"explode":this.applyCanvas2DExplode(r,t,o);break;case"gravity":this.applyCanvas2DGravity(r,t,o);break;case"vortex":this.applyCanvas2DVortex(r,t,o);break;default:r.globalAlpha=Math.max(0,1-o),r.drawImage(t,0,0)}return i}extractParticles(t){const e=Ee.createTempCanvas(t.width,t.height,1),i=e.getContext("2d");if(!i)return;i.drawImage(t,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height).data;this.particles=[];const o=Math.max(1,Math.floor(Math.sqrt(e.width*e.height/(1.5*this.particleConfig.count))));for(let s=0;s<e.height;s+=o)for(let a=0;a<e.width;a+=o){const l=4*(s*e.width+a),h=r[l],u=r[l+1],d=r[l+2],c=r[l+3];if(c>5){const g=a/e.width*t.width,f=s/e.height*t.height,p={x:g,y:f,originX:g,originY:f,vx:0,vy:0,r:h/255,g:u/255,b:d/255,a:Math.max(.6,c/255),life:1,size:this.particleConfig.size*(1+.5*Math.random())};this.particles.push(p)}}}updateParticles(t){const e=t.width/2,i=t.height/2,r=this.currentAnimationRatio,o=this.getDurationFromParent(),s=o<2e3,a=s?Math.max(1.5,3e3/o):1,l=s?Math.min(2,2e3/o):1;this.particles.forEach((h=>{const u=h.x-e,d=h.y-i,c=Math.sqrt(u*u+d*d),g=Math.atan2(d,u);this.applyParticleForces(h,g,c,r,l,t),this.updateParticleProperties(h,r,s,a,l)}))}applyParticleForces(t,e,i,r,o,s){const a=this.getAnimationTime();switch(this.particleConfig.effectType){case"explode":const l=r*this.particleConfig.strength*o*5;t.vx+=Math.cos(e)*l,t.vy+=Math.sin(e)*l;break;case"gravity":this.applyGravityEffect(t,r,o,s,a);break;case"vortex":this.applyVortexEffect(t,r,o,s,e,i)}}applyGravityEffect(t,e,i,r,o){const s=(t.originX+.7*t.originY)/(r.width+r.height)*.8;if(e>s){const a=(e-s)/(1-s),l=this.particleConfig.strength*a*a*12*i;t.vy+=l;const h=Math.sin(3*o+.02*t.originX)*Math.cos(2*o+.015*t.originY);t.vx+=h*this.particleConfig.strength*2*i}}applyVortexEffect(t,e,i,r,o,s){const a=r.width/2,l=r.height/2,h=o+e*Math.PI*.8,u=s+e*Math.max(r.width,r.height)*.7*1.8,d=a+Math.cos(h)*u,c=l+Math.sin(h)*u,g=e*this.particleConfig.strength*.08*i;t.vx+=(d-t.x)*g,t.vy+=(c-t.y)*g}updateParticleProperties(t,e,i,r,o){const s=i?.99:.98;if(t.vx*=s,t.vy*=s,t.x+=t.vx,t.y+=t.vy,i){const a=Math.max(.1,.5/r);t.life=Math.max(0,1-e*a),t.a=Math.max(.2,t.life*Math.min(1,1.2*t.a)),t.size=Math.max(.7*this.particleConfig.size,this.particleConfig.size*(.5+.5*t.life))}else t.life=Math.max(0,1-.2*e),t.a=Math.max(.1,t.life*Math.min(1,1.5*t.a)),t.size=Math.max(.5*this.particleConfig.size,this.particleConfig.size*(.3+.7*t.life))}prepareAndDrawParticles(t){const e=new Float32Array(2*this.particles.length),i=new Float32Array(4*this.particles.length),r=new Float32Array(this.particles.length);this.particles.forEach(((o,s)=>{e[2*s]=o.x,e[2*s+1]=o.y,i[4*s]=o.r,i[4*s+1]=o.g,i[4*s+2]=o.b,i[4*s+3]=Math.max(.1,o.a),r[s]=Math.max(6,1.5*o.size)})),this.updateParticleBuffers(t,e,i,r),this.setParticleUniforms(t),t.drawArrays(t.POINTS,0,this.particles.length),this.cleanupTempBuffers(t)}updateParticleBuffers(t,e,i,r){this.positionBuffer||(this.positionBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.bufferData(t.ARRAY_BUFFER,e,t.DYNAMIC_DRAW);const o=t.getAttribLocation(this.program,"a_position");t.enableVertexAttribArray(o),t.vertexAttribPointer(o,2,t.FLOAT,!1,0,0),this.colorBuffer||(this.colorBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,i,t.DYNAMIC_DRAW);const s=t.getAttribLocation(this.program,"a_color");t.enableVertexAttribArray(s),t.vertexAttribPointer(s,4,t.FLOAT,!1,0,0);const a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,r,t.DYNAMIC_DRAW);const l=t.getAttribLocation(this.program,"a_size");t.enableVertexAttribArray(l),t.vertexAttribPointer(l,1,t.FLOAT,!1,0,0),this._tempSizeBuffer=a}setParticleUniforms(t){const e=t.getUniformLocation(this.program,"u_resolution"),i=t.getUniformLocation(this.program,"u_time"),r=t.getUniformLocation(this.program,"u_forceStrength"),o=t.getUniformLocation(this.program,"u_effectType");t.uniform2f(e,this.webglCanvas.width,this.webglCanvas.height),t.uniform1f(i,this.getAnimationTime()),t.uniform1f(r,this.particleConfig.strength),t.uniform1i(o,{explode:0,vortex:1,gravity:2}[this.particleConfig.effectType]||0)}cleanupTempBuffers(t){const e=this._tempSizeBuffer;e&&(t.deleteBuffer(e),delete this._tempSizeBuffer)}applyCanvas2DExplode(t,e,i){const r=e.width/2,o=e.height/2;t.save(),t.globalAlpha=Math.max(0,1-i),t.translate(r,o);const s=1+.5*i;t.scale(s,s),t.translate(-r,-o),t.drawImage(e,0,0),t.restore()}applyCanvas2DGravity(t,e,i){t.save(),t.globalAlpha=Math.max(0,1-i);const r=i*e.height*.3;t.drawImage(e,0,r),t.restore()}applyCanvas2DVortex(t,e,i){const r=e.width/2,o=e.height/2;t.save(),t.globalAlpha=Math.max(0,1-i),t.translate(r,o),t.rotate(i*Math.PI*2),t.translate(-r,-o),t.drawImage(e,0,0),t.restore()}}class vit extends cit{constructor(t,e,i,r,o){var s,a;super(t,e,i,r,o),this.glitchConfig={effectType:((s=o?.options)===null||s===void 0?void 0:s.effectType)||"rgb-shift",intensity:((a=o?.options)===null||a===void 0?void 0:a.intensity)!==void 0?o.options.intensity:.5}}applyCanvas2DEffect(t){if(this.glitchConfig.intensity<=0){const e=this.createOutputCanvas(t);return e?e.canvas:null}try{switch(this.glitchConfig.effectType){case"rgb-shift":default:return this.applyRGBShiftGlitch(t);case"digital-distortion":return this.applyDigitalDistortionGlitch(t);case"scan-lines":return this.applyScanLineGlitch(t);case"data-corruption":return this.applyDataCorruptionGlitch(t)}}catch{return null}}applyRGBShiftGlitch(t){const e=this.createOutputCanvas(t);if(!e)return null;const{ctx:i}=e;try{i.clearRect(0,0,t.width,t.height);const r=Ee.calculateDynamicStrength(this.glitchConfig.intensity,this.getAnimationTime()),o=Math.floor(20*r),s=this.generateRandomOffset(o),a=this.generateRandomOffset(o,.3),l=this.generateRandomOffset(-o),h=Ee.createTempCanvas(t.width,t.height),u=h.getContext("2d");u.drawImage(t,0,0);const d=u.getImageData(0,0,t.width,t.height),c=Ee.extractChannel(d,0),g=Ee.extractChannel(d,1),f=Ee.extractChannel(d,2);return i.globalCompositeOperation="screen",u.clearRect(0,0,t.width,t.height),u.putImageData(c,0,0),i.drawImage(h,s.x,s.y),u.clearRect(0,0,t.width,t.height),u.putImageData(g,0,0),i.drawImage(h,a.x,a.y),u.clearRect(0,0,t.width,t.height),u.putImageData(f,0,0),i.drawImage(h,l.x,l.y),i.globalCompositeOperation="source-over",e.canvas}catch{return null}}applyDigitalDistortionGlitch(t){const e=this.createOutputCanvas(t);if(!e)return null;const{ctx:i}=e;try{const r=i.getImageData(0,0,t.width,t.height),o=Ee.calculateDynamicStrength(this.glitchConfig.intensity,this.getAnimationTime()),s=this.processDigitalDistortion(r,o);return i.clearRect(0,0,t.width,t.height),i.putImageData(s,0,0),e.canvas}catch{return null}}applyScanLineGlitch(t){const e=this.createOutputCanvas(t);if(!e)return null;const{ctx:i}=e;try{const r=Ee.calculateDynamicStrength(this.glitchConfig.intensity,this.getAnimationTime()),o=Math.max(2,Math.floor(10-8*r));i.globalCompositeOperation="multiply";for(let a=0;a<t.height;a+=o)if(Math.random()<r){const l=.1+.4*r;i.fillStyle=`rgba(0, 0, 0, ${l})`,i.fillRect(0,a,t.width,1)}i.globalCompositeOperation="screen";const s=Math.floor(20*r);for(let a=0;a<s;a++){const l=Math.random()*t.height,h=.3*r;i.fillStyle=`rgba(255, 255, 255, ${h})`,i.fillRect(0,Math.floor(l),t.width,1)}return i.globalCompositeOperation="source-over",e.canvas}catch{return null}}applyDataCorruptionGlitch(t){const e=this.createOutputCanvas(t);if(!e)return null;const{ctx:i}=e;try{const r=i.getImageData(0,0,t.width,t.height),o=Ee.calculateDynamicStrength(this.glitchConfig.intensity,this.getAnimationTime()),s=this.processDataCorruption(r,o);return i.clearRect(0,0,t.width,t.height),i.putImageData(s,0,0),e.canvas}catch{return null}}generateRandomOffset(t,e=1){return{x:(Math.random()-.5)*t,y:(Math.random()-.5)*t*e}}processDigitalDistortion(t,e){const{data:i,width:r,height:o}=t,s=new Uint8ClampedArray(i),a=Math.floor(20*e)+5,l=Math.floor(o/a);for(let u=0;u<a;u++)if(Math.random()<e){const d=u*l,c=Math.min(d+l,o),g=Math.floor((Math.random()-.5)*r*e*.1);this.shiftSliceHorizontal(s,r,o,d,c,g)}const h=.3*e;for(let u=0;u<i.length;u+=4)Math.random()<h&&(s[u]=255*Math.random(),s[u+1]=255*Math.random(),s[u+2]=255*Math.random());return new ImageData(s,r,o)}shiftSliceHorizontal(t,e,i,r,o,s){const a=new Uint8ClampedArray(4*e);for(let l=r;l<o;l++){const h=l*e*4;for(let u=0;u<4*e;u++)a[u]=t[h+u];for(let u=0;u<e;u++){const d=h+4*u,c=4*((u-s+e)%e);t[d]=a[c],t[d+1]=a[c+1],t[d+2]=a[c+2],t[d+3]=a[c+3]}}}processDataCorruption(t,e){const{data:i,width:r,height:o}=t,s=new Uint8ClampedArray(i),a=Math.floor(15*e)+5;for(let h=0;h<a;h++)if(Math.random()<e){const u=Math.floor(Math.random()*r),d=Math.floor(5*Math.random())+1,c=Math.random()<.5?0:255;for(let g=0;g<o;g++)for(let f=0;f<d&&u+f<r;f++){const p=4*(g*r+u+f);s[p]=c,s[p+1]=c,s[p+2]=c}}const l=Math.floor(20*e);for(let h=0;h<l;h++){const u=Math.floor(Math.random()*r),d=Math.floor(Math.random()*o),c=Math.floor(20*Math.random())+5,g=Math.floor(10*Math.random())+2;this.corruptBlock(s,r,o,u,d,c,g)}return new ImageData(s,r,o)}corruptBlock(t,e,i,r,o,s,a){for(let l=0;l<a&&o+l<i;l++)for(let h=0;h<s&&r+h<e;h++){const u=4*((o+l)*e+(r+h));Math.random()<.7&&(t[u]=255*Math.random(),t[u+1]=255*Math.random(),t[u+2]=255*Math.random())}}}class bit extends IH{constructor(t,e,i,r,o){var s,a;super(t,e,i,r,o),this.blurConfig={blurRadius:((s=o?.options)===null||s===void 0?void 0:s.blurRadius)||8,useOptimizedBlur:((a=o?.options)===null||a===void 0?void 0:a.useOptimizedBlur)===void 0||o.options.useOptimizedBlur}}applyCSSBlur(t,e){const i=Bt.createCanvas({width:t.width,height:t.height,dpr:Bt.devicePixelRatio}),r=i.getContext("2d");return r?(r.filter=`blur(${e}px)`,r.drawImage(t,0,0),r.filter="none",i):t}applyDownsampleBlur(t,e){const{width:i,height:r}=t,o=Math.max(1,Math.floor(e/2)),s=Math.floor(i/o),a=Math.floor(r/o),l=Bt.createCanvas({width:s,height:a,dpr:1}),h=l.getContext("2d");if(!h)return t;const u=Bt.createCanvas({width:i,height:r,dpr:1}),d=u.getContext("2d");return d?(d.putImageData(t,0,0),h.drawImage(u,0,0,s,a),h.filter=`blur(${e/o}px)`,h.drawImage(l,0,0),h.filter="none",d.clearRect(0,0,i,r),d.drawImage(l,0,0,i,r),d.getImageData(0,0,i,r)):t}afterStageRender(t,e){if(this.blurConfig.blurRadius<=0)return e;let i;if(this.blurConfig.useOptimizedBlur)i=this.applyCSSBlur(e,this.blurConfig.blurRadius);else{const o=Bt.createCanvas({width:e.width,height:e.height,dpr:Bt.devicePixelRatio}),s=o.getContext("2d");if(!s)return!1;s.clearRect(0,0,e.width,e.height),s.drawImage(e,0,0);const a=s.getImageData(0,0,e.width,e.height),l=this.applyDownsampleBlur(a,this.blurConfig.blurRadius);s.putImageData(l,0,0),i=o}const r=i.getContext("2d");return r&&(r.globalCompositeOperation="overlay",r.fillStyle="rgba(255, 255, 255, 0.1)",r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="source-over"),i}}class yit extends cg{constructor(t,e,i,r,o){var s,a;super(t,e,i,r,o),this.pixelationConfig={maxPixelSize:((s=o?.options)===null||s===void 0?void 0:s.maxPixelSize)||20,method:((a=o?.options)===null||a===void 0?void 0:a.method)||"out"}}applyDownsamplePixelation(t,e){if(e<=1)return t;const{width:i,height:r}=t,o=Math.ceil(i/e),s=Math.ceil(r/e),a=Bt.createCanvas({width:o,height:s,dpr:1}),l=a.getContext("2d");if(!l)return t;const h=Bt.createCanvas({width:i,height:r,dpr:Bt.devicePixelRatio}),u=h.getContext("2d");return u?(l.imageSmoothingEnabled=!1,u.imageSmoothingEnabled=!1,l.drawImage(t,0,0,o,s),u.drawImage(a,0,0,i,r),h):t}updateAnimationProgress(){return this.pixelationConfig.method==="in"?this.pixelationConfig.maxPixelSize-this.currentAnimationRatio*(this.pixelationConfig.maxPixelSize-1):1+this.currentAnimationRatio*(this.pixelationConfig.maxPixelSize-1)}afterStageRender(t,e){const i=this.updateAnimationProgress();return i<=1?e:this.applyDownsamplePixelation(e,i)}}const Cit=()=>{yt.registerBuiltInAnimate("increaseCount",jtt),yt.registerBuiltInAnimate("fromTo",uit),yt.registerBuiltInAnimate("scaleIn",Get),yt.registerBuiltInAnimate("scaleOut",$et),yt.registerBuiltInAnimate("growHeightIn",aet),yt.registerBuiltInAnimate("growHeightOut",det),yt.registerBuiltInAnimate("growWidthIn",Oet),yt.registerBuiltInAnimate("growWidthOut",Iet),yt.registerBuiltInAnimate("growCenterIn",iet),yt.registerBuiltInAnimate("growCenterOut",net),yt.registerBuiltInAnimate("clipIn",Vtt),yt.registerBuiltInAnimate("clipOut",Gtt),yt.registerBuiltInAnimate("fadeIn",$tt),yt.registerBuiltInAnimate("fadeOut",Utt),yt.registerBuiltInAnimate("growPointsIn",get),yt.registerBuiltInAnimate("growPointsOut",fet),yt.registerBuiltInAnimate("growPointsXIn",met),yt.registerBuiltInAnimate("growPointsXOut",vet),yt.registerBuiltInAnimate("growPointsYIn",yet),yt.registerBuiltInAnimate("growPointsYOut",Cet),yt.registerBuiltInAnimate("growAngleIn",Jtt),yt.registerBuiltInAnimate("growAngleOut",Qtt),yt.registerBuiltInAnimate("growRadiusIn",Tet),yt.registerBuiltInAnimate("growRadiusOut",Ret),yt.registerBuiltInAnimate("moveIn",nit),yt.registerBuiltInAnimate("moveOut",rit),yt.registerBuiltInAnimate("rotateIn",ait),yt.registerBuiltInAnimate("rotateOut",lit),yt.registerBuiltInAnimate("update",tit),yt.registerBuiltInAnimate("state",Uet),yt.registerBuiltInAnimate("labelItemAppear",Het),yt.registerBuiltInAnimate("labelItemDisappear",Det),yt.registerBuiltInAnimate("poptipAppear",Fet),yt.registerBuiltInAnimate("poptipDisappear",zet),yt.registerBuiltInAnimate("inputText",Hc),yt.registerBuiltInAnimate("inputRichText",Net),yt.registerBuiltInAnimate("outputRichText",Wet),yt.registerBuiltInAnimate("slideRichText",jet),yt.registerBuiltInAnimate("slideOutRichText",Vet),yt.registerBuiltInAnimate("slideIn",Fx),yt.registerBuiltInAnimate("growIn",VH),yt.registerBuiltInAnimate("spinIn",GH),yt.registerBuiltInAnimate("moveScaleIn",qet),yt.registerBuiltInAnimate("moveRotateIn",Ket),yt.registerBuiltInAnimate("strokeIn",Xet),yt.registerBuiltInAnimate("slideOut",zx),yt.registerBuiltInAnimate("growOut",$H),yt.registerBuiltInAnimate("spinOut",UH),yt.registerBuiltInAnimate("moveScaleOut",Zet),yt.registerBuiltInAnimate("moveRotateOut",Jet),yt.registerBuiltInAnimate("strokeOut",Yet),yt.registerBuiltInAnimate("pulse",Qet),yt.registerBuiltInAnimate("MotionPath",hit),yt.registerBuiltInAnimate("streamLight",dit),yt.registerBuiltInAnimate("dissolve",git),yt.registerBuiltInAnimate("grayscale",fit),yt.registerBuiltInAnimate("distortion",pit),yt.registerBuiltInAnimate("particle",mit),yt.registerBuiltInAnimate("glitch",vit),yt.registerBuiltInAnimate("gaussianBlur",bit),yt.registerBuiltInAnimate("pixelation",yit)};class _it extends Fu{onBind(){var t;const e=zu(this.target);this._animator=e;const i=this.duration,r=this.easing,{config:o,lastScale:s,getTickCoord:a}=this.params;let l=1;const h=this.target.data;if(s&&a&&h){l=.7;const u=a(s.scale(h.rawValue)),d=this.target.attribute.x,c=this.target.attribute.y;this.target.setAttributes({x:u.x,y:u.y}),e.animate(this.target,{type:"to",to:{x:d,y:c},duration:i,easing:r})}e.animate(this.target,{type:(t=o.type)!==null&&t!==void 0?t:"fadeIn",to:o.to,duration:i*l,easing:r}),this.completeBind(e)}}class wit extends Fu{onBind(){const t=zu(this.target);this._animator=t;const e=this.duration,i=this.easing,{config:r,diffAttrs:o}=this.params;t.animate(this.target,{type:"to",to:Object.assign({},o),duration:e,easing:i,customParameters:{diffAttrs:Object.assign({},o)}}),this.completeBind(t)}deleteSelfAttr(t){super.deleteSelfAttr(t),this._animator.deleteSelfAttr(t)}tryPreventConflict(){}}function xit(){yt.registerBuiltInAnimate("axisEnter",_it),yt.registerBuiltInAnimate("axisUpdate",wit)}function Sit(){$n(),Px(),_v(),Uo(),xit()}function Ait(){Sit(),Os()}var rB=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};Ait();class Dc extends ftt{constructor(t,e){super(e?.skipDefault?t:Lt({},Dc.defaultAttributes,t),e)}_renderInner(t){var e;if(this._breaks=null,this.attribute.breaks&&this.attribute.breaks.length){const r=[];for(let o=0;o<this.attribute.breaks.length;o++){const s=this.attribute.breaks[o],{range:a,breakSymbol:l,rawRange:h}=s;r.push({startPoint:this.getTickCoord(a[0]),endPoint:this.getTickCoord(a[1]),range:a,breakSymbol:l,rawRange:h})}this._breaks=r}super._renderInner(t),this._breaks&&this._breaks.length&&this._breaks.forEach(((r,o)=>{const{startPoint:s,endPoint:a,breakSymbol:l,rawRange:h}=r;if(l?.visible!==!1){const u=At.group({zIndex:ett});u.name=an.axisBreak,u.id=this._getNodeId(`${an.axisBreak}-${o}`),u.data=h;const d=stt(l),c=At.symbol(Object.assign({x:s.x,y:s.y},d));c.name=an.axisBreakSymbol;const g=At.symbol(Object.assign({x:a.x,y:a.y},d));g.name=an.axisBreakSymbol,u.add(c),u.add(g),t.add(u)}}));const{panel:i}=this.attribute;if(i&&i.visible){const r=this.axisContainer,o=r.AABBBounds,s=At.rect(Object.assign({x:o.x1,y:o.y1,width:o.width(),height:o.height()},i.style));s.name=an.background,s.id=this._getNodeId("background"),s.states=Lt({},ih,(e=i.state)!==null&&e!==void 0?e:{}),r.insertBefore(s,r.firstChild)}}renderLine(t){const{start:e,end:i,line:r}=this.attribute,o=r,{startSymbol:s,endSymbol:a,style:l,state:h}=o,u=rB(o,["startSymbol","endSymbol","style","state"]),d=Object.assign({startSymbol:s,endSymbol:a,lineStyle:l},u);if(this._breaks&&this._breaks.length){const g=[];let f=e;this._breaks.forEach((p=>{const{startPoint:m,endPoint:v}=p;g.push([f,m]),f=v})),g.push([f,i]),d.points=g,d.multiSegment=!0}else d.points=[e,i];Re(h)||(d.state={line:Lt({},ih,h),symbol:Lt({},ih,h)});const c=new xv(d);c.name=an.line,c.id=this._getNodeId("line"),t.add(c)}getTextAlign(t){let e="center";return cl(t[0],0)?cl(t[1],0)?Object.is(t[1],-0)?e="start":Object.is(t[0],-0)&&(e="end"):e="center":t[0]>0?e="start":t[0]<0&&(e="end"),e}getTitleAttribute(){var t,e,i;const r=this.attribute.title,{position:o="middle",space:s=4,textStyle:a={},autoRotate:l=!0,shape:h,background:u,state:d={},maxWidth:c}=r,g=rB(r,["position","space","textStyle","autoRotate","shape","background","state","maxWidth"]);let f=.5;o==="start"?f=0:o==="end"&&(f=1);const{verticalFactor:p=1}=this.attribute,m=-1*p,v=this.getTickCoord(f),b=this.getRelativeVector();let y=0;if(!((t=this.attribute.label)===null||t===void 0)&&t.visible&&this.attribute.label.inside===!1){const E=+Bn(this.attribute,"label.space",4);y+=E;const P=Object.keys(this.axisLabelLayerSize).length;if(b[1]===0){const B=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.height():0;isFinite(B)?y+=B+(P-1)*E:y=0}else if(b[0]===0)if(this.axisLabelsContainer&&this.axisLabelsContainer.AABBBounds&&!this.axisLabelsContainer.AABBBounds.empty()){const B=this.axisLabelLayerSize[0].labelPos,k=this.axisLabelsContainer.AABBBounds;y+=(m===1?k.x2>B?Math.min(k.x2-B,k.width()):0:k.x1<B?Math.min(B-k.x1,k.width()):0)+(P-1)*E}else y=0;else Object.keys(this.axisLabelLayerSize).forEach(((B,k)=>{y+=this.axisLabelLayerSize[B].width+(k>0?E:0)}))}let C=0;!((e=this.attribute.tick)===null||e===void 0)&&e.visible&&this.attribute.tick.inside===!1&&(C=this.attribute.tick.length||4),!((i=this.attribute.subTick)===null||i===void 0)&&i.visible&&this.attribute.subTick.inside===!1&&(C=Math.max(C,this.attribute.subTick.length||2));const w=C+y+s,_=this.getVerticalCoord(v,w,!1),A=this.getVerticalVector(w,!1,{x:0,y:0});let x,S,{angle:T}=g;if(x=o==="start"?"start":o==="end"?"end":"center",jt(T)&&l){T=jQ(b,[1,0],!0);const{verticalFactor:E=1}=this.attribute;S=-1*E===1?"bottom":"top"}else x=this.getTextAlign(A),S=this.getTextBaseline(A,!1);let M=c;if(jt(M)){const{verticalLimitSize:E,verticalMinSize:P,orient:B}=this.attribute,k=Math.min(E||1/0,P||1/0);if(pi(k))if(B==="bottom"||B==="top")if(T!==Math.PI/2){const L=Math.abs(Math.cos(T??0));M=L<1e-6?1/0:this.attribute.end.x/L}else M=k-w;else if(T&&T!==0){const L=Math.abs(Math.sin(T));M=L<1e-6?1/0:this.attribute.end.y/L}else M=k-w}const R=Object.assign(Object.assign(Object.assign({},_),g),{maxWidth:M,textStyle:Object.assign({textAlign:x,textBaseline:S},a),state:{text:Lt({},ih,d.text),shape:Lt({},ih,d.shape),panel:Lt({},ih,d.background)}});return R.angle=T,h&&h.visible&&(R.shape=Object.assign({visible:!0},h.style),h.space&&(R.space=h.space)),u&&u.visible&&(R.panel=Object.assign({visible:!0},u.style)),R}getTextBaseline(t,e){let i="middle";const{verticalFactor:r=1}=this.attribute,o=(e?1:-1)*r;return cl(t[1],0)?i=!cl(t[0],0)||Object.is(t[0],-0)||Object.is(t[1],-0)?"middle":o===1?"bottom":"top":t[1]>0?i="top":t[1]<0&&(i="bottom"),i}getLabelAlign(t,e,i){const r=this.attribute.orient;if(["top","bottom","right","left"].includes(r)||t[0]===0&&t[1]===0){if(r==="top"||r==="bottom")return kH(e?r==="bottom"?"top":"bottom":r,i);if(r==="left"||r==="right")return PH(e?r==="left"?"right":"left":r,i)}return{textAlign:this.getTextAlign(t),textBaseline:this.getTextBaseline(t,e)}}beforeLabelsOverlap(t,e,i,r,o){var s,a,l,h;const{flush:u=!1}=this.attribute.label||{};if(u&&t.length){const{orient:d,start:c,end:g}=this.attribute,f=d==="bottom"||d==="top",p=t[0],m=yh(t),v=f?p.attribute.x>m.attribute.x:p.attribute.y<m.attribute.y;if(f){const b=v?m:p,y=v?p:m,C=c.x,w=g.x,_=b.AABBBounds.x1,A=y.AABBBounds.x2;_<C&&(b.attribute.angle?b.setAttributes({dx:((s=b.attribute.dx)!==null&&s!==void 0?s:0)+C-_}):b.setAttributes({x:C,textAlign:"left"})),A>w&&(y.attribute.angle?y.setAttributes({dx:((a=y.attribute.dx)!==null&&a!==void 0?a:0)+w-A}):y.setAttributes({x:w,textAlign:"right"}))}else{const b=v?m:p,y=v?p:m,C=b.AABBBounds.y2,w=y.AABBBounds.y1,_=c.y,A=g.y;w<_&&(y.attribute.angle?y.setAttributes({dy:((l=y.attribute.dy)!==null&&l!==void 0?l:0)+_-w}):y.setAttributes({y:_,textBaseline:"top"})),C>A&&(b.attribute.angle?b.setAttributes({dy:((h=b.attribute.dy)!==null&&h!==void 0?h:0)+A-C}):b.setAttributes({y:A,textBaseline:"bottom"}))}}}handleLabelsOverlap(t,e,i,r,o){if(Re(t))return;const{verticalLimitSize:s,label:a,orient:l}=this.attribute,h=this._getAxisLabelLimitLength(s,o),{layoutFunc:u,autoRotate:d,autoRotateAngle:c,autoLimit:g,limitEllipsis:f,autoHide:p,autoHideMethod:m,autoHideSeparation:v,lastVisible:b,firstVisible:y,autoWrap:C,overflowLimitLength:w}=a;if(ai(u))u(t,e,r,this);else{if(d)btt(t,{labelRotateAngle:c,orient:l});else if(C){const _=Math.abs(l==="left"||l==="right"?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x);Att(t,{orient:l,limitLength:h,axisLength:_,ellipsis:f})}if(!C&&g&&pi(h)&&h>0){const _=l==="left"||l==="right",A=Math.abs(_?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x),x=_?A/t.length:p||d?1/0:A/t.length;Stt(t,{limitLength:h,verticalLimitLength:x,ellipsis:f,orient:l,axisLength:A,overflowLimitLength:w})}p&&vtt(t,{method:m,separation:v,lastVisible:b,firstVisible:y})}}afterLabelsOverlap(t,e,i,r,o){const{verticalLimitSize:s,orient:a}=this.attribute,l=a==="bottom"||a==="top",h=i.AABBBounds;let u=l?h.height():h.width();const{verticalMinSize:d}=this.attribute;if(pi(d)&&(!pi(s)||d<=s)){const c=this._getAxisLabelLimitLength(d,o);let g,f;u=Math.max(u,c),a==="left"?(g=h.x2-u,f=h.y1):a==="right"?(g=h.x1,f=h.y1):a==="top"?(g=h.x1,f=h.y2-u):a==="bottom"&&(g=h.x1,f=h.y1);const p=At.rect({x:g,y:f,width:l?h.width():u,height:l?u:h.height(),pickable:!1});p.name=an.axisLabelBackground,p.id=this._getNodeId("axis-label-background"),i.insertBefore(p,i.firstChild)}if(_t(this.attribute.label.containerAlign)){let c;a==="left"?c=h.x2-u:a==="right"?c=h.x1:a==="top"?c=h.y2-u:a==="bottom"&&(c=h.y1),Mtt(t,c,u,a,this.attribute.label.containerAlign)}}_getAxisLabelLimitLength(t,e){var i,r,o,s,a;const{label:l,title:h,line:u,tick:d}=this.attribute,c=(i=l.space)!==null&&i!==void 0?i:4;let g=t,f=0,p=0;const m=u&&u.visible?(r=u.style.lineWidth)!==null&&r!==void 0?r:1:0,v=d&&d.visible?(o=d.length)!==null&&o!==void 0?o:4:0;if(h&&h.visible&&typeof h.text=="string"){f=wv(h.text,h.textStyle,(a=(s=this.stage)===null||s===void 0?void 0:s.getTheme())===null||a===void 0?void 0:a.text).height;const b=No(h.padding);p=h.space+b[0]+b[2]}return g&&(g=(g-c-p-f-m-v)/e),g}release(){super.release(),this._breaks=null}}Dc.defaultAttributes=Hw,JK(Dc,Ttt);const xs=n=>n.map(((t,e)=>({index:e,value:t}))),oB=(n,t,e=0)=>{const i=new Ic(n).expand(e/2),r=new Ic(t).expand(e/2);return i.intersects(r)},sB=12,cf=(n,t,e,i)=>e<n?Math.max(n-t/2,e):e>n?Math.min(n-t/2,e-t):e<i?e:e-t,zw=(n,t,e)=>{var i,r,o;const{labelStyle:s,axisOrientType:a,labelFlush:l,labelFormatter:h,startAngle:u=0}=e;let d=(i=s.angle)!==null&&i!==void 0?i:0;s.direction==="vertical"&&(d+=gl(90));const c=["bottom","top"].includes(a),g=["left","right"].includes(a);let f=1,p=0;c||(g?(f=0,p=1):u&&(f=Math.cos(u),p=-Math.sin(u)));const m=yH(s),v=n.range();let b=[];for(let y=0;y<t.length;y++){const C=t[y],w=h?h(C):`${C}`;if(zd(w)){b=void 0;break}const{width:_,height:A}=m.quickMeasure(w),x=Math.max(_,12),S=Math.max(A,12),T=n.scale(C),M=f*T,R=p*T;let E,P,B=M,k=R;l&&c&&y===0?B=cf(M,x,v[0],v[v.length-1]):l&&c&&y===t.length-1?B=cf(M,x,v[v.length-1],v[0]):E=(r=s.textAlign)!==null&&r!==void 0?r:"center",E==="right"?B-=x:E==="center"&&(B-=x/2),l&&g&&y===0?k=cf(R,S,v[0],v[v.length-1]):l&&g&&y===t.length-1?k=cf(R,S,v[v.length-1],v[0]):P=(o=s.textBaseline)!==null&&o!==void 0?o:"middle",P==="bottom"?k-=S:P==="middle"&&(k-=S/2);const L=new Ic().set(B,k,B+x,k+S);d&&L.rotate(d,M,R),b.push(L)}return b},Mit=n=>["bottom","top","z"].includes(n);var tr;(function(n){n.Identity="identity",n.Linear="linear",n.Log="log",n.Pow="pow",n.Sqrt="sqrt",n.Symlog="symlog",n.Time="time",n.Quantile="quantile",n.Quantize="quantize",n.Threshold="threshold",n.Ordinal="ordinal",n.Point="point",n.Band="band"})(tr||(tr={}));Object.values(tr).forEach((n=>{}));function qH(n){switch(n){case tr.Linear:case tr.Log:case tr.Pow:case tr.Sqrt:case tr.Symlog:case tr.Time:return!0;default:return!1}}function Tit(n){switch(n){case tr.Ordinal:case tr.Point:case tr.Band:return!0;default:return!1}}function sd(n){return n}function Nw(n,t){if(n=Number(n),t=Number(t),t-=n)return i=>(i-n)/t;const e=Number.isNaN(t)?NaN:.5;return()=>e}function aB(n,t,e){const i=n[0],r=n[1],o=t[0],s=t[1];let a,l;return r<i?(a=Nw(r,i),l=e(s,o)):(a=Nw(i,r),l=e(o,s)),h=>l(a(h))}function Rit(n,t){const e=(n[1]-n[0])/(t[1]-t[0]),i=n[0]-e*t[0];return[i,e+i]}function Bit(n,t,e){const i=Math.min(n.length,t.length)-1,r=new Array(i),o=new Array(i);let s=-1;for(n[i]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++s<i;)r[s]=Nw(n[s],n[s+1]),o[s]=e(t[s],t[s+1]);return function(a){const l=iZ(n,a,1,i)-1;return o[l](r[l](a))}}let kit=class{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:_t(this._rangeFactorStart)&&_t(this._rangeFactorEnd)&&t.length===2?(this._wholeRange=Rit(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(t.length===2&&t.every((r=>r>=0&&r<=1))&&(this._wholeRange=null,t[0]===0&&t[1]===1?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):_t(this._rangeFactorStart)&&_t(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return jt(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!jt(this._rangeFactorEnd)&&this._rangeFactorEnd!==1?(this._rangeFactorStart=t,this._rangeFactorEnd=(i=this._rangeFactorEnd)!==null&&i!==void 0?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return jt(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!jt(this._rangeFactorStart)&&this._rangeFactorStart!==0?(this._rangeFactorEnd=t,this._rangeFactorStart=(i=this._rangeFactorStart)!==null&&i!==void 0?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:r}=this._fishEyeOptions,o=this.range(),s=o[0],a=o[o.length-1],l=Math.min(s,a),h=Math.max(s,a),u=Qn((t=this._fishEyeOptions.focus)!==null&&t!==void 0?t:0,l,h),d=jt(r)?(h-l)*i:r;let c=Math.exp(e);c=c/(c-1)*d;const g=e/d;this._fishEyeTransform=f=>{const p=Math.abs(f-u);if(p>=d)return f;if(p<=1e-6)return u;const m=c*(1-Math.exp(-p*g))/p*.75+.25;return u+(f-u)*m}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}get(t,e){var i;return(i=this==null?void 0:this[t])!==null&&i!==void 0?i:e}};const{interpolateRgb:dy}=xZ;function Pit(n,t){const e=typeof t;let i;if(jt(t)||e==="boolean")return()=>t;if(e==="number")return Wf(n,t);if(e==="string"){if(i=Vf.parseColorString(t)){const r=dy(Vf.parseColorString(n),i);return o=>r(o).formatRgb()}return Wf(Number(n),Number(t))}return t instanceof Pn?dy(n,t):t instanceof Vf?dy(n.color,t.color):t instanceof Date?lZ(n,t):Wf(Number(n),Number(t))}let Eit=class extends kit{constructor(t=sd,e=sd){super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=sd,this._piecewise=aB,this._interpolate=Pit}calculateVisibleDomain(t){var e;return _t(this._rangeFactorStart)&&_t(this._rangeFactorEnd)&&t.length===2?[this.invert(t[0]),this.invert(t[1])]:(e=this._niceDomain)!==null&&e!==void 0?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),Wf)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return((i=this._niceDomain)!==null&&i!==void 0?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const r=Array.from(t,eZ);return this._domain=r,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=aZ,this.rescale(e)}rescale(t){var e;if(t)return this;const i=(e=this._niceDomain)!==null&&e!==void 0?e:this._domain,r=i.length,o=this._range.length;let s=Math.min(r,o);if(r&&r<o&&this._forceAlign){const a=o-r+1,l=i[r-1],h=r>=2?(l-i[r-2])/a:0;for(let u=1;u<=a;u++)i[r-2+u]=l-h*(a-u);s=o}return this._autoClamp&&(this._clamp=sZ(i[0],i[s-1])),this._piecewise=s>2?Bit:aB,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:sd),this.rescale(i)):this._clamp!==sd}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(t=10){return[]}tickData(t=10){const e=this.ticks(t);return(e??[]).map(((i,r)=>({index:r,tick:i,value:(this.scale(i)-this._range[0])/(this._range[1]-this._range[0])})))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return jt(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return jt(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}};const Lit=Math.sqrt(50),Oit=Math.sqrt(10),Iit=Math.sqrt(2),gf=[1,2,5,10],lB=(n,t,e)=>{let i=1,r=n;const o=Math.floor((t-1)/2),s=Math.abs(n);return n>=0&&n<=Number.MIN_VALUE?r=0:n<0&&n>=-Number.MIN_VALUE?r=-(t-1):!e&&s<1?i=KH(s).step:(e||s>1)&&(r=Math.floor(n)-o*i),i>0?(n>0?r=Math.max(r,0):n<0&&(r=Math.min(r,-(t-1)*i)),QK(0,t).map((a=>r+a*i))):n>0?I0(0,-(t-1)/i,i):I0((t-1)/i,0,i)},Hit=JI(((n,t,e,i)=>{let r,o,s,a,l=-1;if(e=+e,(n=+n)==(t=+t))return[n];if(Math.abs(n-t)<=Number.MIN_VALUE&&e>0)return[n];if((r=t<n)&&(o=n,n=t,t=o),a=Nx(n,t,e).step,!isFinite(a))return[];if(a>0){let h=Math.round(n/a),u=Math.round(t/a);for(h*a<n&&++h,u*a>t&&--u,s=new Array(o=u-h+1);++l<o;)s[l]=(h+l)*a}else if(a<0&&i?.noDecimals){a=1;const h=Math.ceil(n),u=Math.floor(t);if(!(h<=u))return[];for(s=new Array(o=u-h+1);++l<o;)s[l]=h+l}else{a=-a;let h=Math.round(n*a),u=Math.round(t*a);for(h/a<n&&++h,u/a>t&&--u,s=new Array(o=u-h+1);++l<o;)s[l]=(h+l)/a}return r&&s.reverse(),s})),I0=(n,t,e)=>{let i,r,o=-1;if(e>0){let s=Math.floor(n/e),a=Math.ceil(t/e);for((s+1)*e<n&&++s,(a-1)*e>t&&--a,r=new Array(i=a-s+1);++o<i;)r[o]=(s+o)*e}else{e=-e;let s=Math.floor(n*e),a=Math.ceil(t*e);for((s+1)/e<n&&++s,(a-1)/e>t&&--a,r=new Array(i=a-s+1);++o<i;)r[o]=(s+o)/e}return r},Dit=(n,t,e)=>{let i;const r=n[0],o=n[n.length-1],s=t-n.length;if(o<=0){const h=[];for(i=s;i>=1;i--)h.push(r-i*e);return h.concat(n)}if(r>=0){for(i=1;i<=s;i++)n.push(o+i*e);return n}let a=[];const l=[];for(i=1;i<=s;i++)i%2==0?a=[r-Math.floor(i/2)*e].concat(a):l.push(o+Math.ceil(i/2)*e);return a.concat(n).concat(l)},Fit=JI(((n,t,e,i)=>{let r,o,s;if(e=+e,(n=+n)==(t=+t)||Math.abs(n-t)<=Number.MIN_VALUE&&e>0)return lB(n,e,i?.noDecimals);(r=t<n)&&(s=n,n=t,t=s);const a=Nx(n,t,e);let l=a.step;if(!isFinite(l))return[];if(l>0){let h=1;const{power:u,gap:d}=a,c=d===10?2*10**u:1*10**u;for(;h<=5&&(o=I0(n,t,l),o.length>e+1)&&e>2;)l+=c,h+=1;e>2&&o.length<e-1&&(o=Dit(o,e,l))}else i?.noDecimals&&l<0&&(l=1),o=I0(n,t,l);return r&&o.reverse(),o})),KH=n=>{const t=Math.floor(Math.log(n)/Math.LN10),e=n/10**t;let i=gf[0];return e>=Lit?i=gf[3]:e>=Oit?i=gf[2]:e>=Iit&&(i=gf[1]),t>=0?{step:i*10**t,gap:i,power:t}:{step:-(10**-t)/i,gap:i,power:t}};function Nx(n,t,e){const i=(t-n)/Math.max(0,e);return KH(i)}function zit(n,t,e){let i;if(e=+e,(n=+n)==(t=+t)&&e>0)return[n];if(e<=0||(i=Nit(n,t,e))===0||!isFinite(i))return[];const r=new Array(e);for(let o=0;o<e;o++)r[o]=n+o*i;return r}function Nit(n,t,e){return(t-n)/Math.max(1,e-1)}function Wit(n,t,e){let i,r,o=-1;if(e=+e,(r=(t=+t)<(n=+n))&&(i=n,n=t,t=i),!isFinite(e)||t-n<=e)return[n];const s=Math.floor((t-n)/e+1),a=new Array(s);for(;++o<s;)a[o]=n+o*e;return r&&a.reverse(),a}function cy(n,t=10){let e,i,r=0,o=n.length-1,s=n[r],a=n[o],l=10;for(a<s&&(i=s,s=a,a=i,i=r,r=o,o=i);l-- >0;){if(i=Nx(s,a,t).step,i===e)return n[r]=s,n[o]=a,n;if(i>0)s=Math.floor(s/i)*i,a=Math.ceil(a/i)*i;else{if(!(i<0))break;s=Math.ceil(s*i)/i,a=Math.floor(a*i)/i}e=i}}function jit(n,t){const e=rn(t.forceMin),i=rn(t.forceMax);let r=null;const o=[];let s=null;const a=e&&i?l=>l>=t.forceMin&&l<=t.forceMax:e?l=>l>=t.forceMin:i?l=>l<=t.forceMax:null;return e?o[0]=t.forceMin:rn(t.min)&&t.min<=Math.min(n[0],n[n.length-1])&&(o[0]=t.min),i?o[1]=t.forceMax:rn(t.max)&&t.max>=Math.max(n[0],n[n.length-1])&&(o[1]=t.max),rn(o[0])&&rn(o[1])?(s=n.slice(),s[0]=o[0],s[s.length-1]=o[1]):r=rn(o[0])||rn(o[1])?rn(o[0])?"max":"min":"all",{niceType:r,niceDomain:s,niceMinMax:o,domainValidator:a}}let Vit=class ZH extends Eit{constructor(){super(...arguments),this.type=tr.Linear}clone(){var t;const e=new ZH;return e.domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate),this._niceType&&(e._niceType=this._niceType,e._domainValidator=this._domainValidator,e._niceDomain=(t=this._niceDomain)===null||t===void 0?void 0:t.slice()),e}tickFormat(){return()=>{}}d3Ticks(t=10,e){const i=this.calculateVisibleDomain(this._range);return Hit(i[0],i[i.length-1],t,e)}ticks(t=10,e){var i;if(ai(e?.customTicks))return e.customTicks(this,t);if(_t(this._rangeFactorStart)&&_t(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&this._range.length===2||!this._niceType)return this.d3Ticks(t,e);const r=(i=this._niceDomain)!==null&&i!==void 0?i:this._domain,o=this._domain,s=r[0],a=r[r.length-1];let l=Fit(o[0],o[o.length-1],t,e);if(!l.length)return l;if(this._domainValidator)l=l.filter(this._domainValidator);else if((l[0]!==s||l[l.length-1]!==a)&&this._niceType){const h=r.slice();if(this._niceType==="all"?(h[0]=l[0],h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()):this._niceType==="min"&&l[0]!==s?(h[0]=l[0],this._niceDomain=h,this.rescale()):this._niceType==="max"&&l[l.length-1]!==a&&(h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()),this._niceType!=="all"){const u=Math.min(h[0],h[h.length-1]),d=Math.max(h[0],h[h.length-1]);l=l.filter((c=>c>=u&&c<=d))}}return l}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return zit(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return Wit(e[0],e[e.length-1],t)}nice(t=10,e){var i,r;const o=this._domain;let s=[];if(e){const a=jit(o,e);if(s=a.niceMinMax,this._domainValidator=a.domainValidator,this._niceType=a.niceType,a.niceDomain)return this._niceDomain=a.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const a=cy(o.slice(),t);this._niceType==="min"?a[a.length-1]=(i=s[1])!==null&&i!==void 0?i:a[a.length-1]:this._niceType==="max"&&(a[0]=(r=s[0])!==null&&r!==void 0?r:a[0]),this._niceDomain=a,this.rescale()}return this}niceMin(t=10){this._niceType="min";const e=this._domain[this._domain.length-1],i=cy(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(t=10){this._niceType="max";const e=this._domain[0],i=cy(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}};function gy(n,t,e,i){let r;const{breakData:o}=n;if(o&&o()){const{breakDomains:s}=o(),a=t.domain();r=[];for(let l=0;l<a.length-1;l++)i(e,[a[l],a[l+1]]).forEach((h=>{s.some((u=>h>=u[0]&&h<=u[1]))||r.push(h)}));t.domain(a)}else r=i(e);return r}function hB(n,t,e,i,r=!1){if(e&&!t.includes(n)){let o=t.length;if(o>1){r?t.push(n):t.unshift(n);for(let s=0;s<o;s++){const a=r?o-1-s:s;if(!i(t[a]))break;t.splice(a,1),s--,o--}}}}const Git=(n,t)=>{var e,i,r,o;if(!qH(n.type))return xs(n.domain());const s=n.range(),a=Math.abs(s[s.length-1]-s[0]);if(a<2)return xs([n.domain()[0]]);const{tickCount:l,forceTickCount:h,tickStep:u,noDecimals:d=!1,labelStyle:c,breakData:g}=t;let f;if(_t(u))p=n.stepTicks(u),m=g&&g()?g().breakDomains:null,f=m&&m.length?p.filter((b=>m.every((y=>b<y[0]||b>y[1])))):p;else if(_t(h))f=gy(t,n,h,((b,y)=>y&&y.length?n.domain(y,!0).forceTicks(b):n.forceTicks(b)));else if(t.tickMode==="d3"){const b=(e=ai(l)?l({axisLength:a,labelStyle:c}):l)!==null&&e!==void 0?e:5;f=gy(t,n,b,((y,C)=>C&&C.length?n.domain(C,!0).d3Ticks(y,{noDecimals:d}):n.d3Ticks(y,{noDecimals:d})))}else{const b=(i=ai(l)?l({axisLength:a,labelStyle:c}):l)!==null&&i!==void 0?i:5,y=ai(t.tickMode)?t.tickMode:void 0;f=gy(t,n,b,((C,w)=>w&&w.length?n.domain(w,!0).ticks(C,{noDecimals:d,customTicks:y}):n.ticks(C,{noDecimals:d,customTicks:y})))}var p,m;const v=n.domain();if(t.labelFirstVisible&&v[0]!==f[0]&&!f.includes(v[0])&&f.unshift(v[0]),t.labelLastVisible&&v[v.length-1]!==f[f.length-1]&&!f.includes(v[v.length-1])&&f.push(v[v.length-1]),t.sampling&&f.length>1&&(t.coordinateType==="cartesian"||t.coordinateType==="polar"&&t.axisOrientType==="radius")){const{labelGap:b=4,labelFlush:y}=t,C=6;let w;if(f.length*C>a){const _=[],A=Math.floor(f.length*C/a);f.forEach(((x,S)=>{S%A!=0&&S!==f.length-1||_.push(x)})),w=(r=zw(n,_,t))===null||r===void 0?void 0:r.map(((x,S)=>({AABBBounds:x,value:_[S]})))}else w=(o=zw(n,f,t))===null||o===void 0?void 0:o.map(((_,A)=>({AABBBounds:_,value:f[A]})));if(w){const _=w[0],A=yh(w),x=g&&g()?uB.greedy:uB.parity;for(;w.length>=3&&Dw(w,b);)w=x(w,b);const S=t.labelFirstVisible;let T=t.labelLastVisible;Jr(_,A,b)&&w.includes(A)&&w.length>1&&S&&T&&(w.splice(w.indexOf(A),1),T=!1),hB(_,w,S,(R=>Jr(R,_,b))),hB(A,w,T,(R=>Jr(R,A,b)||!(!S||R===_)&&Jr(R,_,b)),!0);const M=w.map((R=>R.value));M.length<3&&y&&(M.length>1&&M.pop(),yh(M)!==yh(f)&&M.push(yh(f))),f=M}}return xs(f)},uB={parity:function(n){return n.filter(((t,e)=>e%2==0))},greedy:function(n,t){let e;return n.filter(((i,r)=>(!r||!Jr(e,i,t))&&(e=i,!0)))}},dB=(n,t,e,i)=>{const r=zw(n,t,e);return r&&r.map((o=>i?[o.x1,o.x2,o.width()]:[o.y1,o.y2,o.height()]))},cB=(n,t,e=0)=>Math.max(n[0],t[0])-e/2<=Math.min(n[1],t[1])+e/2,gB=(n,t)=>n[1]<t[0]?t[0]-n[1]:t[1]<n[0]?n[0]-t[1]:0,$it=(n,t)=>{var e;const i=n.domain();if(!i.length)return[];const{tickCount:r,forceTickCount:o,tickStep:s,labelGap:a=4,axisOrientType:l,labelStyle:h}=t,u=Mit(l),d=n.range(),c=n.calculateWholeRangeSize();if(c<2)return t.labelLastVisible?xs([i[i.length-1]]):xs([i[0]]);let g;if(_t(s))g=n.stepTicks(s);else if(_t(o))g=n.forceTicks(o);else if(_t(r)){const f=ai(r)?r({axisLength:c,labelStyle:h}):r;g=n.ticks(f)}else if(t.sampling){const f=((e=t.labelStyle.fontSize)!==null&&e!==void 0?e:12)+2,p=Mx(d),m=ZI(d);if(i.length<=c/f){const v=dB(n,i,t,u);if(v){const b=Math.min(...v.map((w=>w[2]))),y=(m-p)/i.length,C=Uit(i,v,a,t.labelLastVisible,Math.floor(b/y));g=n.stepTicks(C.step),t.labelLastVisible&&(C.delCount&&(g=g.slice(0,g.length-C.delCount)),g.push(i[i.length-1]))}}else{const v=[i[0],i[Math.floor(i.length/2)],i[i.length-1]],b=dB(n,v,t,u);if(b){let y=null;b.forEach((w=>{y?y[2]<w[2]&&(y=w):y=w}));const C=m-p-a>0?Math.ceil(i.length*(a+y[2])/(m-p-a)):i.length-1;g=n.stepTicks(C),!t.labelLastVisible||g.length&&g[g.length-1]===i[i.length-1]||(g.length&&Math.abs(n.scale(g[g.length-1])-n.scale(i[i.length-1]))<y[2]&&(g=g.slice(0,-1)),g.push(i[i.length-1]))}}}return jt(g)&&(g=n.domain()),xs(g)},Uit=(n,t,e,i,r,o)=>{let s=0,a=0,l=-1,h=Number.MAX_VALUE;const u=g=>{let f=!0,p=0;do p+g<n.length&&cB(t[p],t[p+g],e)&&(f=!1),p+=g;while(f&&p<n.length);return f},d=nZ(r,n.length,(g=>u(g)?1:-1));let c=d;do if(c>d&&!u(c))c++;else{if(!i){a=c;break}{const g=n.length-1;let f,p=0;f=n.length%c>0?n.length-n.length%c+c:n.length;do{if(f-=c,f!==g&&!cB(t[f],t[g],e))break;p++}while(f>0);if(f===g){a=c,s=p;break}{const m=Math.floor(n.length/c)-p+1;if(m<l)break;{l=m;const v=gB(t[f],t[g]),b=f-c>=0?gB(t[f-c],t[f]):v,y=Math.abs(v-b);if(y<h&&(h=y,a=c,s=p),v<=b)break}}}c++}while(c<=n.length);return{step:a,delCount:s}},Xit=(n,t,e)=>{var i;const{labelStyle:r,getRadius:o,labelOffset:s,labelFormatter:a,inside:l}=e,h=o?.(),u=(i=r.angle)!==null&&i!==void 0?i:0,d=yH(r);return t.map((c=>{const g=a?a(c):`${c}`,{width:f,height:p}=d.quickMeasure(g),m=Math.max(f,sB),v=Math.max(p,sB),b=n.scale(c),y={x:0,y:0};let C=0,w=0;const _={align:r.textAlign,baseline:r.textBaseline},{x:A,y:x}=ltt(b,y,h,s,l);return _.align||(cl(A,y.x)?_.baseline||(_.baseline=x>y.y?"top":"bottom"):A>y.x?_.align="left":A<y.x&&(_.align="right")),C=A+(_.align==="right"?-m:_.align==="left"?0:-m/2),w=x+(_.baseline==="bottom"?-v:_.baseline==="top"?0:-v/2),new Ic().set(C,w,C+m,w+v).rotate(u,C+m/2,w+v/2)}))},Yit=(n,t)=>{const{tickCount:e,forceTickCount:i,tickStep:r,getRadius:o,labelOffset:s,labelGap:a=0,labelStyle:l}=t,h=o?.();if(!h)return xs(n.domain());let u;if(_t(r))u=n.stepTicks(r);else if(_t(i))u=n.forceTicks(i);else if(_t(e)){const d=n.range(),c=Math.abs(d[d.length-1]-d[0]),g=ai(e)?e({axisLength:c,labelStyle:l}):e;u=n.ticks(g)}else if(t.sampling){const d=n.domain(),c=n.range(),g=Xit(n,d,t),f=Mx(c),p=ZI(c),m=Math.abs(p-f)*(h+s)/d.length,{step:v,delCount:b}=qit(d,g,a,Math.floor(g.reduce(((y,C)=>Math.min(y,C.width(),C.height())),Number.MAX_VALUE)/m));u=n.stepTicks(v),u=u.slice(0,u.length-b)}else u=n.domain();return xs(u)},qit=(n,t,e,i)=>{let r=i;do{let s=!0;r++;let a=0;do a+r<n.length&&oB(t[a],t[a+r],e)&&(s=!1),a+=r;while(s&&a<n.length);if(s)break}while(r<=n.length);let o=0;if(n.length>2){let s=n.length-n.length%r;for(s>=n.length&&(s-=r);s>0&&oB(t[0],t[s]);)o++,s-=r}return{step:r,delCount:o}},Kit=(n,t)=>{if(qH(n.type))return Git(n,t);if(Tit(n.type)){if(t.coordinateType==="cartesian")return $it(n,t);if(t.coordinateType==="polar"&&t.axisOrientType==="angle")return Yit(n,t)}return xs(n.domain())};function JH(){$n(),Du(),Uo()}const QH={space:8,style:{fill:"rgb(47, 69, 84)",cursor:"pointer",size:15},state:{disable:{fill:"rgb(170, 170, 170)",cursor:"not-allowed"},hover:{}}};JH();class Fc extends hr{getCurrent(){return this._current}constructor(t,e){super(e?.skipDefault?t:Lt({},Fc.defaultAttributes,t)),this.name="pager",this._current=1,this._onHover=i=>{const r=i.target;r.hasState("disable")||r.addState("hover")},this._onUnHover=i=>{i.target.removeState("hover")},this._onClick=i=>{const r=i.target;if(r.name==="preHandler"){if(this._current===1)return;this._current-=1,this._current===1?r.addState("disable"):r.removeState("disable"),this._dispatchEvent("toPrev",{current:this._current,total:this._total,direction:"pre",event:i})}if(r.name==="nextHandler"){if(this._current===this._total)return;this._current+=1,this._current===this._total?r.addState("disable"):r.removeState("disable"),this._dispatchEvent("toNext",{current:this._current,total:this._total,direction:"next",event:i})}this._current>1&&this.preHandler.removeState("disable"),this._current<this._total&&this.nextHandler.removeState("disable"),this.text.setAttribute("text",this._getPageText(this._current))}}render(){var t,e,i;this._reset();const{layout:r="horizontal",handler:o=QH,total:s,defaultCurrent:a=1,textStyle:l,padding:h=0}=this.attribute;this._current=a;const u=No(h),d=r==="horizontal",c=At.group({x:0,y:0}),g=o.style||{},f=g.size||15,p=(t=o.space)!==null&&t!==void 0?t:8,m=o.state||{};let{preShape:v,nextShape:b}=o;v||(v=d?"triangleLeft":"triangleUp"),b||(b=d?"triangleRight":"triangleDown");const y=At.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},g),{x:0,y:0,symbolType:v,size:f}));y.states=m,y.name="preHandler",this.preHandler=y,c.add(y);const{width:C,height:w}=wv(this._getPageText(s),Object.assign({textAlign:"center",textBaseline:"middle"},l),(i=(e=this.stage)===null||e===void 0?void 0:e.getTheme())===null||i===void 0?void 0:i.text),_=rn(f)?f:f[0],A=rn(f)?f:f[1],x=At.text(Object.assign({x:d?_/2+p+C/2:0,y:d?0:A/2+p+w/2,text:this._getPageText(a),textAlign:"center",textBaseline:"middle",lineHeight:l?.fontSize},l));this.text=x,c.add(x);const S=At.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},g),{x:d?_+2*p+C:0,y:d?0:A+2*p+w,symbolType:b,size:f}));S.name="nextHandler",S.states=m,this.nextHandler=S,c.add(S),this._total===1?(y.addState("disable"),S.addState("disable")):this._current===1?y.addState("disable"):this._current===s&&S.addState("disable");const T=c.AABBBounds,M=T.width(),R=T.height();c.translateTo(0-T.x1+u[3],0-T.y1+u[0]),this.add(c),this.attribute.width=M+u[1]+u[3],this.attribute.height=R+u[0]+u[2],this._bindEvents()}_bindEvents(){this.attribute.disableTriggerEvent||(this.preHandler&&(this.preHandler.addEventListener("pointerenter",this._onHover),this.preHandler.addEventListener("pointerleave",this._onUnHover),this.preHandler.addEventListener("pointerdown",this._onClick)),this.nextHandler&&(this.nextHandler.addEventListener("pointerenter",this._onHover),this.nextHandler.addEventListener("pointerleave",this._onUnHover),this.nextHandler.addEventListener("pointerdown",this._onClick)))}_reset(){this.removeAllChild(!0),this._current=1,this._total=this.attribute.total,this.preHandler=this.nextHandler=this.text=null}_getPageText(t){const{pageFormatter:e}=this.attribute;return e?ai(e)?e(t,this._total):`${e}`.replace("{current}",`${t}`).replace("{total}",`${this._total}`):`${t}/${this._total}`}setTotal(t){t!==this.attribute.total&&(this._total=t,this._current!==1&&this._current<=t?this.setAttributes({total:t,defaultCurrent:this._current}):this.setAttribute("total",t))}}Fc.defaultAttributes={handler:QH,textStyle:{fill:"rgb(51, 51, 51)",fontSize:12}};const H0=10,tD=8,eD=8,Zit=8,Gf=16,$f=8,gg=12,Ww=12;var Mt;(function(n){n.selected="selected",n.unSelected="unSelected",n.selectedHover="selectedHover",n.unSelectedHover="unSelectedHover",n.focus="focus"})(Mt||(Mt={}));var xr;(function(n){n.legendItemHover="legendItemHover",n.legendItemUnHover="legendItemUnHover",n.legendItemClick="legendItemClick",n.legendItemAttributeUpdate="legendItemAttributeUpdate"})(xr||(xr={}));var nn;(function(n){n.innerView="innerView",n.title="legendTitle",n.item="legendItem",n.itemShape="legendItemShape",n.itemLabel="legendItemLabel",n.itemValue="legendItemValue",n.focus="legendItemFocus"})(nn||(nn={}));class Wx extends hr{constructor(){super(...arguments),this.name="legend",this._title=null}render(){this.removeAllChild(!0);const{interactive:t=!0,title:e,padding:i=0}=this.attribute;this._parsedPadding=No(i);const r=At.group({x:this._parsedPadding[3],y:this._parsedPadding[0],pickable:t,childrenPickable:t});r.name=nn.innerView,this.add(r),this._innerView=r,e?.visible&&this._renderTitle(e),this._renderContent(),this._adjustLayout(),t&&this._bindEvents();const o=this._innerView.AABBBounds;this.attribute.width=o.width()+this._parsedPadding[1]+this._parsedPadding[3],this.attribute.height=o.height()+this._parsedPadding[0]+this._parsedPadding[2]}_renderTitle(t){const{text:e="",textStyle:i,padding:r=0,background:o,minWidth:s,maxWidth:a,shape:l}=t,h={x:0,y:0,text:e,textStyle:i,padding:No(r),minWidth:s,maxWidth:a};l&&l.visible&&(h.shape=Object.assign({visible:!0},l.style),_t(l.space)&&(h.space=l.space)),o&&o.visible&&(h.panel=Object.assign({visible:!0},o.style));const u=new va(h);u.name=nn.title,this._title=u,this._innerView.add(u)}_adjustLayout(){var t;if(this._title){const e=this._innerView.AABBBounds.width(),i=this._title.AABBBounds.width(),r=(t=this.attribute.title)===null||t===void 0?void 0:t.align;r==="center"?this._title.setAttribute("x",(e-i)/2):r==="end"&&this._title.setAttribute("x",e-i)}}}function jx(){$n(),Uo(),Os(),Du()}function Vx(){$n(),wH()}function Jit(){Vx(),JH(),pH()}function Qit(){Vx(),jx()}function tnt(){Vx(),jx(),EQ()}var fB=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const ent={[Mt.focus]:{},[Mt.selected]:{},[Mt.selectedHover]:{},[Mt.unSelected]:{},[Mt.unSelectedHover]:{}};Jit();class Av extends Wx{constructor(t,e){super(e?.skipDefault?t:Lt({},Av.defaultAttributes,t)),this.name="discreteLegend",this._itemsContainer=null,this._itemHeightByUser=void 0,this._itemHeight=0,this._itemMaxWidth=0,this._contentMaxHeight=0,this._onHover=i=>{const r=i.target;if(r&&r.name&&r.name.startsWith(nn.item)){const o=r.delegate;if(this._lastActiveItem){if(this._lastActiveItem.id===o.id)return;this._unHover(this._lastActiveItem,i)}this._hover(o,i)}else this._lastActiveItem&&(this._unHover(this._lastActiveItem,i),this._lastActiveItem=null)},this._onUnHover=i=>{this._lastActiveItem&&(this._unHover(this._lastActiveItem,i),this._lastActiveItem=null)},this._onClick=i=>{var r,o,s,a;const l=i.target;if(l&&l.name&&l.name.startsWith(nn.item)){const h=l.delegate,{selectMode:u="multiple"}=this.attribute;if(l.name===nn.focus||u==="focus"){const d=h.hasState(Mt.focus);h.toggleState(Mt.focus),d?(r=this._itemsContainer)===null||r===void 0||r.getChildren().forEach((c=>{this._removeLegendItemState(c,[Mt.unSelected,Mt.unSelectedHover,Mt.focus],i),this._setLegendItemState(c,Mt.selected,i)})):(this._setLegendItemState(h,Mt.selected,i),this._removeLegendItemState(h,[Mt.unSelected,Mt.unSelectedHover],i),(o=this._itemsContainer)===null||o===void 0||o.getChildren().forEach((c=>{h!==c&&(this._removeLegendItemState(c,[Mt.selected,Mt.selectedHover,Mt.focus],i),this._setLegendItemState(c,Mt.unSelected,i))})))}else{(s=this._itemsContainer)===null||s===void 0||s.getChildren().forEach((f=>{f.removeState(Mt.focus)}));const{allowAllCanceled:d=!0}=this.attribute,c=h.hasState(Mt.selected),g=this._getSelectedLegends();if(u==="multiple"){if(d===!1&&c&&g.length===1)return void this._dispatchLegendEvent(xr.legendItemClick,h,i);c?(this._removeLegendItemState(h,[Mt.selected,Mt.selectedHover],i),this._setLegendItemState(h,Mt.unSelected,i)):(this._setLegendItemState(h,Mt.selected,i),this._removeLegendItemState(h,[Mt.unSelected,Mt.unSelectedHover],i))}else this._setLegendItemState(h,Mt.selected,i),this._removeLegendItemState(h,[Mt.unSelected,Mt.unSelectedHover],i),(a=this._itemsContainer)===null||a===void 0||a.getChildren().forEach((f=>{h!==f&&(this._removeLegendItemState(f,[Mt.selected,Mt.selectedHover],i),this._setLegendItemState(f,Mt.unSelected,i))}))}this._dispatchLegendEvent(xr.legendItemClick,h,i)}}}render(){super.render(),this._lastActiveItem=null}setSelected(t){var e;((e=this._itemsContainer)===null||e===void 0?void 0:e.getChildren()).forEach((i=>{const r=i.data;t.includes(r.label)?(this._setLegendItemState(i,Mt.selected),this._removeLegendItemState(i,[Mt.unSelected,Mt.unSelectedHover])):(this._removeLegendItemState(i,[Mt.selected,Mt.selectedHover]),this._setLegendItemState(i,Mt.unSelected))}))}_renderItems(){const{item:t={},maxCol:e=1,maxRow:i=2,maxWidth:r,defaultSelected:o,lazyload:s,autoPage:a}=this.attribute,{spaceCol:l=Gf,spaceRow:h=$f,verticalAlign:u="middle"}=t,d=this._itemsContainer,{items:c,isHorizontal:g,startIndex:f,isScrollbar:p}=this._itemContext,m=p?1:g?i:e,v=this._contentMaxHeight;let b,{doWrap:y,maxWidthInCol:C,startX:w,startY:_,pages:A}=this._itemContext,x=0,S=0;const T=[];for(let M=f,R=c.length;M<R&&!(s&&A>this._itemContext.currentPage*m);M++){s&&(this._itemContext.startIndex=M+1),b=c[M],b.id||(b.id=b.label),b.index=M;let E=!0;_e(o)&&(E=o.includes(b.label));const P=this._renderEachItem(b,E,M,c),B=P.attribute.width,k=P.attribute.height;this._itemHeight=Math.max(this._itemHeight,k),C=Math.max(B,C),this._itemMaxWidth=Math.max(B,this._itemMaxWidth),g?(_t(r)&&(p&&a?(A=Math.ceil((w+B)/r),y=A>1):w+B>r&&(y=!0,w>0&&(u!=="middle"&&u!=="bottom"||T.forEach((L=>{L.setAttributes({y:L.attribute.y+(S-L.attribute.height)/(u==="middle"?2:1)})})),A+=1,w=0,_+=S+h,S=0,T.length=0))),w===0&&_===0||P.setAttributes({x:w,y:_}),w+=l+B,S=Math.max(S,k),T.push(P)):(_t(v)&&(p&&a?(A=Math.ceil((_+k)/v),y=A>1):v<=k?(A+=1,y=!0,_=0,M>0&&(w+=x+l)):v<_+k&&(A+=1,y=!0,_=0,w+=C+l,C=0)),w===0&&_===0||P.setAttributes({x:w,y:_}),_+=h+k),d.add(P),x=B}return!g||u!=="middle"&&u!=="bottom"||T.forEach((M=>{M.setAttributes({y:M.attribute.y+(S-M.attribute.height)/(u==="middle"?2:1)})})),this._itemContext.doWrap=y,this._itemContext.startX=w,this._itemContext.startY=_,this._itemContext.maxWidthInCol=C,this._itemContext.pages=A,this._itemContext.maxPages=m,p&&(this._itemContext.totalPage=A),s||(this._itemContext.startIndex=c.length),this._itemContext}_renderContent(){const{item:t={},items:e,reversed:i,maxWidth:r,maxHeight:o}=this.attribute;if(t.visible===!1||Re(e))return;let s=e;i&&(s=e?.reverse()),this._contentMaxHeight=Math.max(0,o-this._parsedPadding[0]-this._parsedPadding[2]);const a=At.group({x:0,y:0});this._itemsContainer=a;const{layout:l,autoPage:h}=this.attribute,u=l==="horizontal",{maxWidth:d,width:c,height:g}=t,f=[];_t(d)&&f.push(d),_t(c)&&f.push(c),f.length&&(_t(r)&&f.push(r),this._itemWidthByUser=Mx(f)),_t(g)&&(this._itemHeightByUser=g);const p=this.attribute.pager;this._itemContext={currentPage:p&&p.defaultCurrent||1,doWrap:!1,maxWidthInCol:0,maxPages:1,pages:1,startX:0,startY:0,startIndex:0,items:s,isHorizontal:u,totalPage:1/0,isScrollbar:p&&p.type==="scrollbar",clipContainer:void 0},this._itemContext=this._renderItems();let m=!1;this._itemContext.doWrap&&h&&this._itemContext.pages>this._itemContext.maxPages&&(m=this._renderPagerComponent()),m||(a.setAttribute("y",this._title?this._title.AABBBounds.height()+Bn(this.attribute,"title.space",8):0),this._innerView.add(a))}_bindEvents(){if(this.attribute.disableTriggerEvent||!this._itemsContainer)return;const{hover:t=!0,select:e=!0}=this.attribute;if(t){let i="pointermove",r="pointerleave";ao(t)&&(t.trigger&&(i=t.trigger),t.triggerOff&&(r=t.triggerOff)),this._itemsContainer.addEventListener(i,this._onHover),this._itemsContainer.addEventListener(r,this._onUnHover)}if(e){let i="pointerdown";ao(e)&&e.trigger&&(i=e.trigger),this._itemsContainer.addEventListener(i,this._onClick)}}_autoEllipsis(t,e,i,r){var o,s;const{label:a,value:l}=this.attribute.item,h=r.AABBBounds,u=i.AABBBounds,d=h.width(),c=u.width();let g=!1;t==="labelFirst"?c>e?g=!0:r.setAttribute("maxLineWidth",e-c):t==="valueFirst"?d>e?g=!0:i.setAttribute("maxLineWidth",e-d):d+c>e&&(g=!0),g&&(r.setAttribute("maxLineWidth",Math.max(e*((o=a.widthRatio)!==null&&o!==void 0?o:.5),e-c)),i.setAttribute("maxLineWidth",Math.max(e*((s=l.widthRatio)!==null&&s!==void 0?s:.5),e-d)))}_renderEachItem(t,e,i,r){var o,s;const{id:a,label:l,value:h,shape:u}=t,{padding:d=0,focus:c,focusIconStyle:g,align:f,autoEllipsisStrategy:p}=this.attribute.item,{shape:m,label:v,value:b,background:y}=this.attribute.item,C=this._handleStyle(m,t,e,i,r),w=this._handleStyle(v,t,e,i,r),_=this._handleStyle(b,t,e,i,r),A=this._handleStyle(y,t,e,i,r),x=No(d);let S;y.visible===!1?(S=At.group({x:0,y:0,cursor:(o=A.style)===null||o===void 0?void 0:o.cursor}),this._appendDataToShape(S,nn.item,t,S)):(S=At.group(Object.assign({x:0,y:0},A.style)),this._appendDataToShape(S,nn.item,t,S,A.state)),S.id=`${a??l}-${i}`,S.addState(e?Mt.selected:Mt.unSelected);const T=At.group({x:0,y:0,pickable:!1});S.add(T);let M,R=0,E=0,P=0;if(m&&m.visible!==!1){const j=Bn(C,"style.size",H0);E=_e(j)?j[0]||0:j,P=Bn(m,"space",tD);const X=At.symbol(Object.assign(Object.assign({x:0,y:0,symbolType:"circle",strokeBoundsBuffer:0},u),C.style));Object.keys(C.state||{}).forEach((Z=>{const J=C.state[Z].fill||C.state[Z].stroke;u.fill&&jt(C.state[Z].fill)&&J&&(C.state[Z].fill=J),u.stroke&&jt(C.state[Z].stroke)&&J&&(C.state[Z].stroke=J)})),this._appendDataToShape(X,nn.itemShape,t,S,C.state),X.addState(e?Mt.selected:Mt.unSelected),T.add(X)}let B=0;if(c){const j=Bn(g,"size",H0);M=At.symbol(Object.assign(Object.assign({x:0,y:-j/2-1,strokeBoundsBuffer:0,boundsPadding:x},g),{visible:!0,pickMode:"imprecise"})),this._appendDataToShape(M,nn.focus,t,S),B=j}const k=v.formatMethod?v.formatMethod(l,t,i):l,L=Object.assign(Object.assign({x:E/2+P,y:0,textAlign:"start",textBaseline:"middle",lineHeight:(s=w.style)===null||s===void 0?void 0:s.fontSize},w.style),{text:k,_originText:v.formatMethod?l:void 0}),O=Iw(L);this._appendDataToShape(O,nn.itemLabel,t,S,w.state),O.addState(e?Mt.selected:Mt.unSelected),T.add(O);const I=Bn(v,"space",eD);if(_t(h)){const j=Bn(b,"space",c?Zit:0),X=b.formatMethod?b.formatMethod(h,t,i):h,Z=Object.assign(Object.assign({x:0,y:0,textAlign:"start",textBaseline:"middle",lineHeight:_.style.fontSize},_.style),{text:X,_originText:b.formatMethod?h:void 0}),J=Iw(Z);if(this._appendDataToShape(J,nn.itemValue,t,S,_.state),J.addState(e?Mt.selected:Mt.unSelected),this._itemWidthByUser){const q=this._itemWidthByUser-x[1]-x[3]-E-P-I-B-j;this._autoEllipsis(p,q,O,J),b.alignRight?J.setAttributes({textAlign:"right",x:this._itemWidthByUser-E/2-x[1]-x[3]-B-j}):J.setAttribute("x",I+(O.AABBBounds.empty()?0:O.AABBBounds.x2))}else J.setAttribute("x",I+(O.AABBBounds.empty()?0:O.AABBBounds.x2));R=j+(J.AABBBounds.empty()?0:J.AABBBounds.x2),T.add(J)}else this._itemWidthByUser&&O.setAttribute("maxLineWidth",this._itemWidthByUser-x[1]-x[3]-E-P-B),R=I+(O.AABBBounds.empty()?0:O.AABBBounds.x2);M&&(M.setAttribute("x",R),T.add(M));const H=T.AABBBounds,D=H.width();if(f==="right"){const j=H.x2,X=H.x1;T.forEachChildren(((Z,J)=>{Z.type!=="symbol"&&Z.attribute.textAlign!=="right"||Z===M?Z.setAttribute("x",X+j-Z.attribute.x-Z.AABBBounds.width()):Z.type!=="symbol"?Z.setAttributes({x:X+j-Z.attribute.x,textAlign:"left"}):Z.setAttribute("x",X+j-Z.attribute.x)}))}const z=H.height(),G=_t(this.attribute.item.width)?this.attribute.item.width:D+x[1]+x[3],U=this._itemHeightByUser||z+x[0]+x[2];return S.attribute.width=G,S.attribute.height=U,M&&M.setAttribute("visible",!1),T.translateTo(-H.x1+x[3],-H.y1+x[0]),S}_createPager(t){var e,i;const{disableTriggerEvent:r,maxRow:o}=this.attribute,s=a=>a<=99?99:a<=999?999:9999;return this._itemContext.isHorizontal?new Fc(Object.assign(Object.assign({layout:o===1?"horizontal":"vertical",total:s(this._itemContext.pages)},Lt({handler:{preShape:"triangleUp",nextShape:"triangleDown"}},t)),{defaultCurrent:(e=this.attribute.pager)===null||e===void 0?void 0:e.defaultCurrent,disableTriggerEvent:r})):new Fc(Object.assign({layout:"horizontal",total:s(this._itemContext.pages),disableTriggerEvent:r,defaultCurrent:(i=this.attribute.pager)===null||i===void 0?void 0:i.defaultCurrent},t))}_createScrollbar(t,e){const{disableTriggerEvent:i}=this.attribute;return this._itemContext.isHorizontal?new ks(Object.assign(Object.assign({direction:"horizontal",disableTriggerEvent:i,range:[0,.5],height:t.visible===!1?0:12},t),{width:e})):new ks(Object.assign(Object.assign({direction:"vertical",width:t.visible===!1?0:12,range:[0,.5]},t),{height:e,disableTriggerEvent:i}))}_updatePositionOfPager(t,e,i){const{pager:r}=this.attribute,{totalPage:o,isHorizontal:s}=this._itemContext,a=r&&r.position||"middle";if(this._pagerComponent.setTotal(o),s){let l;l=a==="start"?t:a==="end"?t+i-this._pagerComponent.AABBBounds.height()/2:t+i/2-this._pagerComponent.AABBBounds.height()/2,this._pagerComponent.setAttributes({x:e-this._pagerComponent.AABBBounds.width(),y:l})}else{let l;l=a==="start"?0:a==="end"?e-this._pagerComponent.AABBBounds.width():(e-this._pagerComponent.AABBBounds.width())/2,this._pagerComponent.setAttributes({x:l,y:i-this._pagerComponent.AABBBounds.height()})}}_computeScrollbarDelta(){const{isHorizontal:t,clipContainer:e}=this._itemContext,i=this._itemsContainer.AABBBounds,r=e.AABBBounds;let o,s;return t?(s=r.width(),o=s/i.width()):(s=r.height(),o=s/i.height()),o}_updatePositionOfScrollbar(t,e,i){const{isHorizontal:r,currentPage:o,totalPage:s}=this._itemContext,a=(o-1)/s;this._pagerComponent.setScrollRange([a,a+this._computeScrollbarDelta()]),r?this._pagerComponent.setAttributes({x:0,y:i+e}):this._pagerComponent.setAttributes({x:t,y:i})}_bindEventsOfPager(t,e){const i=this.attribute.pager||{},{animation:r=!0,animationDuration:o=450,animationEasing:s="quadIn"}=i,a=this._itemContext.isScrollbar?u=>{const{value:d}=u.detail;let c;return c=d[0]===0?1:d[1]===1?this._itemContext.totalPage:d[0]*this._itemContext.totalPage+1,c}:u=>u.detail.current,l=u=>{const d=this._pagerComponent,c=d.getScrollRange(),{direction:g}=d.attribute,{width:f,height:p}=d.getSliderRenderBounds(),m=g==="vertical"?u.deltaY/p:u.deltaX/f;d.setScrollRange([c[0]+m,c[1]+m],!0),this.updateScrollMask()},h=u=>{const d=a(u);if(d!==this._itemContext.currentPage){if(this._itemContext.currentPage=d,this._itemContext&&this._itemContext.startIndex<this._itemContext.items.length){this._renderItems();const c=Math.ceil(this._itemContext.pages/this._itemContext.maxPages);if(this._itemContext.totalPage=c,this._itemContext.isScrollbar&&this._pagerComponent){const g=this._computeScrollbarDelta(),[f]=this._pagerComponent.getScrollRange();this._pagerComponent.setScrollRange([f,f+g])}}if(this._itemContext.isScrollbar){const[c]=this._pagerComponent.getScrollRange();let g;g=this._itemContext.isHorizontal?this._itemsContainer.AABBBounds.width():this._itemsContainer.AABBBounds.height();const f=g*c;this.updateScrollMask(),r?this._itemsContainer.animate().to({[e]:-f},o,s):this._itemsContainer.setAttribute(e,-f)}else r?this._itemsContainer.animate().to({[e]:-(d-1)*t},o,s):this._itemsContainer.setAttribute(e,-(d-1)*t)}};this._itemContext.isScrollbar?(this._pagerComponent.addEventListener("scrollDrag",h),this._pagerComponent.addEventListener("scrollUp",h),this.attribute.pager.roamScroll&&(this.addEventListener("wheel",(d=>d.nativeEvent.preventDefault())),this.addEventListener("wheel",tH(l,50)))):(this._pagerComponent.addEventListener("toPrev",h),this._pagerComponent.addEventListener("toNext",h))}_renderPager(){const t=this._title?this._title.AABBBounds.height()+Bn(this.attribute,"title.space",8):0,{maxWidth:e,maxCol:i=1,maxRow:r=2,item:o={},pager:s={}}=this.attribute,{spaceCol:a=Gf,spaceRow:l=$f}=o,h=this._itemsContainer,{space:u=Ww,defaultCurrent:d=1}=s,c=fB(s,["space","defaultCurrent"]),{isHorizontal:g}=this._itemContext,f=this._contentMaxHeight;let p,m=0,v=0,b=0,y=0,C=0,w=0,_=1;if(g){if(v=(r-1)*l+this._itemHeight*r,m=e,p=this._createPager(c),this._pagerComponent=p,this._innerView.add(p),b=e-p.AABBBounds.width()-u,b<=0)return this._innerView.removeChild(p),!1;h.getChildren().forEach(((S,T)=>{const{width:M,height:R}=S.attribute;b<C+M&&T>0&&(C=0,w+=R+l,_+=1),T>0&&S.setAttributes({x:C,y:w}),C+=a+M})),this._itemContext.startX=C,this._itemContext.startY=w,this._itemContext.pages=_;const x=Math.ceil(_/r);this._itemContext.totalPage=x,this._updatePositionOfPager(t,m,v)}else{if(m=this._itemMaxWidth*i+(i-1)*a,v=f,b=m,p=this._createPager(c),this._pagerComponent=p,this._innerView.add(p),y=f-p.AABBBounds.height()-u-t,y<=0)return this._innerView.removeChild(p),!1;h.getChildren().forEach(((S,T)=>{const{width:M,height:R}=S.attribute;y<w+R&&T>0&&(w=0,C+=this._itemMaxWidth+a,_+=1),T>0&&S.setAttributes({x:C,y:w}),w+=l+R}));const x=Math.ceil(_/i);this._itemContext.totalPage=x,this._updatePositionOfPager(t,m,v)}d>1&&(g?h.setAttribute("y",-(d-1)*(v+l)):h.setAttribute("x",-(d-1)*(m+a)));const A=At.group({x:0,y:t,width:g?b:m,height:g?v:y,clip:!0,pickable:!1});return A.add(h),this._innerView.add(A),this._itemContext.clipContainer=A,this._bindEventsOfPager(g?v+l:m+a,g?"y":"x"),!0}_renderScrollbar(){var t;const e=this._title?this._title.AABBBounds.height()+Bn(this.attribute,"title.space",8):0,{maxWidth:i,item:r={},pager:o={}}=this.attribute,{spaceCol:s=Gf,spaceRow:a=$f}=r,l=this._itemsContainer,{space:h=Ww,defaultCurrent:u=1}=o,d=fB(o,["space","defaultCurrent"]),{isHorizontal:c}=this._itemContext,g=this._contentMaxHeight;let f,p=0,m=0,v=0,b=1;if(c)p=i,m=this._itemHeight,f=this._createScrollbar(d,p),this._pagerComponent=f,this._innerView.add(f);else{if(m=g-e,p=this._itemMaxWidth,f=this._createScrollbar(d,m),this._pagerComponent=f,this._innerView.add(f),m<=0)return this._innerView.removeChild(f),!1;const C=l.getChildren(),w=C.map((_=>_.attribute.height));if(w.length===1||w.every((_=>_===w[0]))){const _=w[0],A=m,x=Math.floor(A/(a+_));m=x*(a+_),b=Math.ceil(C.length/x)}else C.forEach(((_,A)=>{const{height:x}=_.attribute,S=b,T=v;b=Math.floor((v+x)/m)+1,v+=a+x,S!==b&&A===l.getChildren().length-1&&v-m>=1/3*x&&(m=T+x,b-=1)}));this._itemContext.totalPage=b,this._itemContext.pages=b}if(u>1)if(c){const C=this._itemsContainer.AABBBounds.width()-p;l.setAttribute("x",-Math.min((u-1)*(p+s),C))}else{const C=this._itemsContainer.AABBBounds.height()-m;l.setAttribute("y",-Math.min((u-1)*(m+a),C))}const y=At.group({x:0,y:e,width:p,height:m,clip:!0,pickable:!1});return y.add(l),this._innerView.add(y),this._itemContext.clipContainer=y,this._updatePositionOfScrollbar(p,m,e),!((t=o.scrollMask)===null||t===void 0)&&t.visible&&this.renderScrollMask(y),this._bindEventsOfPager(c?p:m,c?"x":"y"),!0}renderScrollMask(t){const{scrollMask:e={}}=this.attribute.pager,{visible:i=!0,gradientLength:r=16,gradientStops:o}=e;if(!i||!o)return;const s=t.AABBBounds.width(),a=t.AABBBounds.height(),l=this._itemContext.isHorizontal?s:a,h=o.map((c=>({offset:r*c.offset/l,color:c.color}))),u=o.map((c=>({offset:(l-r*c.offset)/l,color:c.color}))),d=At.rect({x:0,y:0,width:s,height:a});this._scrollMask=d,this._scrollMaskContext={startStops:h,endStops:u},this.updateScrollMask(),t.add(d)}updateScrollMask(){if(!this._scrollMask||!this._pagerComponent||!this._itemContext.isScrollbar)return;const[t,e]=this._pagerComponent.getScrollRange(),i=[];cl(Qn(e,0,1),1)||i.push(...this._scrollMaskContext.endStops),cl(Qn(t,0,1),0)||i.push(...this._scrollMaskContext.startStops),i.length&&(this._itemContext.isHorizontal?this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:i}}):this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:0,y1:1,stops:i}}))}_renderPagerComponent(){return this._itemContext.isScrollbar?this._renderScrollbar():this._renderPager(),!0}_hover(t,e){this._lastActiveItem=t,t.hasState(Mt.selected)?this._setLegendItemState(t,Mt.selectedHover,e):this._setLegendItemState(t,Mt.unSelectedHover,e);const i=t.getChildren()[0].find((r=>r.name===nn.focus),!1);i&&i.setAttribute("visible",!0),this._dispatchLegendEvent(xr.legendItemHover,t,e)}_unHover(t,e){let i=!1;(t.hasState(Mt.unSelectedHover)||t.hasState(Mt.selectedHover))&&(i=!0),t.removeState(Mt.unSelectedHover),t.removeState(Mt.selectedHover),t.getChildren()[0].getChildren().forEach((o=>{i||!o.hasState(Mt.unSelectedHover)&&!o.hasState(Mt.selectedHover)||(i=!0),o.removeState(Mt.unSelectedHover),o.removeState(Mt.selectedHover)}));const r=t.getChildren()[0].find((o=>o.name===nn.focus),!1);r&&r.setAttribute("visible",!1),i&&this._dispatchLegendEvent(xr.legendItemAttributeUpdate,t,e),this._dispatchLegendEvent(xr.legendItemUnHover,t,e)}_setLegendItemState(t,e,i){let r=!1;t.hasState(e)||(r=!0),t.addState(e,!0),t.getChildren()[0].getChildren().forEach((o=>{o.name!==nn.focus&&(r||o.hasState(e)||(r=!0),o.addState(e,!0))})),r&&this._dispatchLegendEvent(xr.legendItemAttributeUpdate,t,i)}_removeLegendItemState(t,e,i){let r=!1;e.forEach((o=>{!r&&t.hasState(o)&&(r=!0),t.removeState(o)})),t.getChildren()[0].getChildren().forEach((o=>{o.name!==nn.focus&&e.forEach((s=>{!r&&o.hasState(s)&&(r=!0),o.removeState(s)}))})),r&&this._dispatchLegendEvent(xr.legendItemAttributeUpdate,t,i)}_getSelectedLegends(){var t;const e=[];return(t=this._itemsContainer)===null||t===void 0||t.getChildren().forEach((i=>{i.hasState(Mt.selected)&&e.push(i.data)})),e}_appendDataToShape(t,e,i,r,o={}){t.name=e,t.data=i,t.delegate=r,t.states=Lt({},ent,o)}_dispatchLegendEvent(t,e,i){const r=this._getSelectedLegends();r.sort(((s,a)=>s.index-a.index));const o=r.map((s=>s.label));this._dispatchEvent(t,{item:e,data:e.data,selected:e.hasState(Mt.selected),currentSelectedItems:r,currentSelected:o,event:i})}_handleStyle(t,e,i,r,o){const s={};return t.style&&(ai(t.style)?s.style=t.style(e,i,r,o):s.style=t.style),t.state&&(s.state={},Object.keys(t.state).forEach((a=>{t.state[a]&&(ai(t.state[a])?s.state[a]=t.state[a](e,i,r,o):s.state[a]=t.state[a])}))),s}release(){super.release(),this.removeAllEventListeners()}}Av.defaultAttributes={layout:"horizontal",title:{align:"start",space:gg,textStyle:{fontSize:12,fontWeight:"bold",fill:"#2C3542"}},item:{spaceCol:Gf,spaceRow:$f,shape:{space:tD,style:{size:H0,cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{opacity:.5}}},label:{space:eD,style:{fontSize:12,fill:"#2C3542",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},value:{alignRight:!1,style:{fontSize:12,fill:"#ccc",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},background:{style:{cursor:"pointer"}},focus:!1,focusIconStyle:{size:H0,symbolType:"M8 1C11.866 1 15 4.13401 15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1ZM8.75044 2.55077L8.75 3.75H7.25L7.25006 2.5507C4.81247 2.88304 2.88304 4.81247 2.5507 7.25006L3.75 7.25V8.75L2.55077 8.75044C2.8833 11.1878 4.81264 13.117 7.25006 13.4493L7.25 12.25H8.75L8.75044 13.4492C11.1876 13.1167 13.1167 11.1876 13.4492 8.75044L12.25 8.75V7.25L13.4493 7.25006C13.117 4.81264 11.1878 2.8833 8.75044 2.55077ZM8 5.5C9.38071 5.5 10.5 6.61929 10.5 8C10.5 9.38071 9.38071 10.5 8 10.5C6.61929 10.5 5.5 9.38071 5.5 8C5.5 6.61929 6.61929 5.5 8 5.5ZM8 7C7.44772 7 7 7.44772 7 8C7 8.55228 7.44772 9 8 9C8.55228 9 9 8.55228 9 8C9 7.44772 8.55228 7 8 7Z",fill:"#333",cursor:"pointer"}},autoPage:!0,pager:{space:Ww,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:"multiple",allowAllCanceled:!0};var en;(function(n){n.innerView="innerView",n.railContainer="sliderRailContainer",n.rail="sliderRail",n.startText="sliderStartText",n.endText="sliderEndText",n.startHandler="sliderStartHandler",n.startHandlerText="startHandlerText",n.endHandler="sliderEndHandler",n.endHandlerText="sliderEndHandlerText",n.track="sliderTrack",n.trackContainer="sliderTrackContainer"})(en||(en={}));function fy(n){return _e(n)?n:[n,n]}function ff(n){return n?"ew-resize":"ns-resize"}jx();class fg extends hr{get track(){return this._track}get currentValue(){return this._currentValue}get startHandler(){return this._startHandler}get endHandler(){return this._endHandler}get tooltipShape(){return this._tooltipShape}constructor(t,e){super(e?.skipDefault?t:Lt({},fg.defaultAttributes,t)),this.name="slider",this._isHorizontal=!0,this._startHandler=null,this._endHandler=null,this._startHandlerText=null,this._endHandlerText=null,this._currentHandler=null,this._currentValue={},this._onTooltipShow=i=>{this._isChanging||this._tooltipState&&this._tooltipState.isActive||(this._tooltipState?this._tooltipState.isActive=!0:this._tooltipState={isActive:!0},this._onTooltipUpdate(i),this._dispatchTooltipEvent("sliderTooltipShow"))},this._onTooltipUpdate=i=>{if(this._isChanging||!this._tooltipState||!this._tooltipState.isActive)return;const r=this._isHorizontal?this._rail.globalAABBBounds.width():this._rail.globalAABBBounds.height(),o=Qn(this._isHorizontal?(i.viewX-this._rail.globalAABBBounds.x1)/r:(i.viewY-this._rail.globalAABBBounds.y1)/r,0,1);o!==this._tooltipState.pos&&(this._tooltipState.pos=o,this._tooltipState.value=this.calculateValueByPos(o*r),this._updateTooltip(),this._dispatchTooltipEvent("sliderTooltipUpdate"))},this._onTooltipHide=()=>{const{tooltip:i}=this.attribute;i&&i.alwaysShow||(this._tooltipState=null,this._tooltipShape&&this._tooltipShape.setAttribute("visible",!1),this._tooltipText&&this._tooltipText.setAttribute("visible",!1),this._dispatchTooltipEvent("sliderTooltipHide"))},this._onHandlerPointerdown=i=>{this._clearAllDragEvents(),this._isChanging=!0;const{x:r,y:o}=this.stage.eventPointTransform(i);this._currentHandler=i.target,this._prePos=this._isHorizontal?r:o;const s=Wd(),a=Bt.env==="browser"?Bt:this.stage;a.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),s.forEach((l=>{a.addEventListener(l,this._onHandlerPointerUp)}))},this._onHandlerPointerMove=i=>{var r,o;this._isChanging=!0;const{railWidth:s,railHeight:a,min:l,max:h}=this.attribute;if(h===l)return;const{x:u,y:d}=this.stage.eventPointTransform(i);let c,g,f,p=0;this._isHorizontal?(c=u,p=c-this._prePos,g=(o=this._currentHandler)===null||o===void 0?void 0:o.attribute.x,f=s):(c=d,p=c-this._prePos,g=(r=this._currentHandler)===null||r===void 0?void 0:r.attribute.y,f=a);const m=Qn(g+p,0,f),v=this.calculateValueByPos(m);this._currentHandler.type==="text"?this._updateHandlerText(this._currentHandler,m,v):this._updateHandler(this._currentHandler,m,v),this._updateTrack(),this._prePos=c,this._dispatchChangeEvent()},this._onHandlerPointerUp=i=>{this._isChanging=!1,this._currentHandler=null,this._clearAllDragEvents()},this._handleTouchMove=i=>{this._isChanging&&i.preventDefault()},this._onTrackPointerdown=i=>{this._clearAllDragEvents(),this._isChanging=!0;const{x:r,y:o}=this.stage.eventPointTransform(i);this._prePos=this._isHorizontal?r:o;const s=Wd(),a=Bt.env==="browser"?Bt:this.stage;a.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),s.forEach((l=>{a.addEventListener(l,this._onTrackPointerUp)}))},this._onTrackPointerMove=i=>{this._isChanging=!0;const{railWidth:r,railHeight:o,min:s,max:a,inverse:l}=this.attribute;if(a===s)return;const{startHandler:h,endHandler:u}=this._getHandlers();let d,c,g;const{x:f,y:p}=this.stage.eventPointTransform(i);this._isHorizontal?(d=f,c=this._track.attribute.width,g=r):(d=p,c=this._track.attribute.height,g=o);const m=d-this._prePos;if(h){const v=this._isHorizontal?h.attribute.x:h.attribute.y,b=l?Qn(v+m,c,g):Qn(v+m,0,g-c),y=this.calculateValueByPos(b);this._updateHandler(h,b,y)}if(u){const v=this._isHorizontal?u.attribute.x:u.attribute.y,b=l?Qn(v+m,0,g-c):Qn(v+m,c,g),y=this.calculateValueByPos(b),C=h?.attribute;this._updateHandler(u,b,y),this._track.setAttributes(this._isHorizontal?{x:Math.min(C.x,u.attribute.x),width:Math.abs(C.x-u.attribute.x)}:{y:Math.min(C.y,u.attribute.y),height:Math.abs(C.y-u.attribute.y)})}this._prePos=d,this._dispatchChangeEvent()},this._onTrackPointerUp=i=>{this._isChanging=!1,this._clearAllDragEvents()},this._onRailPointerDown=i=>{this._clearAllDragEvents(),this._isChanging=!0;const{railWidth:r,railHeight:o,min:s,max:a}=this.attribute;if(a===s)return;const l=this._startHandler,h=this._endHandler;let u,d,c;this._isHorizontal?(u=i.viewX-this._rail.globalAABBBounds.x1,d=l?.attribute.x,c=h?.attribute.x):(u=i.viewY-this._rail.globalAABBBounds.y1,d=l?.attribute.y,c=h?.attribute.y);const g=this.calculateValueByPos(u);if(_t(c)){const f=Math.abs(u-d)>Math.abs(u-c)?h:l;this._updateHandler(f,u,g)}else this._updateHandler(l,u,g);this._updateTrack(),this._dispatchChangeEvent()}}calculatePosByValue(t,e){const{layout:i,railWidth:r,railHeight:o,min:s,max:a,inverse:l}=this.attribute;let h=0;return h=s===a?e==="start"?0:e==="end"?1:0:(t-s)/(a-s),(l?1-h:h)*(i==="vertical"?o:r)}calculateValueByPos(t){const{layout:e,railWidth:i,railHeight:r,min:o,max:s,inverse:a}=this.attribute,l=e==="vertical"?r:i;return o+(s-o)*(a?1-t/l:t/l)}setValue(t){const{min:e,max:i}=this.attribute;if(i===e)return;const[r,o]=u0(t),{startHandler:s,endHandler:a}=this._getHandlers();s&&this._updateHandler(s,this.calculatePosByValue(r),r),a&&this._updateHandler(a,this.calculatePosByValue(o),o),this._updateTrack()}render(){var t,e;this.removeAllChild(!0);const{layout:i="horizontal",railWidth:r,railHeight:o,startText:s,endText:a,min:l,max:h,showHandler:u=!0,showTooltip:d}=this.attribute;let{value:c}=this.attribute;jt(c)&&(c=[l,h]),this._currentValue={startValue:fy(c)[0],endValue:fy(c)[1]};const g=i==="horizontal";this._isHorizontal=g;const f=At.group({x:0,y:0});f.name=en.innerView,this.add(f),this._innerView=f;let p,m=0;if(s&&s.visible){p=At.text(Object.assign({x:g?0:r/2,y:g?o/2:0,textAlign:g?"start":"center",textBaseline:g?"middle":"top",text:s.text,lineHeight:(t=s.style)===null||t===void 0?void 0:t.fontSize},s.style)),p.name=en.startText,f.add(p);const C=_t(s.space)?s.space:0;m+=(g?p.AABBBounds.width():p.AABBBounds.height())+C}const v=At.group({x:g?m:0,y:g?0:m});f.add(v);const b=At.group({x:0,y:0});let y;if(b.name=en.railContainer,this._railContainer=b,v.add(b),this._mainContainer=v,this._renderRail(b),m+=g?r:o,a&&a.visible){const C=_t(a.space)?a.space:0;y=At.text(Object.assign({x:g?m+C:r/2,y:g?o/2:m+C,textAlign:g?"start":"center",textBaseline:g?"middle":"top",text:a.text,lineHeight:(e=a.style)===null||e===void 0?void 0:e.fontSize},a.style)),y.name=en.endText,f.add(y)}this._renderTrack(b),u&&(this._renderHandlers(v),this._bindEvents()),d&&(this._renderTooltip(),this._bindTooltipEvents())}_renderRail(t){const{railWidth:e,railHeight:i,railStyle:r,slidable:o}=this.attribute;let s="default";o!==!1&&(s="pointer");const a=At.rect(Object.assign({x:0,y:0,width:e,height:i,cursor:s},r));return a.name=en.rail,t.add(a),this._rail=a,a}_renderHandlers(t){const{range:e,min:i,max:r,handlerSize:o=14,handlerStyle:s,handlerText:a,railHeight:l,railWidth:h,slidable:u}=this.attribute;let{value:d}=this.attribute;jt(d)&&(d=[i,r]);const c=a&&a.visible,g=this._isHorizontal,[f,p]=fy(d),m=this.calculatePosByValue(f,e?"start":"end"),v=this._renderHandler(Object.assign({x:g?m:h/2,y:g?l/2:m,size:o,strokeBoundsBuffer:0,cursor:u===!1?"default":ff(g)},s));if(v.name=en.startHandler,this._startHandler=v,t.add(v),this._currentValue.startPos=m,c){const b=this._renderHandlerText(f,e?"start":"end");b.name=en.startHandlerText,t.add(b),this._startHandlerText=b}if(e){const b=this.calculatePosByValue(p,"end"),y=this._renderHandler(Object.assign({x:g?b:h/2,y:g?l/2:b,size:o,strokeBoundsBuffer:0,cursor:u===!1?"default":ff(g)},s));if(y.name=en.endHandler,this._endHandler=y,t.add(y),this._currentValue.endPos=b,c){const C=this._renderHandlerText(p,"end");C.name=en.endHandlerText,t.add(C),this._endHandlerText=C}}}_renderTrack(t){const{range:e,min:i,max:r,railHeight:o,railWidth:s,trackStyle:a,railStyle:l,slidable:h,value:u}=this.attribute;let d,c;if(jt(u))e?(d=i,c=r):d=c=i;else if(e){const C=za(u,i,r);d=C[0],c=C[1]}else d=i,c=Qn(u,i,r);const g=this._isHorizontal;e||(d=i);const f=At.group({x:0,y:0,width:s,height:o,cornerRadius:l?.cornerRadius,clip:!0,pickable:!1});f.name=en.trackContainer;const p=ao(e)&&e.draggableTrack===!0;let m;m=h===!1?"default":e===!1||p===!1?"pointer":ff(g);const v=this.calculatePosByValue(d,"start"),b=this.calculatePosByValue(c,e?"end":"start"),y=At.rect(Object.assign({x:g?Math.min(v,b):0,y:g?0:Math.min(v,b),width:g?Math.abs(b-v):s,height:g?o:Math.abs(b-v),cursor:m},a));y.name=en.track,this._track=y,f.add(y),t.add(f)}_renderHandler(t){return At.symbol(t)}_renderHandlerText(t,e){var i,r,o;const{align:s,handlerSize:a=14,handlerText:l={},railHeight:h,railWidth:u,slidable:d}=this.attribute,c=this._isHorizontal,g=this.calculatePosByValue(t,e),f=(i=l.space)!==null&&i!==void 0?i:4,p={text:l.formatter?l.formatter(t):t.toFixed((r=l.precision)!==null&&r!==void 0?r:0),lineHeight:(o=l.style)===null||o===void 0?void 0:o.lineHeight,cursor:d===!1?"default":ff(c)};return c?s==="top"?(p.textBaseline="bottom",p.textAlign="center",p.x=g,p.y=(h-a)/2-f):(p.textBaseline="top",p.textAlign="center",p.x=g,p.y=(h+a)/2+f):s==="left"?(p.textBaseline="middle",p.textAlign="end",p.x=(u-a)/2-f,p.y=g):(p.textBaseline="middle",p.textAlign="start",p.x=(u+a)/2+f,p.y=g),At.text(Object.assign(Object.assign({},p),l.style))}_renderTooltip(){var t;const{tooltip:e,railHeight:i,railWidth:r,align:o}=this.attribute;e&&e.alwaysShow?this._tooltipState={value:this._currentValue.startValue,pos:this._currentValue.startPos}:this._tooltipState=null;const s=this._isHorizontal?0:r/2,a=this._isHorizontal?i/2:0;if(e&&e.shape){const c=At.symbol(Object.assign({pickable:!1,visible:!!this._tooltipState,x:s,y:a,symbolType:"circle"},e.shapeStyle));this._tooltipShape=c,this._mainContainer.add(c)}const l=e&&e.text||{},h=(t=l.space)!==null&&t!==void 0?t:6,u={pickable:!1,visible:!!this._tooltipState,text:""};this._isHorizontal?(u.x=s,u.y=o==="top"?a-i/2-h:a+i/2+h,u.textAlign="center",u.textBaseline=o==="top"?"bottom":"top"):(u.y=a,u.x=o==="left"?s-r/2-h:a+r/2+h,u.textAlign=o==="left"?"end":"start",u.textBaseline="middle");const d=At.text(Object.assign(Object.assign({},u),l.style));this._mainContainer.add(d),this._tooltipText=d,this._tooltipState&&this._updateTooltip()}_updateTooltip(){var t,e;if(!this._tooltipShape&&!this._tooltipText||!this._tooltipState)return;const{railWidth:i,railHeight:r}=this.attribute,o=this._isHorizontal?i:r,s=this._tooltipState.pos*o,a=this._isHorizontal?"x":"y";this._tooltipShape&&this._tooltipShape.setAttributes({visible:!0,[a]:s});const{align:l}=this.attribute;if(this._tooltipText){const h=this.attribute.tooltip&&this.attribute.tooltip.text||{};this._tooltipText.setAttributes({visible:!0,[a]:s,text:h.formatter?h.formatter(this._tooltipState.value):this._isHorizontal||l!=="left"?`≈ ${this._tooltipState.value.toFixed((e=h.precision)!==null&&e!==void 0?e:0)}`:`${this._tooltipState.value.toFixed((t=h.precision)!==null&&t!==void 0?t:0)} ≈`})}}_bindEvents(){if(this.attribute.disableTriggerEvent)return;const{slidable:t,range:e}=this.attribute;t&&(this._startHandler&&this._startHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._startHandlerText&&this._startHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandler&&this._endHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandlerText&&this._endHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),ao(e)&&e.draggableTrack&&this._track.addEventListener("pointerdown",this._onTrackPointerdown),this._railContainer.addEventListener("pointerdown",this._onRailPointerDown),(Bt.env==="browser"?Bt:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1}))}_bindTooltipEvents(){this.attribute.disableTriggerEvent||(this._mainContainer.addEventListener("pointerenter",this._onTooltipShow),this._mainContainer.addEventListener("pointermove",this._onTooltipUpdate),this._mainContainer.addEventListener("pointerleave",this._onTooltipHide))}_clearAllDragEvents(){const t=Wd(),e=Bt.env==="browser"?Bt:this.stage;e.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),t.forEach((i=>{e.removeEventListener(i,this._onHandlerPointerUp)})),e.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),t.forEach((i=>{e.removeEventListener(i,this._onTrackPointerUp)}))}_updateTrack(){const{inverse:t,railWidth:e,railHeight:i}=this.attribute,r=this._startHandler,o=this._endHandler;if(this._isHorizontal){const s=r?.attribute.x;if(o){const a=o?.attribute.x;this._track.setAttributes({x:Math.min(s,a),width:Math.abs(s-a)})}else t?this._track.setAttributes({x:s,width:e-s}):this._track.setAttributes({width:s})}else{const s=r?.attribute.y;if(o){const a=o?.attribute.y;this._track.setAttributes({y:Math.min(s,a),height:Math.abs(s-a)})}else t?this._track.setAttributes({y:s,height:i-s}):this._track.setAttributes({height:s})}}_updateHandler(t,e,i){var r;const o=this._isHorizontal;t.setAttribute(o?"x":"y",e);const s=t.name===en.startHandler?this._startHandlerText:this._endHandlerText;if(s){const{handlerText:a={}}=this.attribute;s.setAttributes({text:a.formatter?a.formatter(i):i.toFixed((r=a.precision)!==null&&r!==void 0?r:0),[o?"x":"y"]:e})}t.name===en.startHandler?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_updateHandlerText(t,e,i){var r;const o=this._isHorizontal,{handlerText:s={}}=this.attribute;t.setAttributes({[o?"x":"y"]:e,text:s.formatter?s.formatter(i):i.toFixed((r=s.precision)!==null&&r!==void 0?r:0)});const a=t.name===en.startHandlerText?this._startHandler:this._endHandler;a&&a.setAttributes({[o?"x":"y"]:e}),t.name===en.startHandlerText?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_dispatchChangeEvent(){const t=!!this.attribute.range,e=this._currentValue;this._dispatchEvent("change",{value:t?[Math.min(e.endValue,e.startValue),Math.max(e.endValue,e.startValue)]:e.startValue,position:t?[Math.min(e.endPos,e.startPos),Math.max(e.endPos,e.startPos)]:e.startPos})}_dispatchTooltipEvent(t){this._dispatchEvent("sliderTooltip",{type:t,position:this._tooltipState&&this._tooltipState.pos,value:this._tooltipState&&this._tooltipState.value})}_getHandlers(){const{inverse:t}=this.attribute;let e=this._startHandler,i=this._endHandler;return i?(this._isHorizontal?(!t&&i.attribute.x<e?.attribute.x||t&&i.attribute.x>e?.attribute.x)&&([e,i]=[i,e]):(!t&&i.attribute.y<e?.attribute.y||t&&i.attribute.y>e?.attribute.y)&&([e,i]=[i,e]),{startHandler:e,endHandler:i}):{startHandler:e,endHandler:i}}release(t){super.release(t),(Bt.env==="browser"?Bt:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1}),this._clearAllDragEvents()}}fg.defaultAttributes={slidable:!0,layout:"horizontal",align:"bottom",height:8,showHandler:!0,handlerSize:14,handlerStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},tooltip:{shapeStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},text:{style:{fill:"#2C3542",fontSize:12}}},railStyle:{fill:"rgba(0,0,0,.04)"},trackStyle:{fill:"#91caff"},showValue:!0,valueStyle:{fill:"#2C3542",fontSize:12},startText:{style:{fill:"#2C3542",fontSize:12}},endText:{style:{fill:"#2C3542",fontSize:12}},handlerText:{visible:!0,space:4,precision:0,style:{fill:"#2C3542",fontSize:12}}};Qit();class Mv extends Wx{constructor(t,e){super(e?.skipDefault?t:Lt({},Mv.defaultAttributes,t)),this.name="colorLegend",this._onSliderToolipChange=i=>{const r=this._slider.tooltipShape;if(r&&i.detail&&!jt(i.detail.value)){const o=this._colorScale.scale(i.detail.value);r.setAttribute("fill",o)}this.dispatchEvent(i)},this._onSliderChange=i=>{this._updateColor(),this.dispatchEvent(i)}}setSelected(t){this._slider&&(this._slider.setValue(t),this._updateColor())}_renderContent(){const{colors:t,slidable:e,layout:i,align:r,min:o,max:s,value:a,railWidth:l,railHeight:h,showHandler:u=!0,handlerSize:d,handlerStyle:c,railStyle:g,trackStyle:f,startText:p,endText:m,handlerText:v,showTooltip:b,tooltip:y,inverse:C,disableTriggerEvent:w}=this.attribute,_=[],A=(s-o)/(t.length-1);for(let S=0;S<t.length;S++)_.push(o+A*S);this._colorScale=new Vit().domain(_,!0).range(t),this._color=this._getTrackColor();const x=new fg({x:0,y:0,range:{draggableTrack:!0},slidable:e,layout:i,align:r,min:o,max:s,value:a,railWidth:l,railHeight:h,showHandler:u,handlerSize:d,handlerStyle:c,railStyle:g,trackStyle:Object.assign({fill:this._color},f),startText:p,endText:m,handlerText:v,showTooltip:b,tooltip:y,disableTriggerEvent:w,inverse:C});this._innerView.add(x),this._slider=x,x.translateTo(0-x.AABBBounds.x1,(this._title?this._title.AABBBounds.height()+Bn(this.attribute,"title.space",gg):0)-x.AABBBounds.y1),this._updateColor()}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}_getTrackColor(){const{colors:t,layout:e,inverse:i}=this.attribute;if(Re(t))return;const r=t.length;if(r===1)return t[0];const o=[];for(let l=0;l<r;l++){const h=l/(r-1);o.push({offset:h,color:t[l]})}const s=e==="horizontal",a={gradient:"linear",stops:o,x0:0,y0:0,x1:s?1:0,y1:s?0:1};return i&&(s?(a.x0=1,a.x1=0):(a.y0=1,a.y1=0)),a}_updateColor(){var t;const{layout:e="horizontal",colors:i,railWidth:r,railHeight:o}=this.attribute,{startHandler:s,endHandler:a,track:l,attribute:h}=this._slider,{startValue:u,endValue:d,startPos:c,endPos:g}=this._slider.currentValue,f=(t=h.handlerStyle)===null||t===void 0?void 0:t.fill;if(s&&!f){const m=this._colorScale.scale(u);s.setAttribute("fill",m)}if(a&&!f){const m=this._colorScale.scale(d);a.setAttribute("fill",m)}const p=e==="horizontal"?r:o;if(Math.abs(c-g)!==p&&i&&i.length>1){const m=this._color.stops,v=Math.min(c,g),b=Math.max(c,g),y=v/p,C=b/p,w=C-y,_=m.filter((R=>R.offset>y&&R.offset<C)),A=Math.min(u,d),x=Math.max(u,d),S=this._colorScale.scale(A),T=this._colorScale.scale(x),M=[{offset:0,color:S}];_.forEach((R=>{M.push({offset:(R.offset-y)/w,color:R.color})})),M.push({offset:1,color:T}),l.setAttribute("fill",Object.assign(Object.assign({},this._color),{stops:M}))}}}Mv.defaultAttributes={layout:"horizontal",title:{align:"start",space:gg,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{fill:null,lineWidth:4,stroke:"#fff",outerBorder:{distance:2,lineWidth:1,stroke:"#ccc"}},tooltip:{shapeStyle:{lineWidth:4,stroke:"#fff"}}};function int(n="bottom"){let t=0;return n==="top"?`
    M${t},-6L${t-3.5},-2.5
    v5
    h7
    v-5
    Z
`:n==="left"?(t=1,`
    M${t-6},0L${t-6+2.5},-3.5
    h5
    v7
    h-5
    Z
`):n==="right"?(t=-1,`
    M${t+6},0L${t+6-2.5},-3.5
    h-5
    v7
    h5
    Z
  `):`
    M${t},6L${t-3.5},2.5
    v-5
    h7
    v5
    Z
`}tnt();class Tv extends Wx{constructor(t,e){super(e?.skipDefault?t:Lt({},Tv.defaultAttributes,t)),this.name="sizeLegend",this._onSliderChange=i=>{this.dispatchEvent(i)},this._onSliderToolipChange=i=>{this.dispatchEvent(i)}}setSelected(t){this._slider&&this._slider.setValue(t)}_renderContent(){const{slidable:t,layout:e,align:i,min:r,max:o,value:s,railWidth:a,railHeight:l,showHandler:h=!0,handlerSize:u,handlerStyle:d,railStyle:c,trackStyle:g,startText:f,endText:p,handlerText:m,showTooltip:v,tooltip:b,sizeBackground:y,disableTriggerEvent:C,inverse:w}=this.attribute,_=At.group({x:0,y:0});this._innerView.add(_);const A=new fg({x:0,y:0,zIndex:1,range:{draggableTrack:!0},slidable:t,layout:e,align:i,min:r,max:o,value:s,railWidth:a,railHeight:l,showHandler:h,handlerSize:u,handlerStyle:Object.assign({symbolType:int(i)},d),railStyle:c,trackStyle:g,startText:f,endText:p,handlerText:m,showTooltip:v,tooltip:b,disableTriggerEvent:C,inverse:w});_.add(A);let x,S=0;e==="horizontal"?i==="top"?(x=`M0,0L${a},0L${w?0:a},12Z`,S=l):(x=`M0,12L${a},12L${w?0:a},0Z`,A.setAttribute("y",12)):i==="left"?x=`M${a},0L${a+12},${w?0:l}L${a},${l}Z`:(x=`M0,${w?0:l}L12,${l}L12,0Z`,A.setAttribute("x",12));const T=At.path(Object.assign(Object.assign({x:0,y:S,path:x},y),{zIndex:0}));_.add(T);const M=this._title?this._title.AABBBounds.height()+Bn(this.attribute,"title.space",gg):0;_.translate(0-_.AABBBounds.x1,M-_.AABBBounds.y1),this._slider=A}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}}Tv.defaultAttributes={layout:"horizontal",title:{align:"start",space:gg,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{lineWidth:1,stroke:"#ccc",fill:"#fff"},sizeBackground:{fill:"rgba(20,20,20,0.1)"}};function nnt(){$n(),Uo(),_v()}nnt();let iD=class nD extends hr{constructor(t,e){super(e?.skipDefault?t:Lt({},nD.defaultAttributes,t)),this.name="title"}render(){var t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C;const{textType:w,text:_,subtextType:A,textStyle:x={},subtext:S,subtextStyle:T={},width:M,height:R,minWidth:E,maxWidth:P,minHeight:B,maxHeight:k,align:L,verticalAlign:O,padding:I=0}=this.attribute,H=No(I),D=this.createOrUpdateChild("title-container",{x:H[3],y:H[0],zIndex:1},"group"),z=(t=x.height)!==null&&t!==void 0?t:R;if(this.attribute.visible!==!1&&x.visible!==!1){const{width:q,maxHeight:st,maxWidth:Q,x:ot=0,y:nt=0,ellipsis:F=!0,wordBreak:N="break-word",maxWidth:W,lineClamp:V}=x;if(w==="rich"||_t(x.character)){const K=Object.assign({x:ot,y:nt,width:(e=q??M)!==null&&e!==void 0?e:0,height:z??0,ellipsis:F==null||F,wordBreak:N??"break-word",maxHeight:st??k,maxWidth:Q??W,textConfig:(i=x.character)!==null&&i!==void 0?i:_},x);this._mainTitle=D.createOrUpdateChild("mainTitle",K,"richtext")}else if(w==="html"){const K=Object.assign({html:Object.assign(Object.assign({dom:_},WR),x),x:ot,y:nt,width:(r=q??M)!==null&&r!==void 0?r:0,height:z??0,ellipsis:F,wordBreak:N,maxHeight:st??k,maxWidth:Q??W,textConfig:[]},x);this._mainTitle=D.createOrUpdateChild("mainTitle",K,"richtext")}else _t(_)&&(this._mainTitle=D.createOrUpdateChild("mainTitle",Object.assign(Object.assign({text:_e(_)?_:[_],whiteSpace:"normal"},x),{maxLineWidth:(s=(o=x.maxLineWidth)!==null&&o!==void 0?o:q)!==null&&s!==void 0?s:M,heightLimit:(a=x.height)!==null&&a!==void 0?a:k,lineClamp:V,ellipsis:F,x:ot,y:nt}),"text"))}const G=this._mainTitle?this._mainTitle.AABBBounds.height():0,U=this._mainTitle?this._mainTitle.AABBBounds.width():0;if(this.attribute.visible!==!1&&T.visible!==!1){const{width:q,height:st,maxWidth:Q,maxHeight:ot,x:nt=0,y:F=0,ellipsis:N=!0,wordBreak:W="break-word",lineClamp:V}=T,K=Math.max(Number.MIN_VALUE,k-G);if(A==="rich"||_t(T.character)){const et=Object.assign({x:nt,y:F,width:(l=q??M)!==null&&l!==void 0?l:0,height:(h=st??R)!==null&&h!==void 0?h:0,ellipsis:N,wordBreak:W,maxHeight:ot??K,maxWidth:Q??P,textConfig:(u=T.character)!==null&&u!==void 0?u:S},T);this._subTitle=D.createOrUpdateChild("subTitle",et,"richtext")}else if(A==="html"){const et=Object.assign({html:Object.assign(Object.assign({dom:S},WR),T),x:nt,y:F,width:(d=q??M)!==null&&d!==void 0?d:0,height:(c=st??R)!==null&&c!==void 0?c:0,ellipsis:N,wordBreak:W,maxHeight:ot??K,maxWidth:Q??P,textConfig:[]},T);this._subTitle=D.createOrUpdateChild("subTitle",et,"richtext")}else _t(S)&&(this._subTitle=D.createOrUpdateChild("subTitle",Object.assign(Object.assign({text:_e(S)?S:[S],whiteSpace:"normal"},T),{maxLineWidth:(g=T.maxLineWidth)!==null&&g!==void 0?g:M,heightLimit:(f=T.heightLimit)!==null&&f!==void 0?f:K,lineClamp:V,ellipsis:N,x:0,y:G}),"text"))}const j=this._subTitle?this._subTitle.AABBBounds.height():0,X=this._subTitle?this._subTitle.AABBBounds.width():0;let Z=Math.max(U,X),J=G+((p=T.height)!==null&&p!==void 0?p:j);if(_t(M)&&(Z=M),_t(R)&&(J=R),_t(E)&&Z<E&&(Z=E),_t(P)&&Z>P&&(Z=P),_t(B)&&J<B&&(J=B),_t(k)&&J>k&&(J=k),D.attribute.width=Z,D.attribute.height=J,D.attribute.boundsPadding=H,this._mainTitle){if(_t(L)||_t(x.align)){const Q=x.align?x.align:L,ot=(m=x.width)!==null&&m!==void 0?m:Z;Q==="center"?(this._mainTitle.setAttribute("x",ot/2),this._mainTitle.setAttribute("textAlign","center")):Q==="right"?(this._mainTitle.setAttribute("x",ot),this._mainTitle.setAttribute("textAlign","right")):(this._mainTitle.setAttribute("x",0),this._mainTitle.setAttribute("textAlign","left"))}const q=x.verticalAlign?x.verticalAlign:O,st=z??(this._mainTitle.AABBBounds.empty()?0:this._mainTitle.AABBBounds.height());q==="middle"?(this._mainTitle.setAttribute("y",st/2),this._mainTitle.setAttribute("textBaseline","middle")):q==="bottom"?(this._mainTitle.setAttribute("y",st),this._mainTitle.setAttribute("textBaseline","bottom")):(this._mainTitle.setAttribute("y",0),this._mainTitle.setAttribute("textBaseline","top"))}if(this._subTitle){if(_t(L)||_t(T.align)){const ot=T.align?T.align:L,nt=(b=(v=T.width)!==null&&v!==void 0?v:x.width)!==null&&b!==void 0?b:Z;ot==="center"?(this._subTitle.setAttribute("x",nt/2),this._subTitle.setAttribute("textAlign","center")):ot==="right"?(this._subTitle.setAttribute("x",nt),this._subTitle.setAttribute("textAlign","right")):(this._subTitle.setAttribute("x",0),this._subTitle.setAttribute("textAlign","left"))}const q=T.verticalAlign?T.verticalAlign:O,st=this._mainTitle?_t(z)?this._mainTitle.AABBBounds.y1+Math.max(this._mainTitle.AABBBounds.empty()?0:this._mainTitle.AABBBounds.height(),z):this._mainTitle.AABBBounds.y2:0,Q=(C=(y=T.height)!==null&&y!==void 0?y:R)!==null&&C!==void 0?C:this._subTitle.AABBBounds.empty()?0:this._subTitle.AABBBounds.height();q==="middle"?(this._subTitle.setAttribute("y",st+Q/2),this._subTitle.setAttribute("textBaseline","middle")):q==="bottom"?(this._subTitle.setAttribute("y",st+Q),this._subTitle.setAttribute("textBaseline","bottom")):(this._subTitle.setAttribute("y",st),this._subTitle.setAttribute("textBaseline","top"))}}};iD.defaultAttributes={textStyle:{ellipsis:"...",fill:"#333",fontSize:20,fontWeight:"bold",textAlign:"left",textBaseline:"top"},subtextStyle:{ellipsis:"...",fill:"#6F6F6F",fontSize:16,fontWeight:"normal",textAlign:"left",textBaseline:"top"}};function rnt(){$n(),Os(),Uo(),Cv()}const ont='<svg width="200" height="200" viewBox="0 0 1024 1024" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path d="M877.44815445 206.10060629a64.72691371 64.72691371 0 0 0-95.14856334 4.01306852L380.73381888 685.46812814 235.22771741 533.48933518a64.72691371 64.72691371 0 0 0-92.43003222-1.03563036l-45.82665557 45.82665443a64.72691371 64.72691371 0 0 0-0.90617629 90.61767965l239.61903446 250.10479331a64.72691371 64.72691371 0 0 0 71.19960405 15.14609778 64.33855261 64.33855261 0 0 0 35.08198741-21.23042702l36.24707186-42.71976334 40.5190474-40.77795556-3.36579926-3.49525333 411.40426297-486.74638962a64.72691371 64.72691371 0 0 0-3.88361443-87.64024149l-45.3088404-45.43829334z"></path></svg>',snt='<svg width="200" height="200" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="5" d="M5 12h14"/></svg>';rnt();class ya extends hr{constructor(t,e){super(e?.skipDefault?t:Lt({},ya.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||(this.attribute.checked?(this.setAttribute("checked",!1),this.setAttribute("indeterminate",!1)):(this.setAttribute("checked",!0),this.setAttribute("indeterminate",!1)),this._dispatchEvent("checkbox_state_change",{eventType:"checkbox_state_change",checked:this.attribute.checked}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(i,r,o)=>{"interactive"in i&&this.setAttribute("pickable",i.interactive),"disabled"in i&&this.setAttribute("cursor",i.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderBox(),this.renderIcon(),this.renderText(),this.layout()}renderBox(){this._box=new dg(Lt({},this.attribute.box));const t=this.attribute.checked||this.attribute.indeterminate;t&&this.attribute.disabled?this._box.setAttributes({fill:this.attribute.box.disableCheckedFill,stroke:this.attribute.box.disableCheckedStroke}):t?this._box.setAttributes({fill:this.attribute.box.checkedFill,stroke:this.attribute.box.checkedStroke}):this.attribute.disabled&&this._box.setAttributes({fill:this.attribute.box.disableFill}),this.appendChild(this._box)}renderIcon(){this._checkIcon=new zo(Lt({image:this.attribute.icon.checkIconImage},this.attribute.icon)),this.appendChild(this._checkIcon),this._indeterminateIcon=new zo(Lt({image:this.attribute.icon.indeterminateIconImage},this.attribute.icon)),this.appendChild(this._indeterminateIcon),this.attribute.checked?(this._checkIcon.setAttribute("visible",!0),this._indeterminateIcon.setAttribute("visible",!1)):this.attribute.indeterminate?(this._checkIcon.setAttribute("visible",!1),this._indeterminateIcon.setAttribute("visible",!0)):(this._checkIcon.setAttribute("visible",!1),this._indeterminateIcon.setAttribute("visible",!1))}renderText(){this._text=new Oe(Lt({wrap:!0},this.attribute.text)),this.attribute.disabled&&this._text.setAttribute("fill",this.attribute.text.disableFill),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){const t=this.attribute.box.height,e=this.attribute.icon.height,i=this._text.AABBBounds.height(),r=Math.max(t,e,i),o=r/2-t/2,s=r/2-e/2,a=r/2-i/2,l=this.attribute.box.width,h=this.attribute.icon.width,u=Math.max(l,h),d=u/2-l/2,c=u/2-h/2,g=u+this.attribute.spaceBetweenTextAndIcon;this._box.setAttributes({x:d,y:o}),this._checkIcon.setAttributes({x:c,y:s}),this._indeterminateIcon.setAttributes({x:c,y:s}),this._text.setAttributes({x:g,y:a})}initAttributes(t,e){t=e?.skipDefault?t:Lt({},ya.defaultAttributes,t),super.initAttributes(t),this.renderGroup(),this.render()}}ya.defaultAttributes={interactive:!0,disabled:!1,checked:!1,indeterminate:!1,cursor:"pointer",disableCursor:"not-allowed",spaceBetweenTextAndIcon:8,text:{text:"text",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",textBaseline:"top",pickable:!1},icon:{checkIconImage:ont,indeterminateIconImage:snt,width:10,height:10,pickable:!1},box:{width:14,height:14,cornerRadius:2,fill:"#fff",stroke:"rgb(229,230,235)",disableFill:"rgb(242,243,245)",checkedFill:"rgb(22, 93, 255)",checkedStroke:"rgb(22, 93, 255)",disableCheckedFill:"rgb(148, 191, 255)",disableCheckedStroke:"rgb(148, 191, 255)",pickable:!1}};function ant(){$n(),Os(),IQ(),Cv()}ant();class Mu extends hr{constructor(t,e){super(e?.skipDefault?t:Lt({},Mu.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||this.attribute.checked||(this.setAttribute("checked",!0),this._dispatchEvent("radio_checked",{eventType:"radio_checked",target:this}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(i,r,o)=>{"interactive"in i&&this.setAttribute("pickable",i.interactive),"disabled"in i&&this.setAttribute("cursor",i.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderCircle(),this.renderText(),this.layout()}renderCircle(){this._circle=new Cu(Lt({},this.attribute.circle));const t=this.attribute.checked;t&&this.attribute.disabled?this._circle.setAttributes({fill:this.attribute.circle.disableCheckedFill,stroke:this.attribute.circle.disableCheckedStroke}):t?this._circle.setAttributes({fill:this.attribute.circle.checkedFill,stroke:this.attribute.circle.checkedStroke}):this.attribute.disabled&&this._circle.setAttributes({fill:this.attribute.circle.disableFill}),this.appendChild(this._circle)}renderText(){this._text=new Oe(Lt({},this.attribute.text)),this.attribute.disabled&&this._text.setAttribute("fill",this.attribute.text.disableFill),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){const t=2*(this.attribute.circle.outerRadius+this.attribute.circle.lineWidth),e=this._text.AABBBounds.height(),i=Math.max(t,e),r=i/2-t/2+this.attribute.circle.outerRadius+this.attribute.circle.lineWidth,o=i/2-e/2,s=2*(this.attribute.circle.outerRadius+this.attribute.circle.lineWidth),a=this.attribute.circle.outerRadius+this.attribute.circle.lineWidth,l=s+this.attribute.spaceBetweenTextAndIcon;this._circle.setAttributes({x:a,y:r}),this._text.setAttributes({x:l,y:o})}initAttributes(t,e){t=e?.skipDefault?t:Lt({},Mu.defaultAttributes,t),super.initAttributes(t),this.renderGroup(),this.render()}}Mu.defaultAttributes={interactive:!0,disabled:!1,checked:!1,cursor:"pointer",disableCursor:"not-allowed",spaceBetweenTextAndIcon:8,text:{text:"text",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",textBaseline:"top",pickable:!1},circle:{outerRadius:7,innerRadius:3,startAngle:0,endAngle:2*Math.PI,lineWidth:1,fill:"#fff",stroke:"rgb(229,230,235)",disableFill:"rgb(242,243,245)",checkedFill:"rgb(22, 93, 255)",checkedStroke:"rgb(22, 93, 255)",disableCheckedFill:"rgb(148, 191, 255)",disableCheckedStroke:"rgb(148, 191, 255)",pickable:!1}};function lnt(){$n(),Uo(),Cv()}const hnt='<svg t="1716726614852" class="icon" viewBox="0 0 1194 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2621" width="200" height="200"><path d="M1038.694079 367.237067c13.265507 23.342857-16.633865-40.004445-63.05621-40.004446H219.018794c-26.558738 0-46.46393 13.334815-63.05621 40.004446S0.006238 607.277601 0.006238 650.608819V940.647979a82.351494 82.351494 0 0 0 82.961402 83.349526H1111.702885a82.337632 82.337632 0 0 0 82.975264-83.349526V650.608819c0-43.331218-155.970208-283.371753-155.970208-283.371752zM730.066575 667.284269a136.328386 136.328386 0 0 1-132.738243 133.33429 133.417459 133.417459 0 0 1-132.738243-133.33429v-6.681269a40.6698 40.6698 0 0 0-36.497473-26.66963H73.015044l119.458874-220.02445s23.231965-40.004445 53.103614-40.004446h713.481918c26.544876 0 29.871649 10.008042 46.436207 40.004446L1128.33675 633.947231H769.904682c-26.184476 0-39.838107 7.623855-39.838107 33.337038zM338.505391 210.559919l-89.601086-86.69016a22.178487 22.178487 0 0 1 0-33.26773 21.984425 21.984425 0 0 1 33.170699 0l89.601087 86.676299a22.317102 22.317102 0 0 1 0 33.26773 24.950798 24.950798 0 0 1-33.1707 0z m252.197118-40.059891a25.532983 25.532983 0 0 1-6.639685-16.633865l-3.326773-126.694606A28.263709 28.263709 0 0 1 603.995739 0.515788c13.251646-3.326773 23.204242 10.021904 26.544877 23.342858V153.866163a28.249847 28.249847 0 0 1-23.259688 26.66963c-6.611961-3.312911-13.279369-3.312911-16.578419-10.035765z m235.646421 33.337038a22.372548 22.372548 0 0 1 0-33.337038l86.288175-90.030795a22.039871 22.039871 0 0 1 33.170699 0 22.289379 22.289379 0 0 1 0 33.364761l-82.961401 90.003072a25.962691 25.962691 0 0 1-36.483611 0z" fill="#8a8a8a" p-id="2622"></path></svg>';lnt();let rD=class oD extends hr{constructor(t,e){super(e?.skipDefault?t:Lt({},oD.defaultAttributes,t))}render(){this.removeAllChild(!0),this.renderIcon(),this.renderText(),this.layout()}renderIcon(){this._emptyTipIcon=new zo(Lt({image:this.attribute.icon.image},this.attribute.icon)),this.appendChild(this._emptyTipIcon)}renderText(){this._text=new Oe(Lt({wrap:!0},this.attribute.text)),this.appendChild(this._text)}layout(){const t=this.attribute.icon.height,e=this._text.AABBBounds.height(),i=this.attribute.icon.width,{width:r,height:o,spaceBetweenTextAndIcon:s}=this.attribute;this._emptyTipIcon.setAttribute("x",r/2-i/2),this._emptyTipIcon.setAttribute("y",o/2-t/2-e/2-s/2),this._text.setAttribute("x",r/2),this._text.setAttribute("textAlign","center"),this._text.setAttribute("y",o/2+t/2+s/2),this._text.setAttribute("textBaseline","middle")}};rD.defaultAttributes={spaceBetweenTextAndIcon:20,text:{text:"no data",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",pickable:!1},icon:{image:hnt,width:100,height:100,pickable:!1}};function unt(){$n(),Os(),Uo(),fH()}unt();class zc extends hr{constructor(t,e){super(e?.skipDefault?t:Lt({},zc.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||(this.attribute.checked?this.setAttribute("checked",!1):this.setAttribute("checked",!0),this._dispatchEvent("switch_state_change",{eventType:"switch_state_change",checked:this.attribute.checked}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(i,r,o)=>{"interactive"in i&&this.setAttribute("pickable",i.interactive),"disabled"in i&&this.setAttribute("cursor",i.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderBox(),this.renderCircle(),this.renderText(),this.layout()}renderBox(){this._box=new dg(Lt({},this.attribute.box)),this.attribute.disabled&&this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.disableCheckedFill}):this.attribute.disabled&&!this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.disableUncheckedFill}):this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.checkedFill}):this._box.setAttributes({fill:this.attribute.box.uncheckedFill}),this.appendChild(this._box)}renderCircle(){this._circle=new ma(Lt({},this.attribute.circle)),this.appendChild(this._circle)}renderText(){var t,e,i;this._text=new Oe(Lt({},(t=this.attribute.text)!==null&&t!==void 0?t:{})),this.attribute.checked&&(!((e=this.attribute.text)===null||e===void 0)&&e.checkedText)?this._text.setAttributes({text:this.attribute.text.checkedText}):!((i=this.attribute.text)===null||i===void 0)&&i.uncheckedText&&this._text.setAttributes({text:this.attribute.text.uncheckedText}),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){var t,e,i,r,o,s,a,l,h,u;const d=this.attribute.spaceBetweenTextAndCircle,c=this.attribute.circle.radius,g=this.attribute.box.height,f=2*c,p=this._text.AABBBounds.height(),m=Math.max(g,f,p),v=m/2-f/2+c,b=m/2-p/2,y=this.attribute.box.width,C=2*c,w=wv(((i=(e=(t=this.attribute.text)===null||t===void 0?void 0:t.checkedText)===null||e===void 0?void 0:e.length)!==null&&i!==void 0?i:0)>((s=(o=(r=this.attribute.text)===null||r===void 0?void 0:r.uncheckedText)===null||o===void 0?void 0:o.length)!==null&&s!==void 0?s:0)?(l=(a=this.attribute.text)===null||a===void 0?void 0:a.checkedText)!==null&&l!==void 0?l:"":(u=(h=this.attribute.text)===null||h===void 0?void 0:h.uncheckedText)!==null&&u!==void 0?u:"",this._text.attribute).width,_=Math.max(y,C+w+3*d),A=g/2-C/2+c,x=A+c+d;this._box.setAttributes({width:_,height:m}),this._circle.setAttributes({y:v,x:this.attribute.checked?_-A:A}),this._text.setAttributes({x:this.attribute.checked?_-x-w:x,y:b})}initAttributes(t,e){t=e?.skipDefault?t:Lt({},zc.defaultAttributes,t),super.initAttributes(t),this.renderGroup(),this.render()}}zc.defaultAttributes={interactive:!0,disabled:!1,checked:!1,cursor:"pointer",disableCursor:"not-allowed",circle:{radius:8,fill:"#FFF",pickable:!1},box:{width:40,height:24,cornerRadius:12,uncheckedFill:"rgb(201,205,212)",checkedFill:"#165DFF",disableUncheckedFill:"rgb(242,243,245)",disableCheckedFill:"rgb(148,191,255)",pickable:!1},text:{textAlign:"left",textBaseline:"top",pickable:!1},spaceBetweenTextAndCircle:6};let pB=!1;function sD(){pB||(pB=!0,Oc(),xx()?v0(Et):aK()&&C0(Et),PQ(),fH(),$n(),Cv(),Px(),Os(),_v(),OQ(),Du(),Uo(),IT(),QQ(),IT())}function mB(n,t){let e=null;return function(...i){e||(n.apply(this,i),e=setTimeout((()=>{e=null}),t))}}function fs(n,t){const e=n.getFullYear().toString(),i=(n.getMonth()+1).toString().padStart(2,"0"),r=n.getDate().toString().padStart(2,"0");if((t=(t=(t=t.replace("yyyy",e)).replace("mm",i)).replace("dd",r)).length>10){const o=n.getHours().toString().padStart(2,"0"),s=n.getMinutes().toString().padStart(2,"0"),a=n.getSeconds().toString().padStart(2,"0");t=(t=(t=t.replace("hh",o)).replace("mm",s)).replace("ss",a)}return t}function dnt(n,t){const e=t.indexOf("yyyy"),i=t.indexOf("mm"),r=t.indexOf("dd"),o=i<e?i<r?0:1:i<r?1:2,s=r<e?r<i?0:1:r<i?1:2,a=parseInt(n[e<i?e<r?0:1:i<r?1:2],10),l=parseInt(n[o],10)-1,h=parseInt(n[s],10);if(isNaN(a)||a<1||isNaN(l)||l<0||l>11)return!1;const u=[31,gnt(a)?29:28,31,30,31,30,31,31,30,31,30,31];return!(isNaN(h)||h<1||h>u[l])}function cnt(n,t){if(t.includes("hh")||t.includes("mm")||t.includes("ss")){const e=t.indexOf("hh")>-1?t.indexOf("hh"):t.indexOf("HH"),i=parseInt(n[e],10),r=parseInt(n[e+1],10),o=n.length>e+2?parseInt(n[e+2],10):0;if(isNaN(i)||i<0||i>23||isNaN(r)||r<0||r>59||isNaN(o)||o<0||o>59)return!1}return!0}function gnt(n){return n%4==0&&n%100!=0||n%400==0}function pf(n){const t=["yyyy-mm-dd","dd-mm-yyyy","mm/dd/yyyy","yyyy/mm/dd","dd/mm/yyyy","yyyy.mm.dd","mm.dd.yyyy","dd.mm.yyyy"],e=["hh:mm:ss","hh:mm"],i=(n=n.trim()).split(" "),r=i[0],o=i[1];let s,a;if(r)for(let l=0;l<t.length;l++){const h=t[l],u=r.split(py(h)),d=dnt(u,h);if(u.length===3&&d){s=h;break}}if(s&&o)for(let l=0;l<e.length;l++){const h=e[l],u=o.split(py(h)),d=h.split(py(h));if(cnt(u,h)&&u.length===d.length){a=h;break}}return r&&o&&s&&a?s+" "+a:r&&!o?s:"yyyy-mm-dd hh:mm:ss"}function py(n){const t=n.match(/[^\w]/g);if(t){const e=t.map((i=>"\\"+i)).join("|");return new RegExp(e,"g")}return/[^\w]/}function aD(n,t){return n.replace(/\{([^}]+)\}/g,((e,i)=>{const r=i.split(".");let o=t;for(const s of r){if(!o.hasOwnProperty(s)){o=e;break}o=o[s]}return o}))}function pg(n){return Array.isArray(n)?n.length===3?[n[0],n[1],n[2],n[1]]:n.length===2?[n[0],n[1],n[0],n[1]]:n.length===1?[n[0],n[0],n[0],n[0]]:[n[0],n[1],n[2],n[3]]:[n,n,n,n]}function fnt(n){const t=new Date(n.getFullYear(),0,1);return Math.ceil(((n.getTime()+1-t.getTime())/864e5+1)/7)}function pnt(n,t){const e=Object.getOwnPropertyDescriptor(n,t);return!!e&&(!!e.set||e.writable===!0)}function Ye(n,t=!1){let e;if(n){if(e=new Date(n),typeof n=="string"){if(n.length>10)return t&&e.setHours(0,0,0,0),e;e.setHours(0,0,0,0)}}else e=new Date;return t&&e.setHours(0,0,0,0),e}function mnt(n,t=!1){let e;if(n){if(e=new Date(n),typeof n=="string"){if(n.length>10)return t&&e.setMinutes(59,59,999),e;e.setMinutes(59,59,999)}}else e=new Date;return t&&e.setMinutes(59,59,999),e}function vnt(n,t=!1){let e;if(n){if(e=new Date(n),typeof n=="string"){if(n.length>10)return t&&e.setSeconds(59,999),e;e.setSeconds(59,999)}}else e=new Date;return t&&e.setSeconds(59,999),e}function lD(n,t=!1){let e;if(n){if(e=new Date(n),typeof n=="string"){if(n.length>10)return t&&e.setMilliseconds(999),e;e.setMilliseconds(999)}}else e=new Date;return t&&e.setMilliseconds(999),e}function Ks(n,t=!1){let e;if(n){if(e=new Date(n),typeof n=="string"){if(n.length>10)return t&&e.setHours(23,59,59,999),e;e.setHours(23,59,59,999)}}else e=new Date;return t&&e.setHours(23,59,59,999),e}function Tu(n,t,e,i){let r=new Date(t);switch(e){case"second":r.setMilliseconds(999);break;case"minute":r.setSeconds(59,999);break;case"hour":r.setMinutes(59,59,999);break;case"day":r.setHours(23,59,59,999);break;case"week":const a=6-r.getDay();r.setDate(r.getDate()+a),r.setHours(23,59,59,999);break;case"month":const l=new Date(r.getFullYear(),r.getMonth()+1,0).getDate();r.setDate(l),r.setHours(23,59,59,999);break;case"quarter":const h=r.getMonth(),u=h-h%3+2,d=new Date(r.getFullYear(),u+1,0).getDate();r.setMonth(u,d),r.setHours(23,59,59,999);break;case"year":r.setMonth(11,31),r.setHours(23,59,59,999);break;default:throw new Error("Invalid time scale")}const o=ce(r,n,e,i,1),s=Math.ceil(o);if(s>o){const a=(s-o)*i,l=1e3,h=60*l,u=60*h,d=24*u,c=7*d;switch(new Date(r.getTime()+1),e){case"second":r.setTime(r.getTime()+a*l);break;case"minute":r.setTime(r.getTime()+a*h);break;case"hour":r.setTime(r.getTime()+a*u);break;case"day":r.setTime(r.getTime()+a*d);break;case"week":r.setTime(r.getTime()+a*c);break;case"month":r=new Date(r.getFullYear(),r.getMonth()+1+Math.round(a),0),r.setHours(23,59,59,999);break;case"quarter":const g=r.getMonth(),f=g-g%3+2;r=new Date(r.getFullYear(),f+Math.round(3*a)+1,0),r.setHours(23,59,59,999);break;case"year":r.setFullYear(r.getFullYear()+Math.floor(a)),r.setHours(23,59,59,999);break;default:throw new Error("Invalid time scale")}}return r}function Nl(n,t,e="monday"){const i=new Date(n);switch(t){case"second":i.setMilliseconds(0);break;case"minute":i.setSeconds(0,0);break;case"hour":i.setMinutes(0,0,0);break;case"day":i.setHours(0,0,0,0);break;case"week":const r=i.getDay();let o=r;o=e==="monday"?r===0?-6:1-r:-r,i.setDate(i.getDate()+o),i.setHours(0,0,0,0);break;case"month":i.setDate(1),i.setHours(0,0,0,0);break;case"quarter":const s=i.getMonth(),a=s-s%3;i.setMonth(a,1),i.setHours(0,0,0,0);break;case"year":i.setMonth(0,1),i.setHours(0,0,0,0);break;default:throw new Error("Invalid time scale")}return i}function ce(n,t,e,i,r=0){let o;const s=new Date(n.getTime()+r);switch(e){case"second":o=(s.getTime()-t.getTime())/1e3;break;case"minute":o=(s.getTime()-t.getTime())/6e4;break;case"hour":o=(s.getTime()-t.getTime())/36e5;break;case"day":o=(s.getTime()-t.getTime())/864e5;break;case"week":o=(s.getTime()-t.getTime())/6048e5;break;case"month":o=12*(s.getFullYear()-t.getFullYear())+(s.getMonth()-t.getMonth()),o+=(s.getDate()-t.getDate())/new Date(s.getFullYear(),s.getMonth()+1,0).getDate();break;case"quarter":o=4*(s.getFullYear()-t.getFullYear())+(s.getMonth()-t.getMonth())/3,o+=(s.getDate()-t.getDate())/(3*new Date(s.getFullYear(),s.getMonth()+1,0).getDate());break;case"year":o=s.getFullYear()-t.getFullYear(),o+=(s.getMonth()-t.getMonth())/12;break;default:throw new Error("Invalid time scale")}return o/i}class bnt{constructor(t){var e;this._scene=t,this.scrollLeft=0,this.scrollTop=0,this.x=0,this.y=t._gantt.getAllHeaderRowsHeight(),this.width=t.ganttGroup.attribute.width,this.height=t.ganttGroup.attribute.height-t.timelineHeader.group.attribute.height,this.rowHeight=t._gantt.parsedOptions.rowHeight,this.rowCount=t._gantt.itemCount,this.allGridWidth=t._gantt.getAllDateColsWidth(),this.allGridHeight=t._gantt.getAllTaskBarsHeight(),this.group=new Jt({x:this.x,y:this.y,width:this.width,height:this.height,clip:!0,fill:(e=t._gantt.parsedOptions.grid)===null||e===void 0?void 0:e.backgroundColor}),this.group.name="grid-container",t.ganttGroup.addChild(this.group),this.createVerticalBackgroundRects(),this.createHorizontalBackgroundRects(),this.createVerticalLines(),this.createHorizontalLines(),this.createTimeLineHeaderBottomLine()}createTimeLineHeaderBottomLine(){var t,e,i,r,o,s,a,l,h;const u=this._scene._gantt.parsedOptions,d=(e=(t=u.horizontalSplitLine)===null||t===void 0?void 0:t.lineWidth)!==null&&e!==void 0?e:(i=u.timelineHeaderHorizontalLineStyle)===null||i===void 0?void 0:i.lineWidth,c=(1&d?-.5:0)+d/2,g=Ke({pickable:!1,stroke:(o=(r=u.horizontalSplitLine)===null||r===void 0?void 0:r.lineColor)!==null&&o!==void 0?o:(s=u.timelineHeaderHorizontalLineStyle)===null||s===void 0?void 0:s.lineColor,lineWidth:d+(1&d?1:0),lineDash:(l=(a=u.horizontalSplitLine)===null||a===void 0?void 0:a.lineDash)!==null&&l!==void 0?l:(h=u.timelineHeaderHorizontalLineStyle)===null||h===void 0?void 0:h.lineDash,points:[{x:0,y:c},{x:this._scene._gantt.getAllDateColsWidth(),y:c}]});g.name="timeLine-header-bottom-line",this.group.addChild(g)}createVerticalLines(){var t,e;const i=this._scene._gantt.parsedOptions.grid,r=(t=i.verticalLineDependenceOnTimeScale)!==null&&t!==void 0?t:this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0].unit;if(i.verticalLine){this.verticalLineGroup=new Jt({x:0,y:0,width:this.allGridWidth,height:this.allGridHeight}),this.verticalLineGroup.name="grid-vertical",this.group.appendChild(this.verticalLineGroup);const o=(e=this._scene._gantt.parsedOptions.reverseSortedTimelineScales.find((u=>u.unit===r)))!==null&&e!==void 0?e:this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],{unit:s,step:a}=this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],{timelineDates:l}=o,h=this._scene._gantt.parsedOptions.timelineColWidth;if(typeof i.verticalLine=="function")for(let u=0;u<l?.length-1;u++){const{endDate:d}=l[u],c=i.verticalLine({index:u,dateIndex:l[u].dateIndex,date:l[u].endDate,ganttInstance:this._scene._gantt}),g=Math.ceil(ce(d,this._scene._gantt.parsedOptions.minDate,s,a,1)*h)+(1&c.lineWidth?.5:0),f=Ke({pickable:!1,stroke:c.lineColor,lineWidth:c.lineWidth,lineDash:c.lineDash,points:[{x:g,y:0},{x:g,y:this.allGridHeight}]});this.verticalLineGroup.appendChild(f)}else{const u=i.verticalLine;for(let d=0;d<l?.length-1;d++){const{endDate:c}=l[d],g=Math.ceil(ce(c,this._scene._gantt.parsedOptions.minDate,s,a,1)*h)+(1&u.lineWidth?.5:0),f=Ke({pickable:!1,stroke:u.lineColor,lineWidth:u.lineWidth,lineDash:u.lineDash,points:[{x:g,y:0},{x:g,y:this.allGridHeight}]});this.verticalLineGroup.appendChild(f)}}}}createHorizontalLines(){const t=this._scene._gantt.parsedOptions.grid;if(t.horizontalLine)if(this.horizontalLineGroup=new Jt({x:0,y:0,width:this.allGridWidth,height:this.allGridHeight}),this.horizontalLineGroup.name="grid-horizontal",this.group.appendChild(this.horizontalLineGroup),typeof t.horizontalLine=="function"){let e=.5;for(let i=0;i<this.rowCount-1;i++){const r=t.horizontalLine({index:i,ganttInstance:this._scene._gantt});e+=this._scene._gantt.getRowHeightByIndex(i);const o=Ke({pickable:!1,stroke:r.lineColor,lineWidth:r.lineWidth,lineDash:r.lineDash,points:[{x:0,y:e},{x:this.allGridWidth,y:e}]});this.horizontalLineGroup.appendChild(o)}}else{const e=t.horizontalLine;let i=0;1&e.lineWidth&&(i+=.5);for(let r=0;r<this.rowCount-1;r++){i+=this._scene._gantt.getRowHeightByIndex(r);const o=Ke({pickable:!1,stroke:e.lineColor,lineWidth:e.lineWidth,lineDash:e.lineDash,points:[{x:0,y:i},{x:this.allGridWidth,y:i}]});this.horizontalLineGroup.appendChild(o)}}}createVerticalBackgroundRects(){const t=this._scene._gantt.parsedOptions.grid.verticalBackgroundColor,e=this._scene._gantt.parsedOptions.grid.weekendBackgroundColor;if(t||e){this.verticalBackgroundRectsGroup=new Jt({x:0,y:0,width:this.allGridWidth,height:this.allGridHeight}),this.verticalBackgroundRectsGroup.name="grid-vertical-background",this.group.appendChild(this.verticalBackgroundRectsGroup);const{timelineDates:i,unit:r,step:o}=this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],s=this._scene._gantt.parsedOptions.timelineColWidth;if(t||e)for(let a=0;a<=i?.length-1;a++){let l;if(!e||r!=="day"||o!==1||i[a].startDate.getDay()!==0&&i[a].startDate.getDay()!==6?typeof t=="function"?l=t({index:a,dateIndex:i[a].dateIndex,date:i[a].endDate,ganttInstance:this._scene._gantt}):t&&(l=t[a%t.length]):l=e,l){const h=Math.ceil(s*a),u=be({pickable:!1,fill:l,x:h,y:0,width:s,height:this.allGridHeight});this.verticalBackgroundRectsGroup.appendChild(u)}}}}createHorizontalBackgroundRects(){const t=this._scene._gantt.parsedOptions.grid.horizontalBackgroundColor;if(t){this.horizontalBackgroundRectsGroup=new Jt({x:0,y:0,width:this.allGridWidth,height:this.allGridHeight}),this.horizontalBackgroundRectsGroup.name="grid-horizontal-background",this.group.appendChild(this.horizontalBackgroundRectsGroup);let e=0;for(let i=0;i<=this.rowCount-1;i++){let r;r=typeof t=="function"?t({index:i,ganttInstance:this._scene._gantt}):t[i%t.length];const o=be({pickable:!1,fill:r,x:0,y:e,width:this.allGridWidth,height:this._scene._gantt.getRowHeightByIndex(i)});this.horizontalBackgroundRectsGroup.appendChild(o),e+=this._scene._gantt.getRowHeightByIndex(i)}}}refresh(){this.width=this._scene.ganttGroup.attribute.width,this.height=this._scene.ganttGroup.attribute.height-this._scene.timelineHeader.group.attribute.height,this.group.setAttributes({width:this.width,height:this.height,y:this._scene._gantt.getAllHeaderRowsHeight()}),this.rowCount=this._scene._gantt.itemCount,this.allGridWidth=this._scene._gantt.getAllDateColsWidth(),this.allGridHeight=this._scene._gantt.getAllTaskBarsHeight(),this.group.removeAllChild(),this.createVerticalBackgroundRects(),this.createHorizontalBackgroundRects(),this.createVerticalLines(),this.createHorizontalLines(),this.createTimeLineHeaderBottomLine()}setX(t){var e,i,r,o;(e=this.verticalLineGroup)===null||e===void 0||e.setAttribute("x",t),(i=this.horizontalLineGroup)===null||i===void 0||i.setAttribute("x",t),(r=this.verticalBackgroundRectsGroup)===null||r===void 0||r.setAttribute("x",t),(o=this.horizontalBackgroundRectsGroup)===null||o===void 0||o.setAttribute("x",t)}setY(t){var e,i,r,o;(e=this.verticalLineGroup)===null||e===void 0||e.setAttribute("y",t),(i=this.horizontalLineGroup)===null||i===void 0||i.setAttribute("y",t),(r=this.verticalBackgroundRectsGroup)===null||r===void 0||r.setAttribute("y",t),(o=this.horizontalBackgroundRectsGroup)===null||o===void 0||o.setAttribute("y",t)}resize(){this.width=this._scene.ganttGroup.attribute.width,this.height=this._scene.ganttGroup.attribute.height-this._scene.timelineHeader.group.attribute.height,this.group.setAttribute("width",this.width),this.group.setAttribute("height",this.height)}}let Sr=class vn{static get mode(){return vn._mode||(vn._mode=ynt()),vn._mode}static set mode(t){vn._mode=t}static RegisterCreateCanvas(t){vn.CreateCanvas=t}static RegisterLoadImage(t){vn.LoadImage=t}static GetCreateCanvasFunc(){return vn.CreateCanvas?vn.CreateCanvas:vn.mode==="worker"?(t=200,e=200)=>new OffscreenCanvas(t,e):void 0}static RegisterRequestAnimationFrame(t){vn.RequestAnimationFrame=t()}static GetRequestAnimationFrame(){if(vn.RequestAnimationFrame)return vn.RequestAnimationFrame}static RegisterCancelAnimationFrame(t){vn.CancelAnimationFrame=t()}static GetCancelAnimationFrame(){if(vn.CancelAnimationFrame)return vn.CancelAnimationFrame}};function ynt(){let n="browser";try{window.type==="node"?n="node":typeof window>"u"||window.performance?typeof window>"u"&&(n="node"):n="miniApp"}catch{n="node"}return n}Sr.dpr=0;const Wu=(n,t)=>Object.prototype.toString.call(n)===`[object ${t}]`,ko=(n,t=!1)=>t?typeof n=="boolean":n===!0||n===!1||Wu(n,"Boolean"),ur=n=>typeof n=="function",he=n=>n==null,$=n=>n!=null,Pi=n=>{const t=typeof n;return n!==null&&t==="object"||t==="function"},Cnt=n=>typeof n=="object"&&n!==null,Gx=function(n){if(!Cnt(n)||!Wu(n,"Object"))return!1;if(Object.getPrototypeOf(n)===null)return!0;let t=n;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(n)===t},Xe=(n,t=!1)=>{const e=typeof n;return t?e==="string":e==="string"||Wu(n,"String")},wt=n=>Array.isArray?Array.isArray(n):Wu(n,"Array"),$x=function(n){return n!==null&&typeof n!="function"&&Number.isFinite(n.length)},_nt=n=>Wu(n,"Date"),dt=(n,t=!1)=>{const e=typeof n;return t?e==="number":e==="number"||Wu(n,"Number")},pl=n=>dt(n)&&Number.isFinite(n),wnt=n=>({}).toString.call(n).replace(/^\[object /,"").replace(/]$/,""),xnt=Object.prototype,Snt=function(n){const t=n&&n.constructor;return n===(typeof t=="function"&&t.prototype||xnt)},Ant=Object.prototype.hasOwnProperty;function dn(n){if(he(n))return!0;if($x(n))return!n.length;const t=wnt(n);if(t==="Map"||t==="Set")return!n.size;if(Snt(n))return!Object.keys(n).length;for(const e in n)if(Ant.call(n,e))return!1;return!0}const Uf=(n,t,e)=>{const i=Xe(t)?t.split("."):t;for(let r=0;r<i.length;r++)n=n?n[i[r]]:void 0;return n===void 0?e:n};function Ul(n,t,e){let i;if(!$(n)||typeof n!="object"||t)return n;const r=wt(n),o=n.length;i=r?new Array(o):typeof n=="object"?{}:ko(n)||dt(n)||Xe(n)?n:_nt(n)?new Date(+n):void 0;const s=r?void 0:Object.keys(Object(n));let a=-1;if(i)for(;++a<(s||n).length;){const l=s?s[a]:a,h=n[l];e&&e.includes(l.toString())?i[l]=h:i[l]=Ul(h,t,e)}return i}function hD(n,t,e=!1,i=!1){if(t){if(n===t)return;if($(t)&&typeof t=="object"){const r=Object(t),o=[];for(const l in r)o.push(l);let{length:s}=o,a=-1;for(;s--;){const l=o[++a];!$(r[l])||typeof r[l]!="object"||i&&wt(n[l])?uD(n,l,r[l]):Mnt(n,t,l,e,i)}}}}function Mnt(n,t,e,i=!1,r=!1){const o=n[e],s=t[e];let a=t[e],l=!0;if(wt(s)){if(i)a=[];else if(wt(o))a=o;else if($x(o)){a=new Array(o.length);let h=-1;const u=o.length;for(;++h<u;)a[h]=o[h]}}else Gx(s)?(a=o??{},typeof o!="function"&&typeof o=="object"||(a={})):l=!1;l&&hD(a,s,i,r),uD(n,e,a)}function uD(n,t,e){(e!==void 0&&!Tnt(n[t],e)||e===void 0&&!(t in n))&&(n[t]=e)}function Tnt(n,t){return n===t||Number.isNaN(n)&&Number.isNaN(t)}function xe(n,...t){let e=-1;const i=t.length;for(;++e<i;)hD(n,t[e],!0);return n}function Rnt(n,t){if(!n||!Gx(n))return n;const e={};return Object.keys(n).forEach((i=>{const r=n[i];let o=!1;t.forEach((s=>{(Xe(s)&&s===i||s instanceof RegExp&&i.match(s))&&(o=!0)})),o||(e[i]=r)})),e}function vB(n){return Object.prototype.toString.call(n)}function bB(n){return Object.keys(n)}function Nc(n,t,e){if(n===t)return!0;if(typeof n!=typeof t||n==null||t==null)return!1;if(Number.isNaN(n)&&Number.isNaN(t))return!0;if(vB(n)!==vB(t)||ur(n)||typeof n!="object")return!1;if(wt(n)){if(n.length!==t.length)return!1;for(let o=n.length-1;o>=0;o--)if(!Nc(n[o],t[o]))return!1;return!0}if(!Gx(n))return!1;const i=bB(n),r=bB(t);if(i.length!==r.length)return!1;i.sort(),r.sort();for(let o=i.length-1;o>=0;o--)if(i[o]!=r[o])return!1;for(let o=i.length-1;o>=0;o--){const s=i[o];if(!Nc(n[s],t[s]))return!1}return!0}function Bnt(n){if($x(n))return n[n.length-1]}const knt=(n,t)=>{var e;if(n.length===0)return;let i=n[0];for(let r=1;r<n.length;r++){const o=n[r];((e=void 0)!==null&&e!==void 0?e:o-i)>0&&(i=o)}return i},Pnt=(n,t)=>{var e;if(n.length===0)return;let i=n[0];for(let r=1;r<n.length;r++){const o=n[r];((e=void 0)!==null&&e!==void 0?e:o-i)<0&&(i=o)}return i};function Ent(n,t){if(!wt(n)||!wt(t)||n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function D0(n){return n*(Math.PI/180)}const yB=n=>{let t=n.charCodeAt(0),e=n.length===2?n.charCodeAt(1):0,i=t;return 55296<=t&&t<=56319&&56320<=e&&e<=57343&&(t&=1023,e&=1023,i=t<<10|e,i+=65536),i===12288||65281<=i&&i<=65376||65504<=i&&i<=65510?"F":i===8361||65377<=i&&i<=65470||65474<=i&&i<=65479||65482<=i&&i<=65487||65490<=i&&i<=65495||65498<=i&&i<=65500||65512<=i&&i<=65518?"H":4352<=i&&i<=4447||4515<=i&&i<=4519||4602<=i&&i<=4607||9001<=i&&i<=9002||11904<=i&&i<=11929||11931<=i&&i<=12019||12032<=i&&i<=12245||12272<=i&&i<=12283||12289<=i&&i<=12350||12353<=i&&i<=12438||12441<=i&&i<=12543||12549<=i&&i<=12589||12593<=i&&i<=12686||12688<=i&&i<=12730||12736<=i&&i<=12771||12784<=i&&i<=12830||12832<=i&&i<=12871||12880<=i&&i<=13054||13056<=i&&i<=19903||19968<=i&&i<=42124||42128<=i&&i<=42182||43360<=i&&i<=43388||44032<=i&&i<=55203||55216<=i&&i<=55238||55243<=i&&i<=55291||63744<=i&&i<=64255||65040<=i&&i<=65049||65072<=i&&i<=65106||65108<=i&&i<=65126||65128<=i&&i<=65131||110592<=i&&i<=110593||127488<=i&&i<=127490||127504<=i&&i<=127546||127552<=i&&i<=127560||127568<=i&&i<=127569||131072<=i&&i<=194367||177984<=i&&i<=196605||196608<=i&&i<=262141?"W":32<=i&&i<=126||162<=i&&i<=163||165<=i&&i<=166||i===172||i===175||10214<=i&&i<=10221||10629<=i&&i<=10630?"Na":i===161||i===164||167<=i&&i<=168||i===170||173<=i&&i<=174||176<=i&&i<=180||182<=i&&i<=186||188<=i&&i<=191||i===198||i===208||215<=i&&i<=216||222<=i&&i<=225||i===230||232<=i&&i<=234||236<=i&&i<=237||i===240||242<=i&&i<=243||247<=i&&i<=250||i===252||i===254||i===257||i===273||i===275||i===283||294<=i&&i<=295||i===299||305<=i&&i<=307||i===312||319<=i&&i<=322||i===324||328<=i&&i<=331||i===333||338<=i&&i<=339||358<=i&&i<=359||i===363||i===462||i===464||i===466||i===468||i===470||i===472||i===474||i===476||i===593||i===609||i===708||i===711||713<=i&&i<=715||i===717||i===720||728<=i&&i<=731||i===733||i===735||768<=i&&i<=879||913<=i&&i<=929||931<=i&&i<=937||945<=i&&i<=961||963<=i&&i<=969||i===1025||1040<=i&&i<=1103||i===1105||i===8208||8211<=i&&i<=8214||8216<=i&&i<=8217||8220<=i&&i<=8221||8224<=i&&i<=8226||8228<=i&&i<=8231||i===8240||8242<=i&&i<=8243||i===8245||i===8251||i===8254||i===8308||i===8319||8321<=i&&i<=8324||i===8364||i===8451||i===8453||i===8457||i===8467||i===8470||8481<=i&&i<=8482||i===8486||i===8491||8531<=i&&i<=8532||8539<=i&&i<=8542||8544<=i&&i<=8555||8560<=i&&i<=8569||i===8585||8592<=i&&i<=8601||8632<=i&&i<=8633||i===8658||i===8660||i===8679||i===8704||8706<=i&&i<=8707||8711<=i&&i<=8712||i===8715||i===8719||i===8721||i===8725||i===8730||8733<=i&&i<=8736||i===8739||i===8741||8743<=i&&i<=8748||i===8750||8756<=i&&i<=8759||8764<=i&&i<=8765||i===8776||i===8780||i===8786||8800<=i&&i<=8801||8804<=i&&i<=8807||8810<=i&&i<=8811||8814<=i&&i<=8815||8834<=i&&i<=8835||8838<=i&&i<=8839||i===8853||i===8857||i===8869||i===8895||i===8978||9312<=i&&i<=9449||9451<=i&&i<=9547||9552<=i&&i<=9587||9600<=i&&i<=9615||9618<=i&&i<=9621||9632<=i&&i<=9633||9635<=i&&i<=9641||9650<=i&&i<=9651||9654<=i&&i<=9655||9660<=i&&i<=9661||9664<=i&&i<=9665||9670<=i&&i<=9672||i===9675||9678<=i&&i<=9681||9698<=i&&i<=9701||i===9711||9733<=i&&i<=9734||i===9737||9742<=i&&i<=9743||9748<=i&&i<=9749||i===9756||i===9758||i===9792||i===9794||9824<=i&&i<=9825||9827<=i&&i<=9829||9831<=i&&i<=9834||9836<=i&&i<=9837||i===9839||9886<=i&&i<=9887||9918<=i&&i<=9919||9924<=i&&i<=9933||9935<=i&&i<=9953||i===9955||9960<=i&&i<=9983||i===10045||i===10071||10102<=i&&i<=10111||11093<=i&&i<=11097||12872<=i&&i<=12879||57344<=i&&i<=63743||65024<=i&&i<=65039||i===65533||127232<=i&&i<=127242||127248<=i&&i<=127277||127280<=i&&i<=127337||127344<=i&&i<=127386||917760<=i&&i<=917999||983040<=i&&i<=1048573||1048576<=i&&i<=1114109?"A":"N"};function Lnt(n,t={},e){e||(e=1);const{fontStyle:i=t.fontStyle,fontVariant:r=t.fontVariant,fontWeight:o=t.fontWeight,fontSize:s=t.fontSize,fontFamily:a=t.fontFamily}=n;return(i?i+" ":"")+(r?r+" ":"")+(o?o+" ":"")+s*e+"px "+(a||"sans-serif")}class er{constructor(t,e){this._numberCharSize=null,this._fullCharSize=null,this._letterCharSize=null,this._specialCharSizeMap={},this._canvas=null,this._context=null,this._contextSaved=!1,this._notSupportCanvas=!1,this._notSupportVRender=!1,this._userSpec={},this.specialCharSet=`-/: .,@%'"~`,this._option=t,this._userSpec=e??{},this.textSpec=this._initSpec(),$(t.specialCharSet)&&(this.specialCharSet=t.specialCharSet),this._standardMethod=$(t.getTextBounds)?this.fullMeasure.bind(this):this.measureWithNaiveCanvas.bind(this)}initContext(){if(this._notSupportCanvas)return!1;if(he(this._canvas)&&($(this._option.getCanvasForMeasure)&&(this._canvas=this._option.getCanvasForMeasure()),he(this._canvas)&&typeof window<"u"&&window.document!==void 0&&globalThis&&$(globalThis.document)&&(this._canvas=globalThis.document.createElement("canvas"))),he(this._context)&&$(this._canvas)){const t=this._canvas.getContext("2d");$(t)&&(t.save(),t.font=Lnt(this.textSpec),this._contextSaved=!0,this._context=t)}return!he(this._context)||(this._notSupportCanvas=!0,!1)}_initSpec(){var t,e,i;const{defaultFontParams:r={}}=this._option,{fontStyle:o=r.fontStyle,fontVariant:s=r.fontVariant,fontWeight:a=(t=r.fontWeight)!==null&&t!==void 0?t:"normal",fontSize:l=(e=r.fontSize)!==null&&e!==void 0?e:12,fontFamily:h=(i=r.fontFamily)!==null&&i!==void 0?i:"sans-serif",align:u,textAlign:d=u??"center",baseline:c,textBaseline:g=c??"middle",ellipsis:f,limit:p}=this._userSpec;let{lineHeight:m=l}=this._userSpec;if(Xe(m)&&m[m.length-1]==="%"){const v=Number.parseFloat(m.substring(0,m.length-1))/100;m=l*v}return{fontStyle:o,fontVariant:s,fontFamily:h,fontSize:l,fontWeight:a,textAlign:d,textBaseline:g,ellipsis:f,limit:p,lineHeight:m}}measure(t,e){switch(e){case"vrender":case"canopus":return this.fullMeasure(t);case"canvas":return this.measureWithNaiveCanvas(t);case"simple":return this.quickMeasureWithoutCanvas(t);default:return this.quickMeasure(t)}}fullMeasure(t){if(he(t))return{width:0,height:0};if(he(this._option.getTextBounds)||!this._notSupportVRender)return this.measureWithNaiveCanvas(t);const{fontFamily:e,fontSize:i,fontWeight:r,textAlign:o,textBaseline:s,ellipsis:a,limit:l,lineHeight:h}=this.textSpec;let u;try{const d=this._option.getTextBounds({text:t,fontFamily:e,fontSize:i,fontWeight:r,textAlign:o,textBaseline:s,ellipsis:!!a,maxLineWidth:l||1/0,lineHeight:h});u={width:d.width(),height:d.height()}}catch{this._notSupportVRender=!0,u=this.measureWithNaiveCanvas(t)}return u}measureWithNaiveCanvas(t){return this._measureReduce(t,this._measureWithNaiveCanvas.bind(this))}_measureWithNaiveCanvas(t){var e;if(!this.initContext())return this._quickMeasureWithoutCanvas(t);const i=this._context.measureText(t),{fontSize:r,lineHeight:o}=this.textSpec;return{width:i.width,height:(e=o)!==null&&e!==void 0?e:r,fontBoundingBoxAscent:i.fontBoundingBoxAscent,fontBoundingBoxDescent:i.fontBoundingBoxDescent}}quickMeasure(t){return this._measureReduce(t,this._quickMeasure.bind(this))}_quickMeasure(t){const e={width:0,height:0};for(let i=0;i<t.length;i++){const r=t[i];let o=this._measureSpecialChar(r);he(o)&&er.NUMBERS_CHAR_SET.includes(r)&&(o=this._measureNumberChar()),he(o)&&["F","W"].includes(yB(r))&&(o=this._measureFullSizeChar()),he(o)&&(o=this._measureLetterChar()),e.width+=o.width,e.height=Math.max(e.height,o.height),!he(o.fontBoundingBoxAscent)&&(e.fontBoundingBoxAscent=o.fontBoundingBoxAscent),!he(o.fontBoundingBoxDescent)&&(e.fontBoundingBoxDescent=o.fontBoundingBoxDescent)}return e}quickMeasureWithoutCanvas(t){return this._measureReduce(t,this._quickMeasureWithoutCanvas.bind(this))}_quickMeasureWithoutCanvas(t){var e;const i={width:0,height:0},{fontSize:r,lineHeight:o}=this.textSpec;for(let s=0;s<t.length;s++){const a=t[s],l=["F","W"].includes(yB(a))?1:.53;i.width+=l*r}return i.height=(e=o)!==null&&e!==void 0?e:r,i}_measureReduce(t,e){var i;const{fontSize:r,lineHeight:o}=this.textSpec,s={width:0,height:0};if(he(t))return s;if(wt(t)){const a=t.filter($).map((l=>l.toString()));return a.length===0?s:a.length===1?e(a[0]):{width:a.reduce(((l,h)=>Math.max(l,e(h).width)),0),height:a.length*(((i=o)!==null&&i!==void 0?i:r)+1)+1}}return e(t.toString())}_measureNumberChar(){if(he(this._numberCharSize)){const t=this._standardMethod(er.NUMBERS_CHAR_SET);this._numberCharSize={width:t.width/er.NUMBERS_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._numberCharSize}_measureFullSizeChar(){return he(this._fullCharSize)&&(this._fullCharSize=this._standardMethod(er.FULL_SIZE_CHAR)),this._fullCharSize}_measureLetterChar(){if(he(this._letterCharSize)){const t=this._standardMethod(er.ALPHABET_CHAR_SET);this._letterCharSize={width:t.width/er.ALPHABET_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._letterCharSize}_measureSpecialChar(t){return $(this._specialCharSizeMap[t])?this._specialCharSizeMap[t]:this.specialCharSet.includes(t)?(this._specialCharSizeMap[t]=this._standardMethod(t),this._specialCharSizeMap[t]):null}release(){$(this._canvas)&&(this._canvas=null),$(this._context)&&(this._contextSaved&&(this._context.restore(),this._contextSaved=!1),this._context=null)}}er.ALPHABET_CHAR_SET="abcdefghijklmnopqrstuvwxyz",er.NUMBERS_CHAR_SET="0123456789",er.FULL_SIZE_CHAR="字";function Ont(n,t,e){const{x1:i,y1:r,x2:o,y2:s}=t;return e.onlyTranslate()?(n!==t&&n.setValue(t.x1,t.y1,t.x2,t.y2),n.translate(e.e,e.f),t):(n.clear(),n.add(e.a*i+e.c*r+e.e,e.b*i+e.d*r+e.f),n.add(e.a*o+e.c*r+e.e,e.b*o+e.d*r+e.f),n.add(e.a*o+e.c*s+e.e,e.b*o+e.d*s+e.f),n.add(e.a*i+e.c*s+e.e,e.b*i+e.d*s+e.f),t)}class Ca{constructor(t){t?this.setValue(t.x1,t.y1,t.x2,t.y2):this.clear()}clone(){return new Ca(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}setValue(t=0,e=0,i=0,r=0){return this.x1=t,this.y1=e,this.x2=i,this.y2=r,this}set(t=0,e=0,i=0,r=0){return i<t?(this.x2=t,this.x1=i):(this.x1=t,this.x2=i),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this}add(t=0,e=0){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this}expand(t=0){return wt(t)?(this.y1-=t[0],this.x2+=t[1],this.y2+=t[2],this.x1-=t[3]):(this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(t=0,e=0){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this}rotate(t=0,e=0,i=0){const r=this.rotatedPoints(t,e,i);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])}scale(t=0,e=0,i=0,r=0){const o=this.scalePoints(t,e,i,r);return this.clear().add(o[0],o[1]).add(o[2],o[3])}union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this}intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this}encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2}alignsWith(t){return t&&(this.x1===t.x1||this.x2===t.x2||this.y1===t.y1||this.y2===t.y2)}intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)}contains(t=0,e=0){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)}containsPoint(t){return!(t.x<this.x1||t.x>this.x2||t.y<this.y1||t.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(t=0){return this.x1*=t,this.x2*=t,this}scaleY(t=0){return this.y1*=t,this.y2*=t,this}transformWithMatrix(t){return Ont(this,this,t),this}copy(t){return this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this}rotatedPoints(t,e,i){const{x1:r,y1:o,x2:s,y2:a}=this,l=Math.cos(t),h=Math.sin(t),u=e-e*l+i*h,d=i-e*h-i*l;return[l*r-h*o+u,h*r+l*o+d,l*r-h*a+u,h*r+l*a+d,l*s-h*o+u,h*s+l*o+d,l*s-h*a+u,h*s+l*a+d]}scalePoints(t,e,i,r){const{x1:o,y1:s,x2:a,y2:l}=this;return[t*o+(1-t)*i,e*s+(1-e)*r,t*a+(1-t)*i,e*l+(1-e)*r]}}class $d extends Ca{}class Int{constructor(t){this._gantt=t,this.createScrollBar(t.tableNoFrameWidth,t.tableNoFrameHeight-t.getAllHeaderRowsHeight())}createScrollBar(t,e){var i,r;const o=this._gantt.parsedOptions.scrollStyle.scrollRailColor,s=this._gantt.parsedOptions.scrollStyle.scrollSliderColor,a=this._gantt.parsedOptions.scrollStyle.scrollSliderCornerRadius,l=this._gantt.parsedOptions.scrollStyle.width;let h;h=$(a)?{cornerRadius:a,fill:s}:{fill:s},(i=this._gantt.parsedOptions.scrollStyle)===null||i===void 0||i.visible,(r=this._gantt.parsedOptions.scrollStyle)===null||r===void 0||r.hoverOn,this.hScrollBar=new ks({direction:"horizontal",x:2*-t,y:2*-e,width:t,height:l,padding:0,railStyle:{fill:o},sliderStyle:h,range:[0,.1],visible:!1}),this.hScrollBar.render(),this.hScrollBar.hideAll(),this.vScrollBar=new ks({direction:"vertical",x:2*-t,y:2*-e,width:l,height:e,padding:0,railStyle:{fill:o},sliderStyle:h,range:[0,.1],visible:!1}),this.vScrollBar.render(),this.vScrollBar.hideAll()}refresh(){}hideVerticalScrollBar(){const t=this._gantt.parsedOptions.scrollStyle.visible;t!=="focus"&&t!=="scrolling"||(this.vScrollBar.setAttribute("visible",!1),this.vScrollBar.hideAll(),this._gantt.scenegraph.updateNextFrame())}showVerticalScrollBar(t){const e=this._gantt.parsedOptions.scrollStyle.visible;e!=="focus"&&e!=="scrolling"||(this.vScrollBar.setAttribute("visible",!0),this.vScrollBar.showAll(),this._gantt.scenegraph.updateNextFrame(),t&&(clearTimeout(this._clearVerticalScrollBar),this._clearVerticalScrollBar=setTimeout((()=>{this.hideVerticalScrollBar()}),1e3)))}hideHorizontalScrollBar(){const t=this._gantt.parsedOptions.scrollStyle.visible;t!=="focus"&&t!=="scrolling"||(this.hScrollBar.setAttribute("visible",!1),this.hScrollBar.hideAll(),this._gantt.scenegraph.updateNextFrame())}showHorizontalScrollBar(t){const e=this._gantt.parsedOptions.scrollStyle.visible;e!=="focus"&&e!=="scrolling"||(this.hScrollBar.setAttribute("visible",!0),this.hScrollBar.showAll(),this._gantt.scenegraph.updateNextFrame(),t&&(clearTimeout(this._clearHorizontalScrollBar),this._clearHorizontalScrollBar=setTimeout((()=>{this.hideHorizontalScrollBar()}),1e3)))}updateVerticalScrollBarPos(t){const e=this.vScrollBar.attribute.range,i=e[1]-e[0],r=t*(1-i);this.vScrollBar.setAttribute("range",[r,r+i]);const o=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:o.x1,y:o.y1}}updateHorizontalScrollBarPos(t){const e=this.hScrollBar.attribute.range,i=e[1]-e[0],r=t*(1-i);this.hScrollBar.setAttribute("range",[r,r+i]);const o=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:o.x1,y:o.y1}}updateScrollBar(){const t=this._gantt.stateManager.scroll.horizontalBarPos,e=this._gantt.stateManager.scroll.verticalBarPos,i=this._gantt.parsedOptions.scrollStyle,r=i?.width,o=i?.visible,s=Math.ceil(this._gantt.scenegraph.ganttGroup.attribute.width),a=Math.ceil(this._gantt.scenegraph.ganttGroup.attribute.height),l=this._gantt.getAllRowsHeight(),h=this._gantt.getAllDateColsWidth(),u=this._gantt.getAllHeaderRowsHeight();if(h>s){const d=Math.min(a,l),c=Math.max(.05,s/h),g=i.hoverOn;let f=0;f=i.barToSide?this._gantt.tableNoFrameHeight-(g?r:-this._gantt.scenegraph.ganttGroup.attribute.y)+this._gantt.tableY:d-(g?r:-this._gantt.scenegraph.ganttGroup.attribute.y)+this._gantt.tableY,this.hScrollBar.setAttributes({x:this._gantt.scenegraph.ganttGroup.attribute.x,y:f,width:s,range:[0,c],visible:o==="always"});const p=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:p.x1,y:p.y1},o==="always"&&this.hScrollBar.showAll()}else this.hScrollBar.setAttributes({x:2*-this._gantt.tableNoFrameWidth,y:2*-this._gantt.tableNoFrameHeight,width:0,visible:!1});if(l>a){const d=Math.min(s,h)+this._gantt.scenegraph.ganttGroup.attribute.x,c=Math.max(.05,(a-u)/(l-u));let g=0;const f=this._gantt.parsedOptions.scrollStyle.hoverOn;g=this._gantt.parsedOptions.scrollStyle.barToSide?this._gantt.tableNoFrameWidth-(f?r:-this._gantt.scenegraph.ganttGroup.attribute.x):d-(f?r:-this._gantt.scenegraph.ganttGroup.attribute.x),this.vScrollBar.setAttributes({x:g,y:u+(f?0:this._gantt.scenegraph.ganttGroup.attribute.y)+this._gantt.tableY,height:a-u,range:[0,c],visible:o==="always"});const p=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:p.x1,y:p.y1},o==="always"&&this.vScrollBar.showAll()}else this.vScrollBar.setAttributes({x:2*-this._gantt.tableNoFrameWidth,y:2*-this._gantt.tableNoFrameHeight,height:0,visible:!1});this._gantt.stateManager.setScrollLeft(t),this._gantt.stateManager.setScrollTop(e)}}function jw(n,t,e,i=!0){var r;let{deltaX:o,deltaY:s}=n;n.shiftKey&&n.deltaY&&(o=s,s=0);const[a,l]=Hnt(o,s,{horizontal:1,vertical:1});a&&(t.setScrollLeft(t.scroll.horizontalBarPos+a),e.scenegraph.scrollbarComponent.showHorizontalScrollBar(!0)),l&&(t.setScrollTop(t.scroll.verticalBarPos+l),e.scenegraph.scrollbarComponent.showVerticalScrollBar(!0)),i&&t.resetInteractionState(),!((r=n.nativeEvent)===null||r===void 0)&&r.cancelable&&(t._gantt.parsedOptions.overscrollBehavior==="none"||Math.abs(s)>=Math.abs(o)&&s!==0&&dD(s,t)||Math.abs(s)<=Math.abs(o)&&o!==0&&cD(o,t))&&n.preventDefault()}function Hnt(n,t,e){var i,r;const o=Math.abs(n/t),s=o<=.5?0:n,a=o>2?0:t;return[Math.ceil(s*((i=e.horizontal)!==null&&i!==void 0?i:0)),Math.ceil(a*((r=e.vertical)!==null&&r!==void 0?r:0))]}function dD(n,t){return t._gantt.getAllRowsHeight()-t._gantt.scenegraph.height!=0&&!Dnt(n,t)&&!Fnt(n,t)}function cD(n,t){return t._gantt.getAllDateColsWidth()-t._gantt.scenegraph.width!=0&&!znt(n,t)&&!Nnt(n,t)}function Dnt(n,t){return t._gantt.getAllRowsHeight()-t._gantt.scenegraph.height!==0&&n<=0&&t.scroll.verticalBarPos<1}function Fnt(n,t){const e=t._gantt.getAllRowsHeight()-t._gantt.scenegraph.height;return e!==0&&n>=0&&Math.abs(t.scroll.verticalBarPos-e)<1}function znt(n,t){return t._gantt.getAllDateColsWidth()-t._gantt.scenegraph.width!==0&&n<=0&&t.scroll.horizontalBarPos<1}function Nnt(n,t){const e=t._gantt.getAllDateColsWidth()-t._gantt.scenegraph.width;return e!==0&&n>=0&&Math.abs(t.scroll.horizontalBarPos-e)<1}function Wnt(n){const t=n._gantt,e=t.stateManager,i=t.scenegraph;i.scrollbarComponent.vScrollBar.addEventListener("pointerover",(s=>{i.scrollbarComponent.showVerticalScrollBar()})),i.scrollbarComponent.hScrollBar.addEventListener("pointerover",(s=>{i.scrollbarComponent.showHorizontalScrollBar()})),i.scrollbarComponent.vScrollBar.addEventListener("pointerout",(s=>{e.interactionState!==Ce.scrolling&&i.scrollbarComponent.hideVerticalScrollBar()})),i.scrollbarComponent.hScrollBar.addEventListener("pointerout",(s=>{e.interactionState!==Ce.scrolling&&i.scrollbarComponent.hideHorizontalScrollBar()})),i.scrollbarComponent.vScrollBar.addEventListener("pointermove",(s=>{s.stopPropagation()})),i.scrollbarComponent.vScrollBar.addEventListener("scrollDown",(s=>{i._gantt.eventManager.isDown=!0})),i.scrollbarComponent.vScrollBar.addEventListener("pointerup",(()=>{i._gantt.eventManager.isDraging=!1,e.interactionState===Ce.scrolling&&e.updateInteractionState(Ce.default)})),i.scrollbarComponent.vScrollBar.addEventListener("pointerupoutside",(()=>{e.interactionState===Ce.scrolling&&e.updateInteractionState(Ce.default)})),i.scrollbarComponent.vScrollBar.addEventListener("scrollUp",(s=>{i._gantt.eventManager.isDraging=!1})),i.scrollbarComponent.hScrollBar.addEventListener("pointermove",(s=>{s.stopPropagation()})),i.scrollbarComponent.hScrollBar.addEventListener("pointerdown",(s=>{s.stopPropagation()})),i.scrollbarComponent.hScrollBar.addEventListener("scrollDown",(s=>{i._gantt.eventManager.isDown=!0,e.interactionState!==Ce.scrolling&&e.updateInteractionState(Ce.scrolling)})),i.scrollbarComponent.hScrollBar.addEventListener("pointerup",(()=>{e.interactionState===Ce.scrolling&&e.updateInteractionState(Ce.default)})),i.scrollbarComponent.hScrollBar.addEventListener("pointerupoutside",(()=>{e.interactionState===Ce.scrolling&&e.updateInteractionState(Ce.default)})),i.scrollbarComponent.hScrollBar.addEventListener("scrollUp",(s=>{i._gantt.eventManager.isDraging=!1}));const r=mB(e.updateVerticalScrollBar,20),o=mB(e.updateHorizontalScrollBar,20);i.scrollbarComponent.vScrollBar.addEventListener("scrollDrag",(s=>{i._gantt.eventManager.isDown&&(i._gantt.eventManager.isDraging=!0),e.interactionState!==Ce.scrolling&&e.updateInteractionState(Ce.scrolling);const a=s.detail.value[0]/(1-s.detail.value[1]+s.detail.value[0]);r(a,s)})),i.scrollbarComponent.hScrollBar.addEventListener("scrollDrag",(s=>{i._gantt.eventManager.isDown&&(i._gantt.eventManager.isDraging=!0),e.fastScrolling=!0,e.interactionState!==Ce.scrolling&&e.updateInteractionState(Ce.scrolling);const a=s.detail.value[0]/(1-s.detail.value[1]+s.detail.value[0]);o(a)}))}const F0={barColor:"blue",completedBarColor:"gray",width:30,cornerRadius:3,borderWidth:0,fontFamily:"Arial",fontSize:14};function jnt(n){F0.width=n}const Vnt=typeof window>"u"||window.window===void 0;function Fh(n,t){const e=n+t.stateManager.scroll.horizontalBarPos,i=t.getDateColWidth(0);return Math.floor((e-i)/t.parsedOptions.timelineColWidth)+1}function Ux(n){var t,e,i,r,o;return n?n===!0?[{date:Ye().toLocaleDateString(),content:"",scrollToMarkLine:!0,position:"left",style:{lineColor:"red",lineWidth:1}}]:Array.isArray(n)?n.map(((s,a)=>{var l,h,u,d;return Object.assign(Object.assign({},s),{date:s.date,scrollToMarkLine:s.scrollToMarkLine,position:(l=s.position)!==null&&l!==void 0?l:"left",style:{lineColor:((h=s.style)===null||h===void 0?void 0:h.lineColor)||"red",lineWidth:((u=s.style)===null||u===void 0?void 0:u.lineWidth)||1,lineDash:(d=s.style)===null||d===void 0?void 0:d.lineDash}})})):[Object.assign(Object.assign({},n),{date:n.date,scrollToMarkLine:(t=n.scrollToMarkLine)===null||t===void 0||t,position:(e=n.position)!==null&&e!==void 0?e:"left",style:{lineColor:((i=n.style)===null||i===void 0?void 0:i.lineColor)||"red",lineWidth:((r=n.style)===null||r===void 0?void 0:r.lineWidth)||1,lineDash:(o=n.style)===null||o===void 0?void 0:o.lineDash}})]:[]}function Gnt(n){var t;return n?.hoverOn||n?.horizontalVisible&&n?.horizontalVisible==="none"||!n?.horizontalVisible&&n?.visible==="none"?0:(t=n?.width)!==null&&t!==void 0?t:7}function $nt(n){var t;return n?.hoverOn||n?.verticalVisible&&n?.verticalVisible==="none"||!n?.verticalVisible&&n?.visible==="none"?0:(t=n?.width)!==null&&t!==void 0?t:7}function CB(n){var t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x,S,T,M,R,E,P,B,k,L,O,I,H,D,z,G,U,j,X,Z,J,q,st,Q,ot,nt,F,N,W,V,K,et,it,rt,lt,ct,ut,gt,Gt,re,Fe,Qt,Ii,hi,ri,Ht,Ie,ye,oi,Sn,Ct,Ve,bt,Xl,Yl,An,zr,Vv,Gv,$v,Uv,Xv,Yv,qv,Kv,Zv,Jv,Qv,tb,eb,ib,nb,rb,ob,sb,ab,lb,hb,ub,db,cb,gb,fb,pb,mb,vb,bb,yb,Cb;const at=n.options;n.parsedOptions.tasksShowMode=(t=at?.tasksShowMode)!==null&&t!==void 0?t:ft.Tasks_Separate,n.parsedOptions.pixelRatio=(e=at?.pixelRatio)!==null&&e!==void 0?e:1,n.parsedOptions.rowHeight=(i=at?.rowHeight)!==null&&i!==void 0?i:40,n.parsedOptions.timelineColWidth=(o=(r=at?.timelineHeader)===null||r===void 0?void 0:r.colWidth)!==null&&o!==void 0?o:60,n.parsedOptions.startDateField=(a=(s=at.taskBar)===null||s===void 0?void 0:s.startDateField)!==null&&a!==void 0?a:"startDate",n.parsedOptions.endDateField=(h=(l=at.taskBar)===null||l===void 0?void 0:l.endDateField)!==null&&h!==void 0?h:"endDate",n.parsedOptions.progressField=(d=(u=at.taskBar)===null||u===void 0?void 0:u.progressField)!==null&&d!==void 0?d:"progress",n.parsedOptions.projectSubTasksExpandable=(c=at?.projectSubTasksExpandable)===null||c===void 0||c;const{unit:_b,startOfWeek:mS,step:dz}=n.parsedOptions.reverseSortedTimelineScales[0];n.parsedOptions.minDate=at?.minDate?Nl(new Date(at.minDate),_b,mS):void 0,n.parsedOptions.maxDate=at?.maxDate&&(!((g=n.parsedOptions)===null||g===void 0)&&g.minDate)?Tu((f=n.parsedOptions)===null||f===void 0?void 0:f.minDate,new Date(at.maxDate),_b,dz):void 0,n.parsedOptions._minDateTime=(p=n.parsedOptions.minDate)===null||p===void 0?void 0:p.getTime(),n.parsedOptions._maxDateTime=(m=n.parsedOptions.maxDate)===null||m===void 0?void 0:m.getTime(),n.parsedOptions.overscrollBehavior=(v=at?.overscrollBehavior)!==null&&v!==void 0?v:"auto",n.parsedOptions.underlayBackgroundColor=(b=at?.underlayBackgroundColor)!==null&&b!==void 0?b:"#FFF",n.parsedOptions.scrollStyle=Object.assign({},{scrollRailColor:"rgba(100, 100, 100, 0.2)",scrollSliderColor:"rgba(100, 100, 100, 0.5)",scrollSliderCornerRadius:4,width:10,visible:"always",hoverOn:!0,barToSide:!1},at?.scrollStyle),n.parsedOptions.timelineHeaderHorizontalLineStyle=(y=at?.timelineHeader)===null||y===void 0?void 0:y.horizontalLine,n.parsedOptions.timelineHeaderVerticalLineStyle=(C=at?.timelineHeader)===null||C===void 0?void 0:C.verticalLine,n.parsedOptions.timelineHeaderBackgroundColor=(w=at?.timelineHeader)===null||w===void 0?void 0:w.backgroundColor,n.parsedOptions.timeLineHeaderRowHeights=[],n.parsedOptions.timelineHeaderStyles=[];for(let mo=0;mo<n.parsedOptions.sortedTimelineScales.length;mo++){const cz=n.parsedOptions.sortedTimelineScales[mo].style;n.parsedOptions.timelineHeaderStyles.push(Object.assign({fontSize:20,fontWeight:"bold",textAlign:"center",textBaseline:"middle",color:"#000",backgroundColor:"#fff"},cz)),n.parsedOptions.timeLineHeaderRowHeights.push((A=(_=n.parsedOptions.sortedTimelineScales[mo].rowHeight)!==null&&_!==void 0?_:at?.headerRowHeight)!==null&&A!==void 0?A:40)}n.parsedOptions.grid=Object.assign({},at?.grid),jnt(3*n.parsedOptions.rowHeight/4),n.parsedOptions.taskBarStyle=!((x=at?.taskBar)===null||x===void 0)&&x.barStyle&&typeof((S=at?.taskBar)===null||S===void 0?void 0:S.barStyle)=="function"?at.taskBar.barStyle:Object.assign({},F0,(T=at?.taskBar)===null||T===void 0?void 0:T.barStyle),n.parsedOptions.projectBarStyle=!((M=at?.taskBar)===null||M===void 0)&&M.projectStyle&&typeof((R=at?.taskBar)===null||R===void 0?void 0:R.projectStyle)=="function"?at.taskBar.projectStyle:!((E=at?.taskBar)===null||E===void 0)&&E.projectStyle?Object.assign({},F0,(P=at?.taskBar)===null||P===void 0?void 0:P.projectStyle):n.parsedOptions.taskBarStyle,n.parsedOptions.taskBarMilestoneStyle=Object.assign(typeof n.parsedOptions.taskBarStyle=="function"?{}:{width:n.parsedOptions.taskBarStyle.width,borderColor:n.parsedOptions.taskBarStyle.borderColor,borderLineWidth:(B=n.parsedOptions.taskBarStyle.borderLineWidth)!==null&&B!==void 0?B:1,fillColor:n.parsedOptions.taskBarStyle.barColor,cornerRadius:0},{labelTextStyle:{fontSize:16,color:"red",fontFamily:"Arial",padding:4}},(k=at?.taskBar)===null||k===void 0?void 0:k.milestoneStyle),n.parsedOptions.taskBarMilestoneHypotenuse=n.parsedOptions.taskBarMilestoneStyle.width*Math.sqrt(2),n.parsedOptions.dateFormat=at?.dateFormat,n.parsedOptions.taskBarHoverStyle=Object.assign({barOverlayColor:"rgba(99, 144, 0, 0.4)"},(L=at?.taskBar)===null||L===void 0?void 0:L.hoverBarStyle),n.parsedOptions.taskBarSelectable=(I=(O=at?.taskBar)===null||O===void 0?void 0:O.selectable)===null||I===void 0||I,n.parsedOptions.taskBarSelectedStyle=Object.assign(typeof n.parsedOptions.taskBarStyle=="function"?{shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,borderLineWidth:1}:{shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:n.parsedOptions.taskBarStyle.barColor,borderColor:n.parsedOptions.taskBarStyle.barColor,borderLineWidth:1},(H=at?.taskBar)===null||H===void 0?void 0:H.selectedBarStyle),n.parsedOptions.taskBarLabelText=(z=(D=at?.taskBar)===null||D===void 0?void 0:D.labelText)!==null&&z!==void 0?z:"",n.parsedOptions.taskBarMoveable=(U=(G=at?.taskBar)===null||G===void 0?void 0:G.moveable)===null||U===void 0||U,n.parsedOptions.moveTaskBarToExtendDateRange=(X=(j=at?.taskBar)===null||j===void 0?void 0:j.moveToExtendDateRange)===null||X===void 0||X,n.parsedOptions.taskBarResizable=(J=(Z=at?.taskBar)===null||Z===void 0?void 0:Z.resizable)===null||J===void 0||J,n.parsedOptions.taskBarProgressAdjustable=(st=(q=at?.taskBar)===null||q===void 0?void 0:q.progressAdjustable)!==null&&st!==void 0&&st,n.parsedOptions.taskBarDragOrder=(ot=(Q=at?.taskBar)===null||Q===void 0?void 0:Q.dragOrder)===null||ot===void 0||ot,n.parsedOptions.taskBarLabelStyle={fontFamily:(N=(F=(nt=at?.taskBar)===null||nt===void 0?void 0:nt.labelTextStyle)===null||F===void 0?void 0:F.fontFamily)!==null&&N!==void 0?N:"Arial",fontSize:(K=(V=(W=at?.taskBar)===null||W===void 0?void 0:W.labelTextStyle)===null||V===void 0?void 0:V.fontSize)!==null&&K!==void 0?K:20,color:(rt=(it=(et=at?.taskBar)===null||et===void 0?void 0:et.labelTextStyle)===null||it===void 0?void 0:it.color)!==null&&rt!==void 0?rt:"#F01",outsideColor:(ut=(ct=(lt=at?.taskBar)===null||lt===void 0?void 0:lt.labelTextStyle)===null||ct===void 0?void 0:ct.outsideColor)!==null&&ut!==void 0?ut:"#333333",textAlign:(re=(Gt=(gt=at?.taskBar)===null||gt===void 0?void 0:gt.labelTextStyle)===null||Gt===void 0?void 0:Gt.textAlign)!==null&&re!==void 0?re:"left",textBaseline:(Ii=(Qt=(Fe=at?.taskBar)===null||Fe===void 0?void 0:Fe.labelTextStyle)===null||Qt===void 0?void 0:Qt.textBaseline)!==null&&Ii!==void 0?Ii:"middle",padding:(Ht=(ri=(hi=at?.taskBar)===null||hi===void 0?void 0:hi.labelTextStyle)===null||ri===void 0?void 0:ri.padding)!==null&&Ht!==void 0?Ht:[0,0,0,10],textOverflow:(ye=(Ie=at?.taskBar)===null||Ie===void 0?void 0:Ie.labelTextStyle)===null||ye===void 0?void 0:ye.textOverflow,orient:(Sn=(oi=at?.taskBar)===null||oi===void 0?void 0:oi.labelTextStyle)===null||Sn===void 0?void 0:Sn.orient,orientHandleWithOverflow:(Ve=(Ct=at?.taskBar)===null||Ct===void 0?void 0:Ct.labelTextStyle)===null||Ve===void 0?void 0:Ve.orientHandleWithOverflow},n.parsedOptions.taskBarCustomLayout=(bt=at?.taskBar)===null||bt===void 0?void 0:bt.customLayout,n.parsedOptions.taskBarCreatable=(Yl=(Xl=at?.taskBar)===null||Xl===void 0?void 0:Xl.scheduleCreatable)!==null&&Yl!==void 0?Yl:!(n.parsedOptions.tasksShowMode!==ft.Sub_Tasks_Separate&&n.parsedOptions.tasksShowMode!==ft.Tasks_Separate),n.parsedOptions.taskBarCreationButtonStyle=Object.assign({lineColor:"rgb(99, 144, 0)",lineWidth:1,lineDash:[5,5],cornerRadius:4,backgroundColor:"#FFF"},(zr=(An=at?.taskBar)===null||An===void 0?void 0:An.scheduleCreation)===null||zr===void 0?void 0:zr.buttonStyle),n.parsedOptions.taskBarCreationCustomLayout=(Gv=(Vv=at?.taskBar)===null||Vv===void 0?void 0:Vv.scheduleCreation)===null||Gv===void 0?void 0:Gv.customLayout,n.parsedOptions.taskBarCreationMaxWidth=(Uv=($v=at?.taskBar)===null||$v===void 0?void 0:$v.scheduleCreation)===null||Uv===void 0?void 0:Uv.maxWidth,n.parsedOptions.taskBarCreationMinWidth=(Yv=(Xv=at?.taskBar)===null||Xv===void 0?void 0:Xv.scheduleCreation)===null||Yv===void 0?void 0:Yv.minWidth,n.parsedOptions.outerFrameStyle=Object.assign({borderColor:"#e1e4e8",borderLineWidth:1,cornerRadius:4},(qv=at.frame)===null||qv===void 0?void 0:qv.outerFrameStyle),n.parsedOptions.markLine=Ux(at?.markLine),(Zv=(Kv=n.parsedOptions.markLine)===null||Kv===void 0?void 0:Kv.length)!==null&&Zv!==void 0&&Zv&&(!((Jv=n.parsedOptions.markLine)===null||Jv===void 0)&&Jv.every((mo=>mo.scrollToMarkLine===void 0))&&(n.parsedOptions.markLine[0].scrollToMarkLine=!0),!((Qv=n.parsedOptions.markLine)===null||Qv===void 0)&&Qv.find((mo=>mo.scrollToMarkLine))&&(n.parsedOptions.scrollToMarkLineDate=Nl(new Date((tb=n.parsedOptions.markLine)===null||tb===void 0?void 0:tb.find((mo=>mo.scrollToMarkLine)).date),_b,mS))),n.parsedOptions.verticalSplitLineHighlight=(eb=at.frame)===null||eb===void 0?void 0:eb.verticalSplitLineHighlight,n.parsedOptions.verticalSplitLine=Object.assign({lineColor:(ib=n.parsedOptions.outerFrameStyle)===null||ib===void 0?void 0:ib.borderColor,lineWidth:(nb=n.parsedOptions.outerFrameStyle)===null||nb===void 0?void 0:nb.borderLineWidth},(rb=at.frame)===null||rb===void 0?void 0:rb.verticalSplitLine),n.parsedOptions.horizontalSplitLine=(ob=at.frame)===null||ob===void 0?void 0:ob.horizontalSplitLine,n.parsedOptions.verticalSplitLineMoveable=(sb=at.frame)===null||sb===void 0?void 0:sb.verticalSplitLineMoveable,n.parsedOptions.taskKeyField=(ab=at.taskKeyField)!==null&&ab!==void 0?ab:"id",n.parsedOptions.dependencyLinks=(hb=(lb=at.dependency)===null||lb===void 0?void 0:lb.links)!==null&&hb!==void 0?hb:[],n.parsedOptions.dependencyLinkCreatable=(db=(ub=at.dependency)===null||ub===void 0?void 0:ub.linkCreatable)!==null&&db!==void 0&&db,n.parsedOptions.dependencyLinkSelectable=(gb=(cb=at.dependency)===null||cb===void 0?void 0:cb.linkSelectable)===null||gb===void 0||gb,n.parsedOptions.dependencyLinkDeletable=(pb=(fb=at.dependency)===null||fb===void 0?void 0:fb.linkDeletable)!==null&&pb!==void 0&&pb,n.parsedOptions.dependencyLinkLineStyle=Object.assign({lineColor:"red",lineWidth:1},(mb=at.dependency)===null||mb===void 0?void 0:mb.linkLineStyle),n.parsedOptions.dependencyLinkSelectedLineStyle=Object.assign({shadowBlur:4,shadowOffset:0,shadowColor:n.parsedOptions.dependencyLinkLineStyle.lineColor,lineColor:n.parsedOptions.dependencyLinkLineStyle.lineColor,lineWidth:n.parsedOptions.dependencyLinkLineStyle.lineWidth},(vb=at?.dependency)===null||vb===void 0?void 0:vb.linkSelectedLineStyle),n.parsedOptions.dependencyLinkLineCreatePointStyle=Object.assign({strokeColor:"red",fillColor:"white",radius:5,strokeWidth:1},(bb=at?.dependency)===null||bb===void 0?void 0:bb.linkCreatePointStyle),n.parsedOptions.dependencyLinkLineCreatingPointStyle=Object.assign({strokeColor:"red",fillColor:"red",radius:5,strokeWidth:1},(yb=at?.dependency)===null||yb===void 0?void 0:yb.linkCreatingPointStyle),n.parsedOptions.dependencyLinkLineCreatingStyle=Object.assign({lineColor:"red",lineWidth:1,lineDash:[5,5]},(Cb=at?.dependency)===null||Cb===void 0?void 0:Cb.linkCreatingLineStyle),n.parsedOptions.eventOptions=at?.eventOptions,n.parsedOptions.keyboardOptions=at?.keyboardOptions,n.parsedOptions.markLineCreateOptions=at?.markLineCreateOptions}function Unt(n){var t,e,i,r;const o=n.options,{unit:s,startOfWeek:a,step:l}=n.parsedOptions.reverseSortedTimelineScales[0];n.parsedOptions.minDate=Nl(new Date(n.parsedOptions.minDate),s,a),n.parsedOptions.maxDate=Tu(n.parsedOptions.minDate,new Date(n.parsedOptions.maxDate),s,l),n.parsedOptions._minDateTime=(t=n.parsedOptions.minDate)===null||t===void 0?void 0:t.getTime(),n.parsedOptions._maxDateTime=(e=n.parsedOptions.maxDate)===null||e===void 0?void 0:e.getTime(),n.parsedOptions.timeLineHeaderRowHeights=[],n.parsedOptions.timelineHeaderStyles=[];for(let h=0;h<n.parsedOptions.sortedTimelineScales.length;h++){const u=n.parsedOptions.sortedTimelineScales[h].style;n.parsedOptions.timelineHeaderStyles.push(Object.assign({fontSize:20,fontWeight:"bold",textAlign:"center",textBaseline:"middle",color:"#000",backgroundColor:"#fff"},u)),n.parsedOptions.timeLineHeaderRowHeights.push((r=(i=n.parsedOptions.sortedTimelineScales[h].rowHeight)!==null&&i!==void 0?i:o?.headerRowHeight)!==null&&r!==void 0?r:40)}}function Xnt(n,t,e){var i;const{unit:r,step:o,format:s}=e,a=[];for(;n<t;)if(r==="day"){const l=n.getFullYear(),h=n.getMonth(),u=n.getDate(),d=Ks(new Date(l,h,u+o-1),!0);d.getTime()>t.getTime()&&d.setTime(t.getTime());const c=n,g=s?.({dateIndex:u,startDate:c,endDate:d})||u.toString(),f={days:Math.abs(d.getTime()-n.getTime()+1)/864e5,startDate:c,endDate:d,step:o,unit:"day",title:g,dateIndex:u};a.push(f),n=new Date(l,h,u+o)}else if(r==="month"){const l=n.getFullYear(),h=n.getMonth(),u=Ks(new Date(l,h+o,0),!0);u.getTime()>t.getTime()&&u.setTime(t.getTime());const d=n,c=s?.({dateIndex:h+1,startDate:d,endDate:u})||(h+1).toString(),g={days:Math.abs(u.getTime()-n.getTime()+1)/864e5,startDate:d,step:o,unit:"month",endDate:u,title:c,dateIndex:h+1};a.push(g),n=new Date(l,h+o,1)}else if(r==="quarter"){const l=n.getFullYear(),h=Math.floor(n.getMonth()/3),u=Ks(new Date(l,3*(h+o),0),!0);u.getTime()>t.getTime()&&u.setTime(t.getTime());const d=n,c=s?.({dateIndex:h+1,startDate:d,endDate:u})||(h+1).toString(),g={days:Math.abs(u.getTime()-n.getTime()+1)/864e5,startDate:d,step:o,unit:"quarter",endDate:u,title:c,dateIndex:h+1};a.push(g),n=new Date(l,3*(h+o),1)}else if(r==="year"){const l=n.getFullYear(),h=Ks(new Date(l+o-1,11,31),!0);h.getTime()>t.getTime()&&h.setTime(t.getTime());const u=n,d=s?.({dateIndex:l,startDate:u,endDate:h})||l.toString(),c={days:Math.abs(h.getTime()-n.getTime()+1)/864e5,startDate:u,endDate:h,step:o,unit:"year",title:d,dateIndex:l};a.push(c),n=new Date(l+o,0,1)}else if(r==="week"){const l=(i=e.startOfWeek)!==null&&i!==void 0?i:"monday";let h=n.getDay();l==="monday"&&(h=h===0?6:h-1);const u=Ye(n),d=Ks(n.getTime()+24*(7*o-h)*60*60*1e3-1,!0);d>t&&d.setTime(t.getTime());const c=fnt(u),g=s?.({dateIndex:c,startDate:u,endDate:d})||c.toString(),f={days:(d.getTime()-u.getTime()+1)/864e5,startDate:u,endDate:d,step:o,unit:"week",title:g,dateIndex:c};a.push(f),n.setTime(Ye(n.getTime()+24*(7*o-h)*60*60*1e3,!0).getTime())}else if(r==="hour"){const l=n.getFullYear(),h=n.getMonth(),u=n.getDate(),d=n.getHours(),c=mnt(new Date(l,h,u,d+o-1),!0);c.getTime()>t.getTime()&&c.setTime(t.getTime());const g=n,f=s?.({dateIndex:d,startDate:g,endDate:c})||d.toString(),p={days:Math.abs(c.getTime()-n.getTime()+1)/864e5,startDate:g,endDate:c,step:o,unit:"hour",title:f,dateIndex:n.getHours()};a.push(p),n=new Date(l,h,u,d+o)}else if(r==="minute"){const l=n.getFullYear(),h=n.getMonth(),u=n.getDate(),d=n.getHours(),c=n.getMinutes(),g=vnt(new Date(l,h,u,d,c+o-1),!0);g.getTime()>t.getTime()&&g.setTime(t.getTime());const f=n,p=s?.({dateIndex:c,startDate:f,endDate:g})||c.toString(),m={days:Math.abs(g.getTime()-n.getTime()+1)/864e5,startDate:f,endDate:g,step:o,unit:"minute",title:p,dateIndex:n.getMinutes()};a.push(m),n=new Date(l,h,u,d,c+o)}else if(r==="second"){const l=n.getFullYear(),h=n.getMonth(),u=n.getDate(),d=n.getHours(),c=n.getMinutes(),g=n.getSeconds(),f=lD(new Date(l,h,u,d,c,g+o-1),!0);f.getTime()>t.getTime()&&f.setTime(t.getTime());const p=n,m=s?.({dateIndex:g,startDate:p,endDate:f})||g.toString(),v={days:Math.abs(f.getTime()-n.getTime()+1)/864e5,startDate:p,endDate:f,step:o,unit:"second",title:m,dateIndex:n.getSeconds()};a.push(v),n=new Date(l,h,u,d,c,g+o)}return a}function mg(n,t,e,i,r){var o,s,a,l,h,u,d,c,g;let f=(o=n[3])!==null&&o!==void 0?o:10;t==="right"||t==="end"?f=i-0-((s=n[1])!==null&&s!==void 0?s:10):t==="center"&&(f=0+(i-0+((a=n[3])!==null&&a!==void 0?a:10)-((l=n[1])!==null&&l!==void 0?l:10))/2);let p=0+((h=n[0])!==null&&h!==void 0?h:10);return e==="bottom"||e==="alphabetic"||e==="ideographic"?p=r-0-((u=n[2])!==null&&u!==void 0?u:10):e==="middle"&&(p=0+(r-0-((d=n[0])!==null&&d!==void 0?d:10)-((c=n[2])!==null&&c!==void 0?c:10))/2+((g=n[0])!==null&&g!==void 0?g:10)),{x:f,y:p}}function Ynt(n){return typeof n=="string"&&(n=n.replace("%",""),n=parseFloat(n)),isNaN(n)?0:Math.max(0,Math.min(100,Math.round(10*n)/10))}function qnt(n){if(n.taskListTableInstance){n.verticalSplitResizeLine=document.createElement("div"),n.verticalSplitResizeLine.style.position="absolute",n.verticalSplitResizeLine.style.top=n.tableY+"px",n.verticalSplitResizeLine.style.left=(n.taskTableWidth!==-1?n.taskTableWidth-7+n.parsedOptions.verticalSplitLine.lineWidth/2:0)+"px",n.verticalSplitResizeLine.style.width="14px",n.verticalSplitResizeLine.style.height=n.drawHeight+"px",n.verticalSplitResizeLine.style.backgroundColor="rgba(0,0,0,0)",n.verticalSplitResizeLine.style.zIndex="100",n.parsedOptions.verticalSplitLineMoveable&&(n.verticalSplitResizeLine.style.cursor="col-resize"),n.verticalSplitResizeLine.style.userSelect="none",n.verticalSplitResizeLine.style.opacity="1";const t=document.createElement("div");if(t.style.position="absolute",t.style.top="0px",t.style.left=(14-n.parsedOptions.verticalSplitLine.lineWidth)/2+"px",t.style.width=n.parsedOptions.verticalSplitLine.lineWidth+"px",t.style.height="100%",t.style.backgroundColor=n.parsedOptions.verticalSplitLine.lineColor,t.style.zIndex="100",t.style.userSelect="none",t.style.pointerEvents="none",t.style.transition="background-color 0.3s",n.verticalSplitResizeLine.appendChild(t),n.parsedOptions.verticalSplitLineHighlight){const e=document.createElement("div");e.style.position="absolute",e.style.top="0px",e.style.left=(14-n.parsedOptions.verticalSplitLineHighlight.lineWidth)/2+"px",e.style.width=n.parsedOptions.verticalSplitLineHighlight.lineWidth+"px",e.style.height="100%",e.style.backgroundColor=n.parsedOptions.verticalSplitLineHighlight.lineColor,e.style.zIndex="100",e.style.cursor="col-resize",e.style.userSelect="none",e.style.pointerEvents="none",e.style.opacity="0",e.style.transition="background-color 0.3s",n.verticalSplitResizeLine.appendChild(e)}n.container.appendChild(n.verticalSplitResizeLine)}}function Xf(n){if(n.verticalSplitResizeLine){n.verticalSplitResizeLine.style.position="absolute",n.verticalSplitResizeLine.style.top=n.tableY+"px",n.verticalSplitResizeLine.style.left=n.taskTableWidth!==-1?n.taskTableWidth-7+n.parsedOptions.verticalSplitLine.lineWidth/2+"px":"0px",n.verticalSplitResizeLine.style.width="14px",n.verticalSplitResizeLine.style.height=n.drawHeight+"px",n.verticalSplitResizeLine.style.backgroundColor="rgba(0,0,0,0)",n.verticalSplitResizeLine.style.zIndex="100",n.parsedOptions.verticalSplitLineMoveable&&(n.verticalSplitResizeLine.style.cursor="col-resize"),n.verticalSplitResizeLine.style.userSelect="none",n.verticalSplitResizeLine.style.opacity="1";const t=n.verticalSplitResizeLine.childNodes[0];if(t.style.position="absolute",t.style.top="0px",t.style.left=(14-n.parsedOptions.verticalSplitLine.lineWidth)/2+"px",t.style.width=n.parsedOptions.verticalSplitLine.lineWidth+"px",t.style.height="100%",t.style.backgroundColor=n.parsedOptions.verticalSplitLine.lineColor,t.style.zIndex="100",t.style.userSelect="none",t.style.pointerEvents="none",t.style.transition="background-color 0.3s",n.verticalSplitResizeLine.childNodes[1]){const e=n.verticalSplitResizeLine.childNodes[1];e.style.position="absolute",e.style.top="0px",e.style.left=(14-n.parsedOptions.verticalSplitLineHighlight.lineWidth)/2+"px",e.style.width=n.parsedOptions.verticalSplitLineHighlight.lineWidth+"px",e.style.height="100%",e.style.backgroundColor=n.parsedOptions.verticalSplitLineHighlight.lineColor,e.style.zIndex="100",e.style.cursor="col-resize",e.style.userSelect="none",e.style.pointerEvents="none",e.style.opacity="0",e.style.transition="background-color 0.3s"}}}function Po(n,t,e,i="children"){var r;for(let o=0;o<n.length;o++){if(Array.isArray(e)&&e.length===1&&n[o][t]===e[0]||n[o][t]===e)return{record:n[o],index:[o]};if(!((r=n[o][i])===null||r===void 0)&&r.length){if(Array.isArray(e)&&e[0]===n[o][t]){const s=Po(n[o][i],t,e.slice(1));if(s)return s.index.unshift(o),s}else if(!Array.isArray(e)){const s=Po(n[o][i],t,e);if(s)return s.index.unshift(o),s}}}}function gD(n,t="children"){var e;for(let i=0;i<n.length;i++)!((e=n[i][t])===null||e===void 0)&&e.length?gD(n[i][t],t):(delete n[i].vtable_gantt_linkedTo,delete n[i].vtable_gantt_linkedFrom)}function fD(n,t="children"){var e;for(let i=0;i<n.length;i++)!((e=n[i][t])===null||e===void 0)&&e.length?fD(n[i][t],t):delete n[i].vtable_gantt_showIndex}function nr(n,t){var e;let i,r;if(t.taskListTableInstance){const o=t.taskListTableInstance.getTargetRowAt(n+t.headerHeight);if(o){const{row:s}=o;i=s-t.taskListTableInstance.columnHeaderLevelCount;const a=t.getRowsHeightByIndex(0,i-1);if(t.parsedOptions.tasksShowMode===ft.Sub_Tasks_Inline||t.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||t.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact||t.parsedOptions.tasksShowMode===ft.Sub_Tasks_Separate)r=Math.floor((n-a)/t.parsedOptions.rowHeight);else if(t.parsedOptions.tasksShowMode===ft.Project_Sub_Tasks_Inline){const l=t.getRecordByIndex(i);l&&l.type===se.PROJECT&&((e=l.children)===null||e===void 0?void 0:e.length)>0&&(l.hierarchyState==="expand"||t.parsedOptions.projectSubTasksExpandable===!1||(r=Math.floor((n-a)/t.parsedOptions.rowHeight)))}}}else i=Math.floor(n/t.parsedOptions.rowHeight);return{task_index:i,sub_task_index:r}}function Knt(n,t){var e;if(!t.children||t.children.length<=1)return((e=t.children)===null||e===void 0?void 0:e.length)===1?t.children[0].vtable_gantt_showIndex=0:t.vtable_gantt_showIndex=0,1;const i=t.children.slice().sort(((o,s)=>{const{startDate:a}=Ud(n,o),{startDate:l}=Ud(n,s);return a.getTime()-l.getTime()})),r=[];for(let o=0;o<=i.length-1;o++){const s=i[o],{startDate:a,endDate:l}=Ud(n,s);let h=!1;for(let u=0;u<r.length;u++)if(a.getTime()>r[u]){r[u]=l.getTime(),h=!0,s.vtable_gantt_showIndex=u;break}h||(r.push(l.getTime()),s.vtable_gantt_showIndex=r.length-1)}return r.length}function Znt(n,t,e,i){return e.some((r=>{const{startDate:o,endDate:s}=Ud(i,r);return n<=s&&o<=t}))}function Jnt(n,t){var e;if(!t.children||t.children.length<=1)return((e=t.children)===null||e===void 0?void 0:e.length)===1?t.children[0].vtable_gantt_showIndex=0:t.vtable_gantt_showIndex=0,1;const i=[];for(let r=0;r<=t.children.length-1;r++){const o=t.children[r],{startDate:s,endDate:a}=Ud(n,o);let l=!1;for(let h=0;h<i.length;h++)if(!Znt(s,a,t.children.filter((u=>u!==o&&u.vtable_gantt_showIndex===h)),n)){i[h]=a.getTime(),l=!0,o.vtable_gantt_showIndex=h;break}l||(i.push(a.getTime()),o.vtable_gantt_showIndex=i.length-1)}return i.length}function Ud(n,t){const{timeScaleIncludeHour:e,startDateField:i,endDateField:r}=n.parsedOptions,o=t[i],s=t[r];return e?{startDate:Ye(o),endDate:Ks(s)}:{startDate:Ye(o,!0),endDate:Ks(s,!0)}}function Qnt(n){var t,e,i,r,o,s,a;const l=n.options,{unit:h,startOfWeek:u}=n.parsedOptions.reverseSortedTimelineScales[0];n.parsedOptions.markLine=Ux(l?.markLine),(e=(t=n.parsedOptions.markLine)===null||t===void 0?void 0:t.length)!==null&&e!==void 0&&e&&(!((i=n.parsedOptions.markLine)===null||i===void 0)&&i.every((d=>d.scrollToMarkLine===void 0))&&(n.parsedOptions.markLine[0].scrollToMarkLine=!0),!((r=n.parsedOptions.markLine)===null||r===void 0)&&r.find((d=>d.scrollToMarkLine))&&(n.parsedOptions.scrollToMarkLineDate=Nl(new Date((o=n.parsedOptions.markLine)===null||o===void 0?void 0:o.find((d=>d.scrollToMarkLine)).date),h,u))),n.parsedOptions.dependencyLinks=(a=(s=l.dependency)===null||s===void 0?void 0:s.links)!==null&&a!==void 0?a:[]}function trt(n){var t,e;const i=n.options,{unit:r,startOfWeek:o,step:s}=n.parsedOptions.reverseSortedTimelineScales[0];n.parsedOptions.minDate=i?.minDate?Nl(new Date(i.minDate),r,o):void 0,n.parsedOptions.maxDate=i?.maxDate?Tu(n.parsedOptions.minDate,new Date(i.maxDate),r,s):void 0,n.parsedOptions._minDateTime=(t=n.parsedOptions.minDate)===null||t===void 0?void 0:t.getTime(),n.parsedOptions._maxDateTime=(e=n.parsedOptions.maxDate)===null||e===void 0?void 0:e.getTime()}function my(n){const t=n.options;n.parsedOptions.markLine=Ux(t?.markLine)}function ert(n,t,e){const i=nr(t-e.headerHeight+e.stateManager.scrollTop,e),r=e.getRecordByIndex(i.task_index),o=Fh(n,e),s=e.getDateRangeByIndex(o);if(r?.children){const a=nr(t-e.headerHeight+e.stateManager.scrollTop,e);for(let l=0;l<r.children.length;l++){const{startDate:h,endDate:u,taskDays:d,progress:c,taskRecord:g}=e.getTaskInfoByTaskListIndex(a.task_index,l);if(((e.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact||e.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange)&&g.vtable_gantt_showIndex===a.sub_task_index||e.parsedOptions.tasksShowMode===ft.Sub_Tasks_Inline||e.parsedOptions.tasksShowMode===ft.Project_Sub_Tasks_Inline&&r.type===se.PROJECT&&r.hierarchyState!=="expand"&&e.parsedOptions.projectSubTasksExpandable!==!1)&&h&&u&&s.startDate.getTime()>=h.getTime()&&s.endDate.getTime()<=u.getTime())return{startDate:h,endDate:u,taskDays:d,progress:c,taskRecord:g}}}}function _B(n,t){return{left:n.globalTransMatrix.e+t.taskListTableInstance.tableNoFrameWidth+t.taskListTableInstance.tableX+t.tableX,top:n.globalTransMatrix.f,width:n.attribute.width,height:n.attribute.height}}function irt(n,t){const e=n.startDate.getTime(),i=n.endDate.getTime();return t.some((r=>{const o=new Date(r.date).getTime();return o>=e&&o<=i}))}function nrt(n){if(!n.records||n.records.length===0)return;const t=n.parsedOptions.startDateField,e=n.parsedOptions.endDateField,i=(r,o,s)=>{let a=null,l=null;return r.forEach(((h,u)=>{var d;if(!h)return;let c=null,g=null;if(h.children&&h.children.length>0&&h.type===se.PROJECT){const[f,p]=i(h.children);if(f&&p&&(c=f,g=p,h.type===se.PROJECT)){const m=(d=n.parsedOptions.dateFormat)!==null&&d!==void 0?d:n.parseTimeFormat(h[t]||h.children[0][t]||""),v=y=>n.formatDate?n.formatDate(y,m):y.toISOString().split("T")[0],b=Object.assign({},h);b[t]=v(c),b[e]=v(g),r[u]=b}}else h[t]&&h[e]&&(c=new Date(h[t]),g=new Date(h[e]));c&&(!a||c<a)&&(a=c),g&&(!l||g>l)&&(l=g)})),[a,l]};i(n.records)}const rrt='<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1471" width="24" height="24"> <path d="M840.05 153.35a27.61875 27.61875 0 0 0-22.95-4.95c-56.25 13.05-218.25 39.6-289.8 2.25-115.65-60.75-241.65-31.95-299.7-13.05V95.75a27.05625 27.05625 0 0 0-27-27 27.05625 27.05625 0 0 0-27 27v834.75c0 14.85 12.15 27 27 27s27-12.15 27-27V611.9c44.1-13.95 199.35-56.25 293.85 1.8 45.9 28.35 96.75 37.8 143.55 37.8 89.1 0 164.7-34.2 169.65-36.45a27.9 27.9 0 0 0 15.75-24.75V174.5a27.5625 27.5625 0 0 0-10.35-21.15z" fill="#f54319" p-id="1472"></path></svg>';class ort{constructor(t){this._scene=t,this.initNodes()}initNodes(){var t,e,i,r,o,s,a,l,h,u,d;const{_scene:c}=this,g=new Jt({x:0,y:0,width:c._gantt.getAllDateColsWidth(),height:c._gantt.getAllHeaderRowsHeight(),clip:!0,pickable:!1});this.group=g,g.name="date-header-container",c.ganttGroup.addChild(this.group);const{unit:f,step:p}=c._gantt.parsedOptions.reverseSortedTimelineScales[0];let m=0;for(let v=0;v<c._gantt.timeLineHeaderLevel;v++){const{timelineDates:b,customLayout:y,visible:C}=c._gantt.parsedOptions.sortedTimelineScales[v];if(C===!1)continue;const w=new Jt({x:0,y:m,width:c._gantt.getAllDateColsWidth(),height:c._gantt.parsedOptions.timeLineHeaderRowHeights[v],clip:!1});m+=w.attribute.height,w.name="row-header",g.addChild(w);for(let _=0;_<b?.length;_++){const{days:A,endDate:x,startDate:S,title:T,dateIndex:M,unit:R}=b[_],E=Math.ceil(ce(S,c._gantt.parsedOptions.minDate,f,p)*c._gantt.parsedOptions.timelineColWidth),P=Math.ceil(ce(x,c._gantt.parsedOptions.minDate,f,p,1)*c._gantt.parsedOptions.timelineColWidth)-E,B=new Jt({x:E,y:0,width:P,height:w.attribute.height,clip:!1,fill:c._gantt.parsedOptions.timelineHeaderBackgroundColor});let k;B.name="date-header-cell";let L=!0;const O=w.attribute.height;if(y){let I;typeof y=="function"?I=y({width:P,height:O,index:_,startDate:S,endDate:x,days:A,dateIndex:M,title:T,ganttInstance:this._scene._gantt}):I=y,I&&(k=I.rootContainer,L=(t=I.renderDefaultText)!==null&&t!==void 0&&t,k.name="task-bar-custom-render"),k&&B.appendChild(k)}if(L){const{padding:I,textAlign:H,textBaseline:D,textOverflow:z,fontSize:G,fontWeight:U,color:j,strokeColor:X,textStick:Z}=c._gantt.parsedOptions.timelineHeaderStyles[v],J=mg(pg(I),H,D,P,O),q=new Oe({x:J.x,y:J.y,maxLineWidth:P,heightLimit:O,pickable:!0,text:T.toLocaleString(),fontSize:G,fontWeight:U,fill:j,stroke:X,lineWidth:2,textAlign:H,textBaseline:D,ellipsis:z==="clip"?"":z==="ellipsis"?"...":$(z)?z:void 0});q.attribute.textStick=Z,B.appendChild(q),q.name="date-header-cell-text"}if(v===c._gantt.timeLineHeaderLevel-1&&c._gantt.parsedOptions.markLineCreateOptions&&c._gantt.parsedOptions.markLineCreateOptions.markLineCreatable){const I=c._gantt.parsedOptions.markLineCreateOptions.markLineCreationStyle||{},H=I.size||24,D=I.iconSize||18,z=I.svg||rrt,G=new Jt({x:P/2-H/2,y:O/2-H/2,width:H,height:H,visiable:!0});G.name="markline-hover-group",G.data=b[_];const U=new Jt({x:0,y:0,width:H,height:H,cornerRadius:H/2,fill:I.fill||"#ccc",cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center",visibleAll:!1});U.name="markline-hover-inner-group",G.add(U);const j=new zo({width:D,height:D,image:z,cursor:"pointer",pickable:!0});j.name="markline-hover-icon",U.appendChild(j),B.add(G)}if(w.addChild(B),_>0){const I=Ke({pickable:!1,stroke:(e=c._gantt.parsedOptions.timelineHeaderVerticalLineStyle)===null||e===void 0?void 0:e.lineColor,lineWidth:(i=c._gantt.parsedOptions.timelineHeaderVerticalLineStyle)===null||i===void 0?void 0:i.lineWidth,lineDash:(r=c._gantt.parsedOptions.timelineHeaderVerticalLineStyle)===null||r===void 0?void 0:r.lineDash,points:[{x:1&((o=c._gantt.parsedOptions.timelineHeaderVerticalLineStyle)===null||o===void 0?void 0:o.lineWidth)?.5:0,y:0},{x:1&((s=c._gantt.parsedOptions.timelineHeaderVerticalLineStyle)===null||s===void 0?void 0:s.lineWidth)?.5:0,y:w.attribute.height}]});B.appendChild(I)}}if(v>0){const _=Ke({pickable:!1,stroke:(a=c._gantt.parsedOptions.timelineHeaderHorizontalLineStyle)===null||a===void 0?void 0:a.lineColor,lineWidth:(l=c._gantt.parsedOptions.timelineHeaderHorizontalLineStyle)===null||l===void 0?void 0:l.lineWidth,lineDash:(h=c._gantt.parsedOptions.timelineHeaderHorizontalLineStyle)===null||h===void 0?void 0:h.lineDash,points:[{x:0,y:1&((u=c._gantt.parsedOptions.timelineHeaderHorizontalLineStyle)===null||u===void 0?void 0:u.lineWidth)?.5:0},{x:c._gantt.getAllDateColsWidth(),y:1&((d=c._gantt.parsedOptions.timelineHeaderHorizontalLineStyle)===null||d===void 0?void 0:d.lineWidth)?.5:0}]});w.addChild(_)}}}setX(t){this.group.setAttribute("x",t)}setY(t){this.group.setAttribute("y",t)}resize(){var t,e,i,r;this.group.setAttribute("width",(e=(t=this.group.attribute)===null||t===void 0?void 0:t.width)!==null&&e!==void 0?e:0),this.group.setAttribute("height",(r=(i=this.group.attribute)===null||i===void 0?void 0:i.height)!==null&&r!==void 0?r:0)}refresh(){var t;(t=this.group)===null||t===void 0||t.parent.removeChild(this.group),this.initNodes()}showMarklineIcon(t){let e;return t.children.forEach((i=>{i.name==="date-header-cell-text"&&i.setAttribute("visible",!1),i.name==="markline-hover-group"&&(e=i.firstChild,e.setAttribute("visibleAll",!0))})),e}hideMarklineIconHover(t){let e;return t.children.forEach((i=>{i.name==="date-header-cell-text"&&i.setAttribute("visible",!0),i.name==="markline-hover-group"&&(e=i.firstChild,e.setAttribute("visibleAll",!1))})),e}}var Pt;(function(n){n.default="default",n.grabing="grabing",n.scrolling="scrolling"})(Pt||(Pt={}));var oe;(function(n){n.single="single",n.column="column",n.row="row",n.cross="cross",n.none="none"})(oe||(oe={}));const srt=["bgColor","color","strokeColor","borderColor","linkColor"];var Qe;(function(n){n.RECORD="RECORD",n.NONE="NONE",n.SUM="SUM",n.MIN="MIN",n.MAX="MAX",n.AVG="AVG",n.COUNT="COUNT",n.CUSTOM="CUSTOM",n.RECALCULATE="RECALCULATE"})(Qe||(Qe={}));var wB;(function(n){n.ASC="ASC",n.DESC="DESC",n.NORMAL="NORMAL",n.desc="desc",n.asc="asc",n.normal="normal"})(wB||(wB={}));var Zn;(function(n){n.top="top",n.bottom="bottom",n.left="left",n.right="right"})(Zn||(Zn={}));var Tt;(function(n){n.expand="expand",n.collapse="collapse",n.none="none",n.loading="loading"})(Tt||(Tt={}));var pe;(function(n){n.inlineFront="inlineFront",n.inlineEnd="inlineEnd",n.left="left",n.right="right",n.absoluteRight="absoluteRight",n.contentLeft="contentLeft",n.contentRight="contentRight",n.absolute="absolute"})(pe||(pe={}));var me;(function(n){n.frozen="frozen",n.sort="sort",n.dropDown="dropDown",n.dropDownState="dropDownState",n.play="play",n.damagePic="damagePic",n.expand="expand",n.collapse="collapse",n.drillDown="drillDown",n.drillUp="drillUp",n.dragReorder="dragReorder"})(me||(me={}));var on;(function(n){n.upwardIconName="sort_upward",n.downwardIconName="sort_downward",n.normalIconName="sort_normal",n.freezeIconName="freeze",n.frozenIconName="frozen",n.frozenCurrentIconName="frozenCurrent",n.dropdownIconName="dropdownIcon",n.expandIconName="expand",n.collapseIconName="collapse",n.dragReorderIconName="dragReorder",n.loadingIconName="loading"})(on||(on={}));class Ra{constructor(t){var e;this.isAggregator=!0,this.isRecord=!0,this.records=[],this.children=[],this.key=t.key,this.field=t.field,this.formatFun=t.formatFun,this.isRecord=(e=t.isRecord)!==null&&e!==void 0?e:this.isRecord}clearCacheValue(){this._formatedValue=void 0}formatValue(t,e,i){return this._formatedValue||(this.formatFun?this._formatedValue=this.formatFun(this.value(),t,e,i):this._formatedValue=this.value()),this._formatedValue}reset(){this.records=[],this.changedValue=void 0,this.children=[],this.clearCacheValue()}}class art extends Ra{constructor(){super(...arguments),this.type=Qe.RECORD,this.isRecord=!0}push(t){t&&this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator&&this.children&&this.children.push(t),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&this.children&&(this.children=this.children.filter((e=>e!==t)))),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&e.isAggregator&&this.children&&(this.children=this.children.map((i=>i===t?e:i))),this.clearCacheValue())}value(){var t;return(t=this.changedValue)!==null&&t!==void 0?t:this.records}reset(){this.children=[],this.changedValue=void 0,this.records=[]}recalculate(){}}class lrt extends Ra{constructor(){super(...arguments),this.type=Qe.NONE,this.isRecord=!0}push(t){t&&(this.isRecord&&(this.records=[t]),t.isAggregator&&this.children&&(this.children=[t]),this.field&&(this.fieldValue=t[this.field])),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&this.children&&(this.children=this.children.filter((e=>e!==t))),this.field&&this.records.length&&(this.fieldValue=this.records[this.records.length-1][this.field])),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&e.isAggregator&&this.children&&(this.children=this.children.map((i=>i===t?e:i))),this.field&&this.records.length&&(this.fieldValue=this.records[this.records.length-1][this.field]),this.clearCacheValue())}value(){var t;return(t=this.changedValue)!==null&&t!==void 0?t:this.fieldValue}reset(){this.children=[],this.changedValue=void 0,this.records=[],this.fieldValue=void 0}recalculate(){}}class hrt extends Ra{constructor(t){super(t),this.type=Qe.CUSTOM,this.isRecord=!0,this.values=[],this.aggregationFun=t.aggregationFun}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator&&this.children&&this.children.push(t),this.field&&this.values.push(t[this.field])),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&e.isAggregator&&this.children&&(this.children=this.children.map((i=>i===t?e:i))),this.field&&this.records.length&&(this.values=this.records.map((i=>i[this.field]))),this.clearCacheValue())}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&this.children&&(this.children=this.children.filter((e=>e!==t))),this.field&&this.records.length&&(this.values=this.records.map((e=>e[this.field])))),this.clearCacheValue()}value(){var t,e;return this.fieldValue||(this.fieldValue=(t=this.aggregationFun)===null||t===void 0?void 0:t.call(this,this.values,this.records,this.field)),(e=this.changedValue)!==null&&e!==void 0?e:this.fieldValue}reset(){this.records=[],this.children=[],this.changedValue=void 0,this.fieldValue=void 0}recalculate(){this.fieldValue=void 0,this._formatedValue=void 0}}class urt extends Ra{constructor(t){var e;super(t),this.type=Qe.SUM,this.sum=0,this.positiveSum=0,this.nagetiveSum=0,this.needSplitPositiveAndNegativeForSum=!1,this.needSplitPositiveAndNegativeForSum=(e=t.needSplitPositiveAndNegative)!==null&&e!==void 0&&e}push(t){if(t){if(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator&&this.children){this.children.push(t);const e=t.value();this.sum+=e??0,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum+=e:e<0&&(this.nagetiveSum+=e))}else if(this.field&&!isNaN(parseFloat(t[this.field]))){const e=parseFloat(t[this.field]);this.sum+=e,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum+=e:e<0&&(this.nagetiveSum+=e))}}this.clearCacheValue()}deleteRecord(t){if(t){if(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&this.children){this.children=this.children.filter((i=>i!==t));const e=t.value();this.sum-=e??0,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum-=e:e<0&&(this.nagetiveSum-=e))}else if(this.field&&!isNaN(parseFloat(t[this.field]))){const e=parseFloat(t[this.field]);this.sum-=e,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum-=e:e<0&&(this.nagetiveSum-=e))}}this.clearCacheValue()}updateRecord(t,e){if(t&&e){if(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&this.children){const i=t.value();this.children=this.children.filter((o=>o!==t));const r=e.value();this.children.push(e),this.sum+=r-i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum-=i:i<0&&(this.nagetiveSum-=i),r>0?this.positiveSum+=r:r<0&&(this.nagetiveSum+=r))}else if(this.field&&!isNaN(parseFloat(t[this.field]))){const i=parseFloat(t[this.field]),r=parseFloat(e[this.field]);this.sum+=r-i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum-=i:i<0&&(this.nagetiveSum-=i),r>0?this.positiveSum+=r:r<0&&(this.nagetiveSum+=r))}this.clearCacheValue()}}value(){var t,e;return(t=this.changedValue)!==null&&t!==void 0?t:((e=this.records)===null||e===void 0?void 0:e.length)>=1?this.sum:void 0}positiveValue(){return this.positiveSum}negativeValue(){return this.nagetiveSum}reset(){super.reset(),this.records=[],this.sum=0}recalculate(){if(this.sum=0,this._formatedValue=void 0,this.children&&this.children.length>0)for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.isAggregator){const i=e.value();this.sum+=i??0,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum+=i:i<0&&(this.nagetiveSum+=i))}}else if(this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];if(e.isAggregator){const i=e.value();this.sum+=i??0,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum+=i:i<0&&(this.nagetiveSum+=i))}else if(this.field&&!isNaN(parseFloat(e[this.field]))){const i=parseFloat(e[this.field]);this.sum+=i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum+=i:i<0&&(this.nagetiveSum+=i))}}}}class drt extends Ra{constructor(){super(...arguments),this.type=Qe.COUNT,this.count=0}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator?(this.children&&this.children.push(t),this.count+=t.value()):this.count++),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator?(this.children&&(this.children=this.children.filter((e=>e!==t))),this.count-=t.value()):this.count--),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&(this.count+=e.value()-t.value()),t.isAggregator&&e.isAggregator&&this.children&&(this.children=this.children.map((i=>i===t?e:i))))}value(){var t;return(t=this.changedValue)!==null&&t!==void 0?t:this.count}reset(){this.changedValue=void 0,this.children=[],this.records=[],this.count=0}recalculate(){if(this.count=0,this._formatedValue=void 0,this.children&&this.children.length>0)for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.isAggregator){const i=e.value();this.count+=i??0}else this.count++}else if(this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator?this.count+=e.value():this.count++}}}class crt extends Ra{constructor(){super(...arguments),this.type=Qe.AVG,this.sum=0,this.count=0}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator&&t.type===Qe.AVG?(this.children&&this.children.push(t),this.sum+=t.sum,this.count+=t.count):this.field&&!isNaN(parseFloat(t[this.field]))&&(this.sum+=parseFloat(t[this.field]),this.count++)),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&t.type===Qe.AVG?(this.children&&(this.children=this.children.filter((e=>e!==t))),this.sum-=t.sum,this.count-=t.count):this.field&&!isNaN(parseFloat(t[this.field]))&&(this.sum-=parseFloat(t[this.field]),this.count--)),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&t.type===Qe.AVG?(this.children&&e.isAggregator&&(this.children=this.children.map((i=>i===t?e:i))),this.sum+=e.sum-t.sum,this.count+=e.count-t.count):this.field&&!isNaN(parseFloat(t[this.field]))&&(this.sum+=parseFloat(e[this.field])-parseFloat(t[this.field])),this.clearCacheValue())}value(){var t,e;return(t=this.changedValue)!==null&&t!==void 0?t:((e=this.records)===null||e===void 0?void 0:e.length)>=1?this.sum/this.count:void 0}reset(){this.changedValue=void 0,this.children=[],this.records=[],this.sum=0,this.count=0}recalculate(){if(this.sum=0,this.count=0,this._formatedValue=void 0,this.children&&this.children.length>0)for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.isAggregator&&e.type===Qe.AVG){const i=e.value();this.sum+=i*e.count,this.count+=e.count}}else if(this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator&&e.type===Qe.AVG?(this.sum+=e.sum,this.count+=e.count):this.field&&!isNaN(parseFloat(e[this.field]))&&(this.sum+=parseFloat(e[this.field]),this.count++)}}}class grt extends Ra{constructor(){super(...arguments),this.type=Qe.MAX,this.max=Number.MIN_SAFE_INTEGER}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator?(this.children&&this.children.push(t),this.max=t.max>this.max?t.max:this.max):typeof t=="number"?this.max=t>this.max?t:this.max:this.field&&typeof t[this.field]=="number"?this.max=t[this.field]>this.max?t[this.field]:this.max:this.field&&!isNaN(t[this.field])&&(this.max=parseFloat(t[this.field])>this.max?parseFloat(t[this.field]):this.max)),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&this.children&&(this.children=this.children.filter((e=>e!==t))),this.recalculate())}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&e.isAggregator&&this.children&&(this.children=this.children.map((i=>i===t?e:i))),this.recalculate())}value(){var t,e;return(t=this.changedValue)!==null&&t!==void 0?t:((e=this.records)===null||e===void 0?void 0:e.length)>=1?this.max:void 0}reset(){this.records=[],this.changedValue=void 0,this.children=[],this.max=Number.MIN_SAFE_INTEGER}recalculate(){if(this.max=Number.MIN_SAFE_INTEGER,this._formatedValue=void 0,this.children&&this.children.length>0)for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.isAggregator){const i=e.value();this.max=Math.max(this.max,i)}}else if(this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator?this.max=e.max>this.max?e.max:this.max:typeof e=="number"?this.max=e>this.max?e:this.max:this.field&&typeof e[this.field]=="number"?this.max=e[this.field]>this.max?e[this.field]:this.max:this.field&&!isNaN(e[this.field])&&(this.max=parseFloat(e[this.field])>this.max?parseFloat(e[this.field]):this.max)}}}class frt extends Ra{constructor(){super(...arguments),this.type=Qe.MIN,this.min=Number.MAX_SAFE_INTEGER}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator?(this.children&&this.children.push(t),this.min=t.min<this.min?t.min:this.min):typeof t=="number"?this.min=t<this.min?t:this.min:this.field&&typeof t[this.field]=="number"?this.min=t[this.field]<this.min?t[this.field]:this.min:this.field&&!isNaN(t[this.field])&&(this.min=parseFloat(t[this.field])<this.min?parseFloat(t[this.field]):this.min)),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter((e=>e!==t))),t.isAggregator&&this.children&&(this.children=this.children.filter((e=>e!==t))),this.recalculate())}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map((i=>i===t?e:i))),t.isAggregator&&e.isAggregator&&this.children&&(this.children=this.children.map((i=>i===t?e:i))),this.recalculate())}value(){var t,e;return(t=this.changedValue)!==null&&t!==void 0?t:((e=this.records)===null||e===void 0?void 0:e.length)>=1?this.min:void 0}reset(){this.records=[],this.changedValue=void 0,this.children=[],this.min=Number.MAX_SAFE_INTEGER}recalculate(){if(this.min=Number.MAX_SAFE_INTEGER,this._formatedValue=void 0,this.children&&this.children.length>0)for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.isAggregator){const i=e.value();this.min=Math.min(this.min,i)}}else if(this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator?this.min=e.min<this.min?e.min:this.min:typeof e=="number"?this.min=e<this.min?e:this.min:this.field&&typeof e[this.field]=="number"?this.min=e[this.field]<this.min?e[this.field]:this.min:this.field&&!isNaN(e[this.field])&&(this.min=parseFloat(e[this.field])<this.min?parseFloat(e[this.field]):this.min)}}}let prt=1,Rv=class{constructor(){this.listenersData={listeners:{},listenerData:{}}}on(t,e){const i=this.listenersData.listeners[t]||(this.listenersData.listeners[t]=[]);i.push(e);const r=prt++;return this.listenersData.listenerData[r]={type:t,listener:e,remove:()=>{delete this.listenersData.listenerData[r];const o=i.indexOf(e);i.splice(o,1),this.listenersData.listeners[t].length||delete this.listenersData.listeners[t]}},r}off(t,e){var i;if(e){const r=t;this.removeEventListener(r,e)}else{const r=t;if(!this.listenersData)return;(i=this.listenersData.listenerData[r])===null||i===void 0||i.remove()}}addEventListener(t,e,i){this.on(t,e)}removeEventListener(t,e){if(this.listenersData)for(const i in this.listenersData.listenerData){const r=this.listenersData.listenerData[i];r.type===t&&r.listener===e&&this.off(i)}}hasListeners(t){return!!this.listenersData&&!!this.listenersData.listeners[t]}fireListeners(t,e){if(!this.listenersData)return[];const i=this.listenersData.listeners[t];return i?i.map((r=>r.call(this,e))).filter((r=>$(r))):[]}release(){delete this.listenersData}},xB;const mrt={CHANGE_STYLE:"change_style"};let lo=class Vw extends Rv{static get EVENT_TYPE(){return mrt}static get DEFAULT(){return xB||(xB=new Vw)}constructor(t={},e={}){var i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x,S,T,M,R,E,P,B,k,L;super(),this._defaultPadding=[10,16,10,16],this._textAlign=(i=t?.textAlign)!==null&&i!==void 0?i:e?.textAlign,this._textBaseline=(r=t?.textBaseline)!==null&&r!==void 0?r:e?.textBaseline,this._color=(o=t?.color)!==null&&o!==void 0?o:e?.color,this._strokeColor=(s=t?.strokeColor)!==null&&s!==void 0?s:e?.strokeColor,this._fontSize=(a=t.fontSize)!==null&&a!==void 0?a:e?.fontSize,this._fontFamily=(l=t.fontFamily)!==null&&l!==void 0?l:e?.fontFamily,this._fontWeight=(h=t.fontWeight)!==null&&h!==void 0?h:e?.fontWeight,this._fontVariant=(u=t.fontVariant)!==null&&u!==void 0?u:e?.fontVariant,this._fontStyle=(d=t.fontStyle)!==null&&d!==void 0?d:e?.fontStyle,this._padding=(g=(c=t?.padding)!==null&&c!==void 0?c:e?.padding)!==null&&g!==void 0?g:this._defaultPadding,this._borderColor=(f=t?.borderColor)!==null&&f!==void 0?f:e?.borderColor,this._textOverflow=(p=t?.textOverflow)!==null&&p!==void 0?p:e?.textOverflow,this._textStick=(v=(m=t.textStick)!==null&&m!==void 0?m:e?.textStick)!==null&&v!==void 0&&v,this._textStickBaseOnAlign=(y=(b=t.textStickBaseOnAlign)!==null&&b!==void 0?b:e?.textStickBaseOnAlign)!==null&&y!==void 0&&y,this._bgColor=(C=t?.bgColor)!==null&&C!==void 0?C:e?.bgColor,this._lineHeight=(w=t?.lineHeight)!==null&&w!==void 0?w:e?.lineHeight,this._underline=(_=t?.underline)!==null&&_!==void 0?_:e?.underline,this._underlineColor=(A=t?.underlineColor)!==null&&A!==void 0?A:e?.underlineColor,this._underlineDash=(x=t?.underlineDash)!==null&&x!==void 0?x:e?.underlineDash,this._underlineOffset=(S=t?.underlineOffset)!==null&&S!==void 0?S:e?.underlineOffset,this._lineThrough=(T=t?.lineThrough)!==null&&T!==void 0?T:e?.lineThrough,this._lineThroughColor=(M=t?.lineThroughColor)!==null&&M!==void 0?M:e?.lineThroughColor,this._lineThroughDash=(R=t?.lineThroughDash)!==null&&R!==void 0?R:e?.lineThroughDash,this._linkColor=(E=t?.linkColor)!==null&&E!==void 0?E:e?.linkColor,this._cursor=(P=t.cursor)!==null&&P!==void 0?P:e?.cursor,this._borderLineWidth=(B=t.borderLineWidth)!==null&&B!==void 0?B:e?.borderLineWidth,this._borderLineDash=(k=t.borderLineDash)!==null&&k!==void 0?k:e?.borderLineDash,this._marked=(L=t.marked)!==null&&L!==void 0?L:e?.marked}get color(){return this._color}set color(t){this._color=t}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t}get padding(){return this._padding}set padding(t){this._padding=t}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t}get textStick(){return this._textStick}set textStick(t){this._textStick=t}get textStickBaseOnAlign(){return this._textStickBaseOnAlign}set textStickBaseOnAlign(t){this._textStickBaseOnAlign=t}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t}get underline(){return this._underline}set underline(t){this._underline=t}get underlineColor(){return this._underlineColor}set underlineColor(t){this._underlineColor=t}get underlineDash(){return this._underlineDash}set underlineDash(t){this._underlineDash=t}get underlineOffset(){return this._underlineOffset}set underlineOffset(t){this._underlineOffset=t}get lineThrough(){return this._lineThrough}set lineThrough(t){this._lineThrough=t}get lineThroughColor(){return this._lineThroughColor}set lineThroughColor(t){this._lineThroughColor=t}get lineThroughDash(){return this._lineThroughDash}set lineThroughDash(t){this._lineThroughDash=t}get linkColor(){return this._linkColor}set linkColor(t){this._linkColor=t}get cursor(){return this._cursor}set cursor(t){this._cursor=t}get borderLineWidth(){return this._borderLineWidth}set borderLineWidth(t){this._borderLineWidth=t}get borderLineDash(){return this._borderLineDash}set borderLineDash(t){this._borderLineDash=t}get marked(){return this._marked}set marked(t){this._marked=t}clone(){return new Vw(this,null)}},SB,vrt=class Gw extends lo{static get DEFAULT(){return SB||(SB=new Gw)}constructor(t={},e={}){super(t,e)}clone(){return new Gw(this,null)}},AB;class Wc extends lo{static get DEFAULT(){return AB||(AB=new Wc)}constructor(t={},e={}){var i,r;super(t,e),this._autoWrapText=(i=t?.autoWrapText)!==null&&i!==void 0?i:e?.autoWrapText,this._lineClamp=(r=t?.lineClamp)!==null&&r!==void 0?r:e?.lineClamp}clone(){return new Wc(this,null)}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t}}let MB,$w=class Yf extends lo{static get DEFAULT(){return MB||(MB=new Yf)}constructor(t={},e={},i={}){var r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x,S;super(t,e),this._size=((o=(r=t?.size)!==null&&r!==void 0?r:e?.size)!==null&&o!==void 0?o:i?.size)||14,this._spaceBetweenTextAndIcon=((a=(s=t?.spaceBetweenTextAndIcon)!==null&&s!==void 0?s:e?.spaceBetweenTextAndIcon)!==null&&a!==void 0?a:i?.spaceBetweenTextAndIcon)||8,this._defaultFill=(h=(l=t?.checkboxStyle)===null||l===void 0?void 0:l.defaultFill)!==null&&h!==void 0?h:i?.defaultFill,this._defaultStroke=(d=(u=t?.checkboxStyle)===null||u===void 0?void 0:u.defaultStroke)!==null&&d!==void 0?d:i?.defaultStroke,this._disableFill=(g=(c=t?.checkboxStyle)===null||c===void 0?void 0:c.disableFill)!==null&&g!==void 0?g:i?.disableFill,this._checkedFill=(p=(f=t?.checkboxStyle)===null||f===void 0?void 0:f.checkedFill)!==null&&p!==void 0?p:i?.checkedFill,this._checkedStroke=(v=(m=t?.checkboxStyle)===null||m===void 0?void 0:m.checkedStroke)!==null&&v!==void 0?v:i?.checkedStroke,this._disableCheckedFill=(y=(b=t?.checkboxStyle)===null||b===void 0?void 0:b.disableCheckedFill)!==null&&y!==void 0?y:i?.disableCheckedFill,this._disableCheckedStroke=(w=(C=t?.checkboxStyle)===null||C===void 0?void 0:C.disableCheckedStroke)!==null&&w!==void 0?w:i?.disableCheckedStroke,this._checkIconImage=(A=(_=t?.checkboxStyle)===null||_===void 0?void 0:_.checkIconImage)!==null&&A!==void 0?A:i?.checkIconImage,this._indeterminateIconImage=(S=(x=t?.checkboxStyle)===null||x===void 0?void 0:x.indeterminateIconImage)!==null&&S!==void 0?S:i?.indeterminateIconImage}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}get checkIconImage(){return this._checkIconImage}set checkIconImage(t){this._checkIconImage=t}get indeterminateIconImage(){return this._indeterminateIconImage}set indeterminateIconImage(t){this._indeterminateIconImage=t}getStyle(t){return new Yf(t,this)}clone(){return new Yf(this)}},TB;class wl extends lo{static get DEFAULT(){return TB||(TB=new wl)}constructor(t={},e={},i={}){var r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x,S,T,M;super(t,e),this._size=((o=(r=t?.size)!==null&&r!==void 0?r:e?.size)!==null&&o!==void 0?o:i?.size)||14,this._spaceBetweenTextAndIcon=((a=(s=t?.spaceBetweenTextAndIcon)!==null&&s!==void 0?s:e?.spaceBetweenTextAndIcon)!==null&&a!==void 0?a:i?.spaceBetweenTextAndIcon)||8,this._spaceBetweenRadio=((h=(l=t?.spaceBetweenRadio)!==null&&l!==void 0?l:e?.spaceBetweenRadio)!==null&&h!==void 0?h:i?.spaceBetweenRadio)||2,this._innerRadius=(d=(u=t?.radioStyle)===null||u===void 0?void 0:u.innerRadius)!==null&&d!==void 0?d:i?.innerRadius,this._outerRadius=(g=(c=t?.radioStyle)===null||c===void 0?void 0:c.outerRadius)!==null&&g!==void 0?g:i?.outerRadius,this._defaultFill=(p=(f=t?.radioStyle)===null||f===void 0?void 0:f.defaultFill)!==null&&p!==void 0?p:i?.defaultFill,this._defaultStroke=(v=(m=t?.radioStyle)===null||m===void 0?void 0:m.defaultStroke)!==null&&v!==void 0?v:i?.defaultStroke,this._disableFill=(y=(b=t?.radioStyle)===null||b===void 0?void 0:b.disableFill)!==null&&y!==void 0?y:i?.disableFill,this._checkedFill=(w=(C=t?.radioStyle)===null||C===void 0?void 0:C.checkedFill)!==null&&w!==void 0?w:i?.checkedFill,this._checkedStroke=(A=(_=t?.radioStyle)===null||_===void 0?void 0:_.checkedStroke)!==null&&A!==void 0?A:i?.checkedStroke,this._disableCheckedFill=(S=(x=t?.radioStyle)===null||x===void 0?void 0:x.disableCheckedFill)!==null&&S!==void 0?S:i?.disableCheckedFill,this._disableCheckedStroke=(M=(T=t?.radioStyle)===null||T===void 0?void 0:T.disableCheckedStroke)!==null&&M!==void 0?M:i?.disableCheckedStroke}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get spaceBetweenRadio(){return this._spaceBetweenRadio}set spaceBetweenRadio(t){this._spaceBetweenRadio=t}get innerRadius(){return this._innerRadius}set innerRadius(t){this._innerRadius=t}get outerRadius(){return this._outerRadius}set outerRadius(t){this._outerRadius=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}getStyle(t){return new wl(t,this)}clone(){return new wl(this)}}let RB;class xl extends lo{static get DEFAULT(){return RB||(RB=new xl)}constructor(t={},e={},i={}){var r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w;super(t,e),this._spaceBetweenTextAndCircle=((o=(r=t?.spaceBetweenTextAndCircle)!==null&&r!==void 0?r:e?.spaceBetweenTextAndCircle)!==null&&o!==void 0?o:i?.spaceBetweenTextAndCircle)||6,this._circleRadius=((a=(s=t?.switchStyle)===null||s===void 0?void 0:s.circleRadius)!==null&&a!==void 0?a:i?.circleRadius)||8,this._boxWidth=((h=(l=t?.switchStyle)===null||l===void 0?void 0:l.boxWidth)!==null&&h!==void 0?h:i?.boxWidth)||40,this._boxHeight=((d=(u=t?.switchStyle)===null||u===void 0?void 0:u.boxHeight)!==null&&d!==void 0?d:i?.boxHeight)||24,this._checkedFill=((g=(c=t?.switchStyle)===null||c===void 0?void 0:c.checkedFill)!==null&&g!==void 0?g:i?.checkedFill)||"#165DFF",this._uncheckedFill=((p=(f=t?.switchStyle)===null||f===void 0?void 0:f.uncheckedFill)!==null&&p!==void 0?p:i?.uncheckedFill)||"#c9cdd4",this._disableCheckedFill=((v=(m=t?.switchStyle)===null||m===void 0?void 0:m.disableCheckedFill)!==null&&v!==void 0?v:i?.disableCheckedFill)||"#94bfff",this._disableUncheckedFill=((y=(b=t?.switchStyle)===null||b===void 0?void 0:b.disableUncheckedFill)!==null&&y!==void 0?y:i?.disableUncheckedFill)||"#f2f3f5",this._circleFill=((w=(C=t?.switchStyle)===null||C===void 0?void 0:C.circleFill)!==null&&w!==void 0?w:i?.circleFill)||"#FFF"}get spaceBetweenTextAndCircle(){return this._spaceBetweenTextAndCircle}set spaceBetweenTextAndCircle(t){this._spaceBetweenTextAndCircle=t}get circleRadius(){return this._circleRadius}set circleRadius(t){this._circleRadius=t}get boxWidth(){return this._boxWidth}set boxWidth(t){this._boxWidth=t}get boxHeight(){return this._boxHeight}set boxHeight(t){this._boxHeight=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get uncheckedFill(){return this._uncheckedFill}set uncheckedFill(t){this._uncheckedFill=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableUncheckedFill(){return this._disableUncheckedFill}set disableUncheckedFill(t){this._disableUncheckedFill=t}get circleFill(){return this._circleFill}set circleFill(t){this._circleFill=t}getStyle(t){return new xl(t,this)}clone(){return new xl(this)}}let BB;class Sl extends lo{static get DEFAULT(){return BB||(BB=new Sl)}constructor(t={},e={},i={}){var r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x,S;super(t,e),this._buttonColor=((o=(r=t?.buttonStyle)===null||r===void 0?void 0:r.buttonColor)!==null&&o!==void 0?o:i?.buttonColor)||"#165DFF",this._buttonBorderColor=((a=(s=t?.buttonStyle)===null||s===void 0?void 0:s.buttonBorderColor)!==null&&a!==void 0?a:i?.buttonBorderColor)||"#165DFF",this._buttonLineWidth=((h=(l=t?.buttonStyle)===null||l===void 0?void 0:l.buttonLineWidth)!==null&&h!==void 0?h:i?.buttonLineWidth)||1,this._buttonBorderRadius=((d=(u=t?.buttonStyle)===null||u===void 0?void 0:u.buttonBorderRadius)!==null&&d!==void 0?d:i?.buttonBorderRadius)||2,this._buttonHoverColor=((g=(c=t?.buttonStyle)===null||c===void 0?void 0:c.buttonHoverColor)!==null&&g!==void 0?g:i?.buttonHoverColor)||"#4080FF",this._buttonHoverBorderColor=((p=(f=t?.buttonStyle)===null||f===void 0?void 0:f.buttonHoverBorderColor)!==null&&p!==void 0?p:i?.buttonHoverBorderColor)||"#4080FF",this._buttonTextHoverColor=(v=(m=t?.buttonStyle)===null||m===void 0?void 0:m.buttonTextHoverColor)!==null&&v!==void 0?v:i?.buttonTextHoverColor,this._buttonDisableColor=((y=(b=t?.buttonStyle)===null||b===void 0?void 0:b.buttonDisableColor)!==null&&y!==void 0?y:i?.buttonDisableColor)||"#94bfff",this._buttonDisableBorderColor=((w=(C=t?.buttonStyle)===null||C===void 0?void 0:C.buttonDisableBorderColor)!==null&&w!==void 0?w:i?.buttonDisableBorderColor)||"#94bfff",this._buttonTextDisableColor=(A=(_=t?.buttonStyle)===null||_===void 0?void 0:_.buttonTextDisableColor)!==null&&A!==void 0?A:i?.buttonTextDisableColor,this._buttonPadding=((S=(x=t?.buttonStyle)===null||x===void 0?void 0:x.buttonPadding)!==null&&S!==void 0?S:i?.buttonPadding)||10}get buttonColor(){return this._buttonColor}set buttonColor(t){this._buttonColor=t}get buttonBorderColor(){return this._buttonBorderColor}set buttonBorderColor(t){this._buttonBorderColor=t}get buttonLineWidth(){return this._buttonLineWidth}set buttonLineWidth(t){this._buttonLineWidth=t}get buttonBorderRadius(){return this._buttonBorderRadius}set buttonBorderRadius(t){this._buttonBorderRadius=t}get buttonHoverColor(){return this._buttonHoverColor}set buttonHoverColor(t){this._buttonHoverColor=t}get buttonHoverBorderColor(){return this._buttonHoverBorderColor}set buttonHoverBorderColor(t){this._buttonHoverBorderColor=t}get buttonTextHoverColor(){return this._buttonTextHoverColor}set buttonTextHoverColor(t){this._buttonTextHoverColor=t}get buttonDisableColor(){return this._buttonDisableColor}set buttonDisableColor(t){this._buttonDisableColor=t}get buttonDisableBorderColor(){return this._buttonDisableBorderColor}set buttonDisableBorderColor(t){this._buttonDisableBorderColor=t}get buttonTextDisableColor(){return this._buttonTextDisableColor}set buttonTextDisableColor(t){this._buttonTextDisableColor=t}get buttonTextHoverBorderColor(){return this._buttonTextHoverBorderColor}set buttonTextHoverBorderColor(t){this._buttonTextHoverBorderColor=t}get buttonPadding(){return this._buttonPadding}set buttonPadding(t){this._buttonPadding=t}getStyle(t){return new Sl(t,this)}clone(){return new Sl(this)}}const{EVENT_TYPE:Ept}=lo;function Xx(n,t,e,i=lo,r,o){var s,a,l,h;return n||t?n instanceof lo?n:typeof n=="function"?Xx(n(e),t,e,i,r,o):(n||(n={}),r&&!$(n.autoWrapText)&&(n.autoWrapText=!0),i===$w?new $w(n??{},t??{},(s=o.checkboxStyle)!==null&&s!==void 0?s:{}):i===wl?new wl(n??{},t??{},(a=o.radioStyle)!==null&&a!==void 0?a:{}):i===xl?new xl(n??{},t??{},(l=o.switchStyle)!==null&&l!==void 0?l:{}):i===Sl?new Sl(n??{},t??{},(h=o.buttonStyle)!==null&&h!==void 0?h:{}):new i(n??{},t??{})):i.DEFAULT}class te{static get mode(){return te._mode||(te._mode=brt()),te._mode}static set mode(t){te._mode=t}static RegisterCreateCanvas(t){te.CreateCanvas=t}static RegisterLoadImage(t){te.LoadImage=t}static GetCreateCanvasFunc(){return te.CreateCanvas?te.CreateCanvas:te.mode==="worker"?(t=200,e=200)=>new OffscreenCanvas(t,e):void 0}static RegisterRequestAnimationFrame(t){te.RequestAnimationFrame=t()}static GetRequestAnimationFrame(){if(te.RequestAnimationFrame)return te.RequestAnimationFrame}static RegisterCancelAnimationFrame(t){te.CancelAnimationFrame=t()}static GetCancelAnimationFrame(){if(te.CancelAnimationFrame)return te.CancelAnimationFrame}}function brt(){let n="browser";try{window.type==="node"?n="node":typeof window>"u"||window.performance?typeof window>"u"&&(n="node"):n="miniApp"}catch{n="node"}return n}te.dpr=0;function yrt(){try{const n=window.getSelection();if(n){if(typeof n.removeAllRanges=="function")return void n.removeAllRanges();if(typeof n.empty=="function")return void n.empty();if(typeof n.collapse=="function")return void n.collapse(document.body,0)}}catch{}}function Crt(){if(te.mode==="node")return;const n=document.createElement("style");n.id="vtable-style-styleSheet",n.textContent=`
.vtable .input-container {
	position: absolute;
	top:0px;
}
.vtable .table-scrollable {
	position: absolute;
	overflow: scroll;
}
.vtable .table-scrollable::-webkit-scrollbar-button{
	background-color: transparent;
}
.vtable .table-scrollable::-webkit-scrollbar-track-piece{
	background-color: transparent;
}
.vtable .table-scrollable::-webkit-scrollbar-corner {
	background-color: transparent;
}
.vtable .table-scrollable::-webkit-scrollbar-thumb {
	border-radius      : 4px;
	background-color   : rgba(100, 100, 100, .5);
}

.vtable .table-scroll-end-point {
	opacity: 0;
	position: relative;
}
.vtable {
	/* 设置overflow: auto 应该是为了滚动条的某个问题 但设置了auto之后 dom的下拉菜单只能显示在vtable节点中 超出会截断;现在去掉auto 暂时滚动条的问题没有发现 */
	/* overflow: auto; */
	position: relative;
	width: 100%;
	height: 100%;
	text-align: left;
  -webkit-font-smoothing:auto;

  overflow: hidden; // for react-vtable dom custom element
}

.vtable-gantt {
	/* 设置overflow: auto 应该是为了滚动条的某个问题 但设置了auto之后 dom的下拉菜单只能显示在vtable节点中 超出会截断;现在去掉auto 暂时滚动条的问题没有发现 */
	/* overflow: auto; */
	position: absolute;
	width: 100%;
	height: 100%;
	text-align: left;
  -webkit-font-smoothing:auto;

  overflow: hidden; // for react-vtable dom custom element
}
.vtable .table-component-container {
  pointer-events: none;
  overflow: hidden;
  position: absolute;
  top: 0px;
  left: 0px;
}
.vtable > canvas {
	position: absolute;
	width: 0;
	height: 0;
}
.vtable .table-focus-control {
	position: relative !important;
	width: 1px;
	height: 1px;
	opacity: 0;
	padding: 0;
	margin: 0;
	box-sizing: border-box;
	pointer-events: none;
	max-width: 500px;
	max-height: 500px;
	float: none !important;
}
.vtable input.table-focus-control::-ms-clear {
	visibility: hidden;
}
.vtable input.table-focus-control.composition {
	opacity: 1;
	max-width: none;
	max-height: none;
}
`,document.head.appendChild(n)}function vy(n){var t;return n?.hoverOn||n?.horizontalVisible&&n?.horizontalVisible==="none"||!n?.horizontalVisible&&n?.visible==="none"?0:(t=n?.width)!==null&&t!==void 0?t:7}function by(n){var t;return n?.hoverOn||n?.verticalVisible&&n?.verticalVisible==="none"||!n?.verticalVisible&&n?.visible==="none"?0:(t=n?.width)!==null&&t!==void 0?t:7}function _rt(n){return!!$(n)&&(!wt(n)||n.some((t=>$(t))))}function wrt(n){return n===0||wt(n)&&n.every((t=>t===0))}function xrt(n){const t=n.stateManager.select.ranges,e=[];for(let i=0;i<t.length;i++){const r=t[i];e.push({range:r,style:{cellBorderColor:"blue",cellBorderLineWidth:2,cellBorderLineDash:[5,5]}})}n.stateManager.setCustomSelectRanges(e)}function Srt(n){n.stateManager.setCustomSelectRanges([])}const Art=n=>{switch(Object.prototype.toString.call(n)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}},Bv=(n,t)=>Art(n)===t,mf=n=>Bv(n,"object"),Mrt=n=>Bv(n,"string"),Trt=n=>Bv(n,"number"),Rrt=n=>Bv(n,"boolean");function ke(n,...t){if(!t.length)return n||{};const e=t.shift();if(mf(n)&&mf(e))for(const i in e)mf(e[i])?(n[i]||Object.assign(n,{[i]:{}}),mf(n[i])||Object.assign(n,{[i]:e[i]}),ke(n[i],e[i])):e[i]!==null&&e[i]!==void 0&&Object.assign(n,{[i]:e[i]});return ke(n,...t)}function kB(n){return typeof n=="function"&&(n=n()),$(n)?`${n}`:""}function PB(n,t){let e=null;return function(...i){e||(n.apply(this,i),e=setTimeout((()=>{e=null}),t))}}function Brt(n,t){let e=null;return function(...i){e||(e=setTimeout((()=>{n.apply(this,i),e=null}),t))}}function yy(n,t){for(n=`${n}`;n.length<t;)n="0"+n;return n}function Fs(n,t,e){n=(n=n.replace(/^\s*|\s*$/,"")).replace(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i,"#$1$1$2$2$3$3");const i=Math.round(256*t)*1,r=n.match(new RegExp("^rgba?\\(\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])(?:\\s*,\\s*(0|1|0?\\.\\d+))?\\s*\\)$","i")),o=r&&$(r[4])?r[4]:null,s=r?[r[1],r[2],r[3]]:n.replace(/^#?([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])/i,(function(){return`${parseInt(arguments[1],16)},${parseInt(arguments[2],16)},${parseInt(arguments[3],16)}`})).split(/,/);return r?`rgb${o!==null?"a":""}(${Math.min(parseInt(s[0],10)+i,255)}, ${Math.min(parseInt(s[1],10)+i,255)}, ${Math.min(parseInt(s[2],10)+i,255)}${o!==null?`, ${o}`:""})`:["#",yy(Math.min(parseInt(s[0],10)+i,255).toString(16),2),yy(Math.min(parseInt(s[1],10)+i,255).toString(16),2),yy(Math.min(parseInt(s[2],10)+i,255).toString(16),2)].join("")}function kv(n){return Mrt(n)||Trt(n)||Rrt(n)?n.toString():""}function Uw(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)}function z0(n,t,e){return e!=="desc"?n===t?0:n>t?1:-1:n===t?0:n<t?1:-1}function krt(n,t){let e,i=n;for(;(e=t.shift())&&(i=i[e],i););return i}function Prt(n){return/^-?\d+(\.\d+)?$/.test(n)}function Xd(n){const t=[];for(let e=0;e<n.length;e++)t.indexOf(n[e])===-1&&t.push(n[e]);return t}function Ert(n){const t=window.getSelection();if(t.rangeCount){const e=t.getRangeAt(0);return e.endOffset>e.startOffset&&n.contains(e.commonAncestorContainer)}return!1}function Yx(n,t,e){e(n),n?.[t]&&Array.isArray(n?.[t])&&n[t].forEach((i=>Yx(i,t,e)))}function Pv(n,t,e){let i=0;if(!t||t===Tt.collapse||t===Tt.none)return i;const r=e.filteredChildren?e.filteredChildren:e.children;if(r)for(let o=0;o<r.length;o++)i+=1,i+=Pv(Array.isArray(n)?n.concat([o]):[n,o],r[o].hierarchyState,r[o]);return i}const pD=typeof window>"u"||window.window===void 0;let Cy,_y;const mD={get find(){return Cy||(Cy=Array.prototype.find?(n,t)=>Array.prototype.find.call(n,t):(n,t)=>{const e=mD.findIndex(n,t);return e>=0?n[e]:void 0},Cy)},get findIndex(){return _y||(_y=Array.prototype.findIndex?(n,t)=>Array.prototype.findIndex.call(n,t):(n,t)=>{const{length:e}=n;for(let i=0;i<e;i++)if(t(n[i],i,n))return i;return-1},_y)}};function Lrt(){if(pD)return{IE:!1,Edge:!1,Chrome:!1,Firefox:!1,Safari:!1};const n=window.navigator.userAgent.toLowerCase();return{IE:!!/(msie|trident)/.exec(n),Edge:n.indexOf("edge")>-1,Chrome:n.indexOf("chrome")>-1&&n.indexOf("edge")===-1,Firefox:n.indexOf("firefox")>-1,Safari:n.indexOf("safari")>-1&&n.indexOf("edge")===-1}}const{IE:Ort,Chrome:Lpt,Firefox:Opt,Edge:Ipt,Safari:Hpt}=Lrt();function Irt(n){return n===Object(n)}function vg(...n){const t={};return n.forEach((e=>{for(const i in e)Object.defineProperty(t,i,{get:()=>e[i],set(r){e[i]=r},configurable:!0,enumerable:!0})})),t}function vD(n,t,...e){let i=n;for(let r=0;r<e.length&&i!=null;r++)i=t(i,e[r]);return i}function vf(n,...t){return vD(n,((e,i)=>e[i]),...t)}function fe(n,...t){return typeof n=="function"?n(...t):n}function Hrt(n,t,e){const i=kv(n);(typeof e!="number"||!isFinite(e)||Math.floor(e)!==e||e>i.length)&&(e=i.length),e-=t.length;const r=i.lastIndexOf(t,e);return r!==-1&&r===e}function fo(n){return!!(n&&typeof n.then=="function")}function N0(n,t){fo(n)?n.then((e=>{t(e)})).catch((e=>{})):t(n)}function Drt(n){return!!n.changedTouches}function Frt(n,t){if(n[t])return n[t];const e=t.toLowerCase();if(n[e])return n[e];const i=t.toLowerCase();if(n[i])return n[i];for(const r in n)if(r.toLowerCase()===e)return n[r]}function Ur(n){return Array.isArray(n)?n.length===3?[n[0],n[1],n[2],n[1]]:n.length===2?[n[0],n[1],n[0],n[1]]:n.length===1?[n[0],n[0],n[0],n[0]]:[n[0],n[1],n[2],n[3]]:[n,n,n,n]}function Ir(n,t,e){return n.start.col<=t&&t<=n.end.col&&n.start.row<=e&&e<=n.end.row||n.end.col<=t&&t<=n.start.col&&n.end.row<=e&&e<=n.start.row||n.end.col<=t&&t<=n.start.col&&n.start.row<=e&&e<=n.end.row||n.start.col<=t&&t<=n.end.col&&n.end.row<=e&&e<=n.start.row}function zrt(n,t,e){for(let i=0;i<n.length;i++){const r=n[i],o=Math.min(r.start.col,r.end.col),s=Math.max(r.start.col,r.end.col),a=Math.min(r.start.row,r.end.row),l=Math.max(r.start.row,r.end.row);if(o<=t&&t<=s&&a<=e&&e<=l||s<=t&&t<=o&&l<=e&&e<=a)return!0}return!1}function EB(n){return{start:{col:Math.min(n.start.col,n.end.col),row:Math.min(n.start.row,n.end.row)},end:{col:Math.max(n.start.col,n.end.col),row:Math.max(n.start.row,n.end.row)}}}function Nrt(n,t){const e=EB(n),i=EB(t);return Math.max(e.start.col,i.start.col)<=Math.min(e.end.col,i.end.col)&&Math.max(e.start.row,i.start.row)<=Math.min(e.end.row,i.end.row)}const Wrt={IE:Ort},bD={isObject:Irt},bf={endsWith:Hrt},jrt={isTouchEvent:Drt},Vrt={toBoxArray:Ur},Grt=Function.prototype,tt={CLICK_CELL:"click_cell",DBLCLICK_CELL:"dblclick_cell",MOUSEDOWN_CELL:"mousedown_cell",MOUSEUP_CELL:"mouseup_cell",SELECTED_CELL:"selected_cell",SELECTED_CLEAR:"selected_clear",BEFORE_KEYDOWN:"before_keydown",KEYDOWN:"keydown",MOUSEENTER_TABLE:"mouseenter_table",MOUSELEAVE_TABLE:"mouseleave_table",MOUSEDOWN_TABLE:"mousedown_table",MOUSEMOVE_TABLE:"mousemove_table",MOUSEMOVE_CELL:"mousemove_cell",MOUSEENTER_CELL:"mouseenter_cell",MOUSELEAVE_CELL:"mouseleave_cell",CONTEXTMENU_CELL:"contextmenu_cell",CONTEXTMENU_CANVAS:"contextmenu_canvas",RESIZE_COLUMN:"resize_column",RESIZE_COLUMN_END:"resize_column_end",RESIZE_ROW:"resize_row",RESIZE_ROW_END:"resize_row_end",CHANGE_HEADER_POSITION_START:"change_header_position_start",CHANGE_HEADER_POSITION:"change_header_position",CHANGING_HEADER_POSITION:"changing_header_position",CHANGE_HEADER_POSITION_FAIL:"change_header_position_fail",SORT_CLICK:"sort_click",AFTER_SORT:"after_sort",FREEZE_CLICK:"freeze_click",SCROLL:"scroll",CAN_SCROLL:"can_scroll",SCROLL_HORIZONTAL_END:"scroll_horizontal_end",SCROLL_VERTICAL_END:"scroll_vertical_end",DROPDOWN_MENU_CLICK:"dropdown_menu_click",MOUSEOVER_CHART_SYMBOL:"mouseover_chart_symbol",DRAG_SELECT_END:"drag_select_end",SELECTED_CHANGED:"selected_changed",COPY_DATA:"copy_data",DROPDOWN_ICON_CLICK:"dropdown_icon_click",DROPDOWN_MENU_CLEAR:"dropdown_menu_clear",TREE_HIERARCHY_STATE_CHANGE:"tree_hierarchy_state_change",SHOW_MENU:"show_menu",HIDE_MENU:"hide_menu",ICON_CLICK:"icon_click",LEGEND_ITEM_CLICK:"legend_item_click",LEGEND_ITEM_HOVER:"legend_item_hover",LEGEND_ITEM_UNHOVER:"legend_item_unHover",LEGEND_CHANGE:"legend_change",MOUSEENTER_AXIS:"mouseenter_axis",MOUSELEAVE_AXIS:"mouseleave_axis",CHECKBOX_STATE_CHANGE:"checkbox_state_change",RADIO_STATE_CHANGE:"radio_state_change",SWITCH_STATE_CHANGE:"switch_state_change",BEFORE_SET_SIZE:"before_set_size",BEFORE_INIT:"before_init",BEFORE_UPDATE_OPTION:"before_update_option",AFTER_RENDER:"after_render",INITIALIZED:"initialized",UPDATED:"updated",CHANGE_CELL_VALUE:"change_cell_value",DRAG_FILL_HANDLE_END:"drag_fill_handle_end",MOUSEDOWN_FILL_HANDLE:"mousedown_fill_handle",DBLCLICK_FILL_HANDLE:"dblclick_fill_handle",EMPTY_TIP_CLICK:"empty_tip_click",EMPTY_TIP_DBLCLICK:"empty_tip_dblclick",BUTTON_CLICK:"button_click",BEFORE_CACHE_CHART_IMAGE:"before_cache_chart_image",PASTED_DATA:"pasted_data",PLUGIN_EVENT:"plugin_event"},$rt=n=>{switch(Object.prototype.toString.call(n)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}},Urt=(n,t)=>$rt(n)===t,Xrt=n=>Urt(n,"object");function yD(n,t,e){let i,r,o,s,a,l,h=0,u=!1,d=!1,c=!0;const g=!t&&t!==0&&typeof requestAnimationFrame=="function";if(typeof n!="function")throw new TypeError("Expected a function");function f(b){const y=i,C=r;return r=void 0,i=void 0,h=b,s=n.apply(C,y),s}function p(b,y){return g?requestAnimationFrame(b):setTimeout(b,y)}function m(b){const y=b-l;return l===void 0||y>=t||y<0||u&&b-h>=o}function v(){const b=Date.now();if(m(b))return(function(y){return a=void 0,c&&i?f(y):(r=void 0,i=void 0,s)})(b);a=p(v,(function(y){const C=y-h,w=t&&-(y-l);return u?Math.min(w,o-C):w})(b))}return t=+t||0,Xrt(e)&&(d=!!e.leading,u="maxWait"in e,u&&(o=Math.max(+e.maxWait||0,t)),c="trailing"in e?!!e.trailing:c),function(...b){const y=Date.now(),C=m(y);if(i=b,r=this,l=y,C){if(a===void 0)return(function(w){return h=w,a=p(v,t),d?f(w):s})(l);if(u)return a=p(v,t),f(l)}return a===void 0&&(a=p(v,t)),s}}let Yrt=1,qrt=class{constructor(t,e,i){var r;if(this.resizeTime=100,this.lastSize={width:0,height:0},this.mutationResize=()=>{this.onResize()},this.callBack=()=>{const o=this.getSize();let s=!1;o.width===this.lastSize.width&&o.height===this.lastSize.height&&(s=!0),this.lastSize=o,this.cb&&this.cb(Object.assign(Object.assign({},this.lastSize),{windowSizeNotChange:s}))},this.onResize=()=>{this.callBackDebounce()},this.element=t,this.cb=e,this.lastSize=this.getSize(),i&&(this.resizeTime=Math.max(i,16)),this.callBackDebounce=yD(this.callBack,this.resizeTime),window?.addEventListener("resize",this.onResize),"ResizeObserver"in window){const o=window.ResizeObserver;this.observer=new o(this.mutationResize),(r=this.observer)===null||r===void 0||r.observe(this.element)}else"MutationObserver"in window&&(this.observer=new MutationObserver(this.mutationResize),this.observer.observe(this.element,{attributes:!0,attributeFilter:["style"]}))}disConnect(){window.removeEventListener("resize",this.onResize),this.observer&&(this.observer.disconnect(),this.observer=void 0)}setSize(t){this.lastSize=t}checkSize(){const t=this.getSize();return t.width!==this.lastSize.width||t.height!==this.lastSize.height}getSize(){return this.element?{width:Math.floor(this.element.clientWidth),height:Math.floor(this.element.clientHeight)}:Object.assign({},this.lastSize)}},Ev=class{constructor(){this.listeners={},this.reseizeListeners={}}on(t,e,i,...r){if(te.mode==="node")return-1;const o=Yrt++;if(t?.addEventListener)if(e!=="resize"||t===window)t?.addEventListener(e,i,...r);else{const a=new qrt(t,i,this.resizeTime);this.reseizeListeners[o]=a}const s={target:t,type:e,listener:i,options:r};return this.listeners[o]=s,o}once(t,e,i,...r){if(te.mode==="node")return-1;const o=this.on(t,e,((...s)=>{this.off(o),i(...s)}),...r);return o}off(t){var e;if(te.mode==="node"||t===null)return;const i=(e=this.listeners)===null||e===void 0?void 0:e[t];i&&(delete this.listeners[t],i.target.removeEventListener&&i.target.removeEventListener(i.type,i.listener,...i.options))}fire(t,e,...i){if(te.mode!=="node")for(const r in this.listeners){const o=this.listeners[r];o.target===t&&o.type===e&&o.listener.call(o.target,...i)}}hasListener(t,e){if(te.mode==="node")return!1;let i=!1;for(const r in this.listeners){const o=this.listeners[r];o.target===t&&o.type===e&&(i=!0)}return i}clear(){if(te.mode!=="node"){for(const t in this.listeners){const e=this.listeners[t];e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options)}for(const t in this.reseizeListeners){const e=this.reseizeListeners[t];e?.disConnect()}this.listeners={}}}release(){te.mode!=="node"&&(this.clear(),this.listeners={})}};const Oa=(n,t)=>{let e=0,i=n.length-1;for(;e<=i;){const r=Math.floor((e+i)/2);if(n[r]===t)return r;n[r]>t?i=r-1:e=r+1}return i<0?0:i};class na{constructor(){this._keys=[],this._vals={},this._sorted=!1}count(){return this._keys.length}values(){return this._vals}valueArr(){return Object.values(this._vals)}adjustOrder(t,e,i){const{_keys:r}=this;if(this._sorted||(r.sort(((s,a)=>s<a?-1:s>a?1:0)),this._sorted=!0),t>e){const s=[];for(let a=Oa(r,t+i-1);a>=0;a--){const l=r[a];if(l>=t)s.push(this.get(l));else if(e<=l&&l<t)this.put(l+i,this.get(l));else if(l<e)break}for(let a=0;a<i;a++)this.put(e+a,s[i-1-a])}const{length:o}=r;if(t<e){const s=[];for(let a=Oa(r,t);a<o;a++){const l=r[a];if(l>=t&&l<t+i)s.push(this.get(l));else if(t+i<=l&&l<=e)this.put(l-i,this.get(l));else if(l>e)break}for(let a=0;a<i;a++)this.put(e+a,s[a])}}exchangeOrder(t,e,i,r,o){const{_keys:s}=this;if(this._sorted||(s.sort(((a,l)=>a<l?-1:a>l?1:0)),this._sorted=!0),t>i){const a=[],l=[];for(let h=Oa(s,i);h<Oa(s,t)+e;h++){const u=s[h];u>=t&&u<t+e?l.push(this.get(u)):a.push(this.get(u))}for(let h=0;h<e;h++)this.put(o+h,l[h]);for(let h=0;h<a.length;h++)this.put(o+e+h,a[h])}else{const a=[],l=[];for(let h=Oa(s,t);h<Oa(s,i)+r;h++){const u=s[h];u>=t&&u<t+e?l.push(this.get(u)):a.push(this.get(u))}for(let h=0;h<e;h++)this.put(o+h,l[h]);for(let h=0;h<a.length;h++)this.put(t+h,a[h])}}del(t){delete this._vals[t];const e=this._keys.indexOf(t);e!==-1&&this._keys.splice(e,1)}put(t,e){t in this._vals||(this._keys.push(t),this._sorted=!1),this._vals[t]=e}get(t){return this._vals[t]}has(t){return $(this._vals[t])}contain(t){return Object.values(this._vals).indexOf(t)>=0}each(t,e,i){const{_keys:r}=this,{length:o}=r;this._sorted||(r.sort(((s,a)=>s<a?-1:s>a?1:0)),this._sorted=!0);for(let s=Oa(r,t);s<o;s++){const a=r[s];if(t<=a&&a<=e){if(i(this.get(a),a)===!1)break}else if(e<a)return}}clear(){this._keys.length=0,this._vals={},this._sorted=!1}getLastIndex(){return this._keys[this._keys.length-1]}delLast(){const t=this.getLastIndex();this.del(t)}delAndReorder(t){if(!this.has(t))return;const e=this.getLastIndex();this.adjustOrder(t+1,t,e-t),this.delLast()}addAndReorder(t,e){if($(e)){const i=this.getLastIndex();this.adjustOrder(t,t+1,i-t),this.put(t,e)}}}class To{constructor(t,e,i,r){this.bounds=new Ca,this.bounds.set(t,e,t+i,e+r)}static bounds(t,e,i,r){return new To(t,e,Math.round(i-t),Math.round(r-e))}get left(){return this.bounds.x1}set left(t){this.bounds.x1=t}get top(){return this.bounds.y1}set top(t){this.bounds.y1=t}get right(){return this.bounds.x2}set right(t){this.bounds.x2=t}get bottom(){return this.bounds.y2}set bottom(t){this.bounds.y2=t}get width(){return this.bounds.width()}set width(t){this.bounds.x2=this.bounds.x1+t}get height(){return this.bounds.height()}set height(t){this.bounds.y2=this.bounds.y1+t}offsetLeft(t){this.bounds.translate(t,0)}offsetTop(t){this.bounds.translate(0,t)}copy(){return new To(this.left,this.top,this.width,this.height)}contains(t){return this.bounds.encloses(t.bounds)}inPoint(t,e){return this.bounds.contains(t,e)}}function Krt(n){const{row:t,table:e}=n;return 1&t-e.frozenRowCount?"#282a2e":"#2d3137"}const LB={name:"DARK",underlayBackgroundColor:"transparent",defaultStyle:{color:"#D3D5DA",bgColor:"#373b45",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#2F4774"}},headerStyle:{color:"#D3D5DA",bgColor:"#373b45",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#2F4774"}},rowHeaderStyle:{},cornerHeaderStyle:{},bodyStyle:{color:"#e5e7ea",bgColor:Krt,fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#29364D"}},frameStyle:{borderColor:"#d1d5da",borderLineWidth:1,borderLineDash:[],cornerRadius:10,shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(00, 24, 47, 0.06)"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:4,startColor:"rgba(00, 24, 47, 0.05)",endColor:"rgba(00, 24, 47, 0)",visible:"always"}},selectionStyle:{cellBgColor:"rgba(255, 255, 255, 0.1)",cellBorderColor:"#4284FF",cellBorderLineWidth:2},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"},functionalIconsStyle:{sort_color:"#FFFFFF",sort_color_opacity:"0.75",sort_color_2:"#416EFF",sort_color_opacity_2:"1",frozen_color:"#FFFFFF",frozen_color_opacity:"0.75",collapse_color:"#FFF",collapse_color_opacity:"0.75",expand_color:"#FFF",expand_color_opacity:"0.75",dragReorder_color:"#FFF",dragReorder_color_opacity:"0.75"}};function Zrt(n){const{row:t,table:e}=n;return 1&t-e.frozenRowCount?"#FFF":"#F4F8FF"}const OB={name:"BRIGHT",underlayBackgroundColor:"#FFF",defaultStyle:{color:"#FFF",bgColor:"#5389FF",borderColor:"#5286FA",hover:{cellBgColor:"#2E67E3"}},headerStyle:{color:"#FFF",bgColor:"#5389FF",borderColor:"#A1C1FF",hover:{cellBgColor:"#2E67E3"}},bodyStyle:{color:"#000",bgColor:Zrt,borderColor:"#E0EAFE",hover:{cellBgColor:"#E9EFFD"}},frameStyle:{borderColor:"#E1E4E8",borderLineWidth:1,borderLineDash:[],cornerRadius:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:3,startColor:"#CBDCFE",endColor:"#CBDCFE",visible:"always"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};function Jrt(n){const{row:t,table:e}=n;return 1&t-e.frozenRowCount?"#fbfbfc":"#FFF"}const IB={name:"ARCO",underlayBackgroundColor:"#FFF",defaultStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:600,lineHeight:14,borderColor:"#e1e4e8",padding:[8,12,8,12]},headerStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:600,lineHeight:14,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},rowHeaderStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},cornerHeaderStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},bodyStyle:{padding:[8,12,8,12],color:"#141414",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:400,textAlign:"left",bgColor:Jrt,borderColor:"#e1e4e8",lineHeight:14,hover:{cellBgColor:"#F7F8FA",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},frameStyle:{borderColor:"#d1d5da",borderLineWidth:1,borderLineDash:[],cornerRadius:4,shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(00, 24, 47, 0.06)"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:4,startColor:"rgba(00, 24, 47, 0.05)",endColor:"rgba(00, 24, 47, 0)",visible:"always"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)",cellBorderLineWidth:2,cellBorderColor:"#3073f2"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};function Qrt(n){const{row:t,table:e}=n;return 1&t-e.frozenRowCount?"#FDFDFD":"#FAF9FB"}const HB={name:"DEFAULT",underlayBackgroundColor:"#FFF",defaultStyle:{borderColor:"#E1E4E8",color:"#000",bgColor:"#ECF1F5"},headerStyle:{fontSize:16,fontWeight:"bold",bgColor:"#ECF1F5",hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},rowHeaderStyle:{fontSize:16,fontWeight:"bold",bgColor:"#ECF1F5",hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},cornerHeaderStyle:{fontSize:16,fontWeight:"bold"},bodyStyle:{fontSize:14,bgColor:Qrt,hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},frameStyle:{borderColor:"#E1E4E8",borderLineWidth:1,borderLineDash:[],cornerRadius:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:3,startColor:"rgba(225, 228, 232, 0.6)",endColor:"rgba(225, 228, 232, 0.6)",visible:"always"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)",cellBorderLineWidth:2,cellBorderColor:"#0000ff"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};function tot(n){const{row:t,table:{frozenRowCount:e}}=n;return e-1===t?["#f2f2f2","#f2f2f2","#ccc7c7","#f2f2f2"]:["#f2f2f2"]}function eot(n){const{col:t,table:e}=n,{colCount:i,frozenColCount:r}=e,o="#ccc7c7";return r-1===t||i-1===t?[o,"#f2f2f2","#ccc7c7",null]:[o,null,"#ccc7c7",null]}const DB={name:"SIMPLIFY",underlayBackgroundColor:"#FFF",defaultStyle:{borderColor:eot,hover:{cellBorderColor:"#0000FF",cellBgColor:"#D0E0E3"},bgColor:"#FFF"},headerStyle:{color:"rgba(0, 0, 0, 0.87)",borderColor:tot},bodyStyle:{color:"rgba(0, 0, 0, 0.87)"},frameStyle:{borderColor:"#f2f2f2",borderLineWidth:1},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF"},selectionStyle:{cellBorderColor:"#FD5",cellBgColor:"rgba(111, 168, 220, 0.1)"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}},iot={},FB=16,zB="Arial,sans-serif",not="#FFF",rot="#000",oot=1,sot=[],aot="#000",qx=/^(https?|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/,yf="$$indicator$$",lot='<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><rect x="0" y="0" width="1024" height="1024" rx="20%" ry="20%" fill="#ffffff" /><path  d="M810.666667 85.333333c70.688 0 128 57.312 128 128v597.333334c0 70.688-57.312 128-128 128H213.333333c-70.688 0-128-57.312-128-128V213.333333c0-70.688 57.312-128 128-128h597.333334z m0 85.333334H213.333333a42.666667 42.666667 0 0 0-42.613333 40.533333L170.666667 213.333333v597.333334a42.666667 42.666667 0 0 0 40.533333 42.613333L213.333333 853.333333h597.333334a42.666667 42.666667 0 0 0 42.613333-40.533333L853.333333 810.666667V213.333333a42.666667 42.666667 0 0 0-40.533333-42.613333L810.666667 170.666667zM549.333333 288a5.333333 5.333333 0 0 1 5.333334 5.333333V469.333333h176a5.333333 5.333333 0 0 1 5.333333 5.333334v74.666666a5.333333 5.333333 0 0 1-5.333333 5.333334H554.666667v176a5.333333 5.333333 0 0 1-5.333334 5.333333h-74.666666a5.333333 5.333333 0 0 1-5.333334-5.333333V554.666667H293.333333a5.333333 5.333333 0 0 1-5.333333-5.333334v-74.666666a5.333333 5.333333 0 0 1 5.333333-5.333334H469.333333V293.333333a5.333333 5.333333 0 0 1 5.333334-5.333333h74.666666z"></path></svg>',hot='<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><rect x="0" y="0" width="1024" height="1024" rx="20%" ry="20%" fill="#ffffff" /><path d="M810.666667 85.333333c70.688 0 128 57.312 128 128v597.333334c0 70.688-57.312 128-128 128H213.333333c-70.688 0-128-57.312-128-128V213.333333c0-70.688 57.312-128 128-128h597.333334z m0 85.333334H213.333333a42.666667 42.666667 0 0 0-42.613333 40.533333L170.666667 213.333333v597.333334a42.666667 42.666667 0 0 0 40.533333 42.613333L213.333333 853.333333h597.333334a42.666667 42.666667 0 0 0 42.613333-40.533333L853.333333 810.666667V213.333333a42.666667 42.666667 0 0 0-40.533333-42.613333L810.666667 170.666667zM693.333333 469.333333a42.666667 42.666667 0 1 1 0 85.333334H330.666667a42.666667 42.666667 0 1 1 0-85.333334h362.666666z"></path></svg>',uot={type:"line"};function dot(n){return{defaultAxisStyle:ad(n.defaultAxisStyle),leftAxisStyle:ad(n.leftAxisStyle),rightAxisStyle:ad(n.rightAxisStyle),topAxisStyle:ad(n.topAxisStyle),bottomAxisStyle:ad(n.bottomAxisStyle)}}function ad(n){return n||{}}const cot={visible:!0,position:"auto",padding:8,titleStyle:{fontSize:12,fontWeight:"bold",fill:"#4E5969"},contentStyle:{fontSize:12,fill:"#4E5969"},panel:{visible:!0,fill:"#fff",stroke:"#ffffff",lineWidth:0,cornerRadius:3,shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:"rgba(0, 0, 0, 0.1)",size:0,space:12}};function rh(n,t,e,i){var r,o,s;return(s=(o=(r=vf(n,...e))!==null&&r!==void 0?r:vf(t,...e))!==null&&o!==void 0?o:i&&vf(n,...i))!==null&&s!==void 0?s:i&&vf(t,...i)}class rr{constructor(t,e){this._defaultStyle=null,this._header=null,this._cornerHeader=null,this._cornerRightTopCell=null,this._cornerLeftBottomCell=null,this._cornerRightBottomCell=null,this._rightFrozen=null,this._bottomFrozen=null,this._rowHeader=null,this._body=null,this._groupTitle=null,this._scroll=null,this._tooltip=null,this._frameStyle=null,this._columnResize=null,this._dragHeaderSplitLine=null,this._frozenColumnLine=null,this._selectionStyle=null,this._axisStyle=null,this._checkboxStyle=null,this._radioStyle=null,this._switchStyle=null,this._buttonStyle=null,this._textPopTipStyle=null,this._internalIconsStyle=null,this.isPivot=!1,this.name="",this.internalTheme={obj:t,superTheme:e},this.name=rh(t,e,["name"])}getExtendTheme(){return this.internalTheme.obj}clearBodyStyleCache(){this._body=null}get font(){const{obj:t,superTheme:e}=this.internalTheme;return rh(t,e,["font"],["bodyStyle","font"])}get underlayBackgroundColor(){const{obj:t,superTheme:e}=this.internalTheme;return rh(t,e,["underlayBackgroundColor"])}get cellInnerBorder(){var t;const{obj:e,superTheme:i}=this.internalTheme;return(t=rh(e,i,["cellInnerBorder"]))===null||t===void 0||t}get cellBorderClipDirection(){var t;const{obj:e,superTheme:i}=this.internalTheme;return(t=rh(e,i,["cellBorderClipDirection"]))!==null&&t!==void 0?t:"top-left"}get _contentOffset(){var t;const{obj:e,superTheme:i}=this.internalTheme;return(t=rh(e,i,["_contentOffset"]))!==null&&t!==void 0?t:0}get defaultStyle(){const t=this;if(!this._defaultStyle){const{obj:e,superTheme:i}=this.internalTheme,r=ke({},i.defaultStyle,e.defaultStyle);this._defaultStyle={get fontSize(){var o;return(o=r.fontSize)!==null&&o!==void 0?o:FB},get fontFamily(){var o;return(o=r.fontFamily)!==null&&o!==void 0?o:zB},get fontWeight(){return r.fontWeight},get fontVariant(){return r.fontVariant},get fontStyle(){return r.fontStyle},get bgColor(){var o;return(o=r.bgColor)!==null&&o!==void 0?o:not},get color(){var o;return(o=r.color)!==null&&o!==void 0?o:aot},get borderColor(){var o;return(o=r.borderColor)!==null&&o!==void 0?o:rot},get borderLineWidth(){var o;return(o=r.borderLineWidth)!==null&&o!==void 0?o:oot},get borderLineDash(){var o;return(o=r.borderLineDash)!==null&&o!==void 0?o:sot},get hover(){if(r.hover)return{get cellBgColor(){var o,s;return(s=(o=r.hover)===null||o===void 0?void 0:o.cellBgColor)!==null&&s!==void 0?s:void 0},get inlineColumnBgColor(){var o,s,a,l,h,u;return(u=(s=(o=r.hover)===null||o===void 0?void 0:o.inlineColumnBgColor)!==null&&s!==void 0?s:!((a=r.hover)===null||a===void 0)&&a.cellBgColor&&typeof((l=r.hover)===null||l===void 0?void 0:l.cellBgColor)=="string"?Fs((h=r.hover)===null||h===void 0?void 0:h.cellBgColor,.1):void 0)!==null&&u!==void 0?u:void 0},get inlineRowBgColor(){var o,s,a,l,h,u;return(u=(s=(o=r.hover)===null||o===void 0?void 0:o.inlineRowBgColor)!==null&&s!==void 0?s:!((a=r.hover)===null||a===void 0)&&a.cellBgColor&&typeof((l=r.hover)===null||l===void 0?void 0:l.cellBgColor)=="string"?Fs((h=r.hover)===null||h===void 0?void 0:h.cellBgColor,.1):void 0)!==null&&u!==void 0?u:void 0}}},get select(){if(r.select)return{get inlineColumnBgColor(){var o,s,a,l,h,u;return(u=(l=(s=(o=r.select)===null||o===void 0?void 0:o.inlineColumnBgColor)!==null&&s!==void 0?s:(a=t.selectionStyle)===null||a===void 0?void 0:a.inlineColumnBgColor)!==null&&l!==void 0?l:!((h=t.selectionStyle)===null||h===void 0)&&h.cellBgColor&&typeof t.selectionStyle.cellBgColor=="string"?Fs(t.selectionStyle.cellBgColor,.1):void 0)!==null&&u!==void 0?u:void 0},get inlineRowBgColor(){var o,s,a,l,h;return(h=(a=(s=(o=r.select)===null||o===void 0?void 0:o.inlineRowBgColor)!==null&&s!==void 0?s:t.selectionStyle.inlineRowBgColor)!==null&&a!==void 0?a:!((l=t.selectionStyle)===null||l===void 0)&&l.cellBgColor&&typeof t.selectionStyle.cellBgColor=="string"?Fs(t.selectionStyle.cellBgColor,.1):void 0)!==null&&h!==void 0?h:void 0}}},get padding(){var o;return(o=r.padding)!==null&&o!==void 0?o:[10,16,10,16]},get textAlign(){var o;return(o=r.textAlign)!==null&&o!==void 0?o:"left"},get textBaseline(){var o;return(o=r.textBaseline)!==null&&o!==void 0?o:"middle"},get textOverflow(){var o;return(o=r.textOverflow)!==null&&o!==void 0?o:"ellipsis"},get lineHeight(){return r.lineHeight},get autoWrapText(){var o;return(o=r.autoWrapText)!==null&&o!==void 0&&o},get lineClamp(){var o;return(o=r.lineClamp)!==null&&o!==void 0?o:"auto"},get linkColor(){var o;return(o=r.linkColor)!==null&&o!==void 0?o:"#3772ff"},get cursor(){var o;return(o=r.cursor)!==null&&o!==void 0?o:"auto"},get marked(){var o;return(o=r.marked)!==null&&o!==void 0&&o},get underline(){var o;return(o=r.underline)!==null&&o!==void 0&&o},get underlineColor(){return r.underlineColor},get underlineDash(){return r.underlineDash},get underlineOffset(){return r.underlineOffset},get lineThrough(){var o;return(o=r.lineThrough)!==null&&o!==void 0&&o},get lineThroughColor(){return r.lineThroughColor},get lineThroughDash(){return r.lineThroughDash}}}return this._defaultStyle}get cornerHeaderStyle(){if(!this._cornerHeader){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},this.defaultStyle,e.cornerHeaderStyle,t.cornerHeaderStyle);this._cornerHeader=this.getStyle(i)}return this._cornerHeader}get cornerRightTopCellStyle(){if(!this._cornerRightTopCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerRightTopCellStyle&&!t.cornerRightTopCellStyle)return this._cornerRightTopCell;const i=ke({},this.defaultStyle,e.cornerRightTopCellStyle,t.cornerRightTopCellStyle);this._cornerRightTopCell=this.getStyle(i)}return this._cornerRightTopCell}get cornerLeftBottomCellStyle(){if(!this._cornerLeftBottomCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerLeftBottomCellStyle&&!t.cornerLeftBottomCellStyle)return this._cornerLeftBottomCell;const i=ke({},this.defaultStyle,e.cornerLeftBottomCellStyle,t.cornerLeftBottomCellStyle);this._cornerLeftBottomCell=this.getStyle(i)}return this._cornerLeftBottomCell}get cornerRightBottomCellStyle(){if(!this._cornerRightBottomCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerRightBottomCellStyle&&!t.cornerRightBottomCellStyle)return this._cornerRightBottomCell;const i=ke({},this.defaultStyle,e.cornerRightBottomCellStyle,t.cornerRightBottomCellStyle);this._cornerRightBottomCell=this.getStyle(i)}return this._cornerRightBottomCell}get rightFrozenStyle(){if(!this._rightFrozen){const{obj:t,superTheme:e}=this.internalTheme;if(!e.rightFrozenStyle&&!t.rightFrozenStyle)return this._rightFrozen;const i=ke({},this.defaultStyle,this.rowHeaderStyle,e.rightFrozenStyle,t.rightFrozenStyle);this._rightFrozen=this.getStyle(i)}return this._rightFrozen}get bottomFrozenStyle(){if(!this._bottomFrozen){const{obj:t,superTheme:e}=this.internalTheme;if(!e.bottomFrozenStyle&&!t.bottomFrozenStyle)return this._bottomFrozen;const i=ke({},this.defaultStyle,this.headerStyle,e.bottomFrozenStyle,t.bottomFrozenStyle);this._bottomFrozen=this.getStyle(i)}return this._bottomFrozen}get rowHeaderStyle(){var t;if(!this._rowHeader){const{obj:e,superTheme:i}=this.internalTheme,r=ke({},this.defaultStyle,i.rowHeaderStyle,(t=e.rowHeaderStyle)!==null&&t!==void 0?t:this.isPivot?null:e.headerStyle);this._rowHeader=this.getStyle(r)}return this._rowHeader}get headerStyle(){if(!this._header){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},this.defaultStyle,e.headerStyle,t.headerStyle);this._header=this.getStyle(i)}return this._header}get bodyStyle(){if(!this._body){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},this.defaultStyle,e.bodyStyle,t.bodyStyle);this._body=this.getStyle(i)}return this._body}get groupTitleStyle(){if(!this._groupTitle){const{obj:t,superTheme:e}=this.internalTheme;if(!e.groupTitleStyle&&!t.groupTitleStyle)return this._groupTitle;const i=ke({},this.defaultStyle,e.groupTitleStyle,t.groupTitleStyle);this._groupTitle=this.getStyle(i)}return this._groupTitle}get frameStyle(){if(!this._frameStyle){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},e.frameStyle,t.frameStyle);this._frameStyle={get borderColor(){return i.borderColor},get borderLineWidth(){return i.borderLineWidth},get borderLineDash(){return i.borderLineDash},get innerBorder(){return i.innerBorder},get shadowBlur(){return i.shadowBlur},get shadowColor(){return i.shadowColor},get shadowOffsetX(){return i.shadowOffsetX},get shadowOffsetY(){return i.shadowOffsetY},get cornerRadius(){return i.cornerRadius}}}return this._frameStyle}get scrollStyle(){if(!this._scroll){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},e.scrollStyle,t.scrollStyle);this._scroll={get scrollSliderColor(){var r;return(r=i.scrollSliderColor)!==null&&r!==void 0?r:"#C0C0C0"},get scrollSliderCornerRadius(){return i.scrollSliderCornerRadius},get scrollRailColor(){return i.scrollRailColor},get visible(){var r;return(r=i.visible)!==null&&r!==void 0?r:"scrolling"},get verticalVisible(){return i.verticalVisible},get horizontalVisible(){return i.horizontalVisible},get width(){var r;return(r=i.width)!==null&&r!==void 0?r:7},get hoverOn(){var r;return(r=i.hoverOn)===null||r===void 0||r},get barToSide(){var r;return(r=i.barToSide)!==null&&r!==void 0&&r},get horizontalPadding(){var r;return(r=i.horizontalPadding)!==null&&r!==void 0?r:0},get verticalPadding(){var r;return(r=i.verticalPadding)!==null&&r!==void 0?r:0},get ignoreFrozenCols(){var r;return(r=i.ignoreFrozenCols)!==null&&r!==void 0&&r}}}return this._scroll}get tooltipStyle(){if(!this._tooltip){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},e.tooltipStyle,t.tooltipStyle);this._tooltip={get fontFamily(){var r;return(r=i.fontFamily)!==null&&r!==void 0?r:zB},get fontSize(){var r;return(r=i.fontSize)!==null&&r!==void 0?r:FB},get bgColor(){var r;return(r=i.bgColor)!==null&&r!==void 0?r:"#000"},get padding(){var r;return(r=i.padding)!==null&&r!==void 0?r:[6,8]},get color(){var r;return(r=i.color)!==null&&r!==void 0?r:"#FFF"},get maxWidth(){return i.maxWidth},get maxHeight(){return i.maxHeight}}}return this._tooltip}get columnResize(){if(!this._columnResize){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},e.columnResize,t.columnResize);this._columnResize={get lineColor(){var r;return(r=i.lineColor)!==null&&r!==void 0?r:"#416EFF"},get bgColor(){var r;return(r=i.bgColor)!==null&&r!==void 0?r:"#D9E2FF"},get lineWidth(){var r;return(r=i.lineWidth)!==null&&r!==void 0?r:1},get width(){var r;return(r=i.width)!==null&&r!==void 0?r:i.lineWidth+2},get resizeHotSpotSize(){var r;return(r=i.resizeHotSpotSize)!==null&&r!==void 0?r:16},get labelColor(){var r;return(r=i.labelColor)!==null&&r!==void 0?r:"#FFF"},get labelFontSize(){var r;return(r=i.labelFontSize)!==null&&r!==void 0?r:10},get labelFontFamily(){var r;return(r=i.labelFontFamily)!==null&&r!==void 0?r:"sans-serif"},get labelBackgroundFill(){var r;return(r=i.labelBackgroundFill)!==null&&r!==void 0?r:"#3073F2"},get labelBackgroundCornerRadius(){var r;return(r=i.labelBackgroundCornerRadius)!==null&&r!==void 0?r:5},get labelVisible(){var r;return(r=i.labelVisible)===null||r===void 0||r},get visibleOnHover(){var r;return(r=i.visibleOnHover)!==null&&r!==void 0&&r}}}return this._columnResize}get dragHeaderSplitLine(){if(!this._dragHeaderSplitLine){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},e.dragHeaderSplitLine,t.dragHeaderSplitLine);this._dragHeaderSplitLine={get lineColor(){var r;return(r=i.lineColor)!==null&&r!==void 0?r:"blue"},get lineWidth(){var r;return(r=i.lineWidth)!==null&&r!==void 0?r:2},get shadowBlockColor(){var r;return(r=i.shadowBlockColor)!==null&&r!==void 0?r:"rgba(204,204,204,0.3)"}}}return this._dragHeaderSplitLine}get frozenColumnLine(){if(!this._frozenColumnLine){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},e.frozenColumnLine,t.frozenColumnLine);this._frozenColumnLine={get shadow(){if(i.shadow)return{get width(){var r,o;return(o=(r=i.shadow)===null||r===void 0?void 0:r.width)!==null&&o!==void 0?o:24},get startColor(){var r,o;return(o=(r=i.shadow)===null||r===void 0?void 0:r.startColor)!==null&&o!==void 0?o:"rgba(00, 24, 47, 0.06)"},get endColor(){var r,o;return(o=(r=i.shadow)===null||r===void 0?void 0:r.endColor)!==null&&o!==void 0?o:"rgba(00, 24, 47, 0)"},get visible(){var r,o;return(o=(r=i.shadow)===null||r===void 0?void 0:r.visible)!==null&&o!==void 0?o:"always"}}},get border(){if(i.border)return{get lineColor(){var r,o;return(o=(r=i.border)===null||r===void 0?void 0:r.lineColor)!==null&&o!==void 0?o:"rgba(00, 24, 47, 0.06)"},get bgColor(){var r,o,s,a;return(a=(o=(r=i.border)===null||r===void 0?void 0:r.bgColor)!==null&&o!==void 0?o:(s=i.border)===null||s===void 0?void 0:s.lineColor)!==null&&a!==void 0?a:"rgba(00, 24, 47, 0.06)"},get lineWidth(){var r,o;return(o=(r=i.border)===null||r===void 0?void 0:r.lineWidth)!==null&&o!==void 0?o:4},get width(){var r,o,s,a;return(a=(o=(r=i.border)===null||r===void 0?void 0:r.width)!==null&&o!==void 0?o:(s=i.border)===null||s===void 0?void 0:s.lineWidth)!==null&&a!==void 0?a:4}}}}}return this._frozenColumnLine}get selectionStyle(){if(!this._selectionStyle){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},e.selectionStyle,t.selectionStyle);this._selectionStyle={get cellBgColor(){var r;return(r=i?.cellBgColor)!==null&&r!==void 0?r:"rgba(0, 0, 255,0.1)"},get cellBorderColor(){var r;return(r=i?.cellBorderColor)!==null&&r!==void 0?r:"#3073f2"},get cellBorderLineWidth(){var r;return(r=i?.cellBorderLineWidth)!==null&&r!==void 0?r:2},get inlineColumnBgColor(){return i?.inlineColumnBgColor},get inlineRowBgColor(){return i?.inlineRowBgColor},get selectionFillMode(){var r;return(r=i?.selectionFillMode)!==null&&r!==void 0?r:"overlay"},get dynamicUpdateSelectionSize(){var r;return(r=i?.dynamicUpdateSelectionSize)!==null&&r!==void 0&&r}}}return this._selectionStyle}get axisStyle(){if(!this._axisStyle){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},e.axisStyle,t.axisStyle);this._axisStyle=dot(i)}return this._axisStyle}get checkboxStyle(){if(!this._checkboxStyle){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},e.checkboxStyle,t.checkboxStyle);this._checkboxStyle=i}return this._checkboxStyle}get radioStyle(){if(!this._radioStyle){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},e.radioStyle,t.radioStyle);this._radioStyle=i}return this._radioStyle}get switchStyle(){if(!this._switchStyle){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},e.switchStyle,t.switchStyle);this._switchStyle=i}return this._switchStyle}get buttonStyle(){if(!this._buttonStyle){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},e.buttonStyle,t.buttonStyle);this._buttonStyle=i}return this._buttonStyle}get textPopTipStyle(){if(!this._textPopTipStyle){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},cot,e.textPopTipStyle,t.textPopTipStyle);this._textPopTipStyle=i}return this._textPopTipStyle}get functionalIconsStyle(){if(!this._internalIconsStyle){const{obj:t,superTheme:e}=this.internalTheme,i=ke({},e.functionalIconsStyle,t.functionalIconsStyle);this._internalIconsStyle=i}return this._internalIconsStyle}hasProperty(t){const{obj:e,superTheme:i}=this.internalTheme;return NB(e,t)||NB(i,t)}extends(t){return new rr(ke({},t),ke({},this.internalTheme.superTheme,this.internalTheme.obj))}getStyle(t){const e=this;return{get fontSize(){return t.fontSize},get fontFamily(){return t.fontFamily},get fontWeight(){return t.fontWeight},get fontVariant(){return t.fontVariant},get fontStyle(){return t.fontStyle},get bgColor(){return t.bgColor},get color(){return t.color},get strokeColor(){return t.strokeColor},get borderColor(){return t.borderColor},get borderLineWidth(){return t.borderLineWidth},get borderLineDash(){return t.borderLineDash},get hover(){if(t.hover)return{get cellBgColor(){var i,r;return(r=(i=t.hover)===null||i===void 0?void 0:i.cellBgColor)!==null&&r!==void 0?r:void 0},get inlineColumnBgColor(){var i,r,o,s,a,l;return(l=(r=(i=t.hover)===null||i===void 0?void 0:i.inlineColumnBgColor)!==null&&r!==void 0?r:!((o=t.hover)===null||o===void 0)&&o.cellBgColor&&typeof((s=t.hover)===null||s===void 0?void 0:s.cellBgColor)=="string"?Fs((a=t.hover)===null||a===void 0?void 0:a.cellBgColor,.1):void 0)!==null&&l!==void 0?l:void 0},get inlineRowBgColor(){var i,r,o,s,a,l;return(l=(r=(i=t.hover)===null||i===void 0?void 0:i.inlineRowBgColor)!==null&&r!==void 0?r:!((o=t.hover)===null||o===void 0)&&o.cellBgColor&&typeof((s=t.hover)===null||s===void 0?void 0:s.cellBgColor)=="string"?Fs((a=t.hover)===null||a===void 0?void 0:a.cellBgColor,.1):void 0)!==null&&l!==void 0?l:void 0}}},get select(){return{get inlineColumnBgColor(){var i,r,o,s,a,l;return(l=(s=(r=(i=t.select)===null||i===void 0?void 0:i.inlineColumnBgColor)!==null&&r!==void 0?r:(o=e.selectionStyle)===null||o===void 0?void 0:o.inlineColumnBgColor)!==null&&s!==void 0?s:!((a=e.selectionStyle)===null||a===void 0)&&a.cellBgColor&&typeof e.selectionStyle.cellBgColor=="string"?Fs(e.selectionStyle.cellBgColor,.1):void 0)!==null&&l!==void 0?l:void 0},get inlineRowBgColor(){var i,r,o,s,a;return(a=(o=(r=(i=t.select)===null||i===void 0?void 0:i.inlineRowBgColor)!==null&&r!==void 0?r:e.selectionStyle.inlineRowBgColor)!==null&&o!==void 0?o:!((s=e.selectionStyle)===null||s===void 0)&&s.cellBgColor&&typeof e.selectionStyle.cellBgColor=="string"?Fs(e.selectionStyle.cellBgColor,.1):void 0)!==null&&a!==void 0?a:void 0},get cellBgColor(){var i,r,o;if(e.selectionStyle.selectionFillMode==="replace")return(o=(r=(i=t.select)===null||i===void 0?void 0:i.cellBgColor)!==null&&r!==void 0?r:e.selectionStyle.cellBgColor)!==null&&o!==void 0?o:void 0}}},get frameStyle(){if(t.frameStyle)return{get borderColor(){var i,r;return(r=(i=t.frameStyle)===null||i===void 0?void 0:i.borderColor)!==null&&r!==void 0?r:void 0},get borderLineWidth(){var i,r;return(r=(i=t.frameStyle)===null||i===void 0?void 0:i.borderLineWidth)!==null&&r!==void 0?r:void 0},get borderLineDash(){var i,r;return(r=(i=t.frameStyle)===null||i===void 0?void 0:i.borderLineDash)!==null&&r!==void 0?r:void 0}}},get padding(){return t.padding},get textAlign(){return t.textAlign},get textBaseline(){return t.textBaseline},get textOverflow(){return t.textOverflow},get lineHeight(){return t.lineHeight},get autoWrapText(){return t.autoWrapText},get lineClamp(){return t.lineClamp},get linkColor(){return t.linkColor},get cursor(){return t.cursor},get textStick(){return t.textStick},get marked(){return t.marked},get underline(){var i;return(i=t.underline)!==null&&i!==void 0&&i},get underlineColor(){return t.underlineColor},get underlineDash(){return t.underlineDash},get underlineOffset(){return t.underlineOffset},get lineThrough(){var i;return(i=t.lineThrough)!==null&&i!==void 0&&i},get lineThroughColor(){return t.lineThroughColor},get lineThroughDash(){return t.lineThroughDash}}}}function NB(n,t){if(n instanceof rr)return n.hasProperty(t);let e=n;if(!e)return!1;for(let i=0;i<t.length;i++)if(e=e[t[i]],!e)return!1;return!!e}const CD=new rr(LB,LB),_D=new rr(OB,OB),wD=new rr(IB,IB),xh=new rr(HB,HB),xD=new rr(DB,DB),got={DEFAULT:xh,SIMPLIFY:xD,ARCO:wD,DARK:CD,BRIGHT:_D},fot={TableTheme:rr};function pot(n){if(!n)return null;if(typeof n=="string"){const t=Frt(SD(),n);return t?t instanceof rr?t:new rr(t,t):null}return n instanceof rr?n:new rr(n,n)}function SD(){return vg(got,iot)}const zs={DARK:CD,BRIGHT:_D,ARCO:wD,DEFAULT:xh,SIMPLIFY:xD,theme:fot,of:pot,get:SD};function mi(n,t,e){var i;if(n.internalProps.customMergeCell){const o=n.getCustomMerge(t,e);if(o)return o.range}if(!n.internalProps.enableTreeNodeMerge&&!n.isHeader(t,e)&&!(!((i=n.getBodyColumnDefine(t,e))===null||i===void 0)&&i.mergeCell))return!1;const r=n.getCellRange(t,e);return!(r.start.col===r.end.col&&r.start.row===r.end.row)&&r}class St{static registerComponent(t,e){St._components[t]=e}static getComponent(t){return St._components[t]}static registerFunction(t,e){St._functions[t]=e}static getFunction(t){return St._functions[t]}static registerCellType(t,e){St._cellTypes[t]=e}static getCellType(t){return St._cellTypes[t]}}St._components={},St._functions={},St._cellTypes={};function mot(n,t){const e=new Array(t);for(let i=0;i<t;i++)e[i]=n(i);return e}function vot(n,t,e,i,r,o){const s=mot(n,e);s.sort(((a,l)=>i(o(a),o(l),r)));for(let a=0;a<e;a++)t(a,s[a])}function bot(n){if(bD.isObject(n)){const t=n;if($(t.get)&&$(t.set))return!0}return!1}const Cf={SOURCE_LENGTH_UPDATE:"source_length_update",CHANGE_ORDER:"change_order"};function Zs(n,t){const e=fe(n);if(fo(e)){const i=e.then((r=>(t(r),r)));return t(i),i}return e}function W0(n,t,e,i,r,o){if(n==null)return;if(fo(n))return n.then((l=>W0(l,t,e,i,r,o)));const s=bot(t)?t.get:t;if((s===void 0||s==="")&&Array.isArray(n))return n[e-r.leftRowSeriesNumberCount];if(Pi(n)&&s in n)return Zs(n[s],o);if(typeof s=="function")return Zs(s(n,e,i,r),o);if(Array.isArray(s))return Zs(krt(n,[...s]),o);const a=`${s}`.split(".");return a.length<=1?Zs(n[s],o):Zs(vD(n,((l,h)=>W0(l,h,e,i,r,Grt)),...a),o)}function oh(n,t){if(!n)return t;const e=n[t];return $(e)?e:t}let Ss=class extends Rv{static get EVENT_TYPE(){return Cf}constructor(t,e,i,r,o,s){var a;super(),this.addRecordRule="Object",this.currentIndexedData=[],this.hierarchyExpandLevel=0,this.hasHierarchyStateExpand=!1,this.beforeChangedRecordsMap=new Map,this.registedAggregators={},this.rowHierarchyType="grid",this.fieldAggregators=[],this.addRecordRule=e?.addRecordRule||"Object",this.registerAggregators(),this.dataSourceObj=t,this.dataConfig=e,this._get=t?.get,this.columns=r,this._source=t?.records?this.processRecords(t?.records):t,this._sourceLength=((a=this._source)===null||a===void 0?void 0:a.length)||0,this.sortedIndexMap=new Map,this._currentPagerIndexedData=[],this.userPagination=i,this.pagination=i||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},s>=1&&(this.hierarchyExpandLevel=s),this.currentIndexedData=Array.from({length:this._sourceLength},((l,h)=>h)),o==="tree"&&this.initTreeHierarchyState(),this.rowHierarchyType=o,this.updatePagerData()}initTreeHierarchyState(){var t,e;this._sourceLength=((t=this._source)===null||t===void 0?void 0:t.length)||0,this.currentIndexedData=Array.from({length:this._sourceLength},((r,o)=>o));let i=this._sourceLength;for(let r=0;r<i;r++){const o=this.currentIndexedData[r],s=this.getOriginalRecord(o);if(!s)continue;const a=(e=s.filteredChildren)!==null&&e!==void 0?e:s.children;if(a?.length>0){if(this.hierarchyExpandLevel>1?!s.hierarchyState&&(s.hierarchyState=Tt.expand):!s.hierarchyState&&(s.hierarchyState=Tt.collapse),this.hasHierarchyStateExpand=!0,s.hierarchyState===Tt.collapse)continue;const l=this.initChildrenNodeHierarchy(o,this.hierarchyExpandLevel,2,s);r+=l,i+=l}else s.children===!0&&!s.hierarchyState&&(s.hierarchyState=Tt.collapse)}}supplementConfig(t,e,i,r){var o;this.columns=e,this._sourceLength=((o=this._source)===null||o===void 0?void 0:o.length)||0,this.sortedIndexMap=new Map,this._currentPagerIndexedData=[],this.userPagination=t,this.pagination=t||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},r>=1&&(this.hierarchyExpandLevel=r),this.currentIndexedData=Array.from({length:this._sourceLength},((s,a)=>a)),i==="tree"&&this.initTreeHierarchyState(),this.rowHierarchyType=i,this.updatePagerData()}registerAggregator(t,e){this.registedAggregators[t]=e}registerAggregators(){this.registerAggregator(Qe.RECORD,art),this.registerAggregator(Qe.SUM,urt),this.registerAggregator(Qe.COUNT,drt),this.registerAggregator(Qe.MAX,grt),this.registerAggregator(Qe.MIN,frt),this.registerAggregator(Qe.AVG,crt),this.registerAggregator(Qe.NONE,lrt),this.registerAggregator(Qe.CUSTOM,hrt)}updateColumns(t){this.columns=t}_generateFieldAggragations(){const t=this.columns;this.fieldAggregators=[];const e=r=>{delete r.vtable_aggregator;const o=r.field,s=r.aggregation;if(s)if(Array.isArray(s))for(const a of s){const l=new this.registedAggregators[a.aggregationType]({field:o,formatFun:a.formatFun,isRecord:!0,aggregationFun:a.aggregationFun});this.fieldAggregators.push(l),r.vtable_aggregator||(r.vtable_aggregator=[]),r.vtable_aggregator.push(l)}else{const a=new this.registedAggregators[s.aggregationType]({field:o,formatFun:s.formatFun,isRecord:!0,aggregationFun:s.aggregationFun});this.fieldAggregators.push(a),r.vtable_aggregator=a}},i=r=>{if(r&&r.length!==0)for(const o of r)e(o),o.columns&&i(o.columns)};i(t)}processRecords(t){var e,i,r,o,s,a,l,h;this._generateFieldAggragations();const u=[],d=this.fieldAggregators.length>=1;if(((i=(e=this.dataConfig)===null||e===void 0?void 0:e.filterRules)===null||i===void 0?void 0:i.length)>=1||((r=this.lastFilterRules)===null||r===void 0?void 0:r.length)>=1||d){for(let c=0,g=t.length;c<g;c++){const f=t[c];f!=null&&(((s=(o=this.dataConfig)===null||o===void 0?void 0:o.filterRules)===null||s===void 0?void 0:s.length)>=1?this.filterRecord(f)&&(u.push(f),this.rowHierarchyType==="tree"&&f.children&&(f.filteredChildren=this.filteredChildren(f.children)),d&&this.processRecord(f)):((a=this.lastFilterRules)===null||a===void 0?void 0:a.length)>=1?(this.clearFilteredChildren(f),d&&this.processRecord(f)):d&&this.processRecord(f))}if(((h=(l=this.dataConfig)===null||l===void 0?void 0:l.filterRules)===null||h===void 0?void 0:h.length)>=1)return u}return t}filteredChildren(t){const e=[];for(let i=0,r=t.length;i<r;i++){const o=t[i];this.filterRecord(o)&&(e.push(o),o.children&&(o.filteredChildren=this.filteredChildren(o.children)))}return e}processRecord(t){for(let e=0;e<this.fieldAggregators.length;e++)this.fieldAggregators[e].push(t)}initChildrenNodeHierarchy(t,e,i,r){var o,s,a;let l=0;const h=r.filteredChildren?r.filteredChildren.length:(s=(o=r.children)===null||o===void 0?void 0:o.length)!==null&&s!==void 0?s:0;for(let u=0;u<h;u++){(i<=e||r.hierarchyState===Tt.expand)&&(l+=1);const d=r.filteredChildren?r.filteredChildren[u]:r.children[u],c=Array.isArray(t)?t.concat(u):[t,u];(i<=e||r.hierarchyState===Tt.expand)&&this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+l,0,c),(d.filteredChildren?d.filteredChildren.length>0:((a=d.children)===null||a===void 0?void 0:a.length)>0)&&(i<e||d.hierarchyState===Tt.expand?(!d.hierarchyState&&(d.hierarchyState=Tt.expand),this.hasHierarchyStateExpand=!0):!d.hierarchyState&&(d.hierarchyState=Tt.collapse)),d.hierarchyState===Tt.expand&&(l+=this.initChildrenNodeHierarchy(c,e,i+1,d)),d.children===!0&&!d.hierarchyState&&(d.hierarchyState=Tt.collapse)}return l}updatePagination(t){this.pagination=t||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},this.updatePagerData()}updatePagerData(){const{currentIndexedData:t}=this,{perPageCount:e,currentPage:i}=this.pagination,r=e*(i||0),o=r+e;if(this._currentPagerIndexedData.length=0,t&&t.length>0){let s=-1;for(let a=0;a<t.length;a++)if((Array.isArray(t[a])&&t[a].length===1||!Array.isArray(t[a]))&&s++,s>=r&&s<o)this._currentPagerIndexedData.push(t[a]);else if(s>=o)break}else if(this._sourceLength>0)throw new Error("currentIndexedData should has values!")}getRecordIndexPaths(t){return this._currentPagerIndexedData[t]}get records(){return Array.isArray(this._source)?this._source:[]}get source(){return this._source}get(t){return this.getOriginalRecord(oh(this.currentPagerIndexedData,t))}getRaw(t){return this.getRawRecord(oh(this.currentPagerIndexedData,t))}getIndexKey(t){return oh(this.currentPagerIndexedData,t)}getTableIndex(t){return Array.isArray(t)?this.rowHierarchyType==="tree"?this.currentPagerIndexedData.findIndex((e=>Ent(e,t))):this.currentPagerIndexedData.findIndex((e=>e===t[0])):this.currentPagerIndexedData.findIndex((e=>e===t))}getField(t,e,i,r,o){return this.getOriginalField(oh(this.currentPagerIndexedData,t),e,i,r,o)}getRawField(t,e,i,r,o){return this.getRawFieldData(oh(this.currentPagerIndexedData,t),e,i,r,o)}hasField(t,e){return this.hasOriginalField(oh(this.currentPagerIndexedData,t),e)}getHierarchyState(t){var e;const i=this.getOriginalRecord(this.currentPagerIndexedData[t]);if(i?.hierarchyState){const r=i.hierarchyState;if(((e=i.children)===null||e===void 0?void 0:e.length)>0||i.children===!0)return r}return null}toggleHierarchyState(t,e,i){const r=this.currentIndexedData.slice(0),o=this.getIndexKey(t),s=this.getHierarchyState(t),a=this.getOriginalRecord(o);if(this.clearSortedIndexMap(),s===Tt.collapse)a.hierarchyState=Tt.expand,this.pushChildrenNode(o,Tt.expand,a),this.hasHierarchyStateExpand=!0;else if(s===Tt.expand){const u=Pv(o,s,a);this.currentIndexedData.splice(this.currentIndexedData.indexOf(o)+1,u),a.hierarchyState=Tt.collapse}this.updatePagerData();const l=[],h=[];if(s===Tt.collapse){const u=this.currentIndexedData.length-r.length;for(let d=0;d<u;d++)l.push(t+d+1)}else if(s===Tt.expand){const u=r.length-this.currentIndexedData.length;for(let d=0;d<u;d++)h.push(t+d+1)}return{add:l,remove:h}}pushChildrenNode(t,e,i){var r,o;if(!e||e===Tt.collapse||e===Tt.none)return 0;let s=0;const a=i.filteredChildren?i.filteredChildren:i.children;if(a){const l=Array.from({length:a.length},((h,u)=>u));(r=this.lastSortStates)===null||r===void 0||r.forEach((h=>{h.order!=="normal"&&vot((u=>$(l[u])?l[u]:l[u]=u),((u,d)=>{l[u]=d}),a.length,h.orderFn,h.order,(u=>this.getOriginalField(Array.isArray(t)?t.concat([u]):[t,u],h.field)))}));for(let h=0;h<l.length;h++){s+=1;const u=Array.isArray(t)?t.concat([l[h]]):[t,l[h]];this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+s,0,u);const d=this.getOriginalRecord(u);!d.hierarchyState&&((o=d.filteredChildren)!==null&&o!==void 0?o:d.children)&&(d.hierarchyState=Tt.collapse),s+=this.pushChildrenNode(u,d.hierarchyState,a[l[h]])}}return s}changeFieldValue(t,e,i,r,o,s){var a;if(i!==null&&e>=0){const l=this.getIndexKey(e);if(this.cacheBeforeChangedRecord(l,s),i!==void 0&&i!==""||(i=r-s.leftRowSeriesNumberCount),typeof i=="string"||typeof i=="number"){const h=(a=this.beforeChangedRecordsMap.get(l.toString()))===null||a===void 0?void 0:a[i],u=this.getOriginalRecord(l);let d=t;typeof h=="number"&&Prt(t)&&(d=parseFloat(t)),fo(u)?u.then((c=>{c[i]=d})).catch((c=>{})):u?u[i]=d:(this.records[l]=this.addRecordRule==="Array"?[]:{},this.records[l][i]=d)}}}cacheBeforeChangedRecord(t,e){var i;if(!this.beforeChangedRecordsMap.has(t.toString())){const r=this.getOriginalRecord(t);this.beforeChangedRecordsMap.set(t.toString(),(i=Ul(r,void 0,["vtable_gantt_linkedFrom","vtable_gantt_linkedTo"]))!==null&&i!==void 0?i:{})}}setRecord(t,e){var i,r;let o=!0;if(((r=(i=this.dataConfig)===null||i===void 0?void 0:i.filterRules)===null||r===void 0?void 0:r.length)>=1&&(this.filterRecord(t)?this.rowHierarchyType==="tree"&&t.children&&(t.filteredChildren=this.filteredChildren(t.children)):o=!1),o&&Array.isArray(this.records)){const s=this.getIndexKey(e);Array.isArray(s)||this.records.splice(s,1,t)}}addRecord(t,e){var i;if(Array.isArray(this.records)){this.records.splice(e,0,t),this.adjustBeforeChangedRecordsMap(e,1),this.currentIndexedData.push(this.currentIndexedData.length),this._sourceLength+=1;for(let r=0;r<this.fieldAggregators.length;r++)this.fieldAggregators[r].push(t);if(this.rowHierarchyType==="tree"&&this.initTreeHierarchyState(),this.userPagination){this.pagination.totalCount=this._sourceLength;const{perPageCount:r,currentPage:o}=this.pagination;e<r*(o||0)+r&&this.updatePagerData()}else this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.updatePagerData();!((i=this.dataSourceObj)===null||i===void 0)&&i.added&&this.dataSourceObj.added(e,1)}}addRecords(t,e){var i;if(Array.isArray(this.records)){if(Array.isArray(t)){this.records.splice(e,0,...t),this.adjustBeforeChangedRecordsMap(e,t.length);for(let r=0;r<t.length;r++)this.currentIndexedData.push(this.currentIndexedData.length);this._sourceLength+=t.length;for(let r=0;r<this.fieldAggregators.length;r++)for(let o=0;o<t.length;o++)this.fieldAggregators[r].push(t[o])}if(this.userPagination){this.pagination.totalCount=this._sourceLength;const{perPageCount:r,currentPage:o}=this.pagination;e<r*(o||0)+r&&this.updatePagerData()}else this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.updatePagerData();!((i=this.dataSourceObj)===null||i===void 0)&&i.added&&this.dataSourceObj.added(e,t.length)}}addRecordForSorted(t){Array.isArray(this.records)&&(this.beforeChangedRecordsMap.clear(),this.records.push(t),this.currentIndexedData.push(this.currentIndexedData.length),this._sourceLength+=1,this.sortedIndexMap.clear(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength))}addRecordsForSorted(t){if(Array.isArray(this.records)){if(this.beforeChangedRecordsMap.clear(),Array.isArray(t)){this.records.push(...t);for(let e=0;e<t.length;e++)this.currentIndexedData.push(this.currentIndexedData.length);this._sourceLength+=t.length,this.sortedIndexMap.clear()}this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}}adjustBeforeChangedRecordsMap(t,e,i="add"){for(let r=this.beforeChangedRecordsMap.size-1;r>=t;r--){const o=this.beforeChangedRecordsMap.get(r.toString());this.beforeChangedRecordsMap.delete(r.toString()),this.beforeChangedRecordsMap.set((r+(i==="add"?e:-e)).toString(),o)}}deleteRecords(t){var e;if(Array.isArray(this.records)){const i=[],r=t.sort(((o,s)=>s-o));for(let o=0;o<r.length;o++){const s=r[o];if(s>=this._sourceLength||s<0)continue;this.adjustBeforeChangedRecordsMap(s,1,"delete"),i.push(s);const a=this.records[s];for(let l=0;l<this.fieldAggregators.length;l++)this.fieldAggregators[l].deleteRecord(a);this.records.splice(s,1),this.currentIndexedData.pop(),this._sourceLength-=1}return this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength),this.updatePagerData(),!((e=this.dataSourceObj)===null||e===void 0)&&e.deleted&&this.dataSourceObj.deleted(i),i}return[]}deleteRecordsForSorted(t){if(Array.isArray(this.records)){const e=t.sort(((i,r)=>r-i));for(let i=0;i<e.length;i++){const r=e[i];if(r>=this._sourceLength||r<0)continue;const o=this.currentIndexedData[r];this.records.splice(o,1),this._sourceLength-=1}this.sortedIndexMap.clear(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength),this.beforeChangedRecordsMap.clear()}}updateRecords(t,e){const i=[];for(let r=0;r<e.length;r++){const o=e[r];if(Array.isArray(o))this.beforeChangedRecordsMap.delete(o.toString()),i.push(o),o.slice(0,-1).reduce(((s,a)=>(s[a]===void 0&&(s[a]={}),s[a].children)),this.records)[o[o.length-1]]=t[r];else{if(o>=this._sourceLength||o<0)continue;this.beforeChangedRecordsMap.delete(o.toString()),i.push(o);for(let s=0;s<this.fieldAggregators.length;s++)this.fieldAggregators[s].updateRecord(this.records[o],t[r]);this.records[o]=t[r]}}return this.userPagination&&this.updatePagerData(),i}updateRecordsForSorted(t,e){for(let i=0;i<e.length;i++){const r=e[i];if(r>=this._sourceLength||r<0)continue;const o=this.currentIndexedData[r];if(typeof o!="number")return;this.beforeChangedRecordsMap.delete(o.toString()),this.records[o]=t[i]}this.sortedIndexMap.clear()}sort(t){t=(Array.isArray(t)?t:[t]).filter((o=>{const s=this.columns.find((a=>a.field===o.field));return s?.sort!==!1&&o.order!=="normal"})),this.lastSortStates=t;let e=t.map((o=>this.sortedIndexMap.get(o?.field)||{asc:[],desc:[],normal:[]})),i=null;if(e.length>0&&(i=t.reduce(((o,s,a)=>{var l;const h=(l=e[a])===null||l===void 0?void 0:l[s.order];return h&&h.length>0?h:o}),null),i&&i.length>0))return this.currentIndexedData=i,this.updatePagerData(),void this.fireListeners(Cf.CHANGE_ORDER,null);const r=Array.from({length:this._sourceLength},((o,s)=>s));if(r.sort(((o,s)=>{const a=this.getOriginalRecord(o),l=this.getOriginalRecord(s),h=a==null||typeof a=="object"&&Object.keys(a).length===0,u=l==null||typeof l=="object"&&Object.keys(l).length===0;return t.reduce(((d,c)=>{if(d!==0)return d;if(c.order==="asc"||c.order==="desc"){if(h&&!u)return 1;if(!h&&u)return-1;if(h&&u)return o-s}else if(h||u)return o-s;return(c.orderFn||(c.order!=="desc"?(g,f)=>g===f?0:g>f?1:-1:(g,f)=>g===f?0:g<f?1:-1))(this.getOriginalField(o,c.field),this.getOriginalField(s,c.field),c.order)}),0)})),this.currentIndexedData=r,this.hierarchyExpandLevel){let o=r.length;for(let s=0;s<o;s++){const a=this.getOriginalRecord(r[s]),l=this.pushChildrenNode(r[s],a.hierarchyState,this.getOriginalRecord(r[s]));o+=l,s+=l}}if(!e.length){e=t.map((()=>({asc:[],desc:[],normal:[]})));for(let o=0;o<t.length;o++)this.sortedIndexMap.set(t[o].field,e[o])}t.forEach(((o,s)=>{e[s][o.order]=r.slice()})),this.updatePagerData(),this.fireListeners(Cf.CHANGE_ORDER,null)}setSortedIndexMap(t,e){this.sortedIndexMap.set(t,e)}clearFilteredChildren(t){var e,i;t.filteredChildren=void 0;for(let r=0;r<((i=(e=t.children)===null||e===void 0?void 0:e.length)!==null&&i!==void 0?i:0);r++)this.clearFilteredChildren(t.children[r])}filterRecord(t){var e,i,r;let o=!0;for(let s=0;s<((e=this.dataConfig.filterRules)===null||e===void 0?void 0:e.length);s++){const a=(i=this.dataConfig)===null||i===void 0?void 0:i.filterRules[s];if(a.filterKey){const l=t[a.filterKey];if(a.filteredValues.indexOf(l)===-1){o=!1;break}}else if(!(!((r=a.filterFunc)===null||r===void 0)&&r.call(a,t))){o=!1;break}}return o}updateFilterRulesForSorted(t){var e,i,r;this.lastFilterRules=this.dataConfig.filterRules,this.dataConfig.filterRules=t,this._source=this.processRecords((i=(e=this.dataSourceObj)===null||e===void 0?void 0:e.records)!==null&&i!==void 0?i:this.dataSourceObj),this._sourceLength=((r=this._source)===null||r===void 0?void 0:r.length)||0,this.sortedIndexMap.clear(),this.currentIndexedData=Array.from({length:this._sourceLength},((o,s)=>s)),this.rowHierarchyType==="tree"&&this.initTreeHierarchyState(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}updateFilterRules(t){var e,i,r;this.lastFilterRules=this.dataConfig.filterRules,this.dataConfig.filterRules=t,this._source=this.processRecords((i=(e=this.dataSourceObj)===null||e===void 0?void 0:e.records)!==null&&i!==void 0?i:this.dataSourceObj),this._sourceLength=((r=this._source)===null||r===void 0?void 0:r.length)||0,this.currentIndexedData=Array.from({length:this._sourceLength},((o,s)=>s)),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.rowHierarchyType==="tree"&&this.initTreeHierarchyState()),this.updatePagerData()}clearSortedIndexMap(){this.lastSortStates&&this.lastSortStates.length>0&&this.sortedIndexMap.forEach(((t,e)=>{this.lastSortStates.some((i=>i.field===e))?this.lastSortStates.forEach((i=>{i.order==="asc"?(t.desc=[],t.normal=[]):i.order==="desc"?(t.asc=[],t.normal=[]):(t.asc=[],t.desc=[])})):this.sortedIndexMap.delete(e)}))}get sourceLength(){return this._sourceLength}set sourceLength(t){this._sourceLength!==t&&(this._sourceLength=t,this.fireListeners(Cf.SOURCE_LENGTH_UPDATE,this._sourceLength))}get length(){return this.currentPagerIndexedData.length}get dataSource(){return this}get currentPagerIndexedData(){return this._currentPagerIndexedData.length>0?this._currentPagerIndexedData:[]}release(){var t;(t=super.release)===null||t===void 0||t.call(this),this.lastFilterRules=null,this.clearSortedMap(),this.clearCurrentIndexedData(),this.currentPagerIndexedData.length=0}clearSortedMap(){this.currentIndexedData&&(this.currentIndexedData.length=0),this.currentIndexedData=null,this.sortedIndexMap.forEach((t=>{t.asc&&(t.asc.length=0),t.desc&&(t.desc.length=0)})),this.sortedIndexMap.clear()}clearCurrentIndexedData(){this.currentIndexedData=null,this.currentPagerIndexedData.length=0}getOriginalRecord(t){let e;return e=this.dataSourceObj.records?Array.isArray(t)?Xw(this.records,t):this.records[t]:this._get(t),Zs(e,(i=>{this.recordPromiseCallBack(t,i)}))}getRawRecord(t){var e,i;if(!((e=this.beforeChangedRecordsMap)===null||e===void 0)&&e.has(t.toString()))return(i=this.beforeChangedRecordsMap)===null||i===void 0?void 0:i.get(t.toString());let r;return r=this.dataSourceObj.records?Array.isArray(t)?Xw(this.records,t):this.records[t]:this._get(t),Zs(r,(o=>{this.recordPromiseCallBack(t,o)}))}getOriginalField(t,e,i,r,o){if(e!==null)return W0(this.getOriginalRecord(t),e,i,r,o,(s=>{this.fieldPromiseCallBack(t,e,s)}))}getRawFieldData(t,e,i,r,o){if(e!==null)return W0(this.getRawRecord(t),e,i,r,o,(s=>{this.fieldPromiseCallBack(t,e,s)}))}hasOriginalField(t,e){if(e===null)return!1;if(typeof e=="function")return!0;const i=this.getOriginalRecord(t);return!!(i&&e in i)}fieldPromiseCallBack(t,e,i){}recordPromiseCallBack(t,e){}canChangeOrder(t,e){var i;if(!((i=this.dataSourceObj)===null||i===void 0)&&i.canChangeOrder)return this.dataSourceObj.canChangeOrder(t,e);if(this.hasHierarchyStateExpand){let r=this.currentPagerIndexedData[t],o=this.currentPagerIndexedData[e];if(r=Array.isArray(r)?[...r]:[r],o=Array.isArray(o)?[...o]:[o],e>t&&o.length>r.length){let s=this.currentPagerIndexedData[e+1];s=Array.isArray(s)?[...s]:[s],s.length<o.length&&o.splice(o.length-1,1)}if(r.length===o.length){for(let s=0;s<=r.length-2;s++)if(r[s]!==o[s])return!1;return!0}return!1}return!0}changeOrder(t,e){var i,r,o;if(!((i=this.dataSourceObj)===null||i===void 0)&&i.changeOrder)this.dataSourceObj.changeOrder(t,e);else if(!(!((r=this.lastSortStates)===null||r===void 0)&&r.some((s=>s.order==="asc"||s.order==="desc")))&&this.canChangeOrder(t,e))if(this.hasHierarchyStateExpand){let s,a,l=this.currentPagerIndexedData[t],h=this.currentPagerIndexedData[e];if(l=Array.isArray(l)?[...l]:[l],h=Array.isArray(h)?[...h]:[h],l.length>1||h.length>1){if(e>t&&h.length>l.length){let u=this.currentPagerIndexedData[e+1];u=Array.isArray(u)?[...u]:[u],u.length<h.length&&h.splice(h.length-1,1)}if(s=l.splice(l.length-1,1)[0],a=h.splice(h.length-1,1)[0],l.length>=1){const u=this.getOriginalRecord(l);if(u){const d=u.filteredChildren?u.filteredChildren.splice(s,1):u.children.splice(s,1);d.unshift(a,0),Array.prototype.splice.apply((o=u.filteredChildren)!==null&&o!==void 0?o:u.children,d)}}else{const u=this.records.splice(s,1);u.unshift(a,0),Array.prototype.splice.apply(this.records,u)}}else this.exchangeRecordData(t,e);this.restoreTreeHierarchyState(),this.updatePagerData()}else this.exchangeRecordData(t,e)}exchangeRecordData(t,e){const i=this.getRecordIndexPaths(t),r=this.getRecordIndexPaths(e),o=this.records.splice(i,1);o.unshift(r,0),Array.prototype.splice.apply(this.records,o)}restoreTreeHierarchyState(){var t,e;if(this.hierarchyExpandLevel){for(let r=0;r<this._sourceLength;r++){const o=this.getOriginalRecord(r);o&&((t=o.filteredChildren)!==null&&t!==void 0?t:o.children)&&!o.hierarchyState&&(o.hierarchyState=Tt.collapse)}this.currentIndexedData=Array.from({length:this._sourceLength},((r,o)=>o));let i=this._sourceLength;for(let r=0;r<i;r++){const o=this.currentIndexedData[r],s=this.getOriginalRecord(o);if(!s)continue;const a=(e=s.filteredChildren)!==null&&e!==void 0?e:s.children;if(a?.length>0&&s.hierarchyState===Tt.expand){this.hasHierarchyStateExpand=!0;const l=this.restoreChildrenNodeHierarchy(o,s);r+=l,i+=l}else s.children===!0&&!s.hierarchyState&&(s.hierarchyState=Tt.collapse)}}}restoreChildrenNodeHierarchy(t,e){var i,r;let o=0;const s=(i=e.filteredChildren)!==null&&i!==void 0?i:e.children,a=(r=s?.length)!==null&&r!==void 0?r:0;for(let l=0;l<a;l++){e.hierarchyState===Tt.expand&&(o+=1);const h=s[l],u=Array.isArray(t)?t.concat(l):[t,l];e.hierarchyState===Tt.expand&&this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+o,0,u),o+=this.restoreChildrenNodeHierarchy(u,h)}return o}_setNodeStateRecursive(t,e){var i;if(!t)return;const r=(i=t.filteredChildren)!==null&&i!==void 0?i:t.children;if(r&&(Array.isArray(r)?r.length>0:r===!0)&&(t.hierarchyState=e),r&&Array.isArray(r))for(const o of r)this._setNodeStateRecursive(o,e)}expandAllNodes(){if(Array.isArray(this._source)){for(const t of this._source)this._setNodeStateRecursive(t,Tt.expand);this.hasHierarchyStateExpand=!0,this.clearSortedIndexMap(),this.restoreTreeHierarchyState(),this.lastSortStates&&this.lastSortStates.length>0?this.sort(this.lastSortStates):this.updatePagerData()}}collapseAllNodes(){if(Array.isArray(this._source)){for(const t of this._source)this._setNodeStateRecursive(t,Tt.collapse);this.clearSortedIndexMap(),this.restoreTreeHierarchyState(),this.lastSortStates&&this.lastSortStates.length>0?this.sort(this.lastSortStates):this.updatePagerData()}}};Ss.EMPTY=new Ss({get(){},length:0});function Xw(n,t){var e;let i=n;for(let r=0;r<t.length;r++){const o=t[r];if(!i[o])return;i=i[o];const s=(e=i.filteredChildren)!==null&&e!==void 0?e:i?.children;s&&r+1<t.length&&(i=s)}return i}function WB(n,t){return n.sort(((e,i)=>{var r,o;dt(e)&&(e=[e]),dt(i)&&(i=[i]);const s=Math.max(e.length,i.length);for(let a=0;a<s;a++){const l=(r=e[a])!==null&&r!==void 0?r:-1,h=(o=i[a])!==null&&o!==void 0?o:-1;if(l!==h)return h-l}return 0}))}var wy,jB;function Kx(){if(jB)return wy;jB=1;var n=Array.isArray;return wy=n,wy}var xy,VB;function yot(){if(VB)return xy;VB=1;var n=typeof Ag=="object"&&Ag&&Ag.Object===Object&&Ag;return xy=n,xy}var Sy,GB;function Zx(){if(GB)return Sy;GB=1;var n=yot(),t=typeof self=="object"&&self&&self.Object===Object&&self,e=n||t||Function("return this")();return Sy=e,Sy}var Ay,$B;function Jx(){if($B)return Ay;$B=1;var n=Zx(),t=n.Symbol;return Ay=t,Ay}var My,UB;function Cot(){if(UB)return My;UB=1;var n=Jx(),t=Object.prototype,e=t.hasOwnProperty,i=t.toString,r=n?n.toStringTag:void 0;function o(s){var a=e.call(s,r),l=s[r];try{s[r]=void 0;var h=!0}catch{}var u=i.call(s);return h&&(a?s[r]=l:delete s[r]),u}return My=o,My}var Ty,XB;function _ot(){if(XB)return Ty;XB=1;var n=Object.prototype,t=n.toString;function e(i){return t.call(i)}return Ty=e,Ty}var Ry,YB;function AD(){if(YB)return Ry;YB=1;var n=Jx(),t=Cot(),e=_ot(),i="[object Null]",r="[object Undefined]",o=n?n.toStringTag:void 0;function s(a){return a==null?a===void 0?r:i:o&&o in Object(a)?t(a):e(a)}return Ry=s,Ry}var By,qB;function wot(){if(qB)return By;qB=1;function n(t){return t!=null&&typeof t=="object"}return By=n,By}var ky,KB;function Qx(){if(KB)return ky;KB=1;var n=AD(),t=wot(),e="[object Symbol]";function i(r){return typeof r=="symbol"||t(r)&&n(r)==e}return ky=i,ky}var Py,ZB;function xot(){if(ZB)return Py;ZB=1;var n=Kx(),t=Qx(),e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,i=/^\w*$/;function r(o,s){if(n(o))return!1;var a=typeof o;return a=="number"||a=="symbol"||a=="boolean"||o==null||t(o)?!0:i.test(o)||!e.test(o)||s!=null&&o in Object(s)}return Py=r,Py}var Ey,JB;function MD(){if(JB)return Ey;JB=1;function n(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}return Ey=n,Ey}var Ly,QB;function Sot(){if(QB)return Ly;QB=1;var n=AD(),t=MD(),e="[object AsyncFunction]",i="[object Function]",r="[object GeneratorFunction]",o="[object Proxy]";function s(a){if(!t(a))return!1;var l=n(a);return l==i||l==r||l==e||l==o}return Ly=s,Ly}var Oy,t2;function Aot(){if(t2)return Oy;t2=1;var n=Zx(),t=n["__core-js_shared__"];return Oy=t,Oy}var Iy,e2;function Mot(){if(e2)return Iy;e2=1;var n=Aot(),t=(function(){var i=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""})();function e(i){return!!t&&t in i}return Iy=e,Iy}var Hy,i2;function Tot(){if(i2)return Hy;i2=1;var n=Function.prototype,t=n.toString;function e(i){if(i!=null){try{return t.call(i)}catch{}try{return i+""}catch{}}return""}return Hy=e,Hy}var Dy,n2;function Rot(){if(n2)return Dy;n2=1;var n=Sot(),t=Mot(),e=MD(),i=Tot(),r=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,s=Function.prototype,a=Object.prototype,l=s.toString,h=a.hasOwnProperty,u=RegExp("^"+l.call(h).replace(r,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function d(c){if(!e(c)||t(c))return!1;var g=n(c)?u:o;return g.test(i(c))}return Dy=d,Dy}var Fy,r2;function Bot(){if(r2)return Fy;r2=1;function n(t,e){return t?.[e]}return Fy=n,Fy}var zy,o2;function TD(){if(o2)return zy;o2=1;var n=Rot(),t=Bot();function e(i,r){var o=t(i,r);return n(o)?o:void 0}return zy=e,zy}var Ny,s2;function Lv(){if(s2)return Ny;s2=1;var n=TD(),t=n(Object,"create");return Ny=t,Ny}var Wy,a2;function kot(){if(a2)return Wy;a2=1;var n=Lv();function t(){this.__data__=n?n(null):{},this.size=0}return Wy=t,Wy}var jy,l2;function Pot(){if(l2)return jy;l2=1;function n(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}return jy=n,jy}var Vy,h2;function Eot(){if(h2)return Vy;h2=1;var n=Lv(),t="__lodash_hash_undefined__",e=Object.prototype,i=e.hasOwnProperty;function r(o){var s=this.__data__;if(n){var a=s[o];return a===t?void 0:a}return i.call(s,o)?s[o]:void 0}return Vy=r,Vy}var Gy,u2;function Lot(){if(u2)return Gy;u2=1;var n=Lv(),t=Object.prototype,e=t.hasOwnProperty;function i(r){var o=this.__data__;return n?o[r]!==void 0:e.call(o,r)}return Gy=i,Gy}var $y,d2;function Oot(){if(d2)return $y;d2=1;var n=Lv(),t="__lodash_hash_undefined__";function e(i,r){var o=this.__data__;return this.size+=this.has(i)?0:1,o[i]=n&&r===void 0?t:r,this}return $y=e,$y}var Uy,c2;function Iot(){if(c2)return Uy;c2=1;var n=kot(),t=Pot(),e=Eot(),i=Lot(),r=Oot();function o(s){var a=-1,l=s==null?0:s.length;for(this.clear();++a<l;){var h=s[a];this.set(h[0],h[1])}}return o.prototype.clear=n,o.prototype.delete=t,o.prototype.get=e,o.prototype.has=i,o.prototype.set=r,Uy=o,Uy}var Xy,g2;function Hot(){if(g2)return Xy;g2=1;function n(){this.__data__=[],this.size=0}return Xy=n,Xy}var Yy,f2;function Dot(){if(f2)return Yy;f2=1;function n(t,e){return t===e||t!==t&&e!==e}return Yy=n,Yy}var qy,p2;function Ov(){if(p2)return qy;p2=1;var n=Dot();function t(e,i){for(var r=e.length;r--;)if(n(e[r][0],i))return r;return-1}return qy=t,qy}var Ky,m2;function Fot(){if(m2)return Ky;m2=1;var n=Ov(),t=Array.prototype,e=t.splice;function i(r){var o=this.__data__,s=n(o,r);if(s<0)return!1;var a=o.length-1;return s==a?o.pop():e.call(o,s,1),--this.size,!0}return Ky=i,Ky}var Zy,v2;function zot(){if(v2)return Zy;v2=1;var n=Ov();function t(e){var i=this.__data__,r=n(i,e);return r<0?void 0:i[r][1]}return Zy=t,Zy}var Jy,b2;function Not(){if(b2)return Jy;b2=1;var n=Ov();function t(e){return n(this.__data__,e)>-1}return Jy=t,Jy}var Qy,y2;function Wot(){if(y2)return Qy;y2=1;var n=Ov();function t(e,i){var r=this.__data__,o=n(r,e);return o<0?(++this.size,r.push([e,i])):r[o][1]=i,this}return Qy=t,Qy}var tC,C2;function jot(){if(C2)return tC;C2=1;var n=Hot(),t=Fot(),e=zot(),i=Not(),r=Wot();function o(s){var a=-1,l=s==null?0:s.length;for(this.clear();++a<l;){var h=s[a];this.set(h[0],h[1])}}return o.prototype.clear=n,o.prototype.delete=t,o.prototype.get=e,o.prototype.has=i,o.prototype.set=r,tC=o,tC}var eC,_2;function Vot(){if(_2)return eC;_2=1;var n=TD(),t=Zx(),e=n(t,"Map");return eC=e,eC}var iC,w2;function Got(){if(w2)return iC;w2=1;var n=Iot(),t=jot(),e=Vot();function i(){this.size=0,this.__data__={hash:new n,map:new(e||t),string:new n}}return iC=i,iC}var nC,x2;function $ot(){if(x2)return nC;x2=1;function n(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}return nC=n,nC}var rC,S2;function Iv(){if(S2)return rC;S2=1;var n=$ot();function t(e,i){var r=e.__data__;return n(i)?r[typeof i=="string"?"string":"hash"]:r.map}return rC=t,rC}var oC,A2;function Uot(){if(A2)return oC;A2=1;var n=Iv();function t(e){var i=n(this,e).delete(e);return this.size-=i?1:0,i}return oC=t,oC}var sC,M2;function Xot(){if(M2)return sC;M2=1;var n=Iv();function t(e){return n(this,e).get(e)}return sC=t,sC}var aC,T2;function Yot(){if(T2)return aC;T2=1;var n=Iv();function t(e){return n(this,e).has(e)}return aC=t,aC}var lC,R2;function qot(){if(R2)return lC;R2=1;var n=Iv();function t(e,i){var r=n(this,e),o=r.size;return r.set(e,i),this.size+=r.size==o?0:1,this}return lC=t,lC}var hC,B2;function Kot(){if(B2)return hC;B2=1;var n=Got(),t=Uot(),e=Xot(),i=Yot(),r=qot();function o(s){var a=-1,l=s==null?0:s.length;for(this.clear();++a<l;){var h=s[a];this.set(h[0],h[1])}}return o.prototype.clear=n,o.prototype.delete=t,o.prototype.get=e,o.prototype.has=i,o.prototype.set=r,hC=o,hC}var uC,k2;function Zot(){if(k2)return uC;k2=1;var n=Kot(),t="Expected a function";function e(i,r){if(typeof i!="function"||r!=null&&typeof r!="function")throw new TypeError(t);var o=function(){var s=arguments,a=r?r.apply(this,s):s[0],l=o.cache;if(l.has(a))return l.get(a);var h=i.apply(this,s);return o.cache=l.set(a,h)||l,h};return o.cache=new(e.Cache||n),o}return e.Cache=n,uC=e,uC}var dC,P2;function Jot(){if(P2)return dC;P2=1;var n=Zot(),t=500;function e(i){var r=n(i,function(s){return o.size===t&&o.clear(),s}),o=r.cache;return r}return dC=e,dC}var cC,E2;function Qot(){if(E2)return cC;E2=1;var n=Jot(),t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,e=/\\(\\)?/g,i=n(function(r){var o=[];return r.charCodeAt(0)===46&&o.push(""),r.replace(t,function(s,a,l,h){o.push(l?h.replace(e,"$1"):a||s)}),o});return cC=i,cC}var gC,L2;function tst(){if(L2)return gC;L2=1;function n(t,e){for(var i=-1,r=t==null?0:t.length,o=Array(r);++i<r;)o[i]=e(t[i],i,t);return o}return gC=n,gC}var fC,O2;function est(){if(O2)return fC;O2=1;var n=Jx(),t=tst(),e=Kx(),i=Qx(),r=n?n.prototype:void 0,o=r?r.toString:void 0;function s(a){if(typeof a=="string")return a;if(e(a))return t(a,s)+"";if(i(a))return o?o.call(a):"";var l=a+"";return l=="0"&&1/a==-1/0?"-0":l}return fC=s,fC}var pC,I2;function ist(){if(I2)return pC;I2=1;var n=est();function t(e){return e==null?"":n(e)}return pC=t,pC}var mC,H2;function nst(){if(H2)return mC;H2=1;var n=Kx(),t=xot(),e=Qot(),i=ist();function r(o,s){return n(o)?o:t(o,s)?[o]:e(i(o))}return mC=r,mC}var vC,D2;function rst(){if(D2)return vC;D2=1;var n=Qx();function t(e){if(typeof e=="string"||n(e))return e;var i=e+"";return i=="0"&&1/e==-1/0?"-0":i}return vC=t,vC}var bC,F2;function ost(){if(F2)return bC;F2=1;var n=nst(),t=rst();function e(i,r){r=n(r,i);for(var o=0,s=r.length;i!=null&&o<s;)i=i[t(r[o++])];return o&&o==s?i:void 0}return bC=e,bC}var yC,z2;function sst(){if(z2)return yC;z2=1;var n=ost();function t(e,i,r){var o=e==null?void 0:n(e,i);return o===void 0?r:o}return yC=t,yC}var ast=sst();const lst=C1(ast);function hst(n,t,e,i){(n[t]||(n[t]=new Map)).set(e,i)}class Hv extends Ss{static get EVENT_TYPE(){return Ss.EVENT_TYPE}static ofArray(t,e,i,r,o,s){return new Hv({get:a=>t[a],length:t.length,records:t},e,i,r,o,s)}constructor(t,e,i,r,o,s){let a;wt(e?.groupByRules)&&(o="tree",a=!0),super(t,e,i,r,o,s),this._isGrouped=a,this._recordCache=[],this._fieldCache={}}getOriginalRecord(t){return dt(t)&&this._recordCache&&this._recordCache[t]?this._recordCache[t]:super.getOriginalRecord(t)}getRawRecord(t){var e,i,r,o;let s,a;if(this._isGrouped){if(s=this.getOriginRecordIndexForGroup(t),$(s)&&((e=this.beforeChangedRecordsMap)===null||e===void 0?void 0:e.has(s.toString())))return(i=this.beforeChangedRecordsMap)===null||i===void 0?void 0:i.get(s.toString())}else if(!((r=this.beforeChangedRecordsMap)===null||r===void 0)&&r.has(t.toString()))return(o=this.beforeChangedRecordsMap)===null||o===void 0?void 0:o.get(t.toString());return dt(t)&&this._recordCache&&this._recordCache[t]?this._recordCache[t]:(a=this.dataSourceObj.records?Array.isArray(t)?Xw(this.records,t):this.records[t]:this._get(t),Zs(a,(l=>{this.recordPromiseCallBack(t,l)})))}getOriginalField(t,e,i,r,o){const s=this._fieldCache&&this._fieldCache[t];if(s){const a=s.get(e);if(a)return a}return super.getOriginalField(t,e,i,r,o)}clearCache(){this._recordCache&&(this._recordCache=[]),this._fieldCache&&(this._fieldCache={})}fieldPromiseCallBack(t,e,i){hst(this._fieldCache,t,e,i)}recordPromiseCallBack(t,e){this._recordCache&&(this._recordCache[t]=e)}get records(){return Array.isArray(this._recordCache)&&this._recordCache.length>0?this._recordCache:super.records}release(){var t;(t=super.release)===null||t===void 0||t.call(this),this._recordCache=null,this._fieldCache=null}_generateFieldAggragations(){var t;if(super._generateFieldAggragations(),wt((t=this.dataConfig)===null||t===void 0?void 0:t.groupByRules)){const e=this.dataConfig.groupByRules;this.groupAggregator=new this.registedAggregators[Qe.CUSTOM]({field:"",aggregationFun:(i,r,o)=>{const s=new Map,a=[];for(let l=0;l<r.length;l++)Yw(r[l],a,s,e,0);return a}}),this.fieldAggregators.push(this.groupAggregator)}}processRecords(t){var e;const i=super.processRecords(t);return((e=this.groupAggregator)===null||e===void 0?void 0:e.value())||i}getGroupLength(){var t,e,i;return(i=(e=(t=this.dataConfig)===null||t===void 0?void 0:t.groupByRules)===null||e===void 0?void 0:e.length)!==null&&i!==void 0?i:0}updateGroup(){var t,e,i;this.clearCache();const r=this.source;this._source=this.processRecords((e=(t=this.dataSourceObj)===null||t===void 0?void 0:t.records)!==null&&e!==void 0?e:this.dataSourceObj),r&&RD(r,this.source),this.sourceLength=((i=this.source)===null||i===void 0?void 0:i.length)||0,this.sortedIndexMap.clear(),this.currentIndexedData=Array.from({length:this.sourceLength},((o,s)=>s)),this.userPagination||(this.pagination.perPageCount=this.sourceLength,this.pagination.totalCount=this.sourceLength),this.initTreeHierarchyState(),this.updatePagerData()}getOriginRecordIndexForGroup(t){const e=this.getOriginalRecord(t);if($(e)&&!(e.children&&e.children.length>0)){for(let i=0;i<this.dataSourceObj.records.length;i++)if(this.dataSourceObj.records[i]===e)return i}}addRecordsForGroup(t,e){if(!wt(t)||t.length===0)return;let i=this.getOriginRecordIndexForGroup(e);(i===void 0||i>this.dataSourceObj.records)&&(i=this.dataSourceObj.records.length),this.dataSourceObj.records.splice(i,0,...t),this.adjustBeforeChangedRecordsMap(i,t.length),this.updateGroup()}deleteRecordsForGroup(t){if(!wt(t)||t.length===0)return;const e=WB(t);for(let i=0;i<e.length;i++){const r=e[i];if(dt(r)&&(r>=this.sourceLength||r<0))continue;const o=this.getOriginRecordIndexForGroup(r);this.beforeChangedRecordsMap.delete(o.toString()),this.dataSourceObj.records.splice(o,1),this.sourceLength-=1,this.adjustBeforeChangedRecordsMap(o,1,"delete")}this.updateGroup()}updateRecordsForGroup(t,e){for(let i=0;i<e.length;i++){const r=e[i];if(dt(r)&&(r>=this.sourceLength||r<0))continue;const o=this.getOriginRecordIndexForGroup(r);this.beforeChangedRecordsMap.delete(o.toString()),this.dataSourceObj.records[o]=t[i]}this.updateGroup()}addRecordsForTree(t,e){if(wt(t)&&t.length!==0){if(this.adjustBeforeChangedRecordsMap(e,t.length),dt(e))this.dataSourceObj.records.splice(e,0,...t);else{const i=[...e],r=i.pop(),o=this.getOriginalRecord(i);o.children?o.children.splice(r,0,...t):o.children=t}this.initTreeHierarchyState(),this.updatePagination()}}deleteRecordsForTree(t){if(!wt(t)||t.length===0)return[];const e=WB(t),i=[];for(let r=0;r<e.length;r++){const o=e[r];if(!dt(o)||!(o>=this.sourceLength||o<0)){if(this.beforeChangedRecordsMap.delete(o.toString()),dt(o))this.dataSourceObj.records.splice(o,1);else{const s=[...o],a=s.pop();this.getOriginalRecord(s).children.splice(a,1)}this.adjustBeforeChangedRecordsMap(o,1,"delete"),i.push(o)}}return this.initTreeHierarchyState(),this.updatePagination(),i}updateRecordsForTree(t,e){for(let i=0;i<e.length;i++){const r=e[i],o=t[i];if(!dt(r)||!(r>=this.sourceLength||r<0))if(this.beforeChangedRecordsMap.delete(r.toString()),dt(r))this.dataSourceObj.records.splice(r,1,o);else{const s=[...r],a=s.pop();this.getOriginalRecord(s).children.splice(a,1,o)}}this.initTreeHierarchyState(),this.updatePagerData()}adjustBeforeChangedRecordsMap(t,e,i="add"){if(this.rowHierarchyType==="tree"){let r;r=dt(t)?[t]:t;const o=[];this.beforeChangedRecordsMap.forEach(((s,a)=>{var l,h;const u=a.split(","),d=Math.max(u.length,r.length);for(let c=0;c<d;c++){const g=(l=r[c])!==null&&l!==void 0?l:-1,f=(h=Number(u[c]))!==null&&h!==void 0?h:-1;if(g<f||g===f&&c===u.length-1&&c===r.length-1)return u[c]=(f+(i==="add"?e:-e)).toString(),void o.push({originKey:a,targetKey:u.toString(),value:s})}})),o.forEach((({originKey:s,targetKey:a,value:l})=>{this.beforeChangedRecordsMap.delete(s),this.beforeChangedRecordsMap.set(a,l)}))}else super.adjustBeforeChangedRecordsMap(t,e,i)}cacheBeforeChangedRecord(t,e){var i;const r=this.getOriginalRecord(t);e.internalProps.groupBy&&(t=this.getOriginRecordIndexForGroup(t)),this.beforeChangedRecordsMap.has(t.toString())||this.beforeChangedRecordsMap.set(t.toString(),(i=Ul(r,void 0,["vtable_gantt_linkedFrom","vtable_gantt_linkedTo"]))!==null&&i!==void 0?i:{})}getGroupSeriesNumber(t){const e=this.dataSource.currentIndexedData[t],i=e.length-1;let r=e.length,o=1;for(;r>i;o++){const s=this.dataSource.currentIndexedData[t-o];r=dt(s)?1:s.length}return o-1}}function Yw(n,t,e,i,r){const o=i[r];if(!$(o))return void t.push(n);const s=lst(n,o);if(s!==void 0){if(e.has(s)){const a=e.get(s);return Yw(n,t[a].children,t[a].map,i,r+1)}return e.set(s,t.length),t.push({vtableMerge:!0,vtableMergeName:s,children:[],map:new Map}),Yw(n,t[t.length-1].children,t[t.length-1].map,i,r+1)}}function RD(n,t,e,i){if(!e){e=new Map;for(let r=0;r<n.length;r++){const o=n[r];o.vtableMerge&&e.set(o.vtableMergeName,r)}}if(!i){i=new Map;for(let r=0;r<t.length;r++){const o=t[r];o.vtableMerge&&i.set(o.vtableMergeName,r)}}for(let r=0;r<n.length;r++){const o=n[r],s=t[i.get(o.vtableMergeName)];$(s)&&(s.hierarchyState=n[r].hierarchyState),wt(o?.children)&&wt(s?.children)&&o.map.size!==0&&s.map.size!==0&&RD(o.children,s.children,o.map,s.map)}}var _f={exports:{}},N2;function ust(){if(N2)return _f.exports;N2=1;var n={},t=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),e=["style","variant","weight","size","lineHeight","family"],i=/([\.0-9]+)(.*)/,r=function(l,h,u){var d=l.match(i);if(d){l=parseFloat(d[1]);var c=d[2].toLowerCase().trim(),g=Math.round(l);switch(g===l&&(l=g),c){case"em":return h===null?void 0:l*h;case"px":return l;case"pt":return l/(72/u);case"pc":return l/(6/u);case"mm":return l*(u/25.4);case"cm":return l*(u/2.54);case"in":return l*u;case"%":return h===null?void 0:h*(l/100)}}},o={size:r,lineHeight:r},s={serif:1,"sans-serif":1,cursive:1,fantasy:1,monospace:1},a=_f.exports=function(l,h,u){var d=l+"-"+(h||"null")+"@"+u;if(u=u||96,typeof n[d]<"u")return n[d];if(h&&(h=a(h,null,u)),l==="inherit")return h;var c=t.exec(l);if(!c){n[d]=null;return}c.shift();for(var g={},f=0;f<c.length;f++){var p=e[f],m=c[f];if(o[p]&&m){var v=h&&h[p]||null,b=o[p](m,v,u);typeof b>"u"&&p==="lineHeight"&&m?m=g.size*parseFloat(m):m=b}if(!(!m||m==="normal")){if(m==="inherit"){if(!h)return;m=h[p]}m.trim&&(m=m.trim()),g[p]=m}}Object.keys(g).length||(g=null),n[d]=g;var y=[];g.style&&y.push(g.style),g.variant&&y.push(g.variant),g.weight&&g.weight!=="400"&&g.weight!=="normal"&&y.push(g.weight),y.push(g.size+"px"),g.lineHeight&&(y[y.length-1]+="/"+g.lineHeight+"px");var C=g.family.split(",");return g.family=C.map(function(w){return w=w.trim(),s[w.toLowerCase()]&&(w=w.toLowerCase()),w}),y.push(g.family),Object.defineProperty(g,"toString",{value:function(){return y.map(function(w){return Array.isArray(w)?w.map(function(_){return _.indexOf(" ")>-1?'"'+_.replace(/["']/g,"")+'"':_}).join(", "):w}).join(" ")}}),g};return _f.exports.generics=s,_f.exports}var dst=ust();const cst=C1(dst);function gst(n){return cst(n)}function Kt(n){var t,e,i,r;if(dt(n)||Xe(n)||wt(n)){let o=Lp(n);return typeof o=="number"||typeof o=="string"?o=[o,o,o,o]:Array.isArray(o)&&(o=o.slice(0)),o}return n&&(isFinite(n.bottom)||isFinite(n.left)||isFinite(n.right)||isFinite(n.top))?[(t=n.top)!==null&&t!==void 0?t:0,(e=n.right)!==null&&e!==void 0?e:0,(i=n.bottom)!==null&&i!==void 0?i:0,(r=n.left)!==null&&r!==void 0?r:0]:[0,0,0,0]}const qf=0,BD=1,j0=2,kD=3,PD=10,ED=11,LD=12,fst=9,pst=13,mst=10,vst=12,bst=32,yst=37,Cst=46,_st=48,wst=57,xst=65,Sst=90,Ast=97,Mst=122;function Tst(n){return n>=xst&&n<=Sst}function Rst(n){return n>=Ast&&n<=Mst}function Bst(n){return Rst(n)||Tst(n)}function kst(n){return n===fst||n===mst||n===vst||n===pst||n===bst}function CC(n){return n>=_st&&n<=wst}function W2(n){return n===Cst}function j2(n){return Bst(n)||n===yst}function Yd(n){return new Error(`calc parse error: ${n}`)}function Pst(n){const t=n.replace(/calc\(/g,"(").trim(),e=[],i=t.length;for(let a=0;a<i;a++){const l=t[a],h=l.charCodeAt(0);if(l==="("||l===")")e.push({value:l,type:qf});else if(l==="*"||l==="/")e.push({value:l,type:j0});else if(l==="+"||l==="-")a=r(l,a+1)-1;else if(CC(h)||W2(h))a=o(l,a+1)-1;else if(!kst(h))throw Yd(n)}function r(a,l){if(l<i){const h=t[l],u=h.charCodeAt(0);if(CC(u)||W2(u))return o(a+h,l+1)}return e.push({value:a,type:j0}),l}function o(a,l){let h=l;for(;h<i;h++){const u=t[h],d=u.charCodeAt(0);if(CC(d))a+=u;else{if(u!=="."){if(j2(d))return s(a,u,h+1);break}if(a.indexOf(".")>=0)throw Yd(n);a+=u}}if(a===".")throw Yd(n);return e.push({value:parseFloat(a),type:kD}),h}function s(a,l,h){let u=h;for(;u<i;u++){const d=t[u];if(!j2(d.charCodeAt(0)))break;l+=d}return e.push({value:parseFloat(a),unit:l,type:BD}),u}return e}const V2={"*":3,"/":3,"+":2,"-":2};function OD(n,t){function e(r){const o=r.pop(),s=r.pop(),a=r.pop();if(!(a&&a.nodeType&&s&&s.type===j0&&o&&o.nodeType))throw Yd(t);return{nodeType:ED,left:a,op:s,right:o}}const i=[];for(;n.length;){const r=n.shift();if(r.type===qf&&r.value==="("){let o=0;const s=mD.findIndex(n,(a=>{if(a.type===qf&&a.value==="(")o++;else if(a.type===qf&&a.value===")"){if(!o)return!0;o--}return!1}));if(s===-1)throw Yd(t);i.push(OD(n.splice(0,s),t)),n.shift()}else if(r.type===j0){if(i.length>=3){const o=i[i.length-2].value;V2[r.value]<=V2[o]&&i.push(e(i))}i.push(r)}else if(r.type===BD){const{value:o,unit:s}=r;i.push({nodeType:PD,value:o,unit:s})}else r.type===kD&&i.push({nodeType:LD,value:r.value})}for(;i.length>1;)i.push(e(i));return i[0]}function Est(n){return OD(Pst(n),n)}function qw(n,t){if(n.nodeType===ED){const e=qw(n.left,t),i=qw(n.right,t);switch(n.op.value){case"+":return e+i;case"-":return e-i;case"*":return e*i;case"/":return e/i;default:throw new Error(`calc error. unknown operator: ${n.op.value}`)}}else if(n.nodeType===PD)switch(n.unit){case"%":return n.value*t.full/100;case"px":return n.value;default:throw new Error(`calc error. unknown unit: ${n.unit}`)}else if(n.nodeType===LD)return n.value;throw new Error("calc error.")}function Lst(n,t){return qw(Est(n),t)}function Ost(n,t){return typeof n=="string"?Lst(n.trim(),t):n-0}function Ist(n){return!he(n)&&(!!dt(n)||+n==+n)}function _C(n){return!!Xe(n)&&!!n.endsWith("%")&&Ist(n.substring(0,n.length-1))}function Hst(n,t="vtable"){var e,i;const r=document.createElement("div");r.setAttribute("tabindex","0"),r.classList.add(t),r.style.outline="none",r.style.margin=`${n.top}px ${n.right}px ${n.bottom}px ${n.left}px`;const o=(r.offsetWidth||((e=r.parentElement)===null||e===void 0?void 0:e.offsetWidth)||1)-1,s=(r.offsetHeight||((i=r.parentElement)===null||i===void 0?void 0:i.offsetHeight)||1)-1;return r.style.width=o&&o-n.left-n.right+"px"||"0px",r.style.height=s&&s-n.top-n.bottom+"px"||"0px",r}function Dst(n,t){var e,i;n.style.margin=`${t.top}px ${t.right}px ${t.bottom}px ${t.left}px`;const r=(n.offsetWidth||((e=n.parentElement)===null||e===void 0?void 0:e.offsetWidth)||1)-1,o=(n.offsetHeight||((i=n.parentElement)===null||i===void 0?void 0:i.offsetHeight)||1)-1;n.style.width=r&&r-t.left-t.right+"px"||"0px",n.style.height=o&&o-t.top-t.bottom+"px"||"0px"}function ID(n,t){const{dataSourceEventIds:e}=n.internalProps;e&&e.forEach((i=>n.internalProps.handler.off(i))),t(n),n.internalProps.dataSourceEventIds=[n.internalProps.handler.on(n.internalProps.dataSource,Ss.EVENT_TYPE.CHANGE_ORDER,(()=>{n.dataSource.hierarchyExpandLevel&&n.refreshRowColCount(),n.render()}))]}function G2(n,t=[]){ID(n,(()=>{n.internalProps.records=t;const e=n.internalProps.dataSource=Hv.ofArray(t,n.internalProps.dataConfig,n.pagination,n.internalProps.columns,n.internalProps.layoutMap.rowHierarchyType,HD(n));n.addReleaseObj(e)}))}function HD(n){var t;return n.options.hierarchyExpandLevel?n.options.hierarchyExpandLevel:n.internalProps.groupBy?1/0:!((t=n._hasHierarchyTreeHeader)===null||t===void 0)&&t.call(n)?1:void 0}function Fst(n,t){ID(n,(()=>{n.internalProps.dataSource&&n.internalProps.releaseList.forEach((e=>{e instanceof Ss&&(e.release(),n.internalProps.releaseList.splice(n.internalProps.releaseList.indexOf(e),1))})),t?t instanceof Ss?(n.internalProps.dataSource=t,n.internalProps.dataSource.supplementConfig(n.pagination,n.options.columns,n.internalProps.layoutMap.rowHierarchyType,HD(n))):n.internalProps.dataSource=new Hv(t):n.internalProps.dataSource=Ss.EMPTY,n.addReleaseObj(n.internalProps.dataSource),n.internalProps.records=null}))}function zst(n,t){if(!n.internalProps.frozenRowCount)return null;let{scrollTop:e}=n;const i=n.internalProps.frozenRowCount;for(let r=0;r<i;r++){const o=n.getRowHeight(r),s=e+o;if(s>t)return{top:e,row:r,bottom:s,height:o};e=s}return null}function Nst(n,t){if(!n.internalProps.frozenColCount)return null;let{scrollLeft:e}=n;const i=n.internalProps.frozenColCount;for(let r=0;r<i;r++){const o=n.getColWidth(r),s=e+o;if(s>t)return{left:e,col:r,right:s,width:o};e=s}return null}function sh(n,t){return Math.round(Ost(t,n.internalProps.calcWidthContext))}function Wst(n,t){return n?n.min&&n.min>t?n.min:n.max&&n.max<t?n.max:t:t}function jst(n){let t=0,e=0;n.frozenColCount>0&&(t=n.getFrozenColsWidth()),n.rightFrozenColCount>0&&(e=n.getRightFrozenColsWidth());let i=0,r=0;return n.frozenRowCount>0&&(i=n.getFrozenRowsHeight()),n.bottomFrozenRowCount>0&&(r=n.getBottomFrozenRowsHeight()),new To(n.scrollLeft+t,n.scrollTop+i,n.tableNoFrameWidth-t-e,n.tableNoFrameHeight-i-r)}function Ba(n,t,e,i,r,o=!0){const s=Kt(r("padding",n,e,i,t)),a=r("bgColor",n,e,i,t),l=r("font",n,e,i,t);let h,u,d,c,g;if(l){const{family:k,size:L,weight:O,style:I,variant:H}=gst(l);h=k.join(" "),u=L,d=O,c=I,c=H}else h=r("fontFamily",n,e,i,t),u=r("fontSize",n,e,i,t),d=r("fontWeight",n,e,i,t),c=r("fontStyle",n,e,i,t),g=r("fontVariant",n,e,i,t);const f=r("textAlign",n,e,i,t),p=r("textBaseline",n,e,i,t),m=r("color",n,e,i,t),v=r("strokeColor",n,e,i,t),b=r("lineHeight",n,e,i,t),y=r("underline",n,e,i,t),C=r("underlineDash",n,e,i,t),w=r("underlineOffset",n,e,i,t),_=r("lineThrough",n,e,i,t),A=Math.max(1,Math.floor(u/10)),x=r("textOverflow",n,e,i,t),S=r("borderColor",n,e,i,t),T=r("borderLineWidth",n,e,i,t),M=r("borderLineDash",n,e,i,t),R=r("marked",n,e,i,t),E=r("cursor",n,e,i,t),P=!(s&&a&&l&&f&&p&&m&&x&&S&&T&&M&&typeof y=="boolean"&&typeof _=="boolean"&&typeof R=="boolean");if(!o)return{hasFunctionPros:P};const B={text:{fontFamily:h,fontSize:u,fontWeight:d,fontStyle:c,fontVariant:g,fill:m,stroke:v!=null&&v,textAlign:f,textBaseline:p,lineHeight:b??u,underline:y?A:void 0,underlineDash:C,underlineOffset:w,lineThrough:_?A:void 0,ellipsis:x==="clip"?"":x==="ellipsis"?"...":$(x)?x:void 0},group:{fill:a,lineDash:M,lineWidth:T,stroke:S,cursor:E==="auto"||E==="default"?void 0:E},_vtable:{padding:s,marked:R}};if(Array.isArray(T)&&(B.group.strokeArrayWidth=Kt(T)),Array.isArray(S)){const k=Kt(S);B.group.stroke=!k.every((L=>!L))&&k,B.group.strokeArrayColor=Kt(S)}return{theme:B,hasFunctionPros:P}}function Dv(n,t,e){const i=e.theme.frameStyle.cornerRadius;if(e.theme.cellInnerBorder){if(Array.isArray(i)){const r=[0,0,0,0];return n===0&&t===0&&(r[0]=i[0]),n===e.colCount-1&&t===0&&(r[1]=i[1]),n===0&&t===e.rowCount-1&&(r[3]=i[3]),n===e.colCount-1&&t===e.rowCount-1&&(r[2]=i[2]),r}if(i){const r=[0,0,0,0];return n===0&&t===0&&(r[0]=i),n===e.colCount-1&&t===0&&(r[1]=i),n===0&&t===e.rowCount-1&&(r[3]=i),n===e.colCount-1&&t===e.rowCount-1&&(r[2]=i),r}}return 0}function wf(n){for(let t=0;t<n.internalProps.columns.length;t++){const e=n.internalProps.columns[t];if(!e.aggregation){if(n.options.aggregation){let i;if(i=typeof n.options.aggregation=="function"?n.options.aggregation({col:t,field:e.field}):n.options.aggregation,i)if(Array.isArray(i)){const r=[];i.forEach((o=>{r.push(Object.assign({showOnTop:!1},o))})),e.aggregation=r}else e.aggregation=Object.assign({showOnTop:!1},i)}}}}function $2(n){for(let t=0;t<n.length;t++)if(n[t].aggregation)return!0;return!1}function Vst(n){if(n.options.widthMode==="autoWidth"||n.options.defaultHeaderColWidth==="auto"||Array.isArray(n.options.defaultHeaderColWidth)&&n.options.defaultHeaderColWidth.includes("auto"))return!0;const t=n.internalProps.layoutMap.columnObjects;for(let e=0;e<t.length;e++)if(t[e].width==="auto")return!0;return!1}let xd,Sd,Kw,Zw,ja,Va,Jw,DD,FD,zD,ND,Ga,$a,WD,jD,Qw,t1,VD,GD,e1,i1,Ua,Xa,n1;function xf(n){var t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x;xd=(t=n?.sort_color)!==null&&t!==void 0?t:"#282F38",Sd=(e=n?.sort_color_opacity)!==null&&e!==void 0?e:"0.35",Kw=(i=n?.sort_color_2)!==null&&i!==void 0?i:"#416EFF",Zw=(r=n?.sort_color_opacity_2)!==null&&r!==void 0?r:"1",ja=(o=n?.sort_size)!==null&&o!==void 0?o:16,Va=(s=n?.sort_size_2)!==null&&s!==void 0?s:22,Jw=(a=n?.frozen_color)!==null&&a!==void 0?a:"#282F38",DD=(l=n?.frozen_color_opacity)!==null&&l!==void 0?l:"0.35",FD=(h=n?.frozen_color_opacity)!==null&&h!==void 0?h:"0.2",zD=(u=n?.frozen_color_2)!==null&&u!==void 0?u:"#416EFF",ND=(d=n?.frozen_color_opacity_2)!==null&&d!==void 0?d:"1",Ga=(c=n?.frozen_size)!==null&&c!==void 0?c:22,$a=(g=n?.frozen_size_2)!==null&&g!==void 0?g:22,WD=(f=n?.collapse_color)!==null&&f!==void 0?f:"#141414",jD=(p=n?.collapse_color_opacity)!==null&&p!==void 0?p:"0.65",Qw=(m=n?.collapse_size)!==null&&m!==void 0?m:16,t1=(v=n?.frozen_size_2)!==null&&v!==void 0?v:22,VD=(b=n?.expand_color)!==null&&b!==void 0?b:"#141414",GD=(y=n?.expand_color_opacity)!==null&&y!==void 0?y:"0.65",e1=(C=n?.expand_size)!==null&&C!==void 0?C:16,i1=(w=n?.expand_size_2)!==null&&w!==void 0?w:22,Ua=(_=n?.dragReorder_color)!==null&&_!==void 0?_:"#666666",Xa=(A=n?.dragReorder_color_opacity)!==null&&A!==void 0?A:"1",n1=(x=n?.dragReorder_size)!==null&&x!==void 0?x:20}const Gst={get sort_downward(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${Kw}"  fill-opacity="${Zw}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${xd}" fill-opacity="${Sd}"/></svg> `,width:ja,height:ja,funcType:me.sort,name:"sort_downward",positionType:pe.contentRight,marginLeft:3,hover:{width:Va,height:Va,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get sort_upward(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${xd}"  fill-opacity="${Sd}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${Kw}"  fill-opacity="${Zw}"/> </svg>`,width:ja,height:ja,funcType:me.sort,positionType:pe.contentRight,name:"sort_upward",marginLeft:3,hover:{width:Va,height:Va,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get sort_normal(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${xd}" fill-opacity="${Sd}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${xd}" fill-opacity="${Sd}"/></svg> `,width:ja,height:ja,funcType:me.sort,positionType:pe.contentRight,name:"sort_normal",marginLeft:3,hover:{width:Va,height:Va,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get freeze(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path d="M17.1313 8.42047C17.1932 8.48238 17.2423 8.55587 17.2759 8.63676C17.3094 8.71764 17.3266 8.80434 17.3266 8.89189C17.3266 8.97944 17.3094 9.06613 17.2759 9.14702C17.2423 9.2279 17.1932 9.3014 17.1313 9.3633L13.3843 13.1103C13.7007 14.3048 13.5305 15.4443 12.8388 16.2395C12.8104 16.2781 12.7778 16.3136 12.7417 16.3451L12.712 16.3755C12.6501 16.4374 12.5766 16.4865 12.4957 16.52C12.4148 16.5535 12.3281 16.5707 12.2406 16.5707C12.153 16.5707 12.0663 16.5535 11.9854 16.52C11.9046 16.4865 11.8311 16.4374 11.7692 16.3755L9.17633 13.7826L6.05316 16.9058L5.11983 17.0925C5.09291 17.0979 5.06508 17.0965 5.03881 17.0886C5.01254 17.0806 4.98863 17.0663 4.96923 17.0469C4.94982 17.0275 4.9355 17.0036 4.92755 16.9773C4.9196 16.951 4.91827 16.9232 4.92366 16.8963L5.11033 15.963L8.23333 12.8396L5.64066 10.2471C5.57875 10.1852 5.52964 10.1117 5.49614 10.0309C5.46263 9.94997 5.44539 9.86327 5.44539 9.77572C5.44539 9.68817 5.46263 9.60148 5.49614 9.52059C5.52964 9.43971 5.57875 9.36621 5.64066 9.3043C5.65066 9.2943 5.66066 9.2843 5.67099 9.27464C5.70266 9.2383 5.73833 9.20547 5.77766 9.17664C6.57283 8.48564 7.71199 8.31564 8.90599 8.63197L12.6528 4.88497C12.7147 4.82306 12.7882 4.77395 12.8691 4.74045C12.95 4.70694 13.0367 4.6897 13.1242 4.6897C13.2118 4.6897 13.2985 4.70694 13.3794 4.74045C13.4603 4.77395 13.5338 4.82306 13.5957 4.88497L17.1312 8.42047H17.1313ZM15.7172 8.8918L13.1243 6.29914L9.56483 9.8588C9.47574 9.94788 9.36323 10.0099 9.24034 10.0376C9.11746 10.0654 8.98922 10.0578 8.87049 10.0156C8.22783 9.78764 7.63899 9.7553 7.17749 9.89814L12.1182 14.8388C12.261 14.3771 12.2287 13.7885 12.0007 13.146C11.9585 13.0272 11.9509 12.899 11.9787 12.7761C12.0064 12.6532 12.0684 12.5407 12.1575 12.4516L15.7172 8.89164V8.8918Z" fill="${Jw}" fill-opacity="${FD}"/></g><defs><clipPath id="clip0"><rect width="22" height="22" fill="white"/></clipPath></defs></svg>`,width:Ga,height:Ga,name:"freeze",funcType:me.frozen,positionType:pe.right,marginRight:0,hover:{width:$a,height:$a,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get frozen(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.49975 3.66663C8.32294 3.66663 8.15337 3.73686 8.02835 3.86189C7.90332 3.98691 7.83309 4.15648 7.83309 4.33329V9.63246C6.76475 10.2533 6.07942 11.1795 6.00625 12.2308C5.99892 12.2786 5.99692 12.3268 6.00009 12.3741L5.99975 12.4166C5.99975 12.5934 6.06999 12.763 6.19501 12.888C6.32004 13.0131 6.48961 13.0833 6.66642 13.0833H10.3333L10.3331 17.5L10.8611 18.292C10.8763 18.3148 10.8969 18.3335 10.9211 18.3464C10.9453 18.3594 10.9723 18.3662 10.9998 18.3662C11.0272 18.3662 11.0542 18.3594 11.0784 18.3464C11.1026 18.3335 11.1232 18.3148 11.1384 18.292L11.6664 17.5L11.6666 13.0833H15.3331C15.5099 13.0833 15.6795 13.0131 15.8045 12.888C15.9295 12.763 15.9998 12.5934 15.9998 12.4166C15.9998 12.4025 15.9998 12.3883 15.9994 12.3741C16.0028 12.3263 16.0008 12.2776 15.9933 12.2295C15.9196 11.1786 15.2343 10.2528 14.1664 9.63229V4.33329C14.1664 4.15648 14.0962 3.98691 13.9712 3.86189C13.8461 3.73686 13.6766 3.66663 13.4998 3.66663H8.49975Z" fill="${Jw}" fill-opacity="${DD}"/></svg>`,width:Ga,height:Ga,name:"frozen",funcType:me.frozen,positionType:pe.right,marginRight:0,hover:{width:$a,height:$a,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get frozenCurrent(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.49975 3.66663C8.32294 3.66663 8.15337 3.73686 8.02835 3.86189C7.90332 3.98691 7.83309 4.15648 7.83309 4.33329V9.63246C6.76475 10.2533 6.07942 11.1795 6.00625 12.2308C5.99892 12.2786 5.99692 12.3268 6.00009 12.3741L5.99975 12.4166C5.99975 12.5934 6.06999 12.763 6.19501 12.888C6.32004 13.0131 6.48961 13.0833 6.66642 13.0833H10.3333L10.3331 17.5L10.8611 18.292C10.8763 18.3148 10.8969 18.3335 10.9211 18.3464C10.9453 18.3594 10.9723 18.3662 10.9998 18.3662C11.0272 18.3662 11.0542 18.3594 11.0784 18.3464C11.1026 18.3335 11.1232 18.3148 11.1384 18.292L11.6664 17.5L11.6666 13.0833H15.3331C15.5099 13.0833 15.6795 13.0131 15.8045 12.888C15.9295 12.763 15.9998 12.5934 15.9998 12.4166C15.9998 12.4025 15.9998 12.3883 15.9994 12.3741C16.0028 12.3263 16.0008 12.2776 15.9933 12.2295C15.9196 11.1786 15.2343 10.2528 14.1664 9.63229V4.33329C14.1664 4.15648 14.0962 3.98691 13.9712 3.86189C13.8461 3.73686 13.6766 3.66663 13.4998 3.66663H8.49975Z"  fill="${zD}" fill-opacity="${ND}"/></svg>`,width:Ga,height:Ga,funcType:me.frozen,positionType:pe.right,name:"frozenCurrent",marginRight:0,hover:{width:$a,height:$a,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get dropdownIcon(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><rect x="2" y="1" width="20" height="20" rx="10" fill="white"/><rect x="2.5" y="1.5" width="19" height="19" rx="9.5" stroke="#959DA5"/></g><path d="M14.9492 9.39531C15.0086 9.31911 15.0165 9.21887 14.9698 9.1356C14.923 9.05234 14.8294 9 14.7273 9L9.27273 9C9.17057 9 9.07697 9.05234 9.03023 9.1356C8.98348 9.21887 8.99142 9.31911 9.0508 9.39531L11.7781 12.8953C11.8293 12.961 11.9119 13 12 13C12.0881 13 12.1707 12.961 12.2219 12.8953L14.9492 9.39531Z" fill="#4F5965"/></svg>',width:24,height:24,funcType:me.dropDown,positionType:pe.absoluteRight,name:"dropdownIcon",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)",image:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><rect x="2" y="1" width="20" height="20" rx="10" fill="#1E54C9"/><rect x="2.5" y="1.5" width="19" height="19" rx="9.5" stroke="#141414" stroke-opacity="0.2"/></g><path d="M14.9492 9.39531C15.0086 9.31911 15.0165 9.21887 14.9698 9.1356C14.923 9.05234 14.8294 9 14.7273 9L9.27273 9C9.17057 9 9.07697 9.05234 9.03023 9.1356C8.98348 9.21887 8.99142 9.31911 9.0508 9.39531L11.7781 12.8953C11.8293 12.961 11.9119 13 12 13C12.0881 13 12.1707 12.961 12.2219 12.8953L14.9492 9.39531Z" fill="white"/></svg>'},cursor:"pointer",visibleTime:"mouseenter_cell"}},get play(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="48" height="48" fill="white" fill-opacity="0.01" /><path d="M24 44C35.0457 44 44 35.0457 44 24C44 12.9543 35.0457 4 24 4C12.9543 4 4 12.9543 4 24C4 35.0457 12.9543 44 24 44Z" fill="none" stroke="#686a6e" stroke-width="4" stroke-linejoin="round" stroke-opacity="0.7" /><path d="M20 24V17.0718L26 20.5359L32 24L26 27.4641L20 30.9282V24Z" fill="none" stroke="#686a6e" stroke-width="4" stroke-linejoin="round" stroke-opacity="0.7" /></svg>',width:24,height:24,funcType:me.play,positionType:pe.right,name:"play",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get damage_pic(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 10V38C5 39.1046 5.89543 40 7 40H14H18L15 29L22 27L21 20L29 16L27 13L30 8H7C5.89543 8 5 8.89543 5 10Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M43 38V10C43 8.89543 42.1046 8 41 8H38L34 14L37 19L28 23L29 31L22 33L24 40H41C42.1046 40 43 39.1046 43 38Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path fill-rule="evenodd" clip-rule="evenodd" d="M14.5 18C15.3284 18 16 17.3284 16 16.5C16 15.6716 15.3284 15 14.5 15C13.6716 15 13 15.6716 13 16.5C13 17.3284 13.6716 18 14.5 18Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>',width:24,height:24,funcType:me.damagePic,positionType:pe.left,name:"damage_pic",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get loading_pic(){return{type:"svg",svg:'<svg viewBox="0 0 400 300" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="a" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="50" y="65" width="301" height="170"><path d="M350.3 65H50v169.8h300.3V65Z" fill="#fff"/></mask><g mask="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M58.3 233.2h32.8v-36.8H58.3v36.8Z" fill="#C7DEFF"/><path d="M91.1 224.5v8.8H58.3M82.4 196.2H58.3" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M305.4 182.5s-2.7 12.6 0 17.4c2.7 4.8 8.3 6.7 12.4 4.4 4.2-2.4 5.3-8.1 2.6-12.9-2.7-4.8-15-8.9-15-8.9ZM336 204.7c4.3 2 9.7-.4 12-5.4 2.3-5-1.5-17.3-1.5-17.3s-11.8 5.1-14.1 10.1c-2.3 5-.7 10.6 3.6 12.6Z" fill="#00E4E5"/><path fill-rule="evenodd" clip-rule="evenodd" d="M326.7 174s-10 11.8-10 18.6c0 6.7 4.5 12.2 10 12.2s10-5.5 10-12.3c0-6.8-10-18.5-10-18.5Z" fill="#00E4E5"/><path d="M332.3 181.5c2.3 3.6 4.4 7.8 4.4 10.9M316.7 192.5c0-3.1 2.1-7.2 4.3-10.8" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M343.1 227.3v-9.7h-34v9.7c0 3.7 3 6.6 6.6 6.6h20.9c3.6 0 6.5-2.9 6.5-6.6Z" fill="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M350.4 220.8V198H302v22.8c0 5.9 4.8 10.7 10.7 10.7h26.9c5.9 0 10.7-4.8 10.8-10.7Z" fill="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M331.7 74.2H117.8L87.4 203h213.8l30.5-128.8Z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M337 74.2h-6.2l-30.6 129.2h6.2L337 74.2Z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M303.8 203.5h2.4l30.7-129.3h-1.8l-31.3 129.3Z" fill="#C7DEFF"/><path d="m337 74.2-30.6 129.2h-5.9" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M229.9 202.1h-47.6l2 9.6h47.3l-1.7-9.6Z" fill="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M94.7 172.6 87.4 203h213.1l7.8-30.4H94.7Z" fill="#006EFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M94.7 172.6 87.4 203h213.1l7.8-30.4H94.7Z" fill="#006EFF"/><path d="M138.5 74.2h193.2l-23.4 98.6M94.5 172.7l11-46.3M104.8 155.4l-2.3 11.5h6.7M316 112.1l1.1-4.5" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M148.3 138.1h97V119h-97v19.1Z" fill="#00E4E5"/><path d="M303.1 80.6h20.3l-4.6 19.6M228.3 234.3c3.6 0 6.3-3.2 5.7-6.8l-4.1-24.1" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M226.2 229.5h-68.9v1.2c0 2 1.6 3.7 3.7 3.7h60.1c2.8 0 5-2.2 5.1-4.9Z" fill="#C7DEFF"/><path d="M180.699 226.8h-19.9c-2.8 0-4.6 3-3.3 5.5m0 0c.6 1.2 1.9 2 3.3 2h57.8M175.9 203.4l3.6 17.6M241.2 234.3h65.1M104.6 234.3h41.3" stroke="#071F4D"/><path d="M206.2 234.3h14.9c3.1 0 5.5-2.8 5-5.9l-4.3-24.9M160.7 226.8h46M62.2 226.1h-9.5c-1.2 0-2.2-1-2.2-2.2v-18.3c0-1.2 1-2.2 2.2-2.2h9.5" stroke="#071F4D"/><path d="M53.4 171.7H68c2.1 0 3.7 1.7 3.7 3.7v16.1M79.1 192v-21.8c0-2.5 2-4.6 4.6-4.6h2.2c2.5 0 4.5-2 4.5-4.5m0 0c0-2.5-2-4.5-4.5-4.5H56.1c-2.4 0-4.3-1.9-4.3-4.3V148M71.2 165.2h-18M64 181.7v10.1" stroke="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M85.7 120H124c4.3 0 7.7-3.5 7.7-7.7V65.5H94.2c-4.7 0-8.5 4.9-8.5 11V120Z" fill="#C7DEFF"/><path d="M85.7 110.7V73c0-4.1 3.4-7.5 7.5-7.5h38.5M146.2 73.8v-2.5c0-3.2-2-5.8-5.8-5.8-2.8 0-6 1.1-6 5.8v42.4c0 4.7-3.8 8.5-8.5 8.5h-15.6" stroke="#071F4D"/><path d="M119.7 122.3H87c-6.1 0-11.1-5-11.1-11.1m0 0h39M126.1 122.3c-6.1 0-11.1-5-11.1-11.1" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M85.4 122.1h37.2c-6.5-1.8-8-10.5-8-10.5H76.2c.6 8.8 9.2 10.5 9.2 10.5Z" fill="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M95.8 102.9h4.8V83.6h-4.8v19.3ZM106.6 102.9h4.8V77.6h-4.8v25.3ZM117.3 102.9h4.8V89.1h-4.8v13.8Z" fill="#fff"/><path d="M273.2 195.9h16.9M261.2 195.9h5" stroke="#fff"/><path d="M62.4 201.9v2.9M62.4 224.5v2.9" stroke="#071F4D"/><path d="m153.6 138.1 9.7-19.1M168.8 138.1l9.7-19.1M184.1 138.1l9.7-19.1M199.4 138.1l9.7-19.1M214.6 138.1l9.8-19.1M229.9 138.1l9.7-19.1" stroke="#fff"/><path d="M148.3 138.1h121.6V119H148.3v19.1Z" stroke="#071F4D"/></g></svg>',width:400,height:300,name:"loading_pic",positionType:pe.left}},get expand(){return{type:"svg",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
      <path d="M4.64988 6.81235C4.38797 6.48497 4.62106 6 5.04031 6L10.9597 6C11.3789 6 11.612 6.48497 11.3501 6.81235L8.39043 10.512C8.19027 10.7622 7.80973 10.7622 7.60957 10.512L4.64988 6.81235Z" fill="${VD}" fill-opacity="${GD}"/>
      </svg>`,width:e1,height:e1,funcType:me.expand,name:"expand",positionType:pe.contentLeft,marginLeft:0,marginRight:4,hover:{width:i1,height:i1,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get collapse(){return{type:"svg",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
      <path d="M5.81235 11.3501C5.48497 11.612 5 11.3789 5 10.9597L5 5.04031C5 4.62106 5.48497 4.38797 5.81235 4.64988L9.51196 7.60957C9.76216 7.80973 9.76216 8.19027 9.51196 8.39044L5.81235 11.3501Z"  fill="${WD}" fill-opacity="${jD}"/>
      </svg>`,width:Qw,height:Qw,funcType:me.collapse,name:"collapse",positionType:pe.contentLeft,marginLeft:0,marginRight:4,hover:{width:t1,height:t1,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get drillDown(){return{name:"drillDown",type:"svg",positionType:pe.absolute,funcType:me.drillDown,svg:lot,width:13,height:13,cursor:"pointer"}},get drillUp(){return{name:"drillUp",type:"svg",positionType:pe.absolute,funcType:me.drillUp,svg:hot,width:13,height:13,cursor:"pointer"}},get dragReorder(){return{type:"svg",svg:`<svg t="1710129136961" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5166" width="200" height="200"><path d="M362.666667 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${Ua}"  fill-opacity="${Xa}" p-id="5167"></path><path d="M661.333333 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${Ua}"  fill-opacity="${Xa}" p-id="5168"></path><path d="M362.666667 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${Ua}"  fill-opacity="${Xa}" p-id="5169"></path><path d="M661.333333 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${Ua}"  fill-opacity="${Xa}" p-id="5170"></path><path d="M362.666667 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${Ua}"  fill-opacity="${Xa}" p-id="5171"></path><path d="M661.333333 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${Ua}"  fill-opacity="${Xa}" p-id="5172"></path></svg>`,width:n1,height:n1,funcType:me.dragReorder,positionType:pe.left,name:"dragReorder",marginLeft:-10,marginRight:10,cursor:"grab"}}},$st={};function Fr(){return vg(Gst,$st)}class Wl extends zo{constructor(t){super(t),this.failCallback=()=>{const e=Fr(),{svg:i,src:r}=e.damage_pic||{},o=i||r;o&&(super.image=o)},this.attribute.visibleTime!=="mouseenter_cell"&&this.attribute.visibleTime!=="click_cell"||(this.attribute.opacity=0),this.attribute.hoverImage&&(this.attribute.originImage=this.attribute.image),this.attribute.isGif&&this.attribute.gif&&this.loadGif()}loadGif(){this.playing=!1,Se.GetFile(this.attribute.gif+`?role=gif&radom=${Math.random()}`,"arrayBuffer").then((t=>{const e=NR.parseGIF(t),i=NR.decompressFrames(e,!0);this.renderGIF(i),this.resources.set(this.attribute.image,{state:"success",data:this.gifCanvas})})).catch((t=>{}))}get backgroundWidth(){var t,e;return(e=(t=this.attribute.backgroundWidth)!==null&&t!==void 0?t:this.attribute.width)!==null&&e!==void 0?e:0}get backgroundHeight(){var t,e;return(e=(t=this.attribute.backgroundHeight)!==null&&t!==void 0?t:this.attribute.height)!==null&&e!==void 0?e:0}renderGIF(t){this.loadedFrames=t,this.frameIndex=0,this.tempCanvas||(this.tempCanvas=document.createElement("canvas"),this.tempCtx=this.tempCanvas.getContext("2d")),this.gifCanvas||(this.gifCanvas=document.createElement("canvas"),this.gifCtx=this.gifCanvas.getContext("2d")),this.gifCanvas.width=t[0].dims.width,this.gifCanvas.height=t[0].dims.height,this.playing=!0,this.lastTime=new Date().getTime(),this.animate().to({},1e3,"linear").loop(1/0)}renderFrame(t,e,i){const r=this.loadedFrames[this.frameIndex||0];r.disposalType===2&&this.gifCtx.clearRect(0,0,this.gifCanvas.width,this.gifCanvas.height),this.drawPatch(r),this.manipulate(t,e,i);const o=new Date().getTime()-this.lastTime;r.delay<o&&(this.frameIndex++,this.lastTime=new Date().getTime()),this.frameIndex>=this.loadedFrames.length&&(this.frameIndex=0)}drawPatch(t){const e=t.dims;this.frameImageData&&e.width===this.frameImageData.width&&e.height===this.frameImageData.height||(this.tempCanvas.width=e.width,this.tempCanvas.height=e.height,this.frameImageData=this.tempCtx.createImageData(e.width,e.height)),this.frameImageData.data.set(t.patch),this.tempCtx.putImageData(this.frameImageData,0,0),this.gifCtx.drawImage(this.tempCanvas,e.left,e.top)}manipulate(t,e,i){t.drawImage(this.gifCanvas,0,0,this.gifCanvas.width,this.gifCanvas.height,e,i,this.attribute.width,this.attribute.height)}setAttribute(t,e,i,r){super.setAttribute(t,e,i,r),t==="gif"&&this.loadGif()}setAttributes(t,e,i){super.setAttributes(t,e,i),t.gif&&this.loadGif()}}class $D extends Oe{constructor(t){var e,i,r,o,s;t.fill=(e=t.fill)!==null&&e!==void 0?e:"#00F",t.fontSize=(i=t.fontSize)!==null&&i!==void 0?i:12,t.underline=(r=t.underline)!==null&&r!==void 0?r:1,t.textBaseline=(o=t.textBaseline)!==null&&o!==void 0?o:"top",t.cursor=(s=t.cursor)!==null&&s!==void 0?s:"pointer",super(t)}}function jc(n){return{rootContainer:new Jt({}),renderDefault:!0}}class Ust{constructor(t){this.table=t,this.customLayoutFuncCache=new Map,this.reactRemoveGraphicCache=new Map,this.reactRemoveAllGraphicCache=new Map,this.headerCustomLayoutFuncCache=new Map,this.headerReactRemoveGraphicCache=new Map,this.headerReactRemoveAllGraphicCache=new Map}hasReactCreateGraphic(t,e){return e?this.headerCustomLayoutFuncCache.has(t):this.customLayoutFuncCache.has(t)}setReactCreateGraphic(t,e,i){i?this.headerCustomLayoutFuncCache.set(t,e):this.customLayoutFuncCache.set(t,e)}setReactRemoveGraphic(t,e,i){i?this.headerReactRemoveGraphicCache.set(t,e):this.reactRemoveGraphicCache.set(t,e)}setReactRemoveAllGraphic(t,e,i){i?this.headerReactRemoveAllGraphicCache.set(t,e):this.reactRemoveAllGraphicCache.set(t,e)}updateCustomCell(t,e){const i=this.table;if(i.widthMode==="autoWidth"&&i.scenegraph.recalculateColWidths(),(i.isAutoRowHeight()||i.internalProps.defaultRowHeight==="auto"&&!e||i.internalProps.defaultHeaderRowHeight==="auto"&&e)&&i.scenegraph.recalculateRowHeights(),i.isPivotTable()){const r=Yst(t,i,e);for(let o=0;o<r.length;o++){const s=r[o];for(let a=s.start.col;a<=s.end.col;a++)for(let l=s.start.row;l<=s.end.row;l++)i.scenegraph.updateCellContent(a,l)}}else{const r=Xst(t,i,e);for(let o=r.start.col;o<=r.end.col;o++)for(let s=r.start.row;s<=r.end.row;s++)i.scenegraph.updateCellContent(o,s)}i.scenegraph.renderSceneGraph()}getCustomLayoutFunc(t,e){var i;if(this.table.isHeader(t,e)){const{componentId:o}=this.table.getHeaderDefine(t,e);return(i=this.headerCustomLayoutFuncCache.get(o))!==null&&i!==void 0?i:jc}const{componentId:r}=this.table.getBodyColumnDefine(t,e);return this.customLayoutFuncCache.get(r)||jc}removeCustomCell(t,e){let i;if(this.table.isHeader(t,e)){const r=this.table.getHeaderDefine(t,e),{componentId:o}=r;i=this.headerReactRemoveGraphicCache.get(o)}else{const r=this.table.getBodyColumnDefine(t,e),{componentId:o}=r;i=this.reactRemoveGraphicCache.get(o)}i&&i(t,e)}clearCache(){this.reactRemoveAllGraphicCache.forEach((t=>{t()})),this.headerReactRemoveAllGraphicCache.forEach((t=>{t()}))}updateAllCustomCell(){this.customLayoutFuncCache.forEach(((t,e)=>{this.updateCustomCell(e)})),this.headerCustomLayoutFuncCache.forEach(((t,e)=>{this.updateCustomCell(e,!0)}))}}function Xst(n,t,e){const i=t.internalProps.rowSeriesNumber?1:0;if(e){const o=t.internalProps.layoutMap,{headerObjects:s}=t.internalProps.layoutMap;let a;for(let h=0;h<s.length;h++){const u=s[h];if(u.define.componentId===n){a=u.id;break}}const l=o.getHeaderCellAdressById(a);return o.getCellRange(l.col,l.row)}const{columnObjects:r}=t.internalProps.layoutMap;for(let o=0;o<r.length;o++)if(r[o].define.componentId===n)return{start:{col:i+o,row:t.columnHeaderLevelCount},end:{col:i+o,row:t.rowCount-1}};return{start:{col:0,row:0},end:{col:t.colCount-1,row:t.rowCount-1}}}function Yst(n,t,e){const i=t.internalProps.rowSeriesNumber?1:0,r=[],o=t.internalProps.layoutMap;if(e){const{headerObjects:s}=o,a=[];for(let l=0;l<s.length;l++){const h=s[l];h&&h.define.componentId===n&&a.push(h.id)}for(let l=0;l<a.length;l++){const h=a[l],u=o.getHeaderCellAdressById(h),d=o.getCellRange(u.col,u.row);r.push(d)}}else{let s;const{columnObjects:a,indicatorsAsCol:l}=o;for(let h=0;h<a.length;h++)if(a[h].define.componentId===n){s=h;break}if(l)for(let h=o.rowHeaderLevelCount+s;h<o.colCount;h+=a.length){const u={start:{col:h+i,row:o.columnHeaderLevelCount},end:{col:h+i,row:o.rowCount-1}};r.push(u)}else for(let h=o.columnHeaderLevelCount+s;h<o.rowCount;h+=a.length){const u={start:{col:o.rowHeaderLevelCount+i,row:h},end:{col:o.colCount-1,row:h}};r.push(u)}}return r}function Si(n){const t={abstractPos:{x:n.viewport.x,y:n.viewport.y}},e=jl(n.target);return e&&(t.eventArgs={col:e.col,row:e.row,event:n,targetCell:e,mergeInfo:qst(e),target:n.target}),t}function jl(n){for(;n&&n.parent;){if(n.role==="cell")return n;n=n.parent}return null}function qst(n){if($(n.mergeStartCol)&&$(n.mergeStartRow)&&$(n.mergeEndCol)&&$(n.mergeEndRow))return{colStart:n.mergeStartCol,colEnd:n.mergeEndCol,rowStart:n.mergeStartRow,rowEnd:n.mergeEndRow}}const Kst=/radio-\d+-\d+-(\d+)/,UD="_custom_",ho="custom-container",V0=UD+"_0";function _a(n,t,e,i,r,o,s,a,l,h,u){var d,c,g;let f,p,m,v=!0,b=!1;if(n==="react-custom-layout"&&(n=((d=u.reactCustomLayout)===null||d===void 0?void 0:d.getCustomLayoutFunc(e,i))||jc),typeof n=="function"){const y=n({col:(c=h?.start.col)!==null&&c!==void 0?c:e,row:(g=h?.start.row)!==null&&g!==void 0?g:i,dataValue:u.getCellOriginValue(e,i),value:u.getCellValue(e,i)||"",rect:{left:0,top:0,right:r,bottom:o,width:r,height:o},table:u,originCol:e,originRow:i});if(!y)return{renderDefault:!0};y.rootContainer&&(y.rootContainer=Vc(y.rootContainer,u.animationManager.timeline)),y.rootContainer instanceof Jt&&(m=y.rootContainer,m.name=ho,m.col=e,m.row=i),v=y.renderDefault,b=y.enableCellPadding}else if(typeof t=="function"){const y=t({col:e,row:i,dataValue:u.getCellOriginValue(e,i),value:u.getCellValue(e,i)||"",rect:{left:0,top:0,right:r,bottom:o,width:r,height:o},table:u});y&&(p=y.elements,v=y.renderDefault,y.expectedWidth,f=y.expectedHeight)}else t&&(t.expectedWidth,f=t.expectedHeight,p=t.elements,v=t.renderDefault);return p&&(m=Zst(p,r,a?f:o,u.getCellValue(e,i))),b&&m.setAttributes({x:l[3],y:l[0],width:r-l[1]-l[3],height:o-l[0]-l[2]}),Fv(m,r,o),!h||h.start.col===h.end.col&&h.start.row===h.end.row||XD(m,e,i,0),{elementsGroup:m,renderDefault:v}}function Zst(n,t,e,i){const r=new Jt({x:0,y:0,width:t,height:e,fill:!1,stroke:!1,pickable:!1});return r.name=ho,Jst(n,t,e,i).forEach((o=>{var s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x,S,T,M,R,E,P,B,k,L;switch(o.clickable&&(o.pickable=o.clickable),o.type){case"arc":const O=Dp({x:o.x,y:o.y,dx:(s=o.dx)!==null&&s!==void 0?s:0,dy:(a=o.dy)!==null&&a!==void 0?a:0,fill:o.fill,stroke:o.stroke,outerRadius:o.radius,startAngle:o.startAngle,endAngle:o.endAngle,pickable:!!o.pickable,cursor:o.cursor});O.name=o.name,r.appendChild(O);break;case"text":if(o.background){const j=(h=(l=o.background)===null||l===void 0?void 0:l.expandX)!==null&&h!==void 0?h:0,X=(d=(u=o.background)===null||u===void 0?void 0:u.expandY)!==null&&d!==void 0?d:0,Z=be({x:o.x-j,y:o.y-X,dx:(c=o.dx)!==null&&c!==void 0?c:0,dy:(g=o.dy)!==null&&g!==void 0?g:0,width:o.width+2*j,height:o.height+2*X,cornerRadius:(p=(f=o.background)===null||f===void 0?void 0:f.cornerRadius)!==null&&p!==void 0?p:0,fill:(v=(m=o.background)===null||m===void 0?void 0:m.fill)!==null&&v!==void 0?v:"#888"});r.appendChild(Z)}const I=new Oe(Object.assign({pickable:!!o.pickable,fill:(b=o.color)!==null&&b!==void 0?b:o.fill},o));I.name=o.name,r.appendChild(I);break;case"rect":const H=be({x:o.x,y:o.y,dx:(y=o.dx)!==null&&y!==void 0?y:0,dy:(C=o.dy)!==null&&C!==void 0?C:0,width:o.width,height:o.height,cornerRadius:o.radius,fill:o.fill,stroke:o.stroke,pickable:!!o.pickable,cursor:o.cursor});H.name=o.name,r.appendChild(H);break;case"circle":const D=LI({x:o.x,y:o.y,dx:(w=o.dx)!==null&&w!==void 0?w:0,dy:(_=o.dy)!==null&&_!==void 0?_:0,radius:o.radius,fill:o.fill,stroke:o.stroke,pickable:!!o.pickable,cursor:o.cursor});D.name=o.name,r.appendChild(D);break;case"icon":const z=new Wl({x:o.x,y:o.y,dx:(A=o.dx)!==null&&A!==void 0?A:0,dy:(x=o.dy)!==null&&x!==void 0?x:0,width:o.width,height:o.height,image:o.svg,backgroundWidth:o.hover?(S=o.hover.width)!==null&&S!==void 0?S:o.width:void 0,backgroundHeight:o.hover?(T=o.hover.width)!==null&&T!==void 0?T:o.width:void 0,backgroundColor:o.hover?(M=o.hover.bgColor)!==null&&M!==void 0?M:"rgba(22,44,66,0.2)":void 0,pickable:!!o.pickable,cursor:o.cursor});z.name=o.name,z.role="icon-custom",r.appendChild(z);break;case"image":const G=new Wl({x:o.x,y:o.y,dx:(R=o.dx)!==null&&R!==void 0?R:0,dy:(E=o.dy)!==null&&E!==void 0?E:0,width:o.width,height:o.height,image:o.src,backgroundWidth:o.hover?(P=o.hover.width)!==null&&P!==void 0?P:o.width:void 0,backgroundHeight:o.hover?(B=o.hover.width)!==null&&B!==void 0?B:o.width:void 0,backgroundColor:o.hover?(k=o.hover.bgColor)!==null&&k!==void 0?k:"rgba(22,44,66,0.2)":void 0,pickable:!!o.pickable,cursor:o.cursor,shape:o.shape});G.name=o.name,G.role="image-custom",r.appendChild(G);break;case"line":const U=Ke({points:o.points,lineWidth:(L=o.lineWidth)!==null&&L!==void 0?L:1,stroke:o.stroke,pickable:!!o.pickable,cursor:o.cursor});U.name=o.name,r.appendChild(U)}})),r}function Jst(n,t,e,i){const r=[],o=[0,0,0,0];for(let s=0;s<n.length;s++){const a=n[s],l=Object.assign({},a);for(const u in l)l.hasOwnProperty(u)&&ur(l[u])&&(l[u]=l[u](i));const h=l;$(h.x)&&(h.x=Xe(h.x)?Qo(h.x,t-o[1]):Number(h.x)),$(h.y)&&(h.y=Xe(h.y)?Qo(h.y,e-o[2]):Number(h.y)),"width"in l&&(l.width=Xe(l.width)?Qo(l.width,t-o[1]):Number(l.width)),"height"in l&&(l.height=Xe(l.height)?Qo(l.height,e-o[2]):Number(l.height)),"radius"in l&&(l.radius=Xe(l.radius)?Qo(l.radius,Math.min(t-o[1],e-o[2])):Number(l.radius)),"hover"in l&&(l.hover.x=Xe(l.hover.x)?Qo(l.hover.x,t-o[1]):Number(l.hover.x),l.hover.y=Xe(l.hover.y)?Qo(l.hover.y,e-o[2]):Number(l.hover.y),l.hover.width=Xe(l.hover.width)?Qo(l.hover.width,t-o[1]):Number(l.hover.width),l.hover.height=Xe(l.hover.height)?Qo(l.hover.height,e-o[2]):Number(l.hover.height),l.hover.x+=0,l.hover.y+=0),h.x=h.x+0,h.y=h.y+0,r.push(l)}return r}function Qo(n,t){return n.endsWith("px")?parseInt(n,10):n.endsWith("%")&&t?parseInt(n,10)/100*t:parseInt(n,10)}function Fv(n,t,e){n&&n.forEachChildren((i=>{var r,o;i&&(Pi(i.attribute.width)&&i.attribute.width.percent&&i.setAttribute("width",Math.max(0,i.attribute.width.percent/100*t+((r=i.attribute.width.delta)!==null&&r!==void 0?r:0))),i.attribute.width<0&&i.setAttribute("width",0),Pi(i.attribute.height)&&i.attribute.height.percent&&i.setAttribute("height",Math.max(0,i.attribute.height.percent/100*e+((o=i.attribute.height.delta)!==null&&o!==void 0?o:0))),i.attribute.height<0&&i.setAttribute("height",0),i.type==="group"&&Fv(i,i.attribute.width,i.attribute.height))}))}function Vc(n,t){if(!n||!$(n.$$typeof)&&!$(n.vtype))return n;const e=n.type,{attribute:i,children:r,stateProxy:o,animation:s}=n.props,a=e({attribute:i});if(Qst(a,n.props),o&&(a.stateProxy=o),a.id=i.id,a.name=i.name,wt(r)?r.forEach((l=>{const h=Vc(l,t);h&&h.type&&a.add(h)})):r&&a.add(Vc(r,t)),wt(s)&&t){const l=a.animate();l.setTimeline(t),s.forEach((h=>{l[h[0]](...h.slice(1))}))}return a}function Qst(n,t){let e=!1;switch(n.type){case"richtext":case"rich/image":break;default:e=!0}e&&Object.keys(t).forEach((i=>{const r=PZ[i];r&&n.on(r,t[i])}))}function XD(n,t,e,i,r){n&&(n.name=`${UD}${r??""}_${i}`,n.onBeforeAttributeUpdate=tat,n.type==="group"&&n.childrenCount&&n.forEachChildren(((o,s)=>{XD(o,t,e,s,(r??"")+"_"+i)})))}function tat(n,t){const e=this;if(e.skipMergeUpdate)return;const i=jl(e);if(!i||!i.stage)return;const r=i.stage.table;e.skipAttributeUpdate=!0;const{mergeStartCol:o,mergeEndCol:s,mergeStartRow:a,mergeEndRow:l}=i;if($(o)&&$(s)&&$(a)&&$(l)&&(o!==s||a!==l)){for(let h=o;h<=s;h++)for(let u=a;u<=l;u++){if(h===i.col&&u===i.row)continue;const d=r.scenegraph.highPerformanceGetCell(h,u);if(d.role==="cell"){const c=d.getChildByName(e.name,!0);if(!c||c.skipAttributeUpdate)continue;for(const g in n)n[g]!==c.attribute[g]&&g!=="dx"&&g!=="dy"&&c.setAttribute(g,n[g])}}e.skipAttributeUpdate=void 0}}class Vt extends Jt{clear(){this.removeAllChild()}getChildByName(t,e){let i=null;return this.forEachChildren((r=>r.name===t&&(i=r,!0))),e&&this.forEachChildren((r=>{if(r.getChildByName){const o=r.getChildByName(t,!0);if(o)return i=o,!0}return!1})),i}get width(){var t;let e=this.AABBBounds.width();return e!==1/0&&e!==-1/0||(e=0),Math.max(e,(t=this.attribute.width)!==null&&t!==void 0?t:0)}get height(){var t;let e=this.AABBBounds.height();return e!==1/0&&e!==-1/0||(e=0),Math.max(e,(t=this.attribute.height)!==null&&t!==void 0?t:0)}setDeltaWidth(t){var e;t!==0&&(this.setAttribute("width",((e=this.attribute.width)!==null&&e!==void 0?e:0)+t),this.border&&(this.border.setAttribute("width",this.border.attribute.width+t),this.border.type==="group"&&this.border.firstChild.setAttribute("width",this.border.firstChild.attribute.width+t)))}setDeltaHeight(t){var e;t!==0&&(this.setAttribute("height",((e=this.attribute.height)!==null&&e!==void 0?e:0)+t),this.border&&(this.border.setAttribute("height",this.border.attribute.height+t),this.border.type==="group"&&this.border.firstChild.setAttribute("width",this.border.firstChild.attribute.height+t)))}setDeltaX(t){t!==0&&this.setAttribute("x",this.attribute.x+t)}setDeltaY(t){t!==0&&this.setAttribute("y",this.attribute.y+t)}forEachChildrenSkipChild(t,e="border-rect",i=!1){if(i){let r=this._lastChild,o=0;for(;r;){if(r.name!==e&&t(r,o++))return;r=r._prev}}else{let r=this._firstChild,o=0;for(;r;){if(r.name!==e&&t(r,o++))return;r=r._next}}}getColGroup(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<this.childrenCount;i++){if(e.col===t)return e;e=e._next}return null}getRowGroup(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<this.childrenCount;i++){if(e.row===t)return e;e=e._next}return null}addCellGroup(t){if(this.childrenCount===0||this.lastChild.row===t.row-1)this.addChild(t);else{let e=this._firstChild;for(let i=0;i<this.childrenCount;i++){if(e.row===t.row-1)return void this.insertAfter(t,e);e=e._next}this.addChild(t)}}getChildAt(t){const e=super.getChildAt(t);return e&&e.name==="border-rect"?e._next:e}tryUpdateAABBBounds(){if(this.role==="cell"){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;const t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),eat(this,t),e}return super.tryUpdateAABBBounds()}doUpdateAABBBounds(){if(this.role==="cell"){const t=this.attribute,{x:e,y:i,width:r,height:o}=t;return this._AABBBounds.setValue(e,i,e+r,i+o),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this.shadowRoot&&this.shadowRoot.tryUpdateAABBBounds(),this._AABBBounds}return this.role==="body"||this.role==="row-header"||this.role==="col-header"||this.role==="right-frozen"||this.role==="bottom-frozen"||this.role==="corner-header"||this.role==="corner-right-top-header"||this.role==="corner-right-bottom-header"||this.role==="corner-left-bottom-header"?(this._AABBBounds.setValue(-1/0,-1/0,1/0,1/0),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this.shadowRoot&&this.shadowRoot.tryUpdateAABBBounds(),this._AABBBounds):super.doUpdateAABBBounds()}updateColumnRowNumber(t){this.rowNumber?this.rowNumber=Math.max(this.rowNumber,t):this.rowNumber=t}updateColumnHeight(t){this.colHeight?this.colHeight+=t:this.colHeight=t}}function eat(n,t){n.stage&&n.stage.dirtyBounds&&n.stage.renderCount&&(n.isContainer&&!t||n.stage.dirty(n.globalAABBBounds))}function zv(n,t,e,i){const r=n/t;let o,s;return r>e/i?(o=e,s=o/r,(i-s)/2):(s=i,o=s*r,(e-o)/2),{width:o,height:s}}function tS(n,t,e,i,r,o,s="left",a="middle",l=[0,0,0,0],h=0,u=0,d=0,c=0){const g=n+e,f=t+i;let p=n+l[3]+h;s==="right"||s==="end"?p=g-r-l[1]-u:s==="center"&&(p=n+(e-r+h-u)/2);let m=t+l[0]+d;return a==="bottom"||a==="alphabetic"||a==="ideographic"?m=f-o-l[2]-c:a==="middle"&&(m=t+(i-o+d-c)/2),{x:p,y:m}}function YD(n,t,e,i,r){let o=!1,s=!1,a=!1,l=!1,h=!1,u=!1,d=!1,c=!1,g=!1;return n<=r.frozenColCount-1&&t<=r.frozenRowCount-1&&(u=!0),e>=r.colCount-r.rightFrozenColCount&&t<=r.frozenRowCount-1&&(d=!0),n<=r.frozenColCount-1&&i>=r.rowCount-r.bottomFrozenRowCount&&(g=!0),e>=r.colCount-r.rightFrozenColCount&&i>=r.rowCount-r.bottomFrozenRowCount&&(c=!0),n<=r.frozenColCount-1&&i>=r.frozenRowCount&&t<=r.rowCount-r.bottomFrozenRowCount-1&&(o=!0),e>=r.colCount-r.rightFrozenColCount&&i>=r.frozenRowCount&&t<=r.rowCount-r.bottomFrozenRowCount-1&&(s=!0),t<=r.frozenRowCount-1&&e>=r.frozenColCount&&n<=r.colCount-r.rightFrozenColCount-1&&(a=!0),i>=r.rowCount-r.bottomFrozenRowCount&&e>=r.frozenColCount&&n<=r.colCount-r.rightFrozenColCount-1&&(l=!0),n<=r.colCount-r.rightFrozenColCount-1&&e>=r.frozenColCount&&t<=r.rowCount-r.bottomFrozenRowCount-1&&i>=r.frozenRowCount&&(h=!0),{needRowHeader:o,needRightRowHeader:s,needColumnHeader:a,needBottomColumnHeader:l,needBody:h,needCornerHeader:u,needRightTopCornerHeader:d,needLeftBottomCornerHeader:g,needRightBottomCornerHeader:c}}function ht(n,t,e,i,r){const o=t&&$(t[n])?t[n]:void 0;return typeof o=="function"?o({col:e,row:i,table:r,value:r.getCellValue(e,i),dataValue:r.getCellOriginValue(e,i),cellHeaderPaths:r.getCellHeaderPaths(e,i)}):o}function Nv(n,t,e,i,r){const o=t&&$(t[n])?t[n]:void 0;if(typeof o=="function")return o({col:e,row:i,table:r,value:r.getCellValue(e,i),dataValue:r.getCellOriginValue(e,i),cellHeaderPaths:r.getCellHeaderPaths(e,i)})}function Xo(n,t,e,i){var r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w;let _=(o=(r=e?.group)===null||r===void 0?void 0:r.strokeArrayWidth)!==null&&o!==void 0?o:void 0;return i.theme.cellInnerBorder||!_rt(i.theme.frameStyle.borderLineWidth)||wrt(i.theme.frameStyle.borderLineWidth)||(n===0&&(_=_??[(s=e?.group)===null||s===void 0?void 0:s.lineWidth,(a=e?.group)===null||a===void 0?void 0:a.lineWidth,(l=e?.group)===null||l===void 0?void 0:l.lineWidth,(h=e?.group)===null||h===void 0?void 0:h.lineWidth],_[3]=0),n===i.colCount-1&&(_=_??[(u=e?.group)===null||u===void 0?void 0:u.lineWidth,(d=e?.group)===null||d===void 0?void 0:d.lineWidth,(c=e?.group)===null||c===void 0?void 0:c.lineWidth,(g=e?.group)===null||g===void 0?void 0:g.lineWidth],_[1]=0),t===0&&(_=_??[(f=e?.group)===null||f===void 0?void 0:f.lineWidth,(p=e?.group)===null||p===void 0?void 0:p.lineWidth,(m=e?.group)===null||m===void 0?void 0:m.lineWidth,(v=e?.group)===null||v===void 0?void 0:v.lineWidth],_[0]=0),t===i.rowCount-1&&(_=_??[(b=e?.group)===null||b===void 0?void 0:b.lineWidth,(y=e?.group)===null||y===void 0?void 0:y.lineWidth,(C=e?.group)===null||C===void 0?void 0:C.lineWidth,(w=e?.group)===null||w===void 0?void 0:w.lineWidth],_[2]=0)),_}class iat extends Vt{constructor(t){super(t),this._autoWidth=!1,this._autoHeight=!1,this._leftGroup=new Vt({pickable:!1,fill:!1,stroke:!1}),this._leftGroup.role="content-left",this._rightGroup=new Vt({pickable:!1,fill:!1,stroke:!1}),this._rightGroup.role="content-right",this._centerGroup=new Vt({pickable:!1,fill:!1,stroke:!1}),this._centerGroup.role="content-center",this.appendChild(this._leftGroup),this.appendChild(this._rightGroup),this.appendChild(this._centerGroup)}setCellContentOption(t){this._autoWidth=t.autoWidth,this._autoHeight=t.autoHeight,this._cellWidth=t.cellWidth,this._originCellWidth=t.cellWidth,this._cellHeight=t.cellHeight,this._align=t.align,this._baseline=t.baseline}addLeftOccupyingIcon(t){var e,i,r;t.setAttribute("x",this._leftGroup.width+((e=t.attribute.marginLeft)!==null&&e!==void 0?e:0)),this._leftGroup.appendChild(t),this._leftGroup.setDeltaWidth(((i=t.attribute.marginLeft)!==null&&i!==void 0?i:0)+((r=t.attribute.marginRight)!==null&&r!==void 0?r:0)+t.attribute.width)}addRightOccupyingIcon(t){var e,i,r;t.setAttribute("x",this._rightGroup.width+((e=t.attribute.marginLeft)!==null&&e!==void 0?e:0)),this._rightGroup.appendChild(t),this._rightGroup.setDeltaWidth(((i=t.attribute.marginLeft)!==null&&i!==void 0?i:0)+((r=t.attribute.marginRight)!==null&&r!==void 0?r:0)+t.attribute.width)}addContent(t){const e=this._centerGroup.lastChild;e&&t.setAttributes({x:e.attribute.x+e.AABBBounds.width()}),this._centerGroup.appendChild(t),t instanceof Oe&&(this._centerGroup.setAttribute("pickable",!1),t.setAttribute("textAlign","left"))}layout(){let t=this._leftGroup.width;t===1/0&&(t=0);let e=this._rightGroup.width;if(e===-1/0&&(e=0),this._autoWidth){const s=this._centerGroup.width;this._cellWidth=t+e+s,this.setAttribute("width",this._cellWidth)}else{const s=this._cellWidth-t-e;this.updateCenterLayout(s);const a=this._centerGroup.width;this._cellWidth=t+e+a,this.setAttribute("width",this._cellWidth)}this.updateHorizontalPos();const i=this._leftGroup.height,r=this._rightGroup.height,o=this._centerGroup.height;this._cellHeight=Math.max(i,r,o),this.setAttribute("height",this._cellHeight),this.updateVerticalPos()}updateCenterLayout(t){let e=t;this._centerGroup.forEachChildren((o=>{(o instanceof Wl||o instanceof $D)&&(e-=o.AABBBounds.width())}));const i=this._centerGroup.getChildByName("text");i instanceof ti?i.setAttribute("width",e):i instanceof Oe&&i.setAttribute("maxLineWidth",e);let r=0;this._centerGroup.forEachChildren((o=>{o.setAttribute("x",r),r+=o.AABBBounds.width()}))}updateHorizontalPos(){this._leftGroup.setAttribute("x",0),this._rightGroup.setAttribute("x",this._cellWidth-this._rightGroup.width),this._centerGroup.setAttribute("x",this._leftGroup.width),this._align==="left"||this._align==="start"?this.setAttribute("dx",0):this._align==="center"?this.setAttribute("dx",-this.attribute.width/2):this._align!=="right"&&this._align!=="end"||this.setAttribute("dx",-this.attribute.width)}updateVerticalPos(){this._baseline==="top"?(this._leftGroup.setAttribute("y",0),this._rightGroup.setAttribute("y",0),this._centerGroup.setAttribute("y",0)):this._baseline==="middle"?(this._leftGroup.forEachChildren((t=>{t.setAttribute("y",(this._leftGroup.height-t.AABBBounds.height())/2)})),this._rightGroup.forEachChildren((t=>{t.setAttribute("y",(this._rightGroup.height-t.AABBBounds.height())/2)})),this._leftGroup.setAttribute("y",this._cellHeight/2-this._leftGroup.height/2),this._rightGroup.setAttribute("y",this._cellHeight/2-this._rightGroup.height/2),this._centerGroup.setAttribute("y",this._cellHeight/2-this._centerGroup.height/2)):this._baseline==="bottom"&&(this._leftGroup.forEachChildren((t=>{t.setAttribute("y",this._leftGroup.height-t.AABBBounds.height())})),this._rightGroup.forEachChildren((t=>{t.setAttribute("y",this._rightGroup.height-t.AABBBounds.height())})),this._leftGroup.setAttribute("y",this._cellHeight-this._leftGroup.height),this._rightGroup.setAttribute("y",this._cellHeight-this._rightGroup.height),this._centerGroup.setAttribute("y",this._cellHeight-this._centerGroup.height))}updateWidth(t){this._cellWidth=t,this._originCellWidth=t,this.layout()}updateHeight(t){this._cellHeight=t,this._cellWidth=this._originCellWidth;const e=this.getChildByName("text",!0);e&&e.setAttribute("heightLimit",t),this.layout()}}function Nn(n,t,e){var i,r,o,s,a;let l=0;const h=e.internalProps.layoutMap;if(h.isHeader(n,t)){const u=h.getHeader(n,t);$(u?.hierarchyLevel)&&(l=((i=u.hierarchyLevel)!==null&&i!==void 0?i:0)*(h.rowHierarchyType==="tree"&&(r=h.rowHierarchyIndent)!==null&&r!==void 0?r:0),h.rowHierarchyTextStartAlignment&&!e.internalProps.headerHelper.getHierarchyIcon(n,t)&&(l+=e.internalProps.headerHelper.getHierarchyIconWidth()))}else if(e.internalProps.groupBy||!((o=e.getBodyColumnDefine(n,t))===null||o===void 0)&&o.tree){const u=e.dataSource.getIndexKey(e.getRecordShowIndexByCell(n,t)),d=(s=e.dataSource.getGroupLength())!==null&&s!==void 0?s:0;let c=wt(u)?u.length-1:0;d>0&&c===d&&(c=0),l=Array.isArray(u)&&e.getHierarchyState(n,t)!==Tt.none?c*((a=h.hierarchyIndent)!==null&&a!==void 0?a:0):0,h.hierarchyTextStartAlignment&&!e.internalProps.bodyHelper.getHierarchyIcon(n,t)&&(l+=e.internalProps.bodyHelper.getHierarchyIconWidth())}return l}function Gc(n,t){var e,i;let r,o=!1;for(Xe(n)&&n.length>(t.options.maxCharactersNumber||200)&&(n=n.slice(0,t.options.maxCharactersNumber||200),n+="…",o=!0),r=t.internalProps.enableLineBreak||!((e=t.options.customConfig)===null||e===void 0)&&e.multilinesForXTable?kB(n).replace(/\r?\n/g,`
`).replace(/\r/g,`
`).split(`
`)||[]:[kB(n)];r.length&&r.length>1&&!r[r.length-1];)r.pop();if(!((i=t.options.customConfig)===null||i===void 0)&&i.multilinesForXTable&&!t.internalProps.autoWrapText)for(;r.length&&r.length>1&&!r[0];)r.shift();return{text:r,moreThanMaxCharacters:o}}function nat(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f){var p,m,v,b,y,C,w,_,A;let x,S=0,T=0,M=0;if(Array.isArray(t)&&t.length!==0){const{inlineFrontIcons:P,inlineEndIcons:B,contentLeftIcons:k,contentRightIcons:L,leftIconWidth:O,rightIconWidth:I,absoluteRightIconWidth:H}=ju(t,n,f,c);let D;if(S=O,T=I,M=H,P.length===0&&B.length===0){let z=0;dt(c.theme._contentOffset)&&(u==="left"?z=c.theme._contentOffset:u==="right"&&(z=-c.theme._contentOffset));const G=f?Nn(f.start.col,f.start.row,c):Nn(n.col,n.row,c),{text:U,moreThanMaxCharacters:j}=Gc(e,c),X={text:U.length===1?U[0]:U,moreThanMaxCharacters:j,maxLineWidth:r?1/0:l-(i[1]+i[3])-S-T-G,textBaseline:"top",heightLimit:((b=c.options.customConfig)===null||b===void 0?void 0:b.limitContentHeight)===!1||o&&!(!((y=c.options.customConfig)===null||y===void 0)&&y.multilinesForXTable)?-1:h-Math.floor(i[0]+i[2]),pickable:!1,autoWrapText:s,lineClamp:a,wordBreak:"break-word",whiteSpace:((C=c.options.customConfig)===null||C===void 0?void 0:C.limitContentHeight)===!1||U.length!==1||s?"normal":"no-wrap",dx:(u==="left"?k.length?0:G:0)+z,keepCenterInLine:!0},Z=new Oe(g.text?Object.assign({},g.text,X):X);Z.name="text",D=Z}else{const z=Object.assign({text:e?.toString()},((A=(_=(w=n.parent)===null||w===void 0?void 0:w.theme)===null||_===void 0?void 0:_.userTheme)===null||A===void 0?void 0:A.text)||{});g.text&&Object.assign(z,g.text),z.textBaseline="middle";const G=[...P.map((j=>G0(j))),z,...B.map((j=>G0(j)))];G[0].textAlign=u;const U=new ti({width:r?0:l-(i[1]+i[3])-S-T,height:o&&s?0:Math.ceil(h-(i[0]+i[2])),textConfig:G,verticalDirection:o&&s?"top":d,ellipsis:z.ellipsis});U.name="text",D=U,U.bindIconEvent(),!f||f.start.col===f.end.col&&f.start.row===f.end.row||(U.onBeforeAttributeUpdate=oat)}if(k.length!==0||L.length!==0){const z=new iat({x:0,y:0,fill:!1,stroke:!1,pickable:!1});z.name="content",z.setCellContentOption({autoWidth:r,autoHeight:o,cellWidth:l-(i[1]+i[3])-S-T,cellHeight:h-(i[0]+i[2]),align:u,baseline:d});const G={addedHierarchyOffset:0};k.forEach((U=>{const j=or(U,void 0,n.col,n.row,f,c,G);j.role="icon-content-left",j.name=U.name,z.addLeftOccupyingIcon(j)})),L.forEach((U=>{const j=or(U,void 0,n.col,n.row,f,c,G);j.role="icon-content-right",j.name=U.name,z.addRightOccupyingIcon(j)})),z.addContent(D),n.appendChild(z),z.layout(),x=z.AABBBounds.width(),z.AABBBounds.height()}else n.firstChild?n.insertBefore(D,n.firstChild):n.appendChild(D),x=D.AABBBounds.width(),D.AABBBounds.height()}else if($(e)){const{text:P,moreThanMaxCharacters:B}=Gc(e,c),k=f?Nn(f.start.col,f.start.row,c):Nn(n.col,n.row,c);let L=0;dt(c.theme._contentOffset)&&(u==="left"?L=c.theme._contentOffset:u==="right"&&(L=-c.theme._contentOffset));const O={text:P.length===1?P[0]:P,moreThanMaxCharacters:B,maxLineWidth:r?1/0:l-(i[1]+i[3]+k),textBaseline:"top",autoWrapText:s,lineClamp:a,wordBreak:"break-word",heightLimit:((p=c.options.customConfig)===null||p===void 0?void 0:p.limitContentHeight)===!1||o&&!(!((m=c.options.customConfig)===null||m===void 0)&&m.multilinesForXTable)?-1:h-Math.floor(i[0]+i[2]),pickable:!1,dx:(u==="left"?k:0)+L,whiteSpace:((v=c.options.customConfig)===null||v===void 0?void 0:v.limitContentHeight)===!1||P.length!==1||s?"normal":"no-wrap",keepCenterInLine:!0},I=new Oe(g.text?Object.assign({},g.text,O):O);I.name="text",I.textBaseline=d,n.appendChild(I),x=I.AABBBounds.width(),I.AABBBounds.height()}const R=r?S+x+T:l-(i[1]+i[3]),E=h-(i[0]+i[2]);n.forEachChildren((P=>{P.role==="icon-left"?P.setAttribute("x",P.attribute.x+i[3]):P.role==="icon-right"?P.setAttribute("x",P.attribute.x+R-T+i[3]):P.role==="icon-absolute-right"?P.setAttribute("x",P.attribute.x+R-M+i[3]+i[1]):P.name!=="content"&&P.name!=="text"||(u==="center"&&P.type!=="richtext"?P.setAttribute("x",i[3]+S+(R-S-T)/2):u==="right"&&P.type!=="richtext"?P.setAttribute("x",i[3]+R-T):P.setAttribute("x",i[3]+S))})),n.forEachChildren((P=>{P.name!==ho&&(d==="middle"?P.setAttribute("y",i[0]+(E-P.AABBBounds.height())/2):d==="bottom"?P.setAttribute("y",i[0]+E-P.AABBBounds.height()):P.setAttribute("y",i[0]))})),n.setAttributes({width:R+i[1]+i[3],height:E+i[0]+i[2]})}function or(n,t,e,i,r,o,s){var a,l,h,u,d,c;if(!n)return;const g={};n.type==="image"?(n.isGif&&(g.gif=n.src),g.image=n.src):(n.type==="svg"||"svg"in n)&&(g.image=n.svg),g.width=n.width,g.height=n.height,g.visibleTime=(a=n.visibleTime)!==null&&a!==void 0?a:"always",g.funcType=n.funcType,g.interactive=n.interactive,g.isGif=n.isGif;let f,p=0;return s&&s?.addedHierarchyOffset!==0||!dt(e)||!dt(i)||!o||n.funcType!==me.collapse&&n.funcType!==me.expand&&n.positionType!==pe.contentLeft&&n.positionType!==pe.contentRight||(p=r?Nn(r.start.col,r.start.row,o):Nn(e,i,o),s&&(s.addedHierarchyOffset=1)),g.marginLeft=((l=n.marginLeft)!==null&&l!==void 0?l:0)+p,g.marginRight=(h=n.marginRight)!==null&&h!==void 0?h:0,n.interactive===!1&&(g.pickable=!1),n.hover&&(g.backgroundWidth=(u=n.hover.width)!==null&&u!==void 0?u:n.width,g.backgroundHeight=(d=n.hover.width)!==null&&d!==void 0?d:n.width,g.backgroundColor=(c=n.hover.bgColor)!==null&&c!==void 0?c:"rgba(22,44,66,0.2)",g.hoverImage=n.hover.image),n.cursor&&(g.cursor=n.cursor),"shape"in n&&n.shape==="circle"&&(g.shape=n.shape),t?(t.setAttributes(g),t.loadImage(g.image),t.tooltip=n.tooltip,t.name=n.name,t):(n.type==="text"?(g.text=n.content,xe(g,n.style),f=new $D(g),f.tooltip=n.tooltip,f.name=n.name):(f=new Wl(g),f.tooltip=n.tooltip,f.name=n.name),f)}function G0(n){var t,e,i,r,o,s;const a={};return n.type==="image"?a.image=n.src:(n.type==="svg"||"svg"in n)&&(a.image=n.svg),a.visibleTime=(t=n.visibleTime)!==null&&t!==void 0?t:"always",a.funcType=n.funcType,a.id=n.name,a.width=n.width,a.height=n.height,(n.marginRight||n.marginLeft)&&(a.margin=[0,(e=n.marginRight)!==null&&e!==void 0?e:0,0,(i=n.marginLeft)!==null&&i!==void 0?i:0]),n.hover&&(a.backgroundWidth=(r=n.hover.width)!==null&&r!==void 0?r:n.width,a.backgroundHeight=(o=n.hover.height)!==null&&o!==void 0?o:n.height,a.backgroundShowMode="hover",a.hoverImage=n.hover.image,a.backgroundStroke=!1,a.backgroundFill=(s=n.hover.bgColor)!==null&&s!==void 0?s:"rgba(22,44,66,0.2)"),n.cursor&&(a.cursor=n.cursor),a.tooltip=n.tooltip,a}function $0(n,t,e,i,r,o,s,a,l){var h,u,d,c;pl(n.contentWidth)&&(i=t-((h=n.contentWidth)!==null&&h!==void 0?h:n.attribute.width));let g,f=0,p=0,m=0,v=0;n.forEachChildren((_=>{var A,x,S,T;_.role==="icon-left"?(f+=_.AABBBounds.width()+((A=_.attribute.marginLeft)!==null&&A!==void 0?A:0)+((x=_.attribute.marginRight)!==null&&x!==void 0?x:0),p=Math.max(p,_.AABBBounds.height())):_.role==="icon-right"&&(m+=_.AABBBounds.width()+((S=_.attribute.marginLeft)!==null&&S!==void 0?S:0)+((T=_.attribute.marginRight)!==null&&T!==void 0?T:0),v=Math.max(v,_.AABBBounds.height()))}));const b=n.getChildByName("text"),y=n.getChildByName("content");let C;b instanceof Oe?(g=b.AABBBounds.height(),b.setAttribute("maxLineWidth",t-f-m-(o[1]+o[3])-((u=b.attribute.dx)!==null&&u!==void 0?u:0)-((d=l.table.theme._contentOffset)!==null&&d!==void 0?d:0)),C=b.AABBBounds.height()):b instanceof ti?(g=b.AABBBounds.height(),b.setAttribute("width",t-f-m-(o[1]+o[3])),C=b.AABBBounds.height()):y&&(g=y.AABBBounds.height(),y.updateWidth(t-f-m-(o[1]+o[3])),C=y.AABBBounds.height());const w=Math.round(Math.max(p,v,g)+o[0]+o[2]);if(n.forEachChildren((_=>{var A;if(_.role!=="icon-left")if(_.role==="icon-right")_.setAttribute("x",_.attribute.x+i);else if(_.role==="icon-absolute-right")_.setAttribute("x",_.attribute.x+i);else if(_.name==="content"||_.name==="text"&&_.type!=="richtext"){const x=(A=_.attribute.textAlign)!==null&&A!==void 0?A:s;x==="center"?_.setAttribute("x",o[3]+f+(t-(o[1]+o[3])-f-m)/2):x==="right"&&_.setAttribute("x",o[3]+t-(o[1]+o[3])-m)}else _.name==="mark"&&_.setAttribute("x",n.attribute.width)})),r){let _=Math.max(p,C,v);if(rat(l,n,Math.round(_+o[0]+o[2]),w))return!0;_=((c=n.contentHeight)!==null&&c!==void 0?c:e)-(o[0]+o[2]),n.forEachChildren((A=>{A.type!=="rect"&&A.type!=="chart"&&A.name!==ho&&(A.name==="mark"?A.setAttribute("y",0):a==="middle"?A.setAttribute("y",o[0]+(_-A.AABBBounds.height())/2):a==="bottom"?A.setAttribute("y",o[0]+_-A.AABBBounds.height()):A.setAttribute("y",o[0]))}))}else a!=="middle"&&a!=="bottom"||n.forEachChildren((_=>{_.type!=="rect"&&_.type!=="chart"&&_.name!==ho&&(_.name==="mark"?_.setAttribute("y",0):a==="middle"?_.setAttribute("y",(e-o[2]+o[0]-_.AABBBounds.height())/2):a==="bottom"?_.setAttribute("y",e-_.AABBBounds.height()-o[2]):_.setAttribute("y",o[0]))}));return!1}function U0(n,t,e,i,r,o,s,a){var l;const h=t-Math.floor(r[0]+r[2]),u=n.getChildByName("text");u instanceof Oe&&!i?u.setAttributes({heightLimit:((l=a.options.customConfig)===null||l===void 0?void 0:l.limitContentHeight)===!1?-1:h}):u instanceof ti&&!i?u.setAttributes({height:h}):n.getChildByName("content")&&n.getChildByName("content").updateHeight(h),n.forEachChildren((d=>{d.setAttribute("dy",0),d.type==="rect"||d.type==="chart"||d.name===ho||(d.name==="mark"?d.setAttribute("y",0):s==="middle"?d.setAttribute("y",r[0]+(h-d.AABBBounds.height())/2):s==="bottom"?d.setAttribute("y",r[0]+h-d.AABBBounds.height()):d.setAttribute("y",r[0]))}))}function rat(n,t,e,i){const r=n.table,o=mi(r,t.col,t.row);if(o&&o.end.row-o.start.row){i/=o.end.row-o.start.row+1,e/=o.end.row-o.start.row+1;for(let s=o.start.row;s<=o.end.row;s++){const a=r.getRowHeight(s);if(a===i&&e!==a||e>a)return!0}}else{const s=r.getRowHeight(t.row);if(s===i&&e!==s||e>s)return!0}return!1}function ju(n,t,e,i){const r=[],o=[],s=[],a=[],l=[],h=[],u=[],d=[];let c=0,g=0,f=0,p=0,m=0,v=0;return n.forEach((b=>{switch(b.positionType){case pe.left:r.push(b);break;case pe.right:o.push(b);break;case pe.contentLeft:s.push(b);break;case pe.contentRight:a.push(b);break;case pe.absoluteRight:d.push(b);break;case pe.inlineFront:l.push(b);break;case pe.inlineEnd:h.push(b)}})),r.forEach((b=>{var y,C,w;const _=or(b,void 0,t.col,t.row,e,i);_.role="icon-left",_.name=b.name,_.setAttribute("x",c+((y=_.attribute.marginLeft)!==null&&y!==void 0?y:0)),c+=_.AABBBounds.width()+((C=_.attribute.marginLeft)!==null&&C!==void 0?C:0)+((w=_.attribute.marginRight)!==null&&w!==void 0?w:0),g=Math.max(g,_.AABBBounds.height()),t.appendChild(_)})),o.forEach((b=>{var y,C,w;const _=or(b,void 0,t.col,t.row,e,i);_.role="icon-right",_.name=b.name,_.setAttribute("x",f+((y=_.attribute.marginLeft)!==null&&y!==void 0?y:0)),f+=_.AABBBounds.width()+((C=_.attribute.marginLeft)!==null&&C!==void 0?C:0)+((w=_.attribute.marginRight)!==null&&w!==void 0?w:0),p=Math.max(p,_.AABBBounds.height()),t.appendChild(_)})),u.forEach((b=>{var y,C,w;const _=or(b,void 0,t.col,t.row,e,i);_.role="icon-absolute-left",_.name=b.name,_.setAttribute("x",m+((y=_.attribute.marginLeft)!==null&&y!==void 0?y:0)),m+=_.AABBBounds.width()+((C=_.attribute.marginLeft)!==null&&C!==void 0?C:0)+((w=_.attribute.marginRight)!==null&&w!==void 0?w:0),t.appendChild(_)})),d.forEach((b=>{var y,C,w;const _=or(b,void 0,t.col,t.row,e,i);_.role="icon-absolute-right",_.name=b.name,_.setAttribute("x",v+((y=_.attribute.marginLeft)!==null&&y!==void 0?y:0)),v+=_.AABBBounds.width()+((C=_.attribute.marginLeft)!==null&&C!==void 0?C:0)+((w=_.attribute.marginRight)!==null&&w!==void 0?w:0),t.appendChild(_)})),{leftIcons:r,rightIcons:o,contentLeftIcons:s,contentRightIcons:a,inlineFrontIcons:l,inlineEndIcons:h,absoluteLeftIcons:u,absoluteRightIcons:d,leftIconWidth:c,leftIconHeight:g,rightIconWidth:f,rightIconHeight:p,absoluteLeftIconWidth:m,absoluteRightIconWidth:v}}function oat(n,t){if(n.hasOwnProperty("hoverIconId")){const e=this;if(e.skipMergeUpdate)return;const i=jl(e);if(!i||!i.stage)return;const r=i.stage.table;e.skipAttributeUpdate=!0;const{mergeStartCol:o,mergeEndCol:s,mergeStartRow:a,mergeEndRow:l}=i;if($(o)&&$(s)&&$(a)&&$(l)&&(o!==s||a!==l)){for(let h=o;h<=s;h++)for(let u=a;u<=l;u++){if(h===i.col&&u===i.row){if(n.hoverIconId!==e.attribute.hoverIconId){const c=e._frameCache.icons.get(n.hoverIconId);e.updateHoverIconState(c)}continue}const d=r.scenegraph.highPerformanceGetCell(h,u);if(d.role==="cell"){const c=d.getChildByName(e.name,!0);if(!c||c.skipAttributeUpdate)continue;n.hoverIconId!==c.attribute.hoverIconId&&(c.setAttribute("hoverIconId",n.hoverIconId),d.addUpdateBoundTag())}}e.skipAttributeUpdate=void 0}}}function sat(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m){var v,b,y,C,w,_,A,x,S,T,M,R,E,P,B,k,L,O,I,H,D,z,G,U,j,X,Z,J,q,st;const Q=g._getCellStyle(i,r),ot=Nv("padding",Q,i,r,g);!((v=g.options.customConfig)===null||v===void 0)&&v.imageMargin?h=Kt((b=g.options.customConfig)===null||b===void 0?void 0:b.imageMargin):$(ot)&&(h=ot),!((y=f?.text)===null||y===void 0)&&y.textAlign&&(u=(C=f?.text)===null||C===void 0?void 0:C.textAlign),!((w=f?.text)===null||w===void 0)&&w.textBaseline&&(d=(_=f?.text)===null||_===void 0?void 0:_.textBaseline);const nt=Xo(i,r,f,g);let F,N;if(m&&(F=g.scenegraph.highPerformanceGetCell(i,r,!0),F&&F.role==="cell"&&F.setAttributes({x:t,y:e,width:o,height:s,lineWidth:(x=(A=f?.group)===null||A===void 0?void 0:A.lineWidth)!==null&&x!==void 0?x:void 0,fill:(T=(S=f?.group)===null||S===void 0?void 0:S.fill)!==null&&T!==void 0?T:void 0,stroke:(R=(M=f?.group)===null||M===void 0?void 0:M.stroke)!==null&&R!==void 0?R:void 0,strokeArrayWidth:nt??void 0,strokeArrayColor:(P=(E=f?.group)===null||E===void 0?void 0:E.strokeArrayColor)!==null&&P!==void 0?P:void 0,cursor:(k=(B=f?.group)===null||B===void 0?void 0:B.cursor)!==null&&k!==void 0?k:void 0,lineDash:(O=(L=f?.group)===null||L===void 0?void 0:L.lineDash)!==null&&O!==void 0?O:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius})),F&&F.role==="cell"||(F=new Vt({x:t,y:e,width:o,height:s,lineWidth:(H=(I=f?.group)===null||I===void 0?void 0:I.lineWidth)!==null&&H!==void 0?H:void 0,fill:(z=(D=f?.group)===null||D===void 0?void 0:D.fill)!==null&&z!==void 0?z:void 0,stroke:(U=(G=f?.group)===null||G===void 0?void 0:G.stroke)!==null&&U!==void 0?U:void 0,strokeArrayWidth:nt??void 0,strokeArrayColor:(X=(j=f?.group)===null||j===void 0?void 0:j.strokeArrayColor)!==null&&X!==void 0?X:void 0,cursor:(J=(Z=f?.group)===null||Z===void 0?void 0:Z.cursor)!==null&&J!==void 0?J:void 0,lineDash:(st=(q=f?.group)===null||q===void 0?void 0:q.lineDash)!==null&&st!==void 0?st:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius}),F.role="cell",F.col=i,F.row=r,n?.addCellGroup(F)),c){let rt=i,lt=r;p&&(rt=p.start.col,lt=p.start.row),N=g.getCellIcons(rt,lt)}let W=0,V=0,K=0;if(Array.isArray(N)&&N.length!==0){const{leftIconWidth:rt,rightIconWidth:lt,absoluteRightIconWidth:ct}=ju(N,F,p,g);W=rt+lt,V=rt,K=lt,F.forEachChildren((ut=>{ut.role==="icon-left"?ut.setAttribute("x",ut.attribute.x+h[3]):ut.role==="icon-right"?ut.setAttribute("x",ut.attribute.x+o-lt-h[1]):ut.role==="icon-absolute-right"&&ut.setAttribute("x",ut.attribute.x+o-ct-h[1])})),F.forEachChildren((ut=>{d==="middle"?ut.setAttribute("y",(s-ut.AABBBounds.height())/2):d==="bottom"?ut.setAttribute("y",s-ut.AABBBounds.height()-h[2]):ut.setAttribute("y",h[0])})),F._cellLeftIconWidth=V,F._cellRightIconWidth=K}const et=g.getCellValue(i,r),it=mv({x:h[3],y:h[0],width:o-h[1]-h[3]-W,height:s-h[0]-h[2],image:et,cursor:"pointer"});return it.name="image",it.keepAspectRatio=a,it.textAlign=u,it.textBaseline=d,a||l?it.resources&&it.resources.has(it.attribute.image)&&it.resources.get(it.attribute.image).state==="success"?(it.setAttribute("opacity",0),setTimeout((()=>{it.setAttribute("opacity",1),U2(l,a,h,u,d,it,F,g),g.scenegraph.updateNextFrame()}),0)):it.successCallback=()=>{U2(l,a,h,u,d,it,F,g),g.scenegraph.updateNextFrame()}:it.resources&&it.resources.has(it.attribute.image)&&it.resources.get(it.attribute.image).state==="success"?$c(F,i,r,0,0,g):it.successCallback=()=>{$c(F,i,r,0,0,g)},it.failCallback=()=>{const rt=Fr();it.image=rt.damage_pic.svg},F.appendChild(it),F}function qD(n,t,e,i,r,o,s){let a=!1,l=null,h=null;const{width:u,height:d,isMerge:c}=Ru(s,r.table);if(u<e+o[1]+o[3]&&(l=e+o[1]+o[3],a=!0),d<i+o[2]+o[0]&&(h=i+o[2]+o[0],a=!0),a){if(typeof l=="number")if(c)for(let g=s.mergeStartCol;g<=s.mergeEndCol;g++)r.setColWidth(g,l/(s.mergeEndCol-s.mergeStartCol+1));else r.setColWidth(n,l);if(typeof h=="number")if(c)for(let g=s.mergeStartRow;g<=s.mergeEndRow;g++)r.setRowHeight(g,h/(s.mergeEndRow-s.mergeStartRow+1));else r.setRowHeight(t,h);return r.component.updateScrollBar(),!0}return!1}function $c(n,t,e,i,r,o){var s,a,l,h,u,d,c,g,f,p,m,v;const b=n.getChildByName("image");if(!b)return;const y=typeof b.attribute.image!="string"&&b.attribute.image||((s=b.resources)===null||s===void 0?void 0:s.get(b.attribute.image).data);if(!y)return;const C=o._getCellStyle(t,e),w=(a=ht("textAlign",C,t,e,o))!==null&&a!==void 0?a:"left",_=(l=ht("textBaseline",C,t,e,o))!==null&&l!==void 0?l:"middle";let A;A=!((h=o.options.customConfig)===null||h===void 0)&&h.imageMargin?Kt((u=o.options.customConfig)===null||u===void 0?void 0:u.imageMargin):(d=Kt(ht("padding",C,t,e,o)))!==null&&d!==void 0?d:[0,0,0,0];const{width:x,height:S,isMerge:T}=Ru(n,o),M=(c=n.mergeStartCol)!==null&&c!==void 0?c:n.col,R=(g=n.mergeStartRow)!==null&&g!==void 0?g:n.row,E=(f=n.mergeEndCol)!==null&&f!==void 0?f:n.col,P=(p=n.mergeEndCol)!==null&&p!==void 0?p:n.row,B=(m=n._cellLeftIconWidth)!==null&&m!==void 0?m:0,k=(v=n._cellRightIconWidth)!==null&&v!==void 0?v:0;if(b.keepAspectRatio){const{width:L,height:O}=zv(y.width||y.videoWidth,y.height||y.videoHeight,x-(A[1]+A[3]),S-(A[0]+A[2])),I=tS(0,0,x,S,L,O,w,_,A);for(let H=M;H<=E;H++)for(let D=R;D<=P;D++){const z=o.scenegraph.getCell(H,D).getChildByName("image");z?.setAttributes({x:I.x,y:I.y,width:L,height:O})}}else for(let L=M;L<=E;L++)for(let O=R;O<=P;O++){const I=o.scenegraph.getCell(L,O).getChildByName("image");I?.setAttributes({x:B+A[3],y:A[0],width:x-A[1]-A[3]-k-B,height:S-A[0]-A[2]})}if(n.getChildByName("play-icon")){const{width:I,height:H}=Ru(n,o),D=Math.floor(Math.min(I-A[1]-A[3],H-A[2]-A[0])/2),z=0+(I>b.attribute.width?b.attribute.x-0+b.attribute.width/2:I/2),G=0+(H>b.attribute.height?b.attribute.y-0+b.attribute.height/2:H/2);for(let U=M;U<=E;U++)for(let j=R;j<=P;j++)o.scenegraph.getCell(U,j).getChildByName("play-icon").setAttributes({x:z-D/2,y:G-D/2,width:D,height:D})}n.forEachChildren((L=>{L.role==="icon-left"||(L.role==="icon-right"||L.role==="icon-absolute-right")&&L.setAttribute("x",L.attribute.x+i)})),n.forEachChildren((L=>{(L.type==="rect"||L.role&&L.role.startsWith("icon"))&&(_==="middle"?L.setAttribute("y",A[0]+(S-A[0]-A[2]-L.AABBBounds.height())/2):_==="bottom"?L.setAttribute("y",A[0]+S-A[0]-A[2]-L.AABBBounds.height()):L.setAttribute("y",A[0]))})),T&&eS(n.mergeStartCol,n.mergeEndCol,n.mergeStartRow,n.mergeEndRow,o)}function Ru(n,t){return n.role==="cell"&&$(n.mergeStartCol)&&$(n.mergeEndCol)&&$(n.mergeStartRow)&&$(n.mergeEndRow)?{width:t.getColsWidth(n.mergeStartCol,n.mergeEndCol),height:t.getRowsHeight(n.mergeStartRow,n.mergeEndRow),isMerge:!0}:{width:n.attribute.width,height:n.attribute.height,isMerge:!1}}function eS(n,t,e,i,r){for(let o=n;o<=t;o++)for(let s=e;s<=i;s++){const a=r.scenegraph.getCell(o,s);if(a){const l=a.getChildByName("image");l&&l.setAttributes({dx:-r.getColsWidth(a.mergeStartCol,o-1),dy:-r.getRowsHeight(a.mergeStartRow,s-1)});const h=a.getChildByName("play-icon");h&&h.setAttributes({dx:-r.getColsWidth(a.mergeStartCol,o-1),dy:-r.getRowsHeight(a.mergeStartRow,s-1)})}}}function U2(n,t,e,i,r,o,s,a){const l=o.resources.get(o.attribute.image).data,{col:h,row:u}=s;if(n&&!X2(o)&&qD(h,u,l.width,l.height,a.scenegraph,e,s),t||X2(o)){const{width:d,height:c,isMerge:g}=Ru(s,a),{width:f,height:p}=zv(l.width,l.height,d-e[1]-e[3],c-e[0]-e[2]),m=tS(0,0,d,c,f,p,i,r,e);o.setAttributes({x:m.x,y:m.y,width:f,height:p}),g&&eS(s.mergeStartCol,s.mergeEndCol,s.mergeStartRow,s.mergeEndRow,a)}}function X2(n){const t=Fr();return n.attribute.image===t.damage_pic.svg}function KD(n,t,e){n.then((()=>{e(),t.scenegraph.updateNextFrame()})).catch((i=>{}))}function aat(n,t){var e,i;const r=this;if(r.shadowRoot&&r.shadowRoot.childrenCount&&($(n.width)||$(n.height))){const o=r.shadowRoot.findChildrenByName("shadow-rect")[0];o&&o.setAttributes({width:(e=n.width)!==null&&e!==void 0?e:o.attribute.width,height:(i=n.height)!==null&&i!==void 0?i:o.attribute.height})}}function iS(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v){var b,y;let C,w=!1;if(fo(t)){if(i.scenegraph.highPerformanceGetCell(r,o).role!=="cell")return C;t=i.getCellValue(r,o),w=!0}if(n==="checkbox"&&e.tree)C=St.getFunction("createCheckboxCellGroup")(null,h,0,u,r,o,s,a,l,d,c,g,f,i,p,e,m,w,!0);else if(n==="text"||n==="link"||v){if(n==="link"){const S=t,T=i.getCellOriginValue(r,o),M=i._getCellStyle(r,o);n==="link"&&("templateLink"in e&&e.templateLink||!("linkDetect"in e)||!fe(e.linkDetect,{col:r,row:o,table:i,value:S,dataValue:T,cellHeaderPaths:void 0})||qx.test(S))&&(p?(p.text.fill=ht("linkColor",M,r,o,i),p.group.cursor="pointer"):p={text:{fill:ht("linkColor",M,r,o,i)},group:{cursor:"pointer"}})}const{customElementsGroup:_,renderDefault:A}=Y2(i,e,r,o,a,l,d,m,v);C=St.getFunction("createTextCellGroup")(i,t,h,0,u,r,o,s,a,l,d,c,g,f,_,A,p,m,w);const x=i.internalProps.layoutMap.getAxisConfigInPivotChart(r,o);if(x){const S=new(St.getComponent("axis"))(x,C.attribute.width,C.attribute.height,(b=x.__vtablePadding)!==null&&b!==void 0?b:d,i);C.clear(),C.appendChild(S.component),S.overlap()}else i.internalProps.layoutMap.isEmpty(r,o)?(C.setAttributes({fill:!1,stroke:!1}),C.clear()):i.internalProps.layoutMap.isAxisCell(r,o)&&C.clear()}else if(n==="image")C=St.getFunction("createImageCellGroup")(h,0,u,r,o,a,l,e.keepAspectRatio,e.imageAutoSizing,d,c,g,f,i,p,m,w);else if(n==="video")C=St.getFunction("createVideoCellGroup")(h,0,u,r,o,a,l,e.keepAspectRatio,e.imageAutoSizing,d,c,g,f,i,p,m,w);else if(n==="chart"){const _=i.internalProps.layoutMap.getChartInstance(r,o);C=St.getFunction("createChartCellGroup")(null,h,0,u,r,o,a,l,d,t,e.chartModule,i.internalProps.layoutMap.getChartSpec(r,o),_,(y=i.internalProps.layoutMap.getChartDataId(r,o))!==null&&y!==void 0?y:"data",i,p,i.internalProps.layoutMap.isShareChartSpec(r,o),w,i.internalProps.layoutMap.isNoChartDataRenderNothing(r,o))}else if(n==="progressbar"){const{customElementsGroup:_,renderDefault:A}=Y2(i,e,r,o,a,l,d,m,v),x=i._getCellStyle(r,o),S=i.getCellOriginValue(r,o);C=St.getFunction("createTextCellGroup")(i,t,h,0,u,r,o,s,a,l,d,c,g,f,_,A,p,m,w);const T=St.getFunction("createProgressBarCell")(e,x,s,t,S,r,o,d,i,m);C.firstChild?C.insertBefore(T,C.firstChild):C.appendChild(T)}else if(n==="sparkline")C=St.getFunction("createSparkLineCellGroup")(null,h,0,u,r,o,a,l,d,i,p,w);else if(n==="checkbox"){const _="isAggregation"in i.internalProps.layoutMap&&i.internalProps.layoutMap.isAggregation(r,o),A=i.internalProps.layoutMap.isSeriesNumber(r,o);_&&A?C=St.getFunction("createTextCellGroup")(i,t,h,0,u,r,o,s,a,l,d,c,g,!1,void 0,!0,p,m,w):C=St.getFunction("createCheckboxCellGroup")(null,h,0,u,r,o,s,a,l,d,c,g,f,i,p,e,m,w,!1)}else n==="radio"?C=St.getFunction("createRadioCellGroup")(null,h,0,u,r,o,s,a,l,d,c,g,i,p,e,m):n==="switch"?C=St.getFunction("createSwitchCellGroup")(null,h,0,u,r,o,s,a,l,d,c,g,f,i,p,e,m,w):n==="button"&&(C=St.getFunction("createButtonCellGroup")(null,h,0,u,r,o,s,a,l,d,c,g,f,i,p,e,m,w));return C.onBeforeAttributeUpdate=aat,C}function Y2(n,t,e,i,r,o,s,a,l){let h,u=!0;if(l)h=l.elementsGroup,u=l.renderDefault;else if(!(a?.isCustom&&!n.isCornerHeader(e,i))){let d,c;if(n.getCellLocation(e,i)!=="body"?(d=t?.headerCustomRender,c=t?.headerCustomLayout):(d=t?.customRender||n.customRender,c=t?.customLayout),c||d){const g=_a(c,d,e,i,r,o,!1,n.isAutoRowHeight(i),s,a,n);h=g.elementsGroup,u=g.renderDefault}}return{customElementsGroup:h,renderDefault:u}}function Er(n,t,e,i,r,o){var s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A;const x=e.scenegraph.highPerformanceGetCell(n,t,!0);if(x.role!=="cell"&&!i)return;const S=e.getCellLocation(n,t);let T,M,R,E,P=e.getCellValue(n,t),B=!1;if(e.internalProps.customMergeCell){const Q=e.getCustomMerge(n,t);if(Q){const{range:ot,text:nt,style:F,customLayout:N,customRender:W}=Q;M=ot,T=M.start.col!==M.end.col||M.start.row!==M.end.row,P=nt,R=F,(N||W)&&(E=_a(N,W,ot.start.col,ot.start.row,e.getColsWidth(ot.start.col,ot.end.col),e.getRowsHeight(ot.start.row,ot.end.row),!1,e.isAutoRowHeight(t),[0,0,0,0],M,e)),B=!0}}let k=n,L=t;M&&(k=M.start.col,L=M.start.row);const O=S!=="body"?e.getHeaderDefine(k,L):e.getBodyColumnDefine(k,L);let I=S!=="body"||O?.dragOrder||!!O?.icon||!!O?.tree;M||!e.internalProps.enableTreeNodeMerge&&S==="body"&&!O?.mergeCell||(M=e.getCellRange(n,t),T=M.start.col!==M.end.col||M.start.row!==M.end.row);let H=!1;if(e.internalProps.enableTreeNodeMerge&&T){const Q=e.getCellRawRecord(M.start.col,M.start.row),{vtableMergeName:ot,vtableMerge:nt}=Q??{};H=nt,nt&&(I=!0,e.internalProps.groupTitleCustomLayout&&(E=_a(e.internalProps.groupTitleCustomLayout,void 0,M.start.col,M.start.row,e.getColsWidth(M.start.col,M.end.col),e.getRowsHeight(M.start.row,M.end.row),!1,e.isAutoRowHeight(t),[0,0,0,0],M,e)),e.internalProps.groupTitleFieldFormat?P=e.internalProps.groupTitleFieldFormat(Q,n,t,e):ot!==void 0&&(P=ot))}const D=R||e._getCellStyle(M?M.start.col:n,M?M.start.row:t),z=(s=D.autoWrapText)!==null&&s!==void 0?s:e.internalProps.autoWrapText,G=Ba(D,e,T?M.start.col:n,T?M.start.row:t,ht).theme;if(G.group.cornerRadius=Dv(n,t,e),!i&&!T&&!(O?.customLayout||O?.customRender||O?.headerCustomLayout||O?.headerCustomRender)&&(o||lat(n,t,x,z,I,e))){const Q=e.getColWidth(n),ot=e.getRowHeight(t),nt=Xo(n,t,G,e);x.setAttributes({width:Q,height:ot,lineWidth:(l=(a=G?.group)===null||a===void 0?void 0:a.lineWidth)!==null&&l!==void 0?l:void 0,fill:(u=(h=G?.group)===null||h===void 0?void 0:h.fill)!==null&&u!==void 0?u:void 0,stroke:(c=(d=G?.group)===null||d===void 0?void 0:d.stroke)!==null&&c!==void 0?c:void 0,strokeArrayWidth:nt??void 0,strokeArrayColor:(f=(g=G?.group)===null||g===void 0?void 0:g.strokeArrayColor)!==null&&f!==void 0?f:void 0,cursor:(m=(p=G?.group)===null||p===void 0?void 0:p.cursor)!==null&&m!==void 0?m:void 0,cornerRadius:(b=(v=G?.group)===null||v===void 0?void 0:v.cornerRadius)!==null&&b!==void 0?b:0,lineDash:(C=(y=G?.group)===null||y===void 0?void 0:y.lineDash)!==null&&C!==void 0?C:void 0,y:e.scenegraph.getCellGroupY(t)}),x.mergeStartCol=void 0,x.mergeStartRow=void 0,x.mergeEndCol=void 0,x.mergeEndRow=void 0,x.forEachChildren((N=>{N.setAttributes({dx:0,dy:0})}));const F=x.getChildByName("text");if(o&&F){const N=G.text.textAlign,W=Nn(n,t,e),V={textBaseline:"top",dx:N==="left"?W:0};F.setAttributes(G.text?Object.assign({},G.text,V):V)}else if(F){const N=e.getCellValue(n,t),{text:W,moreThanMaxCharacters:V}=Gc(N,e),K=Nn(n,t,e),et=D.lineClamp,it=(w=Kt(ht("padding",D,n,t,e)))!==null&&w!==void 0?w:[0,0,0,0],rt=G.text.textAlign;let lt=0;lt=rt==="center"?it[3]+(Q-(it[1]+it[3]))/2:rt==="right"?it[3]+Q-(it[1]+it[3]):it[3];const ct={text:W.length!==1||z?W:W[0],moreThanMaxCharacters:V,maxLineWidth:Q-(it[1]+it[3]+K),textBaseline:"top",autoWrapText:z,lineClamp:et,wordBreak:"break-word",heightLimit:ot-Math.floor(it[0]+it[2]),pickable:!1,dx:rt==="left"?K:0,x:lt};if(F.setAttributes(G.text?Object.assign({},G.text,ct):ct),F.attribute.text){const ut=G.text.textBaseline,gt=ot-(it[0]+it[2]);let Gt=0;Gt=ut==="middle"?it[0]+(gt-F.AABBBounds.height())/2:ut==="bottom"?it[0]+gt-F.AABBBounds.height():it[0],F.setAttributes({y:Gt})}}return x}if(!i&&x.role==="empty")return;const U=H||B?"text":e.isHeader(n,t)?(_=e._getHeaderLayoutMap(n,t).headerType)!==null&&_!==void 0?_:"text":(A=e.getBodyColumnType(n,t))!==null&&A!==void 0?A:"text",j=G._vtable.padding,X=G.text.textAlign,Z=G.text.textBaseline;let J,q,st;if(M?(q=e.getColsWidth(M.start.col,M.end.col),st=e.getRowsHeight(M.start.row,M.end.row)):(q=e.getColWidth(n),st=e.getRowHeight(t)),fo(P)?(x.removeAllChild(),KD(P,e,hat.bind(null,{type:U,value:P,define:O,table:e,col:n,row:t,cellWidth:q,cellHeight:st,oldCellGroup:x,padding:j,textAlign:X,textBaseline:Z,mayHaveIcon:I,addNew:i,range:M,customResult:E,customStyle:R}))):J=ZD(U,P,O,e,n,t,q,st,x,j,X,Z,I,i,G,M,E),T){const{width:Q}=J.attribute,{height:ot}=J.attribute;J.contentWidth=Q,J.contentHeight=ot,r?uat(M,q,st,j,X,Z,e,J):JD(M,q,st,j,X,Z,e)}return J}function ZD(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m){var v,b;if(fo(t)&&(t=i.getCellValue(r,o)),!g&&(l.row!==o||l.col!==r))return null;if(!g&&l.parent&&i.reactCustomLayout){const C=l.getChildByName("custom-container");if(C){const{col:w,row:_}=C;dt(w)&&dt(_)&&i.reactCustomLayout.removeCustomCell(w,_)}}const y=iS(n,t,e,i,r,o,i.getColWidth(r),s,a,g?i.scenegraph.getColGroup(r):l.parent,g?0:i.scenegraph.getCellGroupY(o),h,u,d,c,f,p,m);return!g&&l.parent&&(l.parent.insertAfter(y,l),l.parent.removeChild(l),l.release(!0),!((v=i.scenegraph)===null||v===void 0)&&v.proxy.cellCache.get(r)&&((b=i.scenegraph)===null||b===void 0||b.proxy.cellCache.set(r,y))),y}function lat(n,t,e,i,r,o){var s;const a=o.getBodyColumnType(n,t),l=o.isAutoRowHeight(t),h=o.getCellValue(n,t);return!(o.isHeader(n,t)||e.role!=="cell"||a!=="text"||i||l||r||((s=e.firstChild)===null||s===void 0?void 0:s.type)!=="text"||fo(h))}function hat(n){const{type:t,value:e,define:i,table:r,col:o,row:s,cellWidth:a,cellHeight:l,oldCellGroup:h,padding:u,textAlign:d,textBaseline:c,mayHaveIcon:g,addNew:f,range:p,customResult:m,customStyle:v}=n,b=v||r._getCellStyle(p?p.start.col:o,p?p.start.row:s),y=Ba(b,r,p?p.start.col:o,p?p.start.row:s,ht).theme;y.group.cornerRadius=Dv(o,s,r),ZD(t,e,i,r,o,s,a,l,h,u,d,c,g,f,y,p,m)}function JD(n,t,e,i,r,o,s){for(let a=n.start.col;a<=n.end.col;a++)for(let l=n.start.row;l<=n.end.row;l++){const h=s.scenegraph.highPerformanceGetCell(a,l,!0);if(h.role!=="cell")continue;n.start.row!==n.end.row&&h.contentHeight!==e&&U0(h,e,e,s.isAutoRowHeight(l),i,r,o,s),n.start.col!==n.end.col&&h.contentWidth!==t&&$0(h,t,e,0,s.isAutoRowHeight(l),i,r,o,s.scenegraph),h.contentWidth=t,h.contentHeight=e;const u=s.getRowHeight(l);bg(h,s.getColWidth(a),u,n,s)}}function uat(n,t,e,i,r,o,s,a){const{col:l,row:h}=a;n.start.row!==n.end.row&&a.contentHeight!==e&&U0(a,e,e,s.isAutoRowHeight(h),i,r,o,s),n.start.col!==n.end.col&&a.contentWidth!==t&&$0(a,t,e,0,s.isAutoRowHeight(h),i,r,o,s.scenegraph),a.contentWidth=t,a.contentHeight=e;const u=s.getRowHeight(h);bg(a,s.getColWidth(l),u,n,s)}function bg(n,t,e,i,r){var o,s;const{col:a,row:l}=n,h=-r.getColsWidth(i.start.col,a-1);let u=0;if(!((o=r.options.customConfig)===null||o===void 0)&&o._disableColumnAndRowSizeRound)for(let m=i.start.row;m<=l-1;m++)u-=r.getRowHeight(m);else u=-r.getRowsHeight(i.start.row,l-1);n.forEachChildren((m=>{var v,b,y,C,w,_;typeof m._dx=="number"?(m.skipMergeUpdate=!0,m.setAttributes({dx:((v=m._dx)!==null&&v!==void 0?v:0)+h}),m.skipMergeUpdate=!1):(m._dx=(b=m.attribute.dx)!==null&&b!==void 0?b:0,m.skipMergeUpdate=!0,m.setAttributes({dx:((y=m.attribute.dx)!==null&&y!==void 0?y:0)+h}),m.skipMergeUpdate=!1),typeof m._dy=="number"?(m.skipMergeUpdate=!0,m.setAttributes({dy:((C=m._dy)!==null&&C!==void 0?C:0)+u}),m.skipMergeUpdate=!1):(m._dy=(w=m.attribute.dy)!==null&&w!==void 0?w:0,m.skipMergeUpdate=!0,m.setAttributes({dy:((_=m.attribute.dy)!==null&&_!==void 0?_:0)+u}),m.skipMergeUpdate=!1)}));const d=(s=n.attribute.strokeArrayWidth)!==null&&s!==void 0?s:n.attribute.lineWidth,c=wt(d),g=[0,0,0,0];a===i.start.col&&(g[3]=c?d[3]:d),l===i.start.row&&(g[0]=c?d[0]:d),a===i.end.col&&(g[1]=c?d[1]:d),l===i.end.row&&(g[2]=c?d[2]:d);const f=t!==n.attribute.width,p=e!==n.attribute.height;return n.skipMergeUpdate=!0,n.setAttributes({width:t,height:e,strokeArrayWidth:g}),n.skipMergeUpdate=!1,n.mergeStartCol=i.start.col,n.mergeStartRow=i.start.row,n.mergeEndCol=i.end.col,n.mergeEndRow=i.end.row,{widthChange:f,heightChange:p}}function X0(n,t,e,i){if(i.internalProps.customMergeCell){const r=i.getCustomMerge(n,t);if(r){const{range:o,text:s,style:a,customLayout:l,customRender:h}=r;if(l||h){const u=_a(l,h,o.start.col,o.start.row,i.getColsWidth(o.start.col,o.end.col),i.getRowsHeight(o.start.row,o.end.row),!1,i.isAutoRowHeight(t),[0,0,0,0],o,i).elementsGroup;e.childrenCount>0&&u?e.insertBefore(u,e.firstChild):u&&e.appendChild(u);const d=i.getRowHeight(t),c=i.getColWidth(n),{width:g}=e.attribute,{height:f}=e.attribute;return e.contentWidth=g,e.contentHeight=f,bg(e,c,d,o,i),o}}}}function sa(n){return!!(n.role==="cell"&&dt(n.mergeStartCol)&&dt(n.mergeStartRow)&&dt(n.mergeEndCol)&&dt(n.mergeEndRow))}const wC=new ya({}),qd=new Mu({}),dat=new va({});function cat(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f){const p=Pi(n)?n.text:n,m=kv(p).split(`
`)||[],v=f.getColsWidth(t,i),b=ht("size",r,t,e,f);let y=0;if(o){const C=ht("spaceBetweenTextAndIcon",r,t,e,f),w=v-(g[1]+g[3])-s-b-C;wC.setAttributes({text:{maxLineWidth:w,text:m,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:u,lineHeight:d,wordBreak:"break-word",lineClamp:c},icon:{width:Math.floor(b/1.4),height:Math.floor(b/1.4)},box:{width:b,height:b},spaceBetweenTextAndIcon:C}),wC.render(),y=wC.AABBBounds.height()}else y=Math.max(b,m.length*d);return y}function gat(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f){var p;if(wt(n)){let m=0;const v=f.getBodyColumnDefine(t,e),b=ht("spaceBetweenRadio",r,t,e,f),y=(p=v?.radioDirectionInCell)!==null&&p!==void 0?p:"vertical";return y==="vertical"?n.forEach(((C,w)=>{const _=xC(C,t,e,i,r,o,s,a,l,h,u,d,c,g,f);m+=_,w!==n.length-1&&(m+=b)})):y==="horizontal"&&n.forEach((C=>{const w=xC(C,t,e,i,r,o,s,a,l,h,u,d,c,g,f);m=Math.max(w,m)})),m}return xC(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f)}function xC(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f){const p=Pi(n)?n.text:n,m=kv(p).split(`
`)||[],v=f.getColsWidth(t,i),b=ht("size",r,t,e,f);let y=ht("outerRadius",r,t,e,f);const C=dt(y)?2*y:b;let w=0;if(o){const _=ht("spaceBetweenTextAndIcon",r,t,e,f),A=v-(g[1]+g[3])-s-C-_;dt(y)||(y=Math.round(b/2)),qd.setAttributes({text:{maxLineWidth:A,text:m,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:u,lineHeight:d,wordBreak:"break-word",lineClamp:c},circle:{outerRadius:y},spaceBetweenTextAndIcon:_}),qd.render(),w=qd.AABBBounds.height()}else w=Math.max(b,m.length*d);return w}function fat(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f){return ht("boxWidth",r,t,e,f)}function pat(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f){const p=Pi(n)?n.text:n,m=kv(p).split(`
`)||[],v=f.getColsWidth(t,i),b=ht("buttonPadding",r,t,e,f),y=ht("buttonLineWidth",r,t,e,f);let C=0;if(o){const w=v-(g[1]+g[3]);dat.setAttributes({text:m,textStyle:{maxLineWidth:w,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:u,lineHeight:d,wordBreak:"break-word",lineClamp:c},padding:b,panel:{visible:!0,fill:"red",stroke:"red",lineWidth:y}}),qd.render(),C=qd.AABBBounds.height()}else C=m.length*d+2*b;return C}let mat="",r1="quick";const vat=new Ot(((n,t,e,i)=>{e(ws)?i(ws).to(K2).inSingletonScope():n(ws).to(K2).inSingletonScope()}));new Ot(((n,t,e,i)=>{e(ws)?i(ws).to(mu).inSingletonScope():n(ws).to(mu).inSingletonScope()}));const q2=new Map;function o1(n,t,e,i="normal"){const r=`${n}-${t}-${e}-${i}`,o=q2.get(r);if(o)return o;const s=(a={fontSize:n,fontFamily:e,fontWeight:t,fontStyle:i},new er(Object.assign({defaultFontParams:{fontFamily:zn.fontFamily,fontSize:zn.fontSize},getTextBounds:vv,specialCharSet:`{}()//&-/: .,@%'"~…=——${er.ALPHABET_CHAR_SET}${er.ALPHABET_CHAR_SET.toUpperCase()}0123456789${mat}`},{}),a));var a;return q2.set(r,s),s}class K2 extends mu{_fastMeasure(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:s="normal"}=e,a=o1(i,o,r,s).measure(t,r1);if(!$(a.fontBoundingBoxAscent)&&!$(a.fontBoundingBoxDescent)){const{ascent:l,descent:h}=this.measureTextBoundADscentEstimate(e);a.fontBoundingBoxAscent=l,a.fontBoundingBoxDescent=h}return a}measureTextWidth(t,e){return this._fastMeasure(t,e).width}measureText(t,e){return this._fastMeasure(t,e)}_measureTextWithoutAlignBaseline(t,e,i){return this._fastMeasure(t,e)}_measureTextWithAlignBaseline(t,e,i){return this._fastMeasure(t,e)}}class bat{measureText(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:s="normal"}=e;return o1(i,o,r,s).measure(t,r1)}measureTextWidth(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:o="normal",fontStyle:s="normal"}=e;return o1(i,o,r,s).measure(t,r1).width}clipText(t,e,i){if(t.length===0)return{str:"",width:0};let r=this.measureTextWidth(t,e);return r<=i?{str:t,width:r}:(r=this.measureTextWidth(t[0],e),r>i?{str:"",width:0}:this._clipText(t,e,i,0,t.length-1))}_clipText(t,e,i,r,o){const s=Math.floor((r+o)/2),a=t.substring(0,s+1),l=this.measureTextWidth(a,e);let h;if(l>i){if(a.length<=1)return{str:"",width:0};const u=t.substring(0,s);return h=this.measureTextWidth(u,e),h<=i?{str:u,width:h}:this._clipText(t,e,i,r,s)}if(l<i){if(s>=t.length-1)return{str:t,width:this.measureTextWidth(t,e)};const u=t.substring(0,s+2);return h=this.measureTextWidth(u,e),h>=i?{str:a,width:l}:this._clipText(t,e,i,s,o)}return{str:a,width:l}}clipTextWithSuffix(t,e,i,r){if(r==="")return this.clipText(t,e,i);if(t.length===0)return{str:"",width:0};const o=this.measureTextWidth(t,e);if(o<=i)return{str:t,width:o};const s=this.measureTextWidth(r,e);if(s>i)return{str:"",width:0};i-=s;const a=this._clipText(t,e,i,0,t.length-1);return a.str+=r,a.width+=s,a}}const nS=new bat,Z2=new Oe({ignoreBuf:!0});function QD(n){return Z2.initAttributes(Object.assign(Object.assign({},n),{ignoreBuf:!0})),Z2.AABBBounds}const J2=new ti({width:0,height:0,textConfig:[]});function Lr(n,t,e,i=!0,r){var o,s,a,l,h,u,d,c,g,f,p;typeof window<"u"&&window.performance.now();const m=[],v=[];if(r)for(let _=t;_<=e;_++)m[_]=n.getRowHeight(_);const b=n.internalProps.layoutMap;n.isPivotTable()&&(b.enableUseGetBodyCache(),b.enableUseHeaderPathCache()),n.defaultHeaderRowHeight,n.defaultHeaderColWidth;const y=n.defaultHeaderRowHeight==="auto"||wt(n.defaultHeaderRowHeight)&&n.defaultHeaderRowHeight.some((_=>_==="auto")),C=n.isAutoRowHeight(t)||n.heightMode==="adaptive"&&n.options.autoHeightInAdaptiveMode!==!1,w=n.options.defaultRowHeight==="auto";if(C||y||w){t=t??0,e=e??n.rowCount-1,(t===0&&e===n.rowCount-1||i)&&n._clearRowRangeHeightsMap();for(let _=t;_<n.columnHeaderLevelCount;_++){let A=0,x=n.colCount-1;if((n.isPivotTable()&&!n.isPivotChart()||n.isPivotChart()&&!n.internalProps.layoutMap.indicatorsAsCol)&&_at(n,_)&&!mi(n,n.rowHeaderLevelCount,_)&&(A=0,x=n.rowHeaderLevelCount),C||n.getDefaultRowHeight(_)==="auto"){const S=Ar(_,A,x,n);v[_]=Math.round(S),n.heightAdaptiveMode!=="only-body"&&r||n._setRowHeight(_,S)}}for(let _=n.rowCount-n.bottomFrozenRowCount;_<=e;_++)if(C||n.getDefaultRowHeight(_)==="auto"){const A=Ar(_,0,n.colCount-1,n);r?v[_]=Math.round(A):n._setRowHeight(_,A)}if(!(e<n.columnHeaderLevelCount||!C&&!w))if(n.internalProps.transpose||n.isPivotTable()&&!n.internalProps.layoutMap.indicatorsAsCol||n.options.customComputeRowHeight||!yat(n,t))if(n.internalProps.transpose||n.isPivotTable()&&!n.internalProps.layoutMap.indicatorsAsCol)for(let _=Math.max(t,n.columnHeaderLevelCount);_<=e;_++){let A;A=Cat(n,_)?Ar(_,0,n.rowHeaderLevelCount,n):Ar(_,0,n.colCount-1,n),r?v[_]=Math.round(A):n._setRowHeight(_,A)}else for(let _=Math.max(t,n.columnHeaderLevelCount);_<=e;_++){const A=Ar(_,0,n.colCount-1,n);r?v[_]=Math.round(A):n._setRowHeight(_,A)}else{wat(Ar(n.columnHeaderLevelCount,0,n.colCount-1,n),n.columnHeaderLevelCount,n.rowCount-1-n.bottomFrozenRowCount,n,r?v:void 0);for(let _=n.rowCount-n.bottomFrozenRowCount;_<=e;_++){const A=Ar(_,0,n.colCount-1,n);r?v[_]=Math.round(A):n._setRowHeight(_,A)}}}else if((n.heightMode==="adaptive"||n.autoFillHeight)&&n.clearRowHeightCache(),r)for(let _=t;_<=e;_++)v[_]=n.getRowHeight(_);if((t===0&&e===n.rowCount-1||i)&&n._clearRowRangeHeightsMap(),n.heightMode==="adaptive"){n._clearRowRangeHeightsMap();let _=n.tableNoFrameHeight,A=0,x=n.rowCount;if(n.heightAdaptiveMode==="only-body"){const M=n.getRowsHeight(0,n.columnHeaderLevelCount-1),R=n.isPivotChart()?n.getBottomFrozenRowsHeight():0;_=n.tableNoFrameHeight-M-R,A=n.columnHeaderLevelCount,x=n.isPivotChart()?n.rowCount-n.bottomFrozenRowCount:n.rowCount}let S=0;for(let M=A;M<x;M++)S+=r&&(o=v[M])!==null&&o!==void 0?o:n.getRowHeight(M);const T=_/S;for(let M=A;M<x;M++){let R;R=M===x-1?_-(r?v.reduce(((E,P,B)=>B>=A&&B<=x-2?E+P:E),0):n.getRowsHeight(A,x-2)):Math.round((r&&(s=v[M])!==null&&s!==void 0?s:n.getRowHeight(M))*T),r?v[M]=R:n._setRowHeight(M,R,!1)}}else if(n.autoFillHeight){n._clearRowRangeHeightsMap();const _=n.tableNoFrameHeight;let A=0,x=0;for(let S=0;S<n.rowCount;S++){const T=r&&(a=v[S])!==null&&a!==void 0?a:n.getRowHeight(S);(S<n.columnHeaderLevelCount||n.isPivotChart()&&S>=n.rowCount-n.bottomFrozenRowCount)&&(x+=T),A+=T}if(n.scenegraph._dealAutoFillHeightOriginRowsHeight=A,A<_&&A-x>0){const S=n.columnHeaderLevelCount,T=n.isPivotChart()?n.rowCount-n.bottomFrozenRowCount:n.rowCount,M=(_-x)/(A-x);for(let R=S;R<T;R++){let E;E=R===T-1?_-x-(r?v.reduce(((P,B,k)=>k>=S&&k<=T-2?P+B:P),0):n.getRowsHeight(S,T-2)):Math.round((r&&(l=v[R])!==null&&l!==void 0?l:n.getRowHeight(R))*M),r?v[R]=E:n._setRowHeight(R,E,!1)}}}if(r){for(let _=t;_<=e;_++){const A=(h=v[_])!==null&&h!==void 0?h:n.getRowHeight(_);$(A)&&n._setRowHeight(_,A)}for(let _=0;_<=n.frozenRowCount-1;_++){const A=n.getRowHeight(_);A!==((u=m[_])!==null&&u!==void 0?u:n.getRowHeight(_))&&n.scenegraph.updateRowHeight(_,A-((d=m[_])!==null&&d!==void 0?d:n.getRowHeight(_)),!0)}for(let _=n.rowCount-n.bottomFrozenRowCount;_<=n.rowCount-1;_++){const A=n.getRowHeight(_);A!==((c=m[_])!==null&&c!==void 0?c:n.getRowHeight(_))&&n.scenegraph.updateRowHeight(_,A-((g=m[_])!==null&&g!==void 0?g:n.getRowHeight(_)),!0)}for(let _=n.scenegraph.proxy.rowStart;_<=n.scenegraph.proxy.rowEnd;_++){const A=n.getRowHeight(_);A!==((f=m[_])!==null&&f!==void 0?f:n.getRowHeight(_))&&n.scenegraph.updateRowHeight(_,A-((p=m[_])!==null&&p!==void 0?p:n.getRowHeight(_)),!0)}}n.isPivotTable()&&(b.disableUseGetBodyCache(),b.disableUseHeaderPathCache())}function Ar(n,t,e,i){var r;if(!(i.isAutoRowHeight(n)||i.heightMode==="adaptive"&&i.options.autoHeightInAdaptiveMode!==!1)&&i.getDefaultRowHeight(n)!=="auto")return i.getDefaultRowHeight(n);let o;if(i.options.customComputeRowHeight){const a=i.options.customComputeRowHeight({row:n,table:i});if(typeof a=="number")return a;if(a!=="auto")return i.getDefaultRowHeight(n)}if(i.isPivotChart()&&n>=i.columnHeaderLevelCount&&n<i.rowCount-i.bottomFrozenRowCount){let a=i.internalProps.layoutMap.indicatorsAsCol,l=!1;if(i.internalProps.layoutMap.indicatorsAsCol||i.internalProps.layoutMap.getChartSpec(i.rowHeaderLevelCount,n).type==="heatmap"&&(l=!0,a=!0),a){const h=i.internalProps.layoutMap.getOptimunHeightForChart(n,l);if(h>0)return h}else{const h=i.getDefaultRowHeight(n);if(dt(h))return h}}for(let a=t;a<=e;a++){const l=xat(a,n,i);if(l&&(o=$(o)?Math.max(l.height,o):l.height,!l.renderDefault))continue;if(i.isPivotChart()){const u=i.internalProps.layoutMap.getAxisConfigInPivotChart(a,n);if(u){const d=St.getFunction("computeAxisComponentHeight")(u,i);if(typeof d=="number"){o=$(o)?Math.max(d,o):d;continue}}}if(i.isPivotChart()&&(i.isLeftFrozenColumn(a)&&i.isBottomFrozenRow(n)||i.isRightFrozenColumn(a)&&i.isBottomFrozenRow(n)))continue;const h=Sat(a,n,i.isHeader(a,n)?(r=i._getHeaderLayoutMap(a,n))===null||r===void 0?void 0:r.headerType:i.getBodyColumnType(a,n),i);o=$(o)?Math.max(h,o):h}if($(o))return o;const s=i.getDefaultRowHeight(n);return dt(s)?s:i.defaultRowHeight}function yat(n,t){var e,i,r;const{layoutMap:o}=n.internalProps,s=n.columnHeaderLevelCount;if((n.internalProps.autoWrapText||n.internalProps.enableLineBreak||n.isPivotChart())&&(n.isAutoRowHeight(t)||n.options.heightMode==="adaptive"))return!1;for(let a=0;a<n.colCount;a++){const l=o.getBody(a,s);if(l.cellType==="radio"||typeof l.style=="function"||typeof l.icon=="function"||!((e=l.define)===null||e===void 0)&&e.customRender||!((i=l.define)===null||i===void 0)&&i.customLayout||typeof((r=l.define)===null||r===void 0?void 0:r.icon)=="function")return!1;const h=n._getCellStyle(a,s);if(typeof h.padding=="function"||typeof h.fontSize=="function"||typeof h.lineHeight=="function"||h.autoWrapText===!0)return!1}return!0}function Cat(n,t){var e,i,r;const{layoutMap:o}=n.internalProps;if((n.internalProps.autoWrapText||n.internalProps.enableLineBreak)&&(n.isAutoRowHeight(t)||n.options.heightMode==="adaptive"))return!1;const s=o.getBody(n.rowHeaderLevelCount,t);if(typeof s.style=="function"||typeof s.icon=="function"||!((e=s.define)===null||e===void 0)&&e.customRender||!((i=s.define)===null||i===void 0)&&i.customLayout||typeof((r=s.define)===null||r===void 0?void 0:r.icon)=="function")return!1;const a=n._getCellStyle(n.rowHeaderLevelCount,t);return typeof a.padding!="function"&&typeof a.fontSize!="function"&&typeof a.lineHeight!="function"&&a.autoWrapText!==!0}function _at(n,t){var e,i,r;const{layoutMap:o}=n.internalProps;if(n.internalProps.autoWrapText&&(n.isAutoRowHeight(t)||n.options.heightMode==="adaptive"))return!1;const s=o.getHeader(n.rowHeaderLevelCount,t);if(typeof s.style=="function"||typeof s.icons=="function"||!((e=s.define)===null||e===void 0)&&e.headerCustomRender||!((i=s.define)===null||i===void 0)&&i.headerCustomLayout||typeof((r=s.define)===null||r===void 0?void 0:r.icon)=="function")return!1;const a=n._getCellStyle(n.rowHeaderLevelCount,t);return typeof a.padding!="function"&&typeof a.fontSize!="function"&&typeof a.lineHeight!="function"&&a.autoWrapText!==!0}function wat(n,t,e,i,r){if(!i.internalProps.useOneRowHeightFillAll){for(let o=t;o<=e;o++)r?r[o]=n:i._setRowHeight(o,n);i.internalProps.useOneRowHeightFillAll=!0}}function xat(n,t,e){var i,r,o,s,a,l,h;const u=e.getCustomRender(n,t);let d=e.getCustomLayout(n,t);if(u||d){let c,g=1,f=0,p=!1,m=!1;(e.isHeader(n,t)||!((i=e.getBodyColumnDefine(n,t))===null||i===void 0)&&i.mergeCell||e.hasCustomMerge())&&(c=e.getCellRange(n,t),g=c.end.row-c.start.row+1);const v={col:(r=c?.start.col)!==null&&r!==void 0?r:n,row:(o=c?.start.row)!==null&&o!==void 0?o:t,dataValue:e.getCellOriginValue(n,t),value:e.getCellValue(n,t)||"",rect:Aat(n,t,e),table:e,originCol:n,originRow:t,forComputation:!0};if(d==="react-custom-layout"&&(d=((s=e.reactCustomLayout)===null||s===void 0?void 0:s.getCustomLayoutFunc(n,t))||jc),ur(d)){const b=d(v);b.rootContainer?(b.rootContainer=Vc(b.rootContainer),Fv(b.rootContainer,e.getColWidth(n),0),b.rootContainer.setStage(e.scenegraph.stage),f=(a=b.rootContainer.AABBBounds.height())!==null&&a!==void 0?a:0,p=b.renderDefault,m=b.enableCellPadding):(f=0,p=b.renderDefault,m=b.enableCellPadding)}else if(typeof u=="function"){const b=u(v);f=(l=b?.expectedHeight)!==null&&l!==void 0?l:0,p=b?.renderDefault}else f=(h=u?.expectedHeight)!==null&&h!==void 0?h:0,p=u?.renderDefault;if(m){const b=e._getCellStyle(n,t),y=Kt(ht("padding",b,n,t,e));f+=y[0]+y[2]}return{height:f/g,renderDefault:p}}}function Sat(n,t,e,i){var r,o,s,a;let l=0;const h=i.getCellValue(n,t),u=i._getCellStyle(n,t);let d=0,c=0;const g=[];let f=0;const p=[];let m=0,v=!1;if(i.getCellLocation(n,t)!=="body")v=!0;else{const B=i.getBodyColumnDefine(n,t);v=!!B?.icon||!!B?.tree||B?.dragOrder}if(v){const B=i.getCellIcons(n,t);B?.forEach((k=>{var L,O,I,H,D,z,G,U,j,X;k.positionType!==pe.absoluteRight&&k.positionType!==pe.inlineFront&&k.positionType!==pe.inlineEnd?(c+=((L=k.width)!==null&&L!==void 0?L:0)+((O=k.marginLeft)!==null&&O!==void 0?O:0)+((I=k.marginRight)!==null&&I!==void 0?I:0),d=Math.max(d,(H=k.height)!==null&&H!==void 0?H:0)):k.positionType===pe.inlineFront?(g.push(k),f=Math.max(f,((D=k.height)!==null&&D!==void 0?D:0)+((z=k.marginLeft)!==null&&z!==void 0?z:0)+((G=k.marginRight)!==null&&G!==void 0?G:0))):k.positionType===pe.inlineEnd&&(p.push(k),m=Math.max(m,((U=k.height)!==null&&U!==void 0?U:0)+((j=k.marginLeft)!==null&&j!==void 0?j:0)+((X=k.marginRight)!==null&&X!==void 0?X:0)))}))}let b=1,y=n;if(i.isHeader(n,t)||!((r=i.getBodyColumnDefine(n,t))===null||r===void 0)&&r.mergeCell||i.hasCustomMerge()){const B=i.getCellRange(n,t);b=B.end.row-B.start.row+1,n=B.start.col,y=B.end.col}const C=Kt(ht("padding",u,n,t,i)),w=ht("fontSize",u,n,t,i),_=ht("fontStyle",u,n,t,i),A=ht("fontWeight",u,n,t,i),x=(o=ht("lineHeight",u,n,t,i))!==null&&o!==void 0?o:w,S=ht("fontFamily",u,n,t,i),T=ht("autoWrapText",u,n,t,i),M=ht("lineClamp",u,n,t,i),R=ht("underline",u,n,t,i),E=(s=ht("underlineOffset",u,n,t,i))!==null&&s!==void 0?s:0;let P;if(e!=="text"&&e!=="link"&&e!=="progressbar"&&e!=="checkbox"&&e!=="radio"&&e!=="switch"&&e!=="button")l=x;else if(e==="checkbox")l=cat(h,n,t,y,u,T,c,w,_,A,S,x,M,C,i);else if(e==="radio")l=gat(h,n,t,y,u,T,c,w,_,A,S,x,M,C,i);else if(e==="switch")l=fat(h,n,t,y,u,T,c,w,_,A,S,x,M,C,i);else if(e==="button")l=pat(h,n,t,y,u,T,c,w,_,A,S,x,M,C,i);else{P=h;const B=Gc(P,i).text,k=i.getColsWidth(n,y);if(g.length||p.length)if(T){const L=Object.assign({text:h?.toString(),fontFamily:S,fontSize:w,fontStyle:_,fontWeight:A,lineHeight:x});L.textBaseline="middle";const O=[...g.map((I=>G0(I))),L,...p.map((I=>G0(I)))];J2.setAttributes({width:k-(C[1]+C[3])-c,height:0,textConfig:O}),l=J2.AABBBounds.height()}else l=0,B.forEach(((L,O)=>{var I;!((I=i.options.customConfig)===null||I===void 0)&&I.multilinesForXTable&&O!==0||(O===0&&g.length?l+=Math.max(x,f):O===B.length-1&&p.length?l+=Math.max(x,m):l+=x)}));else if(T){const L=Nn(n,t,i),O=k-(C[1]+C[3])-c-L;l=(QD({maxLineWidth:O,text:B,fontSize:w,fontStyle:_,fontWeight:A,fontFamily:S,lineHeight:x,wordBreak:"break-word",whiteSpace:B.length!==1||T?"normal":"no-wrap",lineClamp:M}).height()||(typeof x=="number"?x:w))+(R?E:0)}else l=!((a=i.options.customConfig)===null||a===void 0)&&a.multilinesForXTable?x:B.length*x}return(Math.max(l,d)+C[0]+C[2])/b}function Aat(n,t,e){return{left:0,top:0,right:e.getColWidth(n),bottom:e.getRowHeight(t),width:e.getColWidth(n),height:0}}function ka(n,t){if(!t||!t.proxy)return{colStart:0,colEnd:0,rowStart:0,rowEnd:0};const{mergeStartCol:e,mergeEndCol:i,mergeStartRow:r,mergeEndRow:o,col:s,row:a}=n;return{colStart:e,colEnd:i,rowStart:r,rowEnd:o}}function Mat(n,t){const e=n.start.col,i=n.end.col,r=n.start.row,o=n.end.row;let s=e,a=i,l=r,h=o;for(let u=e;u<=i;u++)for(let d=r;d<=o;d++){const c=t.getCellRange(u,d);c&&(s=Math.min(s,c.start.col),a=Math.max(a,c.end.col),l=Math.min(l,c.start.row),h=Math.max(h,c.end.row))}return n.start.col=s,n.end.col=a,n.start.row=l,n.end.row=h,n}function Q2(n,t,e,i){!i&&e&&n.table._setRowHeight(t,n.table.getRowHeight(t)+e,!0);for(let s=0;s<n.table.colCount;s++){const a=n.getCell(s,t);if(a.role==="empty")continue;const l=mi(n.table,s,t);l&&l.start.col!==s||(tF(n,a,s,t,a.attribute.height+e,e,n.table.isHeader(s,t)),n.updateCellContentWhileResize(s,t))}let r=0,o=0;t<n.table.frozenRowCount?(r=t+1,o=n.table.frozenRowCount-1):t>=n.table.rowCount-n.table.bottomFrozenRowCount?(r=t+1,o=n.table.rowCount-1):(r=t+1,o=Math.min(n.proxy.rowEnd,n.table.rowCount-n.table.bottomFrozenRowCount-1));for(let s=0;s<n.table.colCount;s++)for(let a=r;a<=o;a++){const l=n.highPerformanceGetCell(s,a);l.role==="cell"&&l.setAttribute("y",l.attribute.y+e)}}function tF(n,t,e,i,r,o,s){t&&Tat(n,t,e,i,r,o)}function Tat(n,t,e,i,r,o,s){var a,l,h,u,d;if(t.attribute.height===r&&!t.needUpdateHeight)return;t.needUpdateHeight=!1,t.setAttribute("height",r);const c=(a=n.table.getCellRawRecord(e,i))===null||a===void 0?void 0:a.vtableMerge,g=!!n.table.getCustomMerge(e,i),f=c||g?"text":n.table.isHeader(e,i)?(l=n.table._getHeaderLayoutMap(e,i).headerType)!==null&&l!==void 0?l:"text":(h=n.table.getBodyColumnType(e,i))!==null&&h!==void 0?h:"text";if(f==="progressbar"){const p=n.table.getBodyColumnDefine(e,i),m=n.table._getCellStyle(e,i),v=n.table.getCellValue(e,i),b=n.table.getCellOriginValue(e,i),y=Kt(ht("padding",m,e,i,n.table));let C;p?.mergeCell&&(C=n.table.getCellRange(e,i));const w=St.getFunction("createProgressBarCell")(p,m,t.attribute.width,v,b,e,i,y,n.table,C),_=t.getChildByName("progress-bar");t.insertBefore(w,_),t.removeChild(_),_.removeAllChild(),_.release(),tk(t,r,o,n.table.isAutoRowHeight(i),!0,n.table)}else if(f==="sparkline"){t.removeAllChild();const p=n.table._getCellStyle(e,i),m=Kt(ht("padding",p,e,i,n.table));St.getFunction("createSparkLineCellGroup")(t,t.parent,t.attribute.x,t.attribute.y,e,i,t.attribute.width,t.attribute.height,m,n.table,Ba(p,n.table,e,i,ht).theme,!1)}else if(f==="image"||f==="video")$c(t,e,i,0,o,n.table);else if(((u=t.firstChild)===null||u===void 0?void 0:u.name)==="axis")(d=t.firstChild)===null||d===void 0||d.originAxis.resize(t.attribute.width,t.attribute.height);else{let p=!0;const m=t.getChildByName(ho)||t.getChildByName(V0);if(m){let v;t.removeChild(m);const b=X0(e,i,t,n.table);if(b)for(let y=b.start.row;y<=b.end.row;y++){if(y===i)continue;const C=n.getCell(e,y),w=C.getChildByName(ho)||C.getChildByName(V0);w.removeAllChild(),C.removeChild(w),X0(e,y,C,n.table)}else{let y,C;const w=n.table.getCellLocation(e,i),{vtableMerge:_}=n.table.getCellRawRecord(e,i)||{};if(_&&n.table.internalProps.groupTitleCustomLayout)C=n.table.internalProps.groupTitleCustomLayout;else if(w!=="body"){const A=n.table.getHeaderDefine(e,i);y=A?.headerCustomRender,C=A?.headerCustomLayout}else{const A=n.table.getBodyColumnDefine(e,i);y=A?.customRender||n.table.customRender,C=A?.customLayout}if((y||C)&&sa(t))for(let A=t.mergeStartCol;A<=t.mergeEndCol;A++)for(let x=t.mergeStartRow;x<=t.mergeEndRow;x++)x!==i&&n.updateCellContent(A,x);if(C||y){const A=n.table._getCellStyle(e,i),x=Kt(ht("padding",A,e,i,n.table));let S=t.attribute.width,T=t.attribute.height;sa(t)&&(S=n.table.getColsWidth(t.mergeStartCol,t.mergeEndCol),T=n.table.getRowsHeight(t.mergeStartRow,t.mergeEndRow));const M=_a(C,y,e,i,S,T,!1,n.table.isAutoRowHeight(i),x,sa(t)?{start:{col:t.mergeStartCol,row:t.mergeStartRow},end:{col:t.mergeEndCol,row:t.mergeEndRow}}:void 0,n.table);v=M.elementsGroup,p=M.renderDefault}t.childrenCount>0&&v?t.insertBefore(v,t.firstChild):v&&t.appendChild(v)}}tk(t,r,o,n.table.isAutoRowHeight(i),p,n.table)}}function tk(n,t,e,i,r,o){if(sa(n)){t=0;for(let u=n.mergeStartRow;u<=n.mergeEndRow;u++)t+=o.getRowHeight(u);const{colStart:s,colEnd:a,rowStart:l,rowEnd:h}=ka(n,o.scenegraph);for(let u=s;u<=a;u++)for(let d=l;d<=h;d++){const c=o.scenegraph.getCell(u,d);if(c.role!=="cell")continue;if(c.forEachChildren((m=>{m.setAttributes({dx:0,dy:0})})),r){const m=o._getCellStyle(s,l),v=Kt(ht("padding",m,u,d,o));U0(c,t,e,i,v,m.textAlign,m.textBaseline,o)}const g=o.getRowHeight(d),f=o.getColWidth(u);c.contentHeight=t;const{widthChange:p}=bg(c,f,g,{start:{col:n.mergeStartCol,row:n.mergeStartRow},end:{col:n.mergeEndCol,row:n.mergeEndRow}},o);p&&(c.needUpdateWidth=!0)}}else{const s=o._getCellStyle(n.col,n.row),a=Kt(ht("padding",s,n.col,n.row,o));U0(n,t,e,i,a,s.textAlign,s.textBaseline,o)}}function Rat(n,t,e,i){i||n.table._setColWidth(t,n.table.getColWidth(t)+e,!0);const r=n.getColGroup(t,!0),o=n.getColGroupInRightTopCorner(t);r&&!o&&ah(r,e,"col-corner",n),o&&ah(o,e,"right-top",n);const s=n.getColGroup(t);s&&ah(s,e,"row-body",n);const a=n.getColGroupInLeftBottomCorner(t);a&&ah(a,e,"left-bottom",n);const l=n.getColGroupInBottom(t);l&&ah(l,e,"bottom",n);const h=n.getColGroupInRightBottomCorner(t);h&&ah(h,e,"right-bottom",n),t<n.frozenColCount?(n.cornerHeaderGroup.forEachChildrenSkipChild(((u,d)=>{u.col>t&&u.setAttribute("x",u.attribute.x+e)})),n.rowHeaderGroup.forEachChildrenSkipChild(((u,d)=>{u.col>t&&u.setAttribute("x",u.attribute.x+e)}))):(n.colHeaderGroup.forEachChildrenSkipChild(((u,d)=>{u.col>t&&u.setAttribute("x",u.attribute.x+e)})),n.bodyGroup.forEachChildrenSkipChild(((u,d)=>{u.col>t&&u.setAttribute("x",u.attribute.x+e)}))),a&&n.leftBottomCornerGroup.forEachChildrenSkipChild(((u,d)=>{u.col>t&&u.setAttribute("x",u.attribute.x+e)})),l&&n.bottomFrozenGroup.forEachChildrenSkipChild(((u,d)=>{u.col>t&&u.setAttribute("x",u.attribute.x+e)})),h&&n.rightBottomCornerGroup.forEachChildrenSkipChild(((u,d)=>{u.col>t&&u.setAttribute("x",u.attribute.x+e)}))}function ah(n,t,e,i){var r,o,s,a,l,h,u;let d=!1;const c=(r=n?.attribute.width)!==null&&r!==void 0?r:0;if(n?.setAttribute("width",c+t),n?.forEachChildren(((g,f)=>{if(Bat(i,g,g.col,g.row,c,c+t,t,e!=="row-body"||g.col<i.table.rowHeaderLevelCount,i.table.internalProps.autoWrapText)){const p=mi(i.table,g.col,g.row);if(p&&p.end.row-p.start.row)for(let m=p.start.row;m<=p.end.row;m++)ik(i,m);else ik(i,g.row);d=!0}})),d){let g,f,p,m=0;for(let v=0;v<i.table.colCount;v++){if(e==="col-corner"?(p=0,g=i.getColGroup(v,!0),f=(o=i.colHeaderGroup.attribute.height)!==null&&o!==void 0?o:0):e==="row-body"?(p=i.table.frozenRowCount,g=i.getColGroup(v,!1),f=(s=i.bodyGroup.attribute.height)!==null&&s!==void 0?s:0):e==="bottom"?(p=i.table.rowCount-i.table.bottomFrozenRowCount,g=i.getColGroupInBottom(v),f=(a=i.bottomFrozenGroup.attribute.height)!==null&&a!==void 0?a:0):e==="left-bottom"?(p=i.table.rowCount-i.table.bottomFrozenRowCount,g=i.getColGroupInLeftBottomCorner(v),f=(l=i.leftBottomCornerGroup.attribute.height)!==null&&l!==void 0?l:0):e==="right-top"?(p=0,g=i.getColGroupInRightTopCorner(v),f=(h=i.rightTopCornerGroup.attribute.height)!==null&&h!==void 0?h:0):e==="right-bottom"&&(p=i.table.rowCount-i.table.bottomFrozenRowCount,g=i.getColGroupInRightBottomCorner(v),f=(u=i.rightBottomCornerGroup.attribute.height)!==null&&u!==void 0?u:0),!g)continue;let b=0;g.forEachChildren((y=>{var C;y.setAttribute("y",b),b+=(C=i.table.getRowHeight(y.row))!==null&&C!==void 0?C:0})),m=b}i.updateContainerHeight(p,m-f);for(let v=0;v<i.table.frozenColCount;v++){const b=i.getColGroupInLeftBottomCorner(v);let y=0;b?.forEachChildren((C=>{C.setAttribute("y",y),y+=i.table.getRowHeight(C.row)}))}for(let v=i.table.colCount-i.table.rightFrozenColCount;v<i.table.colCount;v++){const b=i.getColGroupInRightBottomCorner(v);let y=0;b?.forEachChildren((C=>{C.setAttribute("y",y),y+=i.table.getRowHeight(C.row)}))}for(let v=i.table.frozenColCount;v<i.table.colCount-i.table.rightFrozenColCount;v++){const b=i.getColGroupInBottom(v);let y=0;b?.forEachChildren((C=>{C.setAttribute("y",y),y+=i.table.getRowHeight(C.row)}))}}}function Bat(n,t,e,i,r,o,s,a,l){var h,u,d,c,g,f,p;if(t.attribute.width===o&&!t.needUpdateWidth)return!1;t.needUpdateWidth=!1,t.setAttribute("width",o);const m=t;if(!m)return!1;const v=n.table.isAutoRowHeight(i),b=(h=n.table.getCellRawRecord(e,i))===null||h===void 0?void 0:h.vtableMerge,y=!!n.table.getCustomMerge(e,i),C=b||y?"text":n.table.isHeader(e,i)?(u=n.table._getHeaderLayoutMap(e,i).headerType)!==null&&u!==void 0?u:"text":(d=n.table.getBodyColumnType(e,i))!==null&&d!==void 0?d:"text";let w=!1;if(C==="progressbar"){const _=n.table.getBodyColumnDefine(e,i),A=n.table._getCellStyle(e,i),x=n.table.getCellValue(e,i),S=n.table.getCellOriginValue(e,i),T=Kt(ht("padding",A,e,i,n.table));let M;_?.mergeCell&&(M=n.table.getCellRange(e,i));const R=St.getFunction("createProgressBarCell")(_,A,m.attribute.width,x,S,e,i,T,n.table,M),E=m.getChildByName("progress-bar");m.insertBefore(R,E),m.removeChild(E),E.removeAllChild(),E.release();const P=ek(m,o,s,v,!0,n.table);w=w||P}else if(C==="sparkline"){m.removeAllChild();const _=n.table._getCellStyle(e,i),A=Kt(ht("padding",_,e,i,n.table));St.getFunction("createSparkLineCellGroup")(m,m.parent,m.attribute.x,m.attribute.y,e,i,m.attribute.width,m.attribute.height,A,n.table,Ba(_,n.table,e,i,ht).theme,!1)}else if(C==="image"||C==="video")$c(m,e,i,s,0,n.table);else if(((c=m.firstChild)===null||c===void 0?void 0:c.name)==="axis"){const _=n.table.internalProps.layoutMap.getAxisConfigInPivotChart(e,i),A=n.table._getCellStyle(e,i),x=Kt(ht("padding",A,e,i,n.table));if(_){const S=new(St.getComponent("axis"))(_,m.attribute.width,m.attribute.height,(g=_.__vtablePadding)!==null&&g!==void 0?g:x,n.table);m.clear(),m.appendChild(S.component),S.overlap()}}else if(((f=t.firstChild)===null||f===void 0?void 0:f.name)==="axis")(p=t.firstChild)===null||p===void 0||p.originAxis.resize(t.attribute.width,t.attribute.height);else{let _=!0;const A=t.getChildByName(ho)||t.getChildByName(V0);if(A){let S;t.removeChild(A);const T=X0(e,i,t,n.table);if(T)for(let M=T.start.col;M<=T.end.col;M++){if(M===e)continue;const R=n.getCell(M,i),E=R.getChildByName(ho)||R.getChildByName(V0);E.removeAllChild(),R.removeChild(E),X0(M,i,R,n.table)}else{let M,R;const E=n.table.getCellLocation(e,i),{vtableMerge:P}=n.table.getCellRawRecord(e,i)||{};if(P&&n.table.internalProps.groupTitleCustomLayout)R=n.table.internalProps.groupTitleCustomLayout;else if(E!=="body"){const B=n.table.getHeaderDefine(e,i);M=B?.headerCustomRender,R=B?.headerCustomLayout}else{const B=n.table.getBodyColumnDefine(e,i);M=B?.customRender||n.table.customRender,R=B?.customLayout}if((M||R)&&sa(m)){for(let B=m.mergeStartCol;B<=m.mergeEndCol;B++)if(B!==e)for(let k=m.mergeStartRow;k<=m.mergeEndRow;k++)n.updateCellContent(B,k)}if(R||M){const B=n.table._getCellStyle(e,i),k=Kt(ht("padding",B,e,i,n.table));let L=m.attribute.width,O=m.attribute.height;sa(m)&&(L=n.table.getColsWidth(m.mergeStartCol,m.mergeEndCol),O=n.table.getRowsHeight(m.mergeStartRow,m.mergeEndRow));const I=_a(R,M,e,i,L,O,!1,n.table.isAutoRowHeight(i),k,sa(m)?{start:{col:m.mergeStartCol,row:m.mergeStartRow},end:{col:m.mergeEndCol,row:m.mergeEndRow}}:void 0,n.table);S=I.elementsGroup,_=I.renderDefault,w=!0}t.childrenCount>0&&S?t.insertBefore(S,t.firstChild):S&&t.appendChild(S)}}const x=ek(m,o,s,v,_,n.table);w=w||x}return l||(l=n.table._getCellStyle(e,i).autoWrapText),!(!v||!l)&&w}function ek(n,t,e,i,r,o){if(sa(n)){t=0;let u=!1;for(let m=n.mergeStartCol;m<=n.mergeEndCol;m++)t+=o.getColWidth(m);let d=0;for(let m=n.mergeStartRow;m<=n.mergeEndRow;m++)d+=o.getRowHeight(m);const{colStart:c,colEnd:g,rowStart:f,rowEnd:p}=ka(n,o.scenegraph);for(let m=c;m<=g;m++)for(let v=f;v<=p;v++){if(m===n.col&&v!==n.row)continue;const b=o.scenegraph.getCell(m,v);if(b.role!=="cell")continue;b.forEachChildren((A=>{A.setAttributes({dx:0,dy:0})}));let y=!1;if(r){const A=o._getCellStyle(c,f),x=Kt(ht("padding",A,m,v,o)),S=A.textAlign,T=A.textBaseline;y=$0(b,t,d,e,i,x,S,T,o.scenegraph);const M=Nn(b.col,b.row,o);if(M){const R=b.getChildByName("text"),E=b.getChildByName("expand")||b.getChildByName("collapse");E?.role!=="icon-left"&&R&&R.setAttribute("dx",M)}}const C=o.getRowHeight(v),w=o.getColWidth(m);b.contentWidth=t;const{heightChange:_}=bg(b,w,C,{start:{col:n.mergeStartCol,row:n.mergeStartRow},end:{col:n.mergeEndCol,row:n.mergeEndRow}},o);_&&(b.needUpdateHeight=!0),u=u||y}return u}const s=o._getCellStyle(n.col,n.row),a=Kt(ht("padding",s,n.col,n.row,o)),l=s.textAlign,h=s.textBaseline;return $0(n,t,o.getRowHeight(n.row),e,i,a,l,h,o.scenegraph)}function ik(n,t){const e=Math.round(Ar(t,0,n.table.colCount-1,n.table));n.table._setRowHeight(t,e,!0);for(let i=0;i<n.table.colCount;i++){const r=e,o=n.highPerformanceGetCell(i,t);o.role!=="empty"&&tF(n,o,i,t,r,r-o.attribute.height,n.table.isHeader(i,t))}}var Jn;(function(n){n.dropDown="dropDown",n.contextmenu="contextmenu",n.custom="custom"})(Jn||(Jn={}));const $e={fontSize:12,fontFamily:"Arial,sans-serif",color:"#000",highlightColor:"#2E68CF",hoverBgColor:"#EEE",lineHeight:30,bgColor:"#FFF",cornerRadius:4,borderWidth:.5,borderColor:"#CCC",menuPadding:6,menuItemPadding:9,maxLineWidth:200};let kat=class{constructor(t){this._table=t,this._menuInstance=new Vt({x:0,y:0,fill:$e.bgColor,stroke:$e.borderColor,cornerRadius:$e.cornerRadius,lineWidth:$e.borderWidth}),this._menuInfo={x:-1,y:-1,col:-1,row:-1,type:Jn.dropDown,menuInfo:[],highlightIndex:-1}}bindTableComponent(t){t.appendChild(this._menuInstance),this.bindEvent()}release(){}attach(t,e,i,r,o,s){if(o===Jn.dropDown&&this.checkDropDownMenuChange(i,r)){const a=this.getMenuInfo(i,r,o);if(!a)return;const{menuInfo:l,highlightIndex:h}=a;this.updateMenuInfo(i,r,o,l,h),this.updateMenuInstance(l,h)}else if(o===Jn.contextmenu&&this.checkContextMenuChange(t,e)){const a=this.getMenuInfo(i,r,o);if(!a)return;const{menuInfo:l,highlightIndex:h}=a;this.updateMenuInfo(i,r,o,l,h),this.updateMenuInstance(l,h)}this.updatePosition(t-this._table.scenegraph.x,e-this._table.scenegraph.y),this.addToScene()}updateMenuInfo(t,e,i,r,o){this._menuInfo.col=t,this._menuInfo.row=e,this._menuInfo.type=i,this._menuInfo.menuInfo=r,this._menuInfo.highlightIndex=o}checkDropDownMenuChange(t,e){const{type:i,col:r,row:o}=this._menuInfo;return i!==Jn.dropDown||t!==r||e!==o}checkContextMenuChange(t,e){var i;const{type:r,menuInfo:o}=this._menuInfo;return r!==Jn.contextmenu||o!==((i=this._table.internalProps.menu)===null||i===void 0?void 0:i.contextMenuItems)}updateMenuInstance(t,e){this._menuInstance.removeAllChild();let i=$e.menuPadding;const r=$e.menuPadding;let o=0;t.forEach(((s,a)=>{var l,h;const u=e===a;let d,c;typeof s=="string"?c=s:typeof s=="object"&&(c=s.text,d=u?s.selectedIcon:s.icon);const g=new Vt({y:i,x:r,height:$e.lineHeight,fill:$e.bgColor});g.role="menu-item",this._menuInstance.appendChild(g),g.stateProxy=p=>p==="hover"?{fill:$e.hoverBgColor}:{fill:$e.bgColor},g.addEventListener("pointerenter",(p=>{g.addState("hover",!0,!1),this._table.scenegraph.updateNextFrame()})),g.addEventListener("pointerleave",(p=>{g.removeState("hover",!1),this._table.scenegraph.updateNextFrame()}));const f=new Oe({x:$e.menuItemPadding,y:$e.menuItemPadding,fill:u?$e.highlightColor:$e.color,text:c,textBaseline:"top",fontSize:$e.fontSize,fontFamily:$e.fontFamily,pickable:!1,maxLineWidth:$e.maxLineWidth,ellipsis:"…"});if(g.addChild(f),d){f.AABBBounds.height();const p=(l=d.width)!==null&&l!==void 0?l:16,m=(h=d.height)!==null&&h!==void 0?h:16,v=new Wl({x:$e.menuItemPadding,y:($e.lineHeight-m)/2,width:p,height:m,image:d.svg,pickable:!1});v.role="menu-icon",g.insertBefore(v,f),f.setAttribute("x",p+$e.menuItemPadding)}o=Math.max(g.AABBBounds.width(),o),i+=$e.lineHeight})),this._menuInstance.setAttributes({width:o+2*$e.menuItemPadding+2*$e.menuPadding,height:i+$e.menuPadding}),this._menuInstance.forEachChildren((s=>{s.setAttribute("width",o+2*$e.menuItemPadding)}))}updatePosition(t,e){this._menuInstance.setAttributes({x:this._menuInfo.type===Jn.dropDown?t-this._menuInstance.attribute.width:t,y:e}),this._menuInfo.x=Jn.dropDown?t-this._menuInstance.attribute.width:t,this._menuInfo.y=e}addToScene(){this._table.scenegraph.updateNextFrame()}detach(){this._menuInstance.setAttributes({x:-1e3,y:-1e3}),this._table.scenegraph.updateNextFrame()}getMenuInfo(t,e,i){var r;if(i===Jn.dropDown){let o=this._table.globalDropDownMenu;o=this._table._getHeaderLayoutMap(t,e).dropDownMenu,typeof o=="function"&&(o=o({row:e,col:t,table:this._table}));let s=-1;if(Array.isArray(o)){for(let a=0;a<o.length;a++)if(this._table._dropDownMenuIsHighlight(t,e,a)){s=a;break}}return{menuInfo:o,highlightIndex:s}}if(i===Jn.contextmenu){const o=(r=this._table.internalProps.menu)===null||r===void 0?void 0:r.contextMenuItems;let s;if(Array.isArray(o))s=o;else if(typeof o=="function"){const{field:a}=this._table.isHeader(t,e)?this._table.getHeaderDefine(t,e):this._table.getBodyColumnDefine(t,e);s=o(a,e,t)}return{menuInfo:s,highlightIndex:-1}}}bindEvent(){this._menuInstance.addEventListener("click",(t=>{const{target:e}=t;if(e&&e.role==="menu-item"){const i=this.getEventInfo(e),r=this._table.getMenuInfo(this._menuInfo.col,this._menuInfo.row,this._menuInfo.type),o=Object.assign(i,r);o.event=t.nativeEvent,this._table.fireListeners(tt.DROPDOWN_MENU_CLICK,o)}}))}getEventInfo(t){const e=t.parent;let i=0;e.forEachChildren(((s,a)=>s===t&&(i=a-1,!0)));const r=typeof this._menuInfo.menuInfo[i]=="string"?this._menuInfo.menuInfo[i]:this._menuInfo.menuInfo[i].text,o=typeof this._menuInfo.menuInfo[i]=="string"?r:this._menuInfo.menuInfo[i].menuKey||r;return{col:this._menuInfo.col,row:this._menuInfo.row,dropDownIndex:i,highlight:i===this._menuInfo.highlightIndex,text:r,menuKey:o}}get bounds(){return this._menuInstance.globalAABBBounds}};const SC=Fr();class Pat{constructor(){const t=SC.drillDown;this.icon=new Wl({x:-1e3,y:-1e3,image:t.svg,width:t.width,height:t.height,dx:-t.width/2,dy:-t.height/2,visible:!1,funcType:t.funcType,cursor:t.cursor}),this.icon.role="icon-drill"}appand(t){t.appendChild(this.icon)}update(t,e,i,r,o,s){if(!t||r&&o)return this.icon.setAttributes({x:-1e3,y:-1e3,visible:!1}),void s.updateNextFrame();const a=SC.drillDown,l=SC.drillUp;this.icon.setAttributes({x:e,y:i,image:r?a.svg:l.svg,visible:!0}),this.icon.loadImage(this.icon.attribute.image),s.updateNextFrame()}}class Eat{constructor(t){const e=t.theme.dragHeaderSplitLine.lineWidth,i=t.theme.dragHeaderSplitLine.lineColor,r=t.theme.dragHeaderSplitLine.shadowBlockColor;this.columnMoverLabel=yu({visible:!1,pickable:!1,x:0,y:0,symbolType:"triangle",fill:i}),this.columnMoverLine=Ke({visible:!1,pickable:!1,stroke:i,lineWidth:e,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.columnMoverBack=be({visible:!1,pickable:!1,fill:r,x:0,y:0,width:0,height:0}),this.table=t}appand(t){t.appendChild(this.columnMoverLabel),t.appendChild(this.columnMoverLine),t.appendChild(this.columnMoverBack)}show(t,e,i){const r=this.table.getCellLocation(t,e),o=mi(this.table,t,e);o&&(t=o.start.col,e=o.start.row);let s=0,a=0,l=0,h=0,u=0,d=0,c=0,g=0,f=Math.PI;const p=[];return r==="columnHeader"?(s=this.table.getColsWidth(0,t-1)-this.table.stateManager.scroll.horizontalBarPos,a=this.table.getRowsHeight(0,this.table.frozenRowCount-1),h=this.table.tableNoFrameHeight,l=o?this.table.getColsWidth(o.start.col,o.end.col):this.table.getColWidth(t),u=s-i,c=s+l,g=2,p.push({x:0,y:0}),p.push({x:0,y:this.table.tableNoFrameHeight})):(r==="rowHeader"||this.table.internalProps.layoutMap.isSeriesNumberInBody(t,e))&&(a=this.table.getRowsHeight(0,e-1)-this.table.stateManager.scroll.verticalBarPos,s=this.table.getColsWidth(0,this.table.frozenColCount-1),l=this.table.tableNoFrameWidth,h=o?this.table.getRowsHeight(o.start.row,o.end.row):this.table.getRowHeight(e),d=a-i,c=2,g=a+h,f=Math.PI/2,p.push({x:0,y:0}),p.push({x:this.table.tableNoFrameWidth,y:0})),this.columnMoverBack.setAttributes({visible:!0,x:s-u,y:a-d,width:l,height:h,dx:u,dy:d}),this.columnMoverLine.setAttributes({x:c,y:g,visible:!0,points:p}),this.columnMoverLabel.setAttributes({visible:!0,x:c,y:g,angle:f}),{backX:s-u,lineX:c,backY:a-d,lineY:g}}hide(){this.columnMoverLabel.setAttribute("visible",!1),this.columnMoverLine.setAttribute("visible",!1),this.columnMoverBack.setAttribute("visible",!1)}update(t,e,i,r){typeof t=="number"&&typeof e=="number"?(this.columnMoverLabel.setAttribute("x",e),this.columnMoverLine.setAttribute("x",e),this.columnMoverBack.setAttribute("x",t)):typeof i=="number"&&typeof r=="number"&&(this.columnMoverLabel.setAttribute("y",r),this.columnMoverLine.setAttribute("y",r),this.columnMoverBack.setAttribute("y",i))}updateStyle(){const t=this.table.theme.dragHeaderSplitLine.lineWidth,e=this.table.theme.dragHeaderSplitLine.lineColor,i=this.table.theme.dragHeaderSplitLine.shadowBlockColor;this.columnMoverLabel.setAttributes({fill:e}),this.columnMoverLine.setAttributes({stroke:e,lineWidth:t}),this.columnMoverBack.setAttributes({fill:i})}}function Sf(n,t,e){if(e)return Math.min(t.tableNoFrameWidth,t.getAllColsWidth())-t.getColsWidth(n,t.colCount-1);let i=t.getColsWidth(0,n);return n>=t.frozenColCount&&(i-=t.scrollLeft),i}function nk(n,t,e){if(e)return Math.min(t.tableNoFrameWidth,t.getAllRowsHeight())-t.getRowsHeight(n,t.rowCount-1);let i=t.getRowsHeight(0,n);return n>=t.frozenRowCount&&(i-=t.scrollTop),i}class Lat{constructor(t){var e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C;this.table=t;const w=this.table.theme;this.createScrollBar();const _=(e=w.columnResize)===null||e===void 0?void 0:e.lineColor,A=(i=w.columnResize)===null||i===void 0?void 0:i.lineWidth,x=(r=w.columnResize)===null||r===void 0?void 0:r.bgColor,S=(o=w.columnResize)===null||o===void 0?void 0:o.width,T=(a=(s=w.columnResize)===null||s===void 0?void 0:s.labelVisible)===null||a===void 0||a,M=(l=w.columnResize)===null||l===void 0?void 0:l.labelColor,R=(h=w.columnResize)===null||h===void 0?void 0:h.labelFontSize,E=(u=w.columnResize)===null||u===void 0?void 0:u.labelFontFamily,P=(d=w.columnResize)===null||d===void 0?void 0:d.labelBackgroundFill,B=(c=w.columnResize)===null||c===void 0?void 0:c.labelBackgroundCornerRadius;this.labelVisible=T,this.columnResizeLine=Ke({visible:!1,pickable:!1,stroke:_,lineWidth:A,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.columnResizeBgLine=Ke({visible:!1,pickable:!1,stroke:x,lineWidth:S,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]});const k=Bc({visible:!1,pickable:!1,x:0,y:0,fontSize:R,fill:M,fontFamily:E,text:"",textBaseline:"top",dx:16,dy:-R/2}),L=be({visible:!1,pickable:!1,fill:P,x:0,y:0,width:5*R*.8,height:R+8,cornerRadius:B,dx:12,dy:-R/2-4});this.columnResizeLabel=Ip({visible:!1,pickable:!1,x:0,y:0}),this.columnResizeLabel.appendChild(L),this.columnResizeLabel.appendChild(k),this.rowResizeLine=Ke({visible:!1,pickable:!1,stroke:_,lineWidth:A,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.rowResizeBgLine=Ke({visible:!1,pickable:!1,stroke:x,lineWidth:S,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]});const O=Bc({visible:!1,pickable:!1,x:0,y:0,fontSize:R,fill:M,fontFamily:E,text:"",textBaseline:"top",dx:16,dy:-R/2}),I=be({visible:!1,pickable:!1,fill:P,x:0,y:0,width:5*R*.8,height:R+8,cornerRadius:B,dx:12,dy:-R/2-4});this.rowResizeLabel=Ip({visible:!1,pickable:!1,x:0,y:0}),this.rowResizeLabel.appendChild(I),this.rowResizeLabel.appendChild(O),this.cellMover=new Eat(this.table);const H=(f=(g=w.frozenColumnLine)===null||g===void 0?void 0:g.shadow)===null||f===void 0?void 0:f.width,D=(m=(p=w.frozenColumnLine)===null||p===void 0?void 0:p.shadow)===null||m===void 0?void 0:m.startColor,z=(b=(v=w.frozenColumnLine)===null||v===void 0?void 0:v.shadow)===null||b===void 0?void 0:b.endColor,G=(C=(y=w.frozenColumnLine)===null||y===void 0?void 0:y.shadow)===null||C===void 0?void 0:C.visible;this.frozenShadowLine=be({visible:G==="always",pickable:!1,x:0,y:0,width:H,height:0,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:D,offset:0},{color:z,offset:1}]}}),this.rightFrozenShadowLine=be({visible:G==="always",pickable:!1,x:0,y:0,width:H,height:0,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:z,offset:0},{color:D,offset:1}]}}),this.menu=new kat(this.table),this.drillIcon=new Pat}addToGroup(t){t.addChild(this.frozenShadowLine),t.addChild(this.rightFrozenShadowLine),t.addChild(this.columnResizeBgLine),t.addChild(this.columnResizeLine),t.addChild(this.columnResizeLabel),t.addChild(this.rowResizeBgLine),t.addChild(this.rowResizeLine),t.addChild(this.rowResizeLabel),this.table.theme.scrollStyle.hoverOn&&!this.table.theme.scrollStyle.barToSide?(t.addChild(this.hScrollBar),t.addChild(this.vScrollBar)):(t.stage.defaultLayer.addChild(this.hScrollBar),t.stage.defaultLayer.addChild(this.vScrollBar)),this.menu.bindTableComponent(t),this.drillIcon.appand(t),this.cellMover.appand(t)}createScrollBar(){var t,e,i,r,o,s;const a=this.table.theme,l=(t=a.scrollStyle)===null||t===void 0?void 0:t.scrollRailColor,h=(e=a.scrollStyle)===null||e===void 0?void 0:e.scrollSliderColor,u=(i=a.scrollStyle)===null||i===void 0?void 0:i.scrollSliderCornerRadius,d=(r=a.scrollStyle)===null||r===void 0?void 0:r.width,c=(o=a.scrollStyle)===null||o===void 0?void 0:o.horizontalPadding,g=(s=a.scrollStyle)===null||s===void 0?void 0:s.verticalPadding;let f;f=$(u)?{cornerRadius:u,fill:h}:{fill:h},this.hScrollBar=new ks({direction:"horizontal",x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:this.table.tableNoFrameWidth,height:d,padding:c,railStyle:{fill:l},sliderStyle:f,range:[0,.1],visible:!1}),this.hScrollBar.render(),this.hScrollBar.hideAll(),this.vScrollBar=new ks({direction:"vertical",x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:d,height:this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight(),padding:g,railStyle:{fill:l},sliderStyle:f,range:[0,.1],visible:!1}),this.vScrollBar.render(),this.vScrollBar.hideAll()}updateScrollBar(){var t,e,i,r,o,s,a,l,h;const u=this.table.stateManager.scroll.horizontalBarPos,d=this.table.stateManager.scroll.verticalBarPos,c=this.table.theme,g=(t=c.scrollStyle)===null||t===void 0?void 0:t.width,f=(e=c.scrollStyle)===null||e===void 0?void 0:e.visible,p=(r=(i=c.scrollStyle)===null||i===void 0?void 0:i.horizontalVisible)!==null&&r!==void 0?r:f,m=(s=(o=c.scrollStyle)===null||o===void 0?void 0:o.verticalVisible)!==null&&s!==void 0?s:f,v=Math.ceil(this.table.tableNoFrameWidth),b=Math.ceil(this.table.tableNoFrameHeight),y=this.table.getAllRowsHeight(),C=this.table.getAllColsWidth(),w=this.table.getFrozenRowsHeight(),_=this.table.getFrozenColsWidth(),A=this.table.getBottomFrozenRowsHeight(),x=this.table.getRightFrozenColsWidth(),S=this.table.theme.scrollStyle.hoverOn,T=!((a=this.table.options.customConfig)===null||a===void 0)&&a._disableColumnAndRowSizeRound?1:0;if(C>v+T){const M=Math.min(b,y),R=Math.max(.05,(v-_)/(C-_));let E=0;E=this.table.theme.scrollStyle.barToSide?this.table.tableNoFrameHeight-(S?g:-this.table.scenegraph.tableGroup.attribute.y)+this.table.tableY:M-(S?g:-this.table.scenegraph.tableGroup.attribute.y);let P=_+(S?0:this.table.scenegraph.tableGroup.attribute.x),B=v-_-x;(h=(l=this.table.theme.scrollStyle)===null||l===void 0?void 0:l.ignoreFrozenCols)!==null&&h!==void 0&&h?(P=S?0:this.table.scenegraph.tableGroup.attribute.x,B=v):(P=_+(S?0:this.table.scenegraph.tableGroup.attribute.x),B=v-_-x),this.hScrollBar.setAttributes({x:P,y:E,width:B,range:[0,R],visible:p==="always"});const k=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:k.x1,y:k.y1},p==="always"&&this.hScrollBar.showAll()}else this.hScrollBar.setAttributes({x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:0,visible:!1});if(y>b+T){const M=Math.min(v,C),R=Math.max(.05,(b-w)/(y-w));let E=0;E=this.table.theme.scrollStyle.barToSide?this.table.tableNoFrameWidth-(S?g:-this.table.scenegraph.tableGroup.attribute.x)+this.table.tableX:M-(S?g:-this.table.scenegraph.tableGroup.attribute.x),this.vScrollBar.setAttributes({x:E,y:w+(S?0:this.table.scenegraph.tableGroup.attribute.y),height:b-w-A,range:[0,R],visible:m==="always"});const P=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:P.x1,y:P.y1},m==="always"&&this.vScrollBar.showAll()}else this.vScrollBar.setAttributes({x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,height:0,visible:!1});this.table.stateManager.setScrollLeft(u),this.table.stateManager.setScrollTop(d)}hideResizeCol(){this.columnResizeLine.setAttribute("visible",!1),this.columnResizeBgLine.setAttribute("visible",!1),this.columnResizeLabel.setAttribute("visible",!1),this.columnResizeLabel.hideAll()}showResizeCol(t,e,i){const r=Sf(t,this.table,i);this.columnResizeLine.setAttributes({visible:!0,x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeBgLine.setAttributes({visible:!0,x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.labelVisible&&(this.columnResizeLabel.showAll(),this.columnResizeLabel.setAttributes({visible:!0,x:r,y:e}),this.columnResizeLabel.lastChild.setAttribute("text",`${this.table.getColWidth(t)}px`))}updateResizeCol(t,e,i){const r=Sf(t,this.table,i);this.columnResizeLine.setAttributes({x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeBgLine.setAttributes({x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.labelVisible&&(this.columnResizeLabel.setAttributes({x:r,y:e}),this.columnResizeLabel.lastChild.setAttribute("text",`${Math.floor(this.table.getColWidth(t))}px`))}hideResizeRow(){this.rowResizeLine.setAttribute("visible",!1),this.rowResizeBgLine.setAttribute("visible",!1),this.rowResizeLabel.setAttribute("visible",!1),this.rowResizeLabel.hideAll()}showResizeRow(t,e,i){const r=nk(t,this.table,i);this.rowResizeLine.setAttributes({visible:!0,y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.rowResizeBgLine.setAttributes({visible:!0,y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.labelVisible&&(this.rowResizeLabel.showAll(),this.rowResizeLabel.setAttributes({visible:!0,y:r,x:e}),this.rowResizeLabel.lastChild.setAttribute("text",`${this.table.getRowHeight(t)}px`))}updateResizeRow(t,e,i){const r=nk(t,this.table,i);this.rowResizeLine.setAttributes({y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.rowResizeBgLine.setAttributes({y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.labelVisible&&(this.rowResizeLabel.setAttributes({y:r,x:e}),this.rowResizeLabel.lastChild.setAttribute("text",`${Math.floor(this.table.getRowHeight(t))}px`))}hideMoveCol(){this.cellMover.hide()}showMoveCol(t,e,i){return this.cellMover.show(t,e,i)}updateMoveCol(t,e,i,r){this.cellMover.update(t,e,i,r)}setFrozenColumnShadow(t,e){var i,r;const o=Sf(t,this.table,e);t<0||((r=(i=this.table.theme.frozenColumnLine)===null||i===void 0?void 0:i.shadow)===null||r===void 0?void 0:r.visible)!=="always"?this.frozenShadowLine.setAttributes({visible:!1,x:o,height:this.table.getDrawRange().height}):this.frozenShadowLine.setAttributes({visible:!0,x:o,height:this.table.getDrawRange().height})}setRightFrozenColumnShadow(t){var e,i;const r=Sf(t,this.table,!0);t>=this.table.colCount||((i=(e=this.table.theme.frozenColumnLine)===null||e===void 0?void 0:e.shadow)===null||i===void 0?void 0:i.visible)!=="always"?this.rightFrozenShadowLine.setAttributes({visible:!1,x:r-this.rightFrozenShadowLine.attribute.width,height:this.table.getDrawRange().height}):this.rightFrozenShadowLine.setAttributes({visible:!0,x:r-this.rightFrozenShadowLine.attribute.width,height:this.table.getDrawRange().height})}hideFrozenColumnShadow(){var t,e,i,r,o;const s=(e=(t=this.table.theme.frozenColumnLine)===null||t===void 0?void 0:t.shadow)===null||e===void 0?void 0:e.visible;((o=(r=(i=this.table.theme.frozenColumnLine)===null||i===void 0?void 0:i.shadow)===null||r===void 0?void 0:r.visible)!==null&&o!==void 0?o:s)==="scrolling"&&(this.frozenShadowLine.setAttribute("visible",!1),this.rightFrozenShadowLine.setAttribute("visible",!1),this.table.scenegraph.updateNextFrame())}showFrozenColumnShadow(){var t,e,i,r,o;const s=(e=(t=this.table.theme.frozenColumnLine)===null||t===void 0?void 0:t.shadow)===null||e===void 0?void 0:e.visible;((o=(r=(i=this.table.theme.frozenColumnLine)===null||i===void 0?void 0:i.shadow)===null||r===void 0?void 0:r.visible)!==null&&o!==void 0?o:s)==="scrolling"&&(this.frozenShadowLine.setAttribute("visible",!0),this.rightFrozenShadowLine.setAttribute("visible",!0),this.table.scenegraph.updateNextFrame())}hideVerticalScrollBar(){var t;const e=this.table.theme.scrollStyle.visible,i=(t=this.table.theme.scrollStyle.verticalVisible)!==null&&t!==void 0?t:e;i!=="focus"&&i!=="scrolling"||(this.vScrollBar.setAttribute("visible",!1),this.vScrollBar.hideAll(),this.table.scenegraph.updateNextFrame())}showVerticalScrollBar(){var t;const e=this.table.theme.scrollStyle.visible,i=(t=this.table.theme.scrollStyle.verticalVisible)!==null&&t!==void 0?t:e;i!=="focus"&&i!=="scrolling"||(this.vScrollBar.setAttribute("visible",!0),this.vScrollBar.showAll(),this.table.scenegraph.updateNextFrame())}hideHorizontalScrollBar(){var t;const e=this.table.theme.scrollStyle.visible,i=(t=this.table.theme.scrollStyle.horizontalVisible)!==null&&t!==void 0?t:e;i!=="focus"&&i!=="scrolling"||(this.hScrollBar.setAttribute("visible",!1),this.hScrollBar.hideAll(),this.table.scenegraph.updateNextFrame())}showHorizontalScrollBar(){var t;const e=this.table.theme.scrollStyle.visible,i=(t=this.table.theme.scrollStyle.horizontalVisible)!==null&&t!==void 0?t:e;i!=="focus"&&i!=="scrolling"||(this.hScrollBar.setAttribute("visible",!0),this.hScrollBar.showAll(),this.table.scenegraph.updateNextFrame())}updateVerticalScrollBarPos(t){const e=this.vScrollBar.attribute.range,i=e[1]-e[0],r=t*(1-i);this.vScrollBar.setAttribute("range",[r,r+i]);const o=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:o.x1,y:o.y1}}updateHorizontalScrollBarPos(t){const e=this.hScrollBar.attribute.range,i=e[1]-e[0],r=t*(1-i);this.hScrollBar.setAttribute("range",[r,r+i]);const o=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:o.x1,y:o.y1}}updateStyle(){var t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A;const x=this.table.theme,S=(t=x.scrollStyle)===null||t===void 0?void 0:t.scrollRailColor,T=(e=x.scrollStyle)===null||e===void 0?void 0:e.scrollSliderColor,M=(i=x.scrollStyle)===null||i===void 0?void 0:i.scrollSliderCornerRadius,R=(r=x.scrollStyle)===null||r===void 0?void 0:r.width,E=(o=x.scrollStyle)===null||o===void 0?void 0:o.horizontalPadding,P=(s=x.scrollStyle)===null||s===void 0?void 0:s.verticalPadding;let B;B=$(M)?{cornerRadius:M,fill:T}:{fill:T},this.hScrollBar.setAttributes({height:R,padding:E,railStyle:{fill:S},sliderStyle:B}),this.vScrollBar.setAttributes({width:R,padding:P,railStyle:{fill:S},sliderStyle:B});const k=(a=x.columnResize)===null||a===void 0?void 0:a.lineColor,L=(l=x.columnResize)===null||l===void 0?void 0:l.lineWidth,O=(h=x.columnResize)===null||h===void 0?void 0:h.bgColor,I=(u=x.columnResize)===null||u===void 0?void 0:u.width;this.columnResizeLine.setAttributes({stroke:k,lineWidth:L}),this.columnResizeBgLine=Ke({stroke:O,lineWidth:I});const H=(d=x.columnResize)===null||d===void 0?void 0:d.labelColor,D=(c=x.columnResize)===null||c===void 0?void 0:c.labelFontSize,z=(g=x.columnResize)===null||g===void 0?void 0:g.labelFontFamily,G=(f=x.columnResize)===null||f===void 0?void 0:f.labelBackgroundFill,U=(p=x.columnResize)===null||p===void 0?void 0:p.labelBackgroundCornerRadius,j=(v=(m=x.columnResize)===null||m===void 0?void 0:m.labelVisible)===null||v===void 0||v;this.labelVisible=j,this.columnResizeLabel.lastChild.setAttributes({fontSize:D,fill:H,fontFamily:z,dy:-D/2}),this.columnResizeLabel.firstChild.setAttributes({fill:G,width:5*D*.8,height:D+8,cornerRadius:U,dy:-D/2-4}),this.rowResizeLabel.lastChild.setAttributes({fontSize:D,fill:H,fontFamily:z,dy:-D/2}),this.rowResizeLabel.firstChild.setAttributes({fill:G,width:5*D*.8,height:D+8,cornerRadius:U,dy:-D/2-4});const X=(y=(b=x.frozenColumnLine)===null||b===void 0?void 0:b.shadow)===null||y===void 0?void 0:y.width,Z=(w=(C=x.frozenColumnLine)===null||C===void 0?void 0:C.shadow)===null||w===void 0?void 0:w.startColor,J=(A=(_=x.frozenColumnLine)===null||_===void 0?void 0:_.shadow)===null||A===void 0?void 0:A.endColor;this.frozenShadowLine.setAttributes({width:X,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:Z,offset:0},{color:J,offset:1}]}}),this.rightFrozenShadowLine.setAttributes({width:X,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:J,offset:0},{color:Z,offset:1}]}}),this.cellMover.updateStyle()}}function Wr(n,t,e,i,r){var o,s,a,l,h,u;if(!t)return;const d=e==="table",{shadowBlur:c,shadowOffsetX:g,shadowOffsetY:f,shadowColor:p,cornerRadius:m,borderColor:v,borderLineWidth:b,borderLineDash:y}=t;let C=!1;const w={},_={pickable:!1};c&&d&&(_.shadowBlur=c,_.shadowOffsetX=g,_.shadowOffsetY=f,_.shadowColor=p,_.stroke=!0,_.stroke=p,_.lineWidth=1,C=!0),b&&(_.stroke=!0,_.fill=!1,_.stroke=rS(v??"#E1E4E8",i,b),_.lineWidth=b,y&&(_.lineDash=y),_.lineCap="butt"),Array.isArray(v)&&(_.strokeArrayColor=Kt(v)),Array.isArray(b)&&(_.strokeArrayWidth=Kt(b),_.lineWidth=1),m&&(_.cornerRadius=m,w.cornerRadius=m);const A=_.strokeArrayWidth?_.strokeArrayWidth[0]:(o=_.lineWidth)!==null&&o!==void 0?o:0,x=_.strokeArrayWidth?_.strokeArrayWidth[1]:(s=_.lineWidth)!==null&&s!==void 0?s:0,S=_.strokeArrayWidth?_.strokeArrayWidth[2]:(a=_.lineWidth)!==null&&a!==void 0?a:0,T=_.strokeArrayWidth?_.strokeArrayWidth[3]:(l=_.lineWidth)!==null&&l!==void 0?l:0;if(n.setAttributes(w),!r)if(_.stroke)if(_.x=T/2,_.y=A/2,_.pickable=!1,d){if(m)if(Array.isArray(m)){const E=Kt(m);_.cornerRadius=E,w.cornerRadius=E,E[0]&&(E[0]=E[0]+Math.min(T,A)/2),E[1]&&(E[1]=E[1]+Math.min(A,x)/2),E[2]&&(E[2]=E[2]+Math.min(x,S)/2),E[3]&&(E[3]=E[3]+Math.min(S,T)/2)}else if(wt(b)){const E=[];_.cornerRadius=E,w.cornerRadius=E,E[0]=m+Math.min(T,A)/2,E[1]=m+Math.min(A,x)/2,E[2]=m+Math.min(x,S)/2,E[3]=m+Math.min(S,T)/2}else _.cornerRadius=m+((h=_.lineWidth)!==null&&h!==void 0?h:0)/2,w.cornerRadius=m+((u=_.lineWidth)!==null&&u!==void 0?u:0)/2;let M,R;if(t.innerBorder?(_.x=n.attribute.x+T/2,_.y=n.attribute.y+A/2,_.width=n.attribute.width-T/2-x/2,_.height=n.attribute.height-A/2-S/2):(_.x=n.attribute.x-T/2,_.y=n.attribute.y-A/2,_.width=n.attribute.width+T/2+x/2,_.height=n.attribute.height+A/2+S/2),C){_.fill="white",_.notAdjustPos=!0,R=Ip(_),R.name="table-border-rect",M=be({x:T/2,y:A/2,width:n.attribute.width,height:n.attribute.height,fill:"red",cornerRadius:n.attribute.cornerRadius,globalCompositeOperation:"destination-out"}),R.addChild(M);const E=be({x:T/2,y:A/2,width:n.attribute.width,height:n.attribute.height,fill:"transparent",pickable:!1,globalCompositeOperation:"source-over"});R.addChild(E)}else R=be(_),R.name="table-border-rect";t.innerBorder&&!C?n.parent.insertAfter(R,n):n.parent.insertBefore(R,n),n.border=R}else{_.width=n.attribute.width-T/2-x/2,_.height=n.attribute.height-A/2-S/2;const M=be(_);M.name="border-rect",n.addChild(M),n.border=M}else{const M=be({fill:!1,stroke:!1,pickable:!1,lineWidth:0});M.name="border-rect",n.addChild(M),n.border=M}}function rk(n,t,e){var i;if(!t)return;const{borderColor:r}=t;(i=n.border)===null||i===void 0||i.setAttribute("stroke",rS(r,e))}function rS(n,t,e){let i=!0;return!t&&!wt(e)||wt(n)?t?i=t:t||wt(n)?wt(n)&&(i=!0):i=n:i=(t??e).map((r=>!!r&&n)),i}function ts(n){var t,e,i,r;if(!n.border)return;const o=n.border.attribute.strokeArrayWidth?n.border.attribute.strokeArrayWidth[0]:(t=n.border.attribute.lineWidth)!==null&&t!==void 0?t:0,s=n.border.attribute.strokeArrayWidth?n.border.attribute.strokeArrayWidth[1]:(e=n.border.attribute.lineWidth)!==null&&e!==void 0?e:0,a=n.border.attribute.strokeArrayWidth?n.border.attribute.strokeArrayWidth[2]:(i=n.border.attribute.lineWidth)!==null&&i!==void 0?i:0,l=n.border.attribute.strokeArrayWidth?n.border.attribute.strokeArrayWidth[3]:(r=n.border.attribute.lineWidth)!==null&&r!==void 0?r:0;n.border.setAttributes({borderLeft:l,borderTop:o,borderRight:s,borderBottom:a,width:n.attribute.width-l/2-s/2,height:n.attribute.height-o/2-a/2}),n.border.type==="group"&&n.border.firstChild.setAttributes({width:n.attribute.width,height:n.attribute.height})}function Oat(n){if(!n.theme.frameStyle.cornerRadius)return;const t=n.theme.frameStyle.cornerRadius,{cornerHeaderGroup:e,colHeaderGroup:i,rowHeaderGroup:r,bodyGroup:o,rightTopCornerGroup:s,leftBottomCornerGroup:a,rightBottomCornerGroup:l,rightFrozenGroup:h,bottomFrozenGroup:u}=n.scenegraph;e.setAttribute("cornerRadius",0),i.setAttribute("cornerRadius",0),r.setAttribute("cornerRadius",0),o.setAttribute("cornerRadius",0),s.setAttribute("cornerRadius",0),a.setAttribute("cornerRadius",0),l.setAttribute("cornerRadius",0),h.setAttribute("cornerRadius",0),u.setAttribute("cornerRadius",0);const d=Ur(t);e.attribute.width>0&&e.attribute.height>0?pn(e,[d[0],0,0,0]):i.attribute.height>0?pn(i,[d[0],0,0,0]):r.attribute.width>0?pn(r,[d[0],0,0,0]):pn(o,[d[0],0,0,0]),a.attribute.width>0&&a.attribute.height>0?pn(a,[0,0,0,d[3]]):u.attribute.height>0?pn(u,[0,0,0,d[3]]):r.attribute.width>0?pn(r,[0,0,0,d[3]]):pn(o,[0,0,0,d[3]]),s.attribute.width>0&&s.attribute.height>0?pn(s,[0,d[1],0,0]):i.attribute.height>0?pn(i,[0,d[1],0,0]):h.attribute.width>0?pn(h,[0,d[1],0,0]):pn(o,[0,d[1],0,0]),l.attribute.width>0&&l.attribute.height>0?pn(l,[0,0,d[2],0]):h.attribute.width>0?pn(h,[0,0,d[2],0]):u.attribute.height>0?pn(u,[0,0,d[2],0]):pn(o,[0,0,d[2],0])}function pn(n,t){n.setAttribute("cornerRadius",t),n.border&&n.border.setAttribute("cornerRadius",t)}function eF(n,t){var e,i,r,o,s,a,l,h,u,d,c;let g,f;if(n.role==="cell"&&$(n.mergeStartCol)&&$(n.mergeStartRow)&&$(n.mergeEndCol)&&$(n.mergeEndRow)){const{colStart:m,colEnd:v,rowStart:b,rowEnd:y}=ka(n,t.scenegraph);for(let C=m;C<=v;C++)for(let w=b;w<=y;w++){const _=ok(t.stateManager,C,w,n);!_||g&&_!=="cellBgColor"||(g=_)}}else n.role==="cell"&&(g=ok(t.stateManager,n.col,n.row,n));if(!g)return;const p=t.internalProps.layoutMap;return p.isCornerHeader(n.col,n.row)?f=((e=t.theme.cornerHeaderStyle)===null||e===void 0?void 0:e.hover)||((i=t.theme.headerStyle)===null||i===void 0?void 0:i.hover):p.isColumnHeader(n.col,n.row)?f=(r=t.theme.headerStyle)===null||r===void 0?void 0:r.hover:p.isRowHeader(n.col,n.row)?f=(o=t.theme.rowHeaderStyle)===null||o===void 0?void 0:o.hover:p.isBottomFrozenRow(n.col,n.row)?f=((s=t.theme.bottomFrozenStyle)===null||s===void 0?void 0:s.hover)||(t.isListTable()?(a=t.theme.bodyStyle)===null||a===void 0?void 0:a.hover:(l=t.theme.headerStyle)===null||l===void 0?void 0:l.hover):p.isRightFrozenColumn(n.col,n.row)?f=((h=t.theme.rightFrozenStyle)===null||h===void 0?void 0:h.hover)||(t.isListTable()?(u=t.theme.bodyStyle)===null||u===void 0?void 0:u.hover:(d=t.theme.rowHeaderStyle)===null||d===void 0?void 0:d.hover):t.isHeader(n.col,n.row)||(f=(c=t.theme.bodyStyle)===null||c===void 0?void 0:c.hover),ht(g,f,n.col,n.row,t)}function ok(n,t,e,i){var r;const{highlightScope:o,disableHeader:s,cellPos:a}=n.hover,l=n.table,h=l.isHeader(t,e);if(h&&s)return;let u;if(o===oe.single&&a.col===t&&a.row===e?u="cellBgColor":o===oe.column&&a.col===t?u=a.col===t&&a.row===e?"cellBgColor":"inlineColumnBgColor":o===oe.row&&a.row===e?u=a.col===t&&a.row===e?"cellBgColor":"inlineRowBgColor":o===oe.cross&&(a.col===t&&a.row===e?u="cellBgColor":a.col===t?u="inlineColumnBgColor":a.row===e&&(u="inlineRowBgColor")),u){let d;if(h){const c=l.getHeaderDefine(t,e);d=c?.disableHeaderHover,i.firstChild&&i.firstChild.name==="axis"&&(!((r=l.options.hover)===null||r===void 0)&&r.disableAxisHover)&&(d=!0)}else{const c=l.getBodyColumnDefine(t,e);d=c?.disableHover}d&&(u=void 0)}return u}const oS=tn();class zh extends dg{constructor(t,e){if(super(e),this.type="chart",this.numberType=oS,this.isShareChartSpec=t,e.chartInstance)this.chartInstance=e.chartInstance;else{const i=this.chartInstance=new e.ClassType(e.spec,xe({},this.attribute.tableChartOption,{renderCanvas:e.canvas,mode:this.attribute.mode==="node"?"node":"desktop-browser",modeParams:this.attribute.modeParams,canvasControled:!1,viewBox:{x1:0,x2:0,y1:0,y2:0},dpr:e.dpr,interactive:!1,animation:!1,autoFit:!1}));i.renderSync(),i.getStage().enableDirtyBounds(),e.chartInstance=this.chartInstance=i}}activate(t){var e,i,r,o,s;this.active=!0;const{col:a,row:l}=this.parent,h=eF(this.parent,t),{x1:u,y1:d,x2:c,y2:g}=this.getViewBox(),f=Iat(a,l,t).intersect({x1:u-t.scrollLeft,x2:c-t.scrollLeft,y1:d-t.scrollTop,y2:g-t.scrollTop});(e=this.activeChartInstance)===null||e===void 0||e.release(),this.activeChartInstance=new this.attribute.ClassType(this.attribute.spec,xe({},this.attribute.tableChartOption,{renderCanvas:this.attribute.canvas,mode:"desktop-browser",canvasControled:!1,viewBox:{x1:0,x2:c-u,y1:0,y2:g-d},dpr:t.internalProps.pixelRatio,animation:!1,interactive:!0,autoFit:!1,beforeRender:b=>{const y=this.stage,C=b.window.getContext(),w=y.window.getViewBoxTransform(),_=y.window.getViewBox();C.inuse=!0,C.clearMatrix(),C.setTransform(w.a,w.b,w.c,w.d,w.e,w.f,!0),C.translate(_.x1,_.y1),C.setTransformForCurrent(!0),C.beginPath(),C.rect(f.x1,f.y1,f.x2-f.x1,f.y2-f.y1),C.clip(),C.clearMatrix(),t.options.canvas&&!b.needRender&&(b.pauseRender(),t.scenegraph.stage.dirtyBounds.union(this.globalAABBBounds),t.scenegraph.updateNextFrame())},afterRender(b){b.window.getContext().inuse=!1,b.needRender=!1,p.resumeRender()},renderHooks:{afterClearRect(b){const{context:y,layer:C,viewBox:w}=b;C.main&&b.clear&&h&&(y.beginPath(),y.fillStyle=h,y.rect(w.x1,w.y1,w.x2-w.x1,w.y2-w.y1),y.fill())}}}));const p=this.activeChartInstance.getStage(),m=this.globalTransMatrix.clone(),v=this.stage.window.getViewBoxTransform();m.multiply(v.a,v.b,v.c,v.d,v.e,v.f),p.window.setViewBoxTransform&&p.window.setViewBoxTransform(m.a,m.b,m.c,m.d,m.e,m.f),this.activeChartInstance.renderSync(),(r=(i=t.internalProps.layoutMap)===null||i===void 0?void 0:i.updateDataStateToActiveChartInstance)===null||r===void 0||r.call(i,this.activeChartInstance),this.activeChartInstance.on("click",(b=>{var y;((y=this.attribute.spec.select)===null||y===void 0?void 0:y.enable)===!1?t.scenegraph.updateChartState(null):zh.temp&&t.scenegraph.updateChartState(b?.datum)})),this.activeChartInstance.on("brushEnd",(b=>{var y;t.scenegraph.updateChartState((y=b?.value)===null||y===void 0?void 0:y.inBrushData),zh.temp=0,setTimeout((()=>{zh.temp=1}),0)})),(s=(o=t)._bindChartEvent)===null||s===void 0||s.call(o,this.activeChartInstance)}deactivate(){var t,e;this.active=!1,(t=this.activeChartInstance)===null||t===void 0||t.updateViewBox({x1:-1e3,x2:-800,y1:-1e3,y2:-800},!1,!1),(e=this.activeChartInstance)===null||e===void 0||e.release(),this.activeChartInstance=null}updateData(t){this.attribute.data=t}getViewBox(){var t,e,i,r,o,s,a,l;const h=this.parent,u=this.attribute.cellPadding,d=this.stage.table,{x1:c,y1:g,x2:f,y2:p}=h.globalAABBBounds;return{x1:Math.ceil(c+u[3]+d.scrollLeft+((e=(t=d.options.viewBox)===null||t===void 0?void 0:t.x1)!==null&&e!==void 0?e:0)),x2:Math.ceil(c+h.attribute.width-u[1]+d.scrollLeft+((r=(i=d.options.viewBox)===null||i===void 0?void 0:i.x1)!==null&&r!==void 0?r:0)),y1:Math.ceil(g+u[0]+d.scrollTop+((s=(o=d.options.viewBox)===null||o===void 0?void 0:o.y1)!==null&&s!==void 0?s:0)),y2:Math.ceil(g+h.attribute.height-u[2]+d.scrollTop+((l=(a=d.options.viewBox)===null||a===void 0?void 0:a.y1)!==null&&l!==void 0?l:0))}}}function Iat(n,t,e){var i,r,o,s,a,l,h,u;const{layoutMap:d}=e.internalProps,c=new Ca,g=e.scenegraph.tableGroup.globalAABBBounds;return c.x1=g.x1,c.x2=g.x2,c.y1=g.y1,c.y2=g.y2,d.isLeftBottomCorner(n,t)||d.isRightTopCorner(n,t)||d.isLeftTopCorner(n,t)||d.isRightBottomCorner(n,t)||(d.isFrozenColumn(n,t)?(c.y1=g.y1+e.getFrozenRowsHeight(),c.y2=g.y2-e.getBottomFrozenRowsHeight()):d.isFrozenRow(n,t)?(c.x1=g.x1+e.getFrozenColsWidth(),c.x2=g.x2-e.getRightFrozenColsWidth()):d.isRightFrozenColumn(n,t)?(c.y1=g.y1+e.getFrozenRowsHeight(),c.y2=g.y2-e.getBottomFrozenRowsHeight()):d.isBottomFrozenRow(n,t)?(c.x1=g.x1+e.getFrozenColsWidth(),c.x2=g.x2-e.getRightFrozenColsWidth()):d.isFrozenColumn(n,t)||d.isRightFrozenColumn(n,t)||(c.x1=g.x1+e.getFrozenColsWidth(),c.x2=g.x2-e.getRightFrozenColsWidth(),c.y1=g.y1+e.getFrozenRowsHeight(),c.y2=g.y2-e.getBottomFrozenRowsHeight())),c.x1=c.x1+((r=(i=e.options.viewBox)===null||i===void 0?void 0:i.x1)!==null&&r!==void 0?r:0),c.x2=c.x2+((s=(o=e.options.viewBox)===null||o===void 0?void 0:o.x1)!==null&&s!==void 0?s:0),c.y1=c.y1+((l=(a=e.options.viewBox)===null||a===void 0?void 0:a.y1)!==null&&l!==void 0?l:0),c.y2=c.y2+((u=(h=e.options.viewBox)===null||h===void 0?void 0:h.y1)!==null&&u!==void 0?u:0),c}zh.temp=1;let Y0=[],q0=[],iF,s1=5,K0=!1;function sk(n){$(n)&&(s1=n)}function a1(){Y0=[],q0=[],K0=!1,cancelAnimationFrame(iF)}function Hat(){return K0}function nF(n){var t,e,i,r,o,s,a;const{axes:l,dataId:h,data:u,spec:d,ClassType:c,canvas:g,mode:f,modeParams:p,dpr:m}=n.attribute;let{chartInstance:v}=n;v||(v=new c(d,{renderCanvas:g,mode:f==="node"?"node":"desktop-browser",modeParams:p,canvasControled:!1,viewBox:{x1:0,x2:0,y1:0,y2:0},dpr:m,interactive:!1,animation:!1,autoFit:!1}),v.renderSync(),n.chartInstance=v);const b=n.getViewBox();b.x2<=b.x1&&(b.x2=b.x1+1),b.y2<=b.y1&&(b.y2=b.y1+1),v.updateViewBox({x1:0,x2:b.x2-b.x1,y1:0,y2:b.y2-b.y1},!1,!1);const y=v.getStage(),C=n.globalTransMatrix,w=n.stage.window.getViewBoxTransform().clone();w.multiply(C.a,C.b,C.c,C.d,C.e,C.f),y.window.setViewBoxTransform&&y.window.setViewBoxTransform(w.a,w.b,w.c,w.d,w.e,w.f);const{table:_}=n.getRootNode();let A=!1;if(_.options.specFormat){const x=_.options.specFormat(n.attribute.spec,v,n);if(x.needFormatSpec&&x.spec){const S=x.spec;v.updateSpecSync(S,!1,{reuse:!1,morph:!1}),A=(t=x.updateSpec)===null||t===void 0||t}}if(!A)if(l?.forEach(((x,S)=>{var T,M,R,E,P;x.type==="band"?v.updateModelSpec({type:"axes",index:S},{domain:x.domain.slice(0)},!0):v.updateModelSpecSync({type:"axes",index:S},{min:(M=(T=x.range)===null||T===void 0?void 0:T.min)!==null&&M!==void 0?M:0,max:(E=(R=x.range)===null||R===void 0?void 0:R.max)!==null&&E!==void 0?E:0,tick:{tickMode:(P=x.tick)===null||P===void 0?void 0:P.tickMode}},!0)})),(i=(e=_.internalProps.layoutMap)===null||e===void 0?void 0:e.updateDataStateToActiveChartInstance)===null||i===void 0||i.call(e,v),typeof h=="string")v.updateDataSync(h,u??[]);else{const x=[];for(const S in h){const T=h[S],M=d.series.find((R=>{var E;return((E=R?.data)===null||E===void 0?void 0:E.id)===S}));x.push({id:S,values:T?(r=u?.filter((R=>R.hasOwnProperty(T))))!==null&&r!==void 0?r:[]:u??[],fields:(o=M?.data)===null||o===void 0?void 0:o.fields}),v.updateFullDataSync||v.updateDataSync(S,T?(s=u?.filter((R=>R.hasOwnProperty(T))))!==null&&s!==void 0?s:[]:u??[])}(a=v.updateFullDataSync)===null||a===void 0||a.call(v,x)}_.fireListeners("before_cache_chart_image",{chartInstance:v}),Dat(v.getStage(),n)}function rF(n){K0=!0,q0.length>0?iF=requestAnimationFrame((()=>{const t=q0.splice(0,s1);Y0.splice(0,s1),t.forEach((e=>{nF(e),e.addUpdateBoundTag()})),n.render(),rF(n)})):K0=!1}const Co=2e3;function Dat(n,t){var e;const{viewWidth:i,viewHeight:r}=n;if(i<Co&&r<Co)return t.cacheCanvas=ak(n),void(t.isShareChartSpec||((e=t.chartInstance)===null||e===void 0||e.release(),t.chartInstance=null,t.setAttribute("chartInstance",null)));const o=Math.ceil(r/Co),s=Math.ceil(i/Co),a=[];for(let l=0;l<o;l++)for(let h=0;h<s;h++){const u=h*Co,d=l*Co,c=u+Co>i?i:u+Co,g=d+Co>r?r:d+Co,f=c-u,p=g-d,m=new Ca;m.setValue(u,d,c,g);const v=ak(n,!1,m);a.push({canvas:v,x:u,y:d,width:f,height:p})}t.cacheCanvas=a}function ak(n,t=!0,e){if(n.releaseStatus==="released")return null;const i=Fat(n,t,e).getNativeHandler();return i.nativeCanvas?i.nativeCanvas:null}function Fat(n,t=!0,e){const i=n.window.getViewBoxTransform(),r=Et.get(Ac),o=e?-e.x1:0,s=e?-e.y1:0,a=e?e.x2:n.viewWidth,l=e?e.y2:n.viewHeight,h=e?e.width():n.viewWidth,u=e?e.height():n.viewHeight;return r.create({viewBox:{x1:o,y1:s,x2:a,y2:l},width:h*i.a,height:u*i.d,dpr:n.window.dpr,canvasControled:!0,offscreen:!0,title:""}),r.setViewBoxTransform(i.a,i.b,i.c,i.d,0,0),n.renderTo(r),r}var zat=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};const Nat=Symbol.for("ChartRender");let Kd=class extends Gn{constructor(){super(...arguments),this.numberType=oS}drawShape(n,t,e,i,r,o,s,a){var l,h,u,d;const c=Wt(n,o?.theme).group,{dataId:g,data:f,spec:p}=n.attribute,{width:m=c.width,height:v=c.height}=(n.getViewBox(),n.attribute),{table:b}=n.getRootNode(),{active:y,cacheCanvas:C,activeChartInstance:w}=n;if(!y&&C)wt(C)?C.forEach((_=>{const{x:A,y:x,width:S,height:T,canvas:M}=_;t.drawImage(M,A,x,S,T)})):t.drawImage(C,e,i,m,v);else if(w){if(b.options.specFormat){const T=b.options.specFormat(n.attribute.spec,w,n);if(T.needFormatSpec&&T.spec){const M=T.spec;w.updateSpecSync(M,!1,{reuse:!1,morph:!1})}}const _=n.getViewBox();w.updateViewBox({x1:0,x2:_.x2-_.x1,y1:0,y2:_.y2-_.y1},!1,!1);const A=w.getStage();A.needRender=!0;const x=n.globalTransMatrix.clone(),S=n.stage.window.getViewBoxTransform().clone();if(S.multiply(x.a,x.b,x.c,x.d,x.e,x.f),A.window.setViewBoxTransform(S.a,S.b,S.c,S.d,S.e,S.f),typeof g=="string")w.updateDataSync(g,f??[]);else{const T=[];for(const M in g){const R=g[M],E=p.series.find((P=>{var B;return((B=P?.data)===null||B===void 0?void 0:B.id)===M}));T.push({id:M,values:R?(l=f?.filter((P=>P.hasOwnProperty(R))))!==null&&l!==void 0?l:[]:f??[],fields:(h=E?.data)===null||h===void 0?void 0:h.fields}),w.updateFullDataSync||w.updateDataSync(M,R?(u=f?.filter((P=>P.hasOwnProperty(R))))!==null&&u!==void 0?u:[]:f??[])}(d=w.updateFullDataSync)===null||d===void 0||d.call(w,T)}}else b.internalProps.renderChartAsync?(Y0.indexOf(`${n.parent.col}+${n.parent.row}`)===-1&&(Y0.push(`${n.parent.col}+${n.parent.row}`),q0.push(n)),Hat()||rF(b)):nF(n)}draw(n,t,e,i){this._draw(n,{},!1,e,i)}};Kd=zat([pt()],Kd);var Wv=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let Z0=class{constructor(){this.time=ne.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){const{shape:g}=n.attribute;if(g==="circle"){const{width:f=l.width,height:p=l.height}=n.attribute;t.beginPath(),t.arc(e+f/2,i+p/2,Math.min(f,p)/2,0,2*Math.PI),t.closePath(),t.save(),t.clip()}}};Z0=Wv([pt()],Z0);let J0=class{constructor(){this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){const{shape:g}=n.attribute;g==="circle"&&t.restore()}};J0=Wv([pt()],J0);let Q0=class{constructor(){this.time=ne.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){const{isGif:g}=n.attribute;g&&n.playing&&(n.attribute.opacity=0)}};Q0=Wv([pt()],Q0);let tm=class{constructor(){this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){const{isGif:g}=n.attribute;g&&n.playing&&(n.attribute.opacity=1,t.globalAlpha=n.attribute.opacity,n.renderFrame(t,e,i))}};tm=Wv([pt()],tm);function Wat(n,t){var e,i,r,o,s,a,l,h,u,d,c;let g,f;if(n.role==="cell"&&$(n.mergeStartCol)&&$(n.mergeStartRow)&&$(n.mergeEndCol)&&$(n.mergeEndRow)){const{colStart:m,colEnd:v,rowStart:b,rowEnd:y}=ka(n,t.scenegraph);for(let C=m;C<=v;C++)for(let w=b;w<=y;w++){const _=lk(t.stateManager,C,w);!_||g&&_!=="cellBgColor"||(g=_)}}else n.role==="cell"&&(g=lk(t.stateManager,n.col,n.row));if(!g)return;const p=t.internalProps.layoutMap;return p.isCornerHeader(n.col,n.row)?f=((e=t.theme.cornerHeaderStyle)===null||e===void 0?void 0:e.select)||((i=t.theme.headerStyle)===null||i===void 0?void 0:i.select):p.isColumnHeader(n.col,n.row)?f=(r=t.theme.headerStyle)===null||r===void 0?void 0:r.select:p.isRowHeader(n.col,n.row)?f=(o=t.theme.rowHeaderStyle)===null||o===void 0?void 0:o.select:p.isBottomFrozenRow(n.col,n.row)?f=((s=t.theme.bottomFrozenStyle)===null||s===void 0?void 0:s.select)||(t.isListTable()?(a=t.theme.bodyStyle)===null||a===void 0?void 0:a.select:(l=t.theme.headerStyle)===null||l===void 0?void 0:l.select):p.isRightFrozenColumn(n.col,n.row)?f=((h=t.theme.rightFrozenStyle)===null||h===void 0?void 0:h.select)||(t.isListTable()?(u=t.theme.bodyStyle)===null||u===void 0?void 0:u.select:(d=t.theme.rowHeaderStyle)===null||d===void 0?void 0:d.select):t.isHeader(n.col,n.row)||(f=(c=t.theme.bodyStyle)===null||c===void 0?void 0:c.select),ht(g,f,n.col,n.row,t)}function jat(n){return n.start.col!==n.end.col||n.start.row!==n.end.row}function Vat(n,t,e){let i;const{highlightScope:r,cellPos:o,ranges:s}=n.select,a=s[0],l=Math.min(a.start.col,a.end.col),h=Math.max(a.start.col,a.end.col),u=Math.min(a.start.row,a.end.row),d=Math.max(a.start.row,a.end.row);return r===oe.single&&o.col===t&&o.row===e?i="cellBgColor":r===oe.column&&t>=l&&t<=h?i=Ir(s[0],t,e)?"cellBgColor":"inlineColumnBgColor":r===oe.row&&e>=u&&e<=d?i=Ir(s[0],t,e)?"cellBgColor":"inlineRowBgColor":r===oe.cross&&(Ir(s[0],t,e)?i="cellBgColor":t>=l&&t<=h?i="inlineColumnBgColor":e>=u&&e<=d&&(i="inlineRowBgColor")),i}function Gat(n,t,e){let i;const{highlightScope:r,cellPos:o}=n.select;return r===oe.single&&o.col===t&&o.row===e?i="cellBgColor":r===oe.column&&o.col===t?i=o.col===t&&o.row===e?"cellBgColor":"inlineColumnBgColor":r===oe.row&&o.row===e?i=o.col===t&&o.row===e?"cellBgColor":"inlineRowBgColor":r===oe.cross&&(o.col===t&&o.row===e?i="cellBgColor":o.col===t?i="inlineColumnBgColor":o.row===e&&(i="inlineRowBgColor")),i}function lk(n,t,e,i){const{highlightInRange:r,disableHeader:o,ranges:s}=n.select;let a;const l=s.length===1&&jat(s?.[0])&&r;if(l?s?.length===1&&s[0].start&&s[0].end:s?.length===1&&s[0].end.col===s[0].start.col&&s[0].end.row===s[0].start.row){if(n.table.isHeader(t,e)&&o)return;a=l?Vat(n,t,e):Gat(n,t,e),a&&ra(n.table,t,e)&&(a=void 0)}else if(n.table.theme.selectionStyle.selectionFillMode==="replace")for(let h=0;h<s.length;h++){const u=s[h],d=Math.min(u.start.col,u.end.col),c=Math.max(u.start.col,u.end.col),g=Math.min(u.start.row,u.end.row),f=Math.max(u.start.row,u.end.row);if(d<=t&&g<=e&&c>=t&&f>=e){a="cellBgColor";break}}return a}function ra(n,t,e){var i,r;const o=(i=n.options.select)===null||i===void 0?void 0:i.disableSelect;if(typeof o=="function"?o(t,e,n):o)return!0;if(n.isHeader(t,e)){let s=(r=n.options.select)===null||r===void 0?void 0:r.disableHeaderSelect;if(s)return!0;const a=n.getHeaderDefine(t,e);if(s=a?.disableHeaderSelect,s)return!0}else{const s=n.getBodyColumnDefine(t,e),a=s?.disableSelect;if(typeof a=="function"?a(t,e,n):a)return!0}return!1}var Is=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let em=class{constructor(){this.time=ne.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){const{stroke:g=l.stroke,strokeArrayWidth:f=l.strokeArrayWidth,strokeArrayColor:p=l.strokeArrayColor}=n.attribute;g&&(Array.isArray(f)||Array.isArray(p))&&(c.doStroke=!1)}};em=Is([pt()],em);let im=class{constructor(){this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d){var c,g;const{stroke:f=l.stroke,strokeArrayColor:p=l.strokeArrayColor,strokeArrayWidth:m=l.strokeArrayWidth,lineWidth:v=l.lineWidth,strokeColor:b=l.stroke,cornerRadius:y=l.cornerRadius}=n.attribute;let C,w,{width:_=l.width,height:A=l.height}=n.attribute;if(f&&(Array.isArray(m)||v!==0)&&(Array.isArray(p)||Array.isArray(m))){if(typeof v=="number"&&1&v||Array.isArray(m)&&m.some((x=>1&x))){const x=n.stage.table;if(!x)return;const S=((c=x?.theme)===null||c===void 0?void 0:c.cellBorderClipDirection)==="bottom-right";if(S){if(e=Math.floor(e)-.5,i=Math.floor(i)-.5,n.role==="cell"){const R=n.col,E=n.row;R===0&&(e+=1),E===0&&(i+=1)}}else e=Math.floor(e)+.5,i=Math.floor(i)+.5;!((g=x.options.customConfig)===null||g===void 0)&&g._disableColumnAndRowSizeRound&&(_=Math.round(_),A=Math.round(A));const{width:T,height:M}=sS(n,Math.ceil(_),Math.ceil(A),S);C=T,w=M}else C=Math.ceil(_),w=Math.ceil(A);y===0||wt(y)&&y.every((x=>x===0))?sF(n,t,e,i,l,f,m||v,p||b,C,w):(t.beginPath(),Vo(t,e,i,C,w,y,!0,new Array(4).fill(0).map(((x,S)=>(T,M,R,E)=>{lF(S,T,M,R,E,n,t,e,i,l,f,m||v,p||b,C,w)}))),t.stroke())}}};im=Is([pt()],im);function oF(n){if(!Array.isArray(n))return{isSplitDraw:!1,width:n};let t;for(let e=0;e<n.length;e++){const i=n[e];if(i)if(t){if(i!==t)return{isSplitDraw:!0}}else t=i}return{isSplitDraw:!1,width:t}}function sF(n,t,e,i,r,o,s,a,l,h,u,d){var c,g,f,p;const m=oF(s),v=!Array.isArray(s),b=!Array.isArray(o),y=Array.isArray(d),C=Array.isArray(a)||m.isSplitDraw;t.setStrokeStyle(n,n.attribute,e,i,r);const{lineDash:w=r.lineDash}=n.attribute;let _=!1;w.length&&w.some((M=>Array.isArray(M)))&&(_=!0),t.beginPath(),t.moveTo(e,i);const A=(b||o[0])&&(v||s[0]),x=(b||o[1])&&(v||s[1]),S=(b||o[2])&&(v||s[2]),T=(b||o[3])&&(v||s[3]);if(A){const M=(v?m.width:s[0])/2,R=(v?m.width:s[0])/2;y&&Array.isArray(d[0])?(t.moveTo(e-M+(l+M+R)*d[0][0],i),t.lineTo(e-M+(l+M+R)*(d[0][1]-d[0][0]),i),t.moveTo(e+l+R,i)):(t.moveTo(e-M,i),t.lineTo(e+l+R,i)),(C||_)&&(a&&a[0]?t.strokeStyle=a[0]:a&&!a[0]&&(t.strokeStyle="transparent"),v||(t.lineWidth=s[0]),t.lineDashOffset=t.currentMatrix.e/t.currentMatrix.a,_&&t.setLineDash((c=w[0])!==null&&c!==void 0?c:[]),t.stroke(),t.beginPath(),t.moveTo(e+l,i))}else t.moveTo(e+l,i);if(x){const M=(v?m.width:s[1])/2,R=(v?m.width:s[1])/2;y&&Array.isArray(d[1])?(t.moveTo(e+l,i-M+h*d[1][0]),t.lineTo(e+l,i-M+(h+M+R)*(d[1][1]-d[1][0])),t.moveTo(e+l,i+h+R)):(t.moveTo(e+l,i-M),t.lineTo(e+l,i+h+R)),(C||_)&&(a&&a[1]?t.strokeStyle=a[1]:a&&!a[1]&&(t.strokeStyle="transparent"),v||(t.lineWidth=s[1]),t.lineDashOffset=t.currentMatrix.f/t.currentMatrix.d,_&&t.setLineDash((g=w[1])!==null&&g!==void 0?g:[]),t.stroke(),t.beginPath(),t.moveTo(e+l,i+h))}else t.moveTo(e+l,i+h);if(S){const M=(v?m.width:s[2])/2,R=(v?m.width:s[2])/2;y&&Array.isArray(d[2])?(t.moveTo(e-M+(l+M+R)*d[2][0],i+h),t.lineTo(e-M+(l+M+R)*(d[2][1]-d[2][0]),i+h),t.moveTo(e-M,i+h)):(t.moveTo(e-M,i+h),t.lineTo(e+l+R,i+h)),(C||_)&&(a&&a[2]?t.strokeStyle=a[2]:a&&!a[2]&&(t.strokeStyle="transparent"),v||(t.lineWidth=s[2]),t.lineDashOffset=t.currentMatrix.e/t.currentMatrix.a,_&&t.setLineDash((f=w[2])!==null&&f!==void 0?f:[]),t.stroke(),t.beginPath(),t.moveTo(e,i+h))}else t.moveTo(e,i+h);if(T){const M=(v?m.width:s[3])/2,R=(v?m.width:s[3])/2;y&&Array.isArray(d[3])?(t.moveTo(e,i-M+(h+M+R)*d[3][0]),t.lineTo(e,i-M+(h+M+R)*(d[3][1]-d[3][0])),t.moveTo(e,i-M)):(t.moveTo(e,i-M),t.lineTo(e,i+h+R)),(C||_)&&(a&&a[3]?t.strokeStyle=a[3]:a&&!a[3]&&(t.strokeStyle="transparent"),v||(t.lineWidth=s[3]),t.lineDashOffset=t.currentMatrix.f/t.currentMatrix.d,_&&t.setLineDash((p=w[3])!==null&&p!==void 0?p:[]),t.stroke(),t.beginPath(),t.moveTo(e,i))}else t.moveTo(e,i);C||_||(!v&&m.width&&(t.lineWidth=m.width),t.stroke()),t.lineDashOffset=0,t.setLineDash([])}let nm=class{constructor(){this.time=ne.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){var g;const{lineDash:f=l.lineDash,stroke:p=l.stroke,strokeArrayColor:m=l.strokeArrayColor,strokeArrayWidth:v=l.strokeArrayWidth}=n.attribute;p&&Array.isArray(f)&&f.length&&(!((g=f[0])===null||g===void 0)&&g.length)&&!Array.isArray(m)&&!Array.isArray(v)&&(c.doStroke=!1)}};nm=Is([pt()],nm);let rm=class{constructor(){this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d){var c,g,f,p,m,v;const{lineDash:b=l.lineDash,stroke:y=l.stroke,strokeArrayColor:C=l.strokeArrayColor,strokeArrayWidth:w=l.strokeArrayWidth,lineWidth:_=l.lineWidth}=n.attribute;if(!y||!(Array.isArray(b)&&b.length&&(!((c=b[0])===null||c===void 0)&&c.length))||Array.isArray(C)||Array.isArray(w))return;const A=n.stage.table;if(!A)return;const x=wt(b[0])?$at(b):[b,b,b,b];let S,T,{width:M=l.width,height:R=l.height}=n.attribute;if(!((g=A.options.customConfig)===null||g===void 0)&&g._disableColumnAndRowSizeRound?(M=Math.round(M),R=Math.round(R)):(M=Math.ceil(M),R=Math.ceil(R)),1&_){const E=A.theme.cellBorderClipDirection==="bottom-right",P=0,B=0;E?(e=Math.floor(e)-.5,i=Math.floor(i)-.5,n.role==="cell"&&(n.col===0&&(e+=1),n.row===0&&(i+=1))):(e=Math.floor(e)+.5,i=Math.floor(i)+.5);const{width:k,height:L}=sS(n,Math.ceil(M+P),Math.ceil(R+B),E);S=k,T=L}else S=Math.ceil(M),T=Math.ceil(R);t.setStrokeStyle(n,n.attribute,e,i,l),t.beginPath(),t.moveTo(e,i),t.lineTo(e+S,i),t.lineDashOffset=t.currentMatrix.e/t.currentMatrix.a,t.setLineDash((f=x[0])!==null&&f!==void 0?f:[]),t.stroke(),t.beginPath(),t.moveTo(e+S,i),t.lineTo(e+S,i+T),t.lineDashOffset=t.currentMatrix.f/t.currentMatrix.d,t.setLineDash((p=x[1])!==null&&p!==void 0?p:[]),t.stroke(),t.beginPath(),t.moveTo(e,i+T),t.lineTo(e+S,i+T),t.lineDashOffset=t.currentMatrix.e/t.currentMatrix.a,t.setLineDash((m=x[2])!==null&&m!==void 0?m:[]),t.stroke(),t.beginPath(),t.moveTo(e,i),t.lineTo(e,i+T),t.lineDashOffset=t.currentMatrix.f/t.currentMatrix.d,t.setLineDash((v=x[3])!==null&&v!==void 0?v:[]),t.stroke(),t.lineDashOffset=0,t.setLineDash([])}};rm=Is([pt()],rm);let om=class{constructor(){this.time=ne.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){const{lineWidth:g=l.lineWidth,stroke:f=l.stroke,lineDash:p=l.lineDash,strokeArrayWidth:m=l.strokeArrayWidth,strokeArrayColor:v=l.strokeArrayColor,notAdjustPos:b}=n.attribute;b!==!0&&f&&Array.isArray(p)&&!p.length&&!Array.isArray(v)&&!Array.isArray(m)&&1&g&&(c.doStroke=!1)}};om=Is([pt()],om);let sm=class{constructor(){this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d){var c,g;const{lineWidth:f=l.lineWidth,stroke:p=l.stroke,lineDash:m=l.lineDash,strokeArrayWidth:v=l.strokeArrayWidth,strokeArrayColor:b=l.strokeArrayColor,notAdjustPos:y,cornerRadius:C=l.cornerRadius}=n.attribute;let{width:w=l.width,height:_=l.height}=n.attribute;if(y!==!0&&p&&Array.isArray(m)&&!m.length&&!Array.isArray(b)&&!Array.isArray(v)&&1&f){const A=n.stage.table;if(!A)return;!((c=A.options.customConfig)===null||c===void 0)&&c._disableColumnAndRowSizeRound&&(w=Math.round(w),_=Math.round(_)),t.beginPath();const x=((g=A?.theme)===null||g===void 0?void 0:g.cellBorderClipDirection)==="bottom-right",S=0,T=0;x?(e=Math.floor(e)-.5,i=Math.floor(i)-.5,n.role==="cell"&&(n.col===0&&(e+=1),n.row===0&&(i+=1))):(e=Math.floor(e)+.5,i=Math.floor(i)+.5);const{width:M,height:R}=sS(n,Math.ceil(w),Math.ceil(_),x);C?Vo(t,e,i,M+S,R+T,C):t.rect(e,i,M,R),t.setStrokeStyle(n,n.attribute,e,i,l),t.stroke()}}};sm=Is([pt()],sm);let am=class{constructor(){this.time=ne.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){if(n.role==="cell"){const g=n.stage.table;if(g){const f=Wat(n,g);if(f)n.attribute._vtableHightLightFill=f;else if(g.stateManager.interactionState!==Pt.scrolling){const p=eF(n,g);p&&(n.attribute._vtableHightLightFill=p)}}}}};am=Is([pt()],am);let lm=class{constructor(){this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d){if(n.attribute._vtableHightLightFill&&!u){if(s){const c=n.attribute.fill;n.attribute.fill=n.attribute._vtableHightLightFill,t.setCommonStyle(n,n.attribute,e,i,l),t.fill(),n.attribute.fill=c,n.attribute._vtableHightLightFill=void 0}}}};lm=Is([pt()],lm);let hm=class{constructor(){this.time=ne.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){var g,f,p,m,v,b;const y=n.stage.table;y&&(n.role==="body"?es(t,-((g=n.attribute.x)!==null&&g!==void 0?g:0)+y.getFrozenColsWidth(),-((f=n.attribute.y)!==null&&f!==void 0?f:0)+y.getFrozenRowsHeight(),n.parent.attribute.width-y.getFrozenColsWidth()-y.getRightFrozenColsWidth(),n.parent.attribute.height-y.getFrozenRowsHeight()-y.getBottomFrozenRowsHeight()):n.role==="row-header"?es(t,0,-((p=n.attribute.y)!==null&&p!==void 0?p:0)+y.getFrozenRowsHeight(),y.getFrozenColsWidth(),n.parent.attribute.height-y.getFrozenRowsHeight()-y.getBottomFrozenRowsHeight()):n.role==="col-header"?es(t,-((m=n.attribute.x)!==null&&m!==void 0?m:0)+y.getFrozenColsWidth(),0,n.parent.attribute.width-y.getFrozenColsWidth()-y.getRightFrozenColsWidth(),y.getFrozenRowsHeight()):n.role==="right-frozen"?es(t,0,-((v=n.attribute.y)!==null&&v!==void 0?v:0)+y.getFrozenRowsHeight(),y.getRightFrozenColsWidth(),n.parent.attribute.height-y.getFrozenRowsHeight()-y.getBottomFrozenRowsHeight()):n.role==="bottom-frozen"?es(t,-((b=n.attribute.x)!==null&&b!==void 0?b:0)+y.getFrozenColsWidth(),0,n.parent.attribute.width-y.getFrozenColsWidth()-y.getRightFrozenColsWidth(),y.getBottomFrozenRowsHeight()):n.role==="corner-header"?es(t,0,0,y.getFrozenColsWidth(),y.getFrozenRowsHeight()):n.role==="corner-right-top-header"?es(t,0,0,y.getRightFrozenColsWidth(),y.getFrozenRowsHeight()):n.role==="corner-right-bottom-header"?es(t,0,0,y.getRightFrozenColsWidth(),y.getBottomFrozenRowsHeight()):n.role==="corner-left-bottom-header"&&es(t,0,0,y.getFrozenColsWidth(),y.getBottomFrozenRowsHeight()))}};hm=Is([pt()],hm);const lh=Math.pow(2,24);function es(n,t,e,i,r){n.beginPath();const o=n.applyedMatrix;Math.abs(o.f)>lh||Math.abs(o.g)>lh?n.rect(t-lh,e-lh,i+2*lh,r+2*lh):n.rect(t,e,i,r)}function sS(n,t,e,i){var r,o;const s=n.stage.table;if(!s)return{width:t,height:e};if(n.role==="cell"){let a=n.col,l=n.row;const h=mi(s,a,l);h&&(a=h.end.col,l=h.end.row),i?(a===0&&(t-=1),l===0&&(e-=1)):((a===s.colCount-1||a===s.frozenColCount-1&&s.scrollLeft||!((r=s.containerFit)===null||r===void 0)&&r.width&&s.rightFrozenColCount&&a===s.colCount-s.rightFrozenColCount-1)&&(t-=1),(l===s.rowCount-1||l===s.frozenRowCount-1&&s.scrollTop||!((o=s.containerFit)===null||o===void 0)&&o.height&&s.bottomFrozenRowCount&&l===s.rowCount-s.bottomFrozenRowCount-1)&&(e-=1))}else n.role==="corner-frozen"&&(s.scrollLeft&&!i&&(t-=1),s.scrollTop&&!i&&(e-=1));return{width:t,height:e}}function $at(n){return n.length===1?[n[0],n[0],n[0],n[0]]:n.length===2?[n[0],n[1],n[0],n[1]]:n}var aF=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let Zd=class{constructor(){this.time=ne.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){const{stroke:g=l.stroke,strokeArrayWidth:f=l.strokeArrayWidth,strokeArrayColor:p=l.strokeArrayColor}=n.attribute;g&&(Array.isArray(g)||Array.isArray(f)||Array.isArray(p))&&(c.doStroke=!1)}};Zd=aF([pt()],Zd);let Jd=class{constructor(){this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d){const{width:c=l.width,height:g=l.height,stroke:f=l.stroke,strokeArrayColor:p=l.strokeArrayColor,strokeArrayWidth:m=l.strokeArrayWidth,lineWidth:v=l.lineWidth,strokeColor:b=l.stroke,cornerRadius:y=l.cornerRadius}=n.attribute;f&&(Array.isArray(m)||v!==0)&&(Array.isArray(f)||Array.isArray(p)||Array.isArray(m))&&(n.name!=="border-rect"&&n.name!=="table-border-rect"&&(typeof v=="number"&&1&v||Array.isArray(m)&&m.some((_=>1&_)))&&(e=Math.floor(e)+.5,i=Math.floor(i)+.5),y===0||wt(y)&&y.every((_=>_===0))?sF(n,t,e,i,l,f,m||v,p||b,n.name!=="table-border-rect"?Math.ceil(c+0):c+0,n.name!=="table-border-rect"?Math.ceil(g+0):g+0):(t.beginPath(),Vo(t,e,i,c,g,y,!0,new Array(4).fill(0).map(((_,A)=>(x,S,T,M)=>{lF(A,x,S,T,M,n,t,e,i,l,f,m||v,p||b,Math.ceil(c+0),Math.ceil(g+0))}))),t.stroke()))}};Jd=aF([pt()],Jd);function lF(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f){var p,m,v,b;const y=o,C=h,w=oF(d),_=!Array.isArray(d),A=!Array.isArray(u),x=Array.isArray(c)||w.isSplitDraw;s.stroke(),s.setStrokeStyle(o,o.attribute,a,l,h);const{lineDash:S=C.lineDash}=y.attribute;let T=!1;S.length&&S.some((B=>Array.isArray(B)))&&(T=!0),s.beginPath(),s.moveTo(a,l);const M=(A||u[0])&&(_||d[0]),R=(A||u[1])&&(_||d[1]),E=(A||u[2])&&(_||d[2]),P=(A||u[3])&&(_||d[3]);M&&n===0?(_?w.width:d[0],_?w.width:d[0],s.moveTo(t,e),s.lineTo(i,r),(x||T)&&(c&&c[0]?s.strokeStyle=c[0]:c&&!c[0]&&(s.strokeStyle="transparent"),_||(s.lineWidth=d[0]),s.lineDashOffset=s.currentMatrix.e/s.currentMatrix.a,T&&s.setLineDash((p=S[0])!==null&&p!==void 0?p:[]),s.stroke(),s.beginPath())):n===0&&s.moveTo(a+g,l),R&&n===1?(_?w.width:d[1],_?w.width:d[1],s.moveTo(t,e),s.lineTo(i,r),(x||T)&&(c&&c[1]?s.strokeStyle=c[1]:c&&!c[1]&&(s.strokeStyle="transparent"),_||(s.lineWidth=d[1]),s.lineDashOffset=s.currentMatrix.f/s.currentMatrix.d,T&&s.setLineDash((m=S[1])!==null&&m!==void 0?m:[]),s.stroke(),s.beginPath(),s.moveTo(a+g,l+f))):n===1&&s.moveTo(a+g,l+f),E&&n===2?(_?w.width:d[2],_?w.width:d[2],s.moveTo(t,e),s.lineTo(i,r),(x||T)&&(c&&c[2]?s.strokeStyle=c[2]:c&&!c[2]&&(s.strokeStyle="transparent"),_||(s.lineWidth=d[2]),s.lineDashOffset=s.currentMatrix.e/s.currentMatrix.a,T&&s.setLineDash((v=S[2])!==null&&v!==void 0?v:[]),s.stroke(),s.beginPath(),s.moveTo(a,l+f))):n===2&&s.moveTo(a,l+f),P&&n===3?(_?w.width:d[3],_?w.width:d[3],s.moveTo(t,e),s.lineTo(i,r),(x||T)&&(c&&c[3]?s.strokeStyle=c[3]:c&&!c[3]&&(s.strokeStyle="transparent"),_||(s.lineWidth=d[3]),s.lineDashOffset=s.currentMatrix.f/s.currentMatrix.d,T&&s.setLineDash((b=S[3])!==null&&b!==void 0?b:[]),s.stroke(),s.beginPath(),s.moveTo(a,l))):n===3&&s.moveTo(a,l),s.closePath(),x||T||(!_&&w.width&&(s.lineWidth=w.width),s.stroke()),s.lineDashOffset=0,s.setLineDash([]),s.beginPath()}var Uat=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let ld,um=class{constructor(){this.order=1,this.interceptors=[new Xat]}afterDrawItem(n,t,e,i,r){for(let o=0;o<this.interceptors.length;o++)if(this.interceptors[o].afterDrawItem&&this.interceptors[o].afterDrawItem(n,t,e,i,r))return!0;return!1}beforeDrawItem(n,t,e,i,r){if((!n.in3dMode||e.in3dInterceptor)&&!n.shadowRoot&&!(n.baseGraphic||n.attribute.globalZIndex||n.interactiveGraphic))return!1;for(let o=0;o<this.interceptors.length;o++)if(this.interceptors[o].beforeDrawItem&&this.interceptors[o].beforeDrawItem(n,t,e,i,r))return!0;return!1}};um=Uat([pt()],um);class Xat{constructor(){this.order=1}afterDrawItem(t,e,i,r,o){return t.type==="image"&&this.drawItem(t,e,i,r,o),!1}drawItem(t,e,i,r,o){const{image:s,gif:a}=t.attribute;if(a&&t.playing||!s||!t.resources)return!1;const l=t.resources.get(s);if(!l||l.state!=="loading")return!1;if(!ld){const p=Fr(),m=p.loading_pic.svg,v=p.loading_pic.width,b=p.loading_pic.height;ld=mv({width:v,height:b,image:m})}const{image:h}=ld.attribute;if(!s||!ld.resources)return!1;const u=ld.resources.get(h);if(u.state!=="success")return!1;const{context:d}=i;d.highPerformanceSave(),t.parent&&d.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&d.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);const c=t.AABBBounds,{width:g,height:f}=zv(u.data.width,u.data.height,c.width(),c.height());return d.drawImage(u.data,c.x1+(c.width()-g)/2,c.y1+(c.height()-f)/2,g,f),d.highPerformanceRestore(),!0}}var Yat=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let dm=class{constructor(){this.time=ne.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){var g,f;const{text:p,underline:m=l.underline,lineThrough:v=l.lineThrough,direction:b=l.direction,whiteSpace:y=l.whiteSpace,fontSize:C=l.fontSize,verticalMode:w=l.verticalMode,ellipsis:_=l.ellipsis,textAlign:A=l.textAlign,textBaseline:x=l.textBaseline,x:S=l.x,y:T=l.y}=n.attribute;let M=!1;if(Array.isArray(n)){const B=(g=n.cache)===null||g===void 0?void 0:g.layoutData;_&&B&&B.lines.every((k=>k.str===""))&&(M=!0)}else{const{cache:B}=n;_&&B&&B.clipedText===""&&B.clipedWidth===0&&(M=!0)}if(!M)return;const R=Xe(_)?_:"...",E=(f=ag(n.attribute.lineHeight,C))!==null&&f!==void 0?f:C;let P=0;E!==C&&(x==="top"?P=(E-C)/2:x==="middle"||x==="bottom"&&(P=-(E-C)/2)),o&&(d?d(t,n.attribute,l):a&&(t.setStrokeStyle(n,n.attribute,S-e,T-i,l),t.strokeText(R,S,T+P))),r&&(u?u(t,n.attribute,l):s&&(t.setCommonStyle(n,n.attribute,S-e,T-i,l),t.fillText(R,S,T+P),this.drawUnderLine(m,v,n,S,T+P,0,l,t,R)))}drawUnderLine(n,t,e,i,r,o,s,a,l){if(t+n<=0)return;const{textAlign:h=s.textAlign,textBaseline:u=s.textBaseline,fontSize:d=s.fontSize,fontFamily:c=s.fontFamily,fontWeight:g=s.fontWeight,fontStyle:f=s.fontStyle,fill:p=s.fill,opacity:m=s.opacity,underlineOffset:v=s.underlineOffset,underlineDash:b=s.underlineDash,fillOpacity:y=s.fillOpacity}=e.attribute;if(!n&&!t)return;const C=nS.measureTextWidth(l,{fontSize:d,fontFamily:c,fontWeight:g,fontStyle:f}),w=bu(h,C),_=Rc(u,d,d),A={lineWidth:0,stroke:p,opacity:m,strokeOpacity:y};if(n){A.lineWidth=n,a.setStrokeStyle(e,A,i,r,s),a.setLineDash(b),a.beginPath();const x=r+_+d+v;a.moveTo(i+w,x,o),a.lineTo(i+w+C,x,o),a.stroke()}if(t){A.lineWidth=t,a.setStrokeStyle(e,A,i,r,s),a.beginPath();const x=r+_+d/2;a.moveTo(i+w,x,o),a.lineTo(i+w+C,x,o),a.stroke()}}};dm=Yat([pt()],dm);var qat=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let cm=class{constructor(){this.type="chart",this.numberType=oS}contains(n,t,e){var i;if(n.attribute.detectPickChartItem){const r=n.activeChartInstance;if(!r)return!1;const o=r.getStage();(i=o.dirtyBounds)===null||i===void 0||i.clear();const s=o.pick(t.x,t.y);return(s.graphic!==null||s.group.name!=="root")&&s}return!!n.AABBBounds.containsPoint(t)}};cm=qat([pt()],cm);const Kat=new Ot(((n,t,e,i)=>{e(_u)?i(_u).to(Zd).inSingletonScope():(n(Zd).toSelf().inSingletonScope(),n(ul).toService(Zd)),e(wu)?i(wu).to(Jd).inSingletonScope():(n(Jd).toSelf().inSingletonScope(),n(ul).toService(Jd)),n(Kd).toSelf().inSingletonScope(),n(Nat).to(Kd),n(Ln).to(Kd),n(cm).toSelf().inSingletonScope(),n(Vn).toService(cm),n(Z0).toSelf().inSingletonScope(),n(hl).toService(Z0),n(J0).toSelf().inSingletonScope(),n(hl).toService(J0),n(Q0).toSelf().inSingletonScope(),n(hl).toService(Q0),n(tm).toSelf().inSingletonScope(),n(hl).toService(tm),n(am).toSelf().inSingletonScope(),n(mr).toService(am),n(lm).toSelf().inSingletonScope(),n(mr).toService(lm),n(im).toSelf().inSingletonScope(),n(mr).toService(im),n(em).toSelf().inSingletonScope(),n(mr).toService(em),n(nm).toSelf().inSingletonScope(),n(mr).toService(nm),n(rm).toSelf().inSingletonScope(),n(mr).toService(rm),n(om).toSelf().inSingletonScope(),n(mr).toService(om),n(sm).toSelf().inSingletonScope(),n(mr).toService(sm),n(hm).toSelf().inSingletonScope(),n(mr).toService(hm),n(um).toSelf().inSingletonScope(),n(Ec).toService(um),n(dm).toSelf().inSingletonScope(),n(Hp).toService(dm)}));function Or(n,t,e,i){var r,o,s,a,l,h,u,d;n.internalProps.columnWidthConfig&&elt(n,n.internalProps.columnWidthConfig),n.isPivotTable()&&n.internalProps.columnWidthConfigForRowHeader&&rlt(n,n.internalProps.columnWidthConfigForRowHeader),t=t??0,e=e??n.colCount-1,t===0&&e===n.colCount-1&&n._clearColRangeWidthsMap();const c=n.internalProps.layoutMap;n.isPivotTable()&&(c.enableUseGetBodyCache(),c.enableUseHeaderPathCache());const g=[],f=[];if(i)for(let p=0;p<n.colCount;p++)g[p]=n.getColWidth(p);for(let p=t;p<=e;p++){let m;if(n.internalProps.transpose||((o=(r=n.internalProps.layoutMap.columnObjects)===null||r===void 0?void 0:r[p])===null||o===void 0?void 0:o.columnWidthComputeMode)!=="only-header"&&n.columnWidthComputeMode!=="only-header"||!("showHeader"in n.internalProps.layoutMap))m=n.internalProps.transpose||((a=(s=n.internalProps.layoutMap.columnObjects)===null||s===void 0?void 0:s[p])===null||a===void 0?void 0:a.columnWidthComputeMode)!=="only-body"&&n.columnWidthComputeMode!=="only-body"?Nh(p,0,n.rowCount-1,n):Nh(p,n.internalProps.layoutMap.getBodyRange().start.row,n.internalProps.layoutMap.getBodyRange().end.row,n);else{const v=n.internalProps.layoutMap.showHeader;n.internalProps.layoutMap.showHeader=!0,m=Nh(p,0,n.internalProps.layoutMap.headerLevelCount-1,n),n.internalProps.layoutMap.showHeader=v}n._setColContentWidth(p,m),n.getColWidth(p)!==m&&n._clearColRangeWidthsMap(p),i?f[p]=Math.round(n._adjustColWidth(p,m)):n._setColWidth(p,n._adjustColWidth(p,m),!1,!0)}if(n.widthMode==="adaptive"){n._clearColRangeWidthsMap();const p=n.tableNoFrameWidth;let m=0,v=0,b=n.colCount;if(n.widthAdaptiveMode==="only-body"){for(let y=0;y<n.colCount;y++){const C=i&&(l=f[y])!==null&&l!==void 0?l:n.getColWidth(y);(y<n.rowHeaderLevelCount||n.isPivotChart()&&y>=n.colCount-n.rightFrozenColCount)&&(m+=C)}v=n.rowHeaderLevelCount,b=n.isPivotChart()?n.colCount-n.rightFrozenColCount:n.colCount}gm(p-m,v,b,i,f,n)}else if(n.autoFillWidth){n._clearColRangeWidthsMap();const p=n.tableNoFrameWidth;let m=0,v=0;for(let b=0;b<n.colCount;b++){const y=i&&(h=f[b])!==null&&h!==void 0?h:n.getColWidth(b);(b<n.rowHeaderLevelCount+n.leftRowSeriesNumberCount||n.isPivotChart()&&b>=n.colCount-n.rightFrozenColCount)&&(m+=y),v+=y}v<p&&v>m&&gm(p-m,n.rowHeaderLevelCount+n.leftRowSeriesNumberCount,n.isPivotChart()?n.colCount-n.rightFrozenColCount:n.colCount,i,f,n)}if(i){for(let p=0;p<n.colCount;p++){const m=(d=(u=f[p])!==null&&u!==void 0?u:n.getColWidth(p))!==null&&d!==void 0?d:n.getColWidth(p);m!==g[p]&&n._setColWidth(p,m,!1,!0)}n.stateManager.checkFrozen();for(let p=0;p<n.colCount;p++){const m=n.getColWidth(p);m!==g[p]&&n.scenegraph.updateColWidth(p,m-g[p],!0,!0)}n.scenegraph.updateContainer({async:!0})}n.isPivotTable()&&(c.disableUseGetBodyCache(),c.disableUseHeaderPathCache())}function Nh(n,t,e,i,r=!1){let o=tlt(n,i);return i.internalProps.transpose&&o==="auto"&&(i.columnWidthComputeMode==="only-header"&&n>=i.rowHeaderLevelCount||i.columnWidthComputeMode==="only-body"&&n<i.rowHeaderLevelCount)&&(o=i.getDefaultColumnWidth(n)),r&&!i.internalProps.transpose?hk(o,n,t,e,r,i):typeof o=="number"?o:o!=="auto"&&typeof o=="string"?i._adjustColWidth(n,i._colWidthDefineToPxWidth(o)):hk(o,n,t,e,r,i)}function hk(n,t,e,i,r,o){var s,a,l,h,u;let d=0,c=1,g=1;if(i-e>5e3&&(g=Math.ceil((i-e)/5e3)),o.isPivotChart()&&t>=o.rowHeaderLevelCount&&t<o.colCount-o.rightFrozenColCount){if(o.internalProps.layoutMap.indicatorsAsCol)return o.defaultColWidth;{let m=!1;o.internalProps.layoutMap.getChartSpec(t,o.columnHeaderLevelCount).type==="heatmap"&&(m=!0);const v=o.internalProps.layoutMap.getOptimunWidthForChart(t,m);if(v>0)return v}}for(let m=e;m<=i;m+=c){if(o.isPivotChart()){const A=o.internalProps.layoutMap,x=A.getAxisConfigInPivotChart(t,m);if(x){const S=St.getFunction("computeAxisComponentWidth")(x,o);if(typeof S=="number"){d=Math.max(S,d);continue}}else if(A.isLeftBottomCorner(t,m)||A.isRightTopCorner(t,m)||A.isRightBottomCorner(t,m))continue}const v=Zat(t,m,o);if(v&&(d=Math.max(v.width,d),!v.renderDefault))continue;const b=n;if(typeof b=="number"&&o.widthMode==="standard"&&!r){d=Math.max(b,d);continue}const y=o.isHeader(t,m)?(s=o._getHeaderLayoutMap(t,m))===null||s===void 0?void 0:s.headerType:o.getBodyColumnType(t,m);if($(y)&&y!=="text"&&y!=="link"&&y!=="progressbar"&&y!=="checkbox"&&y!=="radio"&&y!=="switch"&&y!=="button"){d=Math.max(d,o.getColWidthDefinedNumber(t)||0);continue}let C=0;const w=o.internalProps.layoutMap;if(w.isHeader(t,m)){const A=w.getHeader(t,m);if(((a=A?.define)===null||a===void 0?void 0:a.columnWidthComputeMode)==="only-body")continue;$(A?.hierarchyLevel)&&(C=((l=A.hierarchyLevel)!==null&&l!==void 0?l:0)*(w.rowHierarchyType==="tree"&&(h=w.rowHierarchyIndent)!==null&&h!==void 0?h:0),w.rowHierarchyTextStartAlignment&&!o.internalProps.headerHelper.getHierarchyIcon(t,m)&&(C+=o.internalProps.headerHelper.getHierarchyIconWidth()))}else if(o.isListTable()){c=g;const A=o.getBodyColumnDefine(t,m);if(A?.tree){const x=o.dataSource.getIndexKey(o.getRecordShowIndexByCell(t,m));C=Array.isArray(x)&&o.getHierarchyState(t,m)!==Tt.none?(x.length-1)*((u=w.hierarchyIndent)!==null&&u!==void 0?u:0):0,w.hierarchyTextStartAlignment&&!o.internalProps.bodyHelper.getHierarchyIcon(t,m)&&(C+=o.internalProps.headerHelper.getHierarchyIconWidth())}}const _=Jat(t,m,y,o);d=Math.max(_+C,d),c>1&&o.bottomFrozenRowCount>0&&m<o.rowCount-o.bottomFrozenRowCount&&m+c>=o.rowCount-o.bottomFrozenRowCount&&(m=o.rowCount-o.bottomFrozenRowCount-c,c=1,g=1)}const f=o.getMinColWidth(t),p=o.getMaxColWidth(t);return d<f?f:d>p?p:(d<=0&&(d=o.defaultColWidth),d)}function Zat(n,t,e){var i,r,o,s,a,l,h;const u=e.getCustomRender(n,t);let d=e.getCustomLayout(n,t);if(u||d){let c,g=1,f=0,p=!1,m=!1;(e.isHeader(n,t)||!((i=e.getBodyColumnDefine(n,t))===null||i===void 0)&&i.mergeCell||e.hasCustomMerge())&&(c=e.getCellRange(n,t),g=c.end.col-c.start.col+1);const v={col:(r=c?.start.col)!==null&&r!==void 0?r:n,row:(o=c?.start.row)!==null&&o!==void 0?o:t,dataValue:e.getCellOriginValue(n,t),value:e.getCellValue(n,t)||"",rect:Qat(n,t,e),table:e,originCol:n,originRow:t,forComputation:!0};if(d==="react-custom-layout"&&(d=((s=e.reactCustomLayout)===null||s===void 0?void 0:s.getCustomLayoutFunc(n,t))||jc),ur(d)){const b=d(v);if(b.rootContainer){b.rootContainer=Vc(b.rootContainer),Fv(b.rootContainer,0,e.getRowHeight(t));const y=b.rootContainer.attribute.width;b.rootContainer.setStage(e.scenegraph.stage),f=y>0?y:(a=b.rootContainer.AABBBounds.width())!==null&&a!==void 0?a:0,p=b.renderDefault,m=b.enableCellPadding}else f=0,p=b.renderDefault,m=b.enableCellPadding}else if(typeof u=="function"){const b=u(v);f=(l=b?.expectedWidth)!==null&&l!==void 0?l:0,p=b?.renderDefault}else f=(h=u?.expectedWidth)!==null&&h!==void 0?h:0,p=u?.renderDefault;if(f=Math.ceil(f),m){const b=e._getCellStyle(n,t),y=Kt(ht("padding",b,n,t,e));f+=y[1]+y[3]}return{width:f/g,renderDefault:p}}}function Jat(n,t,e,i){var r,o,s,a;let l=0;const h=i.getCellValue(n,t),u=i._getCellStyle(n,t);let d=0,c=!1;if(i.getCellLocation(n,t)!=="body")c=!0;else{const w=i.getBodyColumnDefine(n,t);c=!!w?.icon||!!w?.tree||w?.dragOrder}if(c){const w=i.getCellIcons(n,t);w?.forEach((_=>{var A,x,S;_.positionType!==pe.absoluteRight&&(d+=((A=_.width)!==null&&A!==void 0?A:0)+((x=_.marginLeft)!==null&&x!==void 0?x:0)+((S=_.marginRight)!==null&&S!==void 0?S:0))}))}let g=1;if(i.isHeader(n,t)||!((r=i.getBodyColumnDefine(n,t))===null||r===void 0)&&r.mergeCell||i.hasCustomMerge()){const w=i.getCellRange(n,t);g=w.end.col-w.start.col+1}const f=Kt(ht("padding",u,n,t,i)),p=f[1]+f[3],m=ht("fontSize",u,n,t,i),v=ht("fontFamily",u,n,t,i),b=ht("fontWeight",u,n,t,i);let y;if(e==="checkbox")y=Pi(h)?h.text:h;else if(e==="radio")if(wt(h)){y="";const w=i.getBodyColumnDefine(n,t),_=(o=w?.radioDirectionInCell)!==null&&o!==void 0?o:"vertical";_==="vertical"?h.forEach((A=>{y+=(Pi(A)?A.text:A).toString()+`
`})):_==="horizontal"&&h.forEach((A=>{y+=(Pi(A)?A.text:A).toString()}))}else y=Pi(h)?h.text:h;else if(e==="button"){const w=i.getBodyColumnDefine(n,t),_=fe(w.text,{col:n,row:t,table:i,context:null,value:h,dataValue:i.getCellOriginValue(n,t)});y=(s=_??h)!==null&&s!==void 0?s:""}else y=h;const C=Gc(y,i).text;if(C.length>=1&&(C.length!==1||C[0]!=="")?C.forEach((w=>{const _=i.measureText(w,{fontSize:m,fontFamily:v,fontWeight:b}).width;l=Math.max((_+p+4+d)/g,l)})):l=Math.max((p+4+d)/g,l),i.internalProps.limitMaxAutoWidth!==!1&&(l=Math.min(typeof i.internalProps.limitMaxAutoWidth=="number"?i.internalProps.limitMaxAutoWidth:450,l)),e==="checkbox"){const w=ht("size",u,n,t,i);if(l+=w,y){const _=ht("spaceBetweenTextAndIcon",u,n,t,i);l+=_}}else if(e==="radio"){const w=ht("size",u,n,t,i),_=ht("outerRadius",u,n,t,i),A=dt(_)?2*_:w,x=ht("spaceBetweenTextAndIcon",u,n,t,i);if(wt(h)){const S=i.getBodyColumnDefine(n,t),T=ht("spaceBetweenRadio",u,n,t,i),M=(a=S?.radioDirectionInCell)!==null&&a!==void 0?a:"vertical";M==="vertical"?(l+=A,l+=x):M==="horizontal"&&(l+=(A+x)*h.length,l+=T*(h.length-1))}else l+=A,y&&(l+=x)}else if(e==="switch")l=ht("boxWidth",u,n,t,i);else if(e==="button"){const w=ht("buttonPadding",u,n,t,i);l+=2*w}return l}function Qat(n,t,e){return{left:0,top:0,right:e.getColWidth(n),bottom:e.getRowHeight(t),width:null,height:null}}function tlt(n,t){const e=t.getColWidthDefined(n);return t.internalProps._widthResizedColMap.has(n)?t.getColWidth(n):e}function gm(n,t,e,i,r,o,s){var a,l,h,u;let d=0;const c=[],g=[];let f=0;const p=new Map,m=new Map;for(let b=t;b<e;b++){const y=i&&(a=r[b])!==null&&a!==void 0?a:o.getColWidth(b),C=o.getMaxColWidth(b),w=o.getMinColWidth(b);d+=y,c.push(b),C===y?p.set(b,y):w===y&&m.set(b,y),!((l=o.options.customConfig)===null||l===void 0)&&l.shrinkSparklineFirst&&o.getBodyColumnType(b,0)==="sparkline"&&(g.push({col:b,width:y}),f+=y-o.defaultColWidth)}if(d>n)for(const[b,y]of m){n-=y,d-=y;const C=c.indexOf(b);C!==-1&&c.splice(C,1)}else if(d<n)for(const[b,y]of p){n-=y,d-=y;const C=c.indexOf(b);C!==-1&&c.splice(C,1)}const v=n/d;if(!((h=o.options.customConfig)===null||h===void 0)&&h.shrinkSparklineFirst&&v<1&&d-n<f)for(let b=0;b<g.length;b++){const{col:y,width:C}=g[b],w=(d-n)/g.length,_=Math.floor(C-w);i?r[y]=o._adjustColWidth(y,_):s?o.scenegraph.setColWidth(y,o._adjustColWidth(y,_)):o._setColWidth(y,o._adjustColWidth(y,_),!1,!0)}else for(let b=0;b<c.length;b++){const y=c[b];let C;C=b===c.length-1?n-c.reduce(((w,_,A)=>{var x;return _!==y?w+(i?(x=r[_])!==null&&x!==void 0?x:o.getColWidth(y):o.getColWidth(_)):w}),0):Math.round((i&&(u=r[y])!==null&&u!==void 0?u:o.getColWidth(y))*v),i?r[y]=o._adjustColWidth(y,C):s?o.scenegraph.setColWidth(y,o._adjustColWidth(y,C)):o._setColWidth(y,o._adjustColWidth(y,C),!1,!0)}}function elt(n,t){n.isPivotTable()?nlt(n,t):n.isListTable()&&ilt(n,t)}function ilt(n,t){for(let e=0;e<t?.length;e++){const i=t[e],r=i.key,o=i.width,s=n.internalProps.layoutMap.getColumnByKey(r);if(s.columnDefine){const{col:a}=s;n.internalProps._widthResizedColMap.has(a)||(n._setColWidth(a,o),n.internalProps._widthResizedColMap.add(a))}}}function nlt(n,t){for(let e=0;e<t?.length;e++){const i=t[e],r=i.dimensions,o=i.width,s=n.getCellAddressByHeaderPaths(r);if(s&&s.col>=n.rowHeaderLevelCount){const a=n.getCellHeaderPaths(s.col,n.columnHeaderLevelCount);if(a.colHeaderPaths.length===r.length){let l=!0;for(let h=0;h<r.length;h++){const u=r[h];if(a.colHeaderPaths.findIndex(((d,c)=>d.indicatorKey===u.indicatorKey||d.dimensionKey===u.dimensionKey&&d.value===u.value))<0){l=!1;break}}l&&!n.internalProps._widthResizedColMap.has(s.col)&&(n._setColWidth(s.col,o),n.internalProps._widthResizedColMap.add(s.col))}}else s&&s.col<n.rowHeaderLevelCount&&(n.internalProps._widthResizedColMap.has(s.col)||(n._setColWidth(s.col,o),n.internalProps._widthResizedColMap.add(s.col)))}}function rlt(n,t){for(let e=0;e<t?.length;e++){const i=t[e],r=i.dimensions,o=i.width,s=n.getCellAddressByHeaderPaths(r);s&&s.col<n.rowHeaderLevelCount&&(n.internalProps._widthResizedColMap.has(s.col)||(n._setColWidth(s.col,o),n.internalProps._widthResizedColMap.add(s.col)))}}const fm=new Vt({});fm.role="empty";function Kf(n,t,e,i,r,o,s,a,l){var h,u;let d,c,g,f=0;n.lastChild&&n.lastChild.row===i-1?f=n.lastChild.attribute.y+n.lastChild.attribute.height:n.colHeight?f=n.colHeight:i>=a.columnHeaderLevelCount&&i<a.rowCount-a.bottomFrozenRowCount&&(f=a.getRowsHeight(a.columnHeaderLevelCount,i-1));for(let p=i;p<=r;p++){const m=p;let v,b,y,C,w=a.getCellLocation(t,m),_=a.getCellValue(t,m),A=e,x=a.getRowHeight(m),S=!1;if(a.internalProps.customMergeCell){const O=a.getCustomMerge(t,m);if(O){const{range:I,text:H,style:D,customLayout:z,customRender:G}=O;if(v=I,b=v.start.col!==v.end.col||v.start.row!==v.end.row,b){const U=uk(v,o,a,i>v.start.row);A=U.cellWidth,x=U.cellHeight}_=H,y=D,(z||G)&&(C=_a(z,G,I.start.col,I.start.row,a.getColsWidth(I.start.col,I.end.col),a.getRowsHeight(I.start.row,I.end.row),!1,a.isAutoRowHeight(m),[0,0,0,0],v,a)),S=!0}}let T,M=t,R=m;v&&(M=v.start.col,R=v.start.row),!a.isPivotTable()&&(w==="columnHeader"||w==="cornerHeader")&&m>=a.columnHeaderLevelCount&&(w="body"),T=!a.isPivotTable()&&a.isSeriesNumberInBody(t,m)?a.getBodyColumnDefine(M,R):w!=="body"?a.getHeaderDefine(M,R):a.getBodyColumnDefine(M,R);const E="isAggregation"in a.internalProps.layoutMap&&a.internalProps.layoutMap.isAggregation(t,m),P=a.internalProps.layoutMap.isSeriesNumber(t,m);let B=w!=="body"||(T?.dragOrder||!!T?.icon||!!T?.tree)&&!(E&&P);if(!v&&(a.internalProps.enableTreeNodeMerge||w!=="body"||T?.mergeCell)&&(v=a.getCellRange(t,m),b=v.start.col!==v.end.col||v.start.row!==v.end.row,b)){const O=uk(v,o,a,i>v.start.row);A=O.cellWidth,x=O.cellHeight}let k=!1;if(a.internalProps.enableTreeNodeMerge&&b){const O=a.getCellRawRecord(v.start.col,v.start.row),{vtableMergeName:I,vtableMerge:H}=O??{};k=H,H&&(B=!0,a.internalProps.groupTitleCustomLayout&&(C=_a(a.internalProps.groupTitleCustomLayout,void 0,v.start.col,v.start.row,a.getColsWidth(v.start.col,v.end.col),a.getRowsHeight(v.start.row,v.end.row),!1,a.isAutoRowHeight(m),[0,0,0,0],v,a)),a.internalProps.groupTitleFieldFormat?_=a.internalProps.groupTitleFieldFormat(O,t,m,a):I!==void 0&&(_=I))}const L=k||S?"text":(u=a.isHeader(t,m)?(h=a._getHeaderLayoutMap(t,m).headerType)!==null&&h!==void 0?h:"text":a.getBodyColumnType(t,m))!==null&&u!==void 0?u:"text";if(fo(_)){slt(t,m,0,f,A,x,n),KD(_,a,olt.bind(null,{type:L,value:_,define:T,table:a,col:t,row:m,colWidth:e,cellWidth:A,cellHeight:x,columnGroup:n,y:f,customStyle:y,mayHaveIcon:B,cellLocation:w,range:v,customResult:C,defaultRowHeight:s})),n.updateColumnRowNumber(m);const O=a.getRowHeight(m);n.updateColumnHeight(O),f+=O}else{const O=y||a._getCellStyle(v?v.start.col:t,v?v.start.row:m),I=Ba(O,a,v?v.start.col:t,v?v.start.row:m,ht).theme;I.group.cornerRadius=Dv(t,m,a),I.group.width=e,I.group.height=Array.isArray(s)?s[m]:s,I._vtable.padding&&(d=I._vtable.padding),I.text.textAlign&&(c=I.text.textAlign),I.text.textBaseline&&(g=I.text.textBaseline),w==="body"||I.group.fill||(I.group.fill="#fff");const H=iS(L,_,T,a,t,m,e,A,x,n,f,d,c,g,B,I,v,C);if(n.updateColumnRowNumber(m),b){const D=a.getRowHeight(m),{width:z}=(a.getColWidth(t),H.attribute),{height:G}=H.attribute;H.contentWidth=z,H.contentHeight=G,JD(v,z,G,d,c,g,a),n.updateColumnHeight(D),f+=D}else n.updateColumnHeight(x),f+=x}}return n.setAttribute("width",e),{width:e,height:f}}function olt(n){let t,e,i;const{type:r,value:o,define:s,table:a,col:l,row:h,colWidth:u,cellWidth:d,cellHeight:c,columnGroup:g,y:f,cellLocation:p,mayHaveIcon:m,customStyle:v,range:b,customResult:y,defaultRowHeight:C}=n,w=v||a._getCellStyle(b?b.start.col:l,b?b.start.row:h),_=Ba(w,a,b?b.start.col:l,b?b.start.row:h,ht).theme;_.group.cornerRadius=Dv(l,h,a),_.group.width=u,_.group.height=Array.isArray(C)?C[h]:C,_._vtable.padding&&(t=_._vtable.padding),_.text.textAlign&&(e=_.text.textAlign),_.text.textBaseline&&(i=_.text.textBaseline),p==="body"||_.group.fill||(_.group.fill="#fff"),iS(r,o,s,a,l,h,u,d,c,g,f,t,e,i,m,_,b,y)}function uk(n,t,e,i){let r=0,o=0;const s=t.get(`${n.start.col},${n.start.row};${n.end.col},${n.end.row}`);if(!s||i){for(let a=n.start.col;a<=n.end.col;a++)r+=e.getColWidth(a);for(let a=n.start.row;a<=n.end.row;a++)o+=e.getRowHeight(a);t.set(`${n.start.col},${n.start.row};${n.end.col},${n.end.row}`,{cellWidth:r,cellHeight:o})}else r=s.cellWidth,o=s.cellHeight;return{cellWidth:r,cellHeight:o}}function slt(n,t,e,i,r,o,s){const a=new Vt({x:e,y:i,width:r,height:o});a.role="cell",a.col=n,a.row=t,s.addChild(a)}function di(n,t,e,i,r,o,s,a,l,h){if(i>r||o>s)return;const{layoutMap:u,defaultHeaderRowHeight:d,defaultColWidth:c}=l.internalProps,g=l.defaultRowHeight;let f=0,p=0;for(let m=i;m<=r;m++){const v=m,b=l.getColWidth(v),y=new Vt({x:t+f,y:e,width:b,height:0,clip:!1,pickable:!1});y.role="column",y.col=m,n.addChild(y);const{width:C,height:w}=Kf(y,v,b,o,s,l.scenegraph.mergeMap,a==="columnHeader"&&dt(d)?d:g,l);f+=C,p=Math.max(p,w)}n.setAttribute("width",f),n.setAttribute("height",p)}function alt(n,t,e,i,r,o,s,a,l){var h,u,d,c,g,f,p,m,v,b,y,C,w;const{table:_}=l,{leftBottomCornerGroup:A,rightTopCornerGroup:x,rightBottomCornerGroup:S}=_.scenegraph;let T,M,R,E;l.setParamsForRow(),l.setParamsForColumn(),(_.widthMode==="adaptive"||_.options.autoWrapText&&(_.heightMode==="adaptive"||_.isAutoRowHeight(_.columnHeaderLevelCount)))&&(R=_.colCount-1),T=Math.min(l.firstScreenColLimit-1,_.colCount-1),_.heightMode==="adaptive"&&(E=_.rowCount-1),M=Math.min(l.firstScreenRowLimit-1,_.rowCount-1),_.internalProps._widthResizedColMap.size===0&&Or(_,0,R??T),_.internalProps._heightResizedRowMap.size===0&&Lr(_,0,_.options.canvasHeight==="auto"||!((h=_.options.customConfig)===null||h===void 0)&&h.forceComputeAllRowHeight?_.rowCount-1:E??M),T<_.colCount-_.rightFrozenColCount&&_.colCount-_.rightFrozenColCount<=_.colCount-1&&Or(_,_.colCount-_.rightFrozenColCount,_.colCount-1),M<_.rowCount-_.bottomFrozenRowCount&&_.rowCount-_.bottomFrozenRowCount<=_.rowCount-1&&Lr(_,_.rowCount-_.bottomFrozenRowCount,_.rowCount-1),_.scenegraph.colHeaderGroup.setAttribute("x",_.getFrozenColsWidth()),_.scenegraph.rowHeaderGroup.setAttribute("y",_.getFrozenRowsHeight()),_.scenegraph.bottomFrozenGroup.setAttribute("x",_.getFrozenColsWidth()),_.scenegraph.rightFrozenGroup.setAttribute("y",_.getFrozenRowsHeight()),_.scenegraph.bodyGroup.setAttributes({x:_.getFrozenColsWidth(),y:_.getFrozenRowsHeight()}),di(n,s,a,0,_.frozenColCount-1,0,_.frozenRowCount-1,_.isListTable()?"columnHeader":"cornerHeader",_),T-_.rightFrozenColCount>=_.frozenColCount&&di(t,s,a,_.frozenColCount,T-_.rightFrozenColCount,0,_.frozenRowCount-1,"columnHeader",_),_.frozenColCount>0&&(_.leftRowSeriesNumberCount>0&&di(e,s,a,0,_.leftRowSeriesNumberCount-1,_.frozenRowCount,M-_.bottomFrozenRowCount,"rowHeader",_),_.frozenColCount>_.leftRowSeriesNumberCount&&di(e,s,a,_.leftRowSeriesNumberCount,Math.min(_.frozenColCount-1,_.rowHeaderLevelCount+_.leftRowSeriesNumberCount-1),_.frozenRowCount,M-_.bottomFrozenRowCount,"rowHeader",_),_.frozenColCount>_.rowHeaderLevelCount+_.leftRowSeriesNumberCount&&di(e,s,a,_.rowHeaderLevelCount+_.leftRowSeriesNumberCount,_.frozenColCount-1,_.frozenRowCount,M-_.bottomFrozenRowCount,"body",_)),_.bottomFrozenRowCount>0&&(_.frozenColCount>0&&(_.leftRowSeriesNumberCount>0&&di(A,s,a,0,_.leftRowSeriesNumberCount-1,_.rowCount-1-_.bottomFrozenRowCount+1,_.rowCount-1,"rowHeader",_),_.rowHeaderLevelCount>0&&di(A,s,a,_.leftRowSeriesNumberCount,_.leftRowSeriesNumberCount+_.rowHeaderLevelCount-1,_.rowCount-1-_.bottomFrozenRowCount+1,_.rowCount-1,"rowHeader",_),_.frozenColCount>_.rowHeaderLevelCount+_.leftRowSeriesNumberCount&&di(A,s,a,_.rowHeaderLevelCount+_.leftRowSeriesNumberCount,_.frozenColCount-1,_.rowCount-1-_.bottomFrozenRowCount+1,_.rowCount-1,"body",_)),T-_.rightFrozenColCount>=_.frozenColCount&&di(r,s,a,_.frozenColCount,T-_.rightFrozenColCount,_.rowCount-1-_.bottomFrozenRowCount+1,_.rowCount-1,_.isPivotChart()?"rowHeader":"body",_)),_.rightFrozenColCount>0&&(di(x,s,a,_.colCount-1-_.rightFrozenColCount+1,_.colCount-1,0,_.frozenRowCount-1,"columnHeader",_),di(i,s,a,_.colCount-1-_.rightFrozenColCount+1,_.colCount-1,_.frozenRowCount,M-_.bottomFrozenRowCount,_.isPivotChart()?"rowHeader":"body",_)),_.bottomFrozenRowCount>0&&_.rightFrozenColCount>0&&di(S,s,a,_.colCount-1-_.rightFrozenColCount+1,_.colCount-1,_.rowCount-1-_.bottomFrozenRowCount+1,_.rowCount-1,"body",_),T-_.rightFrozenColCount>=_.frozenColCount&&di(o,s,a,_.frozenColCount,T-_.rightFrozenColCount,_.frozenRowCount,M-_.bottomFrozenRowCount,"body",_),o.firstChild||t.firstChild||n.firstChild||e.firstChild?(l.currentRow=(g=(d=(u=o.firstChild)===null||u===void 0?void 0:u.rowNumber)!==null&&d!==void 0?d:(c=e.firstChild)===null||c===void 0?void 0:c.rowNumber)!==null&&g!==void 0?g:l.totalRow,l.rowEnd=l.currentRow,l.rowUpdatePos=l.rowEnd+1,l.referenceRow=l.rowStart+Math.floor((l.rowEnd-l.rowStart)/2),l.currentCol=(w=(y=(v=(p=(f=o.lastChild)===null||f===void 0?void 0:f.col)!==null&&p!==void 0?p:(m=t.lastChild)===null||m===void 0?void 0:m.col)!==null&&v!==void 0?v:(b=e.lastChild)===null||b===void 0?void 0:b.col)!==null&&y!==void 0?y:(C=n.lastChild)===null||C===void 0?void 0:C.col)!==null&&w!==void 0?w:l.totalCol,l.colEnd=l.currentCol,l.colUpdatePos=l.colEnd+1,l.referenceCol=l.colStart+Math.floor((l.colEnd-l.colStart)/2),l.progress()):(l.currentRow=l.totalRow,l.rowEnd=l.currentRow,l.rowUpdatePos=l.rowEnd+1,l.referenceRow=l.rowStart+Math.floor((l.rowEnd-l.rowStart)/2),l.currentCol=l.totalCol,l.colEnd=l.currentCol,l.colUpdatePos=l.colEnd+1,l.referenceCol=l.colStart+Math.floor((l.colEnd-l.colStart)/2))}function dk(n){let t=n.firstChild;for(;t&&t.type!=="group";)t=t._next;return t}function Uc(n){let t=n.lastChild;for(;t&&t.type!=="group";)t=t._prev;return t}function llt(n){let t=n._prev;for(;t&&t.type!=="group";)t=t._prev;return t}function hlt(n){let t=n._next;for(;t&&t.type!=="group";)t=t._next;return t}function l1(n,t,e,i="left"){for(let a=n;a<=t;a++){const l=e.scenegraph.getColGroup(a);l&&AC(l,e,i);const h=e.scenegraph.getColGroup(a,!0);h&&AC(h,e,i);const u=e.scenegraph.getColGroupInBottom(a);u&&AC(u,e,i)}const r=Math.min(e.scenegraph.proxy.colLimit,e.scenegraph.proxy.bodyRightCol-e.scenegraph.proxy.bodyLeftCol+1),o=e.getColsWidth(e.frozenColCount,e.frozenColCount+r),s=e.getColsWidth(e.frozenColCount,e.colCount-1);e.scenegraph.proxy.xLimitLeft=o/2,e.scenegraph.proxy.xLimitRight=s-o/2}function AC(n,t,e="left"){if(e==="left"){let i;const r=llt(n);i=r?r.attribute.x+t.getColWidth(n._prev.col):t.getColsWidth(t.frozenColCount,n.col-1),n.setAttribute("x",i)}else{let i;const r=hlt(n);i=r?r.attribute.x-t.getColWidth(n.col):t.getColsWidth(t.frozenColCount,n.col-1),n.setAttribute("x",i)}}var hF=function(n,t,e,i){return new(e||(e=Promise))((function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e((function(d){d(u)}))).then(s,a)}l((i=i.apply(n,t||[])).next())}))};function ult(n,t,e,i){return hF(this,void 0,void 0,(function*(){if(!t)return;const r=t.col,o=t.left;let s;if(s=e?i.bodyRightCol-i.colEnd:i.screenLeftCol-i.referenceCol,dlt(s,r,o,n,i),e){const a=i.table.scenegraph.getColGroup(i.colEnd);if(a){const l=a.attribute.x+a.attribute.width-(i.table.tableNoFrameWidth-i.table.getFrozenColsWidth()-i.table.getRightFrozenColsWidth())-n;i.deltaX=-l,i.table.scenegraph.setBodyAndColHeaderX(-n+i.deltaX)}}i.table.scenegraph.updateNextFrame()}))}function dlt(n,t,e,i,r){n>0?(ck(n,"left",r.screenLeftCol,e,i,r),r.updateDeltaX(i,e,t),r.table.scenegraph.setBodyAndColHeaderX(-i+r.deltaX)):n<0?(ck(-n,"right",r.screenLeftCol,e,i,r),r.updateDeltaX(i,e,t),r.table.scenegraph.setBodyAndColHeaderX(-i+r.deltaX)):(r.updateDeltaX(i,e,t),r.table.scenegraph.setBodyAndColHeaderX(-i+r.deltaX))}function ck(n,t,e,i,r,o){return hF(this,void 0,void 0,(function*(){if(t==="left"&&o.colEnd+n>o.bodyRightCol?n=o.bodyRightCol-o.colEnd:t==="right"&&o.colStart-n<o.bodyLeftCol&&(n=o.colStart-o.bodyLeftCol),n!==0)if(n<0&&(t=t==="left"?"right":"left",n=-n),n<o.colEnd-o.colStart){const s=t==="left"?o.colStart:o.colEnd-n+1,a=t==="left"?o.colStart+n-1:o.colEnd,l=t==="left"?o.colEnd+1:o.colStart-n,h=t==="left"?o.colEnd+n:o.colStart-1;Or(o.table,l,h),glt(s,a,t,o);const u=l,d=h;o.colStart=t==="left"?o.colStart+n:o.colStart-n,o.colEnd=t==="left"?o.colEnd+n:o.colEnd-n,Xc(u,d,o),l1(u,d,o.table,t);const c=o.table.scenegraph.getColGroup(e)||o.table.scenegraph.getColGroup(e,!0),g=i-(c.attribute.x+o.table.getFrozenColsWidth()+o.table.scenegraph.proxy.deltaX);o.table.scenegraph.proxy.deltaX+=g,o.currentCol=t==="left"?o.currentCol+n:o.currentCol-n,o.totalCol=Math.max(0,Math.min(o.table.colCount-1,t==="left"?o.totalCol+n:o.totalCol-n)),o.referenceCol=o.colStart+Math.floor((o.colEnd-o.colStart)/2),o.colUpdatePos=l,o.colUpdateDirection=t,o.table.scenegraph.updateNextFrame()}else{const s=t==="left"?o.colStart+n:o.colStart-n,a=t==="left"?o.colEnd+n:o.colEnd-n;Or(o.table,s,a),flt(o.table.getColsWidth(o.bodyLeftCol,s-1),n,t,o);const l=s,h=a;o.colStart=s,o.colEnd=a,Xc(l,h,o),l1(l,h,o.table,a>o.bodyRightCol-(o.colEnd-o.colStart+1)?"right":"left"),o.currentCol=t==="left"?o.currentCol+n:o.currentCol-n,o.totalCol=Math.max(0,Math.min(o.table.colCount-1,t==="left"?o.totalCol+n:o.totalCol-n)),o.referenceCol=o.colStart+Math.floor((o.colEnd-o.colStart)/2),o.colUpdatePos=o.colStart,o.colUpdateDirection=a>o.bodyRightCol-(o.colEnd-o.colStart+1)?"right":"left",o.table.scenegraph.updateNextFrame()}}))}function Qd(n,t,e){n.col=t,n.forEachChildren((i=>{i.col=t,i.needUpdate=!0})),n.setAttribute("x",e),n.needUpdate=!0}function Af(n,t){if(!n)return;let e=n.firstChild;for(;e;)e=t.updateCellGroupContent(e)._next;n.needUpdate=!1,n.setAttribute("width",t.table.getColWidth(n.col))}function clt(n,t){if(!n)return;const e=t.screenTopRow,i=Math.max(t.bodyTopRow,e-1*t.screenRowCount),r=Math.min(t.bodyBottomRow,e+2*t.screenRowCount,t.table.rowCount-1);for(let o=i;o<=r;o++){const s=t.highPerformanceGetCell(n.col,o,!0);t.updateCellGroupContent(s)}t.rowUpdatePos=t.rowStart,n.needUpdate=!1,n.setAttribute("width",t.table.getColWidth(n.col))}function glt(n,t,e,i){for(let r=n;r<=t;r++)i.table.scenegraph.bodyGroup.childrenCount>0&&i.table.scenegraph.bodyGroup.firstChild.type==="group"&&MC(i.table.scenegraph.bodyGroup,e,i),i.table.scenegraph.colHeaderGroup.childrenCount>0&&i.table.scenegraph.colHeaderGroup.firstChild.type==="group"&&MC(i.table.scenegraph.colHeaderGroup,e,i),i.table.scenegraph.bottomFrozenGroup.childrenCount>0&&i.table.scenegraph.bottomFrozenGroup.firstChild.type==="group"&&MC(i.table.scenegraph.bottomFrozenGroup,e,i)}function MC(n,t,e){if(t==="left"){const i=dk(n),r=Uc(n);Qd(i,r.col+1,r.attribute.x+e.table.getColWidth(r.col)),n.appendChild(i),n.border&&n.appendChild(n.border)}else{const i=Uc(n),r=dk(n);Qd(i,r.col-1,r.attribute.x-e.table.getColWidth(r.col-1)),n.insertBefore(i,n.firstChild)}}function Xc(n,t,e){for(let i=n;i<=t;i++){const r=e.table.scenegraph.getColGroup(i,!0);r&&Af(r,e);const o=e.table.scenegraph.getColGroupInBottom(i);o&&Af(o,e);const s=e.table.scenegraph.getColGroupInRightTopCorner(i);s&&Af(s,e);const a=e.table.scenegraph.getColGroupInRightBottomCorner(i);a&&Af(a,e);const l=e.table.scenegraph.getColGroup(i);l&&clt(l,e)}TC(e.table.scenegraph.colHeaderGroup),TC(e.table.scenegraph.bottomFrozenGroup),TC(e.table.scenegraph.bodyGroup),e.progress()}function flt(n,t,e,i){i.table.scenegraph.colHeaderGroup.forEachChildren(((r,o)=>{r.type==="group"&&Qd(r,e==="left"?r.col+t:r.col-t,o===0?n:r._prev.attribute.x+i.table.getColWidth(r._prev.col))})),i.table.scenegraph.bottomFrozenGroup.forEachChildren(((r,o)=>{r.type==="group"&&Qd(r,e==="left"?r.col+t:r.col-t,o===0?n:r._prev.attribute.x+i.table.getColWidth(r._prev.col))})),i.table.scenegraph.bodyGroup.forEachChildren(((r,o)=>{r.type==="group"&&Qd(r,e==="left"?r.col+t:r.col-t,o===0?n:r._prev.attribute.x+i.table.getColWidth(r._prev.col))}))}function TC(n){var t,e;const i=Uc(n);if(i&&(n.setAttribute("width",i.attribute.x+i.attribute.width),n.border)){const r=n.border;r.setAttribute("width",i.attribute.x+i.attribute.width-((t=r.attribute.borderLeft)!==null&&t!==void 0?t:0)/2-((e=r.attribute.borderRight)!==null&&e!==void 0?e:0)/2)}}function ir(n,t,e,i,r,o="up",s){var a,l;if(o==="up")for(let c=n;c<=t;c++)for(let g=e;g<=i;g++){const f=r.scenegraph.highPerformanceGetCell(c,g,!0);if(f.role!=="cell"||!f.row)continue;let p;if(f._prev)p=((a=f._prev)===null||a===void 0?void 0:a.attribute.y)+r.getRowHeight(f._prev.row);else if(s){const m=i===r.rowCount-r.bottomFrozenRowCount-1?i:i+1;if(p=r.scenegraph.highPerformanceGetCell(c,m,!0).attribute.y,$(p))for(let v=g;v<m;v++)p-=r.getRowHeight(v)}else p=gk(f.row,r);$(p)&&f.setAttribute("y",p)}else for(let c=n;c<=t;c++)for(let g=i;g>=e;g--){const f=r.scenegraph.highPerformanceGetCell(c,g,!0);if(f.role!=="cell"||!f.row)continue;let p;if(f._next)p=((l=f._next)===null||l===void 0?void 0:l.attribute.y)-r.getRowHeight(f.row);else if(s){const m=e<=r.frozenRowCount?r.frozenRowCount:e-1;e<=r.frozenRowCount?p=0:p=r.scenegraph.highPerformanceGetCell(c,m,!0).attribute.y;for(let v=m;v<g;v++)p+=r.getRowHeight(v)}else p=gk(f.row,r);$(p)&&f.setAttribute("y",p)}const h=Math.min(r.scenegraph.proxy.rowLimit,r.scenegraph.proxy.bodyBottomRow-r.scenegraph.proxy.bodyTopRow+1),u=r.getRowsHeight(r.frozenRowCount,r.frozenRowCount+h),d=r.getRowsHeight(r.frozenRowCount,r.rowCount-1);r.scenegraph.proxy.yLimitTop=u/2,r.scenegraph.proxy.yLimitBottom=d-u/2}function gk(n,t){let e;return e=n<t.frozenRowCount?t.getRowsHeight(0,n-1):n>=t.rowCount-t.bottomFrozenRowCount?t.getRowsHeight(t.rowCount-t.bottomFrozenRowCount,n-1):t.getRowsHeight(t.frozenRowCount,n-1),e}var uF=function(n,t,e,i){return new(e||(e=Promise))((function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e((function(d){d(u)}))).then(s,a)}l((i=i.apply(n,t||[])).next())}))};function plt(n,t,e,i){return uF(this,void 0,void 0,(function*(){if(!t)return;const r=t.row,o=t.top;let s;if(s=e?i.bodyBottomRow-i.rowEnd:r-i.referenceRow,mlt(s,r,o,n,i),e){const a=i.table.scenegraph.highPerformanceGetCell(i.colStart,i.rowEnd,!0);if(a.role==="cell"){const l=a.attribute.y+a.attribute.height-(i.table.tableNoFrameHeight-i.table.getFrozenRowsHeight()-i.table.getBottomFrozenRowsHeight())-n;i.deltaY=-l,i.updateBody(n-i.deltaY)}}}))}function mlt(n,t,e,i,r){n>0?(fk(n,"up",t,e,i,r),r.updateDeltaY(i,e,t),r.updateBody(i-r.deltaY)):n<0?(fk(-n,"down",t,e,i,r),r.updateDeltaY(i,e,t),r.updateBody(i-r.deltaY)):(r.updateDeltaY(i,e,t),r.updateBody(i-r.deltaY))}function fk(n,t,e,i,r,o){return uF(this,void 0,void 0,(function*(){if(t==="up"&&o.rowEnd+n>o.bodyBottomRow?n=o.bodyBottomRow-o.rowEnd:t==="down"&&o.rowStart-n<o.bodyTopRow&&(n=o.rowStart-o.bodyTopRow),n!==0)if(n<0&&(t=t==="up"?"down":"up",n=-n),n<o.rowEnd-o.rowStart){const s=t==="up"?o.rowStart:o.rowEnd-n+1,a=t==="up"?o.rowStart+n-1:o.rowEnd,l=t==="up"?o.rowEnd+1:o.rowStart-n,h=t==="up"?o.rowEnd+n:o.rowStart-1;let u,d;o.table.isAutoRowHeight(s)?(u=l,d=h):(u=Math.max(o.bodyTopRow,e-1*o.screenRowCount),d=Math.min(o.bodyBottomRow,e+2*o.screenRowCount,o.table.rowCount-1)),Lr(o.table,u,d,!1),vlt(s,a,t,o),o.rowStart=t==="up"?o.rowStart+n:o.rowStart-n,o.rowEnd=t==="up"?o.rowEnd+n:o.rowEnd-n;const c=Yc(u,d,o,!0);o.table.isAutoRowHeight(s)&&(ir(o.bodyLeftCol,o.bodyRightCol,u,d,o.table,h>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up",!0),ir(0,o.table.frozenColCount-1,u,d,o.table,h>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up",!0),ir(o.table.colCount-o.table.rightFrozenColCount,o.table.colCount-1,u,d,o.table,h>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up",!0)),o.currentRow=t==="up"?o.currentRow+n:o.currentRow-n,o.totalRow=Math.max(0,Math.min(o.bodyBottomRow,t==="up"?o.totalRow+n:o.totalRow-n,o.table.rowCount-1)),o.referenceRow=o.rowStart+Math.floor((o.rowEnd-o.rowStart)/2),o.table.isAutoRowHeight(s)&&c?o.rowUpdatePos=Math.min(o.rowUpdatePos,o.rowEnd+1):o.rowUpdatePos=Math.min(o.rowUpdatePos,l),o.rowUpdateDirection=t,o.table.scenegraph.updateNextFrame(),yield o.progress()}else{const s=t==="up"?o.rowStart+n:o.rowStart-n,a=Math.min(o.table.rowCount-1,t==="up"?o.rowEnd+n:o.rowEnd-n),l=o.table.getRowsHeight(o.bodyTopRow,s-1);let h,u;o.table.isAutoRowHeight(s)?(h=s,u=a):(h=Math.max(o.bodyTopRow,e-1*o.screenRowCount),u=Math.min(o.bodyBottomRow,e+2*o.screenRowCount,o.table.rowCount-1)),Lr(o.table,h,u,!1),blt(l,n,t,o),o.rowStart=s,o.rowEnd=a;const d=Yc(h,u,o,!0);o.table.isAutoRowHeight(s)&&(ir(o.bodyLeftCol,o.bodyRightCol,h,u,o.table,a>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up"),ir(0,o.table.frozenColCount-1,h,u,o.table,a>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up"),ir(o.table.colCount-o.table.rightFrozenColCount,o.table.colCount-1,h,u,o.table,a>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up")),o.currentRow=t==="up"?o.currentRow+n:o.currentRow-n,o.totalRow=Math.max(0,Math.min(o.bodyBottomRow,t==="up"?o.totalRow+n:o.totalRow-n,o.table.rowCount-1)),o.referenceRow=o.rowStart+Math.floor((o.rowEnd-o.rowStart)/2),o.table.isAutoRowHeight(s)&&d?o.rowUpdatePos=o.rowEnd+1:o.rowUpdatePos=o.rowStart,o.rowUpdateDirection=a>o.bodyBottomRow-(o.rowEnd-o.rowStart+1)?"down":"up",o.table.scenegraph.updateNextFrame(),yield o.progress()}}))}function vlt(n,t,e,i){for(let r=0;r<i.table.frozenColCount;r++){const o=i.table.scenegraph.getColGroup(r);if(o)for(let s=n;s<=t;s++)RC(o,e,i)}for(let r=i.table.colCount-i.table.rightFrozenColCount;r<i.table.colCount;r++){const o=i.table.scenegraph.getColGroup(r);if(o)for(let s=n;s<=t;s++)RC(o,e,i)}for(let r=i.bodyLeftCol;r<=i.bodyRightCol;r++){const o=i.table.scenegraph.getColGroup(r);if(o)for(let s=n;s<=t;s++)RC(o,e,i)}}function RC(n,t,e){if(n.childrenCount>=1)if(t==="up"){const i=n.firstChild;e.updateCellGroupPosition(i,n.lastChild.row+1,n.lastChild.attribute.y+e.table.getRowHeight(n.lastChild.row)),n.appendChild(i)}else{const i=n.lastChild;e.updateCellGroupPosition(i,n.firstChild.row-1,n.firstChild.attribute.y-e.table.getRowHeight(i.row)),n.insertBefore(i,n.firstChild)}}function blt(n,t,e,i){for(let r=0;r<i.table.frozenColCount;r++){const o=i.table.scenegraph.getColGroup(r);o?.forEachChildren(((s,a)=>{i.updateCellGroupPosition(s,e==="up"?s.row+t:s.row-t,a===0?n:s._prev.attribute.y+i.table.getRowHeight(s._prev.row))}))}for(let r=i.table.colCount-i.table.rightFrozenColCount;r<i.table.colCount;r++){const o=i.table.scenegraph.getColGroup(r);o?.forEachChildren(((s,a)=>{i.updateCellGroupPosition(s,e==="up"?s.row+t:s.row-t,a===0?n:s._prev.attribute.y+i.table.getRowHeight(s._prev.row))}))}for(let r=i.bodyLeftCol;r<=i.bodyRightCol;r++){const o=i.table.scenegraph.getColGroup(r);o?.forEachChildren(((s,a)=>{i.updateCellGroupPosition(s,e==="up"?s.row+t:s.row-t,a===0?n:s._prev.attribute.y+i.table.getRowHeight(s._prev.row))}))}}function Yc(n,t,e,i=!1){for(let a=0;a<e.table.frozenColCount;a++)for(let l=n;l<=t;l++){const h=e.highPerformanceGetCell(a,l,!0);e.updateCellGroupContent(h)}for(let a=e.table.colCount-e.table.rightFrozenColCount;a<e.table.colCount;a++)for(let l=n;l<=t;l++){const h=e.highPerformanceGetCell(a,l);e.updateCellGroupContent(h)}let r=e.bodyLeftCol,o=e.bodyRightCol,s=!0;if(i){const a=e.screenLeftCol;r=Math.max(e.bodyLeftCol,a-1*e.screenColCount),o=Math.min(e.bodyRightCol,a+2*e.screenColCount),r===e.bodyLeftCol&&o===e.bodyRightCol||(s=!1)}for(let a=r;a<=o;a++)for(let l=n;l<=t;l++){const h=e.highPerformanceGetCell(a,l);e.updateCellGroupContent(h)}return BC(e.table.scenegraph.rowHeaderGroup),BC(e.table.scenegraph.rightFrozenGroup),BC(e.table.scenegraph.bodyGroup),e.table.scenegraph.updateNextFrame(),s}function BC(n){var t,e;const i=Uc(n);if(!i)return;const r=Uc(i);if(r&&(n.setAttribute("height",r.attribute.y+r.attribute.height),n.border)){const o=n.border;o.setAttribute("height",r.attribute.y+r.attribute.height-((t=o.attribute.borderTop)!==null&&t!==void 0?t:0)/2-((e=o.attribute.borderBottom)!==null&&e!==void 0?e:0)/2)}}var ylt=function(n,t,e,i){return new(e||(e=Promise))((function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e((function(d){d(u)}))).then(s,a)}l((i=i.apply(n,t||[])).next())}))};function Clt(n){var t;return ylt(this,void 0,void 0,(function*(){let e,i;n.table.scenegraph.bodyGroup.forEachChildren(((s,a)=>{s.type==="group"&&(s.needUpdate=!0,s?.forEachChildren((l=>{l.needUpdate=!0})))})),n.table.isAutoRowHeight(n.rowStart)?(e=n.rowStart,i=n.rowEnd):(e=Math.max(n.bodyTopRow,n.screenTopRow-1*n.screenRowCount),i=Math.min(n.bodyBottomRow,n.screenTopRow+2*n.screenRowCount,n.table.rowCount-1));const r=n.table.getAllRowsHeight();Lr(n.table,e,i);const o=n.table.getAllRowsHeight();r!==o&&n.table.scenegraph.updateContainerHeight(n.table.frozenRowCount,o-r);for(let s=0;s<((t=n.table.frozenColCount)!==null&&t!==void 0?t:0);s++){const a=n.table.scenegraph.getColGroup(s);a?.setAttribute("chartInstance",void 0);for(let l=n.rowStart;l<=n.rowEnd;l++)n.table.scenegraph.updateCellContent(s,l);for(let l=n.table.rowCount-n.table.bottomFrozenRowCount;l<n.table.rowCount;l++)n.table.scenegraph.updateCellContent(s,l)}for(let s=n.colStart;s<=n.colEnd;s++){const a=n.table.scenegraph.getColGroup(s);a?.setAttribute("chartInstance",void 0);for(let l=n.table.rowCount-n.table.bottomFrozenRowCount;l<n.table.rowCount;l++)n.table.scenegraph.updateCellContent(s,l)}for(let s=n.table.colCount-n.table.rightFrozenColCount;s<n.table.colCount;s++){const a=n.table.scenegraph.getColGroup(s);a?.setAttribute("chartInstance",void 0);for(let l=n.rowStart;l<=n.rowEnd;l++)n.table.scenegraph.updateCellContent(s,l);for(let l=n.table.rowCount-n.table.bottomFrozenRowCount;l<n.table.rowCount;l++)n.table.scenegraph.updateCellContent(s,l)}Yc(e,i,n),n.table.isAutoRowHeight(e)&&ir(n.bodyLeftCol,n.bodyRightCol,e,i,n.table,n.rowEnd>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up"),n.rowUpdatePos=n.rowStart,n.rowUpdateDirection=n.rowEnd>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up",n.table.scenegraph.updateNextFrame(),n.table.isAutoRowHeight(n.rowStart)||(yield n.progress())}))}var _lt=function(n,t,e,i){return new(e||(e=Promise))((function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e((function(d){d(u)}))).then(s,a)}l((i=i.apply(n,t||[])).next())}))};function wlt(n){return _lt(this,void 0,void 0,(function*(){n.table.scenegraph.bodyGroup.forEachChildren(((i,r)=>{i.type==="group"&&(i.needUpdate=!0,i?.forEachChildren((o=>{o.needUpdate=!0})))}));const t=Math.max(n.bodyLeftCol,n.screenLeftCol-1*n.screenColCount),e=Math.min(n.bodyRightCol,n.screenLeftCol+2*n.screenColCount);Or(n.table,t,e);for(let i=n.colStart;i<=n.colEnd;i++){const r=n.table.scenegraph.getColGroup(i);r?.setAttribute("chartInstance",void 0);for(let o=n.table.rowCount-n.table.bottomFrozenRowCount;o<n.table.rowCount;o++)n.table.scenegraph.updateCellContent(i,o)}for(let i=n.table.colCount-n.table.rightFrozenColCount;i<n.table.colCount;i++){const r=n.table.scenegraph.getColGroup(i);r?.setAttribute("chartInstance",void 0);for(let o=n.rowStart;o<=n.rowEnd;o++)n.table.scenegraph.updateCellContent(i,o);for(let o=n.table.rowCount-n.table.bottomFrozenRowCount;o<n.table.rowCount;o++)n.table.scenegraph.updateCellContent(i,o)}Xc(t,e,n),n.colUpdatePos=n.colStart,n.colUpdateDirection=n.colEnd>n.bodyRightCol-(n.colEnd-n.colStart+1)?"right":"left",n.table.scenegraph.updateNextFrame(),yield n.progress()}))}function aS(n){const{changedCells:t}=n.internalProps.stick;return t.forEach((e=>{n.scenegraph.getCell(e.col,e.row).forEachChildren((i=>{i.setAttributes({dx:e.dx,dy:e.dy})}))})),t.clear(),t}function tc(n){const t=aS(n),{scrollTop:e,scrollLeft:i,frozenRowCount:r,frozenColCount:o}=n,s=n.getFrozenRowsHeight(),a=n.getFrozenColsWidth(),{row:l}=n.getRowAt(e+s+1),{col:h}=n.getColAt(i+a+1),u=Math.max(l,n.frozenRowCount),d=Math.max(h,n.frozenColCount),c=n.getAllRowsHeight()>n.tableNoFrameHeight?n.getRowAt(e+n.tableNoFrameHeight-n.getBottomFrozenRowsHeight()-1).row:n.rowCount-n.bottomFrozenRowCount-1,g=n.getAllColsWidth()>n.tableNoFrameWidth?n.getColAt(i+n.tableNoFrameWidth-n.getRightFrozenColsWidth()-1).col:n.colCount-n.rightFrozenColCount-1;if(!(g<0||c<0)){for(let f=0;f<r&&!(g<d);f++)[d,g].forEach((p=>{const m=n._getCellStyle(p,f);m?.textStick&&m?.textStick!=="vertical"&&vk(n.scenegraph.getCell(p,f),a+n.tableX,n.tableNoFrameWidth-n.getRightFrozenColsWidth()+n.tableX,t,m?.textStickBaseOnAlign,n)}));for(let f=0;f<o&&!(c<u);f++)[u,c].forEach((p=>{const m=n._getCellStyle(f,p);m?.textStick&&m?.textStick!=="horizontal"&&pk(n.scenegraph.getCell(f,p),s+n.tableY,n.tableNoFrameHeight-n.getBottomFrozenRowsHeight()+n.tableY,t,m?.textStickBaseOnAlign,n)}));for(let f=d;f<=g&&!(c<u);f++)[u,c].forEach((p=>{const m=n._getCellStyle(f,p);m?.textStick&&m?.textStick!=="horizontal"&&pk(n.scenegraph.getCell(f,p),s+n.tableY,n.tableNoFrameHeight-n.getBottomFrozenRowsHeight()+n.tableY,t,m?.textStickBaseOnAlign,n)}));for(let f=u;f<=c&&!(g<d);f++)[d,g].forEach((p=>{const m=n._getCellStyle(p,f);m?.textStick&&m?.textStick!=="vertical"&&vk(n.scenegraph.getCell(p,f),a+n.tableX,n.tableNoFrameWidth-n.getRightFrozenColsWidth()+n.tableX,t,m?.textStickBaseOnAlign,n)}))}}function pk(n,t,e,i,r,o){if(dt(n.mergeStartCol)&&dt(n.mergeStartRow)&&dt(n.mergeEndCol)&&dt(n.mergeEndRow)){const{colStart:s,colEnd:a,rowStart:l,rowEnd:h}=ka(n,o.scenegraph);for(let u=s;u<=a;u++)for(let d=l;d<=h;d++){const c=o.scenegraph.getCell(u,d);c.role==="cell"&&mk(c,t,e,i,r)}}else mk(n,t,e,i,r)}function mk(n,t,e,i,r){var o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w;const _=n.getChildByName("text",!0)||n.getChildByName("image",!0);if(!_)return;if(_.type==="image"){const{image:T}=_.attribute;if(!T||!_.resources||_.resources.get(T).state!=="success")return}const A=(o=_.textBaseline)!==null&&o!==void 0?o:"top";_.AABBBounds.width();const x=_.globalAABBBounds.y1,S=_.globalAABBBounds.y2;if(A==="middle"&&r){const T=n.globalAABBBounds.y1+((a=(s=n.firstChild)===null||s===void 0?void 0:s.attribute.dy)!==null&&a!==void 0?a:0),M=T+((h=(l=n.contentHeight)!==null&&l!==void 0?l:n.attribute.height)!==null&&h!==void 0?h:0);if(T<t||M>e){const R=Math.max(T,t),E=Math.min(M,e),P=_.globalTransMatrix.f-(E+R)/2+_.AABBBounds.height()/2;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(d=(u=n.firstChild)===null||u===void 0?void 0:u.attribute.dx)!==null&&d!==void 0?d:0,dy:(g=(c=n.firstChild)===null||c===void 0?void 0:c.attribute.dy)!==null&&g!==void 0?g:0}),n.forEachChildren((B=>{var k;B.setAttribute("dy",((k=B.attribute.dy)!==null&&k!==void 0?k:0)-P+2)}))}}else if(x<t){const T=x-t;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(p=(f=n.firstChild)===null||f===void 0?void 0:f.attribute.dx)!==null&&p!==void 0?p:0,dy:(v=(m=n.firstChild)===null||m===void 0?void 0:m.attribute.dy)!==null&&v!==void 0?v:0}),n.forEachChildren((M=>{var R;M.setAttribute("dy",((R=M.attribute.dy)!==null&&R!==void 0?R:0)-T+2)}))}else if(S>e){const T=S-e;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(y=(b=n.firstChild)===null||b===void 0?void 0:b.attribute.dx)!==null&&y!==void 0?y:0,dy:(w=(C=n.firstChild)===null||C===void 0?void 0:C.attribute.dy)!==null&&w!==void 0?w:0}),n.forEachChildren((M=>{var R;M.setAttribute("dy",((R=M.attribute.dy)!==null&&R!==void 0?R:0)-T)}))}}function vk(n,t,e,i,r,o){if(dt(n.mergeStartCol)&&dt(n.mergeStartRow)&&dt(n.mergeEndCol)&&dt(n.mergeEndRow)){const{colStart:s,colEnd:a,rowStart:l,rowEnd:h}=ka(n,o.scenegraph);for(let u=s;u<=a;u++)for(let d=l;d<=h;d++){const c=o.scenegraph.getCell(u,d);c.role==="cell"&&bk(c,t,e,i,r)}}else bk(n,t,e,i,r)}function bk(n,t,e,i,r){var o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_;const A=n.getChildByName("text",!0)||n.getChildByName("image",!0);if(!A)return;if(A.type==="image"){const{image:M}=A.attribute;if(!M||!A.resources||A.resources.get(M).state!=="success")return}const x=(s=(o=A.attribute.textAlign)!==null&&o!==void 0?o:A.textAlign)!==null&&s!==void 0?s:"left";A.AABBBounds.width();const S=A.globalAABBBounds.x1,T=A.globalAABBBounds.x2;if(x==="center"&&r){const M=n.globalAABBBounds.x1+((l=(a=n.firstChild)===null||a===void 0?void 0:a.attribute.dx)!==null&&l!==void 0?l:0),R=M+((u=(h=n.contentWidth)!==null&&h!==void 0?h:n.attribute.width)!==null&&u!==void 0?u:0);if(M<t||R>e){const E=Math.max(M,t),P=Math.min(R,e),B=A.globalTransMatrix.e-(P+E)/2;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(c=(d=n.firstChild)===null||d===void 0?void 0:d.attribute.dx)!==null&&c!==void 0?c:0,dy:(f=(g=n.firstChild)===null||g===void 0?void 0:g.attribute.dy)!==null&&f!==void 0?f:0}),n.forEachChildren((k=>{var L;k.setAttribute("dx",((L=k.attribute.dx)!==null&&L!==void 0?L:0)-B+2)}))}}else if(S<t){const M=S-t;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(m=(p=n.firstChild)===null||p===void 0?void 0:p.attribute.dx)!==null&&m!==void 0?m:0,dy:(b=(v=n.firstChild)===null||v===void 0?void 0:v.attribute.dy)!==null&&b!==void 0?b:0}),n.forEachChildren((R=>{var E;R.setAttribute("dx",((E=R.attribute.dx)!==null&&E!==void 0?E:0)-M+2)}))}else if(T>e){const M=T-e;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(C=(y=n.firstChild)===null||y===void 0?void 0:y.attribute.dx)!==null&&C!==void 0?C:0,dy:(_=(w=n.firstChild)===null||w===void 0?void 0:w.attribute.dy)!==null&&_!==void 0?_:0}),n.forEachChildren((R=>{var E;R.setAttribute("dx",((E=R.attribute.dx)!==null&&E!==void 0?E:0)-M)}))}}function pm(n){var t,e;const i=n.internalProps.layoutMap.headerObjects,r=n.internalProps.layoutMap.columnObjects;for(let o=0;o<i.length;o++){const s=i[o];if(s&&(!((t=s.style)===null||t===void 0)&&t.textStick))return!0}for(let o=0;o<r.length;o++){const s=r[o];if(s&&(!((e=s.style)===null||e===void 0)&&e.textStick))return!0}return!!(n.theme.headerStyle.textStick||n.theme.rowHeaderStyle.textStick||n.theme.bodyStyle.textStick)}var fr=function(n,t,e,i){return new(e||(e=Promise))((function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e((function(d){d(u)}))).then(s,a)}l((i=i.apply(n,t||[])).next())}))};class xlt{constructor(t){this.isRelease=!1,this.mode="column",this.rowLimit=200,this.currentRow=0,this.rowStart=0,this.rowEnd=0,this.referenceRow=0,this.screenTopRow=0,this.deltaY=0,this.deltaHeight=0,this.colLimit=100,this.screenLeftCol=0,this.deltaX=0,this.deltaWidth=0,this.cellCache=new Map,this.table=t,this.table.isPivotChart()?(this.rowLimit=Math.max(100,Math.ceil(2*t.tableNoFrameHeight/t.defaultRowHeight)),this.colLimit=Math.max(100,Math.ceil(2*t.tableNoFrameWidth/t.defaultColWidth))):this.table.isAutoRowHeight(t.columnHeaderLevelCount)?this.rowLimit=Math.max(100,Math.ceil(2*t.tableNoFrameHeight/t.defaultRowHeight)):(this.table.widthMode==="autoWidth"||(this.rowLimit=Math.max(200,Math.ceil(2*t.tableNoFrameHeight/t.defaultRowHeight))),this.colLimit=Math.max(100,Math.ceil(2*t.tableNoFrameWidth/t.defaultColWidth))),this.table.internalProps.transpose?this.mode="row":this.table.isPivotTable()&&(this.mode="pivot"),this.table.options.maintainedDataCount&&(this.rowLimit=this.table.options.maintainedDataCount),this.table.options.maintainedColumnCount&&(this.colLimit=this.table.options.maintainedColumnCount),this.table.heightMode==="adaptive"&&(this.rowLimit=this.table.rowCount),this.table.widthMode==="adaptive"&&(this.colLimit=this.table.colCount)}get bodyLeftCol(){return this.table.frozenColCount}get bodyTopRow(){return this.table.frozenRowCount}setParamsForColumn(){this.bodyRightCol=this.table.colCount-1-this.table.rightFrozenColCount;const t=Math.min(this.colLimit,this.bodyRightCol-this.bodyLeftCol+1);this.totalActualBodyColCount=t,this.totalCol=this.bodyLeftCol+t-1,this.colStart=this.bodyLeftCol,this.colEnd=this.totalCol;const e=this.table.defaultColWidth;this.taskColCount=1*Math.ceil(this.table.tableNoFrameWidth/e);const i=e*t,r=e*(this.bodyRightCol-this.bodyLeftCol+1);this.xLimitLeft=i/2,this.xLimitRight=r-i/2;const o=5*this.table.tableNoFrameWidth;this.screenColCount=Math.ceil(this.table.tableNoFrameWidth/e),this.firstScreenColLimit=Math.max(15,this.bodyLeftCol+Math.min(this.colLimit,Math.ceil(o/e))),this.colUpdatePos=this.bodyRightCol}setParamsForRow(){this.bodyBottomRow=this.table.rowCount-1-this.table.bottomFrozenRowCount;const t=Math.min(this.rowLimit,this.bodyBottomRow-this.bodyTopRow+1);this.totalActualBodyRowCount=t,this.totalRow=this.bodyTopRow+t-1,this.rowStart=this.bodyTopRow,this.rowEnd=this.totalRow;const e=this.table.defaultRowHeight;this.taskRowCount=1*Math.ceil(this.table.tableNoFrameHeight/e);const i=e*t,r=e*(this.bodyBottomRow-this.bodyTopRow+1);this.yLimitTop=i/2,this.yLimitBottom=r-i/2;const o=5*this.table.tableNoFrameHeight;this.screenRowCount=Math.ceil(this.table.tableNoFrameHeight/e),this.firstScreenRowLimit=Math.max(30,this.bodyTopRow+Math.min(this.rowLimit,Math.ceil(o/e))),this.rowUpdatePos=this.bodyBottomRow}refreshRowCount(){this.bodyBottomRow=this.table.rowCount-1-this.table.bottomFrozenRowCount;const t=Math.min(this.rowLimit,this.bodyBottomRow-this.bodyTopRow+1);this.totalActualBodyRowCount=t,this.totalRow=this.rowStart+t-1}refreshColCount(){this.bodyRightCol=this.table.colCount-1-this.table.rightFrozenColCount;const t=Math.min(this.colLimit,this.bodyRightCol-this.bodyLeftCol+1);this.totalActualBodyColCount=t,this.totalCol=this.bodyLeftCol+t-1,this.colStart=this.bodyLeftCol,this.colEnd=this.totalCol}resize(){const t=this.table.defaultColWidth;this.taskColCount=1*Math.ceil(this.table.tableNoFrameWidth/t);const e=5*this.table.tableNoFrameWidth;this.screenColCount=Math.ceil(this.table.tableNoFrameWidth/t),this.firstScreenColLimit=this.bodyLeftCol+Math.min(this.colLimit,Math.ceil(e/t));const i=this.table.defaultRowHeight;this.taskRowCount=1*Math.ceil(this.table.tableNoFrameHeight/i);const r=5*this.table.tableNoFrameHeight;this.screenRowCount=Math.ceil(this.table.tableNoFrameHeight/i),this.firstScreenRowLimit=this.bodyTopRow+Math.min(this.rowLimit,Math.ceil(r/i))}createGroupForFirstScreen(t,e,i,r,o,s,a,l){alt(t,e,i,r,o,s,a,l,this)}progress(){return fr(this,void 0,void 0,(function*(){if(!this.isProgressing)return this.isProgressing=!0,new Promise(((t,e)=>{setTimeout((()=>fr(this,void 0,void 0,(function*(){this.isProgressing=!1,this.isRelease||(this.colUpdatePos<=this.colEnd?(yield this.updateColCellGroupsAsync(),yield this.progress()):this.rowUpdatePos<=this.rowEnd?(yield this.updateRowCellGroupsAsync(),yield this.progress()):this.currentCol<this.totalCol?(yield this.createCol(),yield this.progress()):this.currentRow<this.totalRow&&(yield this.createRow(),yield this.progress()),tc(this.table),this.table.scenegraph.updateNextFrame(),t())}))),16)}))}))}createRow(){return fr(this,void 0,void 0,(function*(){this.taskRowCount&&this.createRowCellGroup(this.taskRowCount)}))}createCol(){return fr(this,void 0,void 0,(function*(){this.taskColCount&&this.createColGroup(this.taskRowCount)}))}createRowCellGroup(t){const e=Math.min(this.totalRow,this.currentRow+t);if(this.table.heightMode!=="adaptive"&&Lr(this.table,this.currentRow+1,e,!1),this.rowEnd=e,this.table.frozenColCount){let r=0;for(let o=0;o<this.table.frozenColCount;o++){const s=this.table.scenegraph.getColGroup(o),{height:a}=(this.table.isListTable(),Kf(s,o,s.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table));r=Math.max(r,a),this.table.scenegraph.rowHeaderGroup.setAttribute("height",r)}}if(this.table.rightFrozenColCount){let r=0;for(let o=this.table.colCount-this.table.rightFrozenColCount;o<this.table.colCount;o++){const s=this.table.scenegraph.getColGroup(o),{height:a}=(this.table.isPivotChart(),Kf(s,o,s.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table));r=Math.max(r,a),this.table.scenegraph.rightFrozenGroup.setAttribute("height",r)}}let i=0;for(let r=this.bodyLeftCol;r<=this.bodyRightCol;r++){const o=this.table.scenegraph.getColGroup(r);if(!o)continue;this.table.rowHeaderLevelCount;const{height:s}=Kf(o,r,o.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table);i=Math.max(i,s)}this.table.scenegraph.bodyGroup.setAttribute("height",i),this.currentRow=e,this.rowUpdatePos=this.rowEnd,this.table.scenegraph.updateContainer(),this.table.scenegraph.updateBorderSizeAndPosition()}createColGroup(t){const e=Math.min(this.totalCol,this.currentCol+t);this.table.widthMode!=="adaptive"&&Or(this.table,this.currentCol+1,e),this.colEnd=e;for(let s=0;s<this.table.rowCount;s++){const a=this.highPerformanceGetCell(this.currentCol,s);a.role==="cell"&&dt(a.mergeStartCol)&&a.mergeStartCol>this.currentCol&&this.table.scenegraph.updateCellContent(a.col,a.row)}if(this.table.frozenRowCount){const s=this.table.scenegraph.colHeaderGroup.lastChild instanceof Vt?this.table.scenegraph.colHeaderGroup.lastChild:this.table.scenegraph.colHeaderGroup.lastChild._prev,a=s.attribute.x+s.attribute.width,l=s.attribute.y;di(this.table.scenegraph.colHeaderGroup,a,l,this.currentCol+1,e,0,this.table.frozenRowCount-1,"columnHeader",this.table)}if(this.table.bottomFrozenRowCount){const s=this.table.scenegraph.bottomFrozenGroup.lastChild instanceof Vt?this.table.scenegraph.bottomFrozenGroup.lastChild:this.table.scenegraph.bottomFrozenGroup.lastChild._prev,a=s.attribute.x+s.attribute.width,l=s.attribute.y;di(this.table.scenegraph.bottomFrozenGroup,a,l,this.currentCol+1,e,this.table.rowCount-this.table.bottomFrozenRowCount,this.table.rowCount-1,"columnHeader",this.table)}let i=this.table.scenegraph.bodyGroup.lastChild&&(this.table.scenegraph.bodyGroup.lastChild instanceof Vt?this.table.scenegraph.bodyGroup.lastChild:this.table.scenegraph.bodyGroup.lastChild._prev);i||(i=this.table.scenegraph.colHeaderGroup.lastChild&&(this.table.scenegraph.colHeaderGroup.lastChild instanceof Vt?this.table.scenegraph.colHeaderGroup.lastChild:this.table.scenegraph.colHeaderGroup.lastChild._prev));const r=i.attribute.x+i.attribute.width,o=i.attribute.y;di(this.table.scenegraph.bodyGroup,r,o,this.currentCol+1,e,this.rowStart,this.rowEnd,"body",this.table),this.currentCol=e,this.colUpdatePos=this.colEnd,this.table.scenegraph.updateContainer(),this.table.scenegraph.updateBorderSizeAndPosition()}setY(t,e=!1){return fr(this,void 0,void 0,(function*(){const i=this.table.getRowsHeight(this.bodyTopRow,this.bodyTopRow+(this.rowEnd-this.rowStart+1))/2,r=this.table.getAllRowsHeight()-i,o=this.table.getTargetRowAt(t+this.table.scenegraph.colHeaderGroup.attribute.height);o&&(this.screenTopRow=o.row),t<i&&this.rowStart===this.bodyTopRow||t>r&&this.rowEnd===this.bodyBottomRow?(this.updateDeltaY(t),this.updateBody(t-this.deltaY)):this.table.scenegraph.bodyGroup.firstChild&&this.table.scenegraph.bodyGroup.firstChild.type==="group"&&this.table.scenegraph.bodyGroup.firstChild.childrenCount!==0||this.table.scenegraph.rowHeaderGroup.firstChild&&this.table.scenegraph.rowHeaderGroup.firstChild.type==="group"&&this.table.scenegraph.rowHeaderGroup.firstChild.childrenCount!==0?this.dynamicSetY(t,o,e):(this.updateDeltaY(t),this.updateBody(t-this.deltaY))}))}setX(t,e=!1){return fr(this,void 0,void 0,(function*(){const i=this.table.getColsWidth(this.bodyLeftCol,this.bodyLeftCol+(this.colEnd-this.colStart+1))/2,r=this.table.getAllColsWidth()-i,o=this.table.getTargetColAt(t+this.table.scenegraph.rowHeaderGroup.attribute.width);o&&(this.screenLeftCol=o.col),t<i&&this.colStart===this.bodyLeftCol||t>r&&this.colEnd===this.bodyRightCol||this.table.scenegraph.bodyGroup.firstChild&&this.table.scenegraph.bodyGroup.firstChild.type==="group"&&this.table.scenegraph.bodyGroup.firstChild.childrenCount===0?(this.updateDeltaX(t),this.table.scenegraph.setBodyAndColHeaderX(-t+this.deltaX)):this.dynamicSetX(t,o,e)}))}dynamicSetY(t,e,i=!1){return fr(this,void 0,void 0,(function*(){plt(t,e,i,this)}))}dynamicSetX(t,e,i=!1){return fr(this,void 0,void 0,(function*(){ult(t,e,i,this)}))}updateBody(t){this.table.scenegraph.setBodyAndRowHeaderY(-t)}updateRowCellGroupsAsync(){return fr(this,void 0,void 0,(function*(){this.updateCellGroups(this.taskRowCount)}))}updateCellGroups(t){const e=Math.min(this.bodyBottomRow,this.rowUpdatePos+t);this.table.isAutoRowHeight(this.rowUpdatePos)&&Lr(this.table,this.rowUpdatePos,e,!1),Yc(this.rowUpdatePos,e,this),this.table.isAutoRowHeight(this.rowUpdatePos)&&(ir(this.bodyLeftCol,this.bodyRightCol,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0),ir(0,this.table.frozenColCount-1,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0),ir(this.table.colCount-this.table.rightFrozenColCount,this.table.colCount-1,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0)),this.rowUpdatePos=e+1}updateBottomFrozenCellGroups(){const t=this.table.rowCount-this.table.bottomFrozenRowCount,e=this.table.rowCount-1;this.table.isAutoRowHeight(t)&&Lr(this.table,t,e,!1),Yc(t,e,this),this.table.isAutoRowHeight(t)&&(ir(this.bodyLeftCol,this.bodyRightCol,t,e,this.table,this.rowUpdateDirection),ir(0,this.table.frozenColCount-1,t,e,this.table,this.rowUpdateDirection),ir(this.table.colCount-this.table.rightFrozenColCount,this.table.colCount-1,t,e,this.table,this.rowUpdateDirection))}updateRightFrozenCellGroups(){const t=this.table.colCount-this.table.rightFrozenColCount,e=this.table.colCount-1;this.table.widthMode==="autoWidth"&&Or(this.table,t,e,!1),Xc(t,e,this),this.table.isAutoRowHeight(this.rowStart)&&l1(t,e,this.table,this.colUpdateDirection)}updateColCellGroupsAsync(){return fr(this,void 0,void 0,(function*(){this.updateColGroups(this.taskRowCount)}))}updateColGroups(t){const e=Math.min(this.bodyRightCol,this.colUpdatePos+t);this.table.widthMode==="autoWidth"&&Or(this.table,this.colUpdatePos,e),Xc(this.colUpdatePos,e,this),this.colUpdatePos=e+1}updateCellGroupPosition(t,e,i){t.row=e,t.mergeStartCol=void 0,t.mergeStartRow=void 0,t.mergeEndCol=void 0,t.mergeEndRow=void 0,t.setAttribute("y",i),t.needUpdate=!0,t.needUpdateForAutoRowHeight=!0}updateCellGroupContent(t){if(!t.needUpdate||t.role!=="cell")return t;const e=this.table.scenegraph.updateCellContent(t.col,t.row);return t.needUpdate=!1,e||t}sortCellVertical(){return fr(this,void 0,void 0,(function*(){yield Clt(this)}))}sortCellHorizontal(){return fr(this,void 0,void 0,(function*(){yield wlt(this)}))}highPerformanceGetCell(t,e,i){if(e>=this.table.frozenRowCount&&e<this.table.rowCount-this.table.bottomFrozenRowCount&&(e<this.rowStart||e>this.rowEnd)||t>=this.table.frozenColCount&&t<this.table.colCount-this.table.rightFrozenColCount&&(t<this.colStart||t>this.colEnd))return fm;if(this.cellCache.get(t)){const o=this.cellCache.get(t);if((o._next||o._prev)&&Math.abs(o.row-e)<e){let a=h1(o,e);return a&&(i||a.role!=="shadow-cell")||(a=this.table.scenegraph.getCell(t,e,i)),a.row&&this.cellCache.set(t,a),a}const s=this.table.scenegraph.getCell(t,e,i);return s.col===t&&s.row&&this.cellCache.set(t,s),s}const r=this.table.scenegraph.getCell(t,e,i);return r.col===t&&r.row&&this.cellCache.set(t,r),r}updateDeltaY(t,e,i){if(this.rowStart===this.bodyTopRow){const r=this.table.scenegraph.highPerformanceGetCell(this.colStart,this.rowStart,!0);if(r.role==="cell"){const o=r.attribute.y;this.deltaY=-o}}else if(this.rowEnd===this.bodyBottomRow){const r=this.table.scenegraph.highPerformanceGetCell(this.colStart,this.rowEnd,!0);if(r.role==="cell"){const o=r.attribute.y+r.attribute.height-(this.table.getAllRowsHeight()-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight());this.deltaY=-o}}else if($(e)&&$(i)){let r=this.table.scenegraph.highPerformanceGetCell(this.colStart,i,!0);r.role!=="cell"&&(r=this.table.scenegraph.highPerformanceGetCell(0,i,!0));const o=t-this.deltaY,s=e-o,a=r.attribute.y-o+this.table.getFrozenRowsHeight();this.deltaY=s-a}}updateDeltaX(t,e,i){if(this.colStart===this.bodyLeftCol){const r=this.table.scenegraph.getColGroup(this.colStart);if(r){const o=r.attribute.x;this.deltaX=-o}}else if(this.colEnd===this.bodyRightCol){const r=this.table.scenegraph.getColGroup(this.colEnd);if(r){const o=r.attribute.x+r.attribute.width-(this.table.getAllColsWidth()-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth());this.deltaX=-o}}else if($(e)&&$(i)){const r=this.table.scenegraph.getColGroup(i)||this.table.scenegraph.getColGroup(i,!0),o=t-this.deltaX,s=e-o,a=r.attribute.x-o+this.table.getFrozenColsWidth();this.deltaX=s-a}}release(){this.isRelease=!0}}function h1(n,t){if(!n)return null;if(n.row===t)return n;const e=n._prev,i=n._next;return n.row>t&&e&&e.row===n.row-1?h1(e,t):n.row<t&&i&&i.row===n.row+1?h1(i,t):null}function Slt(n,t,e,i,r,o){const s=o.scenegraph;for(let a=n;a<=t;a++){const l=o.getColWidth(a),h=o.scenegraph.getColGroup(a,!0),u=o.scenegraph.getColGroup(a),d=o.scenegraph.getColGroupInBottom(a),c=o.scenegraph.getColGroupInLeftBottomCorner(a),g=o.scenegraph.getColGroupInRightBottomCorner(a);h&&(h.setAttribute("width",l),h.forEachChildren((f=>{f.setAttribute("width",l)}))),u&&(u.setAttribute("width",l),u.forEachChildren((f=>{f.setAttribute("width",l)}))),d&&(d.setAttribute("width",l),d.forEachChildren((f=>{f.setAttribute("width",l)}))),g&&(g.setAttribute("width",l),g.forEachChildren((f=>{f.setAttribute("width",l)}))),c&&(c.setAttribute("width",l),c.forEachChildren((f=>{f.setAttribute("width",l)})))}if(s.updateContainer(),r==="column")for(let a=n;a<=t;a++){const l=o.scenegraph.getColGroup(a);l?.setAttribute("chartInstance",void 0);for(let h=0;h<=o.frozenRowCount-1;h++)s.updateCellContent(a,h);for(let h=s.bodyRowStart;h<=s.bodyRowEnd;h++)s.updateCellContent(a,h);for(let h=o.rowCount-o.bottomFrozenRowCount;h<=o.rowCount-1;h++)s.updateCellContent(a,h)}else{for(let a=0;a<=o.frozenColCount-1;a++){const l=o.scenegraph.getColGroup(a);l?.setAttribute("chartInstance",void 0);for(let h=e;h<=i;h++)s.updateCellContent(a,h)}for(let a=s.bodyColStart;a<=s.bodyColEnd;a++){const l=o.scenegraph.getColGroup(a);l?.setAttribute("chartInstance",void 0);for(let h=e;h<=i;h++)s.updateCellContent(a,h)}for(let a=o.colCount-o.rightFrozenColCount;a<=o.colCount-1;a++){const l=o.scenegraph.getColGroup(a);l?.setAttribute("chartInstance",void 0);for(let h=e;h<=i;h++)s.updateCellContent(a,h)}}}function dF(n){n.customSelectedRangeComponents.forEach(((t,e)=>{kC(t,e,n)})),n.selectingRangeComponents.forEach(((t,e)=>{kC(t,e,n)})),n.selectedRangeComponents.forEach(((t,e)=>{kC(t,e,n)}))}function kC(n,t,e){var i,r,o,s,a,l,h,u,d,c;const g=e.table,[f,p,m,v]=t.split("-"),b=parseInt(f,10),y=parseInt(p,10),C=parseInt(m,10),w=parseInt(v,10);let _,A=b,x=y,S=C,T=w;switch(n.role){case"rowHeader":_=g.getBodyVisibleRowRange(),_&&(x=Math.max(y,_.rowStart-1),T=Math.min(w,_.rowEnd+1));break;case"columnHeader":case"bottomFrozen":_=g.getBodyVisibleCellRange(),_&&(A=Math.max(b,_.colStart-1),S=Math.min(C,_.colEnd+1));break;case"cornerHeader":case"rightTopCorner":case"leftBottomCorner":case"rightBottomCorner":break;case"rightFrozen":_=g.getBodyVisibleCellRange(),_&&(x=Math.max(y,_.rowStart-1),T=Math.min(w,_.rowEnd+1));break;default:_=g.getBodyVisibleCellRange(),_&&(x=Math.max(y,_.rowStart-1),T=Math.min(w,_.rowEnd+1),A=Math.max(b,_.colStart-1),S=Math.min(C,_.colEnd+1))}const M=g.getColsWidth(A,S),R=g.getRowsHeight(x,T),E=e.highPerformanceGetCell(A,x).globalAABBBounds;if(n.rect.setAttributes({x:E.x1-e.tableGroup.attribute.x,y:E.y1-e.tableGroup.attribute.y,width:M,height:R,visible:!0}),n.fillhandle){const H=(i=e.table.options.excelOptions)===null||i===void 0?void 0:i.fillHandle;let D,z,G=!0;typeof H=="function"&&(G=H({selectRanges:e.table.stateManager.select.ranges,table:e.table})),C<g.colCount-1?(D=e.highPerformanceGetCell(C,w).globalAABBBounds,z=D.x2-e.tableGroup.attribute.x-3):b===0?(D=e.highPerformanceGetCell(0,w).globalAABBBounds,z=D.x1-e.tableGroup.attribute.x):(D=e.highPerformanceGetCell(b-1,w).globalAABBBounds,z=D.x2-e.tableGroup.attribute.x-3),D=w<g.rowCount-1?e.highPerformanceGetCell(C,w).globalAABBBounds:e.highPerformanceGetCell(C,y-1).globalAABBBounds;const U=D.y2-e.tableGroup.attribute.y-3;(r=n.fillhandle)===null||r===void 0||r.setAttributes({x:z,y:U,width:6,height:6,visible:G})}let P=!!g.frozenColCount&&b===g.frozenColCount;!P&&g.frozenColCount&&g.scrollLeft>0&&b>=g.frozenColCount&&g.getColsWidth(0,b-1)-g.scrollLeft<g.getFrozenColsWidth()&&(P=!0);let B=!!g.rightFrozenColCount&&g.rightFrozenColCount>0&&C===g.colCount-g.rightFrozenColCount-1;!B&&g.rightFrozenColCount&&C<g.colCount-g.rightFrozenColCount&&g.getColsWidth(0,C)-g.scrollLeft>g.tableNoFrameWidth-g.getRightFrozenColsWidth()&&(B=!0);let k=!g.frozenRowCount||y===g.frozenRowCount;!k&&g.frozenRowCount&&g.scrollTop>0&&y>=g.frozenRowCount&&g.getRowsHeight(0,y-1)-g.scrollTop<g.getFrozenRowsHeight()&&(k=!0);let L=!!g.bottomFrozenRowCount&&w===g.rowCount-g.bottomFrozenRowCount-1;!L&&g.bottomFrozenRowCount&&w<g.rowCount-g.bottomFrozenRowCount&&g.getRowsHeight(0,w)-g.scrollTop>g.tableNoFrameHeight-g.getBottomFrozenRowsHeight()&&(L=!0);const{dynamicUpdateSelectionSize:O}=g.theme.selectionStyle;if(P&&(n.rect.attribute.stroke[3]||O)||B&&(n.rect.attribute.stroke[1]||O)||k&&(n.rect.attribute.stroke[0]||O)||L&&(n.rect.attribute.stroke[2]||O)){if(P&&n.rect.attribute.stroke[3]&&e.tableGroup.insertAfter(n.rect,n.role==="columnHeader"?e.cornerHeaderGroup:n.role==="bottomFrozen"?e.leftBottomCornerGroup:e.rowHeaderGroup),L&&n.rect.attribute.stroke[2]&&e.tableGroup.insertAfter(n.rect,n.role==="rowHeader"?e.leftBottomCornerGroup:n.role==="rightFrozen"?e.rightBottomCornerGroup:e.bottomFrozenGroup),k&&n.rect.attribute.stroke[0]&&e.tableGroup.insertAfter(n.rect,n.role==="rowHeader"?e.cornerHeaderGroup:n.role==="rightFrozen"?e.rightTopCornerGroup:e.colHeaderGroup),B&&n.rect.attribute.stroke[1]&&e.tableGroup.insertAfter(n.rect,n.role==="columnHeader"?e.rightTopCornerGroup:n.role==="bottomFrozen"?e.rightBottomCornerGroup:e.rightFrozenGroup),n.rect.attribute.x<g.getFrozenColsWidth()&&g.scrollLeft>0&&(n.role==="body"||n.role==="columnHeader"||n.role==="bottomFrozen")){const H=n.rect.attribute.width-(g.getFrozenColsWidth()-n.rect.attribute.x);n.rect.setAttributes({x:n.rect.attribute.x+(g.getFrozenColsWidth()-n.rect.attribute.x),width:H>0?H:0}),(o=n.fillhandle)===null||o===void 0||o.setAttributes({visible:H>0})}if(g.getRightFrozenColsWidth()>0&&e.rightFrozenGroup.attribute.height>0&&n.rect.attribute.x+n.rect.attribute.width>e.rightFrozenGroup.attribute.x&&(n.role==="body"||n.role==="columnHeader"||n.role==="bottomFrozen")){const H=e.rightFrozenGroup.attribute.x-n.rect.attribute.x;n.rect.setAttributes({x:n.rect.attribute.x,width:H>0?H:0}),(s=n.fillhandle)===null||s===void 0||s.setAttributes({visible:H-M>0})}if(n.rect.attribute.y<e.colHeaderGroup.attribute.height&&g.scrollTop>0&&(n.role==="body"||n.role==="rowHeader"||n.role==="rightFrozen")){const H=n.rect.attribute.height-(e.colHeaderGroup.attribute.height-n.rect.attribute.y);n.rect.setAttributes({y:n.rect.attribute.y+(e.colHeaderGroup.attribute.height-n.rect.attribute.y),height:H>0?H:0}),(a=n.fillhandle)===null||a===void 0||a.setAttributes({visible:H>0})}if(e.bottomFrozenGroup.attribute.width>0&&e.bottomFrozenGroup.attribute.height>0&&n.rect.attribute.y+n.rect.attribute.height>e.bottomFrozenGroup.attribute.y&&(n.role==="body"||n.role==="rowHeader"||n.role==="rightFrozen")){const H=e.bottomFrozenGroup.attribute.y-n.rect.attribute.y;n.rect.setAttributes({y:n.rect.attribute.y,height:H>0?H:0}),(l=n.fillhandle)===null||l===void 0||l.setAttributes({visible:H-R>0})}}else e.tableGroup.insertAfter(n.rect,n.role==="body"?e.bodyGroup:n.role==="columnHeader"?e.colHeaderGroup:n.role==="rowHeader"?e.rowHeaderGroup:n.role==="cornerHeader"?e.cornerHeaderGroup:n.role==="rightTopCorner"?e.rightTopCornerGroup:n.role==="rightFrozen"?e.rightFrozenGroup:n.role==="leftBottomCorner"?e.leftBottomCornerGroup:n.role==="bottomFrozen"?e.bottomFrozenGroup:e.rightBottomCornerGroup);let I=0;typeof n.rect.attribute.lineWidth=="number"&&(I=Math.ceil(n.rect.attribute.lineWidth/2)),C===g.colCount-1&&(Array.isArray(n.rect.attribute.lineWidth)&&(I=Math.ceil(((h=n.rect.attribute.lineWidth[1])!==null&&h!==void 0?h:0)/2)),n.rect.setAttributes({width:n.rect.attribute.width-I})),b===0&&(Array.isArray(n.rect.attribute.lineWidth)&&(I=Math.ceil(((u=n.rect.attribute.lineWidth[3])!==null&&u!==void 0?u:0)/2)),n.rect.setAttributes({x:n.rect.attribute.x+I,width:n.rect.attribute.width-I})),w===g.rowCount-1&&(Array.isArray(n.rect.attribute.lineWidth)&&(I=Math.ceil(((d=n.rect.attribute.lineWidth[2])!==null&&d!==void 0?d:0)/2)),n.rect.setAttributes({height:n.rect.attribute.height-I})),y===0&&(Array.isArray(n.rect.attribute.lineWidth)&&(I=Math.ceil(((c=n.rect.attribute.lineWidth[0])!==null&&c!==void 0?c:0)/2)),n.rect.setAttributes({y:n.rect.attribute.y+I,height:n.rect.attribute.height-I}))}function yk(n,t,e=!0){const i=n.table,r=t.start.col,o=t.start.row,s=t.end.col,a=t.end.row,l=t.skipBodyMerge;let h=Math.max(Math.min(s,r),0),u=Math.max(Math.min(a,o),0),d=Math.min(Math.max(s,r),i.colCount-1),c=Math.min(Math.max(a,o),i.rowCount-1);const g=()=>{let A=!1;for(let x=h;x<=d;x++){if(x===h)for(let S=u;S<=c;S++){if(!i.isHeader(x,S)&&l)continue;const T=mi(i,x,S);if(T&&T.start.col<h){h=T.start.col,A=!0;break}}if(!A&&x===d)for(let S=u;S<=c;S++){if(!i.isHeader(x,S)&&l)continue;const T=mi(i,x,S);if(T&&Math.min(T.end.col,i.colCount-1)>d){d=T.end.col,A=!0;break}}if(A)break}if(!A)for(let x=u;x<=c;x++){if(x===u)for(let S=h;S<=d;S++){if(!i.isHeader(S,x)&&l)continue;const T=mi(i,S,x);if(T&&T.start.row<u){u=T.start.row,A=!0;break}}if(!A&&x===c)for(let S=h;S<=d;S++){if(!i.isHeader(S,x)&&l)continue;const T=mi(i,S,x);if(T&&Math.min(T.end.row,i.rowCount-1)>c){c=T.end.row,A=!0;break}}if(A)break}A&&g()};e&&(g(),t.start.col>t.end.col?(t.start.col=Math.max(h,d),t.end.col=Math.min(h,d)):(t.start.col=Math.min(h,d),t.end.col=Math.max(h,d)),t.start.row>t.end.row?(t.start.row=Math.max(u,c),t.end.row=Math.min(u,c)):(t.start.row=Math.min(u,c),t.end.row=Math.max(u,c))),n.selectingRangeComponents.forEach(((A,x)=>{var S;A.rect.delete(),(S=A.fillhandle)===null||S===void 0||S.delete()})),n.selectingRangeComponents=new Map;const{needRowHeader:f,needRightRowHeader:p,needColumnHeader:m,needBottomColumnHeader:v,needBody:b,needCornerHeader:y,needRightTopCornerHeader:C,needLeftBottomCornerHeader:w,needRightBottomCornerHeader:_}=YD(h,u,d,c,i);if(y){const A=Math.min(d,i.frozenColCount-1),x=Math.min(c,i.frozenRowCount-1),S=[!0,!m,!f,!0];n.createCellSelectBorder(h,u,A,x,"cornerHeader",`${h}${u}${d}${c}`,S)}if(C){const A=Math.max(h,i.colCount-i.rightFrozenColCount),x=Math.min(c,i.frozenRowCount-1),S=[!0,!0,!p,!m];n.createCellSelectBorder(A,u,d,x,"rightTopCorner",`${h}${u}${d}${c}`,S)}if(w){const A=Math.min(d,i.frozenColCount-1),x=Math.max(u,i.rowCount-i.bottomFrozenRowCount),S=[!f,!v,!0,!0];n.createCellSelectBorder(h,x,A,c,"leftBottomCorner",`${h}${u}${d}${c}`,S)}if(_){const A=Math.max(h,i.colCount-i.rightFrozenColCount),x=Math.max(u,i.rowCount-i.bottomFrozenRowCount),S=[!p,!0,!0,!v];n.createCellSelectBorder(A,x,d,c,"rightBottomCorner",`${h}${u}${d}${c}`,S)}if(m){const A=Math.max(h,i.frozenColCount),x=Math.min(d,i.colCount-i.rightFrozenColCount-1),S=Math.min(c,i.frozenRowCount-1),T=[!0,!C,!b,!y];n.createCellSelectBorder(A,u,x,S,"columnHeader",`${h}${u}${d}${c}`,T)}if(v){const A=Math.max(h,i.frozenColCount),x=Math.min(d,i.colCount-i.rightFrozenColCount-1),S=Math.max(u,i.rowCount-i.bottomFrozenRowCount),T=[!b,!_,!0,!w];n.createCellSelectBorder(A,S,x,c,"bottomFrozen",`${h}${u}${d}${c}`,T)}if(f){const A=Math.max(u,i.frozenRowCount),x=Math.min(c,i.rowCount-i.bottomFrozenRowCount-1),S=Math.min(d,i.frozenColCount-1),T=[!y,!b,!w,!0];n.createCellSelectBorder(h,A,S,x,"rowHeader",`${h}${u}${d}${c}`,T)}if(p){const A=Math.max(u,i.frozenRowCount),x=Math.min(c,i.rowCount-i.bottomFrozenRowCount-1),S=Math.max(h,i.colCount-i.rightFrozenColCount),T=[!C,!0,!_,!b];n.createCellSelectBorder(S,A,d,x,"rightFrozen",`${h}${u}${d}${c}`,T)}if(b){const A=Math.max(h,i.frozenColCount),x=Math.max(u,i.frozenRowCount),S=Math.min(d,i.colCount-i.rightFrozenColCount-1),T=Math.min(c,i.rowCount-i.bottomFrozenRowCount-1),M=[!m,!p,!v,!f];n.createCellSelectBorder(A,x,S,T,"body",`${h}${u}${d}${c}`,M)}}function Ck(n){n.selectingRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",0)})),n.selectedRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",0)}))}function _k(n){n.selectingRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",1)})),n.selectedRangeComponents.forEach(((t,e)=>{t.rect.setAttribute("opacity",1)}))}function Alt(n,t,e,i,r,o,s,a){var l,h,u,d,c,g,f,p,m;let v=!!(!((l=n.table.options.excelOptions)===null||l===void 0)&&l.fillHandle);if(((h=n.table.stateManager.select.ranges)===null||h===void 0?void 0:h.length)>1)v=!1,n.removeFillHandleFromSelectComponents();else if(((u=n.table.stateManager.select.ranges)===null||u===void 0?void 0:u.length)===1){const E=Math.max(n.table.stateManager.select.ranges[0].start.row,n.table.stateManager.select.ranges[0].end.row),P=Math.max(n.table.stateManager.select.ranges[0].start.col,n.table.stateManager.select.ranges[0].end.col);n.table.isHeader(P,E)&&(v=!1)}!Array.isArray(a)||a[1]!==!1&&a[2]!==!1||(v=!1);const b=Math.min(t,i),y=Math.min(e,r),C=Math.max(t,i),w=Math.max(e,r),_=n.highPerformanceGetCell(b,y).globalAABBBounds,A=n.highPerformanceGetCell(C,w).globalAABBBounds,x=n.table.theme,S=(d=x.selectionStyle)===null||d===void 0?void 0:d.cellBorderColor,T=(c=x.selectionStyle)===null||c===void 0?void 0:c.cellBorderLineWidth,M=be({pickable:!1,fill:((g=x.selectionStyle)===null||g===void 0?void 0:g.selectionFillMode)!=="replace"&&((p=(f=x.selectionStyle)===null||f===void 0?void 0:f.cellBgColor)!==null&&p!==void 0?p:"rgba(0, 0, 255,0.1)"),lineWidth:T,stroke:a.map((E=>!!E&&S)),x:_.x1-n.tableGroup.attribute.x,y:_.y1-n.tableGroup.attribute.y,width:0,height:0,visible:!0,cornerRadius:cF(o,(m=n.table.theme.frameStyle)===null||m===void 0?void 0:m.cornerRadius,t,e,i,r,n.table)});let R;v&&(R=be({pickable:!1,fill:S,stroke:S,x:A.x2-3,y:A.y2-3,width:6,height:6,visible:!0})),n.lastSelectId=s,n.selectingRangeComponents.set(`${b}-${y}-${C}-${w}-${s}`,{rect:M,fillhandle:R,role:o}),n.tableGroup.insertAfter(M,o==="body"?n.bodyGroup:o==="columnHeader"?n.colHeaderGroup:o==="rowHeader"?n.rowHeaderGroup:o==="cornerHeader"?n.cornerHeaderGroup:o==="rightTopCorner"?n.rightTopCornerGroup:o==="rightFrozen"?n.rightFrozenGroup:o==="leftBottomCorner"?n.leftBottomCornerGroup:o==="bottomFrozen"?n.bottomFrozenGroup:n.rightBottomCornerGroup),v&&n.tableGroup.insertAfter(R,o==="body"?n.bodyGroup:o==="columnHeader"?n.colHeaderGroup:o==="rowHeader"?n.rowHeaderGroup:o==="cornerHeader"?n.cornerHeaderGroup:o==="rightTopCorner"?n.rightTopCornerGroup:o==="rightFrozen"?n.rightFrozenGroup:o==="leftBottomCorner"?n.leftBottomCornerGroup:o==="bottomFrozen"?n.bottomFrozenGroup:n.rightBottomCornerGroup)}function cF(n,t,e,i,r,o,s){if(!t)return;const a=Array.isArray(t)?t:[t,t,t,t],l=s.colCount-1,h=s.rowCount-1,u=[0,0,0,0];let d=!1;return e===0&&i===0?(u[0]=a[0],d=!0):r===l&&o===h?(u[2]=a[2],d=!0):e===0&&o===h?(u[3]=a[3],d=!0):r===l&&i===0&&(u[1]=a[1],d=!0),d?u:void 0}function wk(n){n.selectingRangeComponents.forEach(((t,e)=>{var i;n.selectedRangeComponents.get(e)&&(n.selectingRangeComponents.get(e).rect.delete(),(i=n.selectingRangeComponents.get(e).fillhandle)===null||i===void 0||i.delete()),n.selectedRangeComponents.set(e,t)})),n.selectingRangeComponents=new Map,n.updateNextFrame()}function Mlt(n){n.selectedRangeComponents.forEach(((t,e)=>{var i;e.split("-")[4]===n.lastSelectId&&(t.rect.delete(),(i=t.fillhandle)===null||i===void 0||i.delete(),n.selectedRangeComponents.delete(e))}))}function xk(n){n.selectedRangeComponents.forEach(((t,e)=>{var i;t.rect.delete(),(i=t.fillhandle)===null||i===void 0||i.delete()})),n.selectedRangeComponents=new Map}function gF(n){n.selectingRangeComponents.forEach(((t,e)=>{var i;t.rect.delete(),(i=t.fillhandle)===null||i===void 0||i.delete()})),n.selectingRangeComponents=new Map}function Tlt(n){n.selectedRangeComponents.forEach(((t,e)=>{var i;(i=t.fillhandle)===null||i===void 0||i.delete(),t.fillhandle=void 0}))}function Rlt(n,t,e,i,r){var o,s;pm(i)&&aS(i);const a=i.scenegraph,l=Xd(n.map((v=>v.row))).sort(((v,b)=>b-v)),h=Xd(t.map((v=>v.row))).sort(((v,b)=>v-b)),u=Xd(e.map((v=>v.row))).sort(((v,b)=>v-b));let d;if(u.length&&(d=EC(u[0]-1,u[u.length-1]+1,a)),h.length){const v=EC(h[0]-1,h[h.length-1]+1,a);d=$(d)?$(v)?Math.min(d,v):d:v}if(l.length){const v=EC(l[0]-1,l[l.length-1]+1,a);d=$(d)?$(v)?Math.min(d,v):d:v}l.forEach((v=>{Blt(v,a,r)}));const c=i.rowHeightsMap;if(l.forEach((v=>{c.delete(v)})),l.length){Plt(a);const v=PC(l[l.length-1]-1,l[0]-l.length+1,a);d=$(d)?$(v)?Math.min(d,v):d:v}let g;if(a.table._clearRowRangeHeightsMap(),h.forEach((v=>{const b=klt(v,a,r);g=g??b,c.insert(v)})),Elt(a),h.length){const v=PC(h[0]-1,h[h.length-1]+1,a);d=$(d)?$(v)?Math.min(d,v):d:v}const f=new Set;for(let v=0;v<i.colCount;v++)u.forEach((b=>{if(b<i.frozenRowCount){const y=mi(a.table,v,b);if(y)for(let C=y.start.col;C<=y.end.col;C++)for(let w=y.start.row;w<=y.end.row;w++){const _=`${C}-${w}`;f.has(_)||(Er(C,w,a.table,!1),f.add(_))}else Er(v,b,a.table,!1)}else if(b>i.rowCount-1||b<a.table.rowCount-a.table.bottomFrozenRowCount&&(b<a.proxy.rowStart||b>a.proxy.rowEnd))fF(b,a);else{const y=mi(a.table,v,b);if(y)for(let C=y.start.col;C<=y.end.col;C++)for(let w=y.start.row;w<=y.end.row;w++){const _=`${C}-${w}`;f.has(_)||(Er(C,w,a.table,!1),f.add(_))}else Er(v,b,a.table,!1)}}));if(u.length){const v=PC(u[0]-1,u[u.length-1]+1,a);d=$(d)?$(v)?Math.min(d,v):d:v}if(dt(g)){for(let v=0;v<Math.max(i.colCount,(o=i.internalProps._oldColCount)!==null&&o!==void 0?o:i.colCount);v++)for(let b=g;b<Math.max(i.rowCount,(s=i.internalProps._oldRowCount)!==null&&s!==void 0?s:i.rowCount);b++){const y=a.highPerformanceGetCell(v,b,!0);y&&(y.needUpdate=!0)}d=$(d)?$(g)?Math.min(d,g):d:g}if(dt(d)&&(a.proxy.rowUpdatePos=Math.min(a.proxy.rowUpdatePos,d)),h.length){if(!dt(g)){const v=Math.min(...h);a.proxy.rowUpdatePos=Math.min(v,a.proxy.rowUpdatePos)}a.proxy.rowUpdateDirection="up",a.proxy.updateCellGroups(2*a.proxy.screenRowCount),m()}else l.length&&(Llt(l[l.length-1],a),a.proxy.updateCellGroups(2*a.proxy.screenRowCount),m());a.proxy.progress();const p=i.getRowsHeight(i.frozenRowCount,i.rowCount-1-i.bottomFrozenRowCount);function m(){if(h?.[h?.length-1]>=i.rowCount-i.bottomFrozenRowCount||u?.[u?.length-1]>=i.rowCount-i.bottomFrozenRowCount||l?.[0]>=i.rowCount-i.bottomFrozenRowCount){for(let v=0;v<i.colCount;v++)for(let b=i.rowCount-i.bottomFrozenRowCount;b<i.rowCount;b++){const y=a.highPerformanceGetCell(v,b,!0);y&&(y.needUpdate=!0)}a.proxy.updateBottomFrozenCellGroups()}}a.updateContainerHeight(a.table.frozenRowCount,p-a.bodyGroup.attribute.height)}function Blt(n,t,e){const i=t.proxy;if(n>=i.rowStart&&n<=i.rowEnd&&(fF(n,t),i.rowEnd--,i.currentRow--),!e){i.bodyBottomRow--;const r=Math.min(i.rowLimit,i.bodyBottomRow-i.bodyTopRow+1);i.totalActualBodyRowCount=r,i.totalRow=Math.min(i.table.rowCount-1,i.rowStart+r-1)}}function klt(n,t,e){const i=t.proxy;if(!e){i.bodyBottomRow++;const r=Math.min(i.rowLimit,i.bodyBottomRow-i.bodyTopRow+1);i.totalActualBodyRowCount=r,i.totalRow=i.rowStart+r-1}if(!(n<i.rowStart))return n>i.rowEnd?i.rowEnd-i.rowStart+1<i.rowLimit?(i.rowEnd++,i.currentRow++,Sk(n,t),n):void 0:(i.rowEnd-i.rowStart+1<i.rowLimit&&(i.rowEnd++,i.currentRow++,Sk(n,t)),n)}function Plt(n){function t(e,i){e.row=i;const r=mi(n.table,e.col,e.row);r?(e.mergeStartCol=r.start.col,e.mergeEndCol=r.end.col,e.mergeStartRow=r.start.row,e.mergeEndRow=r.end.row):(e.mergeStartCol=void 0,e.mergeEndCol=void 0,e.mergeStartRow=void 0,e.mergeEndRow=void 0)}n.bodyGroup.forEachChildren((e=>{let i=n.bodyRowStart;e?.forEachChildren((r=>{t(r,i),i++}))})),n.rowHeaderGroup.forEachChildren((e=>{let i=n.bodyRowStart;e?.forEachChildren((r=>{t(r,i),i++}))})),n.rightFrozenGroup.forEachChildren((e=>{let i=n.bodyRowStart;e?.forEachChildren((r=>{t(r,i),i++}))})),n.bottomFrozenGroup.forEachChildren((e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount;e?.forEachChildren((r=>{t(r,i),i++}))})),n.leftBottomCornerGroup.forEachChildren((e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount;e?.forEachChildren((r=>{t(r,i),i++}))})),n.rightBottomCornerGroup.forEachChildren((e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount;e?.forEachChildren((r=>{t(r,i),i++}))}))}function Elt(n){function t(e,i,r){e.row=i,e.setAttribute("y",r);const o=mi(n.table,e.col,e.row);o?(e.mergeStartCol=o.start.col,e.mergeEndCol=o.end.col,e.mergeStartRow=o.start.row,e.mergeEndRow=o.end.row):(e.mergeStartCol=void 0,e.mergeEndCol=void 0,e.mergeStartRow=void 0,e.mergeEndRow=void 0)}n.bodyGroup.forEachChildren((e=>{let i=n.bodyRowStart,r=n.getCellGroupY(i);e?.forEachChildren((o=>{t(o,i,r),i++,r+=o.attribute.height}))})),n.rowHeaderGroup.forEachChildren((e=>{let i=n.bodyRowStart,r=n.getCellGroupY(i);e?.forEachChildren((o=>{t(o,i,r),i++,r+=o.attribute.height}))})),n.rightFrozenGroup.forEachChildren((e=>{let i=n.bodyRowStart,r=n.getCellGroupY(i);e?.forEachChildren((o=>{t(o,i,r),i++,r+=o.attribute.height}))})),n.bottomFrozenGroup.forEachChildren((e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount,r=0;e?.forEachChildren((o=>{t(o,i,r),i++,r+=o.attribute.height}))})),n.leftBottomCornerGroup.forEachChildren((e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount,r=0;e?.forEachChildren((o=>{t(o,i,r),i++,r+=o.attribute.height}))})),n.rightBottomCornerGroup.forEachChildren((e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount,r=0;e?.forEachChildren((o=>{t(o,i,r),i++,r+=o.attribute.height}))}))}function Sk(n,t){for(let e=0;e<t.table.colCount;e++){const i=new Vt({x:0,y:0,width:t.table.getColWidth(e),height:t.table.getRowHeight(n)});if(i.role="cell",i.col=e,i.row=n,i.needUpdate=!0,!i)continue;const r=t.getColGroup(e);if(r)if(r.firstChild&&n<r.firstChild.row)r.insertBefore(i,r.firstChild),r.firstChild.row=r.firstChild.row+1;else if(r.lastChild&&n>r.lastChild.row)r.appendChild(i);else{const o=t.highPerformanceGetCell(e,n,!0);o!==i&&(r.insertBefore(i,o),o&&(o.row=o.row+1),o!==r.lastChild&&r.lastChild&&(r.lastChild.row=r.lastChild.row+1))}}}function fF(n,t){for(let e=0;e<t.table.colCount;e++){const i=t.getColGroup(e,!1);if(!i)continue;let r;i.forEachChildren((o=>o.row===n&&(r=o,!0))),r&&(i.updateColumnHeight(-r.attribute.height),i.removeChild(r))}}function PC(n,t,e){let i;for(let r=0;r<e.table.colCount;r++){const o=e.table.getCellRange(r,n);let s;o.start.row<=n+1&&o.end.row>=n+1&&(mm(o,e),s=o.start.row);const a=e.table.getCellRange(r,t);a.start.row<=t+1&&a.end.row>=t+1&&(mm(a,e),s=a.start.row),$(s)&&(i=$(i)?Math.min(i,s):s)}return i}function EC(n,t,e){let i;for(let r=0;r<e.table.colCount;r++){let o;const s=e.highPerformanceGetCell(r,n);s.mergeStartRow&&s.mergeEndRow&&s.mergeEndRow>n&&(mm({start:{row:s.mergeStartRow,col:e.table.isAutoRowHeight(t)?0:s.mergeStartCol},end:{row:s.mergeEndRow,col:e.table.isAutoRowHeight(t)?e.table.colCount-1:s.mergeEndCol}},e),o=s.mergeStartRow);const a=e.highPerformanceGetCell(r,t);a.mergeStartRow&&a.mergeEndRow&&a.mergeStartRow<t&&(mm({start:{row:a.mergeStartRow,col:e.table.isAutoRowHeight(t)?0:a.mergeStartCol},end:{row:a.mergeEndRow,col:e.table.isAutoRowHeight(t)?e.table.colCount-1:a.mergeEndCol}},e),o=a.mergeStartRow),$(o)&&(i=$(i)?Math.min(i,o):o)}return i}function mm(n,t){const{start:e,end:i}=n;for(let r=e.col;r<=i.col;r++)for(let o=e.row;o<=i.row;o++){const s=t.highPerformanceGetCell(r,o,!0);s&&(s.needUpdate=!0)}}function Llt(n,t){if(t.table.isHasSeriesNumber())for(let e=n;e<=t.table.rowCount-1;e++)Er(0,e,t.table,!1)}function Olt(n){const{internalProps:t}=n;t.bodyDomContainer=document.createElement("div"),t.bodyDomContainer.id="vtable-body-dom-container",t.bodyDomContainer.classList.add("table-component-container"),t.element.appendChild(t.bodyDomContainer),t.headerDomContainer=document.createElement("div"),t.headerDomContainer.id="vtable-header-dom-container",t.headerDomContainer.classList.add("table-component-container"),t.element.appendChild(t.headerDomContainer),t.frozenBodyDomContainer=document.createElement("div"),t.frozenBodyDomContainer.id="vtable-frozen-body-dom-container",t.frozenBodyDomContainer.classList.add("table-component-container"),t.element.appendChild(t.frozenBodyDomContainer),t.frozenHeaderDomContainer=document.createElement("div"),t.frozenHeaderDomContainer.id="vtable-frozen-header-dom-container",t.frozenHeaderDomContainer.classList.add("table-component-container"),t.element.appendChild(t.frozenHeaderDomContainer),t.rightFrozenBodyDomContainer=document.createElement("div"),t.rightFrozenBodyDomContainer.id="vtable-right-frozen-body-dom-container",t.rightFrozenBodyDomContainer.classList.add("table-component-container"),t.element.appendChild(t.rightFrozenBodyDomContainer),t.rightFrozenHeaderDomContainer=document.createElement("div"),t.rightFrozenHeaderDomContainer.id="vtable-right-frozen-header-dom-container",t.rightFrozenHeaderDomContainer.classList.add("table-component-container"),t.element.appendChild(t.rightFrozenHeaderDomContainer),t.frozenBottomDomContainer=document.createElement("div"),t.frozenBottomDomContainer.id="vtable-frozen-bottom-dom-container",t.frozenBottomDomContainer.classList.add("table-component-container"),t.element.appendChild(t.frozenBottomDomContainer),t.bottomDomContainer=document.createElement("div"),t.bottomDomContainer.id="vtable-bottom-dom-container",t.bottomDomContainer.classList.add("table-component-container"),t.element.appendChild(t.bottomDomContainer),t.rightFrozenBottomDomContainer=document.createElement("div"),t.rightFrozenBottomDomContainer.id="vtable-right-frozen-bottom-dom-container",t.rightFrozenBottomDomContainer.classList.add("table-component-container"),t.element.appendChild(t.rightFrozenBottomDomContainer)}function Ilt(n){const{headerDomContainer:t,bodyDomContainer:e,frozenBodyDomContainer:i,frozenHeaderDomContainer:r,rightFrozenBodyDomContainer:o,rightFrozenHeaderDomContainer:s,bottomDomContainer:a,frozenBottomDomContainer:l,rightFrozenBottomDomContainer:h}=n.internalProps;if(!(t||e||i||r||o||s||a||l||h))return;const u=n.getAllColsWidth(),d=Math.min(u,n.tableNoFrameWidth),c=n.getFrozenColsWidth(),g=n.getRightFrozenColsWidth(),f=c+g,p=Math.min(u-f,d-f),m=n.getAllRowsHeight(),v=Math.min(m,n.tableNoFrameHeight),b=n.getFrozenRowsHeight(),y=n.getBottomFrozenRowsHeight(),C=b+y,w=Math.min(m-C,v-C);n.frozenColCount>0?(t.style.left=`${n.tableX+c}px`,e.style.left=`${n.tableX+c}px`,a.style.left=`${n.tableX+c}px`):n.frozenColCount===0&&(t.style.left=`${n.tableX}px`,e.style.left=`${n.tableX}px`,a.style.left=`${n.tableX}px`),i.style.left=`${n.tableX}px`,r.style.left=`${n.tableX}px`,t.style.width=`${p}px`,t.style.height=`${b}px`,e.style.top=`${n.tableY}px`,e.style.width=`${p}px`,e.style.height=`${w}px`,e.style.top=`${n.tableY+b}px`,i.style.width=`${c}px`,i.style.height=`${w}px`,i.style.top=`${n.tableY+b}px`,r.style.width=`${c}px`,r.style.height=`${b}px`,r.style.top=`${n.tableY}px`,o.style.width=`${g}px`,o.style.height=`${w}px`,o.style.top=`${n.tableY+b}px`,o.style.left=n.tableX+d-g+"px",s.style.width=`${g}px`,s.style.height=`${b}px`,s.style.top=`${n.tableY}px`,s.style.left=n.tableX+d-g+"px",a.style.width=`${p}px`,a.style.height=`${y}px`,a.style.top=n.tableY+v-y+"px",l.style.width=`${c}px`,l.style.height=`${y}px`,l.style.top=n.tableY+v-y+"px",h.style.width=`${g}px`,h.style.height=`${y}px`,h.style.top=n.tableY+v-y+"px",h.style.left=n.tableX+d-g+"px"}function pF(n){if(!n.table.reactCustomLayout)return;const{table:t,stage:e}=n,i=e.pluginService.findPluginsByName("ReactAttributePlugin")[0],{htmlMap:r,renderId:o}=i;for(const s in r){const a=r[s],{graphic:l,wrapContainer:h,renderId:u}=a;if(u!==o)continue;let d;if(n.frozenColCount>t.frozenColCount){const c=jl(l);if(!c)continue;const{col:g,row:f}=c;f>=t.rowCount-t.bottomFrozenRowCount&&g<n.frozenColCount&&g>=t.frozenColCount&&l.attribute.react.container===t.frozenBottomDomContainer?d=t.bottomDomContainer:f>=t.frozenRowCount&&g<n.frozenColCount&&g>=t.frozenColCount&&l.attribute.react.container===t.frozenBodyDomContainer?d=t.bodyDomContainer:f<t.frozenRowCount&&g<n.frozenColCount&&g>=t.frozenColCount&&l.attribute.react.container===t.frozenHeaderDomContainer&&(d=t.headerDomContainer)}else if(n.frozenColCount<t.frozenColCount){const c=jl(l);if(!c)continue;const{col:g,row:f}=c;f>=t.rowCount-t.bottomFrozenRowCount&&g<t.frozenColCount&&g>=n.frozenColCount&&l.attribute.react.container===t.bottomDomContainer?d=t.frozenBottomDomContainer:f>=t.frozenRowCount&&g<t.frozenColCount&&g>=n.frozenColCount&&l.attribute.react.container===t.bodyDomContainer?d=t.frozenBodyDomContainer:f<t.frozenRowCount&&g<t.frozenColCount&&g>=n.frozenColCount&&l.attribute.react.container===t.headerDomContainer&&(d=t.frozenHeaderDomContainer)}d&&(d.appendChild(h),a.nativeContainer=d,a.container=d,l.attribute.react.container=d,i.updateStyleOfWrapContainer(l,e,h,d,l.attribute.react))}}function Hlt(n){var t,e,i,r;if(n.table.frozenColCount>n.table.rowHeaderLevelCount){n.rowHeaderGroup.setAttribute("height",n.bodyGroup.attribute.height),n.rowHeaderGroup.setAttribute("y",n.bodyGroup.attribute.y),n.cornerHeaderGroup.setAttribute("height",n.colHeaderGroup.attribute.height);for(let o=0;o<n.table.frozenColCount-n.table.rowHeaderLevelCount;o++)mF(n),vF(n),CF(n)}else if(n.table.frozenColCount<n.table.rowHeaderLevelCount){n.bodyGroup.setAttribute("height",n.rowHeaderGroup.attribute.height),n.bodyGroup.setAttribute("y",n.rowHeaderGroup.attribute.y),n.colHeaderGroup.setAttribute("height",n.cornerHeaderGroup.attribute.height);for(let o=0;o<n.table.rowHeaderLevelCount-n.table.frozenColCount;o++)bF(n),yF(n),_F(n)}n.bodyGroup.setAttribute("x",n.rowHeaderGroup.attribute.width),n.colHeaderGroup.setAttribute("x",n.cornerHeaderGroup.attribute.width),n.updateContainer(),n.updateBorderSizeAndPosition(),n.isPivot||n.table.transpose?n.table.options.frozenColCount?n.component.setFrozenColumnShadow(n.table.frozenColCount-1):n.table.options.frozenColCount&&n.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount):(n.component.setFrozenColumnShadow(n.table.frozenColCount-1),n.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount)),n.hasFrozen=!0,n.frozenColCount=n.table.frozenColCount,n.frozenRowCount=(r=(e=(t=n.colHeaderGroup.firstChild)===null||t===void 0?void 0:t.childrenCount)!==null&&e!==void 0?e:(i=n.cornerHeaderGroup.firstChild)===null||i===void 0?void 0:i.childrenCount)!==null&&r!==void 0?r:n.table.frozenRowCount}function Dlt(n){var t,e,i,r,o,s;if(n.frozenColCount>n.table.frozenColCount){n.bodyGroup.setAttribute("height",n.rowHeaderGroup.attribute.height),n.bodyGroup.setAttribute("y",n.rowHeaderGroup.attribute.y),n.colHeaderGroup.setAttribute("height",n.cornerHeaderGroup.attribute.height);for(let a=0;a<n.frozenColCount-n.table.frozenColCount;a++)bF(n),yF(n),_F(n)}else if(n.frozenColCount<n.table.frozenColCount){n.rowHeaderGroup.setAttribute("height",n.bodyGroup.attribute.height),n.rowHeaderGroup.setAttribute("y",n.bodyGroup.attribute.y),n.cornerHeaderGroup.setAttribute("height",n.colHeaderGroup.attribute.height);for(let a=0;a<n.table.frozenColCount-n.frozenColCount;a++)mF(n),vF(n),CF(n)}pF(n),n.recreateAllSelectRangeComponents(),n.frozenColCount=n.table.frozenColCount,n.frozenRowCount=(r=(e=(t=n.colHeaderGroup.firstChild)===null||t===void 0?void 0:t.childrenCount)!==null&&e!==void 0?e:(i=n.cornerHeaderGroup.firstChild)===null||i===void 0?void 0:i.childrenCount)!==null&&r!==void 0?r:n.table.frozenRowCount,n.proxy.colStart=(s=(o=n.bodyGroup.firstChild)===null||o===void 0?void 0:o.col)!==null&&s!==void 0?s:n.table.frozenColCount,n.bodyGroup.setAttribute("x",n.rowHeaderGroup.attribute.width),n.colHeaderGroup.setAttribute("x",n.cornerHeaderGroup.attribute.width),n.updateContainer(),n.updateBorderSizeAndPosition(),n.isPivot||n.table.transpose?n.table.options.frozenColCount?n.component.setFrozenColumnShadow(n.table.frozenColCount-1):n.table.options.rightFrozenColCount&&n.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount):(n.component.setFrozenColumnShadow(n.table.frozenColCount-1),n.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount)),n.hasFrozen=!0}function mF(n){const t=n.bodyGroup.firstChild instanceof Vt?n.bodyGroup.firstChild:null;t&&(n.rowHeaderGroup.appendChild(t),n.rowHeaderGroup.setAttribute("width",n.rowHeaderGroup.attribute.width+t.attribute.width),n.bodyGroup.setAttribute("width",n.bodyGroup.attribute.width-t.attribute.width))}function vF(n){const t=n.colHeaderGroup.firstChild instanceof Vt?n.colHeaderGroup.firstChild:null;t&&(n.cornerHeaderGroup.appendChild(t),n.cornerHeaderGroup.setAttribute("width",n.cornerHeaderGroup.attribute.width+t.attribute.width),n.colHeaderGroup.setAttribute("width",n.colHeaderGroup.attribute.width-t.attribute.width))}function bF(n){var t;const e=n.rowHeaderGroup.lastChild instanceof Vt?n.rowHeaderGroup.lastChild:(t=n.rowHeaderGroup.lastChild)===null||t===void 0?void 0:t._prev;e&&(Hr(n.bodyGroup,e,n.bodyGroup.firstChild),n.bodyGroup.setAttribute("width",n.bodyGroup.attribute.width+e.attribute.width),n.rowHeaderGroup.setAttribute("width",n.rowHeaderGroup.attribute.width-e.attribute.width))}function yF(n){var t;const e=n.cornerHeaderGroup.lastChild instanceof Vt?n.cornerHeaderGroup.lastChild:(t=n.cornerHeaderGroup.lastChild)===null||t===void 0?void 0:t._prev;e&&(Hr(n.colHeaderGroup,e,n.colHeaderGroup.firstChild),n.colHeaderGroup.setAttribute("width",n.colHeaderGroup.attribute.width+e.attribute.width),n.cornerHeaderGroup.setAttribute("width",n.cornerHeaderGroup.attribute.width-e.attribute.width))}function CF(n){const t=n.bottomFrozenGroup.firstChild instanceof Vt?n.bottomFrozenGroup.firstChild:null;t&&(n.leftBottomCornerGroup.appendChild(t),n.leftBottomCornerGroup.setAttribute("width",n.leftBottomCornerGroup.attribute.width+t.attribute.width),n.bottomFrozenGroup.setAttribute("width",n.bottomFrozenGroup.attribute.width-t.attribute.width),n.table.isPivotChart()&&t.forEachChildren((e=>{e.setAttributes({stroke:!1,fill:!1})})))}function _F(n){var t;const e=n.leftBottomCornerGroup.lastChild instanceof Vt?n.leftBottomCornerGroup.lastChild:(t=n.leftBottomCornerGroup.lastChild)===null||t===void 0?void 0:t._prev;e&&(Hr(n.bottomFrozenGroup,e,n.bottomFrozenGroup.firstChild),n.bottomFrozenGroup.setAttribute("width",n.bottomFrozenGroup.attribute.width+e.attribute.width),n.leftBottomCornerGroup.setAttribute("width",n.leftBottomCornerGroup.attribute.width-e.attribute.width),n.table.isPivotChart()&&e.forEachChildren((i=>{var r,o,s,a;const l=n.table._getCellStyle(i.col,i.row),h=n.table.getCellRange(i.col,i.row),u=Ba(l,n.table,h?h.start.col:i.col,h?h.start.row:i.row,ht).theme;i.setAttributes({fill:(o=(r=u?.group)===null||r===void 0?void 0:r.fill)!==null&&o!==void 0?o:void 0,stroke:(a=(s=u?.group)===null||s===void 0?void 0:s.stroke)!==null&&a!==void 0?a:void 0})})))}function Flt(n,t){const{table:e,proxy:i,rightTopCornerGroup:r,rightFrozenGroup:o,rightBottomCornerGroup:s,bottomFrozenGroup:a,bodyGroup:l,colHeaderGroup:h}=t,u=t.table.rightFrozenColCount;if(n>u){for(let c=e.colCount-u-1;c>=e.colCount-n;c--)Hr(o,t.getColGroup(c),o.firstChild),Hr(r,t.getColGroup(c,!0),r.firstChild),Hr(s,t.getColGroupInBottom(c),s.firstChild);let d=0;o.forEachChildren((c=>{c.setAttribute("x",d),d+=c.attribute.width})),d=0,r.forEachChildren((c=>{c.setAttribute("x",d),d+=c.attribute.width})),d=0,s.forEachChildren((c=>{c.setAttribute("x",d),d+=c.attribute.width}))}else if(n<u){for(let c=e.colCount-u;c<e.colCount-n;c++){const g=t.getColGroup(c);g.setAttribute("x",l.lastChild.attribute.x+e.getColWidth(l.lastChild.col)),l.appendChild(g);const f=t.getColGroupInRightTopCorner(c);f.setAttribute("x",h.lastChild.attribute.x+e.getColWidth(h.lastChild.col)),h.appendChild(f);const p=t.getColGroupInRightBottomCorner(c);p.setAttribute("x",a.lastChild.attribute.x+e.getColWidth(a.lastChild.col)),a.appendChild(p)}let d=0;o.forEachChildren((c=>{c.setAttribute("x",d),d+=c.attribute.width})),d=0,r.forEachChildren((c=>{c.setAttribute("x",d),d+=c.attribute.width})),d=0,s.forEachChildren((c=>{c.setAttribute("x",d),d+=c.attribute.width}))}o.setAttribute("width",e.getColsWidth(e.colCount-n,e.colCount-1)),r.setAttribute("width",e.getColsWidth(e.colCount-n,e.colCount-1)),s.setAttribute("width",e.getColsWidth(e.colCount-n,e.colCount-1)),e.internalProps.rightFrozenColCount=n,t.updateContainer(),t.component.updateScrollBar(),t.updateNextFrame()}function zlt(n,t){const{table:e,proxy:i,bottomFrozenGroup:r,leftBottomCornerGroup:o,rightBottomCornerGroup:s}=t;r.childrenCount||(i.table.isPivotChart()||(di(o,0,0,0,e.frozenColCount-1,0,-1,"rowHeader",e),di(s,0,0,e.colCount-e.rightFrozenColCount,e.colCount-1,0,-1,"body",e)),di(r,0,0,i.colStart,i.colEnd,0,-1,"body",e));const a=t.table.bottomFrozenRowCount;if(n>a){for(let l=0;l<e.frozenColCount;l++){const h=t.getColGroupInLeftBottomCorner(l);for(let d=e.rowCount-a-1;d>=e.rowCount-n;d--)Hr(h,t.getCell(l,d,!0),h.firstChild);let u=0;h.forEachChildren((d=>{d.setAttribute("y",u),u+=e.getRowHeight(d.row)}))}for(let l=i.colStart;l<=i.colEnd;l++){const h=t.getColGroupInBottom(l);for(let d=e.rowCount-a-1;d>=e.rowCount-n;d--)Hr(h,t.getCell(l,d,!0),h.firstChild);let u=0;h.forEachChildren((d=>{d.setAttribute("y",u),u+=e.getRowHeight(d.row)}))}if(e.rightFrozenColCount>0)for(let l=e.colCount-e.rightFrozenColCount;l<e.colCount;l++){const h=t.getColGroupInRightBottomCorner(l);for(let d=e.rowCount-a-1;d>=e.rowCount-n;d--)Hr(h,t.getCell(l,d,!0),h.firstChild);let u=0;h.forEachChildren((d=>{d.setAttribute("y",u),u+=e.getRowHeight(d.row)}))}}else if(n<a){for(let l=0;l<e.rowHeaderLevelCount;l++){const h=t.getColGroup(l);for(let c=e.rowCount-a;c<e.rowCount-n;c++){const g=t.getCell(l,c,!0);g.setAttribute("y",h.lastChild.attribute.y+e.getRowHeight(h.lastChild.row)),h.appendChild(g)}const u=t.getColGroupInLeftBottomCorner(l);let d=0;u.forEachChildren((c=>{c.setAttribute("y",d),d+=e.getRowHeight(c.row)}))}for(let l=i.colStart;l<=i.colEnd;l++){const h=t.getColGroup(l);for(let c=e.rowCount-a;c<e.rowCount-n;c++){const g=t.getCell(l,c,!0);g.setAttribute("y",h.lastChild.attribute.y+e.getRowHeight(h.lastChild.row)),h.appendChild(g)}const u=t.getColGroupInBottom(l);let d=0;u.forEachChildren((c=>{c.setAttribute("y",d),d+=e.getRowHeight(c.row)}))}if(e.rightFrozenColCount>0)for(let l=e.colCount-e.rightFrozenColCount;l<e.colCount;l++){const h=t.getColGroup(l);for(let c=e.rowCount-a;c<e.rowCount-n;c++){const g=t.getCell(l,c,!0);g.setAttribute("y",h.lastChild.attribute.y+e.getRowHeight(h.lastChild.row)),h.appendChild(g)}const u=t.getColGroupInRightBottomCorner(l);let d=0;u.forEachChildren((c=>{c.setAttribute("y",d),d+=e.getRowHeight(c.row)}))}}r.setAttribute("height",e.getRowsHeight(e.rowCount-n,e.rowCount-1)),o.setAttribute("height",e.getRowsHeight(e.rowCount-n,e.rowCount-1)),s.setAttribute("height",e.getRowsHeight(e.rowCount-n,e.rowCount-1)),e.internalProps.bottomFrozenRowCount=n,t.updateContainer(),t.component.updateScrollBar(),t.updateNextFrame()}function Hr(n,t,e){t&&n&&(e?n.insertBefore(t,e):n.appendChild(t))}function Nlt(n){var t,e,i,r,o;if(n.frozenRowCount>n.table.frozenRowCount){n.bodyGroup.setAttribute("width",n.colHeaderGroup.attribute.width),n.bodyGroup.setAttribute("x",n.colHeaderGroup.attribute.x),n.rowHeaderGroup.setAttribute("width",n.cornerHeaderGroup.attribute.width);for(let s=0;s<n.frozenRowCount-n.table.frozenRowCount;s++)Glt(n),$lt(n),Ult(n)}else if(n.frozenRowCount<n.table.frozenRowCount){n.colHeaderGroup.setAttribute("width",n.bodyGroup.attribute.width),n.colHeaderGroup.setAttribute("x",n.bodyGroup.attribute.x),n.cornerHeaderGroup.setAttribute("width",n.rowHeaderGroup.attribute.width);for(let s=0;s<n.table.frozenRowCount-n.frozenRowCount;s++)Wlt(n),jlt(n),Vlt(n)}pF(n),n.recreateAllSelectRangeComponents(),n.frozenRowCount=n.table.frozenRowCount,n.frozenColCount=(e=(t=n.rowHeaderGroup)===null||t===void 0?void 0:t.childrenCount)!==null&&e!==void 0?e:0,n.proxy.rowStart=(o=(r=(i=n.bodyGroup.firstChild)===null||i===void 0?void 0:i.firstChild)===null||r===void 0?void 0:r.row)!==null&&o!==void 0?o:n.table.frozenRowCount,n.bodyGroup.setAttribute("y",n.colHeaderGroup.attribute.height),n.rowHeaderGroup.setAttribute("y",n.cornerHeaderGroup.attribute.height),n.updateContainer({needUpdateCellY:!0}),n.updateBorderSizeAndPosition(),n.hasFrozen=!0}function Wlt(n){var t;let e=!1;for(let i=0;i<n.bodyGroup.childrenCount;i++){const r=n.bodyGroup.children[i];if(!Vu(r))continue;const o=r.firstChild;n.colHeaderGroup.children[i]||di(n.colHeaderGroup,0,0,o.col,o.col,0,0,"columnHeader",n.table),(t=n.colHeaderGroup.children[i])===null||t===void 0||t.appendChild(o),e||(n.colHeaderGroup.setAttribute("height",n.colHeaderGroup.attribute.height+o.attribute.height),n.bodyGroup.setAttribute("height",n.bodyGroup.attribute.height-o.attribute.height),e=!0)}}function jlt(n){var t;let e=!1;for(let i=0;i<n.rowHeaderGroup.childrenCount;i++){const r=n.rowHeaderGroup.children[i];if(!Vu(r))continue;const o=r.firstChild;n.cornerHeaderGroup.children[i]||di(n.cornerHeaderGroup,0,0,o.col,o.col,0,0,n.table.isListTable()?"columnHeader":"cornerHeader",n.table),(t=n.cornerHeaderGroup.children[i])===null||t===void 0||t.appendChild(o),e||(n.cornerHeaderGroup.setAttribute("height",n.cornerHeaderGroup.attribute.height+o.attribute.height),n.rowHeaderGroup.setAttribute("height",n.rowHeaderGroup.attribute.height-o.attribute.height),e=!0)}}function Vlt(n){let t=!1;for(let e=0;e<n.rightFrozenGroup.childrenCount;e++){const i=n.rightFrozenGroup.children[e];if(!Vu(i))continue;const r=i.firstChild;n.rightTopCornerGroup.children[e]||di(n.rightTopCornerGroup,0,0,r.col,r.col,0,0,"columnHeader",n.table),n.rightTopCornerGroup.children[e].appendChild(r),t||(n.rightTopCornerGroup.setAttribute("height",n.rightTopCornerGroup.attribute.height+r.attribute.height),n.rightFrozenGroup.setAttribute("height",n.rightFrozenGroup.attribute.height-r.attribute.height),t=!0)}}function Glt(n){let t=!1;for(let e=0;e<n.colHeaderGroup.childrenCount;e++){const i=n.colHeaderGroup.children[e];if(!Vu(i))continue;const r=n.bodyGroup.children[e];if(!r)continue;const o=i.lastChild;Hr(r,o,r.firstChild),t||(n.colHeaderGroup.setAttribute("height",n.colHeaderGroup.attribute.height-o.attribute.height),n.bodyGroup.setAttribute("height",n.bodyGroup.attribute.height+o.attribute.height),t=!0)}}function $lt(n){let t=!1;for(let e=0;e<n.cornerHeaderGroup.childrenCount;e++){const i=n.cornerHeaderGroup.children[e];if(!Vu(i))continue;const r=n.rowHeaderGroup.children[e];if(!r)continue;const o=i.lastChild;Hr(r,o,r.firstChild),t||(n.cornerHeaderGroup.setAttribute("height",n.cornerHeaderGroup.attribute.height-o.attribute.height),n.rowHeaderGroup.setAttribute("height",n.rowHeaderGroup.attribute.height+o.attribute.height),t=!0)}}function Ult(n){let t=!1;for(let e=0;e<n.rightTopCornerGroup.childrenCount;e++){const i=n.rightTopCornerGroup.children[e];if(!Vu(i))continue;const r=n.rightFrozenGroup.children[e];if(!r)continue;const o=i.lastChild;Hr(r,o,r.firstChild),t||(n.rightTopCornerGroup.setAttribute("height",n.rightTopCornerGroup.attribute.height-o.attribute.height),n.rightFrozenGroup.setAttribute("height",n.rightFrozenGroup.attribute.height+o.attribute.height),t=!0)}}function Vu(n){return n instanceof Vt&&n?.name!=="table-border-rect"}function Xlt(n,t){const{table:e}=n,i=e.internalProps.layoutMap,r=t===-1?"all":e.internalProps.columnResizeType;if(r==="column"){const o=n.getColGroup(t),s=n.getColGroup(t,!0),a=n.getColGroupInBottom(t,!0);if(o?.forEachChildren((l=>{br(l,e.getColWidth(l.col),e.getRowHeight(l.row))})),s?.forEachChildren((l=>{br(l,e.getColWidth(l.col),e.getRowHeight(l.row))})),a?.forEachChildren((l=>{br(l,e.getColWidth(l.col),e.getRowHeight(l.row))})),e.widthMode==="adaptive"&&t<e.colCount-1){const l=n.getColGroup(t+1),h=n.getColGroup(t+1,!0),u=n.getColGroupInBottom(t+1,!0);l?.forEachChildren((d=>{br(d,e.getColWidth(d.col),e.getRowHeight(d.row))})),h?.forEachChildren((d=>{br(d,e.getColWidth(d.col),e.getRowHeight(d.row))})),u?.forEachChildren((d=>{br(d,e.getColWidth(d.col),e.getRowHeight(d.row))}))}}else{let o,s,a,l=e.rowHeaderLevelCount,h=e.colCount-1;if(r==="indicator")if(i.indicatorsAsCol)o=i.getIndicatorKey(t,e.columnHeaderLevelCount);else{const u=i.getCellHeaderPaths(t,e.columnHeaderLevelCount-1),d=u.colHeaderPaths[u.colHeaderPaths.length-1];s=d.dimensionKey,a=d.value}else if(r==="indicatorGroup"){const u=e.internalProps.layoutMap,d=u.getCellHeaderPaths(e.stateManager.columnResize.col,e.columnHeaderLevelCount),c=u.getHeadNodeByRowOrColDimensions(d.colHeaderPaths.slice(0,d.colHeaderPaths.length-1));l=c.startInTotal+e.frozenColCount,h=c.startInTotal+e.frozenColCount+c.size-1}for(let u=l;u<=h;u++){const d=n.getColGroup(u),c=n.getColGroup(u,!0),g=n.getColGroupInBottom(u,!0);if(d){if(r==="indicator"){const f=i.getIndicatorKey(u,e.columnHeaderLevelCount);if(i.indicatorsAsCol&&f!==o)continue;if(!i.indicatorsAsCol){const p=i.getCellHeaderPaths(u,e.columnHeaderLevelCount-1),m=p?.colHeaderPaths[p.colHeaderPaths.length-1];if(!m||s!==m.dimensionKey||a!==m.value)continue}}d.forEachChildren((f=>{br(f,e.getColWidth(f.col),e.getRowHeight(f.row))})),c?.forEachChildren((f=>{br(f,e.getColWidth(f.col),e.getRowHeight(f.row))})),g?.forEachChildren((f=>{br(f,e.getColWidth(f.col),e.getRowHeight(f.row))}))}}}}function Ylt(n,t){var e;const{table:i}=n,r=i.internalProps.layoutMap,o=i.stateManager,s=t===-1?"all":i.internalProps.rowResizeType;let a,l,h,u=i.columnHeaderLevelCount,d=i.rowCount-1;if(s==="indicator")if(r.indicatorsAsCol){const g=r.getCellHeaderPaths(i.rowHeaderLevelCount-1,t),f=(e=g.rowHeaderPaths)===null||e===void 0?void 0:e[g.rowHeaderPaths.length-1];l=f?.dimensionKey,h=f?.value}else a=r.getIndicatorKey(i.rowHeaderLevelCount,t);else if(s==="indicatorGroup"){const g=i.internalProps.layoutMap,f=g.getCellHeaderPaths(i.rowHeaderLevelCount,t),p=g.getHeadNodeByRowOrColDimensions(f.rowHeaderPaths.slice(0,f.rowHeaderPaths.length-1));u=p.startInTotal+i.frozenRowCount,d=p.startInTotal+i.frozenRowCount+p.size-1}const c=[{startCol:n.proxy.colStart,endCol:n.proxy.colEnd}];i.frozenColCount&&c.push({startCol:0,endCol:i.frozenColCount-1}),i.rightFrozenColCount&&c.push({startCol:i.colCount-i.rightFrozenColCount,endCol:i.colCount-1}),c.forEach((({startCol:g,endCol:f})=>{for(let p=g;p<=f;p++)if(s==="row"){const m=n.highPerformanceGetCell(p,t);if(m.role!=="cell")continue;if(br(m,i.getColWidth(m.col),i.getRowHeight(m.row)),i.heightMode==="adaptive"&&t<i.rowCount-1){const v=n.highPerformanceGetCell(p,t+1);br(v,i.getColWidth(v.col),i.getRowHeight(v.row))}}else for(let m=u;m<=d;m++){if(s==="indicator"){const b=r.getIndicatorKey(o.table.rowHeaderLevelCount,m);if(!r.indicatorsAsCol&&b!==a)continue;if(r.indicatorsAsCol){const y=r.getCellHeaderPaths(o.table.rowHeaderLevelCount-1,m),C=y?.rowHeaderPaths[y.rowHeaderPaths.length-1];if(!C||l!==C.dimensionKey||h!==C.value)continue}}const v=n.highPerformanceGetCell(p,m);v.role==="cell"&&br(v,i.getColWidth(v.col),i.getRowHeight(v.row))}}))}function u1(n){var t;for(let e=n.proxy.colStart;e<=n.proxy.colEnd;e++){const i=n.getColGroup(e);(t=i?.getChildren())===null||t===void 0||t.forEach((r=>{r.children.forEach((o=>{o.type==="chart"&&(o.cacheCanvas=null,o.addUpdateBoundTag())}))}))}}function qlt(n,t){const e=n.table;if(e.isPivotChart()){const i=e._selectedDataItemsInChart.length;if((t===null||t?.length===0||Object.keys(t).length===0)&&i===0)return;const r=[];if(Array.isArray(t))t.forEach((o=>{if(o&&o.key!==0&&Object.keys(o).length>0){const s={};for(const a in o)a.startsWith("VGRAMMAR_")||a.startsWith("__VCHART")||(s[a]=o[a]);r.push(s)}}));else if(t&&t.key!==0&&Object.keys(t).length>0){const o={};for(const s in t)s.startsWith("VGRAMMAR_")||s.startsWith("__VCHART")||(o[s]=t[s]);r.push(o)}Nc(e._selectedDataItemsInChart,r)||(e._selectedDataItemsInChart=r,e.internalProps.layoutMap.updateDataStateToChartInstance(),u1(n),e.scenegraph.updateNextFrame())}}function br(n,t,e){n.forEachChildren((i=>{i.type==="chart"&&(i.cacheCanvas=null,i.setAttributes({width:Math.ceil(t-i.attribute.cellPadding[3]-i.attribute.cellPadding[1]),height:Math.ceil(e-i.attribute.cellPadding[0]-i.attribute.cellPadding[2])}))}))}function Klt(n){const t=n.table.tableNoFrameWidth,e=n.table.tableNoFrameHeight;n.tableGroup=new Vt({x:0,y:0,width:t,height:e,clip:!0,pickable:!1}),n.tableGroup.role="table";const i=_o(0,0,!n.table.internalProps.enableTreeStickCell);i.role="col-header",n.colHeaderGroup=i;const r=_o(0,0,!n.table.options.enableTreeStickCell);r.role="corner-header",n.cornerHeaderGroup=r;const o=_o(0,0,!0);o.role="row-header",n.rowHeaderGroup=o;const s=_o(t,0,!0);s.role="body",n.bodyGroup=s;const a=_o(0,0,!0);a.role="right-frozen",n.rightFrozenGroup=a;const l=_o(0,0,!0);l.role="bottom-frozen",n.bottomFrozenGroup=l;const h=_o(0,0);h.role="component",n.componentGroup=h;const u=_o(0,0,!0);u.role="corner-right-top-header",n.rightTopCornerGroup=u;const d=_o(0,0,!0);d.role="corner-right-bottom-header",n.rightBottomCornerGroup=d;const c=_o(0,0,!0);c.role="corner-left-bottom-header",n.leftBottomCornerGroup=c,n.tableGroup.addChild(s),n.tableGroup.addChild(o),n.tableGroup.addChild(l),n.tableGroup.addChild(i),n.tableGroup.addChild(a),n.tableGroup.addChild(d),n.tableGroup.addChild(u),n.tableGroup.addChild(c),n.tableGroup.addChild(r),n.tableGroup.addChild(h)}function _o(n,t,e){return new Vt({x:0,y:0,width:n,height:t,clip:e!=null&&e,pickable:!1})}function is(n,t){return n.forEachChildrenSkipChild(((e,i)=>{e.setAttribute("x",t),t+=e.attribute.width})),t}function ns(n,t){return n.forEachChildrenSkipChild(((e,i)=>{e.setAttribute("y",t),t+=e.attribute.height})),t}function Zlt(n,t,e){n!==-1&&t!==-1&&(po(n,t,(i=>i.attribute.visibleTime==="mouseenter_cell"),(i=>{i.setAttribute("opacity",0);const r=i.parent.getChildByName("icon-back");r&&r.setAttribute("visible",!1)}),e),e.updateNextFrame())}function Jlt(n,t,e){n!==-1&&t!==-1&&(po(n,t,(i=>i.attribute.visibleTime==="mouseenter_cell"),(i=>{i.setAttribute("opacity",1)}),e),e.updateNextFrame())}function Qlt(n,t,e){n!==-1&&t!==-1&&(po(n,t,(i=>i.attribute.visibleTime==="click_cell"),(i=>{i.setAttribute("opacity",0)}),e),e.updateNextFrame())}function tht(n,t,e){n!==-1&&t!==-1&&(po(n,t,(i=>i.attribute.visibleTime==="click_cell"),(i=>{i.setAttribute("opacity",1)}),e),e.updateNextFrame())}function eht(n,t,e,i,r){let o;return r.getCell(n,t).forEachChildren((s=>{s.role&&s.role.startsWith("icon")&&s.containsPoint(e,i,_c.GLOBAL)&&(o=s)})),o}function iht(n,t,e,i,r){var o,s;if((n.attribute.backgroundColor||n.attribute.hoverImage)&&po(t,e,(a=>a.name===n.name),(a=>{var l,h,u,d,c,g,f,p;if(a.attribute.backgroundColor){let m=a.parent.getChildByName("icon-back");m?m.setAttributes({x:((l=a.attribute.x)!==null&&l!==void 0?l:0)+(a.AABBBounds.width()-a.backgroundWidth)/2,y:((h=a.attribute.y)!==null&&h!==void 0?h:0)+(a.AABBBounds.height()-a.backgroundHeight)/2,dx:(u=a.attribute.dx)!==null&&u!==void 0?u:0,dy:(d=a.attribute.dy)!==null&&d!==void 0?d:0,width:a.backgroundWidth,height:a.backgroundHeight,fill:a.attribute.backgroundColor,cornerRadius:5,visible:!0}):(m=be({x:((c=a.attribute.x)!==null&&c!==void 0?c:0)+(a.AABBBounds.width()-a.backgroundWidth)/2,y:((g=a.attribute.y)!==null&&g!==void 0?g:0)+(a.AABBBounds.height()-a.backgroundHeight)/2,dx:(f=a.attribute.dx)!==null&&f!==void 0?f:0,dy:(p=a.attribute.dy)!==null&&p!==void 0?p:0,width:a.backgroundWidth,height:a.backgroundHeight,fill:a.attribute.backgroundColor,cornerRadius:5,pickable:!1,visible:!0}),m.name="icon-back"),a.parent.insertBefore(m,a)}a.attribute.hoverImage&&a.attribute.image!==a.attribute.hoverImage&&(a.image=a.attribute.hoverImage)}),r),n.tooltip){const{x1:a,x2:l,y1:h,y2:u}=n.globalAABBBounds,d={content:n.tooltip.title,referencePosition:{rect:{left:a,right:l,top:h,bottom:u,width:n.globalAABBBounds.width(),height:n.globalAABBBounds.height()},placement:n.tooltip.placement},disappearDelay:n.tooltip.disappearDelay,style:Object.assign({},(o=r.table.internalProps.theme)===null||o===void 0?void 0:o.tooltipStyle,(s=n.tooltip)===null||s===void 0?void 0:s.style)};r.table.internalProps.tooltipHandler.isBinded(d)||r.table.showTooltip(t,e,d)}}function nht(n,t,e,i){(n.attribute.backgroundColor||n.attribute.hoverImage)&&po(t,e,(r=>r.name===n.name),(r=>{const o=r.parent.getChildByName("icon-back");o&&o.setAttribute("visible",!1),r.attribute.hoverImage&&r.attribute.image!==r.attribute.originImage&&(r.image=r.attribute.originImage)}),i)}function Ak(n,t,e,i,r){const o=n.name;po(e,i,(s=>s.name===o),(s=>{or(t,s),s.name=t.name}),r),r.updateNextFrame()}function rht(n,t,e,i){const r=i.getCell(n,t);if($(r.mergeStartCol)&&$(r.mergeStartRow)&&$(r.mergeEndCol)&&$(r.mergeEndRow))for(let o=r.mergeStartCol;o<=r.mergeEndCol;o++)for(let s=r.mergeStartRow;s<=r.mergeEndRow;s++){let a;i.getCell(o,s).forEachChildren((l=>l.attribute.funcType==="sort"&&(a=l,!0))),a&&(or(e,a),a.name=e.name)}else{let o;Yx(r,"children",(s=>s.attribute.funcType==="sort"&&(o=s,!0))),o&&(or(e,o),o.name=e.name)}}function oht(n,t,e,i,r){const o=r.getCellRange(n,t),s=r.getCellRange(e,i);return o.start.col===s.start.col&&o.start.row===s.start.row&&o.end.col===s.end.col&&o.end.row===s.end.row}function sht(n){const{col:t,row:e,iconMark:i,order:r,oldSortCol:o,oldSortRow:s,oldIconMark:a,scene:l}=n,h=l.table.internalProps.headerHelper.getSortIcon(r,l.table,t,e);if(i&&Ak(i,h,t,e,l),!oht(t,e,o,s,l.table)){const u=l.table.internalProps.headerHelper.getSortIcon("normal",l.table,o,s);a?Ak(a,u,o,s,l):rht(o,s,u,l)}}function aht(n){for(let t=0;t<n.table.colCount;t++)for(let e=0;e<n.table.columnHeaderLevelCount;e++)po(t,e,(i=>i.attribute.funcType==="frozen"),(i=>{const r=n.table.internalProps.headerHelper.getFrozenIcon(t,e);or(r,i),i.name=r.name}),n)}function lht(n,t,e){let i;i=e.table.isHeader(n,t)?e.table.internalProps.headerHelper.getHierarchyIcon(n,t):e.table.internalProps.bodyHelper.getHierarchyIcon(n,t),po(n,t,(r=>r.attribute.funcType===me.collapse||r.attribute.funcType===me.expand),(r=>{or(i,r),r.name=i?.name}),e)}function d1(n,t,e){n&&n.role!=="empty"&&n.forEachChildren((i=>{i.type==="group"?d1(i,t,e):t(i)&&e(i)}))}function po(n,t,e,i,r){const o=r.getCell(n,t);if(o.role==="cell"&&$(o.mergeStartCol)&&$(o.mergeStartRow)&&$(o.mergeEndCol)&&$(o.mergeEndRow)){const{colStart:s,colEnd:a,rowStart:l,rowEnd:h}=ka(o,r);for(let u=s;u<=a;u++)for(let d=l;d<=h;d++)d1(r.highPerformanceGetCell(u,d),e,i)}else d1(o,e,i)}function hht(n,t,e){po(n,t,(i=>i.attribute.funcType===me.dropDown),(i=>{i.oldVisibleTime=i.attribute.visibleTime,i.setAttribute("visibleTime","always"),i.setAttribute("opacity",1)}),e)}function uht(n,t,e){po(n,t,(i=>i.attribute.funcType===me.dropDown),(i=>{i.oldVisibleTime&&i.setAttribute("visibleTime",i.oldVisibleTime),i.setAttribute("opacity",i.attribute.visibleTime==="always"?1:0)}),e)}function LC(n,t){const{bgColor:e,borderColor:i,borderLineWidth:r,borderLineDash:o}=t,s={x:0,y:0,width:0,height:0,visible:!1,pickable:!0,fill:e};return s.stroke=rS(i,void 0),s.lineWidth=r,o&&(s.lineDash=o),s.lineCap="butt",Array.isArray(i)&&(s.strokeArrayColor=Kt(i)),Array.isArray(r)&&(s.strokeArrayWidth=Kt(r),s.lineWidth=1),n.setAttributes(s),n.role="corner-frozen",n}function dht(n,t,e,i){var r,o;pm(i)&&aS(i);const s=i.scenegraph,a=OC(n.map((p=>p.col))).sort(((p,m)=>m-p)),l=OC(t.map((p=>p.col))).sort(((p,m)=>p-m)),h=OC(e.map((p=>p.col))).sort(((p,m)=>p-m));a.forEach((p=>{cht(p,s)}));const u=i.colWidthsMap;let d;a.forEach((p=>{u.delAndReorder(p)})),a.length&&Mk(s),s.table._clearColRangeWidthsMap(),l.forEach((p=>{const m=ght(p,s);Mk(s),d=d??m,u.addAndReorder(p)})),fht(s);const c=new Set;if(h.forEach((p=>{for(let m=0;m<i.rowCount;m++){const v=mi(s.table,p,m);if(v)for(let b=v.start.col;b<=v.end.col;b++)for(let y=v.start.col;y<=v.end.col;y++){const C=`${y}-${m}`;c.has(C)||(Er(y,m,s.table,!1),c.add(C))}else Er(p,m,s.table,!1)}})),dt(d)){for(let p=d;p<Math.max(i.colCount,(r=i.internalProps._oldColCount)!==null&&r!==void 0?r:i.colCount);p++)for(let m=0;m<Math.max(i.rowCount,(o=i.internalProps._oldRowCount)!==null&&o!==void 0?o:i.rowCount);m++){const v=s.highPerformanceGetCell(p,m,!0);v&&(v.needUpdate=!0)}s.proxy.colUpdatePos=d}if(l.length){if(!dt(d)){const p=Math.min(...l);s.proxy.colUpdatePos=p}s.proxy.colUpdateDirection="left",s.proxy.updateColGroups(2*s.proxy.screenColCount),f(),s.proxy.progress()}else a.length&&(s.proxy.updateColGroups(2*s.proxy.screenColCount),f(),s.proxy.progress());const g=i.getColsWidth(i.frozenColCount,i.colCount-1);function f(){if(l?.[l?.length-1]>=i.colCount-i.rightFrozenColCount||h?.[h?.length-1]>=i.colCount-i.rightFrozenColCount||a?.[0]>=i.colCount-i.rightFrozenColCount){for(let p=i.colCount-i.rightFrozenColCount;p<i.colCount;p++)for(let m=0;m<i.rowCount;m++){const v=s.highPerformanceGetCell(p,m,!0);v&&(v.needUpdate=!0)}s.proxy.updateRightFrozenCellGroups()}}s.updateContainerWidth(s.table.frozenColCount,g-s.bodyGroup.attribute.width)}function cht(n,t){const e=t.proxy;if(n>=t.table.rowHeaderLevelCount&&!(n>=t.table.colCount-t.table.rightFrozenColCount)){const r=t.getColGroup(n,!1);r&&r.parent===t.bodyGroup&&t.bodyGroup.removeChild(r);const o=t.getColGroupInBottom(n);o&&o.parent===t.bottomFrozenGroup&&t.bottomFrozenGroup.removeChild(o);const s=t.getColGroup(n,!0);s&&s.parent===t.colHeaderGroup&&t.colHeaderGroup.removeChild(s)}n>=e.colStart&&n<=e.colEnd&&(e.colEnd--,e.currentCol--),e.bodyRightCol--;const i=Math.min(e.colLimit,e.bodyRightCol-e.bodyLeftCol+1);e.totalActualBodyColCount=i,e.totalCol=e.colStart+i-1}function ght(n,t){const e=t.proxy;e.bodyRightCol++;const i=Math.min(e.colLimit,e.bodyRightCol-e.bodyLeftCol+1);if(e.totalActualBodyColCount=i,e.totalCol=e.colStart+i-1,!(n<e.colStart))return n>e.colEnd?e.colEnd-e.colStart+1<e.colLimit?(e.colEnd++,e.currentCol++,Tk(n,t),n):void 0:(e.colEnd-e.colStart+1<e.colLimit&&(e.colEnd++,e.currentCol++,Tk(n,t)),n)}function OC(n){const t=[];for(let e=0;e<n.length;e++)t.indexOf(n[e])===-1&&t.push(n[e]);return t}function Mk(n){let t=n.bodyColStart;function e(i){i.col=t;const r=mi(n.table,i.col,i.row);r&&(i.mergeStartCol=r.start.col,i.mergeStartCol=r.start.col,i.mergeEndCol=r.end.col,i.mergeEndCol=r.end.col),i.role}n.bodyGroup.forEachChildren((i=>{i.col=t,i?.forEachChildren((r=>{e(r)})),t++})),t=n.bodyColStart,n.colHeaderGroup.forEachChildren((i=>{i.col=t,i?.forEachChildren((r=>{e(r)})),t++})),t=n.bodyColStart,n.bottomFrozenGroup.forEachChildren((i=>{i.col=t,i?.forEachChildren((r=>{e(r)})),t++}))}function fht(n){let t=n.bodyColStart,e=n.getCellGroupX(t);function i(r){r.col=t;const o=mi(n.table,r.col,r.row);o&&(r.mergeStartCol=o.start.col,r.mergeStartCol=o.start.col,r.mergeEndCol=o.end.col,r.mergeEndCol=o.end.col),r.role}n.bodyGroup.forEachChildren((r=>{r.col=t,r?.forEachChildren((o=>{i(o)})),r.setAttribute("x",e),e+=r.attribute.width,t++})),t=n.bodyColStart,e=n.getCellGroupX(t),n.colHeaderGroup.forEachChildren((r=>{r.col=t,r?.forEachChildren((o=>{i(o)})),r.setAttribute("x",e),e+=r.attribute.width,t++})),t=n.bodyColStart,e=n.getCellGroupX(t),n.bottomFrozenGroup.forEachChildren((r=>{r.col=t,r?.forEachChildren((o=>{i(o)})),r.setAttribute("x",e),e+=r.attribute.width,t++})),t=n.table.colCount-n.table.rightFrozenColCount,e=0,n.rightFrozenGroup.forEachChildren((r=>{r.col=t,r?.forEachChildren((o=>{i(o)})),r.setAttribute("x",e),e+=r.attribute.width,t++})),t=n.table.colCount-n.table.rightFrozenColCount,e=0,n.rightTopCornerGroup.forEachChildren((r=>{r.col=t,r?.forEachChildren((o=>{i(o)})),r.setAttribute("x",e),e+=r.attribute.width,t++})),t=n.table.colCount-n.table.rightFrozenColCount,e=0,n.rightBottomCornerGroup.forEachChildren((r=>{r.col=t,r?.forEachChildren((o=>{i(o)})),r.setAttribute("x",e),e+=r.attribute.width,t++}))}function Tk(n,t){if(t.colHeaderGroup&&t.table.columnHeaderLevelCount>0){const i=new Vt({x:0,y:0,width:t.table.getColWidth(n),height:0,clip:!1,pickable:!1});i.role="column",i.col=n;const r=t.getColGroup(n,!0);r?t.colHeaderGroup.insertBefore(i,r):t.colHeaderGroup.appendChild(i),e(i,n,0,t.table.columnHeaderLevelCount-1)}if(t.bodyGroup){const i=new Vt({x:0,y:0,width:t.table.getColWidth(n),height:0,clip:!1,pickable:!1});i.role="column",i.col=n;const r=t.getColGroup(n,!1);r?t.bodyGroup.insertBefore(i,r):t.bodyGroup.appendChild(i),e(i,n,t.bodyRowStart,t.bodyRowEnd)}if(t.bottomFrozenGroup&&t.table.bottomFrozenRowCount>0){const i=new Vt({x:0,y:0,width:t.table.getColWidth(n),height:0,clip:!1,pickable:!1});i.role="column",i.col=n;const r=t.getColGroupInBottom(n);r?t.bottomFrozenGroup.insertBefore(i,r):t.bottomFrozenGroup.appendChild(i),e(i,n,t.table.rowCount-t.table.bottomFrozenRowCount,t.table.rowCount-1)}function e(i,r,o,s){for(let a=o;a<=s;a++){const l=new Vt({x:0,y:0,width:t.table.getColWidth(r),height:t.table.getRowHeight(a)});l.role="cell",l.col=r,l.row=a,l.needUpdate=!0,i.appendChild(l)}}}function pht(n){var t,e,i,r;if(!n.options.animationAppear)return;let o,s,a,l;n.options.animationAppear===!0?(o=500,s=0,a="one-by-one",l="column"):(o=(t=n.options.animationAppear.duration)!==null&&t!==void 0?t:500,s=(e=n.options.animationAppear.delay)!==null&&e!==void 0?e:0,a=(i=n.options.animationAppear.type)!==null&&i!==void 0?i:"one-by-one",l=(r=n.options.animationAppear.direction)!==null&&r!==void 0?r:"row");const{scenegraph:h,frozenColCount:u,frozenRowCount:d}=n,{colStart:c,colEnd:g,rowStart:f,rowEnd:p}=h.proxy;for(let m=0;m<=g;m++)for(let v=0;v<=p;v++){const b=h.highPerformanceGetCell(m,v);b&&b.role==="cell"&&b.forEachChildren((y=>{y.setAttribute("opacity",0),y.animate().wait(a==="one-by-one"?(l==="row"?v:m)*(o-s):s).to({opacity:1},o,"linear")}))}}function mht(n,t){const{selectedRangeComponents:e}=t;e.forEach(((i,r)=>{i.rect.setAttributes(n)})),t.updateNextFrame()}sD(),Et.load(Kat),Et.load(vat);let vht=class{constructor(t){let e,i;this._needUpdateContainer=!1,this.table=t,this.hasFrozen=!1,this.clear=!0,this.mergeMap=new Map,XQ(this.table.theme.textPopTipStyle),te.mode==="node"?(Bt.setEnv("node",t.options.modeParams),e=t.canvasWidth,i=t.canvasHeight):t.options.canvas&&t.options.viewBox?(Bt.setEnv("browser"),e=t.options.viewBox.x2-t.options.viewBox.x1,i=t.options.viewBox.y2-t.options.viewBox.y1):(Bt.setEnv("browser"),e=t.canvas.width,i=t.canvas.height),this.stage=XI(Object.assign({canvas:t.canvas,width:e,height:i,disableDirtyBounds:!1,background:t.theme.underlayBackgroundColor,dpr:t.internalProps.pixelRatio,enableLayout:!0,beforeRender:r=>{this.table.options.beforeRender&&this.table.options.beforeRender(r),this.table.animationManager.ticker.start()},afterRender:r=>{this.table.options.afterRender&&this.table.options.afterRender(r),this.table.fireListeners("after_render",null)},canvasControled:!t.options.canvas,viewBox:t.options.viewBox},t.options.renderOption)),this.stage.defaultLayer.setTheme({group:{boundsPadding:0,strokeBoundsBuffer:0,lineJoin:"round"},text:{ignoreBuf:!0}}),this.initSceneGraph(),this.stage.defaultLayer.add(this.tableGroup),this.stage.table=this.table,this.createComponent()}get width(){var t,e;return(e=(t=this.tableGroup.attribute)===null||t===void 0?void 0:t.width)!==null&&e!==void 0?e:0}get height(){var t,e;return(e=(t=this.tableGroup.attribute)===null||t===void 0?void 0:t.height)!==null&&e!==void 0?e:0}get x(){var t,e;return(e=(t=this.tableGroup.attribute)===null||t===void 0?void 0:t.x)!==null&&e!==void 0?e:0}get y(){var t,e;return(e=(t=this.tableGroup.attribute)===null||t===void 0?void 0:t.y)!==null&&e!==void 0?e:0}get bodyRowStart(){var t;return(t=this.proxy.rowStart)!==null&&t!==void 0?t:0}get bodyRowEnd(){var t;return(t=this.proxy.rowEnd)!==null&&t!==void 0?t:this.table.rowCount-1}get bodyColStart(){var t;return(t=this.proxy.colStart)!==null&&t!==void 0?t:0}get bodyColEnd(){var t;return(t=this.proxy.colEnd)!==null&&t!==void 0?t:this.table.colCount-1}initSceneGraph(){this.isPivot=this.table.isPivotTable(),Klt(this)}canvasShowMenu(){this.stage.addEventListener("rightdown",(t=>{const e=Si(t);e.eventArgs||(this.table.stateManager.triggerContextMenu(-1,-1,e.abstractPos.x,e.abstractPos.y),this.table.fireListeners(tt.CONTEXTMENU_CANVAS,{event:t,x:e.abstractPos.x,y:e.abstractPos.y,col:-1,row:-1,target:void 0}))}))}clearCells(){var t,e;this.table.animationManager.clear(),(this.table.isPivotChart()||this.table._hasCustomRenderOrLayout())&&this.stage.pluginService.findPluginsByName("poptipForText").forEach((i=>{i.deactivate(this.stage.pluginService)})),this.clear=!0,this.hasFrozen=!1,this.mergeMap.clear(),this.colHeaderGroup.clear(),delete this.colHeaderGroup.border,this.rowHeaderGroup.clear(),delete this.rowHeaderGroup.border,this.cornerHeaderGroup.clear(),delete this.cornerHeaderGroup.border,this.bodyGroup.clear(),delete this.bodyGroup.border,this.bottomFrozenGroup.clear(),delete this.bottomFrozenGroup.border,this.rightFrozenGroup.clear(),delete this.rightFrozenGroup.border,this.rightTopCornerGroup.clear(),delete this.rightTopCornerGroup.border,this.rightBottomCornerGroup.clear(),delete this.rightBottomCornerGroup.border,this.leftBottomCornerGroup.clear(),delete this.leftBottomCornerGroup.border,this.colHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rowHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.cornerHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.bodyGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rightFrozenGroup.setAttributes({x:0,y:0,width:0,height:0}),this.bottomFrozenGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rightTopCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.leftBottomCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.rightBottomCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.tableGroup.setAttributes({x:this.table.tableX,y:this.table.tableY,width:0,height:0}),this.tableGroup.border&&(this.tableGroup.parent.removeChild(this.tableGroup.border),delete this.tableGroup.border),(t=this.proxy)===null||t===void 0||t.release(),(e=this.table.reactCustomLayout)===null||e===void 0||e.clearCache()}updateStageBackground(){this.stage.background=this.table.theme.underlayBackgroundColor,this.stage.renderNextFrame()}createComponent(){this.component=new Lat(this.table),this.component.addToGroup(this.componentGroup),this.selectedRangeComponents=new Map,this.selectingRangeComponents=new Map,this.customSelectedRangeComponents=new Map}updateComponent(){this.component.updateStyle()}createSceneGraph(t=!1){t||(this.table.rowHeightsMap.clear(),this.table.internalProps.layoutMap.clearCellRangeMap()),(this.table.isPivotChart()||this.table._hasCustomRenderOrLayout())&&this.stage.pluginService.autoEnablePlugins.getContributions().forEach((e=>{e.name==="poptipForText"&&this.stage.pluginService.register(e)})),this.clear=!1,this.frozenColCount=this.table.frozenColCount,this.frozenRowCount=this.table.frozenRowCount,this.proxy=new xlt(this.table),Wr(this.tableGroup,this.table.theme.frameStyle,this.tableGroup.role,void 0,!0),this.table.isPivotChart()&&(LC(this.rightTopCornerGroup,this.table.theme.cornerRightTopCellStyle||this.table.theme.cornerHeaderStyle||{}),LC(this.leftBottomCornerGroup,this.table.theme.cornerLeftBottomCellStyle||this.table.theme.cornerHeaderStyle||{}),LC(this.rightBottomCornerGroup,this.table.theme.cornerRightBottomCellStyle||this.table.theme.cornerHeaderStyle||{})),this.proxy.createGroupForFirstScreen(this.cornerHeaderGroup,this.colHeaderGroup,this.rowHeaderGroup,this.rightFrozenGroup,this.bottomFrozenGroup,this.bodyGroup,0,0),this.afterScenegraphCreated()}renderSceneGraph(){this.stage.render()}getCell(t,e,i){var r,o,s,a,l,h;let u;if(u=this.table.rightFrozenColCount>0&&t>=this.table.colCount-this.table.rightFrozenColCount&&e<this.table.frozenRowCount?(r=this.rightTopCornerGroup.getColGroup(t))===null||r===void 0?void 0:r.getRowGroup(e):this.table.bottomFrozenRowCount>0&&e>=this.table.rowCount-this.table.bottomFrozenRowCount&&t<this.table.frozenColCount?(o=this.leftBottomCornerGroup.getColGroup(t))===null||o===void 0?void 0:o.getRowGroup(e):this.table.rightFrozenColCount>0&&this.table.bottomFrozenRowCount>0&&t>=this.table.colCount-this.table.rightFrozenColCount&&e>=this.table.rowCount-this.table.bottomFrozenRowCount?(s=this.rightBottomCornerGroup.getColGroup(t))===null||s===void 0?void 0:s.getRowGroup(e):this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?(a=this.rightFrozenGroup.getColGroup(t))===null||a===void 0?void 0:a.getRowGroup(e):this.table.bottomFrozenRowCount>0&&e>this.table.rowCount-1-this.table.bottomFrozenRowCount?(l=this.bottomFrozenGroup.getColGroup(t))===null||l===void 0?void 0:l.getRowGroup(e):(h=this.getColGroup(t,e<this.frozenRowCount))===null||h===void 0?void 0:h.getRowGroup(e),u&&u.role==="shadow-cell"&&!i){const d=this.table.getCellRange(t,e);d.start.col===t&&d.start.row===e||(u=this.getCell(d.start.col,d.start.row))}return u||fm}highPerformanceGetCell(t,e,i){return this.proxy.highPerformanceGetCell(t,e,i)}getColGroup(t,e=!1){let i;return i=t<this.frozenColCount&&e?this.cornerHeaderGroup.getColGroup(t):t<this.frozenColCount?this.rowHeaderGroup.getColGroup(t):e&&this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?this.rightTopCornerGroup.getColGroup(t):!e&&this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?this.rightFrozenGroup.getColGroup(t):e?this.colHeaderGroup.getColGroup(t):this.bodyGroup.getColGroup(t),i||void 0}getColGroupInBottom(t,e=!1){var i;if(e){const r=(i=this.getColGroupInLeftBottomCorner(t))!==null&&i!==void 0?i:this.getColGroupInRightBottomCorner(t);if(r)return r}if(this.table.bottomFrozenRowCount>0)return this.bottomFrozenGroup.getColGroup(t)}getColGroupInLeftBottomCorner(t){if(this.table.bottomFrozenRowCount>0)return this.leftBottomCornerGroup.getColGroup(t)}getColGroupInRightTopCorner(t){if(this.table.rightFrozenColCount>0)return this.rightTopCornerGroup.getColGroup(t)}getColGroupInRightBottomCorner(t){if(this.table.rightFrozenColCount>0&&this.table.bottomFrozenRowCount>0)return this.rightBottomCornerGroup.getColGroup(t)}getCellSize(t,e){const i=this.getCell(t,e),r=mi(this.table,t,e);let o=i.attribute.width,s=i.attribute.height;return r&&(o/=r.end.col-r.start.col+1,s/=r.end.row-r.start.row+1),{width:o,height:s}}updateNextFrame(){this.updateContainerSync(),this.resetAllSelectComponent(),this.stage.renderNextFrame()}resetAllSelectComponent(){var t,e,i,r;(((e=(t=this.table.stateManager.select)===null||t===void 0?void 0:t.ranges)===null||e===void 0?void 0:e.length)>0||((r=(i=this.table.stateManager.select)===null||i===void 0?void 0:i.customSelectRanges)===null||r===void 0?void 0:r.length)>0)&&dF(this)}hideHoverIcon(t,e){Zlt(t,e,this)}showHoverIcon(t,e){Jlt(t,e,this)}hideClickIcon(t,e){Qlt(t,e,this)}showClickIcon(t,e){tht(t,e,this)}getIcon(t,e,i,r){return eht(t,e,i,r,this)}setIconHoverStyle(t,e,i,r){iht(t,e,i,r,this)}updateSortIcon(t){const{col:e,row:i,iconMark:r,order:o,oldSortCol:s,oldSortRow:a,oldIconMark:l}=t;sht({col:e,row:i,iconMark:r,order:o,oldSortCol:s,oldSortRow:a,oldIconMark:l,scene:this})}updateFrozenIcon(t,e){aht(this)}updateHierarchyIcon(t,e){lht(t,e,this)}setIconNormalStyle(t,e,i){nht(t,e,i,this)}residentHoverIcon(t,e){hht(t,e,this)}resetResidentHoverIcon(t,e){uht(t,e,this)}deactivateChart(t,e){var i,r;if(t===-1||e===-1)return;const o=this.getCell(t,e);(r=(i=o?.firstChild)===null||i===void 0?void 0:i.deactivate)===null||r===void 0||r.call(i)}activateChart(t,e){var i,r,o;if(t===-1||e===-1)return;const s=this.getCell(t,e);return(r=(i=s?.firstChild)===null||i===void 0?void 0:i.activate)===null||r===void 0||r.call(i,this.table),(o=s?.firstChild)===null||o===void 0?void 0:o.activeChartInstance}removeInteractionBorder(t,e){const i=this.getCell(t,e);i.setAttribute("highlightStroke",void 0),i.setAttribute("highlightStrokeArrayWidth",void 0),i.setAttribute("highlightStrokeArrayColor",void 0)}createCellSelectBorder(t,e,i,r,o,s,a){Alt(this,t,e,i,r,o,s,a)}moveSelectingRangeComponentsToSelectedRangeComponents(){wk(this)}deleteLastSelectedRangeComponents(){Mlt(this)}deleteAllSelectBorder(){xk(this),gF(this)}updateCellSelectBorder(t,e=!0){yk(this,t,e)}removeFillHandleFromSelectComponents(){Tlt(this)}recreateAllSelectRangeComponents(){xk(this),this.table.stateManager.select.ranges.forEach((t=>{yk(this,t),wk(this)}))}updateColWidth(t,e,i,r){Rat(this,t,Math.round(e),r),i||this.updateContainer({async:!0})}updateChartSizeForResizeColWidth(t){Xlt(this,t)}updateChartSizeForResizeRowHeight(t){Ylt(this,t)}updateChartState(t){this.table.isPivotChart()&&qlt(this,t)}updateCheckboxCellState(t,e,i){var r,o;if(this.table.transpose)(r=this.bodyGroup.children)===null||r===void 0||r.forEach((s=>{var a;(a=s.getChildAt(e))===null||a===void 0||a.getChildren().forEach((l=>{l.name==="checkbox"&&(i==="indeterminate"?(l.setAttribute("indeterminate",!0),l.setAttribute("checked",void 0)):(l.setAttribute("indeterminate",void 0),l.setAttribute("checked",i))),l.name==="checkbox-content"&&(i==="indeterminate"?(l._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",!0),l._checkboxGroup.getChildByName("checkbox").setAttribute("checked",void 0)):(l._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",void 0),l._checkboxGroup.getChildByName("checkbox").setAttribute("checked",i)))}))}));else{const s=this.getColGroup(t);(o=s?.children)===null||o===void 0||o.forEach((a=>{a.getChildren().find((l=>{l.name==="checkbox"&&(i==="indeterminate"?(l.setAttribute("indeterminate",!0),l.setAttribute("checked",void 0)):(l.setAttribute("indeterminate",void 0),l.setAttribute("checked",i))),l.name==="checkbox-content"&&(i==="indeterminate"?(l._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",!0),l._checkboxGroup.getChildByName("checkbox").setAttribute("checked",void 0)):(l._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",void 0),l._checkboxGroup.getChildByName("checkbox").setAttribute("checked",i)))}))}))}}updateHeaderCheckboxCellState(t,e,i){var r,o;this.table.transpose?(r=this.rowHeaderGroup.children)===null||r===void 0||r.forEach((s=>{s.getChildAt(e).getChildren().forEach((a=>{a.name==="checkbox"&&(i==="indeterminate"?(a.setAttribute("indeterminate",!0),a.setAttribute("checked",void 0)):(a.setAttribute("indeterminate",void 0),a.setAttribute("checked",i))),a.name==="checkbox-content"&&(i==="indeterminate"?(a._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",!0),a._checkboxGroup.getChildByName("checkbox").setAttribute("checked",void 0)):(a._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",void 0),a._checkboxGroup.getChildByName("checkbox").setAttribute("checked",i)))}))})):(o=this.getColGroup(t,!0).children)===null||o===void 0||o.forEach((s=>{s.getChildren().find((a=>{a.name==="checkbox"&&(i==="indeterminate"?(a.setAttribute("indeterminate",!0),a.setAttribute("checked",void 0)):(a.setAttribute("indeterminate",void 0),a.setAttribute("checked",i))),a.name==="checkbox-content"&&(i==="indeterminate"?(a._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",!0),a._checkboxGroup.getChildByName("checkbox").setAttribute("checked",void 0)):(a._checkboxGroup.getChildByName("checkbox").setAttribute("indeterminate",void 0),a._checkboxGroup.getChildByName("checkbox").setAttribute("checked",i)))}))}))}updateAutoColWidth(t){this.table.internalProps._widthResizedColMap.delete(t);const e=this.table.getColWidth(t),i=Nh(t,0,this.table.rowCount-1,this.table,!0);i!==e&&this.updateColWidth(t,i-e)}recalculateColWidths(){const t=this.table;t.widthMode==="adaptive"||t.autoFillWidth||t.internalProps.transpose?Or(this.table,0,this.table.colCount-1,!0):(t._clearColRangeWidthsMap(),t.frozenColCount>0&&Or(this.table,0,t.frozenColCount-1,!0),t.rightFrozenColCount>0&&Or(this.table,t.rightFrozenColCount,t.colCount-1,!0),Or(t,this.proxy.colStart,this.proxy.colEnd,!0))}recalculateRowHeights(){const t=this.table;t.internalProps.useOneRowHeightFillAll=!1,t.heightMode==="adaptive"||t.autoFillHeight?Lr(this.table,0,this.table.rowCount-1,!0,!0):(t.frozenRowCount>0&&Lr(this.table,0,t.frozenRowCount-1,!0,!0),t.bottomFrozenRowCount>0&&Lr(this.table,t.bottomFrozenRowCount,t.rowCount-1,!0,!0),Lr(t,this.proxy.rowStart,this.proxy.rowEnd,!0,!0))}resize(){var t,e;this.proxy.resize(),(this.table.widthMode==="adaptive"||this.table.autoFillWidth)&&(this.table.internalProps._widthResizedColMap.size===0?this.recalculateColWidths():this.dealWidthMode()),this.table.heightMode==="adaptive"?this.table.internalProps._heightResizedRowMap.size===0?this.recalculateRowHeights():this.dealHeightMode():this.table.autoFillHeight&&this.dealHeightMode(),this.resetFrozen(),this.updateTableSize(),this.updateBorderSizeAndPosition(),this.component.updateScrollBar(),(this.table.widthMode==="adaptive"||this.table.heightMode==="adaptive"||this.table.autoFillWidth||this.table.autoFillHeight||!((t=this.table.containerFit)===null||t===void 0)&&t.width||!((e=this.table.containerFit)===null||e===void 0)&&e.height)&&this.updateChartSizeForResizeColWidth(-1),this.proxy.progress(),this.updateNextFrame()}updateTableSize(){var t,e,i,r,o,s,a,l,h,u,d,c,g,f,p;const m=Math.max(this.colHeaderGroup.attribute.width,this.bodyGroup.attribute.width,this.bottomFrozenGroup.attribute.width,0)+Math.max(this.cornerHeaderGroup.attribute.width,this.rowHeaderGroup.attribute.width,this.leftBottomCornerGroup.attribute.width,0)+Math.max(this.rightTopCornerGroup.attribute.width,this.rightFrozenGroup.attribute.width,this.rightBottomCornerGroup.attribute.width,0),v=Math.max(this.colHeaderGroup.attribute.height,this.cornerHeaderGroup.attribute.height,this.rightTopCornerGroup.attribute.height,0)+Math.max(this.rowHeaderGroup.attribute.height,this.bodyGroup.attribute.height,this.rightFrozenGroup.attribute.height,0)+Math.max(this.leftBottomCornerGroup.attribute.height,this.bottomFrozenGroup.attribute.height,this.rightBottomCornerGroup.attribute.height,0);let b=m,y=v;if(b=!((t=this.table.containerFit)===null||t===void 0)&&t.width?this.table.tableNoFrameWidth:Math.min(this.table.tableNoFrameWidth,m),y=!((e=this.table.containerFit)===null||e===void 0)&&e.height?this.table.tableNoFrameHeight:Math.min(this.table.tableNoFrameHeight,v),this.tableGroup.setAttributes({x:this.table.tableX,y:this.table.tableY,width:b,height:y}),this.tableGroup.border){const C=(i=this.tableGroup.border)===null||i===void 0?void 0:i.attribute;let w,_,A,x;C?.strokeArrayWidth?(w=C.strokeArrayWidth?C.strokeArrayWidth[0]:(r=C.lineWidth)!==null&&r!==void 0?r:0,_=C.strokeArrayWidth?C.strokeArrayWidth[1]:(o=C.lineWidth)!==null&&o!==void 0?o:0,A=C.strokeArrayWidth?C.strokeArrayWidth[2]:(s=C.lineWidth)!==null&&s!==void 0?s:0,x=C.strokeArrayWidth?C.strokeArrayWidth[3]:(a=C.lineWidth)!==null&&a!==void 0?a:0):(w=(l=C?.lineWidth)!==null&&l!==void 0?l:0,_=(h=C?.lineWidth)!==null&&h!==void 0?h:0,A=(u=C?.lineWidth)!==null&&u!==void 0?u:0,x=(d=C?.lineWidth)!==null&&d!==void 0?d:0),this.tableGroup.border.type==="rect"?!((c=this.table.theme.frameStyle)===null||c===void 0)&&c.innerBorder?this.tableGroup.border.setAttributes({x:this.table.tableX+x/2,y:this.table.tableY+w/2,width:this.tableGroup.attribute.width-x/2-_/2,height:this.tableGroup.attribute.height-w/2-A/2}):this.tableGroup.border.setAttributes({x:this.table.tableX-x/2,y:this.table.tableY-w/2,width:this.tableGroup.attribute.width+x/2+_/2,height:this.tableGroup.attribute.height+w/2+A/2}):this.tableGroup.border.type==="group"&&(!((g=this.table.theme.frameStyle)===null||g===void 0)&&g.innerBorder?(this.tableGroup.border.setAttributes({x:this.table.tableX+x/2,y:this.table.tableY+w/2,width:this.tableGroup.attribute.width-x/2-_/2,height:this.tableGroup.attribute.height-w/2-A/2}),(f=this.tableGroup.border.firstChild)===null||f===void 0||f.setAttributes({x:0,y:0,width:this.tableGroup.attribute.width-x/2-_/2,height:this.tableGroup.attribute.height-w/2-A/2})):(this.tableGroup.border.setAttributes({x:this.table.tableX-x/2,y:this.table.tableY-w/2,width:this.tableGroup.attribute.width+x/2+_/2,height:this.tableGroup.attribute.height+w/2+A/2}),(p=this.tableGroup.border.firstChild)===null||p===void 0||p.setAttributes({x:x/2,y:w/2,width:this.tableGroup.attribute.width,height:this.tableGroup.attribute.height})))}this.table.bottomFrozenRowCount>0&&(this.bottomFrozenGroup.setAttribute("y",this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight()),this.leftBottomCornerGroup.setAttributes({visible:!0,y:this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight(),height:this.table.getBottomFrozenRowsHeight(),width:this.table.getFrozenColsWidth()}),this.rightBottomCornerGroup.setAttributes({visible:!0,y:this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight(),height:this.table.getBottomFrozenRowsHeight()})),this.table.rightFrozenColCount>0&&(this.rightFrozenGroup.setAttribute("x",this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth()),this.rightTopCornerGroup.setAttributes({visible:!0,x:this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth(),width:this.table.getRightFrozenColsWidth(),height:this.table.getFrozenRowsHeight()}),this.rightBottomCornerGroup.setAttributes({visible:!0,x:this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth(),width:this.table.getRightFrozenColsWidth()})),this.updateDomContainer()}updateRowHeight(t,e,i){e=Math.round(e),Q2(this,t,e,i),this.updateContainerHeight(t,e)}updateRowsHeight(t,e,i){for(let r=0;r<t.length;r++){const o=t[r];if(o>=this.proxy.rowStart&&o<=this.proxy.rowEnd){const s=e[r];Q2(this,o,Math.round(s),i),this._updateContainerHeight(o,s)}}this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}updateContainerWidth(t,e){t<this.frozenColCount?(this.rowHeaderGroup.setDeltaWidth(e),this.cornerHeaderGroup.setDeltaWidth(e),this.colHeaderGroup.setDeltaX(e),this.bodyGroup.setDeltaX(e)):(this.colHeaderGroup.setDeltaWidth(e),this.bodyGroup.setDeltaWidth(e)),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}_updateContainerHeight(t,e){t<this.table.frozenRowCount?(this.colHeaderGroup.setDeltaHeight(e),this.cornerHeaderGroup.setDeltaHeight(e),this.rowHeaderGroup.setDeltaY(e),this.bodyGroup.setDeltaY(e),this.table.rightFrozenColCount&&this.rightFrozenGroup.setDeltaY(e)):t>=this.table.rowCount-this.table.bottomFrozenRowCount?(this.leftBottomCornerGroup.setDeltaHeight(e),this.bottomFrozenGroup.setDeltaHeight(e),this.table.rightFrozenColCount&&this.rightBottomCornerGroup.setDeltaHeight(e)):(this.rowHeaderGroup.setDeltaHeight(e),this.bodyGroup.setDeltaHeight(e),this.table.rightFrozenColCount&&this.rightFrozenGroup.setDeltaHeight(e))}updateContainerHeight(t,e){this._updateContainerHeight(t,e),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}setColWidth(t,e){const i=this.table.getColWidth(t);i!==e&&(this.updateColWidth(t,e-i),this.table._clearColRangeWidthsMap(t))}setRowHeight(t,e){const i=this.table.getRowHeight(t);i!==e&&((t>=this.proxy.rowStart&&t<=this.proxy.rowEnd||t>=this.table.rowCount-this.table.bottomFrozenRowCount&&t<=this.table.rowCount-1||t<this.table.frozenRowCount)&&this.updateRowHeight(t,e-i),this.table._clearRowRangeHeightsMap(t))}setX(t,e=!1){this.table.scenegraph.proxy.setX(-t,e)}setY(t,e=!1){this.table.scenegraph.proxy.setY(-t,e)}setBodyAndRowHeaderY(t){var e,i,r,o,s,a;const l=(i=(e=this.bodyGroup.firstChild)===null||e===void 0?void 0:e.firstChild)!==null&&i!==void 0?i:(r=this.rowHeaderGroup.firstChild)===null||r===void 0?void 0:r.firstChild,h=(s=(o=this.bodyGroup.firstChild)===null||o===void 0?void 0:o.lastChild)!==null&&s!==void 0?s:(a=this.rowHeaderGroup.firstChild)===null||a===void 0?void 0:a.lastChild;t===0&&l&&l.row===this.table.frozenRowCount&&l.attribute.y+t<0?t=-l.attribute.y:h&&this.table.tableNoFrameHeight<this.table.getAllRowsHeight()&&h.row===this.table.rowCount-this.table.bottomFrozenRowCount-1&&h.attribute.y+h.attribute.height+t<this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()&&(t=this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()-h.attribute.y-h.attribute.height),this.colHeaderGroup.attribute.height+t!==this.bodyGroup.attribute.y&&(this.bodyGroup.setAttribute("y",this.colHeaderGroup.attribute.height+t),this.rowHeaderGroup.setAttribute("y",this.cornerHeaderGroup.attribute.height+t),this.table.rightFrozenColCount>0&&this.rightFrozenGroup.setAttribute("y",this.rightTopCornerGroup.attribute.height+t),this.updateNextFrame())}setBodyAndColHeaderX(t){const e=this.bodyGroup.firstChild,i=this.bodyGroup.lastChild;t===0&&e&&e.col===this.table.frozenColCount&&e.attribute.x+t<0?t=-e.attribute.x:i&&this.table.tableNoFrameWidth<this.table.getAllColsWidth()&&i.col===this.table.colCount-this.table.rightFrozenColCount-1&&i.attribute.x+i.attribute.width+t<this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()&&(t=this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()-i.attribute.x-i.attribute.width),this.table.getFrozenColsWidth()+t!==this.bodyGroup.attribute.x&&(this.bodyGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.colHeaderGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.table.bottomFrozenRowCount>0&&this.bottomFrozenGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.updateNextFrame())}afterScenegraphCreated(){var t;this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount?this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):this.component.setFrozenColumnShadow(-1):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.table.stateManager.checkFrozen(),this.updateContainer(),this.createFrameBorder(),this.updateBorderSizeAndPosition(),this.component.updateScrollBar(),tc(this.table),this.table.options.animationAppear&&pht(this.table),((t=this.table.options.menu)===null||t===void 0?void 0:t.contextMenuWorkOnlyCell)===!1&&this.canvasShowMenu(),this.updateNextFrame()}dealWidthMode(){const t=this.table;if(t.widthMode==="adaptive"){t._clearColRangeWidthsMap();const s=t.tableNoFrameWidth;let a=0,l=0,h=t.colCount;if(t.widthAdaptiveMode==="only-body"){for(let u=0;u<t.colCount;u++)(u<t.rowHeaderLevelCount||t.isPivotChart()&&u>=t.colCount-t.rightFrozenColCount)&&(a+=t.getColWidth(u));l=t.rowHeaderLevelCount,h=t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount}gm(s-a,l,h,!1,[],t,!0)}else if(t.autoFillWidth){t._clearColRangeWidthsMap();const s=t.tableNoFrameWidth;let a=0,l=0;for(let h=0;h<t.colCount;h++){const u=t.getColWidth(h);(h<t.rowHeaderLevelCount||t.isPivotChart()&&h>=t.colCount-t.rightFrozenColCount)&&(a+=u),l+=u}if(l<s&&l>a){const h=t.rowHeaderLevelCount,u=t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount;gm(s-a,h,u,!1,[],t,!0)}}let e=0;this.bodyGroup.forEachChildrenSkipChild((s=>{e+=s.attribute.width})),this.bodyGroup.setAttribute("width",e);let i=0;this.colHeaderGroup.forEachChildrenSkipChild((s=>{i+=s.attribute.width})),this.colHeaderGroup.setAttribute("width",i);let r=0;this.rowHeaderGroup.forEachChildrenSkipChild((s=>{r+=s.attribute.width})),this.rowHeaderGroup.setAttribute("width",r);let o=0;this.cornerHeaderGroup.forEachChildrenSkipChild((s=>{o+=s.attribute.width})),this.cornerHeaderGroup.setAttribute("width",o),this.colHeaderGroup.setAttribute("x",this.cornerHeaderGroup.attribute.width),this.rowHeaderGroup.setAttribute("y",this.cornerHeaderGroup.attribute.height),this.bodyGroup.setAttributes({x:this.rowHeaderGroup.attribute.width,y:this.colHeaderGroup.attribute.height})}dealHeightMode(){var t;const e=this.table;if(e.heightMode==="adaptive"){e._clearRowRangeHeightsMap();const i=e.getRowsHeight(0,e.columnHeaderLevelCount-1),r=e.isPivotChart()?e.getBottomFrozenRowsHeight():0,o=e.tableNoFrameHeight-i-r,s=e.columnHeaderLevelCount,a=e.isPivotChart()?e.rowCount-e.bottomFrozenRowCount:e.rowCount;let l=0;for(let u=s;u<a;u++)l+=e.getRowHeight(u);const h=o/l;for(let u=s;u<a;u++){let d;d=u===a-1?o-e.getRowsHeight(s,a-2):Math.round(e.getRowHeight(u)*h),this.setRowHeight(u,d)}}else if(e.autoFillHeight){e._clearRowRangeHeightsMap();const i=e.tableNoFrameHeight;let r=0,o=0;for(let s=0;s<e.rowCount;s++){const a=e.getRowHeight(s);(s<e.columnHeaderLevelCount||e.isPivotChart()&&s>=e.rowCount-e.bottomFrozenRowCount)&&(o+=a),r+=a}if(((t=this._dealAutoFillHeightOriginRowsHeight)!==null&&t!==void 0?t:r)<i&&r-o>0){const s=e.columnHeaderLevelCount,a=e.isPivotChart()?e.rowCount-e.bottomFrozenRowCount:e.rowCount,l=(i-o)/(r-o);for(let h=s;h<a;h++){let u;u=h===a-1?i-o-e.getRowsHeight(s,a-2):Math.round(e.getRowHeight(h)*l),this.setRowHeight(h,u)}}}}dealFrozen(){Hlt(this)}resetFrozen(){Dlt(this)}resetRowFrozen(){Nlt(this)}updateCellLayoutWidthCertainWidth(t,e,i){const r=t.attribute.width;let o=!1;return t.forEachChildren(((s,a)=>{a+=e;const l=mi(this.table,i,a);l?s=this.getCell(l.start.col,l.start.row):s.setAttribute("width",r);const h=this.table._getCellStyle(i,a),u=Kt(ht("padding",h,i,a,this.table)),d=s.getChildByName("text");let c=0,g=0;if(d)c=d.AABBBounds.height()+(u[0]+u[2]),d.setAttribute("maxLineWidth",r-(u[1]+u[3])),g=d.AABBBounds.height()+(u[0]+u[2]);else{const p=s.getChildAt(1);c=p.AABBBounds.height()+(u[0]+u[2]),p._cellWidth=r-(u[1]+u[3]),p.layout(),g=p.AABBBounds.height()+(u[0]+u[2])}const f=this.table.getRowHeight(a);s.attribute.height!==g&&(s.setAttribute("height",g),(f===c||g>f)&&(o=!0))})),o}updateHeaderPosition(t,e,i,r,o){Slt(t,e,i,r,o,this.table)}updateContainerAttrWidthAndX(){var t,e,i;const r=is(this.cornerHeaderGroup,0),o=is(this.rowHeaderGroup,0),s=this.colHeaderGroup.hasChildNodes()&&this.colHeaderGroup.firstChild?is(this.colHeaderGroup,this.colHeaderGroup.firstChild.col>0?this.table.getColsWidth((t=this.table.frozenColCount)!==null&&t!==void 0?t:0,this.colHeaderGroup.firstChild.col-1):0):0,a=this.bodyGroup.hasChildNodes()&&this.bodyGroup.firstChild?is(this.bodyGroup,this.bodyGroup.firstChild.col>0?this.table.getColsWidth((e=this.table.frozenColCount)!==null&&e!==void 0?e:0,this.bodyGroup.firstChild.col-1):0):0,l=is(this.rightFrozenGroup.childrenCount>0?this.rightFrozenGroup:this.rightTopCornerGroup,0);this.bottomFrozenGroup.hasChildNodes()&&this.bottomFrozenGroup.firstChild&&is(this.bottomFrozenGroup,this.bottomFrozenGroup.firstChild.col>0?this.table.getColsWidth((i=this.table.frozenColCount)!==null&&i!==void 0?i:0,this.bottomFrozenGroup.firstChild.col-1):0),is(this.leftBottomCornerGroup,0),is(this.rightTopCornerGroup,0),is(this.rightBottomCornerGroup,0),this.cornerHeaderGroup.setDeltaWidth(r-this.cornerHeaderGroup.attribute.width),this.leftBottomCornerGroup.setDeltaWidth(r-this.leftBottomCornerGroup.attribute.width),this.colHeaderGroup.setDeltaWidth(s-this.colHeaderGroup.attribute.width),this.rowHeaderGroup.setDeltaWidth(o-this.rowHeaderGroup.attribute.width),this.bottomFrozenGroup.setDeltaWidth(s-this.bottomFrozenGroup.attribute.width),this.rightFrozenGroup.setDeltaWidth(l-this.rightFrozenGroup.attribute.width),this.rightTopCornerGroup.setDeltaWidth(l-this.rightTopCornerGroup.attribute.width),this.rightBottomCornerGroup.setDeltaWidth(l-this.rightBottomCornerGroup.attribute.width),this.bodyGroup.setDeltaWidth(a-this.bodyGroup.attribute.width),this.colHeaderGroup.setAttribute("x",this.cornerHeaderGroup.attribute.width),this.bottomFrozenGroup.setAttribute("x",this.table.getFrozenColsWidth()),this.bodyGroup.setAttribute("x",this.rowHeaderGroup.attribute.width)}updateContainerAttrHeightAndY(){var t,e,i;for(let r=0;r<this.cornerHeaderGroup.children.length;r++)ns(this.cornerHeaderGroup.children[r],0);for(let r=0;r<this.colHeaderGroup.children.length;r++)ns(this.colHeaderGroup.children[r],0);for(let r=0;r<this.rightTopCornerGroup.children.length;r++)ns(this.rightTopCornerGroup.children[r],0);for(let r=0;r<this.rowHeaderGroup.children.length;r++)this.rowHeaderGroup.children[r].firstChild&&ns(this.rowHeaderGroup.children[r],this.rowHeaderGroup.children[r].firstChild.row>0?this.table.getRowsHeight((t=this.table.frozenRowCount)!==null&&t!==void 0?t:0,this.rowHeaderGroup.children[r].firstChild.row-1):0);for(let r=0;r<this.bodyGroup.children.length;r++)this.bodyGroup.children[r].firstChild&&ns(this.bodyGroup.children[r],this.bodyGroup.children[r].firstChild.row>0?this.table.getRowsHeight((e=this.table.frozenRowCount)!==null&&e!==void 0?e:0,this.bodyGroup.children[r].firstChild.row-1):0);for(let r=0;r<this.rightFrozenGroup.children.length;r++)this.rightFrozenGroup.children[r].firstChild&&ns(this.rightFrozenGroup.children[r],this.rightFrozenGroup.children[r].firstChild.row>0?this.table.getRowsHeight((i=this.table.frozenRowCount)!==null&&i!==void 0?i:0,this.rightFrozenGroup.children[r].firstChild.row-1):0);for(let r=0;r<this.leftBottomCornerGroup.children.length;r++)ns(this.leftBottomCornerGroup.children[r],0);for(let r=0;r<this.bottomFrozenGroup.children.length;r++)ns(this.bottomFrozenGroup.children[r],0);for(let r=0;r<this.rightBottomCornerGroup.children.length;r++)ns(this.rightBottomCornerGroup.children[r],0)}updateContainer(t={async:!1,needUpdateCellY:!1}){var e;t.async?this._needUpdateContainer||(this._needUpdateContainer=!0,setTimeout((()=>{var i;this.updateContainerSync((i=t.needUpdateCellY)!==null&&i!==void 0&&i)}),0)):(this._needUpdateContainer=!0,this.updateContainerSync((e=t.needUpdateCellY)!==null&&e!==void 0&&e))}updateContainerSync(t=!1){this._needUpdateContainer&&(this._needUpdateContainer=!1,this.updateContainerAttrWidthAndX(),t&&this.updateContainerAttrHeightAndY(),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame())}updateCellContentWhileResize(t,e){var i;const r=!((i=this.table.getCellRawRecord(t,e))===null||i===void 0)&&i.vtableMerge?"text":this.table.isHeader(t,e)?this.table._getHeaderLayoutMap(t,e).headerType:this.table.getBodyColumnType(t,e),o=this.getCell(t,e);r!=="image"&&r!=="video"||$c(o,t,e,0,0,this.table)}createFrameBorder(){var t,e,i,r,o;this.updateTableSize();const s=!this.isPivot&&!this.table.internalProps.transpose;Wr(this.bodyGroup,this.table.theme.bodyStyle.frameStyle,this.bodyGroup.role,s?[!0,!0,!0,!1]:void 0),Wr(this.rowHeaderGroup,this.isPivot||this.table.internalProps.transpose?this.table.theme.rowHeaderStyle.frameStyle:this.table.theme.bodyStyle.frameStyle,this.rowHeaderGroup.role,s?[!0,!1,!0,!0]:void 0),Wr(this.colHeaderGroup,this.table.theme.headerStyle.frameStyle,this.colHeaderGroup.role,s?[!0,!0,!0,!1]:void 0),Wr(this.cornerHeaderGroup,this.isPivot?this.table.theme.cornerHeaderStyle.frameStyle:this.table.theme.headerStyle.frameStyle,this.cornerHeaderGroup.role,s?[!0,!1,!0,!0]:void 0),!((t=this.table.theme.cornerLeftBottomCellStyle)===null||t===void 0)&&t.frameStyle&&Wr(this.leftBottomCornerGroup,this.table.theme.cornerLeftBottomCellStyle.frameStyle,this.leftBottomCornerGroup.role,s?[!0,!1,!0,!0]:void 0),!((e=this.table.theme.bottomFrozenStyle)===null||e===void 0)&&e.frameStyle&&Wr(this.bottomFrozenGroup,this.table.theme.bottomFrozenStyle.frameStyle,this.bottomFrozenGroup.role,s?[!0,!0,!0,!1]:void 0),!((i=this.table.theme.rightFrozenStyle)===null||i===void 0)&&i.frameStyle&&Wr(this.rightFrozenGroup,this.table.theme.rightFrozenStyle.frameStyle,this.rightFrozenGroup.role,void 0),!((r=this.table.theme.cornerRightTopCellStyle)===null||r===void 0)&&r.frameStyle&&Wr(this.rightTopCornerGroup,this.table.theme.cornerRightTopCellStyle.frameStyle,this.rightTopCornerGroup.role,void 0),!((o=this.table.theme.cornerRightBottomCellStyle)===null||o===void 0)&&o.frameStyle&&Wr(this.rightBottomCornerGroup,this.table.theme.cornerRightBottomCellStyle.frameStyle,this.rightBottomCornerGroup.role,void 0),Wr(this.tableGroup,this.table.theme.frameStyle,this.tableGroup.role,void 0)}getResizeColAt(t,e,i){const r=this.table.theme.columnResize.resizeHotSpotSize/2;let o;if(!i){const s=this.table.getDrawRange();return e>=s.top&&e<=s.bottom&&(o=this.table.getCellAtRelativePosition(t-r,e),o.col===this.table.colCount-1)?o:{col:-1,row:-1}}return i.stage?(t<i.globalAABBBounds.x1+r?o={col:i.col-1,row:i.row,x:i.globalAABBBounds.x1}:i.globalAABBBounds.x2-r<t&&(o={col:i.col,row:i.row,x:i.globalAABBBounds.x2}),o&&this.table.rightFrozenColCount>0&&o.col>=this.table.colCount-this.table.rightFrozenColCount-1&&this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()+this.table.scrollLeft<this.bodyGroup.attribute.width&&(o.col=o.col+1,o.rightFrozen=!0),o||{col:-1,row:-1}):{col:-1,row:-1}}getResizeRowAt(t,e,i){const r=this.table.theme.columnResize.resizeHotSpotSize/2;if(i){let o;if(e<i.globalAABBBounds.y1+r?o={col:i.col,row:i.row-1,y:i.globalAABBBounds.y1}:i.globalAABBBounds.y2-r<e&&(o={col:i.col,row:i.row,y:i.globalAABBBounds.y2}),o&&this.table.bottomFrozenRowCount>0&&o.row>=this.table.rowCount-this.table.bottomFrozenRowCount-1&&this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()+this.table.scrollTop<this.bodyGroup.attribute.height&&(o.row=o.row+1,o.bottomFrozen=!0),o)return o}return{col:-1,row:-1}}updateFrozen(){this.clear||(this.resetFrozen(),this.component.updateScrollBar())}updateRowFrozen(){this.clear||(this.resetRowFrozen(),this.component.updateScrollBar())}dealWidthRightFrozen(t){this.clear?this.table.internalProps.rightFrozenColCount=t:Flt(t,this)}dealWidthBottomFrozen(t){this.clear?this.table.internalProps.bottomFrozenRowCount=t:zlt(t,this)}updateBorderSizeAndPosition(){this.bodyGroup.border&&(this.bodyGroup.appendChild(this.bodyGroup.border),ts(this.bodyGroup),this.rowHeaderGroup.attribute.width,rk(this.bodyGroup,this.table.theme.bodyStyle.frameStyle)),this.colHeaderGroup.border&&(this.colHeaderGroup.appendChild(this.colHeaderGroup.border),ts(this.colHeaderGroup),this.cornerHeaderGroup.attribute.width,rk(this.colHeaderGroup,this.table.theme.headerStyle.frameStyle)),this.rowHeaderGroup.border&&(this.rowHeaderGroup.appendChild(this.rowHeaderGroup.border),ts(this.rowHeaderGroup)),this.cornerHeaderGroup.border&&(this.cornerHeaderGroup.appendChild(this.cornerHeaderGroup.border),ts(this.cornerHeaderGroup)),this.leftBottomCornerGroup.border&&(this.leftBottomCornerGroup.appendChild(this.leftBottomCornerGroup.border),ts(this.leftBottomCornerGroup)),this.bottomFrozenGroup.border&&(this.bottomFrozenGroup.appendChild(this.bottomFrozenGroup.border),ts(this.bottomFrozenGroup)),this.rightFrozenGroup.border&&(this.rightFrozenGroup.appendChild(this.rightFrozenGroup.border),ts(this.rightFrozenGroup)),this.rightTopCornerGroup.border&&(this.rightTopCornerGroup.appendChild(this.rightTopCornerGroup.border),ts(this.rightTopCornerGroup)),this.rightBottomCornerGroup.border&&(this.rightBottomCornerGroup.appendChild(this.rightBottomCornerGroup.border),ts(this.rightBottomCornerGroup)),Oat(this.table)}sortCell(){this.isPivot||(this.table.transpose?this.proxy.sortCellHorizontal():this.proxy.sortCellVertical())}getCellOverflowText(t,e){const i=this.getCell(t,e).getChildByName("text",!0);if(i&&i.type==="text"){if(i.attribute.moreThanMaxCharacters)return this.table.getCellValue(t,e);if(i.cliped)return this.table.getCellValue(t,e)}else if(i&&i.type==="richtext"){const r=i;if(r.attribute.ellipsis&&r._frameCache&&r.attribute.height<r._frameCache.actualHeight)return r.attribute.textConfig.find((o=>o.text)),this.table.getCellValue(t,e)}return null}updateDrill(t,e,i,r,o){this.component.drillIcon.update(t,e,i,r,o,this)}updateCellContent(t,e,i=!1){if(!this.clear)return Er(t,e,this.table,void 0,void 0,i)}setPixelRatio(t){this.stage.disableDirtyBounds(),this.stage.window.setDpr(t),this.stage.render(),this.stage.enableDirtyBounds()}updateRow(t,e,i=[],r=!0,o){this.table.internalProps.layoutMap.clearCellRangeMap(),this.table.internalProps.useOneRowHeightFillAll=!1;const s=Xd(e.map((h=>h.row))).sort(((h,u)=>h-u)),a=Xd(i.map((h=>h.row))).sort(((h,u)=>h-u)),l=this.table.getAllRowsHeight()-[...s,...a].reduce(((h,u)=>h+this.table.getRowHeight(u)),0)<=this.table.tableNoFrameHeight;if(Rlt(t,e,i,this.table,o),r&&this.recalculateColWidths(),this.table.heightMode==="adaptive"||this.table.autoFillHeight&&(this.table.getAllRowsHeight()<=this.table.tableNoFrameHeight||l))this.table.scenegraph.recalculateRowHeights();else if(this.table.isAutoRowHeight(this.table.columnHeaderLevelCount))for(let h=0;h<a.length;h++){const u=a[h],d=this.table.rowHeightsMap.get(u),c=Ar(u,0,this.table.colCount-1,this.table);(u>=this.proxy.rowStart&&u<=this.proxy.rowEnd||u>=this.table.rowCount-this.table.bottomFrozenRowCount&&u<=this.table.rowCount-1)&&this.table.scenegraph.updateRowHeight(u,c-d)}this.table.stateManager.checkFrozen(),this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount&&this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.component.updateScrollBar(),this.updateNextFrame()}updateCol(t,e,i=[]){dht(t,e,i,this.table),this.recalculateColWidths(),this.recalculateRowHeights(),this.table.stateManager.checkFrozen(),this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount&&this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.component.updateScrollBar(),this.updateNextFrame()}updateCornerHeaderCells(){for(let t=0;t<this.table.frozenColCount;t++)for(let e=0;e<this.table.frozenRowCount;e++)Er(t,e,this.table,!1)}updateRowHeaderCells(){for(let t=0;t<this.table.frozenColCount;t++)for(let e=this.table.frozenRowCount;e<this.table.rowCount;e++)Er(t,e,this.table,!1)}updateColumnHeaderCells(){for(let t=0;t<this.table.frozenRowCount;t++)for(let e=this.table.frozenColCount;e<this.table.colCount;e++)Er(e,t,this.table,!1)}getColumnGroupX(t){return t<this.table.rowHeaderLevelCount?this.table.getColsWidth(0,t-1):t<this.table.colCount-this.table.rightFrozenColCount?this.table.getColsWidth(this.table.rowHeaderLevelCount,t-1):t<this.table.colCount?this.table.getColsWidth(this.table.colCount-this.table.bottomFrozenRowCount,t-1):0}getCellGroupY(t){return t<this.table.frozenRowCount?this.table.getRowsHeight(0,t-1):t<this.table.rowCount-this.table.bottomFrozenRowCount?this.table.getRowsHeight(this.table.columnHeaderLevelCount,t-1):t<this.table.rowCount?this.table.getRowsHeight(this.table.rowCount-this.table.bottomFrozenRowCount,t-1):0}getCellGroupX(t){return t<this.table.rowHeaderLevelCount?this.table.getColsWidth(0,t-1):t<this.table.colCount-this.table.rightFrozenColCount?this.table.getColsWidth(this.table.rowHeaderLevelCount,t-1):t<this.table.colCount?this.table.getColsWidth(this.table.colCount-this.table.rightFrozenColCount,t-1):0}updateDomContainer(){Ilt(this.table)}setLoadingHierarchyState(t,e){const i=this.getCell(t,e),r=i.getChildByName("collapse",!0)||i.getChildByName("expand",!0);if(r){const o=Fr()[on.loadingIconName];o&&or(o,r,t,e)}}temporarilyUpdateSelectRectStyle(t){mht(t,this)}resetSelectRectStyle(){this.recreateAllSelectRangeComponents()}};function bht(n,t,e){for(let i=0;i<e.length;i++){const r=e[i];if(Ir(r,n,t))return!0}return!1}function yht(n,t,e,i){for(let r=0;r<e.length;r++){const o=e[r];if(Nrt(o,{start:n,end:t}))return!0}return!1}function Gu(n,t,e){const i=n.highPerformanceGetCell(t,e);if(i.role==="cell"&&$(i.mergeStartCol)&&$(i.mergeStartRow)&&$(i.mergeEndCol)&&$(i.mergeEndRow)){const{colStart:r,colEnd:o,rowStart:s,rowEnd:a}=ka(i,n);for(let l=r;l<=o;l++)for(let h=s;h<=a;h++){const u=n.highPerformanceGetCell(l,h);u.role==="cell"&&u.addUpdateBoundTag()}}else i.addUpdateBoundTag()}function Rk(n,t,e,i,r){const o=n.table;for(let a=0;a<o.columnHeaderLevelCount;a++)Gu(n,t,a);const s=n.getColGroup(t);return s?.addUpdateBoundTag(),!0}function Bk(n,t,e,i,r,o){const s=n.table;for(let l=0;l<s.columnHeaderLevelCount;l++)Gu(n,t,l);const a=n.getColGroup(t);return a?.addUpdateBoundTag(),!0}function kk(n,t,e,i,r){const o=n.table;for(let s=0;s<o.colCount;s++)Gu(n,s,e);return!0}function Pk(n,t,e,i,r,o){const s=n.table;for(let a=0;a<s.colCount;a++)Gu(n,a,e);return!0}function Cht(n,t,e,i,r){return Gu(n,t,e),!0}function _ht(n,t,e,i,r){return Gu(n,t,e),!0}function wht(n,t,e){var i;const{table:r}=n,{scenegraph:o}=r,{highlightScope:s,singleStyle:a,disableHeader:l,cellPos:h,cellPosContainHeader:u}=n.hover,d=h.col,c=h.row;if(s===oe.none||l&&(u.col!==t||u.row!==e)){const m=u.col,v=u.row;o.hideHoverIcon(m,v),o.showHoverIcon(t,e),u.col=t,u.row=e}if((l&&r.isHeader(t,e)||s===oe.none)&&(t=-1,e=-1),d===t&&c===e)return;h.col=t,h.row=e,!((i=n.table.options.customConfig)===null||i===void 0)&&i.disableBuildInChartActive||(o.deactivateChart(d,c),o.activateChart(t,e));let g=!1;const{ranges:f,highlightScope:p}=n.select;if(d!==-1&&c!==-1&&(g=xht(o,d,c,f,a,s),l||o.hideHoverIcon(d,c)),t===-1||e===-1)return h.col=-1,h.row=-1,void(!g||d===t&&c===e||n.table.scenegraph.updateNextFrame());s===oe.single?g=!!_ht(o,t,e):s===oe.row?g=!!Pk(o,t,e):s===oe.column?g=!!Bk(o,t):s===oe.cross&&(g=!!Pk(o,t,e),g=!!Bk(o,t)),s===oe.none||l||o.showHoverIcon(t,e),g&&n.table.scenegraph.updateNextFrame()}function xht(n,t,e,i,r,o,s){let a=!1;return o===oe.single?a=!!Cht(n,t,e):o===oe.row?a=!!kk(n,t,e):o===oe.column?a=!!Rk(n,t):o===oe.cross&&(a=!!kk(n,t,e),a=!!Rk(n,t)),a}function Sht(n,t,e){e.frozenColCount>0?n!==e.frozenColCount-1?e.setFrozenColCount(n+1):e.setFrozenColCount(0):e.setFrozenColCount(n+1)}function Aht(n,t,e,i){var r;let o,s=null,a=!1;if(Array.isArray(e.sortState))for(let c=0;c<e.sortState.length&&(o=e.sortState[c],o&&(s=e._getHeaderCellBySortState(o)),s&&(a=Ek(n,t,s.col,s.row,e)),!a);c++);else o=e.sortState,o&&(s=e._getHeaderCellBySortState(o)),s&&(a=Ek(n,t,s.col,s.row,e));const l=e.getHeaderDefine(n,t);if(o&&a&&l?.sort?o.order=o.order==="asc"?"desc":o.order==="desc"?"normal":"asc":l?.sort?o={field:e.getHeaderField(n,t),order:"asc"}:a&&l?.showSort||(o={field:e.getHeaderField(n,t),order:"normal"}),o.event=i,e.fireListeners(tt.SORT_CLICK,o).includes(!1))return;let h=!1,u=e.internalProps.sortState?Array.isArray(e.internalProps.sortState)&&(h=!0)?e.internalProps.sortState:[e.internalProps.sortState]:[];if(Array.isArray(u)){const c=u.findIndex((g=>g.field===o.field));c>=0?u[c]=o:u.push(o)}u=u.filter((c=>c.order!=="normal")),u=e.internalProps.multipleSort&&(h=!0)?u:u.splice(-1),u=h&&u.length?u:u[0],e.internalProps.sortState=u,e.stateManager.setSortState(u),l?.sort&&Mht(u,e),e.internalProps.useOneRowHeightFillAll=!1,e.internalProps.layoutMap.clearCellRangeMap(),e.scenegraph.sortCell();const d=!!(!((r=e.stateManager.select.ranges)===null||r===void 0)&&r.length);e.stateManager.updateSelectPos(-1,-1),e.stateManager.endSelectCells(!0,d)}function Mht(n,t,e){n=Array.isArray(n)||!n?n:[n],t.dataSource.sort((n||[]).map((i=>{var r,o;const s=t.internalProps.layoutMap.headerObjects.find((a=>a&&a.field===i.field));return{field:i.field,order:i.order||"asc",orderFn:typeof((r=s?.define)===null||r===void 0?void 0:r.sort)=="function"?(o=s?.define)===null||o===void 0?void 0:o.sort:z0}})))}function Ek(n,t,e,i,r){return r._getLayoutCellId(n,t)===r._getLayoutCellId(e,i)}function Tht(n,t,e,i,r,o,s=!0,a=!1){var l,h;const{table:u,interactionState:d}=n,{scenegraph:c}=u,{cellPos:g}=n.select;if(n.select.isSelectAll=o,t!==-1&&e!==-1&&s&&u._makeVisibleCell(t,e),t!==-1&&e!==-1&&s)if(d===Pt.grabing&&n.select.ranges.length>0){const f=n.select.ranges[n.select.ranges.length-1];t>f.start.col&&t>f.end.col&&u._makeVisibleCell(t+1,e),e>f.start.row&&e>f.end.row&&u._makeVisibleCell(t,e+1),t<f.start.col&&t<f.end.col&&u._makeVisibleCell(t-1,e),e<f.start.row&&e<f.end.row&&u._makeVisibleCell(t,e-1)}else u._makeVisibleCell(t,e);if(o){n.select.ranges=[],c.deleteAllSelectBorder();let f=0,p=0;const{disableHeaderSelect:m,disableRowSeriesNumberSelect:v}=((l=u.options.keyboardOptions)===null||l===void 0?void 0:l.selectAllOnCtrlA)||{};m&&(f=u.rowHeaderLevelCount,p=u.columnHeaderLevelCount),(v||m&&u.transpose)&&u.options.rowSeriesNumber&&(f+=1),n.select.ranges.push({start:{col:f,row:p},end:{col:u.colCount-1,row:u.rowCount-1}});const b=n.select.ranges[n.select.ranges.length-1];c.updateCellSelectBorder(b,!1)}else if(g.col===-1||g.row===-1||t!==-1&&e!==-1)if(d!==Pt.default||u.eventManager.isDraging||u.stateManager.isResizeCol()){if((d===Pt.grabing||u.eventManager.isDraging)&&!u.stateManager.isResizeCol()){let f=!0;g.col===-1&&(g.col=t),g.row===-1&&(g.row=e),g.col=t,g.row=e;const p=n.select.ranges[n.select.ranges.length-1];if(p){if(u.internalProps.layoutMap.isSeriesNumberInBody(p.start.col,p.start.row))f=!1,p.end={col:u.colCount-1,row:e};else if(n.fillHandle.isFilling){if(n.fillHandle.direction==="top")if(e===n.fillHandle.beforeFillMinRow&&e===n.fillHandle.beforeFillMaxRow)p.start.row=p.end.row=e;else if(e<=n.fillHandle.beforeFillMinRow){if(p.start.row<p.end.row){const m=p.start.row;p.start.row=p.end.row,p.end.row=m}p.end.row=e}else e===n.fillHandle.beforeFillMaxRow&&(p.start.row>p.end.row?p.start.row=e:p.end.row=e);else if(n.fillHandle.direction==="bottom"){if(e>=n.fillHandle.beforeFillMaxRow){if(p.start.row>p.end.row){const m=p.start.row;p.start.row=p.end.row,p.end.row=m}p.end.row=e}}else if(n.fillHandle.direction==="left")if(t===n.fillHandle.beforeFillMinCol&&t===n.fillHandle.beforeFillMaxCol)p.start.col=p.end.col=t;else if(t<=n.fillHandle.beforeFillMinCol){if(p.start.col<p.end.col){const m=p.start.col;p.start.col=p.end.col,p.end.col=m}p.end.col=t}else t===n.fillHandle.beforeFillMaxCol&&(p.start.col>p.end.col?p.start.col=t:p.end.col=t);else if(n.fillHandle.direction==="right"&&t>=n.fillHandle.beforeFillMaxCol){if(p.start.col>p.end.col){const m=p.start.col;p.start.col=p.end.col,p.end.col=m}p.end.col=t}}else{p.end={col:t,row:e};const m=a?{start:{col:t,row:e},end:{col:t,row:e}}:u.getCellRange(t,e);p.start.col<m.end.col?p.end.col=m.end.col:p.start.col>m.start.col&&(p.end.col=m.start.col),p.start.row<m.end.row?p.end.row=m.end.row:p.start.row>m.start.row&&(p.end.row=m.start.row),n.select.headerSelectMode==="body"&&(u.isRowHeader(t,e)?(p.start.col=u.rowHeaderLevelCount+u.leftRowSeriesNumberCount,p.end.col=u.colCount-1):u.isColumnHeader(t,e)?(p.start.row=u.columnHeaderLevelCount,p.end.row=u.rowCount-1):u.internalProps.layoutMap.isSeriesNumberInBody(t,e)?(p.start.col=u.leftRowSeriesNumberCount,p.end.col=u.colCount-1):u.isCornerHeader(t,e)?(p.start.col=u.rowHeaderLevelCount+u.leftRowSeriesNumberCount,p.start.row=u.columnHeaderLevelCount,p.end.col=u.colCount-1,p.end.row=u.rowCount-1):u.isSeriesNumber(t,e)&&(p.start.col=u.leftRowSeriesNumberCount,p.start.row=u.columnHeaderLevelCount,p.end.col=u.colCount-1,p.end.row=u.rowCount-1)),a&&(p.skipBodyMerge=!0)}p&&p.start.row<=u.rowCount-1&&p.end.row<=u.rowCount-1&&p.start.col<=u.colCount-1&&p.end.col<=u.colCount-1&&c.updateCellSelectBorder(p,f)}}}else{const f=n.select.ranges[n.select.ranges.length-1];if(i&&f){if(n.select.headerSelectMode!=="cell"&&u.isColumnHeader(t,e)){const p=Math.min(f.start.col,f.end.col,t),m=Math.max(f.start.col,f.end.col,t),v=Math.min(f.start.row,f.end.row,e),b=u.rowCount-1;n.select.headerSelectMode==="body"?(f.start={col:p,row:u.columnHeaderLevelCount},f.end={col:m,row:u.rowCount-1}):(f.start={col:p,row:v},f.end={col:m,row:b})}else if(n.select.headerSelectMode!=="cell"&&u.isRowHeader(t,e)){const p=Math.min(f.start.col,f.end.col,t),m=u.colCount-1,v=Math.min(f.start.row,f.end.row,e),b=Math.max(f.start.row,f.end.row,e);n.select.headerSelectMode==="body"?(f.start={col:u.leftRowSeriesNumberCount+u.rowHeaderLevelCount,row:v},f.end={col:u.colCount-1,row:b}):(f.start={col:p,row:v},f.end={col:m,row:b})}else if(n.select.headerSelectMode!=="cell"&&u.isSeriesNumberInBody(t,e)){const p=Math.min(f.start.col,f.end.col,t),m=u.colCount-1,v=Math.min(f.start.row,f.end.row,e),b=Math.max(f.start.row,f.end.row,e);n.select.headerSelectMode==="body"?(f.start={col:u.leftRowSeriesNumberCount,row:v},f.end={col:u.colCount-1,row:b}):(f.start={col:p,row:v},f.end={col:m,row:b})}else f.end={col:t,row:e};i||(f.end=f.start),c.deleteLastSelectedRangeComponents(),c.updateCellSelectBorder(f)}else{let p=!0;if(g.col===-1||g.row===-1||r||(n.select.ranges=[],c.deleteAllSelectBorder()),n.select.headerSelectMode!=="cell"&&u.isColumnHeader(t,e)){const v=u.getCellRange(t,e);n.select.headerSelectMode==="body"?n.select.ranges.push({start:{col:v.start.col,row:u.columnHeaderLevelCount},end:{col:v.end.col,row:u.rowCount-1},skipBodyMerge:!0}):n.select.ranges.push({start:{col:v.start.col,row:v.start.row},end:{col:v.end.col,row:u.rowCount-1},skipBodyMerge:!0})}else if(n.select.headerSelectMode!=="cell"&&u.isRowHeader(t,e)){const v=u.getCellRange(t,e);n.select.headerSelectMode==="body"?n.select.ranges.push({start:{col:u.rowHeaderLevelCount+u.leftRowSeriesNumberCount,row:v.start.row},end:{col:u.colCount-1,row:v.end.row},skipBodyMerge:!0}):n.select.ranges.push({start:{col:v.start.col,row:v.start.row},end:{col:u.colCount-1,row:v.end.row},skipBodyMerge:!0})}else if(u.internalProps.layoutMap.isSeriesNumberInHeader(t,e)){p=!1;const{cornerHeaderSelectMode:v}=n.select;if(v==="body")n.select.ranges.push({start:{col:u.leftRowSeriesNumberCount,row:u.columnHeaderLevelCount},end:{col:u.colCount-1,row:u.rowCount-1},skipBodyMerge:!0});else if(v==="inline"){const b=a?{start:{col:t,row:e},end:{col:t}}:u.getCellRange(t,e);n.select.ranges.push({start:{col:b.start.col,row:b.start.row},end:{col:b.end.col,row:u.rowCount-1},skipBodyMerge:!0})}else if(v==="cell"){const b=a?{start:{col:t,row:e},end:{col:t,row:e}}:u.getCellRange(t,e);n.select.ranges.push({start:{col:b.start.col,row:b.start.row},end:{col:b.end.col,row:b.end.row},skipBodyMerge:a||void 0})}else n.select.ranges.push({start:{col:0,row:0},end:{col:u.colCount-1,row:u.rowCount-1},skipBodyMerge:!0})}else if(u.internalProps.layoutMap.isSeriesNumberInBody(t,e))p=!1,n.select.headerSelectMode==="body"?n.select.ranges.push({start:{col:u.leftRowSeriesNumberCount,row:e},end:{col:u.colCount-1,row:e},skipBodyMerge:!0}):n.select.ranges.push({start:{col:t,row:e},end:{col:u.colCount-1,row:e},skipBodyMerge:!0});else if(u.internalProps.layoutMap.isCornerHeader(t,e)){p=!1;const{cornerHeaderSelectMode:v}=n.select;if(v==="body")n.select.ranges.push({start:{col:u.rowHeaderLevelCount+u.leftRowSeriesNumberCount,row:u.columnHeaderLevelCount},end:{col:u.colCount-1,row:u.rowCount-1},skipBodyMerge:!0});else if(v==="cell"){const b=a?{start:{col:t,row:e},end:{col:t,row:e}}:u.getCellRange(t,e);n.select.ranges.push({start:{col:b.start.col,row:b.start.row},end:{col:b.end.col,row:b.end.row},skipBodyMerge:a||void 0})}else if(v==="inline"){const b=a?{start:{col:t,row:e},end:{col:t}}:u.getCellRange(t,e);n.select.ranges.push({start:{col:b.start.col,row:b.start.row},end:{col:b.end.col,row:u.rowCount-1},skipBodyMerge:!0})}else n.select.ranges.push({start:{col:u.leftRowSeriesNumberCount,row:0},end:{col:u.colCount-1,row:u.rowCount-1},skipBodyMerge:!0})}else if(t>=0&&e>=0){const v=a?{start:{col:t,row:e},end:{col:t,row:e}}:u.getCellRange(t,e);n.select.ranges.push({start:{col:v.start.col,row:v.start.row},end:{col:v.end.col,row:v.end.row},skipBodyMerge:a||void 0})}g.col=t,g.row=e;const m=(h=n.select.ranges)===null||h===void 0?void 0:h[n.select.ranges.length-1];m&&m.start.row<=u.rowCount-1&&m.end.row<=u.rowCount-1&&m.start.col<=u.colCount-1&&m.end.col<=u.colCount-1&&c.updateCellSelectBorder(m,p)}}else g.col=-1,g.row=-1,n.select.ranges=[],c.deleteAllSelectBorder();c.updateNextFrame()}function Rht(n){n.moveSelectingRangeComponentsToSelectedRangeComponents()}const Ad=vg(tt,{PIVOT_SORT_CLICK:"pivot_sort_click",DRILLMENU_CLICK:"drillmenu_click"});vg(tt,{VCHART_EVENT_TYPE:"vchart_event_type"});function Bht(n,t,e,i,r){const o=r.getCellLocation(n,t);let s=0,a=0,l=!1;o==="columnHeader"?(s=r.getColsWidth(0,r.rowHeaderLevelCount-1)-(r.frozenColCount===0?r.scrollLeft:0),a=r.getRowsHeight(0,t-1)+r.getRowHeight(t)/2,l=!0):o==="rowHeader"&&(a=r.getRowsHeight(0,r.columnHeaderLevelCount-1),s=r.getColsWidth(0,n-1)+r.getColWidth(n)/2,l=!0),r.scenegraph.updateDrill(l,s,a,e,i)}function kht(n,t,e){const i=e.scenegraph.getCell(n,t).getChildByName("sparkline"),r=i?.getChildByName("highlight-line"),o=i?.getChildByName("highlight-symbol");r&&r.setAttributes({visible:!1,pickable:!1}),o&&o.setAttributes({visible:!1,pickable:!1}),e.scenegraph.updateNextFrame()}function Pht(n,t,e,i,r){var o,s;const a=r.scenegraph.getCell(n,t).getChildByName("sparkline"),l=a?.getChildByName("sparkline-line"),h=a?.getChildByName("sparkline-symbol-group");if(!l)return!1;const u=l.bandwidth,d=l.min,c=l.max,g=l.attribute.points;let f;e-=a.globalAABBBounds.x1,a.globalAABBBounds.y1;for(let p=0;p<g.length;p++){const{x:m,y:v,defined:b,rawData:y}=g[p];if(Math.abs(e-m)<u/2&&(f={point:g[p],points:g,pointsBandWidth:u,pointData:y},b)){const C=a.getChildByName("highlight-line");if(C)C.setAttributes({points:[{x:m,y:c},{x:m,y:d}],visible:!0,pickable:!0});else{const _=Ke({points:[{x:m,y:c},{x:m,y:d}],lineWidth:(o=l.hover)===null||o===void 0?void 0:o.strokeWidth,stroke:(s=l.hover)===null||s===void 0?void 0:s.stroke});_.name="highlight-line",a.addChild(_)}const w=a.getChildByName("highlight-symbol");if(w)w.setAttributes({x:m,y:v,visible:!0,pickable:!0});else{const _=yu({x:m,y:v,stroke:h.hover.stroke,lineWidth:h.hover.strokeWidth,fill:h.hover.fill,size:2*h.hover.size,symbolType:"circle"});_.name="highlight-symbol",a.addChild(_)}break}}if(r.scenegraph.updateNextFrame(),f){const p={col:n,row:t,field:r.getHeaderField(n,t),value:r.getCellValue(n,t),dataValue:r.getCellOriginValue(n,t),cellHeaderPaths:r.internalProps.layoutMap.getCellHeaderPaths(n,t),title:r.getBodyColumnDefine(n,t).title,cellRange:r.getCellRelativeRect(n,t),sparkline:{pointData:f.pointData},scaleRatio:r.canvas.getBoundingClientRect().width/r.canvas.offsetWidth};r.fireListeners(tt.MOUSEOVER_CHART_SYMBOL,p)}return!0}function Eht(n,t,e){const i=e.getCellRange(n.col,n.row);if(e.isColumnHeader(n.col,n.row)){const r=e.getCellRange(t.col,i.start.row);t.row>=e.columnHeaderLevelCount&&(t.row=e.columnHeaderLevelCount-1),t.col>=n.col?t.col=r.end.col:t.col=r.start.col}else if(e.isRowHeader(n.col,n.row)){const r=e.internalProps.layoutMap,o=e.getCellRange(i.start.col,t.row);if(t.col>=e.rowHeaderLevelCount+r.leftRowSeriesNumberColumnCount&&(t.col=e.rowHeaderLevelCount+r.leftRowSeriesNumberColumnCount-1),r.rowHierarchyType==="tree"){const s=r.getCellHeaderPathsWithTreeNode(n.col,n.row).rowHeaderPaths,a=r.getCellHeaderPathsWithTreeNode(t.col,t.row).rowHeaderPaths;if(s.length<=a.length){const l=a[s.length-1];l&&(t.row>=n.row?t.row=l.startInTotal+l.size-1+e.columnHeaderLevelCount:t.row=l.startInTotal+e.columnHeaderLevelCount)}}else t.row>=n.row?t.row=o.end.row:t.row=o.start.row}return t}function Lht(n,t,e,i,r,o){var s;if(!("canMoveHeaderPosition"in r.table.internalProps.layoutMap))return;if(r.columnMove.moving=!0,r.columnMove.colSource=n,r.columnMove.rowSource=t,r.table.isListTable()){const f=r.table.getRecordIndexByCell(n,t),p=r.table.getRecordByCell(n,t),m=r.table.getRecordHierarchyState(n,t);r.columnMove.rowSourceSize=Pv(f,m,p)+1}r.columnMove.x=e-r.table.tableX,r.columnMove.y=i-r.table.tableY;const a=r.table.getCellLocation(n,t),l=a==="columnHeader"?r.columnMove.x:a==="rowHeader"||r.table.internalProps.layoutMap.isSeriesNumberInBody(n,t)?r.columnMove.y:0,{backX:h,lineX:u,backY:d,lineY:c}=r.table.scenegraph.component.showMoveCol(n,t,l);r.table.fireListeners(tt.CHANGE_HEADER_POSITION_START,{col:n,row:t,x:e,y:i,backX:h,lineX:u,backY:d,lineY:c,event:o});const g=!!(!((s=r.select.ranges)===null||s===void 0)&&s.length);r.table.stateManager.updateSelectPos(-1,-1),r.table.stateManager.endSelectCells(!0,g),r.table.scenegraph.updateNextFrame()}function Oht(n,t,e,i,r,o){if(!("canMoveHeaderPosition"in r.table.internalProps.layoutMap))return;const s=Eht({col:r.columnMove.colSource,row:r.columnMove.rowSource},{col:n,row:t},r.table);if(r.table.internalProps.layoutMap.canMoveHeaderPosition({col:r.columnMove.colSource,row:r.columnMove.rowSource},{col:s.col,row:s.row})){if(r.columnMove.x=e-r.table.tableX,r.columnMove.y=i-r.table.tableY,r.columnMove.colTarget=s.col,r.columnMove.rowTarget=s.row,r.table.isListTable()){const c=r.table.getRecordIndexByCell(s.col,s.row),g=r.table.getRecordByCell(s.col,s.row),f=r.table.getRecordHierarchyState(s.col,s.row);r.columnMove.rowTargetSize=Pv(c,f,g)+1}let a,l,h,u;r.updateCursor("grabbing");const d=r.table.getCellLocation(r.columnMove.colSource,r.columnMove.rowSource);d==="columnHeader"?(l=r.columnMove.x,a=r.table.isLeftFrozenColumn(n)?r.columnMove.colTarget>=r.columnMove.colSource?r.table.getColsWidth(0,r.columnMove.colTarget):r.table.getColsWidth(0,r.columnMove.colTarget-1):r.table.isRightFrozenColumn(n)?r.table.tableNoFrameWidth-r.table.getColsWidth(s.col+1,r.table.colCount-1):(r.columnMove.colTarget>=r.columnMove.colSource?r.table.getColsWidth(0,r.columnMove.colTarget):r.table.getColsWidth(0,r.columnMove.colTarget-1))-r.table.stateManager.scroll.horizontalBarPos):(d==="rowHeader"||r.table.internalProps.layoutMap.isSeriesNumberInBody(n,t))&&(u=r.columnMove.y,h=r.table.isFrozenRow(t)?r.columnMove.rowTarget>=r.columnMove.rowSource?r.table.getRowsHeight(0,r.columnMove.rowTarget):r.table.getRowsHeight(0,r.columnMove.rowTarget-1):r.table.isBottomFrozenRow(t)?r.table.tableNoFrameHeight-r.table.getRowsHeight(s.row+1,r.table.rowCount-1):(r.columnMove.rowTarget>=r.columnMove.rowSource?r.table.getRowsHeight(0,r.columnMove.rowTarget):r.table.getRowsHeight(0,r.columnMove.rowTarget-1))-r.table.stateManager.scroll.verticalBarPos),r.table.scenegraph.component.updateMoveCol(l,a,u,h),r.table.fireListeners(tt.CHANGING_HEADER_POSITION,{col:n,row:t,x:e,y:i,backX:l,lineX:a,backY:u,lineY:h,event:o}),r.table.scenegraph.updateNextFrame()}else r.updateCursor("not-allowed"),r.columnMove.colTarget=r.columnMove.colSource,r.columnMove.rowTarget=r.columnMove.rowSource}function Iht(n){var t,e;let i=!1;if("canMoveHeaderPosition"in n.table.internalProps.layoutMap&&n.columnMove.moving&&n.columnMove.colSource>=0&&n.columnMove.rowSource>=0&&n.columnMove.colTarget>=0&&n.columnMove.rowTarget>=0&&((t=n.table.options.customConfig)===null||t===void 0?void 0:t.notUpdateInColumnRowMove)!==!0){const r=n.table.getCellRange(n.columnMove.colSource,n.columnMove.rowSource),o=n.table.getCellRange(n.columnMove.colTarget,n.columnMove.rowTarget),s=n.table._moveHeaderPosition({col:n.columnMove.colSource,row:n.columnMove.rowSource},{col:n.columnMove.colTarget,row:n.columnMove.rowTarget});if(!s||s.targetIndex===s.sourceIndex)return n.updateCursor(),n.columnMove.moving=!1,delete n.columnMove.colSource,delete n.columnMove.rowSource,delete n.columnMove.colTarget,delete n.columnMove.rowTarget,n.table.scenegraph.component.hideMoveCol(),n.table.scenegraph.updateNextFrame(),!1;{n.table.internalProps.useOneRowHeightFillAll=!1,n.table.internalProps.layoutMap.clearCellRangeMap();const a=n.table.getCellRange(n.columnMove.colSource,n.columnMove.rowSource),l=n.table.getCellRange(n.columnMove.colTarget,n.columnMove.rowTarget),h=Math.min(a.start.col,l.start.col,r.start.col,o.start.col),u=Math.max(a.end.col,l.end.col,r.end.col,o.end.col),d=Math.min(a.start.row,l.start.row,r.start.row,o.start.row);let c=Math.max(a.end.row,l.end.row,r.end.row,o.end.row);s.moveType==="row"&&n.table.internalProps.layoutMap.rowHierarchyType==="tree"&&(c=s.targetIndex>s.sourceIndex?c+s.targetSize-1:c+s.sourceSize-1),!n.table.transpose&&n.table.internalProps.layoutMap.isSeriesNumberInBody(n.columnMove.colSource,n.columnMove.rowSource)&&(n.table.changeRecordOrder(s.sourceIndex,s.targetIndex),n.changeCheckboxAndRadioOrder(s.sourceIndex,s.targetIndex)),s.moveType==="column"?Lk(h,u,0,-1,n.table):Lk(0,-1,d,c,n.table),n.table.clearCellStyleCache(),n.table.internalProps.layoutMap.isSeriesNumberInBody(n.columnMove.colSource,n.columnMove.rowSource)?n.table.scenegraph.updateHeaderPosition(n.table.scenegraph.proxy.colStart,n.table.scenegraph.proxy.colEnd,n.table.scenegraph.proxy.rowStart,n.table.scenegraph.proxy.rowEnd,s.moveType):s.moveType==="column"?n.table.scenegraph.updateHeaderPosition(h,u,0,-1,s.moveType):n.table.scenegraph.updateHeaderPosition(0,-1,d,c,s.moveType),n.table.internalProps.frozenColDragHeaderMode==="adjustFrozenCount"&&n.table.isListTable()&&(n.table.isLeftFrozenColumn(n.columnMove.colTarget)&&!n.table.isLeftFrozenColumn(n.columnMove.colSource)?n.table.frozenColCount+=a.end.col-a.start.col+1:n.table.isLeftFrozenColumn(n.columnMove.colSource)&&!n.table.isLeftFrozenColumn(n.columnMove.colTarget)&&(n.table.frozenColCount-=a.end.col-a.start.col+1),n.table.isRightFrozenColumn(n.columnMove.colTarget)&&!n.table.isRightFrozenColumn(n.columnMove.colSource)?n.table.rightFrozenColCount+=a.end.col-a.start.col+1:n.table.isRightFrozenColumn(n.columnMove.colSource)&&!n.table.isRightFrozenColumn(n.columnMove.colTarget)&&(n.table.rightFrozenColCount-=a.end.col-a.start.col+1)),i=!0}}return n.columnMove.moving=!1,setTimeout((()=>{delete n.columnMove.colSource,delete n.columnMove.rowSource,delete n.columnMove.colTarget,delete n.columnMove.rowTarget}),0),n.table.scenegraph.component.hideMoveCol(),n.columnResize.col<n.table.frozenColCount&&!n.table.isPivotTable()&&!n.table.transpose?(n.table.scenegraph.component.setFrozenColumnShadow(n.table.frozenColCount-1,n.columnResize.isRightFrozen),n.table.scenegraph.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount)):n.columnResize.col>=n.table.colCount-n.table.rightFrozenColCount&&!n.table.isPivotTable()&&!n.table.transpose?n.table.scenegraph.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount):n.table.options.frozenColCount?n.table.scenegraph.component.setFrozenColumnShadow(n.table.frozenColCount-1):n.table.options.rightFrozenColCount&&n.table.scenegraph.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount),n.table.scenegraph.updateNextFrame(),((e=n.table.options.customConfig)===null||e===void 0?void 0:e.notUpdateInColumnRowMove)===!0||i}function Lk(n,t,e,i,r){for(let o=n;o<=t;o++)r._clearColRangeWidthsMap(o);for(let o=e;o<=i;o++)r._clearRowRangeHeightsMap(o)}function ec(n){var t;if(!n)return;const e=!((t=n.role)===null||t===void 0)&&t.startsWith("icon")?n:n.type==="richtext"?n._currentHoverIcon:void 0;return e?n.type==="richtext"?{icon:e,position:{left:n.globalAABBBounds.x1+e.globalAABBBounds.x1,right:n.globalAABBBounds.x1+e.globalAABBBounds.x2,top:n.globalAABBBounds.y1+e.globalAABBBounds.y1,bottom:n.globalAABBBounds.y1+e.globalAABBBounds.y2,width:e.globalAABBBounds.x2-e.globalAABBBounds.x1,height:e.globalAABBBounds.y2-e.globalAABBBounds.y1},type:"richtext-icon"}:{icon:e,position:{left:e.globalAABBBounds.x1,right:e.globalAABBBounds.x2,top:e.globalAABBBounds.y1,bottom:e.globalAABBBounds.y2,width:e.globalAABBBounds.x2-e.globalAABBBounds.x1,height:e.globalAABBBounds.y2-e.globalAABBBounds.y1},type:"icon"}:void 0}function Hht(n,t,e){n=Math.ceil(n),t=Math.ceil(t);let i=e.columnResize.isRightFrozen?e.columnResize.x-n:n-e.columnResize.x;if(Math.abs(i)<1)return;const r=e.table.getColWidth(e.columnResize.col);let o=r;o+=i;const s=e.table.getMinColWidth(e.columnResize.col),a=e.table.getMaxColWidth(e.columnResize.col);if(o<s||o>a){if(r===s||r===a)return;i=r-s>a-r?a-r:s-r}let l=e.table.getColWidth(e.columnResize.col)+i;if(l<e.table.internalProps.limitMinWidth&&(l=e.table.internalProps.limitMinWidth,i=l-e.table.getColWidth(e.columnResize.col)),e.table.widthMode==="adaptive"&&e.columnResize.col<e.table.colCount-1){const h=e.table.getColWidth(e.columnResize.col+1),u=e.table.getMinColWidth(e.columnResize.col+1),d=e.table.getMaxColWidth(e.columnResize.col+1);let c=h;if(c-=i,c<u||c>d){if(h===u||h===d)return;i=h-u>d-h?d-h:u-h}c-i<e.table.internalProps.limitMinWidth&&(i=c-e.table.internalProps.limitMinWidth)}i=Math.ceil(i),e.columnResize.col<e.table.rowHeaderLevelCount||e.columnResize.col>=e.table.colCount-e.table.rightFrozenColCount?Ok(i,e):e.table.internalProps.columnResizeType==="indicator"?Fht(i,e):e.table.internalProps.columnResizeType==="indicatorGroup"?zht(i,e):e.table.internalProps.columnResizeType==="all"?Dht(i,e):Ok(i,e),e.columnResize.x=n,e.table.scenegraph.component.updateResizeCol(e.columnResize.col,t,e.columnResize.isRightFrozen),e.table._updateSize(),e.columnResize.col<e.table.frozenColCount&&!e.table.isPivotTable()&&!e.table.transpose?e.table.scenegraph.component.setFrozenColumnShadow(e.table.frozenColCount-1,e.columnResize.isRightFrozen):e.table.options.frozenColCount&&e.table.scenegraph.component.setFrozenColumnShadow(e.table.frozenColCount-1),(e.columnResize.col>=e.table.colCount-e.table.rightFrozenColCount&&!e.table.isPivotTable()&&!e.table.transpose||e.table.options.rightFrozenColCount)&&e.table.scenegraph.component.setRightFrozenColumnShadow(e.table.colCount-e.table.rightFrozenColCount),e.table.scenegraph.updateNextFrame()}function Ok(n,t){t.table.widthMode==="adaptive"&&t.columnResize.col<t.table.colCount-1?(t.table.scenegraph.updateColWidth(t.columnResize.col,n),t.table.scenegraph.updateColWidth(t.columnResize.col+1,-n),t.table.internalProps._widthResizedColMap.add(t.columnResize.col),t.table.internalProps._widthResizedColMap.add(t.columnResize.col+1)):(t.table.scenegraph.updateColWidth(t.columnResize.col,n),t.table.internalProps._widthResizedColMap.add(t.columnResize.col))}function Dht(n,t){const e=t.table.internalProps.layoutMap;for(let i=t.table.frozenColCount;i<t.table.colCount-t.table.rightFrozenColCount;i++){if(!(t.table.internalProps.transpose||t.table.isPivotTable()&&!e.indicatorsAsCol)){const r=e.getBody(i,t.table.columnHeaderLevelCount);if(r?.disableColumnResize)continue}t.table.scenegraph.updateColWidth(i,n),t.table.internalProps._widthResizedColMap.add(i)}}function Fht(n,t){const e=t.table.internalProps.layoutMap;let i,r,o;if(e.indicatorsAsCol)i=e.getIndicatorKey(t.columnResize.col,t.table.columnHeaderLevelCount);else{const s=e.getCellHeaderPaths(t.columnResize.col,t.table.columnHeaderLevelCount-1),a=s.colHeaderPaths[s.colHeaderPaths.length-1];r=a.dimensionKey,o=a.value}for(let s=t.table.rowHeaderLevelCount;s<t.table.colCount-t.table.rightFrozenColCount;s++){const a=e.getIndicatorKey(s,t.table.columnHeaderLevelCount);if(e.indicatorsAsCol&&a===i)t.table.scenegraph.updateColWidth(s,n),t.table.internalProps._widthResizedColMap.add(s);else if(!e.indicatorsAsCol){const l=e.getCellHeaderPaths(s,t.table.columnHeaderLevelCount-1),h=l?.colHeaderPaths[l.colHeaderPaths.length-1];h&&r===h.dimensionKey&&o===h.value&&(t.table.scenegraph.updateColWidth(s,n),t.table.internalProps._widthResizedColMap.add(s))}}}function zht(n,t){const e=t.table.internalProps.layoutMap,i=e.getCellHeaderPaths(t.columnResize.col,t.table.columnHeaderLevelCount),r=e.getHeadNodeByRowOrColDimensions(i.colHeaderPaths.slice(0,i.colHeaderPaths.length-1)),o=r.startInTotal+t.table.frozenColCount,s=r.startInTotal+t.table.frozenColCount+r.size-1,a=t.table.getColsWidth(o,s),l=n;for(let h=o;h<=s;h++){if(!(t.table.internalProps.transpose||t.table.isPivotTable()&&!e.indicatorsAsCol)){const d=e.getBody(h,t.table.columnHeaderLevelCount);if(d?.disableColumnResize)continue}let u=t.table.getColWidth(h)/a*l;u>0&&u<.5?u=.5:u<0&&u>=-.5&&(u=-.5),t.table.scenegraph.updateColWidth(h,u),t.table.internalProps._widthResizedColMap.add(h)}}function Nht(n,t,e,i,r,o){const s=o.table.getRecordShowIndexByCell(n,t);if(s>=0){const a=o.table.dataSource.getIndexKey(s);i==="column"?dt(r)?(o.radioState[e]={},o.radioState[e][a]=r):o.radioState[e]=a:(o.radioState[e]||(o.radioState[e]={}),dt(r)?o.radioState[e][a]=r:o.radioState[e][a]=!0)}}function Wht(n,t,e){var i;const r=e.getBodyColumnDefine(n,t),o=r?.field,s=e.getCellType(n,t);if($(o)&&s==="radio"){const a=e.dataSource.getIndexKey(e.getRecordShowIndexByCell(n,t)),l=(i=e.stateManager.radioState)===null||i===void 0?void 0:i[o];if(dt(l)){if(l===a)return!0}else if(Pi(l)){const h=l[a];if(dt(h))return h}}return!1}function jht(n,t,e,i,r,o,s){var a,l,h,u,d;const c=s.table.getRecordShowIndexByCell(n,t);if(c>=0){const g=s.table.dataSource.getIndexKey(c);if(i==="column"){if(!$(s.radioState[e])&&o)return dt(r)?(s.radioState[e]={},s.radioState[e][g]=r):s.radioState[e]=g,!0;if(dt(s.radioState[e])&&!dt(r))return s.radioState[e]===g;if(dt(s.radioState[e])&&dt(r)||Pi(s.radioState[e])&&!dt(r))return!1;if(Pi(s.radioState[e])&&dt(r))return s.radioState[e][g]===r}else if(i==="cell"){if(!$(s.radioState[e])&&o)return s.radioState[e]={},dt(r)?s.radioState[e][g]=r:s.radioState[e][g]=!0,!0;if(!$((a=s.radioState[e])===null||a===void 0?void 0:a[g])&&o)return dt(r)?s.radioState[e][g]=r:s.radioState[e][g]=!0,!0;if(ko((l=s.radioState[e])===null||l===void 0?void 0:l[g])&&!dt(r))return s.radioState[e][g];if(ko((h=s.radioState[e])===null||h===void 0?void 0:h[g])&&dt(r)||dt((u=s.radioState[e])===null||u===void 0?void 0:u[g])&&!dt(r))return!1;if(dt((d=s.radioState[e])===null||d===void 0?void 0:d[g])&&dt(r))return s.radioState[e][g]===r}}return o}function Vht(n,t,e,i){const r=i.scenegraph.getCell(n,t);if(r)if(dt(e)){const o=r.getChildAt(e);o?._handlePointerUp()}else{const o=r.getChildByName("radio");o?._handlePointerUp()}}function Ght(n,t,e){const{radioState:i,table:r}=e;if(r.internalProps.transpose?(n=r.getRecordShowIndexByCell(n,0),t=r.getRecordShowIndexByCell(t,0)):(n=r.getRecordShowIndexByCell(0,n),t=r.getRecordShowIndexByCell(0,t)),n>t){const o=i[n];for(let s=n;s>t;s--)i[s]=i[s-1];i[t]=o}else if(n<t){const o=i[n];for(let s=n;s<t;s++)i[s]=i[s+1];i[t]=o}}function $ht(n,t,e,i,r){const o=r.table.getCellRange(n,t);if(o.start.col!==o.end.col||o.start.row!==o.end.row)for(let s=o.start.col;s<=o.end.col;s++)for(let a=o.start.row;a<=o.end.row;a++)Ik(s,a,e,i,r);else Ik(n,t,e,i,r)}function Ik(n,t,e,i,r){const o=r.table.getRecordShowIndexByCell(n,t);if(o>=0){const s=r.table.dataSource.getIndexKey(o).toString();r.checkedState.get(s)?r.checkedState.get(s)[e]=i:r.checkedState.set(s,{[e]:i})}}function Uht(n,t,e){var i;e.headerCheckedState[n]=t,e.table.internalProps.enableCheckboxCascade&&((i=e.checkedState)===null||i===void 0||i.forEach((r=>{r[n]=t})))}function Xht(n,t,e,i,r){var o,s;if(r.table.isHeader(n,t)){if($(r.headerCheckedState[e]))return r.headerCheckedState[e];if(typeof i=="function")return;if($(i))r.headerCheckedState[e]=i;else if(((o=r.checkedState)===null||o===void 0?void 0:o.size)>0)return r.updateHeaderCheckedState(e,n,t);return r.headerCheckedState[e]}const a=r.table.getRecordShowIndexByCell(n,t);if(a>=0){const l=r.table.dataSource.getIndexKey(a).toString();if($((s=r.checkedState.get(l))===null||s===void 0?void 0:s[e]))return r.checkedState.get(l)[e];if(r.checkedState.get(l))r.checkedState.get(l)[e]=i;else if(r.table.internalProps.enableCheckboxCascade&&l.includes(",")){const h=l.split(",").slice(0,-1).join(",");r.checkedState.has(h)&&r.checkedState.get(h)[e]===!0?r.checkedState.set(l,{[e]:!0}):r.checkedState.set(l,{[e]:i})}else r.checkedState.set(l,{[e]:i})}return i}function Yht(n,t){t.checkedState.clear(),t.headerCheckedState={},t.radioState={};let e=!1;if(t._checkboxCellTypeFields=[],t._headerCheckFuncs={},t.table.internalProps.layoutMap.headerObjects.forEach(((i,r)=>{if(i.headerType==="checkbox"){const o=i.define.checked;o==null||typeof o=="function"?(e=!0,typeof o=="function"&&(t._headerCheckFuncs[i.field]=o)):t.headerCheckedState[i.field]=o,i.define.cellType!=="checkbox"&&!ur(i.define.cellType)||i.fieldFormat||t._checkboxCellTypeFields.push(i.field)}})),t.table.leftRowSeriesNumberCount===1)t.headerCheckedState._vtable_rowSeries_number=!1,t._checkboxCellTypeFields.push("_vtable_rowSeries_number"),e=!0;else if(t.table.leftRowSeriesNumberCount>1){for(let i=0;i<t.table.leftRowSeriesNumberCount;i++)t.headerCheckedState[`_vtable_rowSeries_number_${i}`]=!1,t._checkboxCellTypeFields.push(`_vtable_rowSeries_number_${i}`);e=!0}e&&tut(n,t)}function qht(n,t,e,i){let r=!0,o=!0,s=!1;return t.checkedState.forEach(((a,l)=>{var h;l=l.includes(",")?l.split(",").map((g=>Number(g))):Number(l);const u=t.table.getTableIndexByRecordIndex(l),d=t.table.transpose?t.table.getCustomMerge(u,i):t.table.getCustomMerge(e,u),c=(h=t.table.dataSource)===null||h===void 0?void 0:h.get(l);d||!t.table.internalProps.enableCheckboxCascade&&c?.vtableMerge||(a?.[n]!==!0?r=!1:(o=!1,s=!0))})),r?(t.headerCheckedState[n]=!0,r):o?(t.headerCheckedState[n]=!1,!1):!!s&&(t.headerCheckedState[n]="indeterminate","indeterminate")}function Kht(n,t){for(let e=t.checkedState.size;e<n.length;e++){const i=n[e];t._checkboxCellTypeFields.forEach((r=>{const o=i[r];let s;Pi(o)?s=o.checked:typeof o=="boolean"&&(s=o);const a=e.toString();t.checkedState.get(a)||t.checkedState.set(a,{}),t.checkedState.get(a)[r]=s}))}}function Zht(n,t,e,i){var r,o;const s=i.scenegraph.getCell(n,t),a=s?.getChildByName("checkbox")||((o=(r=s?.getChildByName("checkbox-content"))===null||r===void 0?void 0:r._checkboxGroup)===null||o===void 0?void 0:o.getChildByName("checkbox"));if(!a){const u=i.getHeaderField(n,t);if(i.isHeader(n,t))i.stateManager.setHeaderCheckedState(u,e),i.getCellType(n,t)==="checkbox"&&i.scenegraph.updateCheckboxCellState(n,t,e);else if(i.stateManager.setCheckedState(n,t,u,e),i.getCellType(n,t)==="checkbox"){const d=i.stateManager.headerCheckedState[u],c=i.stateManager.updateHeaderCheckedState(u,n,t);d!==c&&i.scenegraph.updateHeaderCheckboxCellState(n,t,c)}return}const{checked:l,indeterminate:h}=a.attribute;h?(e||a._handlePointerUp(),a._handlePointerUp()):l?e||a._handlePointerUp():e&&a._handlePointerUp()}function Zf(n,t,e,i){var r,o;const s=i.scenegraph.getCell(n,t),a=s?.getChildByName("checkbox")||((o=(r=s?.getChildByName("checkbox-content"))===null||r===void 0?void 0:r._checkboxGroup)===null||o===void 0?void 0:o.getChildByName("checkbox"));a&&(e==="indeterminate"?(a.setAttribute("indeterminate",!0),a.setAttribute("checked",void 0)):(a.setAttribute("indeterminate",void 0),a.setAttribute("checked",e)))}function Jht(n,t,e){const{checkedState:i,table:r}=e;let o,s;if(r.internalProps.transpose?(n=r.getRecordShowIndexByCell(n,0),t=r.getRecordShowIndexByCell(t,0)):(o=r.isPivotTable()?void 0:r.getRecordIndexByCell(0,n),s=r.isPivotTable()?void 0:r.getRecordIndexByCell(0,t)),dt(o)&&dt(s)){if((n=o)>(t=s)){const a=i.get(n.toString());for(let l=n;l>t;l--)i.set(l.toString(),i.get((l-1).toString()));i.set(t.toString(),a)}else if(n<t){const a=i.get(n.toString());for(let l=n;l<t;l++)i.set(l.toString(),i.get((l+1).toString()));i.set(t.toString(),a)}}else if(wt(o)&&wt(s)){if((n=o[o.length-1])>(t=s[s.length-1])){const a=i.get(o.toString());for(let l=n;l>t;l--){const h=[...o];h[h.length-1]=l;const u=[...o];u[u.length-1]=l-1,i.set(h.toString(),i.get(u.toString()))}i.set(s.toString(),a)}else if(n<t){const a=i.get(o.toString());for(let l=n;l<t;l++){const h=[...o];h[h.length-1]=l;const u=[...o];u[u.length-1]=l+1,i.set(h.toString(),i.get(u.toString()))}i.set(s.toString(),a)}}}function Qht(n){const t=[],e=n.dataSource,i=e.dataConfig.groupByRules.length+1;return e.currentIndexedData.forEach(((r,o)=>{if(wt(r)&&r.length===i){const s=e.getOriginRecordIndexForGroup(r);t[s]=n.stateManager.checkedState.get(r.toString())}})),t}function tut(n,t){const e=t.table,i=e.isPivotTable()?0:e.internalProps.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount,r=e.isPivotTable()?wt(n)?n.length:0:e.internalProps.transpose?e.colCount:e.rowCount;for(let o=0;o+i<r;o++){const s=e.isPivotTable()?n[o]:e.dataSource.get(o);t._checkboxCellTypeFields.forEach((a=>{const l=s&&s[a];let h;if(Pi(l)?h=l.checked:typeof l=="boolean"&&(h=l),h==null){const d=t._headerCheckFuncs[a];if(d){const c=t.table.getCellAddrByFieldRecord(a,o);h=fe(d,{col:c.col,row:c.row,table:t.table,context:null,value:l})}}const u=e.isPivotTable()?o.toString():t.table.dataSource.getIndexKey(o).toString();t.checkedState.get(u)||t.checkedState.set(u,{}),t.checkedState.get(u)[a]=h}))}}function eut(n,t,e){n=Math.ceil(n),t=Math.ceil(t);let i=e.rowResize.isBottomFrozen?e.rowResize.y-t:t-e.rowResize.y;if(Math.abs(i)<1)return;e.table.getRowHeight(e.rowResize.row);let r=e.table.getRowHeight(e.rowResize.row)+i;if(r<e.table.internalProps.limitMinHeight&&(r=e.table.internalProps.limitMinHeight,i=r-e.table.getRowHeight(e.rowResize.row)),e.table.heightMode==="adaptive"&&e.rowResize.row<e.table.rowCount-1){let o=e.table.getRowHeight(e.rowResize.row+1);o-=i,o-i<e.table.internalProps.limitMinHeight&&(i=o-e.table.internalProps.limitMinHeight)}i=Math.ceil(i),e.rowResize.row<e.table.columnHeaderLevelCount||e.rowResize.row>=e.table.rowCount-e.table.bottomFrozenRowCount?Hk(i,e):e.table.internalProps.rowResizeType==="indicator"?nut(i,e):e.table.internalProps.rowResizeType==="indicatorGroup"?rut(i,e):e.table.internalProps.rowResizeType==="all"?iut(i,e):Hk(i,e),e.rowResize.y=t,e.table.scenegraph.component.updateResizeRow(e.rowResize.row,n,e.rowResize.isBottomFrozen),e.table._updateSize(),e.table.scenegraph.updateNextFrame()}function Hk(n,t){t.table.heightMode==="adaptive"&&t.rowResize.row<t.table.rowCount-1?(t.table.scenegraph.updateRowHeight(t.rowResize.row,n),t.table.scenegraph.updateRowHeight(t.rowResize.row+1,-n),t.table.internalProps._heightResizedRowMap.add(t.rowResize.row),t.table.internalProps._heightResizedRowMap.add(t.rowResize.row+1)):(t.table.scenegraph.updateRowHeight(t.rowResize.row,n),t.table.internalProps._heightResizedRowMap.add(t.rowResize.row))}function iut(n,t){for(let e=t.table.frozenRowCount;e<t.table.rowCount-t.table.bottomFrozenRowCount;e++)t.table.scenegraph.updateRowHeight(e,n),t.table.internalProps._heightResizedRowMap.add(e)}function nut(n,t){var e,i;const r=t.table.internalProps.layoutMap;let o,s,a;if(r.indicatorsAsCol){const l=r.getCellHeaderPaths(t.table.rowHeaderLevelCount-1,t.rowResize.row),h=(e=l.rowHeaderPaths)===null||e===void 0?void 0:e[l.rowHeaderPaths.length-1];s=h?.dimensionKey,a=h?.value}else o=r.getIndicatorKey(t.table.rowHeaderLevelCount,t.rowResize.row);for(let l=t.table.columnHeaderLevelCount;l<t.table.rowCount-t.table.bottomFrozenRowCount;l++){const h=r.getIndicatorKey(t.table.rowHeaderLevelCount,l);if(r.indicatorsAsCol||h!==o){if(r.indicatorsAsCol){const u=r.getCellHeaderPaths(t.table.rowHeaderLevelCount-1,l),d=(i=u?.rowHeaderPaths)===null||i===void 0?void 0:i[u.rowHeaderPaths.length-1];d&&s===d.dimensionKey&&a===d.value&&(t.table.scenegraph.updateRowHeight(l,n),t.table.internalProps._heightResizedRowMap.add(l))}}else t.table.scenegraph.updateRowHeight(l,n),t.table.internalProps._heightResizedRowMap.add(l)}}function rut(n,t){const e=t.table.internalProps.layoutMap,i=e.getCellHeaderPaths(t.table.rowHeaderLevelCount,t.rowResize.row),r=e.getHeadNodeByRowOrColDimensions(i.rowHeaderPaths.slice(0,i.rowHeaderPaths.length-1)),o=r.startInTotal+t.table.frozenRowCount,s=r.startInTotal+t.table.frozenRowCount+r.size-1,a=t.table.getRowsHeight(o,s),l=n;for(let h=o;h<=s;h++){let u=t.table.getRowHeight(h)/a*l;u>0&&u<.5?u=.5:u<0&&u>=-.5&&(u=-.51),t.table.scenegraph.updateRowHeight(h,u),t.table.internalProps._heightResizedRowMap.add(h)}}function out(n,t,e){const i=n.table,r=t.start.col,o=t.start.row,s=t.end.col,a=t.end.row,l=(t.skipBodyMerge,Math.max(Math.min(s,r),0)),h=Math.max(Math.min(a,o),0),u=Math.min(Math.max(s,r),i.colCount-1),d=Math.min(Math.max(a,o),i.rowCount-1),{needRowHeader:c,needRightRowHeader:g,needColumnHeader:f,needBottomColumnHeader:p,needBody:m,needCornerHeader:v,needRightTopCornerHeader:b,needLeftBottomCornerHeader:y,needRightBottomCornerHeader:C}=YD(l,h,u,d,i);if(v&&rs(n,l,h,Math.min(u,i.frozenColCount-1),Math.min(d,i.frozenRowCount-1),"cornerHeader",`${l}${h}${u}${d}`,[!0,!f,!c,!0],e),b&&rs(n,Math.max(l,i.colCount-i.rightFrozenColCount),h,u,Math.min(d,i.frozenRowCount-1),"rightTopCorner",`${l}${h}${u}${d}`,[!0,!0,!g,!f],e),y){const w=Math.min(u,i.frozenColCount-1);rs(n,l,Math.max(h,i.rowCount-i.bottomFrozenRowCount),w,d,"leftBottomCorner",`${l}${h}${u}${d}`,[!c,!p,!0,!0],e)}if(C&&rs(n,Math.max(l,i.colCount-i.rightFrozenColCount),Math.max(h,i.rowCount-i.bottomFrozenRowCount),u,d,"rightBottomCorner",`${l}${h}${u}${d}`,[!g,!0,!0,!p],e),f&&rs(n,Math.max(l,i.frozenColCount),h,Math.min(u,i.colCount-i.rightFrozenColCount-1),Math.min(d,i.frozenRowCount-1),"columnHeader",`${l}${h}${u}${d}`,[!0,!b,!m,!v],e),p){const w=Math.max(l,i.frozenColCount),_=Math.min(u,i.colCount-i.rightFrozenColCount-1);rs(n,w,Math.max(h,i.rowCount-i.bottomFrozenRowCount),_,d,"bottomFrozen",`${l}${h}${u}${d}`,[!m,!C,!0,!y],e)}if(c){const w=Math.max(h,i.frozenRowCount),_=Math.min(d,i.rowCount-i.bottomFrozenRowCount-1);rs(n,l,w,Math.min(u,i.frozenColCount-1),_,"rowHeader",`${l}${h}${u}${d}`,[!v,!m,!y,!0],e)}if(g){const w=Math.max(h,i.frozenRowCount),_=Math.min(d,i.rowCount-i.bottomFrozenRowCount-1);rs(n,Math.max(l,i.colCount-i.rightFrozenColCount),w,u,_,"rightFrozen",`${l}${h}${u}${d}`,[!b,!0,!C,!m],e)}m&&rs(n,Math.max(l,i.frozenColCount),Math.max(h,i.frozenRowCount),Math.min(u,i.colCount-i.rightFrozenColCount-1),Math.min(d,i.rowCount-i.bottomFrozenRowCount-1),"body",`${l}${h}${u}${d}`,[!f,!g,!p,!c],e)}function rs(n,t,e,i,r,o,s,a,l){var h,u,d,c;const g=Math.min(t,i),f=Math.min(e,r),p=Math.max(t,i),m=Math.max(e,r),v=n.highPerformanceGetCell(g,f).globalAABBBounds,b=be({pickable:!1,fill:(h=l.cellBgColor)!==null&&h!==void 0&&h,lineWidth:(u=l.cellBorderLineWidth)!==null&&u!==void 0?u:0,lineDash:(d=l.cellBorderLineDash)!==null&&d!==void 0?d:[],stroke:a.map((y=>!!y&&l.cellBorderColor)),x:v.x1-n.tableGroup.attribute.x,y:v.y1-n.tableGroup.attribute.y,width:0,height:0,visible:!0,cornerRadius:cF(o,(c=n.table.theme.frameStyle)===null||c===void 0?void 0:c.cornerRadius,t,e,i,r,n.table)});n.customSelectedRangeComponents.set(`${g}-${f}-${p}-${m}-${s}`,{rect:b,role:o}),n.tableGroup.insertAfter(b,o==="body"?n.bodyGroup:o==="columnHeader"?n.colHeaderGroup:o==="rowHeader"?n.rowHeaderGroup:o==="cornerHeader"?n.cornerHeaderGroup:o==="rightTopCorner"?n.rightTopCornerGroup:o==="rightFrozen"?n.rightFrozenGroup:o==="leftBottomCorner"?n.leftBottomCornerGroup:o==="bottomFrozen"?n.bottomFrozenGroup:n.rightBottomCornerGroup)}function sut(n){const{customSelectedRangeComponents:t}=n.table.scenegraph;t.forEach(((e,i)=>{e.rect.delete()})),t.clear(),n.select.customSelectRanges=[]}function aut(n,t){n.forEach((e=>{out(t.table.scenegraph,e.range,e.style)})),t.select.customSelectRanges=n,dF(t.table.scenegraph),t.table.scenegraph.updateNextFrame()}let lut=class{constructor(t){this.fastScrolling=!1,this.checkedState=new Map,this.headerCheckedState={},this._checkboxCellTypeFields=[],this._headerCheckFuncs={},this.radioState={},this.resetInteractionState=yD((e=>{this.updateInteractionState(e??Pt.default)}),100),this.table=t,this.initState(),this.updateVerticalScrollBar=this.updateVerticalScrollBar.bind(this),this.updateHorizontalScrollBar=this.updateHorizontalScrollBar.bind(this)}initState(){this._initState(),this.setHoverState(),this.setSelectState(),this.setFrozenState()}updateOptionSetState(){this._updateOptionSetState(),this.setHoverState(),this.setSelectState(),this.setFrozenState()}_updateOptionSetState(){this.interactionState=Pt.default,this.hoverIcon={col:-1,row:-1,icon:null},this.columnResize={col:-1,x:0,resizing:!1},this.rowResize={row:-1,y:0,resizing:!1},this.columnMove={colSource:-1,colTarget:-1,rowSource:-1,rowTarget:-1,rowSourceSize:0,rowTargetSize:0,x:0,y:0,moving:!1},this.menu={x:-1,y:-1,isShow:!1,itemList:[],bounds:new Ca,highlightIndex:-1,dropDownMenuHighlight:[]},this.sort=[{col:-1,row:-1,order:"normal"}],this.frozen={col:-1,row:-1},this.tablePosition={absoluteX:0,absoluteY:0},this.drill={col:-1,row:-1},this.sparkLine={col:-1,row:-1}}_initState(){this.interactionState=Pt.default,this.select={highlightScope:oe.single,ranges:[],cellPos:{col:-1,row:-1},selecting:!1},this.fillHandle={isFilling:!1,startX:void 0,startY:void 0},this.hover={highlightScope:oe.single,cellPos:{col:-1,row:-1}},this.hoverIcon={col:-1,row:-1,icon:null},this.columnResize={col:-1,x:0,resizing:!1},this.rowResize={row:-1,y:0,resizing:!1},this.columnMove={colSource:-1,colTarget:-1,rowSource:-1,rowTarget:-1,rowSourceSize:0,rowTargetSize:0,x:0,y:0,moving:!1},this.menu={x:-1,y:-1,isShow:!1,itemList:[],bounds:new Ca,highlightIndex:-1,dropDownMenuHighlight:[]},this.sort=[{col:-1,row:-1,order:"normal"}],this.frozen={col:-1,row:-1},this.scroll={horizontalBarPos:0,verticalBarPos:0},this.tablePosition={absoluteX:0,absoluteY:0},this.drill={col:-1,row:-1},this.sparkLine={col:-1,row:-1}}setHoverState(){var t;const{highlightMode:e,disableHover:i,disableHeaderHover:r}=(t=this.table.options.hover)!==null&&t!==void 0?t:{highlightMode:"cell"};i?this.hover.highlightScope=oe.none:e==="cross"?this.hover.highlightScope=oe.cross:e==="row"?this.hover.highlightScope=oe.row:e==="column"?this.hover.highlightScope=oe.column:e==="cell"&&(this.hover.highlightScope=oe.single),this.hover.singleStyle=!i,this.hover.disableHeader=r,(this.hover.highlightScope===oe.none||r)&&(this.hover.cellPosContainHeader={col:-1,row:-1})}setSelectState(){var t,e,i,r,o,s;const{headerSelectMode:a,disableSelect:l,disableHeaderSelect:h,highlightMode:u,highlightInRange:d}=Object.assign({},{headerSelectMode:"inline",disableSelect:!1,disableHeaderSelect:!1,highlightMode:"cell",highlightInRange:!1},this.table.options.select),c=!((t=this.table.options.select)===null||t===void 0)&&t.cornerHeaderSelectMode?(e=this.table.options.select)===null||e===void 0?void 0:e.cornerHeaderSelectMode:((i=this.table.options.select)===null||i===void 0?void 0:i.headerSelectMode)==="body"?(r=this.table.options.select)===null||r===void 0?void 0:r.headerSelectMode:"all";this.select.highlightScope=l===!0?oe.none:u==="cross"?oe.cross:u==="row"?oe.row:u==="column"?oe.column:oe.single,this.select.singleStyle=!l,this.select.disableHeader=h,this.select.headerSelectMode=a,this.select.cornerHeaderSelectMode=c,this.select.highlightInRange=d,this.select.disableCtrlMultiSelect=((o=this.table.options.keyboardOptions)===null||o===void 0?void 0:o.ctrlMultiSelect)===!1,this.select.disableShiftMultiSelect=((s=this.table.options.keyboardOptions)===null||s===void 0?void 0:s.shiftMultiSelect)===!1}isSelected(t,e){let i=!1;return this.select.ranges.forEach((r=>{Ir(r,t,e)&&(i=!0)})),i}setSortState(t){const e=this,i=(t=!t||Array.isArray(t)?t:[t])&&t.reduce(((r,o)=>{var s,a,l;const h=(s=(function(u){const d=[];return(function c(g,f=0){g.forEach((p=>{var m;const v=p.startInTotal?(m=p.startInTotal+e.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)!==null&&m!==void 0?m:0:f;p.columns?c(p.columns,v):d.push(Object.assign(Object.assign({},p),{startIndex:v}))}))})(u),d})(this.table.internalProps.columns))===null||s===void 0?void 0:s.find((u=>u?.field===o?.field));return this.table.internalProps.transpose?r.push({field:o.field,order:o.order,row:(a=h?.startInTotal+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)!==null&&a!==void 0?a:0,col:h?.level}):r.push({field:o.field,order:o.order,col:(l=h?.startInTotal+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)!==null&&l!==void 0?l:0,row:h?.level}),r}),[]);this.sort=i||[]}setFrozenState(){this.frozen.col=this.table.frozenColCount-1}updateInteractionState(t){if(this.interactionState===t)return;t===Pt.scrolling&&(this.interactionStateBeforeScroll=this.interactionState);const e=this.interactionState;this.interactionState=t,e===Pt.scrolling&&Pt.default}updateHoverhighlightScope(t){this.hover.highlightScope!==t&&(this.hover.highlightScope=t)}updateHoverPos(t,e){wht(this,t,e)}updateSelectPos(t,e,i=!1,r=!1,o=!1,s=!0,a=!1){e!==-1&&e!==-1&&(this.select.selecting=!0),t<0&&(t=-1),e<0&&(e=-1),t>this.table.colCount-1&&(t=this.table.colCount-1),e>this.table.rowCount-1&&(e=this.table.rowCount-1);const l=this.select.cellPos.col,h=this.select.cellPos.row;Tht(this,t,e,i,r,o,s,a),!this.table.hasListeners(tt.SELECTED_CHANGED)||l===t&&h===e||this.table.fireListeners(tt.SELECTED_CHANGED,{ranges:this.select.ranges,col:t,row:e})}checkCellRangeInSelect(t,e){return yht(t,e,this.select.ranges,this.select.highlightScope)}updateHoverIcon(t,e,i,r){var o,s,a,l,h,u,d,c,g;if(!((o=this.residentHoverIcon)===null||o===void 0)&&o.icon&&i===((s=this.residentHoverIcon)===null||s===void 0?void 0:s.icon))return;const f=ec(i);if(f)if(f.type==="richtext-icon"){const p=f.icon;if(this.hoverIcon.icon&&this.hoverIcon.icon!==((l=this.residentHoverIcon)===null||l===void 0?void 0:l.icon)&&(this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=-1,this.hoverIcon.col=-1,this.hoverIcon.icon=null,this.table.scenegraph.updateNextFrame()),p.attribute.tooltip){const m={content:p.attribute.tooltip.title,referencePosition:{rect:f.position,placement:p.attribute.tooltip.placement},style:Object.assign({},(h=this.table.internalProps.theme)===null||h===void 0?void 0:h.tooltipStyle,(u=p.tooltip)===null||u===void 0?void 0:u.style,(c=(d=p.attribute)===null||d===void 0?void 0:d.tooltip)===null||c===void 0?void 0:c.style),disappearDelay:p.attribute.tooltip.disappearDelay};this.table.internalProps.tooltipHandler.isBinded(m)||this.table.showTooltip(t,e,m)}}else{const p=f.icon;p!==this.hoverIcon.icon&&(this.hoverIcon.icon&&this.hoverIcon.icon!==((g=this.residentHoverIcon)===null||g===void 0?void 0:g.icon)&&this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=t,this.hoverIcon.row=e,this.hoverIcon.icon=p,this.table.scenegraph.setIconHoverStyle(p,t,e,r),this.table.scenegraph.updateNextFrame())}else this.hoverIcon.icon&&this.hoverIcon.icon!==((a=this.residentHoverIcon)===null||a===void 0?void 0:a.icon)&&(this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=-1,this.hoverIcon.col=-1,this.hoverIcon.icon=null,this.table.scenegraph.updateNextFrame())}isResizeCol(){return this.columnResize.resizing}isResizeRow(){return this.rowResize.resizing}isFillHandle(){return this.fillHandle.isFilling}isSelecting(){return this.select.selecting}endSelectCells(t=!0,e=!0){if(this.select.selecting){if(this.select.selecting=!1,this.select.ranges.length===0)return;const i=this.select.ranges[this.select.ranges.length-1];this.table.isSeriesNumber(this.select.cellPos.col,this.select.cellPos.row)||this.table.isHeader(this.select.cellPos.col,this.select.cellPos.row)||Mat(i,this.table);let r=!1;for(let a=0;a<this.select.ranges.length-1;a++){const l=this.select.ranges[a];if(l&&l.start.col===i.start.col&&l.start.row===i.start.row&&l.end.col===i.end.col&&l.end.row===i.end.row){r=!0;break}}r?(this.select.ranges.pop(),gF(this.table.scenegraph),this.table.scenegraph.selectingRangeComponents.clear()):Rht(this.table.scenegraph);const o=this.select.ranges[this.select.ranges.length-1].end.col,s=this.select.ranges[this.select.ranges.length-1].end.row;t&&this.table.fireListeners(tt.SELECTED_CELL,{ranges:this.select.ranges,col:o,row:s})}else e&&this.select.ranges.length===0&&this.table.fireListeners(tt.SELECTED_CLEAR,{})}endResizeCol(){setTimeout((()=>{this.columnResize.resizing=!1}),0),this.table.scenegraph.updateChartSizeForResizeColWidth(this.columnResize.col),this.checkFrozen(),this.table.scenegraph.component.hideResizeCol(),this.table.scenegraph.updateNextFrame()}startResizeCol(t,e,i,r){this.columnResize.resizing=!0,this.columnResize.col=t,this.columnResize.x=e,this.columnResize.isRightFrozen=r,this.table.scenegraph.component.showResizeCol(t,i,r),this.table.scenegraph.updateNextFrame()}updateResizeCol(t,e){Hht(t,e,this)}endResizeRow(){setTimeout((()=>{this.rowResize.resizing=!1}),0),this.table.scenegraph.updateChartSizeForResizeRowHeight(this.rowResize.row),this.table.scenegraph.component.hideResizeRow(),this.table.scenegraph.updateNextFrame()}startResizeRow(t,e,i,r){this.rowResize.resizing=!0,this.rowResize.row=t,this.rowResize.y=i,this.rowResize.isBottomFrozen=r,this.table.scenegraph.component.showResizeRow(t,e,r),this.table.scenegraph.updateNextFrame()}updateResizeRow(t,e){eut(t,e,this)}startFillSelect(t,e){this.fillHandle.isFilling=!0,this.fillHandle.startX=t,this.fillHandle.startY=e;const i=this.select.ranges[this.select.ranges.length-1];this.fillHandle.beforeFillMinCol=Math.min(i.start.col,i.end.col),this.fillHandle.beforeFillMinRow=Math.min(i.start.row,i.end.row),this.fillHandle.beforeFillMaxCol=Math.max(i.start.col,i.end.col),this.fillHandle.beforeFillMaxRow=Math.max(i.start.row,i.end.row),this.table.fireListeners(tt.MOUSEDOWN_FILL_HANDLE,{})}endFillSelect(){this.fillHandle.isFilling=!1,this.fillHandle.startX=void 0,this.fillHandle.startY=void 0,this.fillHandle.directionRow=void 0;const t=Math.min(this.select.ranges[0].start.col,this.select.ranges[0].end.col),e=Math.min(this.select.ranges[0].start.row,this.select.ranges[0].end.row),i=Math.max(this.select.ranges[0].start.col,this.select.ranges[0].end.col),r=Math.max(this.select.ranges[0].start.row,this.select.ranges[0].end.row);this.fillHandle.beforeFillMinCol===t&&this.fillHandle.beforeFillMinRow===e&&this.fillHandle.beforeFillMaxCol===i&&this.fillHandle.beforeFillMaxRow===r||this.table.eventManager.isDraging&&this.table.fireListeners(tt.DRAG_FILL_HANDLE_END,{direction:this.fillHandle.direction}),this.fillHandle.beforeFillMaxCol=void 0,this.fillHandle.beforeFillMaxRow=void 0,this.fillHandle.beforeFillMinCol=void 0,this.fillHandle.beforeFillMinRow=void 0}startMoveCol(t,e,i,r,o){Lht(t,e,i,r,this,o)}updateMoveCol(t,e,i,r,o){Oht(t,e,i,r,this,o)}isMoveCol(){return this.columnMove.moving}endMoveCol(){return Iht(this)}checkFrozen(){var t;let e=this.table.options.frozenColCount?this.table.options.frozenColCount:this.table.isPivotTable()||this.table.isListTable()&&this.table.internalProps.transpose?((t=this.table.rowHeaderLevelCount)!==null&&t!==void 0?t:0)+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount:0;if(e){e=Math.min(e,this.table.colCount);const i=this.table.getContainer();if(i&&i.clientWidth===0)return this._frozenObserver?void 0:(this._frozenObserver=new ResizeObserver((r=>{for(const o of r)if(o.contentRect.width>0)return this.clearFrozenObserver(),this.table.resize(),void setTimeout((()=>{this.checkFrozen()}),0)})),void this._frozenObserver.observe(i));if(this.table.getColsWidth(0,e-1)>this.table._getMaxFrozenWidth())if(this.table.internalProps.unfreezeAllOnExceedsMaxWidth)this.table._setFrozenColCount(0),this.setFrozenCol(-1);else{const r=this.table._getComputedFrozenColCount(e);this.table._setFrozenColCount(r),this.setFrozenCol(r)}else this.table.frozenColCount!==e&&(this.table._setFrozenColCount(e),this.setFrozenCol(e))}else this.clearFrozenObserver()}clearFrozenObserver(){this._frozenObserver&&(this._frozenObserver.disconnect(),this._frozenObserver=null)}setFrozenCol(t){t!==this.frozen.col?(this.frozen.col=t,this.table.scenegraph.updateFrozen(),this.table.scenegraph.updateFrozenIcon(0,this.table.colCount-1)):this.table.scenegraph.updateFrozenIcon(0,this.table.colCount-1)}setFrozenRow(t){t!==this.frozen.row&&(this.frozen.row=t,this.table.scenegraph.updateRowFrozen())}checkVerticalScrollBarEnd(){var t,e;const i=this.table.getAllRowsHeight(),r=this.scroll.verticalBarPos,o=this.table.tableNoFrameHeight;r+o>=i&&this.table.fireListeners(tt.SCROLL_VERTICAL_END,{scrollTop:r,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(t=this.table.theme.scrollStyle)===null||t===void 0?void 0:t.width,scrollWidth:(e=this.table.theme.scrollStyle)===null||e===void 0?void 0:e.width,viewHeight:o,viewWidth:this.table.tableNoFrameWidth})}checkHorizontalScrollBarEnd(){var t,e;const i=this.table.getAllColsWidth(),r=this.scroll.horizontalBarPos,o=this.table.tableNoFrameWidth;r+o>=i&&this.table.fireListeners(tt.SCROLL_HORIZONTAL_END,{scrollTop:this.scroll.verticalBarPos,scrollLeft:r,scrollHeight:(t=this.table.theme.scrollStyle)===null||t===void 0?void 0:t.width,scrollWidth:(e=this.table.theme.scrollStyle)===null||e===void 0?void 0:e.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:o})}updateVerticalScrollBar(t){var e,i,r,o;const s=this.table.getAllRowsHeight(),a=this.scroll.verticalBarPos;let l=Math.ceil(t*(s-this.table.scenegraph.height));$(l)&&!isNaN(l)||(l=0);const h=l-this.table.scenegraph.proxy.deltaY-a;if(this.table.fireListeners(tt.CAN_SCROLL,{event:void 0,scrollTop:l-this.table.scenegraph.proxy.deltaY,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(e=this.table.theme.scrollStyle)===null||e===void 0?void 0:e.width,scrollWidth:(i=this.table.theme.scrollStyle)===null||i===void 0?void 0:i.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:t,dy:h}).some((u=>u===!1))){const u=this.scroll.verticalBarPos/(s-this.table.scenegraph.height);this.table.scenegraph.component.updateVerticalScrollBarPos(u)}else this.scroll.verticalBarPos=l,this.table.scenegraph.setY(-this.scroll.verticalBarPos,t===1),this.scroll.verticalBarPos-=this.table.scenegraph.proxy.deltaY,this.table.scenegraph.proxy.deltaY=0,this.updateHoverPos(-1,-1),this.table.fireListeners(tt.SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(r=this.table.theme.scrollStyle)===null||r===void 0?void 0:r.width,scrollWidth:(o=this.table.theme.scrollStyle)===null||o===void 0?void 0:o.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:t,dy:h}),a!==this.scroll.verticalBarPos&&this.checkVerticalScrollBarEnd()}updateHorizontalScrollBar(t){var e,i,r,o;const s=this.table.getAllColsWidth(),a=this.scroll.horizontalBarPos;let l=Math.ceil(t*(s-this.table.scenegraph.width));$(l)&&!isNaN(l)||(l=0);const h=l-this.table.scenegraph.proxy.deltaX-a;if(this.table.fireListeners(tt.CAN_SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:l-this.table.scenegraph.proxy.deltaX,scrollHeight:(e=this.table.theme.scrollStyle)===null||e===void 0?void 0:e.width,scrollWidth:(i=this.table.theme.scrollStyle)===null||i===void 0?void 0:i.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:t,dx:h}).some((u=>u===!1))){const u=this.scroll.horizontalBarPos/(s-this.table.scenegraph.width);this.table.scenegraph.component.updateHorizontalScrollBarPos(u)}else this.scroll.horizontalBarPos=l,this.table.scenegraph.setX(-this.scroll.horizontalBarPos,t===1),this.scroll.horizontalBarPos-=this.table.scenegraph.proxy.deltaX,this.table.scenegraph.proxy.deltaX=0,this.updateHoverPos(-1,-1),this.table.fireListeners(tt.SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(r=this.table.theme.scrollStyle)===null||r===void 0?void 0:r.width,scrollWidth:(o=this.table.theme.scrollStyle)===null||o===void 0?void 0:o.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:t,dx:h}),a!==this.scroll.horizontalBarPos&&this.checkHorizontalScrollBarEnd()}setScrollTop(t,e,i=!0){var r,o,s,a,l,h,u;const d=this.table.getAllRowsHeight(),c=!((r=this.table.options.customConfig)===null||r===void 0)&&r._disableColumnAndRowSizeRound?1:0;t=Math.max(0,Math.min(t,d-this.table.scenegraph.height-c)),t=Math.ceil(t);const g=this.scroll.verticalBarPos,f=t/(d-this.table.scenegraph.height);if((g!==t||((s=(o=this.table.options)===null||o===void 0?void 0:o.customConfig)===null||s===void 0?void 0:s.scrollEventAlwaysTrigger)===!0)&&i){let m=t;$(m)&&!isNaN(m)||(m=0);const v=m-g;if(this.table.fireListeners(tt.CAN_SCROLL,{event:e?.nativeEvent,scrollTop:m,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(a=this.table.theme.scrollStyle)===null||a===void 0?void 0:a.width,scrollWidth:(l=this.table.theme.scrollStyle)===null||l===void 0?void 0:l.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:f,dy:v}).some((b=>b===!1))){const b=this.scroll.verticalBarPos/(d-this.table.scenegraph.height);return void this.table.scenegraph.component.updateVerticalScrollBarPos(b)}}(t!==this.scroll.verticalBarPos||this.table.isPivotChart())&&this.updateHoverPos(-1,-1),this.scroll.verticalBarPos=t,$(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this.table.scenegraph.setY(-t),this.table.scenegraph.component.updateVerticalScrollBarPos(f);const p=this.scroll.verticalBarPos-g;this.table.fireListeners(tt.SCROLL,{event:e?.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(h=this.table.theme.scrollStyle)===null||h===void 0?void 0:h.width,scrollWidth:(u=this.table.theme.scrollStyle)===null||u===void 0?void 0:u.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:f,dy:p}),g!==t&&i&&this.checkVerticalScrollBarEnd()}setScrollLeft(t,e,i=!0){var r,o,s,a,l,h,u;this.table.scrollLeft;const d=this.table.getAllColsWidth(),c=(this.table.getFrozenColsWidth(),!((r=this.table.options.customConfig)===null||r===void 0)&&r._disableColumnAndRowSizeRound?1:0);t=Math.max(0,Math.min(t,d-this.table.scenegraph.width-c)),t=Math.ceil(t);const g=this.scroll.horizontalBarPos,f=t/(d-this.table.scenegraph.width);if((g!==t||((s=(o=this.table.options)===null||o===void 0?void 0:o.customConfig)===null||s===void 0?void 0:s.scrollEventAlwaysTrigger)===!0)&&i){let m=t;$(m)&&!isNaN(m)||(m=0);const v=m-g;if(this.table.fireListeners(tt.CAN_SCROLL,{event:e?.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:m,scrollHeight:(a=this.table.theme.scrollStyle)===null||a===void 0?void 0:a.width,scrollWidth:(l=this.table.theme.scrollStyle)===null||l===void 0?void 0:l.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:f,dx:v}).some((b=>b===!1))){const b=this.scroll.horizontalBarPos/(d-this.table.scenegraph.width);return void this.table.scenegraph.component.updateHorizontalScrollBarPos(b)}}t!==this.scroll.horizontalBarPos&&this.updateHoverPos(-1,-1),this.scroll.horizontalBarPos=t,$(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this.table.scenegraph.setX(-t),this.table.scenegraph.component.updateHorizontalScrollBarPos(f);const p=this.scroll.horizontalBarPos-g;this.table.fireListeners(tt.SCROLL,{event:e?.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(h=this.table.theme.scrollStyle)===null||h===void 0?void 0:h.width,scrollWidth:(u=this.table.theme.scrollStyle)===null||u===void 0?void 0:u.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:f,dx:p}),g!==t&&i&&this.checkHorizontalScrollBarEnd()}hideVerticalScrollBar(){this.table.scenegraph.component.hideVerticalScrollBar()}showVerticalScrollBar(t){this.table.scenegraph.component.showVerticalScrollBar(),t&&(clearTimeout(this._clearVerticalScrollBar),this._clearVerticalScrollBar=setTimeout((()=>{var e;(e=this.table.scenegraph)===null||e===void 0||e.component.hideVerticalScrollBar()}),1e3))}hideHorizontalScrollBar(){this.table.scenegraph.component.hideHorizontalScrollBar()}showHorizontalScrollBar(t){var e;this.table.scenegraph.component.showHorizontalScrollBar(),(e=this.table.scenegraph)===null||e===void 0||e.component.showFrozenColumnShadow(),t&&(clearTimeout(this._clearHorizontalScrollBar),this._clearHorizontalScrollBar=setTimeout((()=>{var i,r;(i=this.table.scenegraph)===null||i===void 0||i.component.hideFrozenColumnShadow(),(r=this.table.scenegraph)===null||r===void 0||r.component.hideHorizontalScrollBar()}),1e3))}triggerContextMenu(t,e,i,r){this.menu.isShow&&this.menu.x===i&&this.menu.y===r?this.hideMenu():this.showContextMenu(t,e,i,r)}showContextMenu(t,e,i,r){var o;!((o=this.table.internalProps.menu)===null||o===void 0)&&o.contextMenuItems&&(this.table.internalProps.menu.renderMode==="html"?this.menu.isShow=!0:(this.menu.isShow=!0,this.menu.x=i,this.menu.y=r,this.table.scenegraph.component.menu.attach(i,r,t,e,Jn.contextmenu)),this.table.fireListeners(tt.SHOW_MENU,{x:i,y:r,col:t,row:e,type:"contextmenu"}))}triggerDropDownMenu(t,e,i,r,o){this.table.fireListeners(tt.DROPDOWN_ICON_CLICK,{col:t,row:e,event:o}),this.menu.isShow?this.hideMenu():this.showDropDownMenu(t,e,i,r)}showDropDownMenu(t,e,i,r){this.table.internalProps.menu.renderMode==="html"?this.menu.isShow=!0:(this.menu.isShow=!0,this.table.scenegraph.component.menu.attach(i,r,t,e,Jn.dropDown),this.menu.bounds=this.table.scenegraph.component.menu.bounds),this.table.fireListeners(tt.SHOW_MENU,{x:i,y:r,col:t,row:e,type:"dropDown"}),this.residentHoverIcon&&this.table.scenegraph.setIconNormalStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row);const o=this.table.scenegraph.getCell(t,e);let s;o.forEachChildren((a=>a.attribute.funcType===me.dropDown&&(s=a,!0))),s&&(this.residentHoverIcon={col:t,row:e,icon:s},this.table.scenegraph.setIconHoverStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row,o),this.table.scenegraph.residentHoverIcon(t,e))}hideMenu(){this.menu.isShow&&(this.table.fireListeners(tt.DROPDOWN_MENU_CLEAR,null),this.table.fireListeners(tt.HIDE_MENU,null),this.menu.isShow=!1,this.table.scenegraph.component.menu.detach(),this.residentHoverIcon&&(this.table.scenegraph.setIconNormalStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row),this.table.scenegraph.resetResidentHoverIcon(this.residentHoverIcon.col,this.residentHoverIcon.row),this.residentHoverIcon=null))}setDropDownMenuHighlight(t){this.menu.dropDownMenuHighlight=t;for(let e=0;e<t.length;e++){const{col:i,row:r}=t[e],o=this.table.getCellRange(i,r);if(o)for(let s=o.start.col;s<=o.end.col;s++)for(let a=o.start.row;a<=o.end.row;a++)this.table.scenegraph.updateCellContent(s,a)}}dropDownMenuIsHighlight(t,e,i){const r=this.menu.dropDownMenuHighlight;if(Array.isArray(r))for(let o=0;o<r.length;o++){const s=r[o];let{col:a,row:l}=s;const{field:h,menuKey:u}=s;if(typeof a!="number"||typeof l!="number")if(this.table.isPivotTable()){const d=this.table.internalProps.layoutMap.getPivotCellAdress(h);if(!d)continue;a=d.col,l=d.row}else{const d=this.table.internalProps.layoutMap.getHeaderCellAddressByField(h);if(!d)continue;a=d.col,l=d.row}if($(a)&&$(l)&&this.table.isCellRangeEqual(t,e,a,l)){let d=this.table._getHeaderLayoutMap(a??t,l??e).dropDownMenu||this.table.globalDropDownMenu;if(typeof d=="function"&&(d=d({row:l,col:a,table:this.table})),d)for(let c=0;c<d.length;c++){const g=d[c];if(Pi(g)&&(g.menuKey||g.text)===(u||"")&&c===i||Xe(g)&&g===u&&c===i)return!0}}}return!1}triggerSort(t,e,i,r){if(this.table.isPivotTable()){const c=this.table.getPivotSortState(t,e),g=c?c.toUpperCase():"NORMAL",f=g==="ASC"?"DESC":g==="DESC"?"NORMAL":"ASC";return this.table.sort(t,e,f),void this.table.fireListeners(Ad.PIVOT_SORT_CLICK,{col:t,row:e,order:g||"normal",dimensionInfo:this.table.internalProps.layoutMap.getPivotDimensionInfo(t,e),cellLocation:this.table.getCellLocation(t,e),event:r})}const o=[...this.sort],s=this.table.internalProps.multipleSort||!o.length?null:this.sort[this.sort.length-1];Aht(t,e,this.table,r);const a=this.table.getCellRange(t,e),l=this.sort.find((c=>c.col===a.start.col&&c.row===a.start.row)),h=this.table.internalProps.multipleSort||!s?null:s.col,u=this.table.internalProps.multipleSort||!s?null:s.row,d=o.findIndex((c=>c.col===t&&c.row===e));d>=0&&o.splice(d,1),this.table.scenegraph.updateSortIcon({col:t,row:e,iconMark:i,order:l?.order,oldSortCol:h,oldSortRow:u,oldIconMark:s?.icon}),l&&(l.icon=i),this.table.internalProps.multipleSort||o.forEach((c=>{this.table.scenegraph.updateSortIcon({col:null,row:null,iconMark:null,order:"normal",oldSortCol:c.col,oldSortRow:c.row,oldIconMark:null})})),this.table.fireListeners(Ad.AFTER_SORT,{order:l?.order,field:this.table.getHeaderField(t,e),event:r})}setSelectInline(t){this.select.selectInline=t}updateSortState(t){var e,i,r,o,s,a,l,h;t=Array.isArray(t)?t:[t];for(let d=0;d<t.length;d++){if(t[d].field===((e=this.sort[d])===null||e===void 0?void 0:e.field)&&t[t.length-1].order===((i=this.sort[d])===null||i===void 0?void 0:i.order))return;const c=this.table.internalProps.multipleSort?null:((r=this.sort[d])===null||r===void 0?void 0:r.col)||null,g=this.table.internalProps.multipleSort?null:((o=this.sort[d])===null||o===void 0?void 0:o.row)||null;((s=this.sort[d])===null||s===void 0?void 0:s.order)==="asc"||(a=this.sort[d])===null||a===void 0||a.order,this.setSortState(t.slice(0,d+1));const f=this.table.internalProps.layoutMap.getHeaderCellAddressByField(t[d].field);this.sort[d].col=f.col,this.sort[d].row=f.row;const p=this.table.scenegraph.getCell(this.sort[d].col,this.sort[d].row);let m;Yx(p,"children",(v=>v.attribute.funcType==="sort"&&(m=v,!0))),this.table.scenegraph.updateSortIcon({col:this.sort[d].col,row:this.sort[d].row,iconMark:m,order:this.sort[d].order,oldSortCol:c,oldSortRow:g,oldIconMark:(l=this.sort[d])===null||l===void 0?void 0:l.icon})}const u=[];this.table.internalProps.layoutMap.columnTree.tree.children.forEach((d=>{t.some((c=>c.field===d.field))||u.push(d)}));for(let d=0;d<u.length;d++){const c=u[d];this.table.scenegraph.updateSortIcon({col:null,row:null,iconMark:null,order:null,oldSortCol:(h=c.startInTotal+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)!==null&&h!==void 0?h:0,oldSortRow:c.level,oldIconMark:null})}}triggerFreeze(t,e,i){if(!this.table.isPivotTable()&&!this.table.transpose){if(Sht(t,e,this.table),this.table.hasListeners(Ad.FREEZE_CLICK)){const r=this.table.internalProps.layoutMap.columnObjects.slice(0,t+1);this.table.fireListeners(Ad.FREEZE_CLICK,{col:t,row:e,fields:r.reduce(((o,s)=>o.concat(s.field)),[]),colCount:this.table.frozenColCount})}this.frozen.icon=i}}updateCursor(t){var e;t||(t=(e=this.table.options.defaultCursor)!==null&&e!==void 0?e:"default"),this.table.getElement().style.cursor=t}updateDrillState(t,e,i,r,o,s){this.drill.dimensionKey=t,this.drill.title=e,this.drill.drillDown=i,this.drill.drillUp=r,this.drill.col=o,this.drill.row=s,Bht(o,s,i,r,this.table)}updateSparklineHoverPose(t,e,i,r){this.sparkLine.col!==-1&&this.sparkLine.row!==-1&&kht(this.sparkLine.col,this.sparkLine.row,this.table);let o=!1;t!==-1&&e!==-1&&(o=Pht(t,e,i,r,this.table)),o?(this.sparkLine.col=t,this.sparkLine.row=e):(this.sparkLine.col=-1,this.sparkLine.row=-1)}setCheckedState(t,e,i,r){return $ht(t,e,i,r,this)}setHeaderCheckedState(t,e){return Uht(t,e,this)}syncCheckedState(t,e,i,r){return Xht(t,e,i,r,this)}initCheckedState(t){return Yht(t,this)}updateHeaderCheckedState(t,e,i){return qht(t,this,e,i)}initLeftRecordsCheckState(t){return Kht(t,this)}setRadioState(t,e,i,r,o){Nht(t,e,i,r,o,this)}syncRadioState(t,e,i,r,o,s){return jht(t,e,i,r,o,s,this)}changeCheckboxAndRadioOrder(t,e){this.checkedState.size&&Jht(t,e,this),this.radioState.length&&Ght(t,e,this)}setCustomSelectRanges(t){sut(this),aut(t,this)}};function hut(n){te.mode==="browser"&&n.on(tt.CLICK_CELL,(t=>{const{col:e,row:i}=t;if(t.target.type==="image"&&t.target.role&&t.target.role.startsWith("icon"))return;let r;r=n.internalProps.layoutMap.isHeader(e,i)?n.isPivotTable()?n._getHeaderLayoutMap(e,i).headerType:n.getHeaderDefine(e,i).headerType:n.getBodyColumnType(e,i);const o=n.isHeader(e,i)?n.getHeaderDefine(e,i):n.getBodyColumnDefine(e,i),s=n.getCellValue(e,i),a=n.getCellOriginValue(e,i);if(r==="link"){let l=fe(o.linkJump,{col:e,row:i,table:n,value:s,dataValue:a,cellHeaderPaths:void 0});if(l=l!==!1,!l)return;const h=o.templateLink;let u,d=fe(o.linkDetect,{col:e,row:i,table:n,value:s,dataValue:a,cellHeaderPaths:void 0});if(d=d!==!1,h){const f=n.getCellOriginRecord(e,i);if(f&&f.vtableMerge)return;const p=Object.assign({__value:s,__dataValue:a},f);if(ur(h))u=h(p,e,i,n);else{const m=/\{\s*(\S+?)\s*\}/g;u=h.replace(m,((v,b)=>p[b]))}}else if(d){if(!qx.test(s))return;u=s}else u=s;if(!u)return;const c=o.linkTarget,g=o.linkWindowFeatures;window.open(u,c,g)}else if(r==="image"){const{clickToPreview:l}=o;if(l===!1)return;const h=document.createElement("div");h.style.width="100%",h.style.height="100%",h.style.position="absolute",h.style.top="0",h.style.left="0",h.style.backgroundColor="rgba(30, 30, 30, 0.4)",h.style.display="flex",h.style.justifyContent="center",h.style.alignItems="center",h.style.overflow="hidden",h.style.zIndex="9999",h.addEventListener("click",(d=>{d.target===h&&document.body.removeChild(h)}));const u=new Image;u.src=s,u.style.maxWidth="80%",u.style.maxHeight="80%",h.appendChild(u),document.body.appendChild(h)}else if(r==="video"){const{clickToPreview:l}=o;if(l===!1)return;const h=document.createElement("div");h.style.width="100%",h.style.height="100%",h.style.position="absolute",h.style.top="0",h.style.left="0",h.style.backgroundColor="rgba(30, 30, 30, 0.4)",h.style.display="flex",h.style.justifyContent="center",h.style.alignItems="center",h.style.overflow="hidden",h.style.zIndex="9999",h.addEventListener("click",(d=>{d.target===h&&document.body.removeChild(h)}));const u=document.createElement("video");u.src=s,u.style.maxWidth="80%",u.style.maxHeight="80%",u.setAttribute("preload","auto"),u.setAttribute("controls","true"),h.appendChild(u),document.body.appendChild(h)}}))}function uut(n){n.on(tt.MOUSEENTER_CELL,(t=>{const{col:e,row:i}=t;if(e===-1||i===-1)return;const r=n.internalProps.layoutMap.getHeaderDimension(e,i);r?.drillDown||r?.drillUp?n.stateManager.updateDrillState(r.dimensionKey,r.title,r.drillDown,r.drillUp,e,i):n.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1)})),n.on(tt.MOUSELEAVE_TABLE,(t=>{n.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1)}))}function dut(n){n.fireListeners(Ad.DRILLMENU_CLICK,n.stateManager.drill)}function cut(n){const t=n.internalProps.layoutMap.rowsDefine,e=n.internalProps.layoutMap.columnsDefine;for(let i=0;i<t.length;i++){const r=t[i];if(typeof r!="string"&&(r.drillDown||r.drillUp))return!0}for(let i=0;i<e.length;i++){const r=e[i];if(typeof r!="string"&&(r.drillDown||r.drillUp))return!0}return!1}function Dk(n){if(n.eventManager.bindSparklineHoverEvent)return;let t=!1;n.isPivotTable()?t=n.internalProps.layoutMap.indicatorsDefine.some((e=>typeof e!="string"&&e.cellType==="sparkline")):t=n.internalProps.layoutMap.columnObjects.some((e=>e.cellType==="sparkline"||typeof e.cellType=="function")),t&&(n.eventManager.bindSparklineHoverEvent=!0,n.on(tt.MOUSEMOVE_CELL,(e=>{const{col:i,row:r,x:o,y:s}=e;n.getBodyColumnType(i,r)!=="sparkline"&&n.stateManager.updateSparklineHoverPose(-1,-1,0,0),n.stateManager.updateSparklineHoverPose(i,r,o,s)})),n.on(tt.MOUSELEAVE_TABLE,(e=>{n.stateManager.updateSparklineHoverPose(-1,-1,0,0)})))}function vm(n,t,e=!0){var i,r,o;let{deltaX:s,deltaY:a}=n;n.shiftKey&&n.deltaY&&(s=a,a=0);const[l,h]=gut(s,a,{horizontal:1,vertical:1});(l||h)&&t.interactionState!==Pt.scrolling&&t.updateInteractionState(Pt.scrolling);const u=((r=(i=t.table.options.theme)===null||i===void 0?void 0:i.scrollStyle)===null||r===void 0?void 0:r.visible)==="scrolling";l&&(t.setScrollLeft(t.scroll.horizontalBarPos+l,n),t.showHorizontalScrollBar(u)),h&&(t.setScrollTop(t.scroll.verticalBarPos+h,n),t.showVerticalScrollBar(u)),e&&t.resetInteractionState(t.interactionStateBeforeScroll),!((o=n.nativeEvent)===null||o===void 0)&&o.cancelable&&(t.table.internalProps.overscrollBehavior==="none"||Math.abs(a)>=Math.abs(s)&&a!==0&&wF(a,t)||Math.abs(a)<=Math.abs(s)&&s!==0&&xF(s,t))&&n.nativeEvent.preventDefault()}function gut(n,t,e){var i,r;const o=Math.abs(n/t),s=o<=.5?0:n,a=o>2?0:t;return[Math.ceil(s*((i=e.horizontal)!==null&&i!==void 0?i:0)),Math.ceil(a*((r=e.vertical)!==null&&r!==void 0?r:0))]}function wF(n,t){return t.table.getAllRowsHeight()-t.table.scenegraph.height!=0&&!fut(n,t)&&!put(n,t)}function xF(n,t){return t.table.getAllColsWidth()-t.table.scenegraph.width!=0&&!mut(n,t)&&!vut(n,t)}function fut(n,t){return t.table.getAllRowsHeight()-t.table.scenegraph.height!==0&&n<=0&&t.scroll.verticalBarPos<1}function put(n,t){var e;const i=!((e=t.table.options.customConfig)===null||e===void 0)&&e._disableColumnAndRowSizeRound?1:0,r=t.table.getAllRowsHeight()-t.table.scenegraph.height;return r!==0&&n>=0&&Math.abs(t.scroll.verticalBarPos-r)<1+i}function mut(n,t){return t.table.getAllColsWidth()-t.table.scenegraph.width!==0&&n<=0&&t.scroll.horizontalBarPos<1}function vut(n,t){var e;const i=!((e=t.table.options.customConfig)===null||e===void 0)&&e._disableColumnAndRowSizeRound?1:0,r=t.table.getAllColsWidth()-t.table.scenegraph.width;return r!==0&&n>=0&&Math.abs(t.scroll.horizontalBarPos-r)<1+i}class but{constructor(t){this.stateManager=t}setScrollHandle(t){this.scrollHandle=t}startInertia(t,e,i){this.lastTime=Date.now(),this.speedX=t,this.speedY=e,this.friction=i,this.runingId||(this.runingId=requestAnimationFrame(this.inertia.bind(this)))}inertia(){var t;const e=Date.now(),i=e-this.lastTime;let r=!0;const o=Math.pow(this.friction,i/16),s=o*this.speedX,a=o*this.speedY;let l=0,h=0;Math.abs(s)>.05&&(r=!1,l=(this.speedX+s)/2*i),Math.abs(a)>.05&&(r=!1,h=(this.speedY+a)/2*i),(t=this.scrollHandle)===null||t===void 0||t.call(this,l,h),r?this.runingId=null:(this.lastTime=e,this.speedX=s,this.speedY=a,this.runingId=requestAnimationFrame(this.inertia.bind(this)))}endInertia(){cancelAnimationFrame(this.runingId),this.runingId=null}isInertiaScrolling(){return!!this.runingId}}function c1(n,t,e){var i,r,o,s,a,l,h,u;if(t&&((i=n.stateManager.columnMove)===null||i===void 0?void 0:i.colSource)!==-1&&((r=n.stateManager.columnMove)===null||r===void 0?void 0:r.rowSource)!==-1&&((o=n.stateManager.columnMove)===null||o===void 0?void 0:o.colTarget)!==-1&&((s=n.stateManager.columnMove)===null||s===void 0?void 0:s.rowTarget)!==-1){if(n.hasListeners(tt.CHANGE_HEADER_POSITION)){const{colSource:d,rowSource:c,colTarget:g,rowTarget:f}=n.stateManager.columnMove,p=(a=n.stateManager.columnMove.rowSourceSize)!==null&&a!==void 0?a:0,m=(l=n.stateManager.columnMove.rowTargetSize)!==null&&l!==void 0?l:0;n.fireListeners(tt.CHANGE_HEADER_POSITION,{target:{col:g,row:f+m-p},source:{col:d,row:c},event:e})}}else if(!t&&n.hasListeners(tt.CHANGE_HEADER_POSITION_FAIL)){const d=(h=n.stateManager.columnMove.rowSourceSize)!==null&&h!==void 0?h:0,c=(u=n.stateManager.columnMove.rowTargetSize)!==null&&u!==void 0?u:0;n.fireListeners(tt.CHANGE_HEADER_POSITION_FAIL,{target:{col:n.stateManager.columnMove.colTarget,row:n.stateManager.columnMove.rowTarget+c-d},source:{col:n.stateManager.columnMove.colSource,row:n.stateManager.columnMove.rowSource},event:e})}}function yut(n){const t=n.table,e=t.stateManager;t.scenegraph.tableGroup.addEventListener("pointermove",(i=>{var r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w;const _=(o=(r=t.eventManager.LastPointerXY)===null||r===void 0?void 0:r.x)!==null&&o!==void 0?o:i.x,A=(a=(s=t.eventManager.LastPointerXY)===null||s===void 0?void 0:s.y)!==null&&a!==void 0?a:i.y;t.eventManager.LastPointerXY={x:i.x,y:i.y},n.touchSetTimeout&&(clearTimeout(n.touchSetTimeout),n.touchSetTimeout=void 0);const x=Si(i);if(x.eventArgs&&t.hasListeners(tt.MOUSEMOVE_TABLE)&&t.fireListeners(tt.MOUSEMOVE_TABLE,{col:x.eventArgs.col,row:x.eventArgs.row,x:x.abstractPos.x,y:x.abstractPos.y,event:i.nativeEvent,target:(l=x?.eventArgs)===null||l===void 0?void 0:l.target,mergeCellInfo:(h=x.eventArgs)===null||h===void 0?void 0:h.mergeInfo}),e.interactionState===Pt.grabing)return void(Math.abs(_-i.x)+Math.abs(A-i.y)>=1&&(e.isResizeCol()||e.isResizeRow()||(e.isMoveCol()?n.dealColumnMover(x):e.isFillHandle()?n.dealFillSelect(x,!0):((u=t.options.select)===null||u===void 0?void 0:u.disableDragSelect)||n.dealTableSelect(x,!0))));!(!((d=t.options.select)===null||d===void 0)&&d.disableDragSelect)&&t.eventManager.isDraging&&e.isSelecting()&&!(!((c=t.editorManager)===null||c===void 0)&&c.editingEditor)&&n.dealTableSelect(x,!0);const S=i.path.find((T=>T.role==="cell"));if(t.hasListeners(tt.MOUSELEAVE_CELL)&&(t.stateManager.hover.cellPos.col===-1||t.stateManager.hover.cellPos.row===-1||S?.col===t.stateManager.hover.cellPos.col&&S?.row===t.stateManager.hover.cellPos.row||t.fireListeners(tt.MOUSELEAVE_CELL,{col:t.stateManager.hover.cellPos.col,row:t.stateManager.hover.cellPos.row,cellRange:t.getCellRangeRelativeRect({col:t.stateManager.hover.cellPos.col,row:t.stateManager.hover.cellPos.row}),scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,event:i.nativeEvent,target:(g=x?.eventArgs)===null||g===void 0?void 0:g.target})),t.hasListeners(tt.MOUSEENTER_CELL)&&(S?.role!=="cell"||!$(S.col)||!$(S.row)||S.col===t.stateManager.hover.cellPos.col&&S.row===t.stateManager.hover.cellPos.row||S.col===((f=t.stateManager.hover.cellPosContainHeader)===null||f===void 0?void 0:f.col)&&S.row===((p=t.stateManager.hover.cellPosContainHeader)===null||p===void 0?void 0:p.row)||t.fireListeners(tt.MOUSEENTER_CELL,{col:S.col,row:S.row,cellRange:t.getCellRangeRelativeRect({col:S.col,row:S.row}),scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,event:i.nativeEvent,target:(m=x?.eventArgs)===null||m===void 0?void 0:m.target,mergeCellInfo:(v=x.eventArgs)===null||v===void 0?void 0:v.mergeInfo})),n.dealIconHover(x),n.dealTableHover(x),t.theme.columnResize.visibleOnHover&&n.checkColumnResize(x,!0),x.eventArgs&&t.hasListeners(tt.MOUSEMOVE_CELL)){let T,M;if(!((b=x.eventArgs)===null||b===void 0)&&b.target){const R=ec((y=x.eventArgs)===null||y===void 0?void 0:y.target);R&&(T=R.icon,M=R.position)}t.fireListeners(tt.MOUSEMOVE_CELL,{col:x.eventArgs.col,row:x.eventArgs.row,x:x.abstractPos.x,y:x.abstractPos.y,event:i.nativeEvent,targetIcon:T?{name:T.name,position:M,funcType:T.attribute.funcType}:void 0,target:(C=x?.eventArgs)===null||C===void 0?void 0:C.target,mergeCellInfo:(w=x.eventArgs)===null||w===void 0?void 0:w.mergeInfo})}})),t.scenegraph.tableGroup.addEventListener("pointerout",(i=>{var r;const o=Si(i),s=(r=o?.eventArgs)===null||r===void 0?void 0:r.target;s?.role==="table"&&n.dealTableHover()})),t.scenegraph.tableGroup.addEventListener("pointerover",(i=>{var r,o;const s=Si(i),a=(r=s?.eventArgs)===null||r===void 0?void 0:r.target;if(a&&t.hasListeners(tt.MOUSEOVER_CHART_SYMBOL)&&a.type==="symbol"){const l=i.composedPath().find((h=>h.roll==="cell"));if(l){const{col:h,row:u}=l,d={col:h,row:u,field:t.getHeaderField(h,u),value:t.getCellValue(h,u),dataValue:t.getCellOriginValue(h,u),cellHeaderPaths:t.internalProps.layoutMap.getCellHeaderPaths(h,u),title:t.getBodyColumnDefine(h,u).title,cellRange:t.getCellRelativeRect(h,u),event:i.nativeEvent,sparkline:{pointData:void 0},scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,target:(o=s?.eventArgs)===null||o===void 0?void 0:o.target};t.fireListeners(tt.MOUSEOVER_CHART_SYMBOL,d)}}})),t.scenegraph.tableGroup.addEventListener("pointerenter",(i=>{(t.theme.scrollStyle.horizontalVisible&&t.theme.scrollStyle.horizontalVisible==="focus"||!t.theme.scrollStyle.horizontalVisible&&t.theme.scrollStyle.visible==="focus")&&e.showHorizontalScrollBar(),(t.theme.scrollStyle.verticalVisible&&t.theme.scrollStyle.verticalVisible==="focus"||!t.theme.scrollStyle.verticalVisible&&t.theme.scrollStyle.visible==="focus")&&e.showVerticalScrollBar(),t.hasListeners(tt.MOUSEENTER_TABLE)&&t.fireListeners(tt.MOUSEENTER_TABLE,{event:i.nativeEvent})})),t.scenegraph.tableGroup.addEventListener("pointerleave",(i=>{e.isResizeCol()||e.isResizeRow()||e.isMoveCol()||e.isSelecting()||(e.updateInteractionState(Pt.default),e.updateCursor()),(t.theme.scrollStyle.horizontalVisible&&t.theme.scrollStyle.horizontalVisible==="focus"||!t.theme.scrollStyle.horizontalVisible&&t.theme.scrollStyle.visible==="focus")&&e.hideHorizontalScrollBar(),(t.theme.scrollStyle.verticalVisible&&t.theme.scrollStyle.verticalVisible==="focus"||!t.theme.scrollStyle.verticalVisible&&t.theme.scrollStyle.visible==="focus")&&e.hideVerticalScrollBar(),t.hasListeners(tt.MOUSELEAVE_CELL)&&t.stateManager.hover.cellPos.col!==-1&&t.stateManager.hover.cellPos.row!==-1&&t.fireListeners(tt.MOUSELEAVE_CELL,{col:t.stateManager.hover.cellPos.col,row:t.stateManager.hover.cellPos.row,cellRange:t.getCellRangeRelativeRect({col:t.stateManager.hover.cellPos.col,row:t.stateManager.hover.cellPos.row}),scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,event:i.nativeEvent,target:void 0}),n.dealTableHover();const r=i.target;r&&!r.isDescendantsOf(t.scenegraph.tableGroup)&&t.fireListeners(tt.MOUSELEAVE_TABLE,{event:i.nativeEvent})})),t.scenegraph.tableGroup.addEventListener("pointerdown",(i=>{var r,o,s,a,l;if(t.hasListeners(tt.MOUSEDOWN_TABLE)&&t.fireListeners(tt.MOUSEDOWN_TABLE,{event:i.nativeEvent}),yrt(),t.eventManager.isDown=!0,t.eventManager.LastBodyPointerXY={x:i.x,y:i.y},t.eventManager.LastPointerXY={x:i.x,y:i.y},i.button!==0)return;const h=Si(i);if(n.downIcon=void 0,e.interactionState!==Pt.default||(t.isPivotChart()&&((r=h?.eventArgs)===null||r===void 0?void 0:r.target.type)!=="chart"&&t.scenegraph.updateChartState(null),((o=h.eventArgs)===null||o===void 0?void 0:o.target)!==((s=e.residentHoverIcon)===null||s===void 0?void 0:s.icon)&&e.hideMenu(),((a=h?.eventArgs)===null||a===void 0?void 0:a.target.type)==="chart"))return;const u=(l=t.editorManager)===null||l===void 0?void 0:l.completeEdit(i.nativeEvent);N0(u,(d=>{var c,g,f,p,m,v,b,y,C,w,_,A;if(!(!((c=t.options.customConfig)===null||c===void 0)&&c.selectCellWhenCellEditorNotExists)&&d===!1)return;const x=!((p=(f=(g=h?.eventArgs)===null||g===void 0?void 0:g.target)===null||f===void 0?void 0:f.role)===null||p===void 0)&&p.startsWith("icon")?h.eventArgs.target:!((m=i.target.role)===null||m===void 0)&&m.startsWith("icon")?i.target:void 0;if(n.downIcon=x,x&&x.attribute.interactive!==!1)x.attribute.funcType===me.dragReorder&&(e.startMoveCol(h.eventArgs.col,h.eventArgs.row,h.abstractPos.x,h.abstractPos.y,(_=(w=h.eventArgs)===null||w===void 0?void 0:w.event)===null||_===void 0?void 0:_.nativeEvent),e.updateInteractionState(Pt.grabing));else{if(n.cellIsHeaderCheck(h))return;if(i.pointerType==="touch"){if(n.touchEnd=!1,n.touchSetTimeout=setTimeout((()=>{n.isTouchdown=!1,n.isLongTouch=!0,(n.touchEnd||!n.checkColumnResize(h,!0)&&!n.checkRowResize(h,!0))&&(n.touchEnd||!n.checkColumnMover(h))?n.dealTableSelect(h)&&!n.touchEnd&&e.updateInteractionState(Pt.grabing):e.updateInteractionState(Pt.grabing)}),500),t.hasListeners(tt.MOUSEENTER_CELL)){const S=i.path.find((T=>T.role==="cell"));S?.role!=="cell"||!$(S.col)||!$(S.row)||S.col===t.stateManager.hover.cellPos.col&&S.row===t.stateManager.hover.cellPos.row||S.col===((v=t.stateManager.hover.cellPosContainHeader)===null||v===void 0?void 0:v.col)&&S.row===((b=t.stateManager.hover.cellPosContainHeader)===null||b===void 0?void 0:b.row)||t.fireListeners(tt.MOUSEENTER_CELL,{col:S.col,row:S.row,cellRange:t.getCellRangeRelativeRect({col:S.col,row:S.row}),scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,event:i.nativeEvent,target:(y=h?.eventArgs)===null||y===void 0?void 0:y.target,mergeCellInfo:(C=h.eventArgs)===null||C===void 0?void 0:C.mergeInfo})}n.dealTableHover(h)}else{if(!n.checkCellFillhandle(h)&&(n.checkColumnResize(h,!0)||n.checkRowResize(h,!0)))return t.scenegraph.updateChartState(null),void e.updateInteractionState(Pt.grabing);if(n.checkColumnMover(h)||n.checkCellFillhandle(h,!0)&&n.dealFillSelect(h))return void e.updateInteractionState(Pt.grabing);n.dealTableSelect(h)&&e.updateInteractionState(Pt.grabing)}}if(t.hasListeners(tt.MOUSEDOWN_CELL)){const S=Si(i);S.eventArgs&&t.fireListeners(tt.MOUSEDOWN_CELL,{col:S.eventArgs.col,row:S.eventArgs.row,event:i.nativeEvent,target:(A=S?.eventArgs)===null||A===void 0?void 0:A.target,mergeCellInfo:S.eventArgs.mergeInfo})}}))})),t.scenegraph.tableGroup.addEventListener("pointerup",(i=>{var r,o,s,a,l,h,u,d;if(i.button===0){if(e.interactionState==="grabing"){if(e.updateInteractionState(Pt.default),e.isResizeCol())bm(t);else if(e.isResizeRow())ym(t);else if(e.isMoveCol()){const c=t.stateManager.endMoveCol();c1(t,c,i.nativeEvent)}else if(e.isSelecting()){t.stateManager.endSelectCells(),t.stateManager.isFillHandle()&&t.stateManager.endFillSelect();const c=Si(i);if(t.eventManager.isDraging&&c.eventArgs&&t.hasListeners(tt.DRAG_SELECT_END)){const g={event:i.nativeEvent,cells:[],col:c.eventArgs.target.col,row:c.eventArgs.target.row,scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,target:(r=c?.eventArgs)===null||r===void 0?void 0:r.target,mergeCellInfo:(o=c.eventArgs)===null||o===void 0?void 0:o.mergeInfo};g.cells=t.getSelectedCellInfos(),t.fireListeners(tt.DRAG_SELECT_END,g)}}}else e.interactionState===Pt.scrolling&&e.updateInteractionState(Pt.default);if(!t.eventManager.isDraging){const c=Si(i);if(!n.isTouchMove&&i.button===0&&c.eventArgs&&t.hasListeners(tt.CLICK_CELL)){const{col:g,row:f}=c.eventArgs,p=t.getCellInfo(g,f);let m,v;if(!((s=c.eventArgs)===null||s===void 0)&&s.target){const y=ec((a=c.eventArgs)===null||a===void 0?void 0:a.target);y&&(m=y.icon,v=y.position)}const b=Object.assign(Object.assign({},p),{event:i.nativeEvent,federatedEvent:i,cells:[],targetIcon:m?{name:m.name,position:v,funcType:m.attribute.funcType}:void 0,target:(l=c?.eventArgs)===null||l===void 0?void 0:l.target,mergeCellInfo:(h=c.eventArgs)===null||h===void 0?void 0:h.mergeInfo});t.fireListeners(tt.CLICK_CELL,b)}}if(t.hasListeners(tt.MOUSEUP_CELL)){const c=Si(i);c.eventArgs&&t.fireListeners(tt.MOUSEUP_CELL,{col:c.eventArgs.col,row:c.eventArgs.row,event:i.nativeEvent,target:(u=c?.eventArgs)===null||u===void 0?void 0:u.target,mergeCellInfo:(d=c.eventArgs)===null||d===void 0?void 0:d.mergeInfo})}setTimeout((()=>{n.isDown=!1,n.isTouchdown=!1,n.isTouchMove=!1,n.isDraging=!1,n.touchMovePoints=[]}),0)}})),t.scenegraph.tableGroup.addEventListener("rightdown",(i=>{var r,o,s,a,l,h,u;const d=Si(i);if(d.eventArgs){e.triggerContextMenu(d.eventArgs.col,d.eventArgs.row,d.abstractPos.x,d.abstractPos.y);const{col:c,row:g}=d.eventArgs;if(c>=0&&g>=0){const f=t.getSelectedCellRanges();let p=!1;if(f.length>0)for(let v=0;v<f.length;v++){const b=f[v],y=b.start.col,C=b.end.col,w=b.start.row,_=b.end.row;if(c>=y&&c<=C&&g>=w&&g<=_||c>=C&&c<=y&&g>=_&&g<=w||c>=y&&c<=C&&g>=_&&g<=w||c>=C&&c<=y&&g>=w&&g<=_){p=!0;break}}const m=(r=t.options.select)===null||r===void 0?void 0:r.disableSelectOnContextMenu;if(p||m||t.selectCell(c,g),t.hasListeners(tt.CONTEXTMENU_CELL)){const v=t.getCellInfo(c,g);let b,y;if(!((o=d.eventArgs)===null||o===void 0)&&o.target){const w=ec((s=d.eventArgs)===null||s===void 0?void 0:s.target);w&&(b=w.icon,y=w.position)}const C=Object.assign(Object.assign({},v),{event:i.nativeEvent,cells:[],targetIcon:b?{name:b.name,position:y,funcType:b.attribute.funcType}:void 0,target:(a=d?.eventArgs)===null||a===void 0?void 0:a.target,mergeCellInfo:(l=d.eventArgs)===null||l===void 0?void 0:l.mergeInfo});((u=(h=t.options.eventOptions)===null||h===void 0?void 0:h.contextmenuReturnAllSelectedCells)===null||u===void 0||u)&&(zrt(t.stateManager.select.ranges,c,g)?C.cells=t.getSelectedCellInfos():C.cells=[[v]]),t.fireListeners(tt.CONTEXTMENU_CELL,C)}}}})),t.scenegraph.tableGroup.addEventListener("pointertap",(i=>{var r;if(t.stateManager.columnResize.resizing)return;const o=Si(i);if(!t.stateManager.columnResize.resizing&&!t.stateManager.columnMove.moving&&(n.dealIconClick(i,o),o?.eventArgs&&n.touchSetTimeout&&i.pointerType==="touch")){const s=Si(i);if(n.touchSetTimeout){clearTimeout(n.touchSetTimeout);const a=!!(!((r=e.select.ranges)===null||r===void 0)&&r.length);n.dealTableSelect(s),e.endSelectCells(!0,a),n.touchSetTimeout=void 0}}})),t.scenegraph.stage.addEventListener("pointerdown",(i=>{var r,o,s,a;const l=Si(i);!((r=l.eventArgs)===null||r===void 0)&&r.target&&((o=l.eventArgs)===null||o===void 0?void 0:o.target)===((s=e.residentHoverIcon)===null||s===void 0?void 0:s.icon)||e.hideMenu();let h=!1;const u=i.target;u===t.scenegraph.tableGroup||u.isDescendantsOf(t.scenegraph.tableGroup)||(h=(a=t.editorManager)===null||a===void 0?void 0:a.completeEdit(i.nativeEvent)),N0(h,(d=>{var c,g;if(!(!((c=t.options.customConfig)===null||c===void 0)&&c.selectCellWhenCellEditorNotExists)&&d===!1)return;const f=!((g=i.target.role)===null||g===void 0)&&g.startsWith("icon")?i.target:void 0;if(n.downIcon=f,!(i.pointerType==="touch"||f||n.checkCellFillhandle(l)||e.columnResize.resizing||!n.checkColumnResize(l,!0))){t.scenegraph.updateChartState(null),e.updateInteractionState(Pt.grabing);const{eventArgs:p}=l;p?.targetCell||t.getCellAt(l.abstractPos.x-t.theme.columnResize.resizeHotSpotSize/2,l.abstractPos.y)&&t.hasListeners(tt.MOUSEDOWN_TABLE)&&t.fireListeners(tt.MOUSEDOWN_TABLE,{event:i.nativeEvent})}}))})),t.scenegraph.stage.addEventListener("pointerup",(i=>{e.interactionState==="grabing"&&(e.updateInteractionState(Pt.default),e.isResizeCol()?bm(t):e.isResizeRow()&&ym(t))})),t.scenegraph.stage.addEventListener("pointertap",(i=>{var r,o,s,a,l;const h=i.target;if(t.eventManager.isDraging||!h||!h.isDescendantsOf(t.scenegraph.stage)&&h.stage!==h||h.isDescendantsOf(t.scenegraph.tableGroup))t.eventManager.isDraging&&e.isSelecting()&&e.endSelectCells();else{e.updateInteractionState(Pt.default),n.dealTableHover();const u=!!(!((r=e.select.ranges)===null||r===void 0)&&r.length);!((o=t.options.customConfig)===null||o===void 0)&&o.cancelSelectCellHook?!((s=t.options.customConfig)===null||s===void 0)&&s.cancelSelectCellHook(i)&&n.dealTableSelect():((l=(a=t.options.select)===null||a===void 0?void 0:a.blankAreaClickDeselect)===null||l===void 0||l)&&n.dealTableSelect(),e.endSelectCells(!0,u),e.updateCursor(),t.scenegraph.updateChartState(null)}})),t.scenegraph.stage.addEventListener("pointermove",(i=>{const r=Si(i);e.isResizeCol()||n.checkColumnResize(r)?t.stateManager.select&&n.checkCellFillhandle(r)?e.updateCursor("crosshair"):e.updateCursor("col-resize"):e.isResizeRow()||n.checkRowResize(r)?t.stateManager.select&&n.checkCellFillhandle(r)?e.updateCursor("crosshair"):e.updateCursor("row-resize"):e.isMoveCol()||e.updateCursor()})),t.scenegraph.tableGroup.addEventListener("checkbox_state_change",(i=>{var r,o;const s=Si(i),{col:a,row:l}=s.eventArgs,h=t.getCellInfo(a,l),u=mi(t,a,l);if(u)for(let c=u.start.col;c<=u.end.col;c++)for(let g=u.start.row;g<=u.end.row;g++)t.scenegraph.getCell(c,g).forEachChildren((f=>{f.name==="checkbox"&&f.setAttributes({checked:i.target.attribute.checked,indeterminate:i.target.attribute.indeterminate})}));const d=Object.assign(Object.assign({},h),{event:i.nativeEvent,target:(r=s?.eventArgs)===null||r===void 0?void 0:r.target,mergeCellInfo:(o=s?.eventArgs)===null||o===void 0?void 0:o.mergeInfo,checked:i.detail.checked});if(t.isHeader(a,l))t.stateManager.setHeaderCheckedState(h.field,i.detail.checked),t.internalProps.enableHeaderCheckboxCascade&&t.getCellType(a,l)==="checkbox"&&t.scenegraph.updateCheckboxCellState(a,l,i.detail.checked);else if(t.stateManager.setCheckedState(a,l,h.field,i.detail.checked),t.internalProps.enableCheckboxCascade&&t.getCellType(a,l)==="checkbox"){const c=t.stateManager.headerCheckedState[h.field],g=t.stateManager.updateHeaderCheckedState(h.field,a,l);c!==g&&t.scenegraph.updateHeaderCheckboxCellState(a,l,g)}t.fireListeners(tt.CHECKBOX_STATE_CHANGE,d),t.scenegraph.updateNextFrame()})),t.scenegraph.tableGroup.addEventListener("radio_checked",(i=>{var r,o,s;const a=Si(i),{col:l,row:h,target:u}=a.eventArgs,d=t.getCellInfo(l,h),c=(r=Kst.exec(u.id))===null||r===void 0?void 0:r[1],g=mi(t,l,h);if(g)for(let v=g.start.col;v<=g.end.col;v++)for(let b=g.start.row;b<=g.end.row;b++)t.scenegraph.getCell(v,b).forEachChildren((y=>{y.name==="radio"&&y.id===u.id&&y.setAttributes({checked:!0})}));const f=t.getBodyColumnDefine(l,h).radioCheckType||"column";if(f==="cell")if(g)for(let v=g.start.col;v<=g.end.col;v++)for(let b=g.start.row;b<=g.end.row;b++)t.scenegraph.getCell(v,b).forEachChildren((y=>{y.name==="radio"&&y.id!==u.id&&y.setAttributes({checked:!1})}));else t.scenegraph.getCell(l,h).forEachChildren((v=>{v.name==="radio"&&v.id!==u.id&&v.setAttributes({checked:!1})}));else f==="column"&&t.scenegraph.getColGroup(l).forEachChildren((v=>{v.forEachChildren((b=>{b.name==="radio"&&b.id!==u.id&&b.setAttributes({checked:!1})}))}));const p=c?Number(c):void 0;t.stateManager.setRadioState(l,h,d.field,f,p);const m=Object.assign(Object.assign({},d),{event:i.nativeEvent,target:(o=a?.eventArgs)===null||o===void 0?void 0:o.target,mergeCellInfo:(s=a?.eventArgs)===null||s===void 0?void 0:s.mergeInfo,radioIndexInCell:p});t.fireListeners(tt.RADIO_STATE_CHANGE,m),t.scenegraph.updateNextFrame()})),t.scenegraph.tableGroup.addEventListener("switch_state_change",(i=>{var r,o;const s=Si(i),{col:a,row:l,target:h}=s.eventArgs,u=t.getCellInfo(a,l),d=mi(t,a,l);if(d)for(let g=d.start.col;g<=d.end.col;g++)for(let f=d.start.row;f<=d.end.row;f++)t.scenegraph.getCell(g,f).forEachChildren((p=>{p.name==="switch"&&p.setAttributes({checked:i.target.attribute.checked})}));const c=Object.assign(Object.assign({},u),{event:i.nativeEvent,target:(r=s?.eventArgs)===null||r===void 0?void 0:r.target,mergeCellInfo:(o=s?.eventArgs)===null||o===void 0?void 0:o.mergeInfo,checked:i.detail.checked});t.stateManager.setCheckedState(a,l,u.field,i.detail.checked),t.fireListeners(tt.SWITCH_STATE_CHANGE,c),t.scenegraph.updateNextFrame()})),t.scenegraph.stage.addEventListener("wheel",(i=>{var r;i.path.find((o=>o.name==="legend"))||((r=t.editorManager)===null||r===void 0||r.completeEdit(),t.eventManager._enableTableScroll&&vm(i,e))}))}function Cut(n){const t=n.table;n.gesture=new LZ(t.scenegraph.tableGroup,{tap:{interval:300}}),n.gesture.on("doubletap",(e=>{_ut(e,t)}))}function bm(n){n.stateManager.endResizeCol();const t=[];for(let e=0;e<n.colCount;e++)t.push(n.getColWidth(e));n.fireListeners(tt.RESIZE_COLUMN_END,{col:n.stateManager.columnResize.col,colWidths:t})}function ym(n){n.stateManager.endResizeRow(),n.fireListeners(tt.RESIZE_ROW_END,{row:n.stateManager.rowResize.row,rowHeight:n.getRowHeight(n.stateManager.rowResize.row)})}function _ut(n,t){var e,i,r,o,s,a;const l=Si(n);let h=-1,u=-1;l.eventArgs&&(h=l.eventArgs.col,u=l.eventArgs.row);const d=t.getCellValue(h,u),c=(i=(e=l.eventArgs)===null||e===void 0?void 0:e.targetCell)===null||i===void 0?void 0:i.globalAABBBounds;if(c&&t.internalProps.focusControl.setFocusRect(new To(c.x1+t.scrollLeft,c.y1+t.scrollTop,c.x2-c.x1,c.y2-c.y1),d),t.hasListeners(tt.DBLCLICK_CELL)){const g=t.getCellInfo(h,u);let f,p;if(!((r=l.eventArgs)===null||r===void 0)&&r.target){const v=ec((o=l.eventArgs)===null||o===void 0?void 0:o.target);v&&(f=v.icon,p=v.position)}const m=Object.assign(Object.assign({},g),{event:n.nativeEvent,federatedEvent:n,cells:[],targetIcon:f?{name:f.name,position:p,funcType:f.attribute.funcType}:void 0,target:(s=l?.eventArgs)===null||s===void 0?void 0:s.target,mergeCellInfo:(a=l?.eventArgs)===null||a===void 0?void 0:a.mergeInfo});t.fireListeners(tt.DBLCLICK_CELL,m)}}function wut(n){const t=n.table,e=t.stateManager,i=t.scenegraph;i.component.vScrollBar.addEventListener("pointerover",(s=>{e.showVerticalScrollBar()})),i.component.hScrollBar.addEventListener("pointerover",(s=>{e.showHorizontalScrollBar()})),i.component.vScrollBar.addEventListener("pointerout",(s=>{e.interactionState!==Pt.scrolling&&e.hideVerticalScrollBar()})),i.component.hScrollBar.addEventListener("pointerout",(s=>{e.interactionState!==Pt.scrolling&&e.hideHorizontalScrollBar()})),i.component.vScrollBar.addEventListener("pointermove",(s=>{i.table.stateManager.updateCursor("default"),s.stopPropagation()})),i.component.vScrollBar.addEventListener("pointerdown",(s=>{s.stopPropagation(),i.table.hasListeners(tt.MOUSEDOWN_TABLE)&&i.table.fireListeners(tt.MOUSEDOWN_TABLE,{event:s.nativeEvent})})),i.component.vScrollBar.addEventListener("scrollDown",(s=>{var a;i.table.eventManager.LastBodyPointerXY={x:s.x,y:s.y},i.table.eventManager.isDown=!0,e.interactionState!==Pt.scrolling&&e.updateInteractionState(Pt.scrolling),i.table.stateManager.hideMenu(),(a=i.table.editorManager)===null||a===void 0||a.completeEdit(),i.table.hasListeners(tt.MOUSEDOWN_TABLE)&&i.table.fireListeners(tt.MOUSEDOWN_TABLE,{event:s.nativeEvent})})),i.component.vScrollBar.addEventListener("pointerup",(()=>{e.fastScrolling=!1,i.table.eventManager.isDraging=!1,e.interactionState===Pt.scrolling&&e.updateInteractionState(Pt.default)})),i.component.vScrollBar.addEventListener("pointerupoutside",(()=>{e.fastScrolling=!1,e.interactionState===Pt.scrolling&&e.updateInteractionState(Pt.default)})),i.component.vScrollBar.addEventListener("scrollUp",(s=>{i.table.eventManager.isDraging=!1})),i.component.hScrollBar.addEventListener("pointermove",(s=>{i.table.stateManager.updateCursor(),s.stopPropagation()})),i.component.hScrollBar.addEventListener("pointerdown",(s=>{s.stopPropagation(),i.table.hasListeners(tt.MOUSEDOWN_TABLE)&&i.table.fireListeners(tt.MOUSEDOWN_TABLE,{event:s.nativeEvent})})),i.component.hScrollBar.addEventListener("scrollDown",(s=>{var a;i.table.eventManager.LastBodyPointerXY={x:s.x,y:s.y},i.table.eventManager.isDown=!0,e.interactionState!==Pt.scrolling&&e.updateInteractionState(Pt.scrolling),i.table.stateManager.hideMenu(),(a=i.table.editorManager)===null||a===void 0||a.completeEdit(),i.table.hasListeners(tt.MOUSEDOWN_TABLE)&&i.table.fireListeners(tt.MOUSEDOWN_TABLE,{event:s.nativeEvent})})),i.component.hScrollBar.addEventListener("pointerup",(()=>{e.fastScrolling=!1,i.table.eventManager.isDraging=!1,e.interactionState===Pt.scrolling&&e.updateInteractionState(Pt.default)})),i.component.hScrollBar.addEventListener("pointerupoutside",(()=>{e.fastScrolling=!1,e.interactionState===Pt.scrolling&&e.updateInteractionState(Pt.default)})),i.component.hScrollBar.addEventListener("scrollUp",(s=>{i.table.eventManager.isDraging=!1}));const r=PB(e.updateVerticalScrollBar,20),o=PB(e.updateHorizontalScrollBar,20);i.component.vScrollBar.addEventListener("scrollDrag",(s=>{i.table.eventManager.isDown&&(i.table.eventManager.isDraging=!0),e.fastScrolling=!0,e.interactionState!==Pt.scrolling&&e.updateInteractionState(Pt.scrolling);const a=s.detail.value[0]/(1-s.detail.value[1]+s.detail.value[0]);r(a,s)})),i.component.hScrollBar.addEventListener("scrollDrag",(s=>{i.table.eventManager.isDown&&(i.table.eventManager.isDraging=!0),e.fastScrolling=!0,e.interactionState!==Pt.scrolling&&e.updateInteractionState(Pt.scrolling);const a=s.detail.value[0]/(1-s.detail.value[1]+s.detail.value[0]);o(a)}))}let Ya=1;function SF(){return pD?Ya=1:(Ya=Math.ceil(window.devicePixelRatio||1),Ya>1&&Ya%2!=0&&(Ya+=1)),Ya}SF();var IC=function(n,t,e,i){return new(e||(e=Promise))((function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e((function(d){d(u)}))).then(s,a)}l((i=i.apply(n,t||[])).next())}))};function xut(n){const t=n.table,e=t.stateManager,i=t.internalProps.handler;function r(l){var h;if(t.hasListeners(tt.KEYDOWN)){const u={keyCode:(h=l.keyCode)!==null&&h!==void 0?h:l.which,code:l.code,event:l,scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth};t.fireListeners(tt.KEYDOWN,u)}}i.on(t.getElement(),"blur",(l=>{n.dealTableHover()})),i.on(t.getElement(),"keydown",(l=>{var h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x,S,T,M,R,E,P,B,k,L,O,I,H,D,z,G,U,j,X;const Z={keyCode:(h=l.keyCode)!==null&&h!==void 0?h:l.which,code:l.code,event:l};if(t.fireListeners(tt.BEFORE_KEYDOWN,Z),l.key==="a"&&(l.ctrlKey||l.metaKey))!((u=t.keyboardOptions)===null||u===void 0)&&u.selectAllOnCtrlA&&(l.preventDefault(),n.deelTableSelectAll());else if(e.select.cellPos.col>=0&&e.select.cellPos.row>=0&&(l.key==="ArrowUp"||l.key==="ArrowDown"||l.key==="ArrowLeft"||l.key==="ArrowRight")){if(((c=(d=t.options.keyboardOptions)===null||d===void 0?void 0:d.moveEditCellOnArrowKeys)===null||c===void 0||!c)&&(!((g=t.editorManager)===null||g===void 0)&&g.editingEditor)||((f=t.options.keyboardOptions)===null||f===void 0?void 0:f.moveSelectedCellOnArrowKeys)===!1)return;let J,q;if(l.preventDefault(),l.stopPropagation(),l.key==="ArrowUp"?l.ctrlKey||l.metaKey?(J=e.select.cellPos.col,q=0):(l.shiftKey,J=e.select.cellPos.col,q=Math.min(t.rowCount-1,Math.max(0,e.select.cellPos.row-1))):l.key==="ArrowDown"?l.ctrlKey||l.metaKey?(J=e.select.cellPos.col,q=t.rowCount-1):(l.shiftKey,J=e.select.cellPos.col,q=Math.min(t.rowCount-1,Math.max(0,e.select.cellPos.row+1))):l.key==="ArrowLeft"?l.ctrlKey||l.metaKey?(J=0,q=e.select.cellPos.row):(l.shiftKey,q=e.select.cellPos.row,J=Math.min(t.colCount-1,Math.max(0,e.select.cellPos.col-1))):l.key==="ArrowRight"&&(l.ctrlKey||l.metaKey?(J=t.colCount-1,q=e.select.cellPos.row):(l.shiftKey,q=e.select.cellPos.row,J=Math.min(t.colCount-1,Math.max(0,e.select.cellPos.col+1)))),ra(t,J,q))return;const st=(m=(p=t.options.keyboardOptions)===null||p===void 0?void 0:p.shiftMultiSelect)===null||m===void 0||m;t.selectCell(J,q,l.shiftKey&&st),(b=(v=t.options.keyboardOptions)===null||v===void 0?void 0:v.moveEditCellOnArrowKeys)!==null&&b!==void 0&&b&&(!((y=t.editorManager)===null||y===void 0)&&y.editingEditor)&&((C=t.editorManager)===null||C===void 0||C.completeEdit(),t.getElement().focus(),t.getEditor(J,q)&&((w=t.editorManager)===null||w===void 0||w.startEditCell(J,q)))}else if(l.key==="Escape")(_=t.editorManager)===null||_===void 0||_.cancelEdit(),t.getElement().focus();else if(l.key==="Enter"){if(!((A=t.editorManager)===null||A===void 0)&&A.editingEditor){if(r(l),(x=t.editorManager)===null||x===void 0||x.completeEdit(),t.getElement().focus(),((S=t.options.keyboardOptions)===null||S===void 0?void 0:S.moveFocusCellOnEnter)===!0){const J=e.select.cellPos.col,q=Math.min(t.rowCount-1,Math.max(0,e.select.cellPos.row+1));if(ra(t,J,q))return;const st=(M=(T=t.options.keyboardOptions)===null||T===void 0?void 0:T.shiftMultiSelect)===null||M===void 0||M;t.selectCell(J,q,l.shiftKey&&st)}return}if(((R=t.options.keyboardOptions)===null||R===void 0?void 0:R.moveFocusCellOnEnter)===!0){const J=e.select.cellPos.col,q=Math.min(t.rowCount-1,Math.max(0,e.select.cellPos.row+1));if(ra(t,J,q))return;const st=(P=(E=t.options.keyboardOptions)===null||E===void 0?void 0:E.shiftMultiSelect)===null||P===void 0||P;t.selectCell(J,q,l.shiftKey&&st)}else if(((k=(B=t.options.keyboardOptions)===null||B===void 0?void 0:B.editCellOnEnter)===null||k===void 0||k)&&((O=(L=t.stateManager.select.ranges)===null||L===void 0?void 0:L.length)!==null&&O!==void 0?O:0)===1){const J=t.stateManager.select.ranges[0].start.col,q=t.stateManager.select.ranges[0].start.row,st=t.stateManager.select.ranges[0].end.col,Q=t.stateManager.select.ranges[0].end.row;J===st&&q===Q&&t.getEditor(J,q)&&((I=t.editorManager)===null||I===void 0||I.startEditCell(J,q))}}else if(l.key==="Tab"){if(((D=(H=t.options.keyboardOptions)===null||H===void 0?void 0:H.moveFocusCellOnTab)===null||D===void 0||D)&&e.select.cellPos.col>=0&&e.select.cellPos.row>=0){if(e.select.cellPos.col===t.colCount-1&&e.select.cellPos.row===t.rowCount-1)return;let J,q;if(l.preventDefault(),e.select.cellPos.col===t.colCount-1?(q=Math.min(t.rowCount-1,e.select.cellPos.row+1),J=t.rowHeaderLevelCount):(q=e.select.cellPos.row,J=e.select.cellPos.col+1),ra(t,J,q))return;t.selectCell(J,q),!((z=t.editorManager)===null||z===void 0)&&z.editingEditor&&((G=t.editorManager)===null||G===void 0||G.completeEdit(),t.getElement().focus(),t.getEditor(J,q)&&((U=t.editorManager)===null||U===void 0||U.startEditCell(J,q)))}}else if(!l.ctrlKey&&!l.metaKey){const J=t.options.editCellTrigger;if((J==="keydown"||Array.isArray(J)&&J.includes("keydown"))&&!(!((j=t.editorManager)===null||j===void 0)&&j.editingEditor)){const q=/^[a-zA-Z0-9+\-*\/%=.,\s]$/;l.key.match(q)&&(t.editorManager&&(t.editorManager.beginTriggerEditCellMode="keydown"),(X=t.editorManager)===null||X===void 0||X.startEditCell(e.select.cellPos.col,e.select.cellPos.row,""))}}r(l)})),i.on(t.getElement(),"copy",(l=>IC(this,void 0,void 0,(function*(){var h;!((h=t.keyboardOptions)===null||h===void 0)&&h.copySelected&&n.handleCopy(l)})))),i.on(t.getElement(),"cut",(l=>IC(this,void 0,void 0,(function*(){var h;!((h=t.keyboardOptions)===null||h===void 0)&&h.cutSelected&&n.handleCut(l)})))),i.on(t.getElement(),"paste",(l=>IC(this,void 0,void 0,(function*(){var h;!((h=t.keyboardOptions)===null||h===void 0)&&h.pasteValueToCell&&n.handlePaste(l)})))),i.on(t.getElement(),"contextmenu",(l=>{var h;((h=t.eventOptions)===null||h===void 0?void 0:h.preventDefaultContextMenu)!==!1?l.preventDefault():s(l)})),t.options.canvas||i.on(t.getContainer(),"resize",(l=>{var h;t.isReleased||l.width===0&&l.height===0||((t.autoFillWidth||t.autoFillHeight)&&((h=t.editorManager)===null||h===void 0||h.completeEdit()),$(t.options.pixelRatio)||t.setPixelRatio(SF()),l.windowSizeNotChange||t.resize())}));const o=l=>{var h;if(t.isReleased)return;t.eventManager.LastBodyPointerXY={x:l.x,y:l.y},t.eventManager.isDown=!0;const u=l.target;if(!t.getElement().contains(u)&&!t.internalProps.menuHandler.containElement(u)){const d=(h=t.editorManager)===null||h===void 0?void 0:h.completeEdit(l);N0(d,(c=>{var g,f;if(c!==!1&&(!((g=t.options.select)===null||g===void 0)&&g.outsideClickDeselect)){const p=!!(!((f=e.select.ranges)===null||f===void 0)&&f.length);n.dealTableSelect(),e.endSelectCells(!0,p)}}))}};n.globalEventListeners.push({name:"pointerdown",env:"vglobal",callback:o}),Bt.addEventListener("pointerdown",o);const s=l=>{var h,u;if(t.isReleased)return;const d=l.target;if(d!==t.canvas&&(c=>{var g,f;if(e.menu.isShow&&setTimeout((()=>{t.internalProps.menuHandler.pointInMenuElement(c.clientX,c.clientY)||e.menu.isShow&&e.hideMenu()}),0),e.isResizeCol())bm(t);else if(e.isResizeRow())ym(t);else if(e.isMoveCol()){const p=t.stateManager.endMoveCol();c1(t,p,c)}else if(e.isSelecting()&&(!((f=(g=t.stateManager.select)===null||g===void 0?void 0:g.ranges)===null||f===void 0)&&f.length)){const p=t.stateManager.select.ranges[t.stateManager.select.ranges.length-1].end.col,m=t.stateManager.select.ranges[t.stateManager.select.ranges.length-1].end.row;if(t.stateManager.endSelectCells(),t.hasListeners(tt.DRAG_SELECT_END)){const v={event:c,cells:[],col:p,row:m,scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,target:void 0};v.cells=t.getSelectedCellInfos(),t.fireListeners(tt.DRAG_SELECT_END,v)}}})(l),t.eventManager.LastBodyPointerXY=null,t.eventManager.isDown=!1,t.eventManager.isDraging=!1,t.eventManager.inertiaScroll.endInertia(),e.interactionState==="grabing"&&e.isResizeCol())bm(t);else if(e.interactionState==="grabing"&&e.isResizeRow())ym(t);else if(e.isMoveCol()){const c=t.stateManager.endMoveCol();c1(t,c,l)}else if(!((h=t.editorManager)===null||h===void 0)&&h.editingEditor&&!t.getElement().contains(d)){const c=(u=t.editorManager)===null||u===void 0?void 0:u.completeEdit(l);N0(c,(g=>{g!==!1&&(e.updateInteractionState(Pt.default),n.dealTableHover())}))}e.updateInteractionState(Pt.default)};n.globalEventListeners.push({name:"pointerup",env:"vglobal",callback:s}),Bt.addEventListener("pointerup",s);const a=l=>{var h,u,d,c,g;if(t.eventManager.isDown&&t.eventManager.LastBodyPointerXY){const v=(u=(h=t.eventManager.LastBodyPointerXY)===null||h===void 0?void 0:h.x)!==null&&u!==void 0?u:l.x,b=(c=(d=t.eventManager.LastBodyPointerXY)===null||d===void 0?void 0:d.y)!==null&&c!==void 0?c:l.y;(Math.abs(v-l.x)>1||Math.abs(b-l.y)>1)&&(t.eventManager.isDraging=!0)}const{x:f,y:p}=t._getMouseAbstractPoint(l);e.interactionState===Pt.grabing&&(e.isResizeCol()?(n.dealColumnResize(f,p),t.hasListeners(tt.RESIZE_COLUMN)&&t.fireListeners(tt.RESIZE_COLUMN,{col:t.stateManager.columnResize.col,colWidth:t.getColWidth(t.stateManager.columnResize.col)})):e.isResizeRow()&&(n.dealRowResize(f,p),t.hasListeners(tt.RESIZE_ROW)&&t.fireListeners(tt.RESIZE_ROW,{row:t.stateManager.rowResize.row,rowHeight:t.getRowHeight(t.stateManager.rowResize.row)})));const m=t.stateManager.isSelecting();if(n._enableTableScroll&&n.isDraging&&m&&((g=t.stateManager.select.ranges)===null||g===void 0?void 0:g.length)>0){const v=t.getDrawRange(),b=t.getFrozenRowsHeight(),y=t.getBottomFrozenRowsHeight(),C=t.getFrozenColsWidth(),w=t.getRightFrozenColsWidth(),_=t.stateManager.select.ranges[t.stateManager.select.ranges.length-1].start;if(t.isSeriesNumber(_.col,_.row))return;const A=t.stateManager.select.ranges[t.stateManager.select.ranges.length-1].end,x=(t.isFrozenRow(_.row)===!1||t.isFrozenRow(A.row)===!1)&&t.getAllRowsHeight()>t.tableNoFrameHeight,S=(t.isFrozenColumn(_.col)===!1||t.isFrozenColumn(A.col)===!1)&&t.getAllColsWidth()>t.tableNoFrameWidth;if((p>v.bottom-y||p<v.top+b)&&x||(f>v.right-w||f<v.left+C)&&S){t.eventManager.scrollXSpeed=0,t.eventManager.scrollYSpeed=0;let T=!1,M=!1,R=!1,E=!1;p>v.bottom-y&&x&&t.scrollTop+t.tableNoFrameHeight<t.getAllRowsHeight()?(T=!0,t.eventManager.scrollYSpeed=-(p-v.bottom+y)/50):p<v.top+b&&x&&t.scrollTop>0&&(M=!0,t.eventManager.scrollYSpeed=-(p-v.top-b)/50),f>v.right-w&&S&&t.scrollLeft+t.tableNoFrameWidth<t.getAllColsWidth()?(R=!0,t.eventManager.scrollXSpeed=-(f-v.right+w)/50):f<v.left+C&&S&&t.scrollLeft>0&&(E=!0,t.eventManager.scrollXSpeed=-(f-v.left-C)/50),t.eventManager.inertiaScroll.startInertia(t.eventManager.scrollXSpeed,t.eventManager.scrollYSpeed,1),t.eventManager.inertiaScroll.setScrollHandle(((P,B)=>{var k;let L,O;vm({deltaX:-P,deltaY:-B},t.stateManager,!1),T?O=t.scrollTop+v.height-y-20:M&&(O=t.scrollTop+b+20),R?L=t.scrollLeft+v.width-w-20:E&&(L=t.scrollLeft+C+20);let I=!1,H=!1;R||E||(f>t.tableNoFrameWidth-t.getRightFrozenColsWidth()&&f<t.tableNoFrameWidth||f>0&&f<t.getFrozenColsWidth()?(L=f,H=!0):L=t.scrollLeft+f),T||M||(p>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight()&&p<t.tableNoFrameHeight||p>0&&p<t.getFrozenRowsHeight()?(O=p,I=!0):O=t.scrollTop+p),t.stateManager.updateInteractionState(Pt.grabing);const D=t.getTargetColAtConsiderRightFrozen(L,H),z=t.getTargetRowAtConsiderBottomFrozen(O,I);!(!((k=t.options.select)===null||k===void 0)&&k.disableDragSelect)&&$(D)&&$(z)&&t.stateManager.updateSelectPos(t.stateManager.select.selectInline==="row"?t.colCount-1:D.col,t.stateManager.select.selectInline==="col"?t.rowCount-1:z.row,!1,!1,!1,!1)}))}else t.eventManager.inertiaScroll.isInertiaScrolling()?t.eventManager.inertiaScroll.endInertia():t.eventManager.scrollYSpeed=0}};n.globalEventListeners.push({name:"pointermove",env:"vglobal",callback:a}),Bt.addEventListener("pointermove",a)}function Sut(n){const t=n.table,e=t.stateManager,i=t.scenegraph;if(Bt.envContribution.supportsTouchEvents===!1)return;Bt.addEventListener("contextmenu",(a=>{a.stopPropagation(),a.preventDefault()}),{capture:!0}),n.touchMovePoints=[],t.scenegraph.tableGroup.addEventListener("touchstart",(a=>{var l,h,u,d,c,g,f,p;if(a.target.isChildOf(i.component.vScrollBar)||a.target.isChildOf(i.component.vScrollBar))return;n.isTouchdown=!0;const m=a.nativeEvent;n.touchMovePoints.push({x:t.rotateDegree?(u=(h=(l=m.changedTouches)===null||l===void 0?void 0:l[0])===null||h===void 0?void 0:h._canvasX)!==null&&u!==void 0?u:(d=a.canvas)===null||d===void 0?void 0:d.x:a.page.x,y:t.rotateDegree?(f=(g=(c=m.changedTouches)===null||c===void 0?void 0:c[0])===null||g===void 0?void 0:g._canvasY)!==null&&f!==void 0?f:(p=a.canvas)===null||p===void 0?void 0:p.y:a.page.y,timestamp:Date.now()})}));const r=a=>{var l,h;if(n.isLongTouch&&a.preventDefault(),n.isTouchdown&&Fk(a)){if(n.isTouchMove=!0,((h=(l=n.downIcon)===null||l===void 0?void 0:l.attribute)===null||h===void 0?void 0:h.funcType)===me.dragReorder)a.preventDefault();else if(n.touchMovePoints.length>4&&n.touchMovePoints.shift(),n.touchMovePoints.push({x:t.rotateDegree?a.changedTouches[0]._canvasX:a.changedTouches[0].pageX,y:t.rotateDegree?a.changedTouches[0]._canvasY:a.changedTouches[0].pageY,timestamp:Date.now()}),n._enableTableScroll){const u=-n.touchMovePoints[n.touchMovePoints.length-1].x+n.touchMovePoints[n.touchMovePoints.length-2].x,d=-n.touchMovePoints[n.touchMovePoints.length-1].y+n.touchMovePoints[n.touchMovePoints.length-2].y;vm({deltaX:u,deltaY:d},e),a.cancelable&&(t.internalProps.overscrollBehavior==="none"||Math.abs(d)>=Math.abs(u)&&d!==0&&wF(d,e)||Math.abs(d)<=Math.abs(u)&&u!==0&&xF(u,e))&&a.preventDefault()}}};Bt.addEventListener("touchmove",r,{passive:!1}),n.globalEventListeners.push({name:"touchmove",env:"vglobal",callback:r});const o=a=>{var l,h,u,d;if(n.touchEnd=!0,n.isLongTouch=!1,n.isTouchdown&&Fk(a)){if(((h=(l=n.downIcon)===null||l===void 0?void 0:l.attribute)===null||h===void 0?void 0:h.funcType)===me.dragReorder)a.preventDefault();else if(!((u=n.touchMovePoints)===null||u===void 0)&&u.length&&(n.touchMovePoints.length>4&&n.touchMovePoints.shift(),n.touchMovePoints.push({x:t.rotateDegree?a.changedTouches[0]._canvasX:a.changedTouches[0].pageX,y:t.rotateDegree?a.changedTouches[0]._canvasY:a.changedTouches[0].pageY,timestamp:Date.now()}),n._enableTableScroll)){const c=n.touchMovePoints[0],g=n.touchMovePoints[((d=n.touchMovePoints)===null||d===void 0?void 0:d.length)-1],f=(g.x-c.x)/(g.timestamp-c.timestamp),p=(g.y-c.y)/(g.timestamp-c.timestamp);n.inertiaScroll.startInertia(f,p,.95),t.eventManager.inertiaScroll.setScrollHandle(((m,v)=>{vm({deltaX:-m,deltaY:-v},t.stateManager)}))}n.isTouchdown=!1,n.isTouchMove=!1,n.isDraging=!1,n.touchMovePoints=[]}};Bt.addEventListener("touchend",o),n.globalEventListeners.push({name:"touchend",env:"vglobal",callback:o});const s=a=>{n.touchEnd=!0,n.isLongTouch=!1,n.isTouchdown&&(n.isTouchdown=!1,n.isTouchMove=!1,n.touchMovePoints=[],n.isDraging=!1)};Bt.addEventListener("touchcancel",s),n.globalEventListeners.push({name:"touchcancel",env:"vglobal",callback:s})}function Fk(n){return!!n.changedTouches}function Aut(n){n.isPivotChart()&&n.scenegraph.tableGroup.addEventListener("click",(t=>{var e;if(!n.stateManager.columnMove.moving&&!n.stateManager.columnResize.resizing)if(t.target.name==="axis-label"){const i=Si(t),{col:r,row:o}=i.eventArgs,s=n.internalProps.layoutMap;let a,l;s.indicatorsAsCol?(a=s.getDimensionKeyInChartSpec(s.rowHeaderLevelCount,o),l=s.getCellHeaderPaths(s.rowHeaderLevelCount-2,o).rowHeaderPaths):(a=s.getDimensionKeyInChartSpec(r,s.columnHeaderLevelCount),l=s.getCellHeaderPaths(r,s.columnHeaderLevelCount-1).colHeaderPaths);const h=l.map((u=>({key:u.dimensionKey,value:u.value}))).filter((u=>u.key));if(h.push({key:a,value:t.target.attribute.text}),n._selectedDimensionInChart.length&&Mut(n._selectedDimensionInChart,h))return;n._selectedDimensionInChart=h,s.updateDataStateToChartInstance(),u1(n.scenegraph),n.scenegraph.updateNextFrame()}else!((e=n._selectedDimensionInChart)===null||e===void 0)&&e.length&&(n._selectedDimensionInChart.length=0,n.internalProps.layoutMap.updateDataStateToChartInstance(),u1(n.scenegraph),n.scenegraph.updateNextFrame())}))}function Mut(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e].key!==t[e].key||n[e].value!==t[e].value)return!1;return!0}function Tut(n){n.isPivotChart()&&(n.on(tt.MOUSEENTER_CELL,(t=>{n.scenegraph.getCell(t.col,t.row).forEachChildren((e=>{if(e.name==="axis"){const i=zk(t.col,t.row,n.internalProps.layoutMap);t.axisPosition=i,n.fireListeners(tt.MOUSEENTER_AXIS,t)}}))})),n.on(tt.MOUSELEAVE_CELL,(t=>{n.scenegraph.getCell(t.col,t.row).forEachChildren((e=>{if(e.name==="axis"){const i=zk(t.col,t.row,n.internalProps.layoutMap);t.axisPosition=i,n.fireListeners(tt.MOUSELEAVE_AXIS,t)}}))})))}function zk(n,t,e){if(e.indicatorsAsCol){if(e.hasTwoIndicatorAxes&&t===e.columnHeaderLevelCount-1&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount)return"top";if(t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount)return"bottom";if(n===e.rowHeaderLevelCount-1&&t>=e.rowHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount)return"left"}else{if(n===e.rowHeaderLevelCount-1&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount)return"left";if(n===e.colCount-e.rightFrozenColCount&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount)return"right";if(t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount)return"bottom"}return"bottom"}function Rut(n){n.on("checkbox_state_change",(t=>{var e;const{col:i,row:r,checked:o,field:s}=t;if(!n.internalProps.layoutMap.isSeriesNumber(i,r)||n.internalProps.enableCheckboxCascade!==!0||n.isHeader(i,r))return;const a=n.getCellOriginRecord(i,r),l=n.dataSource.currentPagerIndexedData,h=n.getRecordShowIndexByCell(i,r);let u=l[h];if(dt(u)&&(u=[u]),a.vtableMerge||((e=a.children)===null||e===void 0?void 0:e.length))if(o)wm(n,i,r)===Tt.collapse?_m(!0,u,n,s):Cm(!0,h,u,l,n,i),Wh(h,u,l,n,i);else{wm(n,i,r)===Tt.collapse?_m(!1,u,n,s):Cm(!1,h,u,l,n,i),Wh(h,u,l,n,i);const d=n.stateManager.headerCheckedState._vtable_rowSeries_number,c=n.stateManager.updateHeaderCheckedState("_vtable_rowSeries_number",i,r);d!==c&&n.scenegraph.updateHeaderCheckboxCellState(i,r,c)}else Wh(h,u,l,n,i)}))}function But(n){n.on("checkbox_state_change",(t=>{var e;if(n.internalProps.enableCheckboxCascade!==!0)return;const{col:i,row:r,checked:o,field:s}=t,a=n.internalProps.columns.some((c=>c.tree));if(n.internalProps.enableCheckboxCascade,!a||n.isHeader(i,r))return;const l=n.getCellOriginRecord(i,r),h=n.dataSource.currentPagerIndexedData,u=n.getRecordShowIndexByCell(i,r);let d=h[u];if(dt(d)&&(d=[d]),l.vtableMerge||((e=l.children)===null||e===void 0?void 0:e.length))if(o)wm(n,i,r)===Tt.collapse?_m(!0,d,n,s):Cm(!0,u,d,h,n,i,s),Wh(u,d,h,n,i,s);else{wm(n,i,r)===Tt.collapse?_m(!1,d,n,s):Cm(!1,u,d,h,n,i,s),Wh(u,d,h,n,i,s);const c=n.stateManager.headerCheckedState._vtable_rowSeries_number,g=n.stateManager.updateHeaderCheckedState(s,i,r);c!==g&&n.scenegraph.updateHeaderCheckboxCellState(i,r,g)}else Wh(u,d,h,n,i,s)}))}function Cm(n,t,e,i,r,o,s){var a;const l=s||"_vtable_rowSeries_number";let h=t+1;for(;wt(i[h])&&((a=i[h])===null||a===void 0?void 0:a.length)>e.length;){const u=r.columnHeaderLevelCount+h;r.stateManager.setCheckedState(o,u,l,n),Zf(o,u,n,r),h++}}function Wh(n,t,e,i,r,o){var s;let a=t.length-1;if(a>0){let l=n-1;for(;a>0&&l>=0;)(wt(e[l])&&((s=e[l])===null||s===void 0?void 0:s.length)===a||a===1&&dt(e[l]))&&(kut(r,i.columnHeaderLevelCount+l,e[l],i,o),a--),l--}}function kut(n,t,e,i,r){const{checkedState:o}=i.stateManager,s=e.toString(),a=r||"_vtable_rowSeries_number";wt(e)&&e.length;let l=!1;const h=[],u=Array.from(o.keys()).sort(((p,m)=>{var v,b;const y=p.split(","),C=m.split(","),w=Math.max(y.length,C.length);for(let _=0;_<w;_++){const A=(v=Number(y[_]))!==null&&v!==void 0?v:0,x=(b=Number(C[_]))!==null&&b!==void 0?b:0;if(A!==x)return A-x}return 0})),d=u.map((p=>o.get(p))),c=u.filter((p=>p.startsWith(s+",")&&p!==s));if(d.forEach(((p,m)=>{const v=u[m],b=p,y=c.includes(v);l&&(y?h.push(b[a]):l=!1),v===s&&(l=!0)})),h.length===0)return;const g=h.every((p=>!!p)),f=h.every((p=>!p));g?(i.stateManager.setCheckedState(n,t,a,!0),Zf(n,t,!0,i)):f?(i.stateManager.setCheckedState(n,t,a,!1),Zf(n,t,!1,i)):(i.stateManager.setCheckedState(n,t,a,"indeterminate"),Zf(n,t,"indeterminate",i))}function _m(n,t,e,i){const{checkedState:r}=e.stateManager,o=t.toString();wt(t)&&t.length;let s=!1;const a=Array.from(r.keys()).sort(((u,d)=>{var c,g;const f=u.split(","),p=d.split(","),m=Math.max(f.length,p.length);for(let v=0;v<m;v++){const b=(c=Number(f[v]))!==null&&c!==void 0?c:0,y=(g=Number(p[v]))!==null&&g!==void 0?g:0;if(b!==y)return b-y}return 0})),l=a.filter((u=>u.startsWith(o+",")&&u!==o));a.map((u=>r.get(u))).forEach(((u,d)=>{const c=a[d],g=u,f=l.length!==0&&l.includes(c);s&&(f?g[i]=n:s=!1),c===o&&(s=!0)}))}function Put(n){n.on("checkbox_state_change",(t=>{if(n.internalProps.enableHeaderCheckboxCascade!==!0)return;const{col:e,row:i,checked:r,field:o}=t;if(n.isHeader(e,i))n.stateManager.setHeaderCheckedState(o,r),n.getCellType(e,i)==="checkbox"&&n.scenegraph.updateCheckboxCellState(e,i,r);else if(n.stateManager.setCheckedState(e,i,o,r),n.getCellType(e,i)==="checkbox"){const s=n.stateManager.headerCheckedState[o],a=n.stateManager.updateHeaderCheckedState(o,e,i);s!==a&&n.scenegraph.updateHeaderCheckboxCellState(e,i,a)}}))}function wm(n,t,e){const i=n.getRecordShowIndexByCell(t,e);return n.dataSource.getHierarchyState(i)}function Eut(n){n.on(tt.CLICK_CELL,(t=>{const{col:e,row:i,target:r}=t;r.name!=="button"||r.attribute.disable||n.hasListeners(tt.BUTTON_CLICK)&&n.fireListeners(tt.BUTTON_CLICK,{col:e,row:i,event:t.event})}))}function Lut(n){n.on(tt.ICON_CLICK,(t=>{var e;const{col:i,row:r,x:o,y:s,funcType:a,icon:l,event:h}=t,{stateManager:u}=n;if(a===me.dropDown)u.triggerDropDownMenu(i,r,o,s,h);else if(a===me.sort)u.triggerSort(i,r,l,h);else if(a===me.frozen)u.triggerFreeze(i,r,l);else if(a===me.drillDown)dut(n);else if(a===me.collapse||a===me.expand){const d=!!(!((e=u.select.ranges)===null||e===void 0)&&e.length);u.updateSelectPos(-1,-1),u.endSelectCells(!0,d),n.toggleHierarchyState(i,r)}}))}function Out(n){n.on(tt.DROPDOWN_MENU_CLICK,(()=>{n.stateManager.hideMenu()})),n.on(tt.SCROLL,(()=>{n.stateManager.hideMenu()}))}function Iut(n){n.on(tt.DBLCLICK_CELL,(t=>{var e,i,r;if(t.federatedEvent){const o=Si(t.federatedEvent),s=n.scenegraph.getResizeColAt(o.abstractPos.x,o.abstractPos.y,(e=o.eventArgs)===null||e===void 0?void 0:e.targetCell),a=(i=n.options.disableDblclickAutoResizeColWidth)!==null&&i!==void 0?i:(r=n.options.resize)===null||r===void 0?void 0:r.disableDblclickAutoResizeColWidth;if(n.eventManager.checkCellFillhandle(o))n.fireListeners(tt.DBLCLICK_FILL_HANDLE,{});else if(n._canResizeColumn(s.col,s.row)&&s.col>=0&&!a){n.scenegraph.updateAutoColWidth(s.col),n.internalProps._widthResizedColMap.add(s.col),n.scenegraph.updateChartSizeForResizeColWidth(s.col);const l=n.stateManager;l.columnResize.col<l.table.frozenColCount&&!l.table.isPivotTable()&&!l.table.transpose&&l.table.scenegraph.component.setFrozenColumnShadow(l.table.frozenColCount-1,l.columnResize.isRightFrozen),(l.columnResize.col>=l.table.colCount-l.table.rightFrozenColCount&&!l.table.isPivotTable()&&!l.table.transpose||l.table.options.rightFrozenColCount)&&l.table.scenegraph.component.setRightFrozenColumnShadow(l.table.colCount-l.table.rightFrozenColCount);const h=[];for(let u=0;u<n.colCount;u++)h.push(n.getColWidth(u));n.fireListeners(tt.RESIZE_COLUMN_END,{col:s.col,colWidths:h})}}}))}var Ia=function(n,t,e,i){return new(e||(e=Promise))((function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e((function(d){d(u)}))).then(s,a)}l((i=i.apply(n,t||[])).next())}))};let Hut=class{constructor(t){this.isDown=!1,this.isDraging=!1,this.globalEventListeners=[],this._enableTableScroll=!0,this.cutWaitPaste=!1,this.clipboardCheckTimer=null,this.cutOperationTime=0,this.lastClipboardContent="",this.cutCellRange=null,this.table=t,this.handleTextStickBindId=[],this.inertiaScroll=new but(t.stateManager),te.mode==="node"||t.options.disableInteraction||(this.bindOuterEvent(),setTimeout((()=>{this.bindSelfEvent()}),0))}bindOuterEvent(){yut(this),xut(this),wut(this),Sut(this),Cut(this)}updateEventBinder(){setTimeout((()=>{var t;this.table.isReleased||(pm(this.table)&&((t=this.handleTextStickBindId)===null||t===void 0?void 0:t.length)===0?(this.handleTextStickBindId.push(this.table.on(tt.SCROLL,(e=>{tc(this.table)}))),this.handleTextStickBindId.push(this.table.on(tt.RESIZE_COLUMN_END,(e=>{tc(this.table)}))),this.handleTextStickBindId.push(this.table.on(tt.RESIZE_ROW_END,(e=>{tc(this.table)})))):!pm(this.table)&&this.handleTextStickBindId&&(this.handleTextStickBindId.forEach((e=>{this.table.off(e)})),this.handleTextStickBindId=[]),Dk(this.table))}),0)}bindSelfEvent(){this.table.isReleased||(Lut(this.table),Out(this.table),this.updateEventBinder(),hut(this.table),Iut(this.table),this.table.isPivotTable()&&cut(this.table)&&uut(this.table),Dk(this.table),Aut(this.table),Tut(this.table),Rut(this.table),But(this.table),Put(this.table),Eut(this.table))}dealTableHover(t){if(!t)return void this.table.stateManager.updateHoverPos(-1,-1);const{eventArgs:e}=t;e?this.table.stateManager.updateHoverPos(e.col,e.row):this.table.stateManager.updateHoverPos(-1,-1)}dealIconHover(t){const{eventArgs:e}=t;e?this.table.stateManager.updateHoverIcon(e.col,e.row,e.target,e.targetCell):this.table.stateManager.updateHoverIcon(-1,-1,void 0,void 0)}dealMenuHover(t){}dealTableSelect(t,e){var i,r,o,s,a,l,h,u,d;if(!t)return this.table.stateManager.updateSelectPos(-1,-1),!1;const{eventArgs:c}=t;if(c){if(c.target.name==="checkbox"||c.target.name==="radio"||c.target.name==="switch"||c.target.name==="button")return!1;if(this.table.isHeader(c.col,c.row)&&ra(this.table,c.col,c.row))return e||this.table.stateManager.updateSelectPos(-1,-1),!1;if(!this.table.isHeader(c.col,c.row)&&ra(this.table,c.col,c.row)){if(!e){const p=!!(!((i=this.table.stateManager.select.ranges)===null||i===void 0)&&i.length);this.table.stateManager.updateSelectPos(-1,-1),p&&this.table.stateManager.endSelectCells(!0,p)}return!1}if(this.table.isPivotChart()&&(((r=t?.eventArgs)===null||r===void 0?void 0:r.target.name)==="axis-label"||((o=t?.eventArgs)===null||o===void 0?void 0:o.target.type)==="chart"))return this.table.stateManager.updateSelectPos(-1,-1),!1;const g=(a=(s=this.table.keyboardOptions)===null||s===void 0?void 0:s.shiftMultiSelect)===null||a===void 0||a,f=(h=(l=this.table.keyboardOptions)===null||l===void 0?void 0:l.ctrlMultiSelect)===null||h===void 0||h;return this.table.stateManager.updateSelectPos(this.table.stateManager.select.selectInline==="row"?this.table.colCount-1:c.col,this.table.stateManager.select.selectInline==="col"?this.table.rowCount-1:c.row,c.event.shiftKey&&g,(c.event.ctrlKey||c.event.metaKey)&&f,!1,!e&&((d=(u=this.table.options.select)===null||u===void 0?void 0:u.makeSelectCellVisible)===null||d===void 0||d)),!0}return!1}dealFillSelect(t,e){var i,r,o,s,a,l,h,u;const{eventArgs:d}=t;if(d){if(!((r=(i=this.table.stateManager.select)===null||i===void 0?void 0:i.ranges)===null||r===void 0)&&r.length&&this.table.stateManager.isFillHandle()){let c,g;const f=this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1];e&&($(this.table.stateManager.fillHandle.directionRow)||(Math.abs(this.table.stateManager.fillHandle.startY-t.abstractPos.y)>=Math.abs(this.table.stateManager.fillHandle.startX-t.abstractPos.x)?this.table.stateManager.fillHandle.directionRow=!0:this.table.stateManager.fillHandle.directionRow=!1),Math.abs(this.table.stateManager.fillHandle.startY-t.abstractPos.y)>=Math.abs(this.table.stateManager.fillHandle.startX-t.abstractPos.x)?this.table.stateManager.fillHandle.startY-t.abstractPos.y>0?this.table.stateManager.fillHandle.direction="top":this.table.stateManager.fillHandle.direction="bottom":this.table.stateManager.fillHandle.startX-t.abstractPos.x>0?this.table.stateManager.fillHandle.direction="left":this.table.stateManager.fillHandle.direction="right",this.table.stateManager.fillHandle.directionRow?(c=d.row,g=f.end.col):(c=f.end.row,g=d.col));const p=(s=(o=this.table.keyboardOptions)===null||o===void 0?void 0:o.ctrlMultiSelect)===null||s===void 0||s;this.table.stateManager.updateSelectPos(e?g:f.end.col,e?c:f.end.row,!0,(d.event.ctrlKey||d.event.metaKey)&&p,!1,!e)}else{const c=(l=(a=this.table.keyboardOptions)===null||a===void 0?void 0:a.shiftMultiSelect)===null||l===void 0||l,g=(u=(h=this.table.keyboardOptions)===null||h===void 0?void 0:h.ctrlMultiSelect)===null||u===void 0||u;this.table.stateManager.updateSelectPos(d.col,d.row,d.event.shiftKey&&c,(d.event.ctrlKey||d.event.metaKey)&&g,!1,!e)}return!0}return!1}deelTableSelectAll(){this.table.stateManager.updateSelectPos(-1,-1,!1,!1,!0),this.table.fireListeners(tt.SELECTED_CELL,{ranges:this.table.stateManager.select.ranges,col:0,row:0})}dealMenuSelect(t){}checkColumnResize(t,e){const{eventArgs:i}=t;if(this.table.internalProps.enableTreeStickCell&&!i)return!1;const r=this.table.scenegraph.getResizeColAt(t.abstractPos.x,t.abstractPos.y,i?.targetCell);return this.table._canResizeColumn(r.col,r.row)&&r.col>=0?(e&&this.table.stateManager.startResizeCol(r.col,t.abstractPos.x,t.abstractPos.y,r.rightFrozen),!0):(this.table.stateManager.isResizeCol()&&this.table.stateManager.endResizeCol(),!1)}checkRowResize(t,e){const{eventArgs:i}=t;if(i){const r=this.table.scenegraph.getResizeRowAt(t.abstractPos.x,t.abstractPos.y,i.targetCell);if(this.table._canResizeRow(r.col,r.row)&&r.row>=0)return e&&this.table.stateManager.startResizeRow(r.row,t.abstractPos.x,t.abstractPos.y,r.bottomFrozen),!0}return!1}cellIsHeaderCheck(t,e){const{eventArgs:i}=t,{col:r,row:o,target:s}=i;return this.table.isHeader(r,o)?this.table.getCellType(i.col,i.row)==="checkbox"&&s.name==="checkbox":!1}checkCellFillhandle(t,e){var i,r,o,s,a;let l=!1;if(l=typeof((i=this.table.options.excelOptions)===null||i===void 0?void 0:i.fillHandle)=="function"?this.table.options.excelOptions.fillHandle({selectRanges:this.table.stateManager.select.ranges,table:this.table}):(r=this.table.options.excelOptions)===null||r===void 0?void 0:r.fillHandle,l){const{eventArgs:h}=t;if(h&&(!((s=(o=this.table.stateManager.select)===null||o===void 0?void 0:o.ranges)===null||s===void 0)&&s.length)){const u=Math.max(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.col,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.col),d=Math.max(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.row,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.row),c=Math.min(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.col,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.col),g=Math.min(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.row,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.row);let f;u<this.table.colCount-1?f=this.table.scenegraph.highPerformanceGetCell(u,d).globalAABBBounds.x2:c===0?f=this.table.scenegraph.highPerformanceGetCell(0,d).globalAABBBounds.x1:f=this.table.scenegraph.highPerformanceGetCell(c-1,d).globalAABBBounds.x2;const p=Math.abs(t.abstractPos.x-f);let m;d<this.table.rowCount-1?m=this.table.scenegraph.highPerformanceGetCell(u,d).globalAABBBounds.y2:m=this.table.scenegraph.highPerformanceGetCell(u,g-1).globalAABBBounds.y2;const v=Math.abs(t.abstractPos.y-m),b=18;if(!((a=this.table.stateManager.fillHandle)===null||a===void 0)&&a.isFilling||p<=b/2&&v<=b/2)return e&&this.table.stateManager.startFillSelect(t.abstractPos.x,t.abstractPos.y),!0}}return!1}dealColumnResize(t,e){this.table.stateManager.updateResizeCol(t,e)}dealRowResize(t,e){this.table.stateManager.updateResizeRow(t,e)}checkColumnMover(t){var e;const{eventArgs:i}=t;return!(!i||!this.table._canDragHeaderPosition(i.col,i.row))&&(this.table.stateManager.startMoveCol(i.col,i.row,t.abstractPos.x,t.abstractPos.y,(e=i?.event)===null||e===void 0?void 0:e.nativeEvent),!0)}dealColumnMover(t){var e;const{eventArgs:i}=t;$(i.col)&&$(i.row)&&this.table.stateManager.updateMoveCol(i.col,i.row,t.abstractPos.x,t.abstractPos.y,(e=i?.event)===null||e===void 0?void 0:e.nativeEvent)}startColumnResize(t){}dealIconClick(t,e){const{eventArgs:i}=e,{target:r,event:o,col:s,row:a}=i||{target:t.target,event:t,col:-1,row:-1},l=r;if(l.role&&l.role.startsWith("icon-"))return this.table.fireListeners(tt.ICON_CLICK,{name:l.name,x:(l.globalAABBBounds.x1+l.globalAABBBounds.x2)/2,y:l.globalAABBBounds.y2,col:s,row:a,funcType:l.attribute.funcType,icon:l,event:o}),!0;if(r instanceof ti){const h=r.pickIcon(o.global);if(h)return this.table.fireListeners(tt.ICON_CLICK,{name:h.attribute.id,x:h.globalX+h.globalAABBBounds.width()/2,y:h.globalY+h.AABBBounds.height(),col:s,row:a,funcType:h.attribute.funcType,icon:h,event:o}),!0}return!1}release(){var t;(t=this.gesture)===null||t===void 0||t.release(),this.globalEventListeners.forEach((e=>{e.env==="document"?document.removeEventListener(e.name,e.callback):e.env==="body"?document.body.removeEventListener(e.name,e.callback):e.env==="window"?window.removeEventListener(e.name,e.callback):e.env==="vglobal"&&Bt.removeEventListener(e.name,e.callback)})),this.globalEventListeners=[]}enableScroll(){this._enableTableScroll=!0}disableScroll(){this._enableTableScroll=!1}handleCopy(t,e=!1){var i,r;return Ia(this,void 0,void 0,(function*(){const o=this.table;!e&&(this.cutWaitPaste=!1);const s=this.table.getCopyValue();if($(s)){t.preventDefault();const a=yield navigator.permissions.query({name:"clipboard-write"});if(!((i=navigator.clipboard)===null||i===void 0)&&i.write&&a.state==="granted"){const l=u=>{const d=["<table>"],c=['<meta name="author" content="Visactor"/>','<style type="text/css">td{white-space:normal}br{mso-data-placement:same-cell}</style>'].join(""),g=u.split(`\r
`);return g.forEach((function(f,p){const m=f.split("	"),v=[];p===0&&d.push("<tbody>"),m.forEach((function(b,y){const C=b?b.toString().replace(/&/g,"&amp;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/(<br(\s*|\/)>(\r\n|\n)?|\r\n|\n)/g,`<br>\r
`).replace(/\x20{2,}/gi,(w=>`<span style="mso-spacerun: yes">${"&nbsp;".repeat(w.length-1)} </span>`)).replace(/\t/gi,"&#9;"):" ";v.push(`<td>${C}</td>`)})),d.push("<tr>",...v,"</tr>"),p===g.length-1&&d.push("</tbody>")})),d.push("</table>"),[c,d.join("")].join("")},h=l(s);navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([h],{type:"text/html"}),"text/plain":new Blob([s],{type:"text/plain"})})])}else Wrt.IE?window.clipboardData.setData("Text",s):t.clipboardData.setData("text/plain",s);o.fireListeners(tt.COPY_DATA,{cellRange:o.stateManager.select.ranges,copyData:s,isCut:e})}!((r=o.keyboardOptions)===null||r===void 0)&&r.showCopyCellBorder&&(xrt(o),o.clearSelected())}))}handleCut(t){return Ia(this,void 0,void 0,(function*(){this.handleCopy(t,!0),this.cutWaitPaste=!0,this.cutCellRange=this.table.getSelectedCellInfos(),this.clipboardCheckTimer&&clearTimeout(this.clipboardCheckTimer),this.clipboardCheckTimer=window.setTimeout((()=>{this.cutWaitPaste&&(this.cutWaitPaste=!1,this.cutCellRange=null,this.clipboardCheckTimer=null)}),3e4),this.saveClipboardContent()}))}handlePaste(t){this.cutWaitPaste?this.checkClipboardChanged().then((e=>{this.executePaste(t),e||this.clearCutArea(this.table),this.cutWaitPaste&&(this.cutWaitPaste=!1,this.cutCellRange=null,this.clipboardCheckTimer&&(clearTimeout(this.clipboardCheckTimer),this.clipboardCheckTimer=null))})).catch((()=>{this.executePaste(t),this.cutWaitPaste&&(this.cutWaitPaste=!1,this.cutCellRange=null,this.clipboardCheckTimer&&(clearTimeout(this.clipboardCheckTimer),this.clipboardCheckTimer=null))})):this.executePaste(t)}executePaste(t){var e,i,r,o;return Ia(this,void 0,void 0,(function*(){const s=this.table;if(s.changeCellValues){if(!((e=s.editorManager)===null||e===void 0)&&e.editingEditor)return;if(((i=s.stateManager.select.ranges)===null||i===void 0?void 0:i.length)>0)if(!((r=navigator.clipboard)===null||r===void 0)&&r.read)navigator.clipboard.read().then((a=>{for(const l of a)l.types.includes("text/html")?this.pasteHtmlToTable(l):l.types.length===1&&l.types[0]==="text/plain"&&this.pasteTextToTable(l)}));else{const a=s.stateManager.select.ranges,l=Math.min(a[0].start.col,a[0].end.col),h=Math.min(a[0].start.row,a[0].end.row),u=(t.clipboardData||window.Clipboard).getData("text").split(`
`),d=[];u.forEach((function(g,f){const p=g.split("	"),m=[];d.push(m),p.forEach((function(v,b){b===p.length-1&&(v=v.trim()),m.push(v)}))}));const c=yield s.changeCellValues(l,h,d,!0);s.hasListeners(tt.PASTED_DATA)&&s.fireListeners(tt.PASTED_DATA,{col:l,row:h,pasteData:d,changedCellResults:c})}}!((o=s.keyboardOptions)===null||o===void 0)&&o.showCopyCellBorder&&Srt(s)}))}clearCutArea(t){try{const e=this.cutCellRange;if(!e||e.length===0)return;for(let i=0;i<e.length;i++)for(let r=0;r<e[i].length;r++)e[i][r]&&t.changeCellValue(e[i][r].col,e[i][r].row,void 0)}catch{}}checkClipboardChanged(){return Ia(this,void 0,void 0,(function*(){if(!navigator.clipboard||!navigator.clipboard.readText)return!1;try{return(yield navigator.clipboard.readText())!==this.lastClipboardContent}catch{return!1}}))}saveClipboardContent(){navigator.clipboard&&navigator.clipboard.readText&&setTimeout((()=>{navigator.clipboard.readText().then((t=>{this.lastClipboardContent=t})).catch((t=>{}))}),50)}pasteHtmlToTable(t){const e=/<tr[^>]*>([\s\S]*?)<\/tr>/g,i=/<td[^>]*>([\s\S]*?)<\/td>/g,r=this.table,o=r.stateManager.select.ranges,s=o.length,a=Math.min(o[s-1].start.col,o[s-1].end.col),l=Math.min(o[s-1].start.row,o[s-1].end.row),h=Math.max(o[s-1].start.col,o[s-1].end.col),u=Math.max(o[s-1].start.row,o[s-1].end.row);let d=0,c=0,g=[];t.getType("text/html").then((f=>{f.text().then((p=>Ia(this,void 0,void 0,(function*(){var m,v;if(p&&/(<table)|(<TABLE)/g.test(p)){const b=Array.from(p.matchAll(e));for(const C of b){const w=C[1],_=Array.from(w.matchAll(i)).map((A=>A[1].replace(/(<(?!br)([^>]+)>)/gi,"").replace(/<br(\s*|\/)>[\r\n]?/gim,`
`).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#9;/gi,"	").replace(/&nbsp;/g," ")));g.push(_),d=Math.max(d,(m=_?.length)!==null&&m!==void 0?m:0)}c=(v=g.length)!==null&&v!==void 0?v:0,g=this.handlePasteValues(g,c,d,u-l+1,h-a+1);const y=yield r.changeCellValues(a,l,g,!0);r.hasListeners(tt.PASTED_DATA)&&r.fireListeners(tt.PASTED_DATA,{col:a,row:l,pasteData:g,changedCellResults:y})}else navigator.clipboard.read().then((b=>{for(const y of b)y.types.includes("text/plain")&&y.getType("text/plain").then((C=>{C.text().then((w=>this._pasteValue(w)))}))}))}))))}))}_pasteValue(t){var e;return Ia(this,void 0,void 0,(function*(){const i=this.table,r=i.stateManager.select.ranges,o=r.length,s=Math.min(r[o-1].start.col,r[o-1].end.col),a=Math.min(r[o-1].start.row,r[o-1].end.row),l=Math.max(r[o-1].start.col,r[o-1].end.col),h=Math.max(r[o-1].start.row,r[o-1].end.row);let u=0,d=0,c=[];t.split(`
`).forEach((function(f,p){var m;const v=f.split("	"),b=[];c.push(b),v.forEach((function(y,C){C===v.length-1&&(y=y.trim()),b.push(y)})),u=Math.max(u,(m=b?.length)!==null&&m!==void 0?m:0)})),d=(e=c.length)!==null&&e!==void 0?e:0,c=this.handlePasteValues(c,d,u,h-a+1,l-s+1);const g=yield i.changeCellValues(s,a,c,!0);i.hasListeners(tt.PASTED_DATA)&&i.fireListeners(tt.PASTED_DATA,{col:s,row:a,pasteData:c,changedCellResults:g})}))}pasteTextToTable(t){const e=this.table,i=e.stateManager.select.ranges,r=i.length,o=Math.min(i[r-1].start.col,i[r-1].end.col),s=Math.min(i[r-1].start.row,i[r-1].end.row),a=Math.max(i[r-1].start.col,i[r-1].end.col),l=Math.max(i[r-1].start.row,i[r-1].end.row);let h=0,u=0;t.getType("text/plain").then((d=>{d.text().then((c=>Ia(this,void 0,void 0,(function*(){var g;const f=c.replace(/\r(?!\n)/g,`\r
`).split(`\r
`);let p=[];f.length>1&&f[f.length-1]===""&&f.pop(),f.forEach((function(v,b){var y;const C=v.split("	"),w=[];p.push(w),C.forEach((function(_,A){_.includes(`
`)&&(_=_.replace(/^"(.*)"$/,"$1").replace(/["]*/g,(x=>new Array(Math.floor(x.length/2)).fill('"').join("")))),w.push(_)})),h=Math.max(h,(y=w?.length)!==null&&y!==void 0?y:0)})),u=(g=p.length)!==null&&g!==void 0?g:0,p=this.handlePasteValues(p,u,h,l-s+1,a-o+1);const m=yield e.changeCellValues(o,s,p,!0);e.hasListeners(tt.PASTED_DATA)&&e.fireListeners(tt.PASTED_DATA,{col:o,row:s,pasteData:p,changedCellResults:m})}))))}))}handlePasteValues(t,e,i,r,o){if(o>i||r>e){if(o%i==0&&r%e==0){const s=[];for(let a=0;a<r;a++){const l=[];s.push(l);for(let h=0;h<o;h++){const u=a%e,d=h%i;l.push(t[u][d])}}return s}return t}return t}},Nk;const Dut=n=>{const t=n.value;return Number(t)>80?"#20a8d8":Number(t)>50?"#4dbd74":Number(t)>20?"#ffc107":"#f86c6b"};class xm extends lo{static get DEFAULT(){return Nk||(Nk=new xm)}constructor(t={},e={}){var i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b;super(t,e),this._showBar=(i=t.showBar)===null||i===void 0||i,this._barColor=(r=t.barColor)!==null&&r!==void 0?r:Dut,this._barPositiveColor=(o=t.barPositiveColor)!==null&&o!==void 0?o:"#4dbd74",this._barNegativeColor=(s=t.barNegativeColor)!==null&&s!==void 0?s:"#f86c6b",this._barAxisColor=(a=t.barAxisColor)!==null&&a!==void 0?a:"black",this._barBgColor=t.barBgColor,this._barHeight=(l=t.barHeight)!==null&&l!==void 0?l:3,this._barHeight=(h=t.barHeight)!==null&&h!==void 0?h:3,this._barBottom=(u=t.barBottom)!==null&&u!==void 0?u:0,this._barPadding=(d=t.barPadding)!==null&&d!==void 0?d:[0,0,0,0],this._showBarMark=(c=t.showBarMark)!==null&&c!==void 0&&c,this._barMarkPositiveColor=(g=t.barMarkPositiveColor)!==null&&g!==void 0?g:"#4dbd74",this._barMarkNegativeColor=(f=t.barMarkNegativeColor)!==null&&f!==void 0?f:"#f86c6b",this._barMarkWidth=(p=t.barMarkWidth)!==null&&p!==void 0?p:2,this._barMarkPosition=(m=t.barMarkPosition)!==null&&m!==void 0?m:"right",this._barRightToLeft=(v=t.barRightToLeft)!==null&&v!==void 0&&v,this._barMarkInBar=(b=t.barMarkInBar)===null||b===void 0||b}get showBar(){return this._showBar}set showBar(t){this._showBar=t}get barColor(){return this._barColor}set barColor(t){this._barColor=t}get barBgColor(){return this._barBgColor}set barBgColor(t){this._barBgColor=t}get barHeight(){return this._barHeight}set barHeight(t){this._barHeight=t}get barBottom(){return this._barBottom}set barBottom(t){this._barBottom=t}get barPositiveColor(){return this._barPositiveColor}set barPositiveColor(t){this._barPositiveColor=t}get barNegativeColor(){return this._barNegativeColor}set barNegativeColor(t){this._barNegativeColor=t}get barAxisColor(){return this._barAxisColor}set barAxisColor(t){this._barAxisColor=t}get barPadding(){return this._barPadding}set barPadding(t){this._barPadding=t}get showBarMark(){return this._showBarMark}set showBarMark(t){this._showBarMark=t}get barMarkPositiveColor(){return this._barMarkPositiveColor}set barMarkPositiveColor(t){this._barMarkPositiveColor=t}get barMarkNegativeColor(){return this._barMarkNegativeColor}set barMarkNegativeColor(t){this._barMarkNegativeColor=t}get barMarkWidth(){return this._barMarkWidth}set barMarkWidth(t){this._barMarkWidth=t}get barMarkPosition(){return this._barMarkPosition}set barMarkPosition(t){this._barMarkPosition=t}get barRightToLeft(){return this._barRightToLeft}set barRightToLeft(t){this._barRightToLeft=t}get barMarkInBar(){return this._barMarkInBar}set barMarkInBar(t){this._barMarkInBar=t}clone(){return new xm(this,null)}}const Fut=["type","content","style","color","width","height","marginRight","marginLeft","src","svg","name","path","positionType","tooltip","hover","cursor","shape","interactive","isGif"],zut=Fut;class Nut{constructor(t){this._table=t;const e=Fr();this.expandIcon=e[on.expandIconName],this.collapseIcon=e[on.collapseIconName]}getIcons(t,e,i,r,o){const s=[],a=this.getHierarchyIcon(t,e);a&&s.push(a);const{icon:l}=this._table.getBodyColumnDefine(t,e);if(l){let h;typeof l=="function"?h=l({col:t,row:e,value:i,dataValue:r,table:this._table}):h=l;const u=Fr(),d=c=>{let g;g=typeof c=="string"?u[c]:c,g&&s.push(g)};Array.isArray(h)?h.forEach(((c,g)=>{d(c)})):d(h)}return o&&s.forEach(((h,u)=>{(h.content||h.src)&&(s[u]=this.getCellIconFromRecordValue(h,t,e))})),s}getStyleClass(t){switch(t){case"text":case"link":return Wc;case"image":case"video":return vrt;case"chart":case"sparkline":return lo;case"progressbar":return xm;case"checkbox":return $w;case"radio":return wl;case"switch":return xl;case"button":return Sl}return Wc}getCellIconFromRecordValue(t,e,i){if(Array.isArray(t))return t.map((s=>this.getCellIconFromRecordValue(s,e,i)));if(!bD.isObject(t)||typeof t=="function")return this._table.getFieldData(t,e,i);const r={},o=t;return zut.forEach((s=>{var a,l;if(o[s]!==void 0){const h=this._table.getFieldData(o[s],e,i);$(h)?r[s]=h:!((l=(a=this._table)._hasField)===null||l===void 0)&&l.call(a,o[s],e,i)||(r[s]=o[s])}})),r}getHierarchyIcon(t,e){const i=this._table.getHierarchyState(t,e);return i===Tt.expand?this.expandIcon:i===Tt.collapse?this.collapseIcon:void 0}getHierarchyIconWidth(){var t,e;return this.expandIcon.width+((t=this.expandIcon.marginLeft)!==null&&t!==void 0?t:0)+((e=this.expandIcon.marginRight)!==null&&e!==void 0?e:0)}}function Ro(n,t){const e=document.createElement(n);return t&&e.classList.add(...t),e}function Wut(){if(te.mode==="node")return;const n=document.createElement("style");n.id="vtable-menu-styleSheet",n.textContent=`
@keyframes vtable__menu-element--shown-animation {
	0% {
		opacity: 0;
	}
	100% {
		opacity: 1;
	}
}
.vtable__menu-element {
	position: absolute;
	box-sizing: border-box;
	border-radius: 4px;
	background-color: #fff;
	padding: 6px 0;
	/* pointer-events: none; */
	user-select: none;
	color: #000;
	max-width: 300px;
	z-index: 99999;
	border: #CCC 0.5px solid;
	cursor: default;
	width: max-content;
	box-shadow: 0px 8px 16px rgba(27, 31, 35, 0.12);
  max-height: 100%;
  overflow-y: auto;
}
.vtable__menu-element--hidden {
	opacity: 0;
	/* transform: translate(-50%, -50%); */
	transition: opacity 75ms linear;
	z-index: -9999;
}
.vtable__menu-element--shown {
	opacity: 1;
	/* transform: translate(-50%, -50%); */
	animation: vtable__menu-element--shown-animation 150ms ease-out;
}
.vtable__menu-element__content {
	font-family: Roboto;
	font-size: 12px;
	overflow: hidden;
	display: inline-block;
	/* height: 100%; */
	line-height: 30px;
}
.vtable__menu-element__item {
	height: 32px;
	padding: 0px 12px;
	cursor: pointer;
	position: relative;
	display: flex;
	align-items: center;
	justify-content: flex-start;
}
.vtable__menu-element__item:hover {
	background-color: rgba(27, 31, 35, 0.06);
}
.vtable__menu-element__icon{
	/* vertical-align: top; */
	display: flex;
	/* line-height: 30px; */
	margin-right: 6px;
}
.vtable__menu-element__no-event {
	pointer-events: none;
}
.vtable__menu-element--select {
	color: #2E68CF;
}
.vtable__menu-element--normal {
	color: rgba(20, 20, 20, 0.9);;
}
.vtable__menu-element__item-disabled {
    color: rgba(0, 0, 0, 0.25);
    cursor: not-allowed;
	  background-color: #fff;
}
.vtable__menu-element__item-disabled:hover {
	  background-color: #fff;
}
.vtable__menu-element__split {
	height: 0px;
	border: 1px solid rgb(209, 213, 218);
	margin: 5px 0;
}
.vtable__menu-element__title {
	color: rgb(149, 149, 149);
}
.vtable__menu-element__arrow {
	position: absolute;
	right: 3px;
	font-weight: bold;
	margin-top: 1px;
}
.vtable__menu-element__item-text {
	margin-right: 15px;
}
`,document.head.appendChild(n)}Wut();const Un="vtable__menu-element",jut=`${Un}__item`,HC=`${Un}__content`,On=`${Un}--hidden`,os=`${Un}--shown`,Vut=`${Un}--normal`,Gut=`${Un}--select`,$ut=`${Un}__icon`,Uut=`${Un}__split`,Xut=`${Un}__title`,Yut=`${Un}__arrow`,hd=`${Un}__no-event`,Wk=`${Un}__item-text`,Jf=`${Un}__item-disabled`;function jk(){return Ro("div",[Un,On])}function Md(n,t,e,i,r,o){const s=n.getCellRange(i,r);for(let a=0;a<t.length;a++){const l=t[a];let{col:h,row:u}=l;const{field:d,menuKey:c}=l;if(typeof h!="number"||typeof u!="number")if(n.isPivotTable()){const g=n.internalProps.layoutMap.getPivotCellAdress(d);if(!g)continue;h=g.col,u=g.row}else{const g=n.internalProps.layoutMap.getHeaderCellAddressByField(d);if(!g)continue;h=g.col,u=g.row}if($(h)&&$(u)&&Ir(s,h,u)&&e===c)return!0}return!1}class qut{constructor(t){var e,i,r,o,s,a,l,h,u,d,c;this._handler=new Ev,this._rootElement=jk(),this._secondElement=jk(),this._secondElement.sub=!0,this._showChildrenIndex=-1,this._rootElement.addEventListener("wheel",(g=>{g.stopPropagation()})),(e=this._rootElement)===null||e===void 0||e.addEventListener("mousedown",(g=>{g.stopPropagation(),g.preventDefault()})),(i=this._rootElement)===null||i===void 0||i.addEventListener("contextmenu",(g=>{g.stopPropagation(),g.preventDefault()})),(r=this._rootElement)===null||r===void 0||r.addEventListener("touchend",(g=>{if(g.stopPropagation(),g.preventDefault(),g.target.classList.contains(Jf)||this._rootElement.classList.contains(On))return;const{col:f,row:p,dropDownIndex:m,menuKey:v,text:b,hasChildren:y}=g.target;if(typeof m!="number"||y)return void g.stopPropagation();const C=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(f,p):t.getHeaderField(f,p),w=t._dropDownMenuIsHighlight(f,p,m);t.fireListeners(tt.DROPDOWN_MENU_CLICK,{col:f,row:p,field:C,menuKey:v,text:b,highlight:w,cellLocation:t.getCellLocation(f,p),event:g}),t.fireListeners(tt.DROPDOWN_MENU_CLEAR,null),t.fireListeners(tt.HIDE_MENU,null),g.stopPropagation()})),(o=this._rootElement)===null||o===void 0||o.addEventListener("click",(g=>{if(g.stopPropagation(),g.preventDefault(),g.target.classList.contains(Jf)||this._rootElement.classList.contains(On))return;const{col:f,row:p,dropDownIndex:m,menuKey:v,text:b,hasChildren:y}=g.target;if(typeof m!="number"||y)return void g.stopPropagation();const C=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(f,p):t.getHeaderField(f,p),w=t._dropDownMenuIsHighlight(f,p,m);t.fireListeners(tt.DROPDOWN_MENU_CLICK,{col:f,row:p,field:C,menuKey:v,text:b,highlight:w,cellLocation:t.getCellLocation(f,p),event:g}),t.fireListeners(tt.DROPDOWN_MENU_CLEAR,null),t.fireListeners(tt.HIDE_MENU,null),g.stopPropagation()})),(s=this._rootElement)===null||s===void 0||s.addEventListener("mousemove",(g=>{var f,p;if(this._rootElement.classList.contains(On))return;g.stopPropagation();const{hasChildren:m,dropDownIndex:v,col:b,row:y,sub:C}=g.target;if(m){this._showChildrenIndex=v;const w=this._secondElement;w?.classList.remove(On),w?.classList.add(os),w.innerHTML="";const _=(f=this._menuInstanceInfo.content[v])===null||f===void 0?void 0:f.children;for(let x=0;x<_.length;x++){const S=_[x],T=Vk(S,!!t.stateManager.menu.dropDownMenuHighlight&&Md(t,t.stateManager.menu.dropDownMenuHighlight,typeof S=="object"?S?.menuKey||S?.text:S,b,y));T.col=b,T.row=y,T.dropDownIndex=x,typeof S=="string"?(T.text=S,T.menuKey=S):typeof S=="object"&&(T.text=S.text,T.menuKey=S.menuKey||S.text),T.sub=!0,T.sub=!0,w.appendChild(T)}const A=g.target.getBoundingClientRect();this._bindSecondElement(t,b,y,A.right,A.top)}else if(m&&this._showChildrenIndex===v){const w=this._secondElement;w?.classList.remove(On),w?.classList.add(os)}else!C&&(!((p=this._secondElement)===null||p===void 0)&&p.classList.contains(os))&&setTimeout((()=>{if(this._mouseEnterSecondElement!==!0){this._showChildrenIndex=-1;const w=this._secondElement;w?.classList.remove(os),w?.classList.add(On)}}),300)})),(a=this._secondElement)===null||a===void 0||a.addEventListener("wheel",(g=>{g.stopPropagation()})),(l=this._secondElement)===null||l===void 0||l.addEventListener("mousemove",(g=>{this._rootElement.classList.contains(On)||g.stopPropagation()})),(h=this._secondElement)===null||h===void 0||h.addEventListener("mouseenter",(g=>{this._mouseEnterSecondElement=!0})),(u=this._secondElement)===null||u===void 0||u.addEventListener("mouseleave",(g=>{this._mouseEnterSecondElement=!1})),(d=this._secondElement)===null||d===void 0||d.addEventListener("mousedown",(g=>{g.stopPropagation(),g.preventDefault()})),(c=this._secondElement)===null||c===void 0||c.addEventListener("click",(g=>{if(g.stopPropagation(),g.preventDefault(),g.target.classList.contains(Jf)||this._secondElement.classList.contains(On))return;const{col:f,row:p,dropDownIndex:m,menuKey:v,text:b,hasChildren:y}=g.target;if(typeof m!="number"||y)return void g.stopPropagation();const C=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(f,p):t.getHeaderField(f,p);let w=!1;this._menuInstanceInfo.content.forEach(((_,A)=>{if(typeof _=="object"&&_.children&&_.children.length)for(let x=0;x<_.children.length;x++){const S=_.children[x];if(Md(t,t.stateManager.menu.dropDownMenuHighlight,typeof S=="object"?S?.menuKey:S,f,p)&&v===(typeof S=="object"?S?.menuKey:S))return void(w=!0)}})),t.fireListeners(tt.DROPDOWN_MENU_CLICK,{col:f,row:p,field:C,cellHeaderPaths:t.isPivotTable()?t.getCellHeaderPaths(f,p):void 0,menuKey:v,text:b,highlight:w,cellLocation:t.getCellLocation(f,p),event:g}),t.fireListeners(tt.DROPDOWN_MENU_CLEAR,null),t.fireListeners(tt.HIDE_MENU,null),g.stopPropagation()}))}get rootElement(){return this._rootElement}release(){this.unbindFromCell();const t=this._rootElement;t?.parentElement&&t.parentElement.removeChild(t),this._handler.release(),delete this._rootElement}bindToCell(t,e,i,r){var o,s;const a=this._rootElement,l=this._secondElement;if(this._menuInstanceInfo=r,a?.classList.remove(os),a?.classList.add(On),l?.classList.remove(os),l?.classList.add(On),this._canBindToCell(t,e,i)){if(a.innerHTML="",Array.isArray(r.content)){const h=r.content;for(let u=0;(o=u<h?.length)!==null&&o!==void 0&&o;u++){const d=h[u];let c=!!t.stateManager.menu.dropDownMenuHighlight&&Md(t,t.stateManager.menu.dropDownMenuHighlight,typeof d=="object"?d?.menuKey||d?.text:d,e,i);if(t.stateManager.menu.dropDownMenuHighlight&&typeof d=="object"&&Array.isArray(d.children)&&d.children.length)for(let f=0;f<d.children.length;f++){const p=d.children[f];if(Md(t,t.stateManager.menu.dropDownMenuHighlight,typeof p=="object"?p?.menuKey||p?.text:p,e,i)){c=!0;break}}const g=Vk(d,c);g.col=e,g.row=i,g.dropDownIndex=u,typeof d=="string"?(g.text=d,g.menuKey=d):typeof d=="object"&&(g.text=d.text,g.menuKey=d.menuKey||d.text,!((s=d.children)===null||s===void 0)&&s.length&&(g.hasChildren=!0)),a.appendChild(g)}}if(this._bindToCell(t,e,i,r.position,r.referencePosition))return a?.classList.add(os),a?.classList.remove(On),!0}else this.unbindFromCell();return!1}unbindFromCell(){const t=this._rootElement,e=this._secondElement;this._menuInstanceInfo=void 0,t?.parentElement&&(t.classList.remove(os),t.classList.add(On)),e?.parentElement&&(e.classList.remove(os),e.classList.add(On))}_canBindToCell(t,e,i){var r;const o=t.getCellRangeRelativeRect({col:e,row:i}),s=(r=t.internalProps.menu.parentElement)!==null&&r!==void 0?r:t.getElement(),{top:a,bottom:l,left:h,right:u}=o;if(e===-1&&i===-1||t.isFrozenCell(e,i))return!0;if(l<t.getFrozenRowsHeight()||u<t.getFrozenColsWidth()||h>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||a>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:d,offsetWidth:c}=s;return!(d<a)&&!(c<h)}_bindToCell(t,e,i,r,o){var s;const a=this._rootElement,l=(s=t.internalProps.menu.parentElement)!==null&&s!==void 0?s:t.getElement(),{width:h,height:u,left:d,top:c}=l.getBoundingClientRect();if(a){a.parentElement!==l&&l.appendChild(a),a.style.left="0px";const g=.8*h;a.style.maxWidth=`${g}px`;const f=a.offsetWidth,p=a.offsetHeight;let m,v;r?(m=r.x,v=r.y):o&&(m=o.rect.right-f,v=o.rect.bottom);const b=l.getBoundingClientRect(),y=b.width/l.offsetWidth,C=b.height/l.offsetHeight;v*C+p>u&&(v=(u-p)/C),v<0&&(v/=2);let w=0,_=0;if(t.getElement()!==l){const{left:A,top:x}=t.getElement().getBoundingClientRect();w=x-c,_=A-d}return a.style.top=`${v+w}px`,m<0?m=0:m*y+f>h&&(m=(h-f)/y),a.style.left=`${m+_}px`,!0}return!1}_bindSecondElement(t,e,i,r,o){var s;const a=this._secondElement,l=this._rootElement,h=(s=t.internalProps.menu.parentElement)!==null&&s!==void 0?s:t.getElement(),{width:u,height:d,left:c,top:g}=h.getBoundingClientRect(),{x:f,y:p,width:m,height:v}=l.getBoundingClientRect();if(a){a.parentElement!==h&&h.appendChild(a),a.style.left="0px";const b=.8*u;a.style.maxWidth=`${b}px`;const y=a.clientWidth,C=a.clientHeight,w=r-c;let _=o-4-g;_+C>d&&(_=_-C+a.firstElementChild.clientHeight+4),a.style.top=`${_}px`;let A=w;return A+y>u?A=A-y-m:A+=4,a.style.left=`${A}px`,!0}return!1}pointInMenuElement(t,e){const i=this._rootElement,{x:r,y:o,width:s,height:a}=i.getBoundingClientRect();if(t>r-5&&t<r+s+5&&e>o-5&&e<o+a+5)return!0;const l=this._secondElement;if(l){const{x:h,y:u,width:d,height:c}=l.getBoundingClientRect();if(t>h-5&&t<h+d+5&&e>u-5&&e<u+c+5)return!0}return!1}}function Vk(n,t){var e,i,r;const o=Ro("div",[jut,t?Gut:Vut]);if(typeof n=="object"&&n.disabled&&o.classList.add(Jf),typeof n=="string"){const s=Ro("span",[HC,hd,Wk]);s.innerHTML=n,o.appendChild(s)}else if(typeof n=="object"){const s=(e=n.type)!==null&&e!==void 0?e:"item";if(s==="split")return o?.classList.add(Uut),o;if(!((i=n?.icon)===null||i===void 0)&&i.svg)if(qx.test(n.icon.svg)){const l=new Image;n.icon.width?l.style.width=n.icon.width.toString()+"px":l.style.width="16px",n.icon.height?l.style.height=n.icon.height.toString()+"px":l.style.height="16px",l.src=n.icon.svg,o.appendChild(l)}else{const l=Ro("span",[$ut,hd]);l.innerHTML=t&&n.selectedIcon&&n.selectedIcon.svg?n.selectedIcon.svg:n.icon.svg,n.icon.width&&l.children[0].setAttribute("width",n.icon.width.toString()),n.icon.height&&l.children[0].setAttribute("height",n.icon.height.toString()),o.appendChild(l)}const a=Ro("span",[HC,hd,Wk]);if(a.innerHTML=n.text,o.appendChild(a),s==="title")o?.classList.add(hd,Xut);else if(!((r=n?.children)===null||r===void 0)&&r.length){const l=Ro("span",[HC,hd,Yut]);l.innerHTML=t?'<svg width="8" height="12" viewBox="0 0 10 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: baseline"><path d="M1.78186 16.7729L0.300378 15.2915L6.8189 8.77295L0.300377 2.25443L1.78186 0.77295L9.78186 8.77295L1.78186 16.7729Z" fill="#2E68CF" fill-opacity="0.65"></path></svg>':'<svg width="8" height="12" viewBox="0 0 10 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: baseline"><path d="M1.78186 16.7729L0.300378 15.2915L6.8189 8.77295L0.300377 2.25443L1.78186 0.77295L9.78186 8.77295L1.78186 16.7729Z" fill="#141414" fill-opacity="0.65"></path></svg>',o.appendChild(l)}}return o}let Gk;const Kut={CHANGE_STYLE:"change_style"};class Vl extends Rv{static get EVENT_TYPE(){return Kut}static get DEFAULT(){return Gk||(Gk=new Vl)}constructor(t={},e={}){var i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x,S,T,M,R,E,P,B,k,L,O;super(),this._defaultPadding=[10,16,10,16],this._color=(i=t.color)!==null&&i!==void 0?i:e?.color,this._strokeColor=(r=t?.strokeColor)!==null&&r!==void 0?r:e?.strokeColor,this._fontSize=(o=t.fontSize)!==null&&o!==void 0?o:e?.fontSize,this._fontFamily=(s=t.fontFamily)!==null&&s!==void 0?s:e?.fontFamily,this._fontWeight=(a=t.fontWeight)!==null&&a!==void 0?a:e?.fontWeight,this._fontVariant=(l=t.fontVariant)!==null&&l!==void 0?l:e?.fontVariant,this._fontStyle=(h=t.fontStyle)!==null&&h!==void 0?h:e?.fontStyle,this._textOverflow=((u=t.textOverflow)!==null&&u!==void 0?u:e?.textOverflow)||"ellipsis",this._textStick=(c=(d=t.textStick)!==null&&d!==void 0?d:e?.textStick)!==null&&c!==void 0&&c,this._textStickBaseOnAlign=(f=(g=t.textStickBaseOnAlign)!==null&&g!==void 0?g:e?.textStickBaseOnAlign)!==null&&f!==void 0&&f,this._marked=(m=(p=t.marked)!==null&&p!==void 0?p:e?.marked)!==null&&m!==void 0&&m,this._textAlign=((v=t.textAlign)!==null&&v!==void 0?v:e?.textAlign)||"left",this._textBaseline=((b=t.textBaseline)!==null&&b!==void 0?b:e?.textBaseline)||"middle",this._bgColor=(y=t.bgColor)!==null&&y!==void 0?y:e?.bgColor,this._padding=(w=(C=t.padding)!==null&&C!==void 0?C:e?.padding)!==null&&w!==void 0?w:this._defaultPadding,this._borderColor=(_=t.borderColor)!==null&&_!==void 0?_:e?.borderColor,this._lineHeight=(A=t.lineHeight)!==null&&A!==void 0?A:e?.lineHeight,this._underline=(x=t.underline)!==null&&x!==void 0?x:e?.underline,this._underlineColor=(S=t.underlineColor)!==null&&S!==void 0?S:e?.underlineColor,this._underlineDash=(T=t.underlineDash)!==null&&T!==void 0?T:e?.underlineDash,this._underlineOffset=(M=t.underlineOffset)!==null&&M!==void 0?M:e?.underlineOffset,this._lineThrough=(R=t.lineThrough)!==null&&R!==void 0?R:e?.lineThrough,this._lineThroughColor=(E=t.lineThroughColor)!==null&&E!==void 0?E:e?.lineThroughColor,this._lineThroughDash=(P=t.lineThroughDash)!==null&&P!==void 0?P:e?.lineThroughDash,this._linkColor=(B=t.linkColor)!==null&&B!==void 0?B:e?.linkColor,this._cursor=(k=t.cursor)!==null&&k!==void 0?k:e?.cursor,this._borderLineWidth=(L=t.borderLineWidth)!==null&&L!==void 0?L:e?.borderLineWidth,this._borderLineDash=(O=t.borderLineDash)!==null&&O!==void 0?O:e?.borderLineDash}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t}get color(){return this._color}set color(t){this._color=t}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t}get padding(){var t;return(t=this._padding)!==null&&t!==void 0?t:this._defaultPadding}set padding(t){this._padding=t}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t}get textStick(){return this._textStick}set textStick(t){this._textStick=t}get textStickBaseOnAlign(){return this._textStickBaseOnAlign}set textStickBaseOnAlign(t){this._textStickBaseOnAlign=t}get marked(){return this._marked}set marked(t){this._marked=t}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t}get underline(){return this._underline}set underline(t){this._underline=t}get underlineColor(){return this._underlineColor}set underlineColor(t){this._underlineColor=t}get underlineDash(){return this._underlineDash}set underlineDash(t){this._underlineDash=t}get underlineOffset(){return this._underlineOffset}set underlineOffset(t){this._underlineOffset=t}get lineThrough(){return this._lineThrough}set lineThrough(t){this._lineThrough=t}get lineThroughColor(){return this._lineThroughColor}set lineThroughColor(t){this._lineThroughColor=t}get lineThroughDash(){return this._lineThroughDash}set lineThroughDash(t){this._lineThroughDash=t}get linkColor(){return this._linkColor}set linkColor(t){this._linkColor=t}get cursor(){return this._cursor}set cursor(t){this._cursor=t}get borderLineWidth(){return this._borderLineWidth}set borderLineWidth(t){this._borderLineWidth=t}get borderLineDash(){return this._borderLineDash}set borderLineDash(t){this._borderLineDash=t}clone(){return new Vl(this)}}let $k;class Sm extends Vl{static get DEFAULT(){return $k||($k=new Sm)}constructor(t={},e={}){var i;super(t,e),this.textAlign=((i=t.textAlign)!==null&&i!==void 0?i:e?.textAlign)||"center"}clone(){return new Sm(this)}}let Uk;class Am extends Vl{static get DEFAULT(){return Uk||(Uk=new Am)}constructor(t={},e=null){var i,r;super(t,e),this._autoWrapText=(i=t?.autoWrapText)!==null&&i!==void 0?i:e?.autoWrapText,this._lineClamp=(r=t?.lineClamp)!==null&&r!==void 0?r:e?.lineClamp}clone(){return new Am(this,null)}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t}}let Xk;class Al extends Vl{static get DEFAULT(){return Xk||(Xk=new Al)}constructor(t={},e={},i={}){var r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x,S;super(t,e),this._size=((o=(r=t?.size)!==null&&r!==void 0?r:e?.size)!==null&&o!==void 0?o:i?.size)||14,this._spaceBetweenTextAndIcon=((a=(s=t?.spaceBetweenTextAndIcon)!==null&&s!==void 0?s:e?.spaceBetweenTextAndIcon)!==null&&a!==void 0?a:i?.spaceBetweenTextAndIcon)||8,this._defaultFill=(h=(l=t?.checkboxStyle)===null||l===void 0?void 0:l.defaultFill)!==null&&h!==void 0?h:i?.defaultFill,this._defaultStroke=(d=(u=t?.checkboxStyle)===null||u===void 0?void 0:u.defaultStroke)!==null&&d!==void 0?d:i?.defaultStroke,this._disableFill=(g=(c=t?.checkboxStyle)===null||c===void 0?void 0:c.disableFill)!==null&&g!==void 0?g:i?.disableFill,this._checkedFill=(p=(f=t?.checkboxStyle)===null||f===void 0?void 0:f.checkedFill)!==null&&p!==void 0?p:i?.checkedFill,this._checkedStroke=(v=(m=t?.checkboxStyle)===null||m===void 0?void 0:m.checkedStroke)!==null&&v!==void 0?v:i?.checkedStroke,this._disableCheckedFill=(y=(b=t?.checkboxStyle)===null||b===void 0?void 0:b.disableCheckedFill)!==null&&y!==void 0?y:i?.disableCheckedFill,this._disableCheckedStroke=(w=(C=t?.checkboxStyle)===null||C===void 0?void 0:C.disableCheckedStroke)!==null&&w!==void 0?w:i?.disableCheckedStroke,this._checkIconImage=(A=(_=t?.checkboxStyle)===null||_===void 0?void 0:_.checkIconImage)!==null&&A!==void 0?A:i?.checkIconImage,this._indeterminateIconImage=(S=(x=t?.checkboxStyle)===null||x===void 0?void 0:x.indeterminateIconImage)!==null&&S!==void 0?S:i?.indeterminateIconImage}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}get checkIconImage(){return this._checkIconImage}set checkIconImage(t){this._checkIconImage=t}get indeterminateIconImage(){return this._indeterminateIconImage}set indeterminateIconImage(t){this._indeterminateIconImage=t}getStyle(t){return new Al(t,this)}clone(){return new Al(this)}}function Qf(n,t,e,i,r,o){var s;return n||t?n instanceof Vl?n:typeof n=="function"?Qf(n(e),t,e,i,r,o):(n||(n={}),r&&!$(n.autoWrapText)&&(n.autoWrapText=!0),i===Al?new Al(n??{},t??{},(s=o.checkboxStyle)!==null&&s!==void 0?s:{}):new i(n??{},t??{})):i.DEFAULT}class Zut{constructor(t){this._table=t;const e=Fr();this.freezeIcon=e[on.freezeIconName],this.frozenIcon=e[on.frozenIconName],this.frozenCurrentIcon=e[on.frozenCurrentIconName],this.normalIcon=e[on.normalIconName],this.upIcon=e[on.upwardIconName],this.downIcon=e[on.downwardIconName],this.dropDownAbsoluteIcon=e[on.dropdownIconName],this.expandIcon=e[on.expandIconName],this.collapseIcon=e[on.collapseIconName]}getIcons(t,e){const i=[];if(this._table.isPivotTable()){const{showSort:a,sort:l}=this._table.internalProps.layoutMap.getHeader(t,e);let h;if(h=typeof a=="function"?a({col:t,row:e,table:this._table}):a,h){let u=this._table.getPivotSortState(t,e);u&&(u=u.toUpperCase());const d=u==="ASC"?this.upIcon:u==="DESC"?this.downIcon:this.normalIcon;d&&i.push(d)}else if(l){const u=this.getSortIconForPivotTable(this._table.getPivotSortState(t,e),this._table,t,e);u&&i.push(u)}}else{const a=this._table.sortState;let l;l=void 0;const h=this._table.getCellRange(t,e);if(a)if(Array.isArray(a))for(let d=0;d<a.length;d++){const c=a[d],g=this._table._getHeaderCellBySortState(c);if(g&&Ir(h,g.col,g.row)){({order:l}=c);break}}else{const d=this._table._getHeaderCellBySortState(a);d&&Ir(h,d.col,d.row)&&({order:l}=a)}const u=this.getSortIcon(l,this._table,t,e);u&&i.push(u)}if(this._table.showFrozenIcon&&t<this._table.allowFrozenColCount){const a=this.getFrozenIcon(t,e);a&&i.push(a)}if(this.checkDropDownIcon(this._table,t,e)){const a=this.dropDownAbsoluteIcon;i.push(a)}const r=this.getDropDownStateIcons(this._table,t,e);r.length&&i.push(...r);const{headerIcon:o}=this._table._getHeaderLayoutMap(t,e),s=this.getHierarchyIcon(t,e);if(s&&i.push(s),o){let a;typeof o=="function"?a=o({col:t,row:e,value:this._table.getCellValue(t,e),dataValue:this._table.getCellOriginValue(t,e),table:this._table}):a=o;const l=Fr(),h=u=>{let d;d=typeof u=="string"?l[u]:u,d&&i.push(d)};Array.isArray(a)?a.forEach(((u,d)=>{h(u)})):h(a)}return i}getFrozenIcon(t,e){if(this._table.isPivotTable()||this._table.transpose||this._table.rightFrozenColCount&&t>=this._table.colCount-this._table.rightFrozenColCount)return null;const i=this._table.getHeaderDefine(t,e);if(i.columns&&i.columns.length>0)return null;let r=this.freezeIcon;return this._table.options.frozenColCount-1>t?r=this.frozenIcon:this._table.options.frozenColCount-1===t&&(r=this.frozenCurrentIcon),r}getSortIcon(t,e,i,r){const o=t==="asc"?this.upIcon:t==="desc"?this.downIcon:this.normalIcon,s=e.getHeaderDefine(i,r);let a;return s&&(a=typeof s.showSort=="function"?s.showSort({col:i,row:r,table:this._table}):s.showSort),!s||a===!1||!$(a)&&!s.sort||s.columns&&s.columns.length>0?null:o}getSortIconForPivotTable(t,e,i,r){const o=e.getHeaderDefine(i,r);let s;return o&&(s=typeof o.showSort=="function"?o.showSort({col:i,row:r,table:this._table}):o.showSort),!o||s===!1||!$(s)&&!o.sort||o.columns&&o.columns.length>0?null:t?.toUpperCase()==="ASC"?this.upIcon:t?.toUpperCase()==="DESC"?this.downIcon:this.normalIcon}getDropDownStateIcons(t,e,i){var r,o,s;const a=t.getHeaderDefine(e,i),l=t._getHeaderLayoutMap(e,i);let{dropDownMenu:h}=l;typeof h=="function"&&(h=h({row:i,col:e,table:t}));let u=t.globalDropDownMenu;typeof u=="function"&&(u=u({row:i,col:e,table:t}));const d=[];if(Array.isArray(h)&&h.length||Array.isArray(u)&&u.length&&!(!((r=a?.columns)===null||r===void 0)&&r.length)){const c=h||u;let g=-1,f=-1;for(let p=0;p<c.length;p++){const m=c[p];if(typeof m=="object"&&m.children&&m.children.length)for(let v=0;v<m.children.length;v++){const b=m.children[v];if(!((o=t.stateManager.menu)===null||o===void 0)&&o.dropDownMenuHighlight&&Md(t,(s=t.stateManager.menu)===null||s===void 0?void 0:s.dropDownMenuHighlight,typeof b=="object"?b?.menuKey:b,e,i)){g=p,f=v;break}}if(t._dropDownMenuIsHighlight(e,i,p)){g=p;break}}if(g!==-1){let p;p=f!==-1?c[g].children[f]:c[g],p.stateIcon&&(p.stateIcon.svg?d.push({type:"svg",name:p.stateIcon.src||p.stateIcon.svg,width:p.stateIcon.width||22,height:p.stateIcon.height||22,svg:p.stateIcon.svg,positionType:pe.right,marginRight:0,funcType:me.dropDownState,interactive:!1}):p.stateIcon.src&&d.push({type:"image",name:p.stateIcon.src||p.stateIcon.svg,width:p.stateIcon.width||22,height:p.stateIcon.height||22,src:p.stateIcon.src,positionType:pe.right,marginRight:0,funcType:me.dropDownState,interactive:!1}))}}return d}getDropDownIconRect(t,e,i){var r,o,s,a,l,h,u,d;const c=(a=(o=(r=this.downIcon.hover)===null||r===void 0?void 0:r.width)!==null&&o!==void 0?o:(s=this.downIcon)===null||s===void 0?void 0:s.width)!==null&&a!==void 0?a:0,g=(d=(h=(l=this.downIcon.hover)===null||l===void 0?void 0:l.height)!==null&&h!==void 0?h:(u=this.downIcon)===null||u===void 0?void 0:u.height)!==null&&d!==void 0?d:0,f=t.right-2-c,p=t.right-2;let m;return m=i==="middle"?t.top+t.height/2-c/2:i==="top"?t.top+e/2:i==="bottom"?t.bottom-2*e:t.top,{left:f,right:p,top:m,bottom:g+m,width:c,height:g}}getHierarchyIcon(t,e){const{hierarchyState:i}=this._table._getHeaderLayoutMap(t,e);if(i){if(i===Tt.expand)return this.expandIcon;if(i===Tt.collapse)return this.collapseIcon}}getHierarchyIconWidth(){var t,e;return this.expandIcon.width+((t=this.expandIcon.marginLeft)!==null&&t!==void 0?t:0)+((e=this.expandIcon.marginRight)!==null&&e!==void 0?e:0)}checkDropDownIcon(t,e,i){var r;if(t.isPivotTable()){let o=t._getHeaderLayoutMap(e,i).dropDownMenu;if(typeof o=="function"&&(o=o({row:i,col:e,table:t})),Array.isArray(o)&&o.length)return!0}else{const o=t.getHeaderDefine(e,i),s=o.dropDownMenu;let a=t.globalDropDownMenu;if(typeof a=="function"&&(a=a({row:i,col:e,table:t})),Array.isArray(s)&&s.length||(!Array.isArray(o.dropDownMenu)||o.dropDownMenu.length!==0)&&Array.isArray(a)&&a.length&&!(!((r=o?.columns)===null||r===void 0)&&r.length))return!0}return!1}getStyleClass(t){switch(t){case"text":case"link":return Am;case"image":case"video":return Sm;case"checkbox":return Al}}setTableColumnsEditor(){const t=(e,i)=>{e?.forEach(((r,o)=>{r.editor&&(i[o].editor=r.editor),r.columns&&t(r.columns,i[o].columns)}))};t(this._table.options.columns,this._table.internalProps.columns)}}class Yk extends EventTarget{constructor(t,e){if(super(),this._table=t,te.mode==="node")return;const i=document.createElement("div");i.style.opacity="0",i.dataset.vtable="vtable",i.style.pointerEvents="none",i.classList.add("input-container");const r=this._input=document.createElement("input");i.appendChild(r),r.classList.add("table-focus-control"),r.dataset.vtable="vtable",r.readOnly=!0,e.appendChild(i),this._container=i}focus(){this._input.focus({preventScroll:!0})}setFocusRect(t,e){const i=this._input;i.value=e,i.select();const r=t.top-this._table.scrollTop,o=t.left-this._table.scrollLeft;i.style.top=`${r.toFixed()}px`,i.style.left=`${o.toFixed()}px`,i.style.width=`${t.width.toFixed()}px`,i.style.height=`${t.height.toFixed()}px`}get input(){return this._input}release(){var t;(t=this._container.parentElement)===null||t===void 0||t.removeChild(this._container)}}class qk{constructor(t){this.isUpdate=!1,this._keys=[],this._sorted=!1,this.data=new Map,this._keys.length=0,this.cumulativeSum=new Map,this.difference=new Map,this.totalSum=0,this.table=t}get length(){return this.data.size}clear(){this._keys=[],this.data.clear(),this.cumulativeSum.clear(),this.difference.clear(),this.totalSum=0}clearRange(){this.cumulativeSum.clear(),this.difference.clear()}add(t,e){if(!$(e))return;const i=this.table.getRowHeight(t);this.data.has(t)||(this._keys.push(t),this._sorted=!1),this.data.set(t,e),this.totalSum+=e,this.updateDifference(t,e-i)}remove(t){if(this.data.has(t)){const e=this.data.get(t);this.data.delete(t);const i=this._keys.indexOf(t);i!==-1&&this._keys.splice(i,1),this.totalSum-=e;const r=this.table.getRowHeight(t);this.updateDifference(t,r-e)}}put(t,e){if($(e))if(this.data.has(t)){const i=this.data.get(t);if(i===e)return;this.data.set(t,e);const r=e-i;this.totalSum+=r,this.updateDifference(t,r)}else this.add(t,e)}get(t){return this.data.get(t)}has(t){return this.data.has(t)}_sort(){const{_keys:t}=this;this._sorted||(t.sort(((e,i)=>e<i?-1:e>i?1:0)),this._sorted=!0)}updateDifference(t,e){var i;const r=(i=this.difference.get(t))!==null&&i!==void 0?i:0;this.difference.set(t,r+e),this.update()}getSumInRange(t,e){return this.calculatePrefixSum(e)-this.calculatePrefixSum(t-1)}updateCumulativeSum(t,e){for(const[i,r]of this.cumulativeSum)i>=t&&this.cumulativeSum.set(i,r+e)}calculatePrefixSum(t){if(t<0)return 0;if(this.cumulativeSum.has(t)){let e=this.cumulativeSum.get(t);for(const[i,r]of this.difference)i<=t&&(e+=r);return e}return this.dealDiffenence(),this.getCumulativeSum(t)}getCumulativeSum(t){var e,i;let r=0,o=0,s=!1;const a=this.table.rowCount>0&&this.table.bottomFrozenRowCount>0?this.table.rowCount-this.table.bottomFrozenRowCount:-1;for(let l=t;l>=0;l--){if(this.cumulativeSum.has(l)){r+=this.cumulativeSum.get(l);break}r+=(e=this.data.get(l))!==null&&e!==void 0?e:this.table.getRowHeight(l),l>=a&&a!==-1&&(o=r,s=l===a)}if(s&&(!((i=this.table.containerFit)===null||i===void 0)&&i.height)&&this.table.bottomFrozenRowCount){const l=this.table.tableNoFrameHeight||0;r<l&&(r=l-this.table.getBottomFrozenRowsHeight()+o)}return this.cumulativeSum.set(t,r),r}update(){this.isUpdate||(this.isUpdate=!0,setTimeout((()=>{this.dealDiffenence(),this.isUpdate=!1}),0))}dealDiffenence(){for(const[t]of this.cumulativeSum)for(const[e,i]of this.difference)if(t>=e){const r=this.cumulativeSum.get(t);this.cumulativeSum.set(t,r+i)}this.difference.clear()}insert(t,e){for(let r=t;r<=this.getLastIndex();r++)this.cumulativeSum.delete(r);const i=this.getLastIndex()+1;this.adjustOrder(t,t+1,i-t),$(e)&&this.put(t,e)}getLastIndex(){return this._sort(),this._keys[this._keys.length-1]}delLast(){const t=this.getLastIndex();this.remove(t)}delete(t){if(!this.has(t))return;for(let i=t;i<=this.getLastIndex();i++)this.cumulativeSum.delete(i);const e=this.getLastIndex();this.adjustOrder(t+1,t,e-t),this.delLast()}adjustOrder(t,e,i){this.clearRange(),this._sort();const{_keys:r}=this;if(t>e){const s=[];for(let a=hh(r,t+i-1);a>=0;a--){const l=r[a];if(l>=t)s.push(this.get(l));else if(e<=l&&l<t)this.put(l+i,this.get(l));else if(l<e)break}for(let a=0;a<i;a++)this.put(e+a,s[i-1-a])}const{length:o}=r;if(t<e){const s=[];for(let a=hh(r,t);a<o;a++){const l=r[a];if(l>=t&&l<t+i)s.push(this.get(l));else if(t+i<=l&&l<=e)this.put(l-i,this.get(l));else if(l>e)break}for(let a=0;a<i;a++)this.put(e+a,s[a])}}exchangeOrder(t,e,i,r,o){const{_keys:s}=this;if(this._sorted||(s.sort(((a,l)=>a<l?-1:a>l?1:0)),this._sorted=!0),t>i){const a=[],l=[];for(let h=hh(s,i);h<hh(s,t)+e;h++){const u=s[h];u>=t&&u<t+e?l.push(this.get(u)):a.push(this.get(u))}for(let h=0;h<e;h++)this.put(o+h,l[h]);for(let h=0;h<a.length;h++)this.put(o+e+h,a[h])}else{const a=[],l=[];for(let h=hh(s,t);h<hh(s,i)+r;h++){const u=s[h];u>=t&&u<t+e?l.push(this.get(u)):a.push(this.get(u))}for(let h=0;h<e;h++)this.put(o+h,l[h]);for(let h=0;h<a.length;h++)this.put(t+h,a[h])}}}function hh(n,t){let e=0,i=n.length-1;for(;e<=i;){const r=Math.floor((e+i)/2);if(n[r]===t)return r;n[r]>t?i=r-1:e=r+1}return i<0?0:i}class Jut{constructor(t){this._table=t;const e=Fr();this.dragReorderIconName=e[on.dragReorderIconName]}getIcons(t,e){return[this.dragReorderIconName]}}class Qut{constructor(t,e,i="grid",r=void 0){this.hasHideNode=!1,this.sizeIncludeParent=!1,this.tree={id:0,dimensionKey:"",value:"",children:[],level:-1,afterSpanLevel:-1,levelSpan:1,startIndex:0,size:0,startInTotal:0,hierarchyState:void 0},this.totalLevel=0,this.expandedMaxLevel=0,this.dimensionKeys=new na,this.dimensionKeysIncludeVirtual=new na,this.cache=new Map,this.sizeIncludeParent=r!=null,this.setExpandLevel=r,this.hierarchyType=i,this.sharedVar=e,this.reset(t)}reset(t){this.totalLevel=0,this.expandedMaxLevel=0,this.hasHideNode=!1,this.cache.clear(),this.dimensionKeys=new na,this.dimensionKeysIncludeVirtual=new na,this.tree.children=t,this.setTreeNode(this.tree,0,this.tree)}setTreeNode(t,e,i){var r,o,s,a;t.startIndex=e,t.startInTotal=((r=i.startInTotal)!==null&&r!==void 0?r:0)+t.startIndex,t.hide&&(this.hasHideNode=!0),((o=t.dimensionKey)!==null&&o!==void 0?o:t.indicatorKey)&&(t.virtual||this.dimensionKeys.contain(t.indicatorKey?yf:t.dimensionKey)||this.dimensionKeys.put(t.level,t.indicatorKey?yf:t.dimensionKey),this.dimensionKeysIncludeVirtual.contain(t.indicatorKey?yf:t.dimensionKey)||this.dimensionKeysIncludeVirtual.put(t.level,t.indicatorKey?yf:t.dimensionKey),t.id||(t.id=++this.sharedVar.seqId));let l=t.dimensionKey&&this.sizeIncludeParent?1:0;const h=t.children||t.columns;return this.hierarchyType==="grid"||this.hierarchyType===null?h?.length>=1?h.forEach((u=>{var d,c,g;u.level=((d=t.level)!==null&&d!==void 0?d:0)+1,this.hierarchyType==="grid"&&(u.afterSpanLevel=((c=t.afterSpanLevel)!==null&&c!==void 0?c:0)+((g=t.levelSpan)!==null&&g!==void 0?g:1)),this.totalLevel=Math.max(this.totalLevel,u.level+1),l+=this.setTreeNode(u,l,t)})):l=t.level===-1?0:1:t.hierarchyState===Tt.expand&&h?.length>=1?h.forEach((u=>{var d;u.level=((d=t.level)!==null&&d!==void 0?d:0)+1,this.totalLevel=Math.max(this.totalLevel,u.level+1),this.expandedMaxLevel=Math.max(this.expandedMaxLevel,u.level+1),l+=this.setTreeNode(u,l,t)})):t.hierarchyState===Tt.collapse&&h?.length>=1?h.forEach((u=>{var d;u.level=((d=t.level)!==null&&d!==void 0?d:0)+1,this.totalLevel=Math.max(this.totalLevel,u.level+1),this.setTreeNode(u,l,t)})):!t.hierarchyState&&t.level+1<this.setExpandLevel&&(h?.length>=1||h===!0)?(!((s=h[0])===null||s===void 0)&&s.indicatorKey&&this.hierarchyType==="grid-tree"||(t.hierarchyState=Tt.expand),h?.length>=1&&h.forEach((u=>{var d;u.level=((d=t.level)!==null&&d!==void 0?d:0)+1,this.totalLevel=Math.max(this.totalLevel,u.level+1),this.expandedMaxLevel=Math.max(this.expandedMaxLevel,u.level+1),l+=this.setTreeNode(u,l,t)}))):h?.length>=1||h===!0?(!((a=h[0])===null||a===void 0)&&a.indicatorKey&&this.hierarchyType==="grid-tree"||(t.hierarchyState=Tt.collapse),h?.length>=1&&h.forEach((u=>{var d;u.level=((d=t.level)!==null&&d!==void 0?d:0)+1,this.totalLevel=Math.max(this.totalLevel,u.level+1),this.setTreeNode(u,l,t)}))):(t.hierarchyState=Tt.none,l=t.level===-1?0:1),t.size=l,l}getTreePath(t,e=30){const i=[];return this.searchPath(t,this.tree,i,e),i.shift(),i}findNodeById(t,e){return t.find((i=>i.id===e))}searchPath(t,e,i,r){if(!e||t<e.startIndex||t>=e.startIndex+e.size||(i.push(e),!e.children||e.children.length===0||e.level>=r))return;const o=t-e.startIndex;if(this.cache.has(e.level+1)){const l=this.cache.get(e.level+1);if(o>=l.startIndex&&o<l.startIndex+l.size)return void this.searchPath(o,l,i,r)}let s=0,a=e.children.length-1;for(;s<=a;){const l=Math.floor((s+a)/2),h=e.children[l];if(o>=h.startIndex&&o<h.startIndex+h.size){this.cache.set(h.level,h);const u=[];this.cache.forEach(((d,c)=>{c>h.level&&u.push(c)})),u.forEach((d=>{this.cache.delete(d)})),this.searchPath(o,h,i,r);break}o<h.startIndex?a=l-1:s=l+1}}movePosition(t,e,i){let r,o,s;const a=(u,d)=>{if(o!==void 0&&s!==void 0)return;u.level===t&&(u.startInTotal===e&&(o=d),u.startInTotal<=i&&i<=u.startInTotal+u.size-1&&(s=d));const c=u.children||u.columns;if(c&&u.level<t){r=u;for(let g=0;g<c.length;g++)(e>=c[g].startInTotal&&e<=c[g].startInTotal+c[g].size||i>=c[g].startInTotal&&i<=c[g].startInTotal+c[g].size)&&a(c[g],g)}};a(this.tree,0);const l=r.children||r.columns,h=l.splice(o,1);h.unshift(s,0),Array.prototype.splice.apply(l,h)}getCopiedTree(){const t=Ul(this.tree.children);return AF(t),t}setAllNodesState(t){this._updateNodeHierarchyState(this.tree,t)}_updateNodeHierarchyState(t,e){t.children&&t.children.length>0&&t.children[0].dimensionKey?(t.level!==-1&&(t.hierarchyState=e),t.children.forEach((i=>{this._updateNodeHierarchyState(i,e)}))):t.hierarchyState=Tt.none}}function AF(n){for(let t=0;t<n.length;t++){const e=n[t];delete e.level,delete e.startIndex,delete e.id,delete e.levelSpan,delete e.size,delete e.startInTotal;const i=e.children||e.columns;i&&AF(i)}}function tdt(n){const t=n.columnObjects;for(let e=0;e<t.length;e++){const i=t[e];if(i?.aggregation)return!0}return!1}function edt(n){const t=n.columnObjects;let e=0;for(let i=0;i<t.length;i++){const r=t[i];r?.aggregation&&(Array.isArray(r?.aggregation)?e=Math.max(e,r.aggregation.filter((o=>o.showOnTop)).length):r.aggregation.showOnTop&&(e=Math.max(e,1)))}return e}function idt(n){const t=n.columnObjects;let e=0;for(let i=0;i<t.length;i++){const r=t[i];r?.aggregation&&(Array.isArray(r?.aggregation)?e=Math.max(e,r.aggregation.filter((o=>!o.showOnTop)).length):r.aggregation.showOnTop||(e=Math.max(e,1)))}return e}function ndt(n){if(n._table.internalProps.groupBy)return!0;const{columns:t}=n._table.options;if(wt(t)&&t.length>0)for(let e=0;e<t.length;e++){const i=t[e];if(!Xe(i)&&i.tree)return!0}return!1}function rdt(n){const{columns:t,rows:e,indicators:i}=n.options;if(n.isPivotTable()){if(wt(t)&&t.length>0)for(let r=0;r<t.length;r++){const o=t[r];if(!Xe(o)&&(o.headerType==="image"||o.headerType==="video"||typeof o.headerType=="function")&&o.imageAutoSizing)return!0}if(wt(e)&&e.length>0)for(let r=0;r<e.length;r++){const o=e[r];if(!Xe(o)&&(o.headerType==="image"||o.headerType==="video"||typeof o.headerType=="function")&&o.imageAutoSizing)return!0}if(wt(i)&&i.length>0)for(let r=0;r<i.length;r++){const o=i[r];if(!Xe(o)&&((o.cellType==="image"||o.cellType==="video"||typeof o.cellType=="function")&&o.imageAutoSizing||(o.headerType==="image"||o.headerType==="video"||typeof o.headerType=="function")&&o.imageAutoSizing))return!0}}else if(wt(t)&&t.length>0)for(let r=0;r<t.length;r++){const o=t[r];if((o.cellType==="image"||o.cellType==="video"||typeof o.cellType=="function")&&o.imageAutoSizing||(o.headerType==="image"||o.headerType==="video"||typeof o.headerType=="function")&&o.imageAutoSizing)return!0}return!1}function MF(n,t){var e;return zst(t,n)||((e=hS(n,t))!==null&&e!==void 0?e:{top:-1,row:-1,bottom:-1,height:-1})}function TF(n,t){var e;return Nst(t,n)||((e=lS(n,t))!==null&&e!==void 0?e:{left:-1,col:-1,right:-1,width:1})}function odt(n,t,e){const i=MF(t,e),{row:r,top:o,bottom:s,height:a}=i,l=TF(n,e),{col:h,left:u,right:d,width:c}=l;return{row:r,col:h,rect:{left:u,right:d,top:o,bottom:s,width:c,height:a}}}function lS(n,t){if(n===0)return{left:0,col:0,right:0,width:0};const e=adt(n,t),i=t.getColsWidth(0,e);return n>=i?((r,o)=>{let s=o-t.getColWidth(r);const{colCount:a}=t.internalProps;for(let l=r;l<a;l++){const h=t.getColWidth(l),u=s+h;if(Math.round(s)<=n&&n<Math.round(u))return{left:s,col:l,right:u,width:h};s=u}return null})(e,i):((r,o)=>{let s=o;for(let a=r;a>=0;a--){const l=t.getColWidth(a),h=s-l;if(Math.round(h)<=n&&n<Math.round(s))return{left:h,col:a,right:s,width:l};s=h}return null})(e,i)}function hS(n,t){var e;if(n===0)return{top:0,row:0,bottom:0,height:0};const i=((e=t.options.customConfig)===null||e===void 0?void 0:e._disableColumnAndRowSizeRound)===!0?Math.floor:Math.round,r=sdt(n,t),o=t.getRowsHeight(0,r);return n>=o?((s,a)=>{let l=a-t.getRowHeight(s);const{rowCount:h}=t.internalProps;for(let u=s;u<h;u++){const d=t.getRowHeight(u),c=l+d;if(i(l)<=i(n)&&i(n)<i(c))return{top:l,row:u,bottom:c,height:d};l=c}return null})(r,o):((s,a)=>{let l=a;for(let h=s;h>=0;h--){const u=t.getRowHeight(h),d=l-u;if(i(d)<=i(n)&&i(n)<i(l))return{top:d,row:h,bottom:l,height:u};l=d}return null})(r,o)}function RF(n,t,e){if(n===0)return{left:0,col:0,right:0,width:0};if(n-=e.tableX,t&&n>e.tableNoFrameWidth-e.getRightFrozenColsWidth()&&n<e.tableNoFrameWidth&&n<=e.getAllColsWidth()){for(let i=0;i<e.rightFrozenColCount;i++)if(n>e.tableNoFrameWidth-e.getColsWidth(e.colCount-i-1,e.colCount-1))return{col:e.colCount-i-1,left:void 0,right:void 0,width:void 0}}return lS(n,e)}function BF(n,t,e){if(n===0)return{top:0,row:0,bottom:0,height:0};if(n-=e.tableY,t&&n>e.tableNoFrameHeight-e.getBottomFrozenRowsHeight()&&n<e.tableNoFrameHeight){for(let i=0;i<e.rightFrozenColCount;i++)if(n>e.tableNoFrameHeight-e.getRowsHeight(e.rowCount-i-1,e.rowCount-1))return{row:e.rowCount-i-1,top:void 0,bottom:void 0,height:void 0}}return hS(n,e)}function sdt(n,t){let e=t.defaultRowHeight;return t._rowRangeHeightsMap.get("$0$"+(t.rowCount-1))&&(e=t._rowRangeHeightsMap.get("$0$"+(t.rowCount-1))/t.rowCount),Math.min(Math.ceil(n/e),t.rowCount-1)}function adt(n,t){if(t._colRangeWidthsMap.get("$0$"+(t.colCount-1))){let e=0,i=t.colCount-1;for(;i-e>1;){const r=Math.floor((e+i)/2);if(n<t._colRangeWidthsMap.get(`$0$${r}`))i=r;else{if(!(n>t._colRangeWidthsMap.get(`$0$${r}`)))return r;e=r}}return i}return Math.min(Math.ceil(n/t.internalProps.defaultColWidth),t.colCount-1)}function ldt(n,t,e){n-=e.tableX;let i=!1;(t-=e.tableY)>0&&t<e.getFrozenRowsHeight()&&(i=!0);let r=!1;n>0&&n<e.getFrozenColsWidth()&&(r=!0);let o=!1;t>e.tableNoFrameHeight-e.getBottomFrozenRowsHeight()&&t<e.tableNoFrameHeight&&t<=e.getAllRowsHeight()&&(o=!0);let s=!1;n>e.tableNoFrameWidth-e.getRightFrozenColsWidth()&&n<e.tableNoFrameWidth&&n<=e.getAllColsWidth()&&(s=!0);const a=RF((r||s?n:n+e.scrollLeft)+e.tableX,s,e),l=BF((i||o?t:t+e.scrollTop)+e.tableY,o,e);if(a&&l){const{row:h,top:u,bottom:d,height:c}=l,{col:g,left:f,right:p,width:m}=a;return{row:h,col:g,rect:{left:f,right:p,top:u,bottom:d,width:m,height:c}}}return{col:-1,row:-1}}function Kk(n){return n.length===2&&pl(n[0])&&pl(n[1])&&n[1]>=n[0]}function Zk(n){const t=n[1]-n[0],e=n[1]*n[0]<0;let i=n[0]<=0?0-n[0]:0,r=n[1]>0?n[1]-0:0;return t===0?n[0]<0?(i=1,r=0):n[0]>0&&(i=0,r=1):(i/=t,r/=t),{total:t,negative:i,positive:r,includeZero:e,domain:n,extendable_min:!0,extendable_max:!0}}function Jk(n,t){const{positive:e,negative:i,extendable_min:r,extendable_max:o,domain:s}=n,{positive:a,negative:l,extendable_min:h,extendable_max:u,domain:d}=t;if(a>0){if(!h)return!1;let c=i/e;o&&(c=i/Math.max(e,a),s[1]=-s[0]/c),d[0]=-d[1]*c}else if(l>0){if(!u)return!1;let c=e/i;r&&(c=e/Math.max(i,i),s[0]=-s[1]/c),d[1]=-d[0]*c}return!0}function Qk(n,t){const{extendable_min:e,extendable_max:i,domain:r}=n,{positive:o,negative:s,domain:a}=t;return(o!==0||s!==0)&&!(o>0&&!i)&&!(s>0&&!e)&&(r[0]=a[0],r[1]=a[1],!0)}function tP(n,t){const{positive:e,negative:i,extendable_max:r,domain:o}=n,{positive:s,negative:a,extendable_min:l,domain:h}=t;if(r&&l){const u=Math.max(i,a)/Math.max(e,s);o[1]=-o[0]/u,h[0]=-h[1]*u}else if(l){const u=i/e;h[0]=-h[1]*u}else{if(!r)return!1;{const u=a/s;o[1]=-o[0]/u}}return!0}function eP(n,t){const{extendable_min:e,domain:i}=n,{extendable_max:r,domain:o}=t;return!(!e||!r)&&(i[0]=-i[1],o[1]=-o[0],!0)}function hdt(n,t){const e=[n.min,n.max],i=[t.min,t.max];if(!Kk(e)||!Kk(i))return;const r=Zk(e),o=Zk(i),{positive:s,negative:a,extendable_max:l,includeZero:h}=r,{positive:u,negative:d,extendable_max:c,includeZero:g}=o;if(s===0&&a===0){if(!Qk(r,o))return}else if(u===0&&d===0){if(!Qk(o,r))return}else if(h||g)if(h&&!g){if(!Jk(r,o))return}else if(g&&!h){if(!Jk(o,r))return}else{if(a===d)return;if(a>d){if(!tP(r,o))return}else if(!tP(o,r))return}else{if(a===0&&u===0){if(!eP(r,o))return}else if(d===0&&s===0&&!eP(o,r))return;if(a===0&&d===0)if(e[0]===0&&i[0]>0)i[0]=0;else{if(!(i[0]===0&&e[0]>0))return;e[0]=0}if(s===0&&u===0)if(e[1]===0&&i[1]>0){if(!c)return;i[1]=0}else{if(!(i[1]===0&&e[1]>0)||!l)return;e[1]=0}}return{range1:e,range2:i}}function udt(n,t,e,i,r,o){const s=St.getFunction("getAxisDomainRangeAndLabels"),{axisOption:a,isZeroAlign:l}=il(t,e,i===0?"right":"left",o),{ticks:h}=s(n.min,n.max,a,l,r==="bottom"||r==="top"?o._table.getColWidth(t)||o._table.tableNoFrameWidth:o._table.getRowHeight(e)||o._table.tableNoFrameHeight);return h}function Mf(n,t,e,i){return i!==0&&n?()=>n.map((r=>{const o=(r-t.min)/(t.max-t.min),s=(e.max-e.min)*o+e.min;return Math.round(100*s)/100})):void 0}function ddt(n,t,e){var i,r,o,s,a,l,h,u,d,c,g,f,p;if(e._table.isPivotChart())if(e.indicatorsAsCol){if(e.hasTwoIndicatorAxes&&t===e.columnHeaderLevelCount-1&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount){const m=Tf("top",n,t+1,n,e.columnHeaderLevelCount-1,n,t,1,e);if(!m)return;const v=e._table._getCellStyle(n,t+1),b=Kt(ht("padding",v,n,t+1,e._table)),{range:y,ticks:C,axisOption:w,targetTicks:_,targetRange:A,index:x,theme:S}=m;return dt(w?.min)&&(y.min=w.min,y.min>0&&(w.zero=!1)),dt(w?.max)&&(y.max=w.max,y.max<0&&(w.zero=!1)),xe({range:y},w,{orient:"top",type:w?.type||"linear",label:{flush:!0},tick:{tickMode:Mf(_,A,y,x)},__ticksForVTable:C,__vtableChartTheme:S,__vtablePadding:b})}if(t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount){const m=e.getIndicatorKeyInChartSpec(n,t);let v=null;m?.forEach((P=>{const B=e.getIndicatorInfo(P);B&&(v=B)}));const b=Tf("bottom",n,t-1,n,t,n,t,0,e),{chartType:y}=il(n,t-1,"bottom",e);if(!b)return;const C=e._table._getCellStyle(n,t-1),w=Kt(ht("padding",C,n,t-1,e._table)),{range:_,ticks:A,axisOption:x,index:S,targetTicks:T,targetRange:M,theme:R}=b;dt(x?.min)&&(_.min=x.min,_.min>0&&(x.zero=!1)),dt(x?.max)&&(_.max=x.max,_.max<0&&(x.zero=!1));let E=[];if(y==="heatmap"){const P=e.getDimensionKeyInChartSpec(n,e.rowCount-e.bottomFrozenRowCount-1,"xField"),B=(i=e.dataset.collectedValues[P])!==null&&i!==void 0?i:[],k=e.getColKeysPath(n,t);E=(r=B?.[k??""])!==null&&r!==void 0?r:[]}return xe({title:{visible:!0,text:v?.title},range:_,domain:x?.type==="linear"?void 0:Array.from(E)},x,{orient:"bottom",type:x?.type||"linear",label:{flush:!0},tick:{tickMode:Mf(T,M,_,S)},__ticksForVTable:A,__vtableChartTheme:R,__vtablePadding:w})}if(n===e.rowHeaderLevelCount-1&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount){let m=e.getDimensionKeyInChartSpec(e.rowHeaderLevelCount,t);wt(m)&&(m=m[0]);const v=(o=e.dataset.collectedValues[m])!==null&&o!==void 0?o:[],b=e.getRowKeysPath(n,t),y=(s=v[b??""])!==null&&s!==void 0?s:[],{axisOption:C,theme:w,chartType:_}=il(n+1,t,"left",e);if(C?.visible===!1)return;const A=e._table._getCellStyle(n+1,t),x=Kt(ht("padding",A,n+1,t,e._table)),S=e.getRawChartSpec(n+1,t);return xe({domain:C?.type==="linear"?void 0:Array.from(y),range:C?.type==="linear"?y:void 0,title:{autoRotate:!0}},C,{orient:"left",type:(a=C?.type)!==null&&a!==void 0?a:"band",__vtableChartTheme:w,inverse:fdt(C,((l=S?.direction)!==null&&l!==void 0?l:_==="scatter"?"vertical":"horizontal")==="horizontal"),__vtablePadding:x})}}else{if(n===e.rowHeaderLevelCount-1&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount){const m=e.getIndicatorKeyInChartSpec(n,t);let v=null;m?.forEach((P=>{const B=e.getIndicatorInfo(P);B&&(v=B)}));const b=Tf("left",n+1,t,n,t,n,t,0,e),{chartType:y}=il(n+1,t,"left",e);if(!b)return;const C=e._table._getCellStyle(n+1,t),w=Kt(ht("padding",C,n+1,t,e._table)),{range:_,ticks:A,axisOption:x,index:S,targetTicks:T,targetRange:M,theme:R}=b;dt(x?.min)&&(_.min=x.min,_.min>0&&(x.zero=!1)),dt(x?.max)&&(_.max=x.max,_.max<0&&(x.zero=!1));let E=[];if(y==="heatmap"){const P=e.getDimensionKeyInChartSpec(e.rowHeaderLevelCount,t,"yField"),B=(h=e.dataset.collectedValues[P])!==null&&h!==void 0?h:[],k=e.getRowKeysPath(n,t);E=(u=B?.[k??""])!==null&&u!==void 0?u:[]}return xe({title:{visible:!0,text:v?.title,autoRotate:!0},range:_,domain:x?.type==="linear"?void 0:Array.from(E)},x,{orient:"left",type:x?.type||"linear",label:{flush:!0},tick:{tickMode:Mf(T,M,_,S)},__ticksForVTable:A,__vtableChartTheme:R,__vtablePadding:w})}if(n===e.colCount-e.rightFrozenColCount&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount){const m=Tf("right",n-1,t,e.rowHeaderLevelCount-1,t,n,t,1,e),{chartType:v}=il(n-1,t,"right",e);if(!m)return;const b=e._table._getCellStyle(n-1,t),y=Kt(ht("padding",b,n-1,t,e._table)),{range:C,ticks:w,axisOption:_,index:A,targetTicks:x,targetRange:S,theme:T}=m;dt(_?.min)&&(C.min=_.min,C.min>0&&(_.zero=!1)),dt(_?.max)&&(C.max=_.max,C.max<0&&(_.zero=!1));let M=[];if(v==="heatmap"){const R=e.getDimensionKeyInChartSpec(e.colCount-e.rightFrozenColCount-1,t,"yField"),E=(d=e.dataset.collectedValues[R])!==null&&d!==void 0?d:[],P=e.getRowKeysPath(n,t);M=(c=E?.[P??""])!==null&&c!==void 0?c:[]}return xe({range:C,title:{autoRotate:!0},domain:_?.type==="linear"?void 0:Array.from(M)},_,{orient:"right",type:_?.type||"linear",label:{flush:!0},tick:{tickMode:Mf(x,S,C,A)},__ticksForVTable:w,__vtableChartTheme:T,__vtablePadding:y})}if(t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount){let m=e.getDimensionKeyInChartSpec(n,e.columnHeaderLevelCount);wt(m)&&(m=m[0]);const v=(g=e.dataset.collectedValues[m])!==null&&g!==void 0?g:[],b=e.getColKeysPath(n,t),y=(f=v?.[b??""])!==null&&f!==void 0?f:[],{axisOption:C,isPercent:w,theme:_,chartType:A}=il(n,t-1,"bottom",e);if(C?.visible===!1)return;const x=e._table._getCellStyle(n,t-1),S=Kt(ht("padding",x,n,t-1,e._table));return xe({domain:C?.type==="linear"?void 0:Array.from(y),range:C?.type==="linear"?y:void 0},C,{orient:"bottom",type:(p=C?.type)!==null&&p!==void 0?p:"band",__vtableChartTheme:_,__vtablePadding:S})}}}function il(n,t,e,i){var r,o;const s=i.getRawChartSpec(n,t),a=(r=s.axes)!==null&&r!==void 0?r:[];if(i._table.pivotChartAxes.forEach((d=>{a.findIndex((c=>d.orient===c.orient))===-1&&a.push(d)})),s&&wt(a)){const d=a.find((c=>c.orient===e));if(d){const{seriesIndex:c,seriesId:g}=d;let f,p;$(g)&&wt(s.series)?f=(wt(g)?g:[g]).map((b=>{const y=s.series.findIndex((C=>C.id===b));return y>=0&&(p=s.series[y]),y})):$(c)&&wt(s.series)&&(f=c);const{isZeroAlign:m,isTickAlign:v}=iP(s,e,i);return{axisOption:d,isPercent:s.percent,isZeroAlign:m,isTickAlign:v,seriesIndice:f,theme:s.theme,chartType:(o=p?.type)!==null&&o!==void 0?o:s.type}}}const l=i._table.pivotChartAxes.find((d=>d.orient===e)),{isZeroAlign:h,isTickAlign:u}=iP(s,e,i);return{axisOption:l,isPercent:!1,isZeroAlign:h,isTickAlign:u,theme:s.theme,chartType:s.type}}function iP(n,t,e){const i=[];let r;t==="left"||t==="right"?i.push("left","right"):t!=="top"&&t!=="bottom"||i.push("top","bottom"),r=n&&wt(n.axes)?n.axes:e._table.pivotChartAxes;let o=!1,s=!1;if(wt(r)){const a=[];r.forEach((l=>{i.includes(l.orient)&&a.push(l)}));for(let l=0;l<a.length;l++){const h=a[l];h.sync&&h.sync.axisId&&a.find((u=>u.id===h.sync.axisId))&&(o=o||h.sync.zeroAlign,s=s||h.sync.tickAlign)}}return{isZeroAlign:o,isTickAlign:s}}function kF(n,t,e,i,r){var o;if(wt(r)){const h={min:1/0,max:-1/0};for(let u=0;u<r.length;u++){const d=kF(n,t,e,i,r[u]);d&&(h.min=Math.min(h.min,d.min),h.max=Math.max(h.max,d.max))}return isFinite(h.min)&&isFinite(h.max)?h:null}let s=t?.[r];if(wt(s)&&(s=s[0]),!s)return null;const a=n[s],l=xe({},(o=a?.[i??""])!==null&&o!==void 0?o:{min:0,max:1});return l.positiveMax&&l.positiveMax>l.max&&(l.max=l.positiveMax),l.negativeMin&&l.negativeMin<l.min&&(l.min=l.negativeMin),l.min===l.max&&(l.min>0?l.min=0:l.max=0),l}function cdt(n,t,e){if(!e._table.isPivotChart())return!1;if(e.indicatorsAsCol){if(e.hasTwoIndicatorAxes&&t===e.columnHeaderLevelCount-1&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount||t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount)return!0}else if(t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount)return!0;return!1}function gdt(n,t,e){if(!e._table.isPivotChart())return!1;if(e.indicatorsAsCol){if(n===e.rowHeaderLevelCount-1&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount)return!0}else if(n===e.rowHeaderLevelCount-1&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount||n===e.colCount-e.rightFrozenColCount&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount)return!0;return!1}var nP;function fdt(n,t){let e=n?.inverse;return t&&!pdt(n?.orient)&&(e=!$(n?.inverse)||!n?.inverse),e}function pdt(n){return n==="bottom"||n==="top"}(function(n){n.vertical="vertical",n.horizontal="horizontal"})(nP||(nP={}));function Tf(n,t,e,i,r,o,s,a,l){const h=l.getIndicatorKeyInChartSpec(i,r);let u;u=n==="top"||n==="bottom"?l.getColKeysPath(o,s):l.getRowKeysPath(o,s);const d=PF(t,e,a,n,h,u,l);if(!d)return;const c=n==="bottom"?"top":n==="top"?"bottom":n==="left"?"right":"left",{targetRange:g,targetTicks:f}=mdt(t,e,d.index,d.isZeroAlign,d.isTickAlign,d.range,h,c,u,l);if(d.index!==0&&f){const p=St.getFunction("getAxisDomainRangeAndLabels"),{range:m,ticks:v}=p(d.range.min,d.range.max,d.axisOption,d.isZeroAlign,n==="bottom"||n==="top"?l._table.getColWidth(o)||l._table.tableNoFrameWidth:l._table.getRowHeight(s)||l._table.tableNoFrameHeight,{targetTicks:f,targetRange:g});d.range.min=m[0],d.range.max=m[1],d.ticks=v}return d.targetRange=g,d.targetTicks=f,d}function PF(n,t,e,i,r,o,s){const{axisOption:a,isPercent:l,isZeroAlign:h,isTickAlign:u,seriesIndice:d,theme:c,chartType:g}=il(n,t,i,s),f=kF(s.dataset.collectedValues,r,h,o,d??e);if(!f)return;l&&(f.min=f.min<0?-1:0,f.max=f.max>0?1:0),(a?.zero||f.min===f.max)&&(f.min=Math.min(f.min,0),f.max=Math.max(f.max,0));const p=St.getFunction("getAxisDomainRangeAndLabels"),{range:m,ticks:v}=p(f.min,f.max,a,h,i==="bottom"||i==="top"?s._table.getColWidth(n)||s._table.tableNoFrameWidth:s._table.getRowHeight(t)||s._table.tableNoFrameHeight);a?.nice&&(f.min=m[0],f.max=m[1]);const b=v;return dt(a?.min)&&(f.min=a.min),dt(a?.max)&&(f.max=a.max),{index:d??e,range:f,ticks:b,isZeroAlign:h,isTickAlign:u,axisOption:a,theme:c,chartType:g}}function mdt(n,t,e,i,r,o,s,a,l,h){let u,d;if(!i&&!r)return{targetTicks:u,targetRange:d};const c=PF(n,t,s.length-1-e,a,s,l,h);if(c){const{range:g,ticks:f}=c;if(d=g,i){const p=hdt(o,g);p&&(o.min=p.range1[0],o.max=p.range1[1],d.min=p.range2[0],d.max=p.range2[1])}r&&(u=i?udt(d,n,t,e,a,h):f)}return{targetTicks:u,targetRange:d}}class vdt{constructor(t,e,i){this.table=t,this.customCellStyle=e,this.customCellStyleArrangement=i}getCustomCellStyle(t,e){const i=this.getCustomCellStyleIds(t,e);if(i.length){const r=[];return i.forEach((o=>{const s=this.getCustomCellStyleOption(o);if(ur(s?.style)){const a=s.style({col:t,row:e,table:this.table,value:this.table.getCellValue(t,e),dataValue:this.table.getCellOriginValue(t,e),cellHeaderPaths:this.table.getCellHeaderPaths(t,e)});r.push(a)}else s?.style&&r.push(s.style)})),xe({},...r)}}getCustomCellStyleIds(t,e){const i=[],r=this.table.getCellRange(t,e);for(let o=r.start.col;o<=r.end.col;o++)for(let s=r.start.row;s<=r.end.row;s++)this.customCellStyleArrangement.forEach((a=>{a.cellPosition.range?a.cellPosition.range.start.col<=o&&a.cellPosition.range.end.col>=o&&a.cellPosition.range.start.row<=s&&a.cellPosition.range.end.row>=s&&i.push(a.customStyleId):a.cellPosition.col===o&&a.cellPosition.row===s&&i.push(a.customStyleId)}));return i}getCustomCellStyleOption(t){return this.customCellStyle.find((e=>e.id===t))}registerCustomCellStyle(t,e){const i=this.customCellStyle.findIndex((r=>r.id===t));i===-1?this.customCellStyle.push({id:t,style:e}):this.customCellStyle[i]={id:t,style:e},this.customCellStyleArrangement.forEach((r=>{const o=r.cellPosition;if(r.customStyleId===t)if(o.range)for(let s=Math.max(0,o.range.start.col);s<=Math.min(this.table.colCount-1,o.range.end.col);s++)for(let a=Math.max(0,o.range.start.row);a<=Math.min(this.table.rowCount-1,o.range.end.row);a++)this.table.scenegraph.updateCellContent(s,a);else this.table.scenegraph.updateCellContent(o.col,o.row)})),this.table.scenegraph.updateNextFrame()}arrangeCustomCellStyle(t,e,i){var r;const o=this.customCellStyleArrangement.findIndex((a=>a.cellPosition.range&&t.range?a.cellPosition.range.start.col===t.range.start.col&&a.cellPosition.range.start.row===t.range.start.row&&a.cellPosition.range.end.col===t.range.end.col&&a.cellPosition.range.end.row===t.range.end.row:a.cellPosition.col===t.col&&a.cellPosition.row===t.row));if(o===-1&&!e)return;if(o===-1&&e)this.customCellStyleArrangement.push({cellPosition:{col:t.col,row:t.row,range:t.range},customStyleId:e});else{if(this.customCellStyleArrangement[o].customStyleId===e)return;e?this.customCellStyleArrangement[o].customStyleId=e:this.customCellStyleArrangement.splice(o,1)}const s=(r=this.getCustomCellStyleOption(e))===null||r===void 0?void 0:r.style;if(s){i=!0;for(const a in s)if(srt.indexOf(a)===-1){i=!1;break}}if(t.range)for(let a=Math.max(0,t.range.start.col);a<=Math.min(this.table.colCount-1,t.range.end.col);a++)for(let l=Math.max(0,t.range.start.row);l<=Math.min(this.table.rowCount-1,t.range.end.row);l++){const h=this.table.getCellRange(a,l);for(let u=h.start.col;u<=h.end.col;u++)for(let d=h.start.row;d<=h.end.row;d++)this.table.scenegraph.updateCellContent(u,d,i)}else this.table.scenegraph.updateCellContent(t.col,t.row,i);this.table.scenegraph.updateNextFrame()}updateCustomCell(t,e){this.customCellStyle.length=0,this.customCellStyleArrangement.length=0,t.forEach((i=>{this.registerCustomCellStyle(i.id,i.style)})),e.forEach((i=>{this.arrangeCustomCellStyle(i.cellPosition,i.customStyleId)}))}hasCustomCellStyle(t){return this.customCellStyle.some((e=>e.id===t))}}function ud(n,t){n=n.clone();for(const e in t){const i=t[e];$(i)&&(n[`_${e}`]=i)}return n}const bdt=()=>{St.registerComponent("customCellStylePlugin",vdt)},ydt={};function Cdt(n,t,e){var i,r,o,s,a,l,h,u,d,c;const g=(i=e.customCellStylePlugin)===null||i===void 0?void 0:i.getCustomCellStyle(n,t),{layoutMap:f}=e.internalProps;if(f.isHeader(n,t)){let A;if(!e.isPivotTable()||e.isBottomFrozenRow(t)||e.isRightFrozenColumn(n))A=`${n}-${t}`;else{const R=e.getHeaderDefine(n,t),E=e.isCornerHeader(n,t);A=R?.dimensionKey?E?`dim-cor-${R.dimensionKey}`:`dim-${R.dimensionKey}`:R?.indicatorKey?`ind-${R.indicatorKey}`:`${n}-${t}`}let x=e.headerStyleCache.get(A);if(x)return g?ud(x,g):x;const S=f.getHeader(n,t);let T;if(e.isPivotChart()&&cdt(n,t,f)&&f.isAxisCell(n,t)?T=(o=(r=f.getBody(n,e.rowHeaderLevelCount).style)===null||r===void 0?void 0:r.padding)!==null&&o!==void 0?o:e.theme.bodyStyle.padding:e.isPivotChart()&&gdt(n,t,f)&&f.isAxisCell(n,t)&&(T=(a=(s=f.getBody(e.columnHeaderLevelCount,t).style)===null||s===void 0?void 0:s.padding)!==null&&a!==void 0?a:e.theme.bodyStyle.padding),(!S||S.isEmpty)&&(f.isLeftBottomCorner(n,t)||f.isRightBottomCorner(n,t)||f.isCornerHeader(n,t)||f.isRightTopCorner(n,t)))return ydt;const M=e.internalProps.headerHelper.getStyleClass(S?.headerType||"text");if(f.isBottomFrozenRow(n,t)&&e.theme.bottomFrozenStyle)x=Qf(T?{padding:T}:{},e.theme.bottomFrozenStyle,{col:n,row:t,table:e,value:e.getCellValue(n,t),dataValue:e.getCellOriginValue(n,t),cellHeaderPaths:e.getCellHeaderPaths(n,t)},M,e.options.autoWrapText,e.theme);else if(f.isRightFrozenColumn(n,t)&&e.theme.rightFrozenStyle)x=Qf(T?{padding:T}:{},e.theme.rightFrozenStyle,{col:n,row:t,table:e,value:e.getCellValue(n,t),dataValue:e.getCellOriginValue(n,t),cellHeaderPaths:e.getCellHeaderPaths(n,t)},M,e.options.autoWrapText,e.theme);else{const R=S?.style||{};T&&(R.padding=T),x=Qf(R,f.isColumnHeader(n,t)||f.isBottomFrozenRow(n,t)?e.theme.headerStyle:f.isRowHeader(n,t)||f.isRightFrozenColumn(n,t)?e.theme.rowHeaderStyle:e.theme.cornerHeaderStyle,{col:n,row:t,table:e,value:e.getCellValue(n,t),dataValue:e.getCellOriginValue(n,t),cellHeaderPaths:e.getCellHeaderPaths(n,t)},M,e.options.autoWrapText,e.theme)}return e.headerStyleCache.set(A,x),g?ud(x,g):x}let p,m;!((h=(l=e.internalProps)===null||l===void 0?void 0:l.dataConfig)===null||h===void 0)&&h.mappingRules&&!e.isHeader(n,t)&&((c=(d=(u=e.internalProps)===null||u===void 0?void 0:u.dataConfig)===null||d===void 0?void 0:d.mappingRules)===null||c===void 0||c.forEach(((A,x)=>{A.bgColor&&e.internalProps.layoutMap.getIndicatorKey(n,t)===A.bgColor.indicatorKey&&(p=A.bgColor.mapping)})));const v=e.getCellType(n,t),b=e.getCellOriginRecord(n,t);let y;if(m=b?.vtableMerge?"merge-title":e.isSeriesNumberInBody(n,t)?`${n}-series-`+v:e.isListTable()&&!e.transpose||e.isPivotTable()&&e.internalProps.layoutMap.indicatorsAsCol?n+v:t+v,y=b?.vtableMerge?e.bodyMergeTitleCache.get(m):f.isBottomFrozenRow(t)?e.bodyBottomStyleCache.get(m):e.bodyStyleCache.get(m),y)return g?ud(y,g):y;const C=f.getBody(n,t),w=e.internalProps.bodyHelper.getStyleClass(e.getCellType(n,t)),_=C?.style;return y=Xx(_,b?.vtableMerge&&e.theme.groupTitleStyle?e.theme.groupTitleStyle:f.isBottomFrozenRow(t)&&e.theme.bottomFrozenStyle?e.theme.bottomFrozenStyle:f.isRightFrozenColumn(n)&&e.theme.rightFrozenStyle?e.theme.rightFrozenStyle:e.theme.bodyStyle,{col:n,row:t,table:e,value:e.getCellValue(n,t),dataValue:e.getCellOriginValue(n,t),cellHeaderPaths:e.getCellHeaderPaths(n,t)},w,e.options.autoWrapText,e.theme),p&&(y=ud(y,{bgColor:p})),ur(_)||(f.isBottomFrozenRow(t)?e.bodyBottomStyleCache.set(m,y):e.bodyStyleCache.set(m,y)),g?ud(y,g):y}function rP(n){return Math.floor(n)===n}class _dt extends Zt{onUpdate(t,e,i){if(this.from.x!==this.to.x){const r=t?this.to.x:this.from.x+Math.floor((this.to.x-this.from.x)*e);this.params.table.scrollLeft=r}if(this.from.y!==this.to.y){const r=t?this.to.y:this.from.y+Math.floor((this.to.y-this.from.y)*e);this.params.table.scrollTop=r}}}class wdt{constructor(t){this.table=t,this.timeline=new Ix,this.ticker=new OH(this.table.scenegraph.stage),this.ticker.addTimeline(this.timeline),this.ticker.setFPS(60),this.tempGraphic=be({})}scrollTo(t,e){var i,r;const o={x:this.table.scrollLeft,y:this.table.scrollTop},{col:s,row:a}=t;let l,h,u=s,d=a;dt(s)&&!rP(s)&&(u=Math.floor(s),l=s-u),dt(a)&&!rP(a)&&(d=Math.floor(a),h=a-d);const c=this.table.getCellRect(u??0,d??0);let{left:g,top:f}=c;l&&(g+=l*c.width),h&&(f+=h*c.height);const p={x:dt(s)?g-this.table.getFrozenColsWidth():this.table.scrollLeft,y:dt(a)?f-this.table.getFrozenRowsHeight():this.table.scrollTop},m=ko(e)?e?3e3:0:(i=e?.duration)!==null&&i!==void 0?i:3e3,v=ko(e)?e?"linear":"":(r=e?.easing)!==null&&r!==void 0?r:"linear";new LH(Ci.GenAutoIncrementId(),this.timeline).bind(this.tempGraphic).play(new _dt(o,p,m,v,{graphic:this.tempGraphic,table:this.table})),this.ticker.start()}clear(){this.timeline.clear(),this.ticker.stop()}}function Mm(n){return ur(n)?n:wt(n)?(t,e)=>n.find((i=>i.range.start.col<=t&&i.range.end.col>=t&&i.range.start.row<=e&&i.range.end.row>=e)):void 0}let xdt=class{constructor(t,e){var i;this.plugins=new Map,this.table=t,(i=e.plugins)===null||i===void 0||i.map((r=>{this.register(r),this._bindTableEventForPlugin(r)}))}register(t){this.plugins.set(t.id,t)}registerAll(t){t.forEach((e=>this.register(e)))}getPlugin(t){return this.plugins.get(t)}getPluginByName(t){return Array.from(this.plugins.values()).find((e=>e.name===t))}_bindTableEventForPlugin(t){var e;(e=t.runTime)===null||e===void 0||e.forEach((i=>{this.table.on(i,((...r)=>{var o;(o=t.run)===null||o===void 0||o.call(t,...r,i,this.table)}))}))}updatePlugins(t){Array.from(this.plugins.values()).filter((i=>!t?.some((r=>r.id===i.id)))).forEach((i=>{this.release(),this.plugins.delete(i.id)})),this.plugins.forEach((i=>{i.update&&i.update()}));const e=t?.filter((i=>!this.plugins.has(i.id)));e?.forEach((i=>{this.register(i),this._bindTableEventForPlugin(i)}))}release(){this.plugins.forEach((t=>{var e;(e=t.release)===null||e===void 0||e.call(t,this.table)}))}};const{toBoxArray:Ns}=Vrt,{isTouchEvent:Sdt}=jrt,Adt=/^\$(\d+)\$(\d+)$/;Crt();class Mdt extends Rv{static get EVENT_TYPE(){return tt}constructor(t,e={}){var i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x,S,T;if(super(),this.showFrozenIcon=!0,this.version="1.20.3",this.id=`VTable${Date.now()}`,this.isReleased=!1,this._chartEventMap={},this.throttleInvalidate=Brt(this.render.bind(this),200),te.mode==="node"?(e=t,t=null):t instanceof HTMLElement||(e=t,t=t.container?t.container:null),!t&&e.mode!=="node"&&!e.canvas)throw new Error("vtable's container is undefined");this.pluginManager=new xdt(this,e),this.fireListeners(tt.BEFORE_INIT,{options:e,container:t}),t=e.container&&e.container instanceof HTMLElement?e.container:t,((i=e.customConfig)===null||i===void 0?void 0:i.imageAnonymous)===!1&&(Bt.isImageAnonymous=!1);const{frozenColCount:M=0,unfreezeAllOnExceedsMaxWidth:R,frozenRowCount:E,defaultRowHeight:P=40,defaultHeaderRowHeight:B,defaultColWidth:k=80,defaultHeaderColWidth:L,widthMode:O="standard",heightMode:I="standard",autoFillWidth:H=!1,autoFillHeight:D=!1,containerFit:z={width:!1,height:!1},widthAdaptiveMode:G="only-body",heightAdaptiveMode:U="only-body",keyboardOptions:j,eventOptions:X,rowSeriesNumber:Z,enableCheckboxCascade:J,enableHeaderCheckboxCascade:q,columnResizeMode:st,rowResizeMode:Q="none",resize:ot,dragHeaderMode:nt,dragOrder:F,showFrozenIcon:N,allowFrozenColCount:W,padding:V,hover:K,menu:et,select:it,customRender:rt,pixelRatio:lt=Ya,renderChartAsync:ct,renderChartAsyncBatchCount:ut,mode:gt,modeParams:Gt,canvasWidth:re,canvasHeight:Fe,contentOffsetX:Qt,contentOffsetY:Ii,overscrollBehavior:hi,limitMinWidth:ri,limitMinHeight:Ht,clearDOM:Ie=!0}=e,{groupConfig:ye,groupBy:oi,groupTitleFieldFormat:Sn,groupTitleCustomLayout:Ct,enableTreeStickCell:Ve}=e;this.container=t,this.options=e,this._widthMode=O,this._heightMode=I,this._widthAdaptiveMode=G,this._heightAdaptiveMode=U,this._autoFillWidth=H,this._autoFillHeight=D,z!==void 0&&(this._containerFit=typeof z=="boolean"?{width:z,height:z}:z&&typeof z=="object"?{width:(r=z.width)===null||r===void 0||r,height:(o=z.height)===null||o===void 0||o}:{width:!1,height:!1}),this.customRender=rt,this.padding={top:0,right:0,left:0,bottom:0},V&&(typeof V=="number"?(this.padding.top=V,this.padding.left=V,this.padding.bottom=V,this.padding.right=V):(V.top&&(this.padding.top=V.top),V.bottom&&(this.padding.bottom=V.bottom),V.left&&(this.padding.left=V.left),V.right&&(this.padding.right=V.right))),($(Fe)||$(re))&&(this.canvasSizeSeted=!0),this.tableNoFrameWidth=0,this.tableNoFrameHeight=0,this.contentOffsetX=Qt??0,this.contentOffsetY=Ii??0,this.canvasWidth=dt(re)?re:void 0,this.canvasHeight=dt(Fe)?Fe:void 0,this.columnWidthComputeMode=(s=e.columnWidthComputeMode)!==null&&s!==void 0?s:"normal";const bt=this.internalProps={};N!==void 0&&(this.showFrozenIcon=N),typeof W=="number"&&W<=0&&(this.showFrozenIcon=!1),this.options.canvas?(te.mode!=="node"&&(bt.element=this.options.canvas.parentElement,bt.element.style.position="relative"),bt.focusControl=new Yk(this,bt.element),bt.canvas=this.options.canvas,bt.context=bt.canvas.getContext("2d")):te.mode!=="node"&&(bt.element=Hst(this.padding),bt.focusControl=new Yk(this,bt.element),bt.canvas=document.createElement("canvas"),bt.element.appendChild(bt.canvas),bt.context=bt.canvas.getContext("2d"),!((a=e.customConfig)===null||a===void 0)&&a.createReactContainer&&Olt(this)),bt.handler=new Ev,dt(this.options.resizeTime)&&(bt.handler.resizeTime=this.options.resizeTime),bt.pixelRatio=lt,bt.frozenColCount=M,bt.frozenRowCount=E,bt.unfreezeAllOnExceedsMaxWidth=R==null||R,bt.defaultRowHeight=P,bt.defaultHeaderRowHeight=B??P,bt.defaultColWidth=k,bt.defaultHeaderColWidth=L??k,bt.keyboardOptions=j,bt.eventOptions=X,bt.rowSeriesNumber=Z,bt.enableCheckboxCascade=(l=J??Z?.enableTreeCheckbox)===null||l===void 0||l,bt.enableHeaderCheckboxCascade=J||q==null||q,bt.columnResizeMode=(h=ot?.columnResizeMode)!==null&&h!==void 0?h:st,bt.rowResizeMode=(u=ot?.rowResizeMode)!==null&&u!==void 0?u:Q,bt.dragHeaderMode=(c=(d=F?.dragHeaderMode)!==null&&d!==void 0?d:nt)!==null&&c!==void 0?c:"none",bt.renderChartAsync=ct,sk(ut),bt.overscrollBehavior=hi??"auto",bt.groupBy=(g=ye?.groupBy)!==null&&g!==void 0?g:oi,bt.groupTitleCheckbox=(f=ye?.titleCheckbox)!==null&&f!==void 0?f:!!Z?.enableTreeCheckbox,bt.groupTitleFieldFormat=(p=ye?.titleFieldFormat)!==null&&p!==void 0?p:Sn,bt.groupTitleCustomLayout=(m=ye?.titleCustomLayout)!==null&&m!==void 0?m:Ct,bt.enableTreeStickCell=(v=ye?.enableTreeStickCell)!==null&&v!==void 0?v:Ve,bt._rowHeightsMap=new qk(this),bt._rowRangeHeightsMap=new Map,bt._colRangeWidthsMap=new Map,bt._widthResizedColMap=new Set,bt._heightResizedRowMap=new Set,this.colWidthsMap=new na,this.colContentWidthsMap=new na,this.colWidthsLimit={};const Xl=this;if(bt.calcWidthContext={_:bt,get full(){var An,zr;return te.mode==="node"?Xl.canvasWidth/(lt??1):this._.canvas.width/((zr=(An=this._.context.pixelRatio)!==null&&An!==void 0?An:Xl.internalProps.pixelRatio)!==null&&zr!==void 0?zr:window.devicePixelRatio)}},bt.cellTextOverflows={},bt.focusedTable=!1,bt.theme=zs.of((b=e.theme)!==null&&b!==void 0?b:zs.DEFAULT),bt.theme.isPivot=this.isPivotTable(),xf(bt.theme.functionalIconsStyle),t?(Ie&&(t.innerHTML=""),t.appendChild(bt.element),this._updateSize()):this._updateSize(),bt.bodyHelper=new Nut(this),bt.headerHelper=new Zut(this),bt.rowSeriesNumberHelper=new Jut(this),bt.autoWrapText=e.autoWrapText,bt.enableLineBreak=e.enableLineBreak,bt.allowFrozenColCount=(y=e.allowFrozenColCount)!==null&&y!==void 0?y:0,bt.limitMaxAutoWidth=(C=e.limitMaxAutoWidth)!==null&&C!==void 0?C:450,bt.limitMinWidth=ri!=null?typeof ri=="number"?ri:ri?10:0:10,bt.limitMinHeight=Ht!=null?typeof Ht=="number"?Ht:Ht?10:0:10,this.scenegraph=new vht(this),this.stateManager=new lut(this),this.eventManager=new Hut(this),this.animationManager=new wdt(this),e.legends){bt.legends=[];const An=St.getFunction("createLegend");if(Array.isArray(e.legends)){for(let zr=0;zr<e.legends.length;zr++)bt.legends.push(An(e.legends[zr],this));this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}else bt.legends.push(An(e.legends,this)),this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}if(bt.tooltip=Object.assign({parentElement:this.getElement(),renderMode:"html",isShowOverflowTextTooltip:!1,confine:!0,position:Zn.bottom},e.tooltip),bt.tooltip.renderMode==="html"){const An=St.getComponent("tooltipHandler");An&&(bt.tooltipHandler=new An(this,bt.tooltip.confine))}if(bt.menu=Object.assign({renderMode:"html"},e.menu),Array.isArray((w=e.menu)===null||w===void 0?void 0:w.dropDownMenuHighlight)&&this.setDropDownMenuHighlight((_=e.menu)===null||_===void 0?void 0:_.dropDownMenuHighlight),(Array.isArray((A=e.menu)===null||A===void 0?void 0:A.defaultHeaderMenuItems)||typeof((x=e.menu)===null||x===void 0?void 0:x.defaultHeaderMenuItems)=="function")&&(this.globalDropDownMenu=e.menu.defaultHeaderMenuItems),bt.menu.renderMode==="html"){const An=St.getComponent("menuHandler");bt.menuHandler=new An(this)}this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyMergeTitleCache=new Map,this.bodyBottomStyleCache=new Map,bt.stick={changedCells:new Map},bt.customMergeCell=Mm(e.customMergeCell);const Yl=St.getComponent("customCellStylePlugin");Yl&&(this.customCellStylePlugin=new Yl(this,(S=e.customCellStyle)!==null&&S!==void 0?S:[],(T=e.customCellStyleArrangement)!==null&&T!==void 0?T:[])),this._adjustCanvasSizeByOption()}_adjustCanvasSizeByOption(){this.options.canvasHeight!=="auto"&&this.options.canvasWidth!=="auto"||setTimeout((()=>{var t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x;let S,T;if(this.options.canvasHeight==="auto"){let M=0;if(!((t=this.theme.frameStyle)===null||t===void 0)&&t.innerBorder)M+=(r=Ns((i=(e=this.internalProps.theme.frameStyle)===null||e===void 0?void 0:e.shadowBlur)!==null&&i!==void 0?i:[0])[1])!==null&&r!==void 0?r:0;else if(this.theme.frameStyle){const R=Ns((s=(o=this.internalProps.theme.frameStyle)===null||o===void 0?void 0:o.borderLineWidth)!==null&&s!==void 0?s:[null]),E=Ns((l=(a=this.internalProps.theme.frameStyle)===null||a===void 0?void 0:a.shadowBlur)!==null&&l!==void 0?l:[0]);M+=((h=R[0])!==null&&h!==void 0?h:0)+((u=E[0])!==null&&u!==void 0?u:0)+(((d=R[2])!==null&&d!==void 0?d:0)+((c=E[2])!==null&&c!==void 0?c:0))}T=Math.min(this.options.maxCanvasHeight?this.options.maxCanvasHeight-M:2e4,this.getAllRowsHeight())+M}else T=this.canvasHeight;if(this.options.canvasWidth==="auto"){let M=0;if(!((g=this.theme.frameStyle)===null||g===void 0)&&g.innerBorder)M+=(m=Ns((p=(f=this.internalProps.theme.frameStyle)===null||f===void 0?void 0:f.shadowBlur)!==null&&p!==void 0?p:[0])[2])!==null&&m!==void 0?m:0;else if(this.theme.frameStyle){const R=Ns((b=(v=this.internalProps.theme.frameStyle)===null||v===void 0?void 0:v.borderLineWidth)!==null&&b!==void 0?b:[null]),E=Ns((C=(y=this.internalProps.theme.frameStyle)===null||y===void 0?void 0:y.shadowBlur)!==null&&C!==void 0?C:[0]);M+=((w=R[1])!==null&&w!==void 0?w:0)+((_=E[1])!==null&&_!==void 0?_:0)+(((A=R[3])!==null&&A!==void 0?A:0)+((x=E[3])!==null&&x!==void 0?x:0))}S=Math.min(this.options.maxCanvasWidth?this.options.maxCanvasWidth-M:2e4,this.getAllColsWidth())+M}else S=this.canvasWidth;this.setCanvasSize(S,T)}),0)}getContainer(){return this.container}getElement(){return this.internalProps.element}get canvas(){return this.internalProps.canvas}setCanvasSize(t,e){this.canvasWidth=t,this.canvasHeight=e,this.options.canvasHeight=e,this.options.canvasWidth=t,this.resize()}setContentInsetXY(t,e){this.contentOffsetX=t,this.contentOffsetY=e,this.options.contentOffsetX=t,this.options.contentOffsetY=e,this.resize()}resize(){var t;this._updateSize(),(t=this.internalProps.legends)===null||t===void 0||t.forEach((e=>{e?.resize()})),this.internalProps.title&&this.internalProps.title.resize(),this.internalProps.emptyTip&&this.internalProps.emptyTip.resize(),this.scenegraph.resize()}get rowCount(){return this.internalProps.rowCount}set rowCount(t){this.internalProps.rowCount=t}get colCount(){var t;return(t=this.internalProps.colCount)!==null&&t!==void 0?t:0}set colCount(t){this.internalProps.colCount=t}get frozenColCount(){var t,e,i,r,o;return(o=(i=(e=(t=this.internalProps)===null||t===void 0?void 0:t.layoutMap)===null||e===void 0?void 0:e.frozenColCount)!==null&&i!==void 0?i:(r=this.internalProps)===null||r===void 0?void 0:r.frozenColCount)!==null&&o!==void 0?o:0}set frozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t,this.options.frozenColCount=t;const e=this._getMaxFrozenWidth();if(this.getColsWidth(0,t-1)>e)if(this.internalProps.unfreezeAllOnExceedsMaxWidth)this.internalProps.frozenColCount=0;else{const i=this._getComputedFrozenColCount(t);this.internalProps.frozenColCount=i}this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}setFrozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t,this.options.frozenColCount=t;const e=this._getMaxFrozenWidth();if(this.getColsWidth(0,t-1)>e)if(this.internalProps.unfreezeAllOnExceedsMaxWidth)this.internalProps.frozenColCount=0;else{const i=this._getComputedFrozenColCount(t);this.internalProps.frozenColCount=i}this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}_setFrozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t}_resetFrozenColCount(){this.options.frozenColCount&&(this.tableNoFrameWidth-this.getColsWidth(0,this.options.frozenColCount-1)<=120?this._setFrozenColCount(0):this.frozenColCount!==this.options.frozenColCount&&this._setFrozenColCount(this.options.frozenColCount))}get frozenRowCount(){var t,e,i,r,o;return(o=(i=(e=(t=this.internalProps)===null||t===void 0?void 0:t.layoutMap)===null||e===void 0?void 0:e.frozenRowCount)!==null&&i!==void 0?i:(r=this.internalProps)===null||r===void 0?void 0:r.frozenRowCount)!==null&&o!==void 0?o:0}set frozenRowCount(t){this.internalProps.frozenRowCount=t,this.options.frozenRowCount=t,this.stateManager.setFrozenRow(this.internalProps.frozenRowCount)}_setFrozenRowCount(t){this.internalProps.frozenRowCount=t,this.stateManager.setFrozenRow(this.internalProps.frozenRowCount)}get rightFrozenColCount(){var t,e,i,r,o;return(o=(i=(e=(t=this.internalProps)===null||t===void 0?void 0:t.layoutMap)===null||e===void 0?void 0:e.rightFrozenColCount)!==null&&i!==void 0?i:(r=this.internalProps)===null||r===void 0?void 0:r.rightFrozenColCount)!==null&&o!==void 0?o:0}set rightFrozenColCount(t){this.scenegraph.dealWidthRightFrozen(t)}get bottomFrozenRowCount(){var t,e,i,r,o;return(o=(i=(e=(t=this.internalProps)===null||t===void 0?void 0:t.layoutMap)===null||e===void 0?void 0:e.bottomFrozenRowCount)!==null&&i!==void 0?i:(r=this.internalProps)===null||r===void 0?void 0:r.bottomFrozenRowCount)!==null&&o!==void 0?o:0}set bottomFrozenRowCount(t){this.scenegraph.dealWidthBottomFrozen(t)}get defaultRowHeight(){return dt(this.internalProps.defaultRowHeight)?this.internalProps.defaultRowHeight:40}set defaultRowHeight(t){this.internalProps.defaultRowHeight=t,this.options.defaultRowHeight=t}get defaultHeaderRowHeight(){return this.internalProps.defaultHeaderRowHeight}set defaultHeaderRowHeight(t){this.internalProps.defaultHeaderRowHeight=t,this.options.defaultHeaderRowHeight=t}get defaultColWidth(){return this.internalProps.defaultColWidth}set defaultColWidth(t){this.internalProps.defaultColWidth=t,this.options.defaultColWidth=t}get defaultHeaderColWidth(){return this.internalProps.defaultHeaderColWidth}set defaultHeaderColWidth(t){this.internalProps.defaultHeaderColWidth=t,this.options.defaultHeaderColWidth=t}get colWidthsMap(){return this.internalProps._colWidthsMap}set colWidthsMap(t){this.internalProps._colWidthsMap=t}get colContentWidthsMap(){return this.internalProps._colContentWidthsMap}set colContentWidthsMap(t){this.internalProps._colContentWidthsMap=t}get _colRangeWidthsMap(){return this.internalProps._colRangeWidthsMap}set _colRangeWidthsMap(t){this.internalProps._colRangeWidthsMap=t}get _rowRangeHeightsMap(){return this.internalProps._rowRangeHeightsMap}set _rowRangeHeightsMap(t){this.internalProps._rowRangeHeightsMap=t}get rowHeightsMap(){return this.internalProps._rowHeightsMap}set rowHeightsMap(t){this.internalProps._rowHeightsMap=t}get colWidthsLimit(){return this.internalProps._colWidthsLimit}set colWidthsLimit(t){this.internalProps._colWidthsLimit=t}get keyboardOptions(){var t;return(t=this.internalProps.keyboardOptions)!==null&&t!==void 0?t:null}set keyboardOptions(t){this.internalProps.keyboardOptions=t??void 0}get eventOptions(){var t;return(t=this.internalProps.eventOptions)!==null&&t!==void 0?t:null}set eventOptions(t){this.internalProps.eventOptions=t??void 0}get widthMode(){return this._widthMode}set widthMode(t){t!==this._widthMode&&(this._widthMode=t,this.options.widthMode=t)}get heightMode(){return this._heightMode}set heightMode(t){t!==this._heightMode&&(this._heightMode=t,this.options.heightMode=t)}get autoFillWidth(){return this._autoFillWidth}set autoFillWidth(t){t!==this._autoFillWidth&&(this._autoFillWidth=t)}get autoFillHeight(){return this._autoFillHeight}set autoFillHeight(t){t!==this._autoFillHeight&&(this._autoFillHeight=t)}get widthAdaptiveMode(){return this._widthAdaptiveMode}set widthAdaptiveMode(t){t!==this._widthAdaptiveMode&&(this._widthAdaptiveMode=t)}get heightAdaptiveMode(){return this._heightAdaptiveMode}set heightAdaptiveMode(t){t!==this._heightAdaptiveMode&&(this._heightAdaptiveMode=t)}_colWidthDefineToPxWidth(t){return t==="auto"?0:sh(this,t)}_getMaxFrozenWidth(){var t;const e=(t=this.options.maxFrozenWidth)!==null&&t!==void 0?t:"80%";return sh(this,e)}_getComputedFrozenColCount(t){const e=this._getMaxFrozenWidth();let i=t;for(;this.getColsWidth(0,i-1)>e&&(i--,!(i<=0)););return i}_getColWidthLimits(t){const e=this.colWidthsLimit[t];if(!e)return null;const i={};return e.min&&(i.min=sh(this,e.min),i.minDef=e.min),e.max&&(i.max=sh(this,e.max),i.maxDef=e.max),i}_adjustColWidth(t,e){const i=this._getColWidthLimits(t);return Math.max(Wst(i,e),0)}get pixelRatio(){return this.internalProps.pixelRatio}setPixelRatio(t){var e;if(t!==((e=this.internalProps)===null||e===void 0?void 0:e.pixelRatio)){this.internalProps.pixelRatio=t;const i=this,r=this.canvasWidth;this.internalProps.calcWidthContext={_:this.internalProps,get full(){var o,s;return te.mode==="node"?r/(t??1):this._.canvas.width/((s=(o=this._.context.pixelRatio)!==null&&o!==void 0?o:i.internalProps.pixelRatio)!==null&&s!==void 0?s:window.devicePixelRatio)}},this.scenegraph.setPixelRatio(t)}}_updateSize(){var t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x,S,T,M,R,E,P;const{padding:B}=this;let k=0,L=0;if(this.tableX=this.contentOffsetX,this.tableY=this.contentOffsetY,this.options.canvas&&this.options.viewBox)k=this.options.viewBox.x2-this.options.viewBox.x1,L=this.options.viewBox.y2-this.options.viewBox.y1,!((t=this==null?void 0:this.scenegraph)===null||t===void 0)&&t.stage&&(this.options.viewBox?this.scenegraph.stage.setViewBox(this.options.viewBox,!1):this.scenegraph.stage.resize(k,L));else if(te.mode==="browser"){const G=this.getElement();let U=0,j=0;const X=$(this.canvasWidth),Z=$(this.canvasHeight);if(this.canvasSizeSeted&&(X&&(U=this.canvasWidth),Z&&(j=this.canvasHeight)),(!X||!Z)&&G.parentElement){const q=G.parentElement.style||window.getComputedStyle(G.parentElement);X||(U=G.parentElement.offsetWidth-(parseInt(q.paddingLeft,10)||0)-(parseInt(q.paddingRight,10)||0)),Z||(j=G.parentElement.offsetHeight-parseInt(q.paddingTop||"0px",10)-parseInt(q.paddingBottom||"0px",20)),U=(U??1)-(this.options.tableSizeAntiJitter?1:0),j=(j??1)-(this.options.tableSizeAntiJitter?1:0)}G.style.width=U&&U-B.left-B.right+"px"||"0px",G.style.height=j&&j-B.top-B.bottom+"px"||"0px";const{canvas:J}=this.internalProps;k=((i=(e=J.parentElement)===null||e===void 0?void 0:e.offsetWidth)!==null&&i!==void 0?i:1)-(this.options.tableSizeAntiJitter?1:0),L=((o=(r=J.parentElement)===null||r===void 0?void 0:r.offsetHeight)!==null&&o!==void 0?o:1)-(this.options.tableSizeAntiJitter?1:0),!((s=this==null?void 0:this.scenegraph)===null||s===void 0)&&s.stage?!((a=this.options)===null||a===void 0)&&a.viewBox&&!(!((l=this.options)===null||l===void 0)&&l.canvas)&&this.scenegraph.stage.resize(k,L):(J.style.width="",J.style.height="",J.width=k,J.height=L,J.style.width=`${k}px`,J.style.height=`${L}px`),!((h=this.options)===null||h===void 0)&&h.viewBox&&(k=this.options.viewBox.x2-this.options.viewBox.x1,L=this.options.viewBox.y2-this.options.viewBox.y1),!((u=this==null?void 0:this.scenegraph)===null||u===void 0)&&u.stage&&(this.options.viewBox?this.scenegraph.stage.setViewBox(this.options.viewBox,!1):this.scenegraph.stage.resize(k,L))}else te.mode==="node"&&(k=this.canvasWidth-1,L=this.canvasHeight-1);const O=this.getTheme().scrollStyle;let I=0,H=0;I=this.shouldVScrollBarWidthShow(k,L,O)?by(O):0,H=this.shouldHScrollBarWidthShow(k,L,O)?vy(O):0;const D=Math.floor(k-I),z=Math.floor(L-H);if(!((d=this.internalProps.theme)===null||d===void 0)&&d.frameStyle){const G=Ns((g=(c=this.internalProps.theme.frameStyle)===null||c===void 0?void 0:c.borderLineWidth)!==null&&g!==void 0?g:[null]),U=Ns((p=(f=this.internalProps.theme.frameStyle)===null||f===void 0?void 0:f.shadowBlur)!==null&&p!==void 0?p:[0]);if(!((m=this.theme.frameStyle)===null||m===void 0)&&m.innerBorder)this.tableX+=this.contentOffsetX,this.tableY+=this.contentOffsetY,this.tableNoFrameWidth=D-((v=U[1])!==null&&v!==void 0?v:0)-this.contentOffsetX,this.tableNoFrameHeight=z-((b=U[2])!==null&&b!==void 0?b:0)-this.contentOffsetY;else{this.tableX+=((y=G[3])!==null&&y!==void 0?y:0)+((C=U[3])!==null&&C!==void 0?C:0),this.tableY+=((w=G[0])!==null&&w!==void 0?w:0)+((_=U[0])!==null&&_!==void 0?_:0);const j=((A=G[1])!==null&&A!==void 0?A:0)+((x=U[1])!==null&&x!==void 0?x:0);this.tableNoFrameWidth=D-(j>I?j-I:0)-(((S=G[3])!==null&&S!==void 0?S:0)+((T=U[3])!==null&&T!==void 0?T:0))-this.contentOffsetX;const X=((M=G[2])!==null&&M!==void 0?M:0)+((R=U[2])!==null&&R!==void 0?R:0);this.tableNoFrameHeight=z-(X>H?X-H:0)-(((E=G[0])!==null&&E!==void 0?E:0)+((P=U[0])!==null&&P!==void 0?P:0))-this.contentOffsetY}}this._clearColRangeWidthsMap(),this._clearRowRangeHeightsMap()}shouldVScrollBarWidthShow(t,e,i){if(i.hoverOn||i.visible==="none")return!1;const r=this.getAllRowsHeight(),o=i.visible?vy(i):0;if(r>e-o&&r<=e){const s=this.getAllColsWidth(),a=i.visible?by(i):0;if(s>t-a&&s<=t)return!1;if(s>t)return!0;if(s<=t-a)return!1}return!(r<=e-o)}shouldHScrollBarWidthShow(t,e,i){if(i.hoverOn||i.visible==="none")return!1;const r=this.getAllColsWidth(),o=i.visible?by(i):0;if(r>t-o&&r<=t){const s=this.getAllRowsHeight(),a=i.visible?vy(i):0;if(s>e-a&&s<=e)return!1;if(s>e)return!0;if(s<=e-a)return!1}return!(r<=t-o)}updateViewBox(t){var e,i,r,o,s,a,l,h,u,d,c,g;const f=((r=(i=(e=this.options)===null||e===void 0?void 0:e.viewBox)===null||i===void 0?void 0:i.x2)!==null&&r!==void 0?r:0)-((a=(s=(o=this.options)===null||o===void 0?void 0:o.viewBox)===null||s===void 0?void 0:s.x1)!==null&&a!==void 0?a:0),p=((u=(h=(l=this.options)===null||l===void 0?void 0:l.viewBox)===null||h===void 0?void 0:h.y2)!==null&&u!==void 0?u:0)-((g=(c=(d=this.options)===null||d===void 0?void 0:d.viewBox)===null||c===void 0?void 0:c.y1)!==null&&g!==void 0?g:0),m=t.x2-t.x1,v=t.y2-t.y1;this.options.viewBox=t,f!==m||p!==v?this.resize():this.scenegraph.stage.setViewBox(this.options.viewBox,!0)}setViewBoxTransform(t,e,i,r,o,s){this.internalProps.modifiedViewBoxTransform=!0,this.scenegraph.stage.window.setViewBoxTransform(t,e,i,r,o,s)}get rowHierarchyType(){return this.dataSource.rowHierarchyType}getColsWidth(t,e){var i;if(t>e)return 0;t=Math.max(t,0),e=Math.min(e,((i=this.colCount)!==null&&i!==void 0?i:1/0)-1);const r=this._colRangeWidthsMap.get(`$${t}$${e}`);if(r!=null)return r;const o=this._colRangeWidthsMap.get(`$${t}$${e-1}`);if(o!=null){let a=o+this.getColWidth(e);return this.rightFrozenColCount>0&&e===this.colCount-this.rightFrozenColCount&&(a=this._getRangeSizeForContainerFit(t,e,a,"col")),t>=0&&e>=0&&!Number.isNaN(a)&&this._colRangeWidthsMap.set(`$${t}$${e}`,Math.round(a)),Math.round(a)}let s=0;for(let a=t;a<=e;a++)s+=this.getColWidth(a);return s=this._getRangeSizeForContainerFit(t,e,s,"col"),t>=0&&e>=0&&this._colRangeWidthsMap.set(`$${t}$${e}`,Math.round(s)),Math.round(s)}getRowHeight(t){var e;if($(this.rowHeightsMap.get(t))){if(!((e=this.options.customConfig)===null||e===void 0)&&e._disableColumnAndRowSizeRound){const r=this.rowHeightsMap.get(t);let o;return o=t<this.frozenRowCount?this.rowHeightsMap.getSumInRange(0,t):t>=this.rowCount-this.bottomFrozenRowCount?this.rowHeightsMap.getSumInRange(t,this.rowCount-1):this.rowHeightsMap.getSumInRange(this.frozenRowCount,t),o=Number(o.toFixed(2)),Number.isInteger(o)?Math.ceil(r):Math.floor(r)}return this.rowHeightsMap.get(t)}const i=this.getDefaultRowHeight(t);return dt(i)?i:this.defaultRowHeight}getDefaultColumnWidth(t){var e,i;return this.isRowHeader(t,0)||this.isCornerHeader(t,0)?Array.isArray(this.defaultHeaderColWidth)?(e=this.defaultHeaderColWidth[t])!==null&&e!==void 0?e:this.defaultColWidth:this.defaultHeaderColWidth:this.isRightFrozenColumn(t,this.columnHeaderLevelCount)&&this.isPivotTable()?Array.isArray(this.defaultHeaderColWidth)?(i=this.defaultHeaderColWidth[this.rowHeaderLevelCount-this.rightFrozenColCount])!==null&&i!==void 0?i:this.defaultColWidth:this.defaultHeaderColWidth:this.defaultColWidth}getDefaultRowHeight(t){var e,i;return this.isColumnHeader(0,t)||this.isCornerHeader(0,t)||this.isSeriesNumberInHeader(0,t)?Array.isArray(this.defaultHeaderRowHeight)?(e=this.defaultHeaderRowHeight[t])!==null&&e!==void 0?e:this.internalProps.defaultRowHeight:this.defaultHeaderRowHeight:this.isBottomFrozenRow(t)?Array.isArray(this.defaultHeaderRowHeight)?(i=this.defaultHeaderRowHeight[this.columnHeaderLevelCount>0?this.columnHeaderLevelCount-this.bottomFrozenRowCount:0])!==null&&i!==void 0?i:this.internalProps.defaultRowHeight:this.defaultHeaderRowHeight:this.internalProps.defaultRowHeight}_setRowHeight(t,e,i){var r;this.rowHeightsMap.put(t,!((r=this.options.customConfig)===null||r===void 0)&&r._disableColumnAndRowSizeRound?e:Math.round(e)),i&&this._clearRowRangeHeightsMap(t)}setRowHeight(t,e){this.scenegraph.setRowHeight(t,e),this.scenegraph.updateChartSizeForResizeRowHeight(t),this.internalProps._heightResizedRowMap.add(t)}getRowsHeight(t,e){var i,r;if(t>e||this.rowCount===0)return 0;t=Math.max(t,0),e=Math.min(e,((i=this.rowCount)!==null&&i!==void 0?i:1/0)-1);let o=0;const s=this.options.defaultRowHeight==="auto";if(this.heightMode!=="standard"||this.options.customComputeRowHeight||this.autoFillHeight||!this.internalProps.layoutMap||this.hasAutoImageColumn()||s||this.internalProps._heightResizedRowMap.size!==0){if(!((r=this.options.customConfig)===null||r===void 0)&&r._disableColumnAndRowSizeRound){const a=this.rowHeightsMap.getSumInRange(t,e);let l;return l=e<this.frozenRowCount?this.rowHeightsMap.getSumInRange(0,e):e>=this.rowCount-this.bottomFrozenRowCount?this.rowHeightsMap.getSumInRange(e,this.rowCount-1):this.rowHeightsMap.getSumInRange(this.frozenRowCount,e),l=Number(l.toFixed(2)),Number.isInteger(l)?Math.ceil(a):Math.floor(a)}o=this.rowHeightsMap.getSumInRange(t,e)}else{const a=this.rowCount-this.bottomFrozenRowCount;for(let h=t;h<Math.min(e+1,this.columnHeaderLevelCount);h++)o+=this.getRowHeight(h);e>=this.columnHeaderLevelCount&&(o+=this.defaultRowHeight*(Math.min(e,a-1)-Math.max(this.columnHeaderLevelCount,t)+1));let l=0;for(let h=a;h<e+1;h++)l+=this.getRowHeight(h);o=this._getRangeSizeForContainerFit(t,e,o+l,"row")}return Math.round(o)}_getRangeSizeForContainerFit(t,e,i,r="col"){var o;if(!isFinite(t)||!isFinite(e))return i;const s=r==="col"?{totalCount:"colCount",frozenCount:"rightFrozenColCount",fitType:"width",tableSize:"tableNoFrameWidth",getSize:"getColWidth"}:{totalCount:"rowCount",frozenCount:"bottomFrozenRowCount",fitType:"height",tableSize:"tableNoFrameHeight",getSize:"getRowHeight"},a=this[s.tableSize];if(i>=a)return i;const l=this[s.totalCount]-this[s.frozenCount];if(!isFinite(this[s.totalCount])||this[s.frozenCount]<=0||l<0||t>l||e<l||t===e||!(!((o=this.containerFit)===null||o===void 0)&&o[s.fitType]))return i;const h=this[s.totalCount]-1;let u=a;if(t>0){for(let d=0;d<t;d++)if(u-=this[s.getSize](d),u<=0)return i}if(e!==h){for(let d=e+1;d<=h;d++)if(u-=this[s.getSize](d),u<=0)return i}return u}getColWidthDefined(t){var e;const{layoutMap:i}=this.internalProps;if(this.widthMode==="autoWidth")return"auto";const{width:r}=(e=i?.getColumnWidthDefined(t))!==null&&e!==void 0?e:{};return typeof r=="number"&&r<=0?0:r||this.getDefaultColumnWidth(t)}getColWidthDefinedNumber(t){const e=this.getColWidthDefined(t);return this._adjustColWidth(t,this._colWidthDefineToPxWidth(e))}isAutoRowHeight(t){return this.heightMode==="autoHeight"||!!this.options.customComputeRowHeight||(t>=0&&t<this.columnHeaderLevelCount?this.getDefaultRowHeight(t)==="auto":this.internalProps.defaultRowHeight==="auto")}getColWidth(t){var e;const i=(e=this.colWidthsMap.get(t))!==null&&e!==void 0?e:this.getDefaultColumnWidth(t);return this.widthMode==="adaptive"&&typeof i=="number"||this.transpose&&typeof i=="number"?this._colWidthDefineToPxWidth(i):this._adjustColWidth(t,this._colWidthDefineToPxWidth(i))}_setColWidth(t,e,i,r){this.colWidthsMap.put(t,typeof e=="number"?Math.round(e):e),i&&this._clearColRangeWidthsMap(t),r||this.stateManager.checkFrozen()}setColWidth(t,e){this.scenegraph.setColWidth(t,e),this.scenegraph.updateChartSizeForResizeColWidth(t),this.internalProps._widthResizedColMap.add(t)}_clearColRangeWidthsMap(t){if(typeof t!="number")this._colRangeWidthsMap.clear();else{const e=this._colRangeWidthsMap.keys();for(const i of e){const r=Adt.exec(i);if(r){const o=Number(r[1]),s=Number(r[2]);t>=o&&t<=s&&this._colRangeWidthsMap.delete(i)}}}}_clearRowRangeHeightsMap(t){this.rowHeightsMap.clearRange()}_getColContentWidth(t){return Number(this.colContentWidthsMap.get(t))}_setColContentWidth(t,e){this.colContentWidthsMap.put(t,e)}getAllRowsHeight(){return this.internalProps.rowCount<=0?0:this.getRowsHeight(0,this.internalProps.rowCount-1)}getAllColsWidth(){return this.internalProps.colCount<=0?0:this.getColsWidth(0,this.internalProps.colCount-1)}getColsWidths(){const t=this.colCount,e=[];for(let i=0;i<t;i++)e.push(this.getColWidth(i));return e}getMaxColWidth(t){var e;const i=this.colWidthsLimit[t];let r=(e=i&&i.max)!==null&&e!==void 0?e:1/0;return typeof r=="string"&&(r=sh(this,r)),r}setMaxColWidth(t,e){(this.colWidthsLimit[t]||(this.colWidthsLimit[t]={})).max=e}getMinColWidth(t){var e;const i=this.colWidthsLimit[t];let r=(e=i&&i.min)!==null&&e!==void 0?e:0;return typeof r=="string"&&(r=sh(this,r)),r}setMinColWidth(t,e){(this.colWidthsLimit[t]||(this.colWidthsLimit[t]={})).min=e}getCellRect(t,e){var i,r;const o=this.isFrozenCell(t,e);let s;const a=this.getColWidth(t);let l;s=o&&o.col&&this.isRightFrozenColumn(t,e)?this.getAllColsWidth()<=this.tableNoFrameWidth?this.getColsWidth(0,t-1)||0:this.tableNoFrameWidth-((i=this.getColsWidth(t,this.colCount-1))!==null&&i!==void 0?i:0):this.getColsWidth(0,t-1)||0;const h=this.getRowHeight(e);return l=o&&o.row&&this.isBottomFrozenRow(t,e)?this.getAllRowsHeight()<=this.tableNoFrameHeight?this.getRowsHeight(0,e-1):this.tableNoFrameHeight-((r=this.getRowsHeight(e,this.rowCount-1))!==null&&r!==void 0?r:0):this.getRowsHeight(0,e-1),new To(Math.round(s),Math.round(l),Math.round(a),Math.round(h))}getMergeCellRect(t,e){const i=this.getCellRange(t,e),r=this.getColsWidth(0,i.start.col-1)||0,o=this.getColsWidth(i.start.col,i.end.col),s=this.getRowsHeight(0,i.start.row-1)||0,a=this.getRowsHeight(i.start.row,i.end.row);return new To(Math.round(r),Math.round(s),Math.round(o),Math.round(a))}getCellRelativeRect(t,e){const i=this.isFrozenCell(t,e);let r=!0,o=!0;i?.col&&i?.row?(r=!1,o=!1):i?.col?r=!1:i?.row&&(o=!1);const s=this.getCellRect(t,e);return this._toRelativeRect(s,r,o)}getCellRangeRelativeRect(t){if(t.start){const s=this.isFrozenCell(t.start.col,t.start.row);let a=!0,l=!0;return s?.col&&s?.row?(a=!1,l=!1):s?.col?a=!1:s?.row&&(l=!1),this._toRelativeRect(this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row),a,l)}const e=this.getCellRange(t.col,t.row),i=this.isFrozenCell(t.col,t.row);let r=!0,o=!0;return i?.col&&i?.row?(r=!1,o=!1):i?.col?r=!1:i?.row&&(o=!1),this._toRelativeRect(this.getCellsRect(e.start.col,e.start.row,e.end.col,e.end.row),r,o)}getVisibleCellRangeRelativeRect(t){let e;return e=t.start?t:this.getCellRange(t.col,t.row),this._getVisiableRect(this.getCellRangeRelativeRect(t),e)}_getVisiableRect(t,e){const i=e.start.col>=this.frozenColCount?Math.max(t.left,this.frozenColCount>=1?this.getColsWidth(0,this.frozenColCount-1):0):t.left,r=Math.min(t.right,this.tableNoFrameWidth),o=t.copy();o.left=i,o.right=r;const s=e.start.row>=this.frozenRowCount?Math.max(t.top,this.frozenRowCount>=1?this.getRowsHeight(0,this.frozenRowCount-1):0):t.top,a=Math.min(t.bottom,this.tableNoFrameHeight);return o.top=s,o.bottom=a,o}getCellsRect(t,e,i,r){var o,s,a,l,h,u;let d=this.getColsWidth(0,t-1)||0,c=this.getColsWidth(t,i);const g=this.scrollLeft,f=Math.min(this.tableNoFrameWidth,this.getAllColsWidth()),p=Math.min(this.tableNoFrameHeight,this.getAllRowsHeight());this.isLeftFrozenColumn(t)&&this.isRightFrozenColumn(i)?c=this.tableNoFrameWidth-((o=this.getColsWidth(t+1,this.colCount-1))!==null&&o!==void 0?o:0)-d:this.isLeftFrozenColumn(t)&&!this.isLeftFrozenColumn(i)?c=Math.max(c-g,this.getColsWidth(t,this.frozenColCount-1)):!this.isRightFrozenColumn(t)&&this.isRightFrozenColumn(i)?(d=Math.min(d-g,f-this.getRightFrozenColsWidth()),c=f-((s=this.getColsWidth(t+1,this.colCount-1))!==null&&s!==void 0?s:0)-d):this.isRightFrozenColumn(t)&&(d=f-((a=this.getColsWidth(t,this.colCount-1))!==null&&a!==void 0?a:0));let m=this.getRowsHeight(0,e-1),v=this.getRowsHeight(e,r);const b=this.scrollTop;return this.isTopFrozenRow(e)&&this.isBottomFrozenRow(r)?v=this.tableNoFrameHeight-((l=this.getRowsHeight(e+1,this.rowCount-1))!==null&&l!==void 0?l:0)-m:this.isTopFrozenRow(e)&&!this.isTopFrozenRow(r)?v=Math.max(v-b,this.getRowsHeight(e,this.frozenRowCount-1)):!this.isBottomFrozenRow(e)&&this.isBottomFrozenRow(r)?(m=Math.min(m-b,p-this.getBottomFrozenRowsHeight()),v=p-((h=this.getRowsHeight(e+1,this.rowCount-1))!==null&&h!==void 0?h:0)-m):this.isBottomFrozenRow(e)&&(m=p-((u=this.getRowsHeight(e,this.rowCount-1))!==null&&u!==void 0?u:0)),new To(Math.round(d),Math.round(m),Math.round(c),Math.round(v))}getCellsRectWidth(t,e,i,r){const o=this.isFrozenCell(t,e),s=this.isFrozenCell(i,r);let a=this.getColsWidth(t,i);if(o&&o.col){const l=this.scrollLeft;s&&s.col||(a-=l,a=Math.max(a,this.getColsWidth(t,this.frozenColCount-1)))}return a}getCellRangeRect(t){if(t.start)return this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row);const e=this.getCellRange(t.col,t.row);return this.getCellsRect(e.start.col,e.start.row,e.end.col,e.end.row)}getCellRangeRectWidth(t){if(t.start)return this.getCellsRectWidth(t.start.col,t.start.row,t.end.col,t.end.row);const e=this.getCellRange(t.col,t.row);return this.getCellsRectWidth(e.start.col,e.start.row,e.end.col,e.end.row)}isFrozenCell(t,e){const i=this.isFrozenRow(e),r=this.isFrozenColumn(t);return i||r?{row:i,col:r}:null}getRowAt(t){return MF(t,this)}getColAt(t){return TF(t,this)}getCellAt(t,e){return odt(t,e,this)}getCellAtRelativePosition(t,e){return ldt(t,e,this)}_checkRowCol(t,e){return t>=0&&t<this.colCount&&e>=0&&e<this.rowCount}_makeVisibleCell(t,e){if(this._checkRowCol(t,e)){const i=this.isFrozenCell(t,e);if(i&&i.col&&i.row)return;const r=this.getCellRect(t,e),o=jst(this);if(o.contains(r))return;i&&i.col||this.getColsWidth(0,this.frozenColCount-1)+r.width>this.canvas.width||(r.left<o.left?this.scrollLeft-=o.left-r.left:o.right<r.right&&(this.scrollLeft-=o.right-r.right)),i&&i.row||this.getRowsHeight(0,this.frozenRowCount-1)+r.height>this.canvas.height||(r.top<o.top?this.scrollTop-=o.top-r.top:o.bottom<r.bottom&&(this.scrollTop-=o.bottom-r.bottom))}}render(){this.scenegraph.renderSceneGraph()}renderAsync(){return this.scenegraph.updateNextFrame(),new Promise(((t,e)=>{setTimeout((()=>{t()}),0)}))}_toRelativeRect(t,e=!0,i=!0){var r,o,s,a;const l=t.copy(),h=this.getVisibleRect();return l.offsetLeft(this.tableX-(e?h.left:0)),l.offsetTop(this.tableY-(i?h.top:0)),l.offsetLeft((o=(r=this.options.viewBox)===null||r===void 0?void 0:r.x1)!==null&&o!==void 0?o:0),l.offsetTop((a=(s=this.options.viewBox)===null||s===void 0?void 0:s.y1)!==null&&a!==void 0?a:0),l}getVisibleRect(){const{scrollTop:t,scrollLeft:e}=this,i=this.tableNoFrameWidth,r=this.tableNoFrameHeight;return new To(e,t,i,r)}get visibleRowCount(){const{frozenRowCount:t}=this,e=this.getVisibleRect(),i=t>0?e.top+this.getRowsHeight(0,t-1):e.top,r=this.getTargetRowAt(i);if(!r)return 0;const o=Math.max(r.top>=i?r.row:r.row+1,t);let s=this.getRowsHeight(0,o-1),a=0;const{rowCount:l}=this;for(let h=o;h<l;h++){const u=s+this.getRowHeight(h);if(e.bottom<u)break;a++,s=u}return a}getBodyVisibleCellRange(){const{scrollTop:t,scrollLeft:e}=this,i=this.getFrozenRowsHeight(),r=this.getFrozenColsWidth(),o=this.getBottomFrozenRowsHeight(),s=this.getRightFrozenColsWidth(),{row:a}=this.getRowAt(t+i+1),{col:l}=this.getColAt(e+r+1),h=this.getAllRowsHeight()>this.tableNoFrameHeight?this.getRowAt(t+this.tableNoFrameHeight-1-o).row:this.rowCount-1,u=this.getAllColsWidth()>this.tableNoFrameWidth?this.getColAt(e+this.tableNoFrameWidth-1-s).col:this.colCount-1;return u<0||h<0?null:{rowStart:a,colStart:l,rowEnd:h,colEnd:u}}getBodyVisibleRowRange(){const{scrollTop:t}=this,e=this.getFrozenRowsHeight(),i=this.getBottomFrozenRowsHeight(),{row:r}=this.getRowAt(t+e+1),o=this.getAllRowsHeight()>this.tableNoFrameHeight?this.getRowAt(t+this.tableNoFrameHeight-1-i).row:this.rowCount-1;return o<0?null:{rowStart:r,rowEnd:o}}getBodyVisibleColRange(){const{scrollLeft:t}=this,e=this.getFrozenColsWidth(),i=this.getRightFrozenColsWidth(),{col:r}=this.getColAt(t+e+1),o=this.getAllColsWidth()>this.tableNoFrameWidth?this.getColAt(t+this.tableNoFrameWidth-1-i).col:this.colCount-1;return o<0?null:{colStart:r,colEnd:o}}get visibleColCount(){const{frozenColCount:t}=this,e=this.getVisibleRect(),i=t>0?e.left+this.getColsWidth(0,t-1):e.left,r=this.getTargetColAt(i);if(!r)return 0;const o=Math.max(r.left>=i?r.col:r.col+1,t);let s=this.getColsWidth(0,o-1),a=0;const{colCount:l}=this;for(let h=o;h<l;h++){const u=s+this.getColWidth(h);if(e.right<u)break;a++,s=u}return a}get scrollTop(){return this.stateManager.scroll.verticalBarPos}set scrollTop(t){this.stateManager.setScrollTop(t)}get scrollLeft(){return this.stateManager.scroll.horizontalBarPos}set scrollLeft(t){this.stateManager.setScrollLeft(t)}getScrollLeft(){return this.scrollLeft}getScrollTop(){return this.scrollTop}setScrollLeft(t){this.scrollLeft=Math.ceil(t)}setScrollTop(t){this.scrollTop=Math.ceil(t)}getCellOverflowText(t,e){return this.scenegraph.getCellOverflowText(t,e)}addReleaseObj(t){if(!t||!t.release||typeof t.release!="function")throw new Error("not releaseObj!");(this.internalProps.releaseList=this.internalProps.releaseList||[]).push(t)}dispose(){this.release()}release(){var t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v;const b=this.internalProps;if(this.isReleased)return;(e=(t=b.tooltipHandler)===null||t===void 0?void 0:t.release)===null||e===void 0||e.call(t),(r=(i=b.menuHandler)===null||i===void 0?void 0:i.release)===null||r===void 0||r.call(i),(o=super.release)===null||o===void 0||o.call(this),this.pluginManager.release(),(a=(s=b.handler)===null||s===void 0?void 0:s.release)===null||a===void 0||a.call(s),this.eventManager.release(),(h=(l=b.focusControl)===null||l===void 0?void 0:l.release)===null||h===void 0||h.call(l),(u=b.legends)===null||u===void 0||u.forEach((C=>{C?.release()})),(d=b.title)===null||d===void 0||d.release(),b.title=null,(c=b.emptyTip)===null||c===void 0||c.release(),b.emptyTip=null,b.layoutMap.release(),b.releaseList&&(b.releaseList.forEach((C=>{var w;return(w=C?.release)===null||w===void 0?void 0:w.call(C)})),b.releaseList=null),this.scenegraph.stage.release(),this.scenegraph.proxy.release(),b.focusControl.release();const y=(g=b.element)===null||g===void 0?void 0:g.parentElement;y&&!this.options.canvas&&y.removeChild(b.element),(m=(p=(f=this.editorManager)===null||f===void 0?void 0:f.editingEditor)===null||p===void 0?void 0:p.onEnd)===null||m===void 0||m.call(p),this.isReleased=!0,this.scenegraph=null,this.internalProps=null,(v=this.reactCustomLayout)===null||v===void 0||v.clearCache(),a1()}fireListeners(t,e){return super.fireListeners(t,e)}updateOption(t,e={clearColWidthCache:!0,clearRowHeightCache:!0}){var i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x,S,T,M,R;this.fireListeners(tt.BEFORE_UPDATE_OPTION,{options:t,container:this.container}),(i=this.editorManager)===null||i===void 0||i.cancelEdit(),this.options=t,this._hasAutoImageColumn=void 0;const{frozenColCount:E=0,unfreezeAllOnExceedsMaxWidth:P,defaultRowHeight:B=40,defaultHeaderRowHeight:k,defaultColWidth:L=80,defaultHeaderColWidth:O=80,keyboardOptions:I,eventOptions:H,rowSeriesNumber:D,enableCheckboxCascade:z,enableHeaderCheckboxCascade:G,columnResizeMode:U,rowResizeMode:j="none",resize:X,dragHeaderMode:Z,dragOrder:J,showFrozenIcon:q,allowFrozenColCount:st,padding:Q,hover:ot,menu:nt,select:F,pixelRatio:N,widthMode:W,heightMode:V,autoFillWidth:K,autoFillHeight:et,containerFit:it,widthAdaptiveMode:rt,heightAdaptiveMode:lt,customRender:ct,renderChartAsync:ut,renderChartAsyncBatchCount:gt,canvasWidth:Gt,canvasHeight:re,contentOffsetX:Fe=0,contentOffsetY:Qt=0,overscrollBehavior:Ii,limitMinWidth:hi,limitMinHeight:ri}=t,{groupConfig:Ht,groupBy:Ie,groupTitleFieldFormat:ye,groupTitleCustomLayout:oi,enableTreeStickCell:Sn}=t;N&&N!==this.internalProps.pixelRatio&&(this.internalProps.pixelRatio=N),Q&&(typeof Q=="number"?(this.padding.top=Q,this.padding.left=Q,this.padding.bottom=Q,this.padding.right=Q):(Q.top&&(this.padding.top=Q.top),Q.bottom&&(this.padding.bottom=Q.bottom),Q.left&&(this.padding.left=Q.left),Q.right&&(this.padding.right=Q.right))),this.showFrozenIcon=typeof q!="boolean"||q,typeof st=="number"&&st<=0&&(this.showFrozenIcon=!1),this.widthMode=W??"standard",this.heightMode=V??"standard",this._widthAdaptiveMode=rt??"only-body",this._heightAdaptiveMode=lt??"only-body",this.autoFillWidth=K!=null&&K,this.autoFillHeight=et!=null&&et,it!==void 0&&(this._containerFit=typeof it=="boolean"?{width:it,height:it}:it&&typeof it=="object"?{width:(r=it.width)===null||r===void 0||r,height:(o=it.height)===null||o===void 0||o}:{width:!1,height:!1}),this.customRender=ct,this.contentOffsetX=Fe??0,this.contentOffsetY=Qt??0,this.canvasWidth=dt(Gt)?Gt:void 0,this.canvasHeight=dt(re)?re:void 0;const Ct=this.internalProps;if(te.mode==="node"||t.canvas||Dst(Ct.element,this.padding),this.columnWidthComputeMode=(s=t.columnWidthComputeMode)!==null&&s!==void 0?s:"normal",Ct.frozenColCount=E,Ct.unfreezeAllOnExceedsMaxWidth=P==null||P,Ct.defaultRowHeight=B,Ct.defaultHeaderRowHeight=k??B,Ct.defaultColWidth=L,Ct.defaultHeaderColWidth=O??L,Ct.keyboardOptions=I,Ct.eventOptions=H,Ct.rowSeriesNumber=D,Ct.enableCheckboxCascade=(a=z??D?.enableTreeCheckbox)===null||a===void 0||a,Ct.enableHeaderCheckboxCascade=z||G==null||G,Ct.columnResizeMode=(l=X?.columnResizeMode)!==null&&l!==void 0?l:U,Ct.rowResizeMode=(h=X?.rowResizeMode)!==null&&h!==void 0?h:j,Ct.dragHeaderMode=(d=(u=J?.dragHeaderMode)!==null&&u!==void 0?u:Z)!==null&&d!==void 0?d:"none",Ct.renderChartAsync=ut,sk(gt),Ct.overscrollBehavior=Ii??"auto",Ct.cellTextOverflows={},Ct.groupBy=(c=Ht?.groupBy)!==null&&c!==void 0?c:Ie,Ct.groupTitleCheckbox=Ht?.titleCheckbox,Ct.groupTitleFieldFormat=(g=Ht?.titleFieldFormat)!==null&&g!==void 0?g:ye,Ct.groupTitleCustomLayout=(f=Ht?.titleCustomLayout)!==null&&f!==void 0?f:oi,Ct.enableTreeStickCell=(p=Ht?.enableTreeStickCell)!==null&&p!==void 0?p:Sn,e?.clearColWidthCache&&(Ct._widthResizedColMap.clear(),this.colWidthsMap=new na,this.colContentWidthsMap=new na,this.colWidthsLimit={}),e?.clearRowHeightCache&&(Ct._heightResizedRowMap.clear(),Ct._rowHeightsMap=new qk(this),Ct._rowRangeHeightsMap=new Map,Ct._colRangeWidthsMap=new Map),Ct.stick.changedCells.clear(),Ct.theme=zs.of((m=t.theme)!==null&&m!==void 0?m:zs.DEFAULT),Ct.theme.isPivot=this.isPivotTable(),xf(Ct.theme.functionalIconsStyle),this.scenegraph.updateStageBackground(),Ct.autoWrapText=t.autoWrapText,Ct.enableLineBreak=t.enableLineBreak,Ct.allowFrozenColCount=(v=t.allowFrozenColCount)!==null&&v!==void 0?v:0,Ct.limitMaxAutoWidth=(b=t.limitMaxAutoWidth)!==null&&b!==void 0?b:450,Ct.limitMinWidth=hi!=null?typeof hi=="number"?hi:hi?10:0:10,Ct.limitMinHeight=ri!=null?typeof ri=="number"?ri:ri?10:0:10,(y=Ct.legends)===null||y===void 0||y.forEach((Ve=>{Ve?.release()})),(C=Ct.title)===null||C===void 0||C.release(),Ct.title=null,(w=Ct.emptyTip)===null||w===void 0||w.release(),Ct.emptyTip=null,Ct.layoutMap.release(),a1(),this.scenegraph.clearCells(),this.scenegraph.updateComponent(),this.stateManager.updateOptionSetState(),this._updateSize(),this.eventManager.updateEventBinder(),t.legends){Ct.legends=[];const Ve=St.getFunction("createLegend");if(Array.isArray(t.legends)){for(let bt=0;bt<t.legends.length;bt++)Ct.legends.push(Ve(t.legends[bt],this));this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}else Ct.legends.push(Ve(t.legends,this)),this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}if(Ct.tooltip=Object.assign({parentElement:this.getElement(),renderMode:"html",isShowOverflowTextTooltip:!1,confine:!0,position:Zn.bottom},t.tooltip),Ct.tooltip.renderMode==="html"&&!Ct.tooltipHandler){const Ve=St.getComponent("tooltipHandler");Ct.tooltipHandler=new Ve(this,Ct.tooltip.confine)}if(Ct.menu=Object.assign({renderMode:"html"},t.menu),Array.isArray((_=t.menu)===null||_===void 0?void 0:_.dropDownMenuHighlight)&&this.setDropDownMenuHighlight((A=t.menu)===null||A===void 0?void 0:A.dropDownMenuHighlight),(Array.isArray((x=t.menu)===null||x===void 0?void 0:x.defaultHeaderMenuItems)||typeof((S=t.menu)===null||S===void 0?void 0:S.defaultHeaderMenuItems)=="function")&&(this.globalDropDownMenu=t.menu.defaultHeaderMenuItems),Ct.menu.renderMode==="html"&&!Ct.menuHandler){const Ve=St.getComponent("menuHandler");Ct.menuHandler=new Ve(this)}this.clearCellStyleCache(),e?.clearColWidthCache&&this.clearColWidthCache(),e?.clearRowHeightCache&&this.clearRowHeightCache(),Ct.customMergeCell=Mm(t.customMergeCell),(T=this.customCellStylePlugin)===null||T===void 0||T.updateCustomCell((M=t.customCellStyle)!==null&&M!==void 0?M:[],(R=t.customCellStyleArrangement)!==null&&R!==void 0?R:[]),this._adjustCanvasSizeByOption()}renderWithRecreateCells(){this.internalProps.stick.changedCells.clear();const t={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(t.col,t.row),this.render()}getFrozenRowsHeight(){return this.getRowsHeight(0,this.frozenRowCount-1)}getFrozenColsWidth(){return this.getColsWidth(0,this.frozenColCount-1)}getBottomFrozenRowsHeight(){if(this.bottomFrozenRowCount>0){let t=0;for(let e=this.rowCount-this.bottomFrozenRowCount;e<=this.rowCount-1;e++)t+=this.getRowHeight(e);return t}return 0}getRightFrozenColsWidth(){if(this.rightFrozenColCount>0){let t=0;for(let e=this.colCount-this.rightFrozenColCount;e<=this.colCount-1;e++)t+=this.getColWidth(e);return t}return 0}getDrawRange(){var t,e;const i=!((t=this.containerFit)===null||t===void 0)&&t.width?this.tableNoFrameWidth:Math.min(this.tableNoFrameWidth,this.getAllColsWidth()),r=!((e=this.containerFit)===null||e===void 0)&&e.height?this.tableNoFrameHeight:Math.min(this.tableNoFrameHeight,this.getAllRowsHeight());return new To(this.tableX,this.tableY,i,r)}_getMouseAbstractPoint(t){var e,i,r,o,s,a,l,h;let u;if(!t)return{inTable:!1,x:void 0,y:void 0};u=Sdt(t)?t.changedTouches[0]:t;const d=u.clientX||u.pageX+window.scrollX,c=u.clientY||u.pageY+window.scrollY,g=this.internalProps.canvas.getBoundingClientRect();let f=!0;g.right<=d&&(f=!1),g.bottom<=c&&(f=!1);const p=g.width,m=p/((this.rotateDegree===90?this.canvas.offsetHeight:this.canvas.offsetWidth)||p),v=g.height,b=v/((this.rotateDegree===90?this.canvas.offsetWidth:this.canvas.offsetHeight)||v),y=this.pluginManager.getPluginByName("Rotate Table");if(y&&this.rotateDegree===90){const w={x:d/m-((i=(e=this.options.viewBox)===null||e===void 0?void 0:e.x1)!==null&&i!==void 0?i:0),y:c/b-((o=(r=this.options.viewBox)===null||r===void 0?void 0:r.y1)!==null&&o!==void 0?o:0),inTable:f};return y.matrix.transformPoint(w,w),w}const C={x:(d-g.left)/m-((a=(s=this.options.viewBox)===null||s===void 0?void 0:s.x1)!==null&&a!==void 0?a:0),y:(c-g.top)/b-((h=(l=this.options.viewBox)===null||l===void 0?void 0:l.y1)!==null&&h!==void 0?h:0),inTable:f};return this.internalProps.modifiedViewBoxTransform&&this.scenegraph.stage.window.getViewBoxTransform()&&this.scenegraph.stage.window.getViewBoxTransform().transformPoint(C,C),C}getTheme(){return this.internalProps.theme}getTargetColAt(t){return lS(t,this)}getTargetRowAt(t){const e=hS(t,this);return e&&(e.row=Math.min(e.row,this.rowCount-1)),e}getTargetColAtConsiderRightFrozen(t,e){return RF(t,e,this)}getTargetRowAtConsiderBottomFrozen(t,e){return BF(t,e,this)}clearSelected(){this.stateManager.updateSelectPos(-1,-1)}selectCell(t,e,i,r,o,s=!1){var a,l,h;const u=!!(!((a=this.stateManager.select.ranges)===null||a===void 0)&&a.length);this.stateManager.updateSelectPos(t,e,i,r,!1,(h=o??((l=this.options.select)===null||l===void 0?void 0:l.makeSelectCellVisible))===null||h===void 0||h,s),this.stateManager.endSelectCells(!0,u)}selectCells(t){const{scrollLeft:e,scrollTop:i}=this;t.forEach(((r,o)=>{var s,a,l,h,u,d;const c=r.start.row,g=r.start.col,f=r.end.row,p=r.end.col;g===p&&c===f?this.stateManager.updateSelectPos(g,c,!1,o>=1,!1,(a=(s=this.options.select)===null||s===void 0?void 0:s.makeSelectCellVisible)===null||a===void 0||a,!0):(this.stateManager.updateSelectPos(g,c,!1,o>=1,!1,(h=(l=this.options.select)===null||l===void 0?void 0:l.makeSelectCellVisible)===null||h===void 0||h,!0),this.stateManager.updateInteractionState(Pt.grabing),this.stateManager.updateSelectPos(p,f,!1,o>=1,!1,(d=(u=this.options.select)===null||u===void 0?void 0:u.makeSelectCellVisible)===null||d===void 0||d,!0)),this.stateManager.endSelectCells(!1,!1),this.stateManager.updateInteractionState(Pt.default)})),this.setScrollTop(i),this.setScrollLeft(e)}selectRow(t,e,i){const r=this.stateManager.select.ranges;if(e)r.push({start:{col:0,row:t},end:{col:this.colCount-1,row:t}}),this.selectCells(r);else if(i){const o=r[r.length-1];o&&(o.end.row=t),this.selectCells(r)}else this.selectCells([{start:{col:0,row:t},end:{col:this.colCount-1,row:t}}])}selectCol(t,e,i){const r=this.stateManager.select.ranges;if(e)r.push({start:{col:t,row:0},end:{col:t,row:this.rowCount-1}}),this.selectCells(r);else if(i){const o=r[r.length-1];o&&(o.end.col=t),this.selectCells(r)}else this.selectCells([{start:{col:t,row:0},end:{col:t,row:this.rowCount-1}}])}startDragSelectCol(t,e,i){var r,o,s,a,l,h;const u=this.stateManager.select.ranges[this.stateManager.select.ranges.length-1],d=i&&(!((r=u?.start)===null||r===void 0)&&r.col)?(o=u?.start)===null||o===void 0?void 0:o.col:t,c=t,g=this.rowCount-1;this.stateManager.updateSelectPos(d,0,i,e,!1,(a=(s=this.options.select)===null||s===void 0?void 0:s.makeSelectCellVisible)===null||a===void 0||a,!0),this.stateManager.updateInteractionState(Pt.grabing),this.stateManager.updateSelectPos(c,g,i,e,!1,(h=(l=this.options.select)===null||l===void 0?void 0:l.makeSelectCellVisible)===null||h===void 0||h,!0)}dragSelectCol(t,e){var i,r;const o=this.stateManager.select.ranges,s=o[o.length-1];s&&(s.end.col=t),this.stateManager.updateSelectPos(t,this.rowCount-1,!1,e,!1,(r=(i=this.options.select)===null||i===void 0?void 0:i.makeSelectCellVisible)===null||r===void 0||r,!0)}endDragSelect(){this.stateManager.updateInteractionState(Pt.default),this.stateManager.endSelectCells(!1,!1)}startDragSelectRow(t,e,i){var r,o,s,a,l,h;const u=this.stateManager.select.ranges[this.stateManager.select.ranges.length-1],d=i&&(!((r=u?.start)===null||r===void 0)&&r.row)?(o=u?.start)===null||o===void 0?void 0:o.row:t,c=this.colCount-1,g=t;this.stateManager.updateSelectPos(0,d,i,e,!1,(a=(s=this.options.select)===null||s===void 0?void 0:s.makeSelectCellVisible)===null||a===void 0||a,!0),this.stateManager.updateInteractionState(Pt.grabing),this.stateManager.updateSelectPos(c,g,i,e,!1,(h=(l=this.options.select)===null||l===void 0?void 0:l.makeSelectCellVisible)===null||h===void 0||h,!0)}dragSelectRow(t,e){var i,r;const o=this.stateManager.select.ranges,s=o[o.length-1];s&&(s.end.row=t),this.stateManager.updateSelectPos(this.colCount-1,t,!1,e,!1,(r=(i=this.options.select)===null||i===void 0?void 0:i.makeSelectCellVisible)===null||r===void 0||r,!0)}get recordsCount(){var t;return(t=this.records)===null||t===void 0?void 0:t.length}get allowFrozenColCount(){return this.internalProps.allowFrozenColCount}get rowHeaderLevelCount(){return this.internalProps.layoutMap.rowHeaderLevelCount}get columnHeaderLevelCount(){return this.internalProps.layoutMap.columnHeaderLevelCount}get records(){return this.internalProps.records}get dataSource(){return this.internalProps.dataSource}set dataSource(t){this.scenegraph.clearCells(),Fst(this,t),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.render()}get autoWrapText(){return this.internalProps.autoWrapText}set autoWrapText(t){this.internalProps.autoWrapText=t,this.options.autoWrapText=t}get enableLineBreak(){return this.internalProps.enableLineBreak}set enableLineBreak(t){this.internalProps.enableLineBreak=t,this.options.enableLineBreak=t}updateAutoWrapText(t){this.internalProps.autoWrapText!==t&&(this.internalProps.autoWrapText=t,this.options.autoWrapText=t,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.render())}get theme(){return this.internalProps.theme}set theme(t){this.internalProps.theme=zs.of(t??zs.DEFAULT),this.internalProps.theme.isPivot=this.isPivotTable(),this.options.theme=t,xf(this.internalProps.theme.functionalIconsStyle)}updateTheme(t){const e={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.theme=zs.of(t??zs.DEFAULT),this.internalProps.theme.isPivot=this.isPivotTable(),xf(this.internalProps.theme.functionalIconsStyle),this.options.theme=t,this.scenegraph.updateComponent(),this.scenegraph.updateStageBackground(),this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(e.col,e.row),this.render()}getBodyField(t,e){return this.internalProps.layoutMap.getBody(t,e).field}getBodyColumnDefine(t,e){const i=this.internalProps.layoutMap.getBody(t,e);return i?.define}getBodyColumnType(t,e){var i,r;const o=(r=(i=this.internalProps.layoutMap.getBody(t,e))===null||i===void 0?void 0:i.cellType)!==null&&r!==void 0?r:"text";return ht("cellType",{cellType:o},t,e,this)}getCellType(t,e){let i;return this.isSeriesNumberInHeader(t,e)?this.internalProps.layoutMap.getSeriesNumberHeader(t,e).cellType:(i=this.isHeader(t,e)?this.internalProps.layoutMap.getHeader(t,e).headerType:this.internalProps.layoutMap.getBody(t,e).cellType,ht("cellType",{cellType:i},t,e,this))}getHeaderField(t,e){return this.internalProps.layoutMap.getHeaderField(t,e)}getHeaderDefine(t,e){const i=this.internalProps.layoutMap.getHeader(t,e);return i?.define}getCellLocation(t,e){return this.internalProps.layoutMap.getCellLocation(t,e)}getCellHeaderPaths(t,e){return this.internalProps.layoutMap.getCellHeaderPaths(t,e)}getHeadersDefine(t,e){const i=[];for(;;){const r=this.getHeaderDefine(t,e);if(!r||!r.field&&!r.columns)break;i.push(r),e++}return i}_getHeaderLayoutMap(t,e){return this.internalProps.layoutMap.getHeader(t,e)}_getBodyLayoutMap(t,e){return this.internalProps.layoutMap.getBody(t,e)}getContext(){return this.internalProps.context}getRecordByCell(t,e){if(!this.internalProps.layoutMap.isHeader(t,e))return this.getCellOriginRecord(t,e)}getRecordByRowCol(t,e){return this.getRecordByCell(t,e)}getRecordStartRowByRecordIndex(t){return this.internalProps.layoutMap.getRecordStartRowByRecordIndex(t)}_getHeaderCellBySortState(t){const{layoutMap:e}=this.internalProps,i=e.headerObjects.find((r=>r&&r.field===t.field));if(i)return e.getHeaderCellAdressById(i.id)}getCellRange(t,e){var i;if(this.internalProps.customMergeCell){const r=this.internalProps.customMergeCell(t,e,this);if(r&&r.range&&($(r.text)||r.customLayout||r.customRender))return{start:{col:Math.max(r.range.start.col,0),row:Math.max(r.range.start.row,0)},end:{col:Math.min(r.range.end.col,this.colCount-1),row:Math.min(r.range.end.row,this.rowCount-1)},isCustom:!0}}return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.getCellRange(t,e)}hasCustomMerge(){return!!this.internalProps.customMergeCell}getCustomMerge(t,e){if(this.internalProps.customMergeCell){const i=this.internalProps.customMergeCell(t,e,this);if(i&&i.range&&($(i.text)||i.customLayout||this.customRender)){if(i.style){const r=this.internalProps.bodyHelper.getStyleClass("text"),o=i.style,s=Xx(o,this.theme.bodyStyle,{col:t,row:e,table:this,value:i.text,dataValue:this.getCellOriginValue(t,e),cellHeaderPaths:this.getCellHeaderPaths(t,e)},r,this.options.autoWrapText,this.theme);i.style=s}return i.range={start:{col:Math.max(i.range.start.col,0),row:Math.max(i.range.start.row,0)},end:{col:Math.min(i.range.end.col,this.colCount-1),row:Math.min(i.range.end.row,this.rowCount-1)},isCustom:!0},i}}}isCellRangeEqual(t,e,i,r){return this.internalProps.layoutMap.isCellRangeEqual(t,e,i,r)}_getLayoutCellId(t,e){return this.internalProps.layoutMap.getCellId(t,e)}getHeaderDescription(t,e){var i;const r=this._getHeaderLayoutMap(t,e),o=r?.define,s=(i=o?.description)!==null&&i!==void 0?i:r?.description;return typeof s=="function"?s({col:t,row:e,value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e)}):s}setDropDownMenuHighlight(t){this.stateManager.setDropDownMenuHighlight(t)}_dropDownMenuIsHighlight(t,e,i){return this.stateManager.dropDownMenuIsHighlight(t,e,i)}isSeriesNumberInBody(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isSeriesNumberInBody(t,e)}isSeriesNumberInHeader(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isSeriesNumberInHeader(t,e)}isHeader(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isHeader(t,e)}isColumnHeader(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isColumnHeader(t,e)}isRowHeader(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isRowHeader(t,e)}isCornerHeader(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isCornerHeader(t,e)}isFrozenColumn(t,e){return this.isLeftFrozenColumn(t,e)||this.isRightFrozenColumn(t,e)}isLeftFrozenColumn(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isFrozenColumn(t,e)}isRightFrozenColumn(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isRightFrozenColumn(t,e)}isFrozenRow(t,e){return this.isTopFrozenRow(t,e)||this.isBottomFrozenRow(t,e)}isTopFrozenRow(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isFrozenRow(t,e)}isBottomFrozenRow(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isBottomFrozenRow(t,e)}getCellInfo(t,e){if(t>=0&&e>=0){const i=this.isHeader(t,e)?this.getHeaderDefine(t,e):this.getBodyColumnDefine(t,e);return{col:t,row:e,field:this.getHeaderField(t,e),cellHeaderPaths:this.internalProps.layoutMap.getCellHeaderPaths(t,e),title:i?.title,cellType:this.getCellType(t,e),originData:this.getCellOriginRecord(t,e),cellRange:this.getCellRangeRelativeRect({col:t,row:e}),value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e),cellLocation:this.getCellLocation(t,e),scaleRatio:this.canvas.getBoundingClientRect().width/this.canvas.offsetWidth}}}_hasField(t,e,i){var r;if(t===null||this.internalProps.layoutMap.isHeader(e,i))return!1;const o=this.getRecordShowIndexByCell(e,i);return(r=this.internalProps.dataSource)===null||r===void 0?void 0:r.hasField(o,t)}_getCellStyle(t,e){return Cdt(t,e,this)}clearCellStyleCache(){this.headerStyleCache.clear(),this.bodyStyleCache.clear(),this.bodyMergeTitleCache.clear(),this.bodyBottomStyleCache.clear()}clearRowHeightCache(){this.internalProps._rowHeightsMap.clear(),this._clearRowRangeHeightsMap()}clearColWidthCache(){this.internalProps._colWidthsMap.clear(),this._clearColRangeWidthsMap()}_canResizeColumn(t,e){if(!(t>=0&&e>=0)||this.isCellRangeEqual(t,e,t+1,e)||this.internalProps.columnResizeMode==="none")return!1;if(this.internalProps.columnResizeMode==="header"){if(!this.isHeader(t,e))return!1}else if(this.internalProps.columnResizeMode==="body"&&this.isHeader(t,e))return!1;const i=this.colWidthsLimit[t];return!(i&&i.min&&i.max)||i.max!==i.min}_canResizeRow(t,e){if(!(t>=0&&e>=0)||this.isCellRangeEqual(t,e,t,e+1)||this.internalProps.rowResizeMode==="none")return!1;if(this.internalProps.rowResizeMode==="header"){if(!this.isHeader(t,e))return!1}else if(this.internalProps.rowResizeMode==="body"&&this.isHeader(t,e))return!1;return!0}_canDragHeaderPosition(t,e){var i;if(this.isHeader(t,e)&&(this.stateManager.isSelected(t,e)||((i=this.options.select)===null||i===void 0?void 0:i.headerSelectMode)==="body"&&bht(t,e,[this.getCellRange(this.stateManager.select.cellPos.col,this.stateManager.select.cellPos.row)])||ra(this,t,e))){if(this.internalProps.frozenColDragHeaderMode==="disabled"&&this.isFrozenColumn(t))return!1;if(this.stateManager.isSelected(t,e)){const o=this.stateManager.select.ranges[0];if(this.isColumnHeader(t,e)){if(o.end.row!==this.rowCount-1)return!1}else if(!this.isRowHeader(t,e)||o.end.col!==this.colCount-1)return!1}const r=this.getHeaderDefine(t,e);if(!r)return!1;if(r.dragHeader===void 0){if(this.internalProps.dragHeaderMode==="all")return!0;if(this.internalProps.dragHeaderMode==="column"){if(this.isColumnHeader(t,e))return!0}else if(this.internalProps.dragHeaderMode==="row"&&this.isRowHeader(t,e))return!0;return!1}return r.dragHeader}return!1}getCellIcons(t,e){var i,r,o;let s;if(this.isHeader(t,e))s=this.internalProps.headerHelper.getIcons(t,e);else if(this.internalProps.layoutMap.isSeriesNumber(t,e)){(!this.internalProps.groupBy||!(!((i=this.getCellRawRecord(t,e))===null||i===void 0)&&i.vtableMerge))&&!((o=(r=this.internalProps.layoutMap.getSeriesNumberBody(t,e))===null||r===void 0?void 0:r.define)===null||o===void 0)&&o.dragOrder&&(s=this.internalProps.rowSeriesNumberHelper.getIcons(t,e));const a=this.getCellValue(t,e),l=this.getCellOriginValue(t,e),h=this.internalProps.context,u=this.internalProps.bodyHelper.getIcons(t,e,a,l,h);s?.length>0?s=s.concat(u):u?.length>0&&(s=u)}else{const a=this.getCellValue(t,e),l=this.getCellOriginValue(t,e),h=this.internalProps.context;s=this.internalProps.bodyHelper.getIcons(t,e,a,l,h)}return s}showDropDownMenu(t,e,i){let r="dropdown-menu";i&&(r=Array.isArray(i.content)?"dropdown-menu":"container"),this.internalProps.menu.renderMode==="html"&&(this.stateManager.menu.isShow=!0,this.internalProps.menuHandler._bindToCell(t,e,r,i))}showTooltip(t,e,i){this.internalProps.tooltip.renderMode==="html"&&this.internalProps.tooltipHandler._bindToCell(t,e,i)}getCellStyle(t,e){const i=this._getCellStyle(t,e),r=Ba(i,this,t,e,ht).theme,{autoWrapText:o,lineClamp:s,textOverflow:a}=i;return{textAlign:r.text.textAlign,textBaseline:r.text.textBaseline,bgColor:ko(r.group.fill)?ht("bgColor",i,t,e,this):r.group.fill,color:ko(r.text.fill)?ht("color",i,t,e,this):r.text.fill,strokeColor:ko(r.text.stroke)?ht("strokeColor",i,t,e,this):r.text.stroke,fontFamily:r.text.fontFamily,fontSize:r.text.fontSize,fontWeight:r.text.fontWeight,fontVariant:r.text.fontVariant,fontStyle:r.text.fontStyle,lineHeight:r.text.lineHeight,autoWrapText:o!=null&&o,lineClamp:s??"auto",textOverflow:a,borderColor:ko(r.group.stroke)?ht("borderColor",i,t,e,this):r.group.stroke,borderLineWidth:r.group.lineWidth,borderLineDash:r.group.lineDash,underline:!!r.text.underline,underlineDash:r.text.underlineDash,underlineOffset:r.text.underlineOffset,lineThrough:!!r.text.lineThrough,padding:r._vtable.padding,underlineWidth:r.text.underline,lineThroughLineWidth:r.text.lineThrough,_strokeArrayWidth:r.group.strokeArrayWidth,_strokeArrayColor:r.group.strokeArrayColor,_linkColor:ht("linkColor",i,t,e,this)}}getAllBodyCells(t,e){const i=this.rowHeaderLevelCount,r=this.columnHeaderLevelCount,o=this.colCount-1,s=this.rowCount-1;return Array(Math.min(e??2e3,s-r+1,this.rowCount)).fill(0).map(((a,l)=>Array(Math.min(t??2e3,o-i+1,this.colCount)).fill(0).map(((h,u)=>this.getCellInfo(u+i,l+r)))))}getAllCells(t,e){const o=this.colCount-1,s=this.rowCount-1;return Array(Math.min(e??2e3,s-0+1,this.rowCount)).fill(0).map(((a,l)=>Array(Math.min(t??2e3,o-0+1,this.colCount)).fill(0).map(((h,u)=>this.getCellInfo(u+0,l+0)))))}getAllColumnHeaderCells(){const t=this.rowHeaderLevelCount,e=0,i=this.colCount-1,r=this.columnHeaderLevelCount-1;return Array(r-e+1).fill(0).map(((o,s)=>Array(i-t+1).fill(0).map(((a,l)=>this.getCellInfo(l+t,s+e)))))}getAllRowHeaderCells(){const e=this.columnHeaderLevelCount,i=this.rowHeaderLevelCount-1,r=this.rowCount-1;return Array(r-e+1).fill(0).map(((o,s)=>Array(i-0+1).fill(0).map(((a,l)=>this.getCellInfo(l+0,s+e)))))}getCopyValue(){var t,e,i;if(((e=(t=this.stateManager.select)===null||t===void 0?void 0:t.ranges)===null||e===void 0?void 0:e.length)>0){const r=this.stateManager.select.ranges;let o=Math.min(r[0].start.col,r[0].end.col),s=Math.max(r[0].start.col,r[0].end.col),a=Math.min(r[0].start.row,r[0].end.row),l=Math.max(r[0].start.row,r[0].end.row);r.forEach((f=>{o=Math.min(o,f.start.col,f.end.col),s=Math.max(s,f.start.col,f.end.col),a=Math.min(a,f.start.row,f.end.row),l=Math.max(l,f.start.row,f.end.row)}));const h=f=>{let p=!1;return r.forEach((m=>{const v=Math.min(m.start.row,m.end.row),b=Math.max(m.start.row,m.end.row);v<=f&&b>=f&&(p=!0)})),p},u=f=>{let p=!1;return r.forEach((m=>{const v=Math.min(m.start.col,m.end.col),b=Math.max(m.start.col,m.end.col);v<=f&&b>=f&&(p=!0)})),p},d=(f,p)=>{let m;return r.forEach((v=>{const b=Math.min(v.start.row,v.end.row),y=Math.max(v.start.row,v.end.row),C=Math.min(v.start.col,v.end.col),w=Math.max(v.start.col,v.end.col);C<=f&&w>=f&&b<=p&&y>=p&&(m=v)})),m},c=(f,p,m)=>{const v=this.getCellRange(f,p);let b=v.start.col,y=v.start.row;if(m){const C=Math.min(m.start.col,m.end.col),w=Math.min(m.start.row,m.end.row);b=Math.max(C,v.start.col),y=Math.max(w,v.start.row)}return b!==f||y!==p?"":this.getCellValue(f,p)};let g="";for(let f=a;f<=l;f++)if(h(f)){for(let p=o;p<=s;p++)if(u(p)){const m=d(p,f);if(m){const v=c(p,f,m);if(!(typeof Promise<"u"&&v instanceof Promise)){const b=$(v)?`${v}`:"";/^\[object .*\]$/.exec(b)||(g+=b)}(p<m.end.col||p<s)&&(g+="	")}else g+="	"}f<l&&(g+=`\r
`)}return!((i=this.options)===null||i===void 0)&&i.formatCopyValue&&(g=this.options.formatCopyValue(g)),g}return""}getSelectedCellInfos(){var t;if(!(!((t=this.stateManager.select)===null||t===void 0)&&t.ranges))return null;const e=this.stateManager.select.ranges;if(!e.length)return[];let i=Math.min(e[0].start.col,e[0].end.col),r=Math.max(e[0].start.col,e[0].end.col),o=Math.min(e[0].start.row,e[0].end.row),s=Math.max(e[0].start.row,e[0].end.row);e.forEach((d=>{i=Math.min(i,d.start.col,d.end.col),r=Math.max(r,d.start.col,d.end.col),o=Math.min(o,d.start.row,d.end.row),s=Math.max(s,d.start.row,d.end.row)}));const a=d=>{let c=!1;return e.forEach((g=>{const f=Math.min(g.start.row,g.end.row),p=Math.max(g.start.row,g.end.row);f<=d&&p>=d&&(c=!0)})),c},l=d=>{let c=!1;return e.forEach((g=>{const f=Math.min(g.start.col,g.end.col),p=Math.max(g.start.col,g.end.col);f<=d&&p>=d&&(c=!0)})),c},h=(d,c)=>{let g;return e.forEach((f=>{const p=Math.min(f.start.row,f.end.row),m=Math.max(f.start.row,f.end.row),v=Math.min(f.start.col,f.end.col),b=Math.max(f.start.col,f.end.col);v<=d&&b>=d&&p<=c&&m>=c&&(g=f)})),g},u=[];for(let d=o;d<=s;d++)if(a(d)){const c=[];for(let g=i;g<=r;g++)if(l(g)&&h(g,d)){const f=this.getCellInfo(g,d);c.push(f)}u.push(c)}return u}getSelectedCellRanges(){const t=this.stateManager.select.ranges;return t.length?Ul(t):[]}measureText(t,e){return nS.measureText(t,e)}measureTextBounds(t){return QD(t)}getCustomRender(t,e){let i;if(this.getCellLocation(t,e)!=="body"){const r=this.getHeaderDefine(t,e);i=r?.headerCustomRender}else{const r=this.getBodyColumnDefine(t,e);i=r?.customRender||this.customRender}return i}getCustomLayout(t,e){let i;if(this.getCellLocation(t,e)!=="body"){const r=this.getHeaderDefine(t,e);i=r?.headerCustomLayout}else{const r=this.getBodyColumnDefine(t,e);i=r?.customLayout}return i}hasAutoImageColumn(){return this._hasAutoImageColumn===void 0&&(this._hasAutoImageColumn=rdt(this)),this._hasAutoImageColumn}_getActiveChartInstance(){var t,e,i,r,o,s;const a=this.scenegraph.getCell((e=(t=this.stateManager.hover)===null||t===void 0?void 0:t.cellPos)===null||e===void 0?void 0:e.col,(r=(i=this.stateManager.hover)===null||i===void 0?void 0:i.cellPos)===null||r===void 0?void 0:r.row);return((s=(o=a?.getChildren())===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.type)==="chart"?a.getChildren()[0].activeChartInstance:null}cellIsInVisualView(t,e){var i,r,o,s;const a=this.getDrawRange(),l=this.getCellRelativeRect(t,e);if(t<this.frozenColCount&&e<this.frozenRowCount)return!0;let h,u,d,c;return this.frozenRowCount>=1&&(h=this.getCellRangeRelativeRect({start:{col:0,row:0},end:{col:this.colCount-1,row:this.frozenRowCount-1}})),this.frozenColCount>=1&&(u=this.getCellRangeRelativeRect({start:{col:0,row:0},end:{col:this.frozenColCount-1,row:this.rowCount-1}})),this.bottomFrozenRowCount>=1&&(d=this.getCellRangeRelativeRect({start:{col:0,row:this.rowCount-this.bottomFrozenRowCount},end:{col:this.colCount-1,row:this.rowCount-1}})),this.rightFrozenColCount>=1&&(c=this.getCellRangeRelativeRect({start:{col:this.colCount-this.rightFrozenColCount,row:0},end:{col:this.colCount-1,row:this.rowCount-1}})),!!(l.top>=a.top&&l.bottom<=a.bottom&&l.left>=a.left&&l.right<=a.right&&(this.isFrozenCell(t,e)||l.top>=((i=h?.bottom)!==null&&i!==void 0?i:l.top)&&l.left>=((r=u?.right)!==null&&r!==void 0?r:l.left)&&l.bottom<=((o=d?.top)!==null&&o!==void 0?o:l.bottom)&&l.right<=((s=c?.left)!==null&&s!==void 0?s:l.right)))}getCustomMergeValue(t,e){if(this.internalProps.customMergeCell){const i=this.getCustomMerge(t,e);if(i){const{text:r}=i;return r}}}exportImg(){return this.scenegraph.stage.toCanvas().toDataURL()}exportCellImg(t,e,i){var r,o,s,a;const l=this.cellIsInVisualView(t,e),{scrollTop:h,scrollLeft:u}=this;l||this.scrollToCell({col:t,row:e});const d=this.getCellRelativeRect(t,e);((o=(r=this.stateManager.select)===null||r===void 0?void 0:r.ranges)===null||o===void 0?void 0:o.length)>0&&Ck(this.scenegraph);const{col:c,row:g}=this.stateManager.hover.cellPos;let f,p;if(this.stateManager.updateHoverPos(-1,-1),this.scenegraph.component.hideVerticalScrollBar(),this.scenegraph.component.hideHorizontalScrollBar(),this.scenegraph.tableGroup.border.setAttribute("visible",!1),i?.disableBackground){const b=this.scenegraph.getCell(t,e);f=b.attribute.fill,b.setAttribute("fill","transparent")}if(i?.disableBorder){const b=this.scenegraph.getCell(t,e);p=b.attribute.stroke,b.setAttribute("stroke",!1)}this.scenegraph.renderSceneGraph();let m=0;this.theme.cellBorderClipDirection==="bottom-right"&&(m=1);const v=this.scenegraph.stage.toCanvas(!1,new $d().set(d.left+this.tableX+1,d.top+this.tableY+1,d.right+this.tableX-m,d.bottom+this.tableY-m));return l||(this.setScrollTop(h),this.setScrollLeft(u)),this.scenegraph.tableGroup.border.setAttribute("visible",!0),f&&this.scenegraph.getCell(t,e).setAttribute("fill",f),p&&this.scenegraph.getCell(t,e).setAttribute("stroke",p),((a=(s=this.stateManager.select)===null||s===void 0?void 0:s.ranges)===null||a===void 0?void 0:a.length)>0&&_k(this.scenegraph),this.stateManager.updateHoverPos(c,g),this.scenegraph.updateNextFrame(),v.toDataURL()}exportCellRangeImg(t){var e,i,r,o;const{scrollTop:s,scrollLeft:a}=this,l=Math.min(t.start.col,t.end.col),h=Math.min(t.start.row,t.end.row),u=Math.max(t.start.col,t.end.col),d=Math.max(t.start.row,t.end.row),c=this.cellIsInVisualView(l,h),g=this.cellIsInVisualView(u,d);c&&g||this.scrollToCell({col:l,row:h});const f=this.getCellRangeRelativeRect({start:{col:l,row:h},end:{col:u,row:d}});((i=(e=this.stateManager.select)===null||e===void 0?void 0:e.ranges)===null||i===void 0?void 0:i.length)>0&&Ck(this.scenegraph);const{col:p,row:m}=this.stateManager.hover.cellPos;this.stateManager.updateHoverPos(-1,-1),this.scenegraph.component.hideVerticalScrollBar(),this.scenegraph.component.hideHorizontalScrollBar(),this.scenegraph.renderSceneGraph();const v=this.scenegraph.stage.toCanvas(!1,new $d().set(f.left+this.tableX+1,f.top+this.tableY+1,f.right+this.tableX,f.bottom+this.tableY)).toDataURL();return c&&g||(this.setScrollTop(s),this.setScrollLeft(a)),((o=(r=this.stateManager.select)===null||r===void 0?void 0:r.ranges)===null||o===void 0?void 0:o.length)>0&&_k(this.scenegraph),this.stateManager.updateHoverPos(p,m),v}exportCanvas(){return this.scenegraph.stage.toCanvas()}getImageBuffer(t="image/png"){if(this.options.mode!=="node")return;this.render();const e=this.scenegraph.stage;if(e){let i=this.tableX+this.getAllColsWidth(),r=this.tableY+this.getAllRowsHeight();return this.internalProps.legends&&this.internalProps.legends.forEach((o=>{o.orient==="right"?i=Math.max(i,o.legendComponent.globalAABBBounds.x2):o.orient==="bottom"&&(r=Math.max(r,o.legendComponent.globalAABBBounds.y2))})),this.internalProps.title&&(this.internalProps.title._titleOption.orient==="right"?i=Math.max(i,this.internalProps.title.getComponentGraphic().globalAABBBounds.x2):this.internalProps.title._titleOption.orient==="bottom"&&(r=Math.max(r,this.internalProps.title.getComponentGraphic().globalAABBBounds.y2))),i>=this.canvasWidth&&r>=this.canvasHeight?(e.render(),e.window.getImageBuffer(t)):this.scenegraph.stage.toCanvas(!1,new $d().set(0,0,Math.min(this.canvasWidth,i),Math.min(this.canvasHeight,r))).toBuffer(t)}return null}getBodyIndexByTableIndex(t,e){return{col:t-this.rowHeaderLevelCount-this.leftRowSeriesNumberCount,row:e-this.columnHeaderLevelCount}}getTableIndexByBodyIndex(t,e){return{col:t+this.rowHeaderLevelCount+this.leftRowSeriesNumberCount,row:e+this.columnHeaderLevelCount}}onVChartEvent(t,e,i){this._chartEventMap[t]||(this._chartEventMap[t]=[]),typeof e=="function"?this._chartEventMap[t].push({callback:e}):this._chartEventMap[t].push({callback:i,query:e})}offVChartEvent(t,e){this._chartEventMap[t]&&(this._chartEventMap[t]=e?this._chartEventMap[t].filter((i=>i.callback!==e)):[])}_bindChartEvent(t){if(t)for(const e in this._chartEventMap)(this._chartEventMap[e]||[]).forEach((i=>{i.query?t.on(e,i.query,i.callback):t.on(e,i.callback)}))}changeRecordOrder(t,e){}hasCustomCellStyle(t){var e;return(e=this.customCellStylePlugin)===null||e===void 0?void 0:e.hasCustomCellStyle(t)}registerCustomCellStyle(t,e){var i;(i=this.customCellStylePlugin)===null||i===void 0||i.registerCustomCellStyle(t,e)}arrangeCustomCellStyle(t,e,i){var r;(r=this.customCellStylePlugin)===null||r===void 0||r.arrangeCustomCellStyle(t,e,i)}isSeriesNumber(t,e){return this.internalProps.layoutMap.isSeriesNumber(t,e)}isHasSeriesNumber(){var t;return((t=this.internalProps.layoutMap)===null||t===void 0?void 0:t.leftRowSeriesNumberColumnCount)>0}get leftRowSeriesNumberCount(){var t,e;return(e=(t=this.internalProps.layoutMap)===null||t===void 0?void 0:t.leftRowSeriesNumberColumnCount)!==null&&e!==void 0?e:0}setMinMaxLimitWidth(t=!1){var e,i;const r=this.internalProps;for(let o=0;o<r.layoutMap.columnWidths.length;o++){if(this.internalProps._widthResizedColMap.has(o))continue;const{width:s,minWidth:a,maxWidth:l}=(i=(e=r.layoutMap.columnWidths)===null||e===void 0?void 0:e[o])!==null&&i!==void 0?i:{};t&&s&&(typeof s=="string"&&s!=="auto"||typeof s=="number"&&s>0)&&this._setColWidth(o,s),a&&(typeof a=="number"&&a>0||typeof a=="string")&&this.setMinColWidth(o,a),l&&(typeof l=="number"&&l>0||typeof l=="string")&&this.setMaxColWidth(o,l)}}setSortedIndexMap(t,e){var i;(i=this.dataSource)===null||i===void 0||i.setSortedIndexMap(t,e)}checkReactCustomLayout(){this.reactCustomLayout||(this.reactCustomLayout=new Ust(this))}get bodyDomContainer(){return this.internalProps.bodyDomContainer}get headerDomContainer(){return this.internalProps.headerDomContainer}get frozenBodyDomContainer(){return this.internalProps.frozenBodyDomContainer}get frozenHeaderDomContainer(){return this.internalProps.frozenHeaderDomContainer}get rightFrozenBodyDomContainer(){return this.internalProps.rightFrozenBodyDomContainer}get rightFrozenHeaderDomContainer(){return this.internalProps.rightFrozenHeaderDomContainer}get frozenBottomDomContainer(){return this.internalProps.frozenBottomDomContainer}get bottomDomContainer(){return this.internalProps.bottomDomContainer}get rightFrozenBottomDomContainer(){return this.internalProps.rightFrozenBottomDomContainer}showMoverLine(t,e){this.scenegraph.component.showMoveCol(t,e,0),this.scenegraph.renderSceneGraph()}hideMoverLine(t,e){this.scenegraph.component.hideMoveCol(),this.scenegraph.renderSceneGraph()}disableScroll(){this.eventManager.disableScroll()}enableScroll(){this.eventManager.enableScroll()}getGroupTitleLevel(t,e){}scrollToRow(t,e){e?this.animationManager.scrollTo({row:t},e):this.scrollToCell({row:t})}scrollToCol(t,e){e?this.animationManager.scrollTo({col:t},e):this.scrollToCell({col:t})}scrollToCell(t,e){if(e)return void this.animationManager.scrollTo(t,e);const i=this.getDrawRange();if($(t.col)&&t.col>=this.frozenColCount){const r=this.getFrozenColsWidth(),o=this.getColsWidth(0,t.col-1);this.scrollLeft=Math.min(o-r,this.getAllColsWidth()-i.width)}if($(t.row)&&t.row>=this.frozenRowCount){const r=this.getFrozenRowsHeight(),o=this.getRowsHeight(0,t.row-1);this.scrollTop=Math.min(o-r,this.getAllRowsHeight()-i.height)}this.render()}checkHasColumnAutoWidth(){return Vst(this)}get containerFit(){return this._containerFit}set containerFit(t){var e,i;this._containerFit=typeof t=="boolean"?{width:t,height:t}:t&&typeof t=="object"?{width:(e=t.width)===null||e===void 0||e,height:(i=t.height)===null||i===void 0||i}:{width:!1,height:!1}}}const Tdt={},Rdt={};function Bdt(){return vg(Rdt,Tdt)}const oP={};function kdt(n){if(oP[n])return oP[n]}const yg=(n,t)=>Object.prototype.toString.call(n)===`[object ${t}]`,Pdt=(n,t=!1)=>t?typeof n=="boolean":n===!0||n===!1||yg(n,"Boolean"),Edt=n=>n!=null,Ldt=(n,t=!1)=>{const e=typeof n;return t?e==="string":e==="string"||yg(n,"String")},Odt=n=>Array.isArray?Array.isArray(n):yg(n,"Array"),Idt=n=>yg(n,"Date"),Hdt=(n,t=!1)=>{const e=typeof n;return t?e==="number":e==="number"||yg(n,"Number")};function Ddt(n){try{return n instanceof Element}catch{const e=["children","innerHTML","classList","setAttribute","tagName","getBoundingClientRect"],i=Object.keys(n);return e.every((r=>i.includes(r)))}}const $u=(n,t)=>Object.prototype.toString.call(n)===`[object ${t}]`,Fdt=(n,t=!1)=>t?typeof n=="boolean":n===!0||n===!1||$u(n,"Boolean"),sP=n=>n==null,g1=n=>n!=null,zdt=n=>typeof n=="object"&&n!==null,Ndt=function(n){if(!zdt(n)||!$u(n,"Object"))return!1;if(Object.getPrototypeOf(n)===null)return!0;let t=n;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(n)===t},Wdt=(n,t=!1)=>{const e=typeof n;return t?e==="string":e==="string"||$u(n,"String")},Tm=n=>Array.isArray?Array.isArray(n):$u(n,"Array"),jdt=function(n){return n!==null&&typeof n!="function"&&Number.isFinite(n.length)},Vdt=n=>$u(n,"Date"),EF=(n,t=!1)=>{const e=typeof n;return t?e==="number":e==="number"||$u(n,"Number")};function LF(n,t,e){let i;if(!g1(n)||typeof n!="object"||t)return n;const r=Tm(n),o=n.length;i=r?new Array(o):typeof n=="object"?{}:Fdt(n)||EF(n)||Wdt(n)?n:Vdt(n)?new Date(+n):void 0;const s=r?void 0:Object.keys(Object(n));let a=-1;if(i)for(;++a<(s||n).length;){const l=s?s[a]:a,h=n[l];i[l]=LF(h,t)}return i}function OF(n,t,e=!1,i=!1){if(t){if(n===t)return;if(g1(t)&&typeof t=="object"){const r=Object(t),o=[];for(const l in r)o.push(l);let{length:s}=o,a=-1;for(;s--;){const l=o[++a];!g1(r[l])||typeof r[l]!="object"||i&&Tm(n[l])?IF(n,l,r[l]):Gdt(n,t,l,e,i)}}}}function Gdt(n,t,e,i=!1,r=!1){const o=n[e],s=t[e];let a=t[e],l=!0;if(Tm(s)){if(i)a=[];else if(Tm(o))a=o;else if(jdt(o)){a=new Array(o.length);let h=-1;const u=o.length;for(;++h<u;)a[h]=o[h]}}else Ndt(s)?(a=o??{},typeof o!="function"&&typeof o=="object"||(a={})):l=!1;l&&OF(a,s,i,r),IF(n,e,a)}function IF(n,t,e){(e!==void 0&&!$dt(n[t],e)||e===void 0&&!(t in n))&&(n[t]=e)}function $dt(n,t){return n===t||Number.isNaN(n)&&Number.isNaN(t)}function Udt(n,...t){let e=-1;const i=t.length;for(;++e<i;)OF(n,t[e],!0);return n}const Xdt=typeof console<"u";function Rf(n,t,e){const i=[t].concat([].slice.call(e))}var $r;(function(n){n[n.None=0]="None",n[n.Error=1]="Error",n[n.Warn=2]="Warn",n[n.Info=3]="Info",n[n.Debug=4]="Debug"})($r||($r={}));class Mn{static getInstance(t,e){return Mn._instance&&EF(t)?Mn._instance.level(t):Mn._instance||(Mn._instance=new Mn(t,e)),Mn._instance}static setInstance(t){return Mn._instance=t}static setInstanceLevel(t){Mn._instance?Mn._instance.level(t):Mn._instance=new Mn(t)}static clearInstance(){Mn._instance=null}constructor(t=$r.None,e){this._onErrorHandler=[],this._level=t,this._method=e}addErrorHandler(t){this._onErrorHandler.find((e=>e===t))||this._onErrorHandler.push(t)}removeErrorHandler(t){const e=this._onErrorHandler.findIndex((i=>i===t));e<0||this._onErrorHandler.splice(e,1)}callErrorHandler(...t){this._onErrorHandler.forEach((e=>e(...t)))}canLogInfo(){return this._level>=$r.Info}canLogDebug(){return this._level>=$r.Debug}canLogError(){return this._level>=$r.Error}canLogWarn(){return this._level>=$r.Warn}level(t){return arguments.length?(this._level=+t,this):this._level}error(...t){var e;return this._level>=$r.Error&&(this._onErrorHandler.length?this.callErrorHandler(...t):Rf((e=this._method)!==null&&e!==void 0?e:"error","ERROR",t)),this}warn(...t){return this._level>=$r.Warn&&Rf(this._method||"warn","WARN",t),this}info(...t){return this._level>=$r.Info&&Rf(this._method||"log","INFO",t),this}debug(...t){return this._level>=$r.Debug&&Rf(this._method||"log","DEBUG",t),this}}Mn._instance=null;const Ydt=(n,t)=>{var e,i;if(!t?.fields||n.length===0)return n;const r=t.fields,o=n[0],s={},a=[];for(const l in r)if(Object.prototype.hasOwnProperty.call(r,l)){const h=r[l];if(!h.type){let d=o;l in o||(d=(e=n.find((c=>l in c)))!==null&&e!==void 0?e:o),h.type=typeof d[l]=="number"?"linear":"ordinal"}let u;if(typeof h.sortIndex=="number"&&(u={key:l,type:h.type,index:h.sortIndex,sortIndex:{},sortIndexCount:0,sortReverse:h.sortReverse===!0},a.push(u)),((i=h.domain)===null||i===void 0?void 0:i.length)>0)if(h.type==="ordinal"){h._domainCache={},s[l]=h;const d={};h.domain.forEach(((c,g)=>{d[c]=g,h._domainCache[c]=g})),u&&(u.sortIndex=d,u.sortIndexCount=h.domain.length)}else h.domain.length>=2&&(s[l]=h)}return Object.keys(s).length>0&&(n=n.filter((l=>{for(const h in s){const u=s[h];if(u.type==="ordinal"){if(!(l[h]in u._domainCache))return!1}else if(u.domain[0]>l[h]||u.domain[1]<l[h])return!1}return!0}))),a.sort(((l,h)=>l.index-h.index)),n.sort(((l,h)=>qdt(l,h,a))),n};function qdt(n,t,e){for(let i=0;i<e.length;i++){const r=e[i];let o=0;if(r.type==="ordinal"?(r.sortIndex[t[r.key]]===void 0&&(r.sortIndex[t[r.key]]=r.sortIndexCount++),r.sortIndex[n[r.key]]===void 0&&(r.sortIndex[n[r.key]]=r.sortIndexCount++),o=r.sortIndex[n[r.key]]-r.sortIndex[t[r.key]]):r.type==="linear"&&(o=n[r.key]-t[r.key]),r.sortReverse&&(o=-o),o!==0)return o}return 0}let DC=0;const Kdt=1e8;function HF(n="dataset"){return DC>Kdt&&(DC=0),n+"_"+DC++}class Zdt{constructor(t){var e;let i;this.options=t,this.isDataSet=!0,this.transformMap={},this.parserMap={},this.dataViewMap={},this.target=new Gl,i=t?.name?t.name:HF("dataset"),this.name=i,this._logger=(e=t?.logger)!==null&&e!==void 0?e:Mn.getInstance()}setLogger(t){this._logger=t}getDataView(t){return this.dataViewMap[t]}setDataView(t,e){var i;this.dataViewMap[t]&&((i=this._logger)===null||i===void 0||i.error(`Error: dataView ${t} 之前已存在，请重新命名`)),this.dataViewMap[t]=e}removeDataView(t){this.dataViewMap[t]=null,delete this.dataViewMap[t]}registerParser(t,e){var i;this.parserMap[t]&&((i=this._logger)===null||i===void 0||i.warn(`Warn: transform ${t} 之前已注册，执行覆盖逻辑`)),this.parserMap[t]=e}removeParser(t){this.parserMap[t]=null,delete this.parserMap[t]}getParser(t){return this.parserMap[t]||this.parserMap.default}registerTransform(t,e){var i;this.transformMap[t]&&((i=this._logger)===null||i===void 0||i.warn(`Warn: transform ${t} 之前已注册，执行覆盖逻辑`)),this.transformMap[t]=e}removeTransform(t){this.transformMap[t]=null,delete this.transformMap[t]}getTransform(t){return this.transformMap[t]}multipleDataViewAddListener(t,e,i){this._callMap||(this._callMap=new Map);let r=this._callMap.get(i);r||(r=()=>{t.some((o=>o.isRunning))||i()}),t.forEach((o=>{o.target.addListener(e,r)})),this._callMap.set(i,r)}allDataViewAddListener(t,e){this.multipleDataViewAddListener(Object.values(this.dataViewMap),t,e)}multipleDataViewRemoveListener(t,e,i){if(this._callMap){const r=this._callMap.get(i);r&&t.forEach((o=>{o.target.removeListener(e,r)})),this._callMap.delete(i)}}multipleDataViewUpdateInParse(t){t.forEach((e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.markRunning()})),t.forEach((e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.parseNewData(e.data,e.options)}))}multipleDataViewUpdateInRawData(t){t.forEach((e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.markRunning()})),t.forEach((e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.updateRawData(e.data,e.options)}))}destroy(){this.transformMap=null,this.parserMap=null,this.dataViewMap=null,this._callMap=null,this.target.removeAllListeners()}}const FC="_data-view-diff-rank";let DF=class FF{constructor(t,e){let i;this.dataSet=t,this.options=e,this.isDataView=!0,this.target=new Gl,this.parseOption=null,this.transformsArr=[],this.isRunning=!1,this.rawData={},this.history=!1,this.parserData={},this.latestData={},this._fields=null,this.reRunAllTransform=(r={pushHistory:!0,emitMessage:!0})=>(this.isRunning=!0,this.resetTransformData(),this.transformsArr.forEach((o=>{this.executeTransform(o,{pushHistory:r.pushHistory,emitMessage:!1}),this.isLastTransform(o)&&this.diffLastData()})),this.isRunning=!1,r.emitMessage!==!1&&this.target.emit("change",[]),this),this.markRunning=()=>{this.isRunning=!0,this.target.emit("markRunning",[])},i=e?.name?e.name:HF("dataview"),this.name=i,e?.history&&(this.history=e.history,this.historyData=[]),this.dataSet.setDataView(i,this),this.setFields(e?.fields)}parse(t,e,i=!1){var r;this.isRunning=!0,i&&this.target.emit("beforeParse",[]),e&&(this.parseOption=e);const o=this.cloneParseData(t,e);if(e?.type){const s=((r=this.dataSet.getParser(e.type))!==null&&r!==void 0?r:this.dataSet.getParser("bytejson"))(o,e.options,this);this.rawData=o,this.parserData=s,this.history&&this.historyData.push(o,s),this.latestData=s}else this.parserData=o,this.rawData=o,this.history&&this.historyData.push(o),this.latestData=o;return this.isRunning=!1,i&&this.target.emit("afterParse",[]),this}transform(t,e=!0){if(this.isRunning=!0,t&&t.type){let i=!0;if(t.type==="fields"){this._fields=t.options.fields;const r=this.transformsArr.findIndex((o=>o.type===t.type));r>=0&&(i=!1,this.transformsArr[r].options.fields=this._fields)}if(i&&this.transformsArr.push(t),e){const r=this.isLastTransform(t);this.executeTransform(t),r&&this.diffLastData()}}return this.sortTransform(),this.isRunning=!1,this}isLastTransform(t){return this.transformsArr[this.transformsArr.length-1]===t}sortTransform(){this.transformsArr.length>=2&&this.transformsArr.sort(((t,e)=>{var i,r;return((i=t.level)!==null&&i!==void 0?i:0)-((r=e.level)!==null&&r!==void 0?r:0)}))}executeTransform(t,e={pushHistory:!0,emitMessage:!0}){const{pushHistory:i,emitMessage:r}=e,o=this.dataSet.getTransform(t.type)(this.latestData,t.options);this.history&&i!==!1&&this.historyData.push(o),this.latestData=o,r!==!1&&this.target.emit("change",[])}resetTransformData(){this.latestData=this.parserData,this.history&&(this.historyData.length=0,this.historyData.push(this.rawData,this.parserData))}enableDiff(t){this._diffData=!0,this._diffKeys=t,this._diffMap=new Map,this._diffRank=0}disableDiff(){this._diffData=!1,this._diffMap=null,this._diffRank=null}resetDiff(){this._diffMap=new Map,this._diffRank=0}diffLastData(){var t;if(!this._diffData||!this.latestData.forEach||!(!((t=this._diffKeys)===null||t===void 0)&&t.length))return;const e=this._diffRank+1;if(this._diffRank===0)this.latestData.forEach((i=>{i[FC]=e,this._diffMap.set(this._diffKeys.reduce(((r,o)=>r+i[o]),""),i)})),this.latestDataAUD={add:Array.from(this.latestData),del:[],update:[]};else{let i;this.latestDataAUD={add:[],del:[],update:[]},this.latestData.forEach((r=>{r[FC]=e,i=this._diffKeys.reduce(((o,s)=>o+r[s]),""),this._diffMap.get(i)?this.latestDataAUD.update.push(r):this.latestDataAUD.add.push(r),this._diffMap.set(i,r)})),this._diffMap.forEach(((r,o)=>{r[FC]<e&&(this.latestDataAUD.del.push(r),this._diffMap.delete(o))}))}this._diffRank=e}cloneParseData(t,e){let i=!1;return t instanceof FF||e?.clone!==!0||(i=!0),i?LF(t):t}parseNewData(t,e){this.parse(t,e||this.parseOption),this.reRunAllTransform()}updateRawData(t,e){const i=this.cloneParseData(t,e);this.rawData=i,this.parserData=i,this.latestData=i,this.reRunAllTransform()}getFields(){var t;return this._fields?this._fields:((t=this.parseOption)===null||t===void 0?void 0:t.type)==="dataview"&&this.rawData.length===1&&this.rawData[0].getFields?this.rawData[0].getFields():null}setFields(t,e=!1){this._fields=t&&e?Udt({},this._fields,t):t;const i=this.transformsArr.find((r=>r.type==="fields"));!sP(this._fields)&&sP(i)?(this.dataSet.registerTransform("fields",Ydt),this.transform({type:"fields",options:{fields:this._fields}},!1)):i&&(i.options.fields=this._fields)}destroy(){this.dataSet.removeDataView(this.name),this._diffMap=null,this._diffRank=null,this.latestData=null,this.rawData=null,this.parserData=null,this.transformsArr=null,this.target=null}};function Jdt(n){return n instanceof DF}function gh(n,t=["data"]){const e=n;let i;if(!Edt(e)||typeof e!="object"||Jdt(e)||Ddt(e))return e;const r=Odt(e),o=e.length;i=r?new Array(o):typeof e=="object"?{}:Pdt(e)||Hdt(e)||Ldt(e)?e:Idt(e)?new Date(+e):void 0;const s=r?void 0:Object.keys(Object(e));let a=-1;if(i)for(;++a<(s||e).length;){const l=s?s[a]:a,h=e[l];t?.includes(l.toString())?i[l]=h:i[l]=gh(h,t)}return i}function zF(n){var t,e;const i=Object.assign({},n);return dn(n.style)||(i.textStyle=ci(n.style)),dn(n.textStyle)||xe(i.textStyle,ci(n.textStyle)),!((t=n.shape)===null||t===void 0)&&t.style&&ci(i.shape.style),!((e=n.background)===null||e===void 0)&&e.style&&ci(i.background.style),i}function ci(n){return dn(n)||n.angle&&(n.angle=D0(n.angle)),n}function Zr(n={}){return dn(n.style)||(n.style=ci(n.style)),dn(n.state)||Object.keys(n.state).forEach((t=>{dn(n.state[t])||(n.state[t]=ci(n.state[t]))})),n}function Ha(n){return dn(n)?null:(Object.keys(n).forEach((t=>{dn(n[t])||(n[t]=ci(n[t]))})),n)}function Qdt(n){return Zr(n),Zr(n.startSymbol),Zr(n.endSymbol),n}const tct={left:{textAlign:"center",textBaseline:"bottom"},right:{textAlign:"center",textBaseline:"bottom"},radius:{},angle:{}},jh="PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol",Vh=14,Td={LABEL_FONT_SIZE:14,AXIS_TICK_SIZE:4},Rm={domainLine:{visible:!0,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},grid:{visible:!0,style:{lineWidth:1,stroke:"#EBEDF2",strokeOpacity:1,lineDash:[]}},subGrid:{visible:!1,style:{lineWidth:1,stroke:"#EBEDF2",strokeOpacity:1,lineDash:[4,4]}},tick:{visible:!0,tickSize:Td.AXIS_TICK_SIZE,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},subTick:{visible:!1,tickSize:Td.AXIS_TICK_SIZE/2,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},label:{visible:!0,space:1,style:{fontSize:Td.LABEL_FONT_SIZE,fill:"#89909D",fontWeight:"normal",fillOpacity:1},autoLimit:!0},title:{space:10,style:{fontSize:Td.LABEL_FONT_SIZE,fill:"#333333",fontWeight:"normal",fillOpacity:1}}};function ect(n){var t,e;return!((e=(t=n?.colorScheme)===null||t===void 0?void 0:t.default)===null||e===void 0)&&e.palette?xe({},Rm,{tick:{style:{stroke:n.colorScheme.default.palette.axisDomainColor||"#D9DDE4"}},subTick:{style:{stroke:n.colorScheme.default.palette.axisDomainColor||"#D9DDE4"}},label:{style:{fill:n.colorScheme.default.palette.axisLabelFontColor||"#89909D"}},title:{style:{fill:n.colorScheme.default.palette.secondaryFontColor||"#333333"}}}):Rm}function aP(n){var t,e,i,r,o,s,a,l,h,u,d,c,g;const f=xe({},n);let p,m=(e=(t=f.title)===null||t===void 0?void 0:t.angle)!==null&&e!==void 0?e:0;f.orient!=="left"&&f.orient!=="right"||!((i=f.title)===null||i===void 0)&&i.autoRotate&&he(f.title.angle)&&(m=f.orient==="left"?-90:90,p=tct[f.orient]);const v=Rnt(f.label,["style","formatMethod","state"]);return{orient:f.orient,select:f.select,hover:f.hover,line:Qdt(f.domainLine),label:Object.assign({style:ci(f.label.style),formatMethod:f.label.formatMethod?(b,y,C)=>f.label.formatMethod(y.rawValue,y):null,state:Ha(f.label.state)},v),tick:{visible:f.tick.visible,length:f.tick.tickSize,inside:f.tick.inside,alignWithLabel:f.tick.alignWithLabel,style:ci(f.tick.style),state:Ha(f.tick.state),dataFilter:f.tick.dataFilter},subTick:{visible:f.subTick.visible,length:f.subTick.tickSize,inside:f.subTick.inside,count:f.subTick.tickCount,style:ci(f.subTick.style),state:Ha(f.subTick.state)},grid:{type:"line",visible:f.grid.visible,alternateColor:f.grid.alternateColor,alignWithLabel:f.grid.alignWithLabel,style:ci(f.grid.style)},subGrid:{type:"line",visible:f.subGrid.visible,alternateColor:f.subGrid.alternateColor,style:ci(f.subGrid.style)},title:{visible:f.title.visible,position:f.title.position,space:f.title.space,autoRotate:!1,angle:m?D0(m):null,textStyle:xe({},p,ci(f.title.style)),padding:f.title.padding,shape:{visible:(r=f.title.shape)===null||r===void 0?void 0:r.visible,space:(o=f.title.shape)===null||o===void 0?void 0:o.space,style:ci((s=f.title.shape)===null||s===void 0?void 0:s.style)},background:{visible:(a=f.title.background)===null||a===void 0?void 0:a.visible,style:ci((l=f.title.background)===null||l===void 0?void 0:l.style)},state:{text:Ha(f.title.state),shape:Ha((h=f.title.shape)===null||h===void 0?void 0:h.state),background:Ha((u=f.title.background)===null||u===void 0?void 0:u.state)}},panel:{visible:(d=f.background)===null||d===void 0?void 0:d.visible,style:ci((c=f.background)===null||c===void 0?void 0:c.style),state:Ha((g=f.background)===null||g===void 0?void 0:g.state)}}}function ict(n,t,e){var i;const r=e.getRawChartSpec(n,t);if(r?.series){const o={};return!((i=r.data)===null||i===void 0)&&i.id&&(o[r.data.id]=void 0),r?.series.forEach((s=>{var a,l,h,u,d,c,g,f,p,m,v;if(!(!((a=s.data)===null||a===void 0)&&a.fromDataId))if(!((l=s.data)===null||l===void 0)&&l.transforms)o[(v=(p=(f=s.data)===null||f===void 0?void 0:f.id)!==null&&p!==void 0?p:(m=r.data)===null||m===void 0?void 0:m.id)!==null&&v!==void 0?v:"data"]=void 0;else{const b=s.direction==="horizontal"?s.xField:s.yField;o[(c=(u=(h=s.data)===null||h===void 0?void 0:h.id)!==null&&u!==void 0?u:(d=r.data)===null||d===void 0?void 0:d.id)!==null&&c!==void 0?c:"data"]=!((g=s.data)===null||g===void 0)&&g.id?b:void 0}})),o}return r.data.id}function nct(n){let t=!1;for(let e=0;e<n.columnObjects.length;e++)if(n.columnObjects[e].chartSpec){t=!0;break}return t}function rct(n,t,e){var i,r,o;if(n===-1||t===-1)return{start:{col:n,row:t},end:{col:n,row:t}};if(e._cellRangeMap.has(`$${n}$${t}`))return e._cellRangeMap.get(`$${n}$${t}`);let s={start:{col:n,row:t},end:{col:n,row:t}};if(e.transpose)s=sct(n,t,e);else if(e.headerLevelCount<=t){if(e.headerLevelCount<=t&&(!((r=(i=e.columnObjects[n-e.leftRowSeriesNumberColumnCount])===null||i===void 0?void 0:i.define)===null||r===void 0)&&r.mergeCell)){const a=e._table.getCellValue(n,t);for(let l=t-1;l>=e.headerLevelCount;l--){const h=e._table.getCellValue(n,l);if(typeof e.columnObjects[n-e.leftRowSeriesNumberColumnCount].define.mergeCell=="boolean"){if(a!==h)break}else if(!e.columnObjects[n-e.leftRowSeriesNumberColumnCount].define.mergeCell(a,h,{source:{col:n,row:t},target:{col:n,row:l},table:e._table}))break;s.start.row=l}for(let l=t+1;l<e.rowCount;l++){const h=e._table.getCellValue(n,l);if(typeof e.columnObjects[n-e.leftRowSeriesNumberColumnCount].define.mergeCell=="boolean"){if(a!==h)break}else if(!e.columnObjects[n-e.leftRowSeriesNumberColumnCount].define.mergeCell(a,h,{source:{col:n,row:t},target:{col:n,row:l},table:e._table}))break;s.end.row=l}}oct(n,t,s,e)}else{const a=e.getCellId(n,t);for(let l=n-1;l>=0&&a===e.getCellId(l,t);l--)s.start.col=l;for(let l=n+1;l<((o=e.colCount)!==null&&o!==void 0?o:0)&&a===e.getCellId(l,t);l++)s.end.col=l;for(let l=t-1;l>=0&&a===e.getCellId(n,l);l--)s.start.row=l;for(let l=t+1;l<e.headerLevelCount&&a===e.getCellId(n,l);l++)s.end.row=l}return e._cellRangeMap.set(`$${n}$${t}`,s),s}function oct(n,t,e,i){if(i.rowHierarchyType!=="tree")return;const r=i._table.getCellRawRecord(n,t);i._table.internalProps.groupTitleCheckbox&&i._table.internalProps.rowSeriesNumber?r?.vtableMerge&&n>=i.leftRowSeriesNumberColumnCount&&(e.start.col=i.rowHeaderLevelCount+i.leftRowSeriesNumberColumnCount,e.end.col=i.colCount-1,e.start.row=e.end.row=t):r?.vtableMerge&&(e.start.col=i.rowHeaderLevelCount,e.end.col=i.colCount-1,e.start.row=e.end.row=t)}function sct(n,t,e){var i,r,o,s;const a={start:{col:n,row:t},end:{col:n,row:t}};if(e.headerLevelCount+e.leftRowSeriesNumberColumnCount<=n||n===-1&&t===-1){if(e.headerLevelCount+e.leftRowSeriesNumberColumnCount<=n&&(!((r=(i=e.columnObjects[t])===null||i===void 0?void 0:i.define)===null||r===void 0)&&r.mergeCell)){const h=e._table.getCellValue(n,t);for(let u=n-1;u>=e.headerLevelCount+e.leftRowSeriesNumberColumnCount;u--){const d=e._table.getCellValue(u,t);if(typeof e.columnObjects[t].define.mergeCell=="boolean"){if(h!==d)break}else if(!e.columnObjects[t].define.mergeCell(h,d,{source:{col:n,row:t},target:{col:u,row:t},table:e._table}))break;a.start.col=u}for(let u=n+1;u<((o=e.colCount)!==null&&o!==void 0?o:0);u++){const d=e._table.getCellValue(u,t);if(typeof e.columnObjects[t].define.mergeCell=="boolean"){if(h!==d)break}else if(!e.columnObjects[t].define.mergeCell(h,d,{source:{col:n,row:t},target:{col:u,row:t},table:e._table}))break;a.end.col=u}}return a}const l=e.getCellId(n,t);for(let h=t-1;h>=0&&l===e.getCellId(n,h);h--)a.start.row=h;for(let h=t+1;h<((s=e.rowCount)!==null&&s!==void 0?s:0)&&l===e.getCellId(n,h);h++)a.end.row=h;for(let h=n-1;h>=0&&l===e.getCellId(h,t);h--)a.start.col=h;for(let h=n+1;h<e.headerLevelCount+e.leftRowSeriesNumberColumnCount&&l===e.getCellId(h,t);h++)a.end.col=h;return a}class act{constructor(t,e,i,r){var o,s;this.seqId=0,this._columnMaxDepth=0,this.leftRowSeriesNumberColumnCount=0,this.rightRowSeriesNumberColumnCount=0,this.bodyRowSpanCount=1,this._transpose=!1,this._showHeader=!0,this._recordsCount=0,this._hasAggregation=!1,this._hasAggregationOnTopCount=0,this._hasAggregationOnBottomCount=0,this._cellRangeMap=new Map,this._showHeader=i,this._table=t,this._columns=[],this._columnsIncludeHided=[],this._headerCellIds=[],this._columnMaxDepth=this._calculateMaxDepth(e),this.hierarchyIndent=r??20,this.hierarchyTextStartAlignment=t.options.hierarchyTextStartAlignment,this.columnHierarchyType=t.options.headerHierarchyType,this.columnExpandLevel=(o=t.options.headerExpandLevel)!==null&&o!==void 0?o:1,this.columnTree=new Qut(e,{seqId:0},(s=this.columnHierarchyType)!==null&&s!==void 0?s:null,this.columnHierarchyType==="grid-tree"?this.columnExpandLevel:void 0),this._headerObjectsIncludeHided=this._addHeaders(0,e,[]),this._headerObjects=this._headerObjectsIncludeHided.filter((a=>a.define.hide!==!0)),this._headerObjectMap=this._headerObjects.reduce(((a,l)=>(a[l.id]=l,a)),{}),this.rowHierarchyType=ndt(this)?"tree":"grid",this._hasAggregation=tdt(this),this._hasAggregationOnBottomCount=idt(this),this._hasAggregationOnTopCount=edt(this),this.handleRowSeriesNumber(t.internalProps.rowSeriesNumber)}handleRowSeriesNumber(t){var e,i,r;t&&(Array.isArray(t)?this.rowSeriesNumberColumn=t.map(((o,s)=>{var a,l;return{id:this.seqId++,title:o.title,define:xe({field:"_vtable_rowSeries_number_"+s},o),cellType:(a=o.cellType)!==null&&a!==void 0?a:"text",headerType:o.cellType==="checkbox"?"checkbox":"text",style:o.style,width:o.width,format:o.format,field:(l=o.field)!==null&&l!==void 0?l:"_vtable_rowSeries_number_"+s,icon:o.icon,headerIcon:o.headerIcon,isChildNode:!1}})):this.rowSeriesNumberColumn=[{id:this.seqId++,title:t.title,define:xe({field:"_vtable_rowSeries_number"},t),cellType:(e=t.cellType)!==null&&e!==void 0?e:"text",headerType:(i=t.headerType)!==null&&i!==void 0?i:t.cellType==="checkbox"?"checkbox":"text",style:t.style,width:t.width,format:t.format,field:(r=t.field)!==null&&r!==void 0?r:"_vtable_rowSeries_number",icon:t.icon,headerIcon:t.headerIcon,isChildNode:!1}],this.leftRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter((o=>!0)),this.rightRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter((o=>!1)),this.leftRowSeriesNumberColumnCount=this.leftRowSeriesNumberColumn.length,this.rightRowSeriesNumberColumnCount=this.rightRowSeriesNumberColumn.length)}get transpose(){return this._transpose}set transpose(t){this._transpose=t}get showHeader(){return this._showHeader}set showHeader(t){this._showHeader=t}isSeriesNumberInHeader(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&e>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return!1;if(e<this.headerLevelCount)return!0}if(this.rightRowSeriesNumberColumnCount>0&&e>=0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return!1;if(e<this.headerLevelCount)return!0}return!1}isSeriesNumberInBody(t,e){return!!(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount&&(this.transpose||e>=this.headerLevelCount)||this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount&&(this.transpose||e>=this.headerLevelCount))}isSeriesNumber(t,e){return!!($(t)&&$(e)&&(this.leftRowSeriesNumberColumnCount>0&&t>=0&&e>=0&&t<this.leftRowSeriesNumberColumnCount||this.rightRowSeriesNumberColumnCount>0&&e>=0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount))}getSeriesNumberHeader(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return;if(e<this.headerLevelCount)return Object.assign({},this.leftRowSeriesNumberColumn[t],{style:Object.assign({},this._table.transpose?this._table.internalProps.theme.rowHeaderStyle:this._table.internalProps.theme.headerStyle,this._table.internalProps.rowSeriesNumber.headerStyle)})}if(this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount&&e<this.headerLevelCount){if(this.transpose)return;if(e<this.headerLevelCount)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)]}}getSeriesNumberBody(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return this.leftRowSeriesNumberColumn[t];if(e>=this.headerLevelCount)return this.leftRowSeriesNumberColumn[t]}if(this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)];if(e>=this.headerLevelCount)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)]}}isHeader(t,e){return!!(this.transpose&&t>=this.leftRowSeriesNumberColumnCount&&t<this.headerLevelCount+this.leftRowSeriesNumberColumnCount)||!this.transpose&&e>=0&&e<this.headerLevelCount}isAggregation(t,e){if(this.hasAggregation){if(this.hasAggregationOnBottomCount){if(this.transpose){if(t>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(e>=this.rowCount-this.hasAggregationOnBottomCount)return!0}if(this.hasAggregationOnTopCount){if(this.transpose){if(t>=this.rowHeaderLevelCount&&t<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(e>=this.columnHeaderLevelCount&&e<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0}}return!1}isTopAggregation(t,e){if(this.hasAggregationOnTopCount){if(this.transpose){if(t>=this.rowHeaderLevelCount&&t<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(e>=this.columnHeaderLevelCount&&e<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0}return!1}isBottomAggregation(t,e){if(this.hasAggregationOnBottomCount){if(this.transpose){if(t>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(e>=this.rowCount-this.hasAggregationOnBottomCount)return!0}return!1}get hasAggregation(){return this._hasAggregation}get hasAggregationOnTopCount(){return this._hasAggregationOnTopCount}get hasAggregationOnBottomCount(){return this._hasAggregationOnBottomCount}getAggregatorsByCell(t,e){return this.getColumnDefine(t,e).vtable_aggregator}getAggregatorsByCellRange(t,e,i,r){let o=[];if(!this.transpose){for(let s=t;s<=i;s++){const a=this.getColumnDefine(s,e);a.vtable_aggregator&&(o=o.concat(Array.isArray(a.vtable_aggregator)?a.vtable_aggregator:[a.vtable_aggregator]))}return o}for(let s=e;s<=r;s++){const a=this.getColumnDefine(t,s);a.vtable_aggregator&&(o=o.concat(Array.isArray(a.vtable_aggregator)?a.vtable_aggregator:[a.vtable_aggregator]))}return[]}getAggregatorOnTop(t,e){const i=this.getColumnDefine(t,e),r=i.vtable_aggregator,o=i.aggregation;if(Array.isArray(o)){const s=o.reduce(((a,l,h)=>(l.showOnTop&&a.push(h),a)),[]).map((a=>r[a]));return this.transpose?s[t-this.rowHeaderLevelCount]:s[e-this.columnHeaderLevelCount]}return this.transpose&&t-this.rowHeaderLevelCount==0?o?.showOnTop?r:null:this.transpose||e-this.columnHeaderLevelCount!=0?null:o?.showOnTop?r:null}getAggregatorOnBottom(t,e){const i=this.getColumnDefine(t,e),r=i.vtable_aggregator,o=i.aggregation;if(Array.isArray(o)){const s=o.reduce(((a,l,h)=>(l.showOnTop||a.push(h),a)),[]).map((a=>r[a]));return this.transpose?s[t-(this.colCount-this.hasAggregationOnBottomCount)]:s[e-(this.rowCount-this.hasAggregationOnBottomCount)]}return this.transpose&&t-(this.colCount-this.hasAggregationOnBottomCount)==0?o?.showOnTop?null:r:this.transpose||e-(this.rowCount-this.hasAggregationOnBottomCount)!=0||o?.showOnTop?null:r}getAggregatorCellAddress(t,e,i,r){const o=[],s=this.hasAggregationOnTopCount,a=this.hasAggregationOnBottomCount;if(this.transpose){for(let l=e;l<=r;l++)if(this.getColumnDefine(t,l).vtable_aggregator){for(let h=0;h<s;h++)o.push({col:this.headerLevelCount+h,row:l});for(let h=0;h<a;h++)o.push({col:this.rowCount-a+h,row:l})}}else for(let l=t;l<=i;l++)if(this.getColumnDefine(l,e).vtable_aggregator){for(let h=0;h<s;h++)o.push({col:l,row:this.headerLevelCount+h});for(let h=0;h<a;h++)o.push({col:l,row:this.rowCount-a+h})}return o}getCellLocation(t,e){return this.isHeader(t,e)?this.transpose?"rowHeader":"columnHeader":"body"}isRowHeader(t,e){return!!(this.transpose&&t>=this.leftRowSeriesNumberColumnCount&&t<this.headerLevelCount+this.leftRowSeriesNumberColumnCount)}isColumnHeader(t,e){return!this.transpose&&e>=0&&e<=this.headerLevelCount-1&&t>=this.leftRowSeriesNumberColumnCount&&t<this.colCount-this.rightRowSeriesNumberColumnCount}isFrozenColumn(t,e){if($(e)){if(t>=0&&t<this.frozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.frozenColCount>0&&t>=0&&t<this.frozenColCount)return!0;return!1}isRightFrozenColumn(t,e){if($(e)){if(t>=this.colCount-this.rightFrozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.rightFrozenColCount>0&&t>=this.colCount-this.rightFrozenColCount)return!0;return!1}isFrozenRow(t,e){if($(e)){if(e>=0&&e<this.frozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.frozenRowCount>0&&e>=0&&e<this.frozenRowCount)return!0;return!1}isBottomFrozenRow(t,e){if($(e)){if(e>=this.rowCount-this.bottomFrozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.bottomFrozenRowCount>0&&e>=this.rowCount-this.bottomFrozenRowCount)return!0;return!1}isLeftTopCorner(t,e){return t>=0&&t<this.frozenColCount&&e>=0&&e<this.frozenRowCount}isLeftBottomCorner(t,e){return t>=0&&t<this.frozenColCount&&e>=this.rowCount-this.bottomFrozenRowCount}isRightTopCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=0&&e<this.frozenRowCount}isRightBottomCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=this.rowCount-this.bottomFrozenRowCount}isCornerHeader(t,e){return!1}getColumnHeaderRange(){var t,e;return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:((t=this.rowCount)!==null&&t!==void 0?t:0)-1}}:{start:{col:0,row:0},end:{col:((e=this.colCount)!==null&&e!==void 0?e:0)-1,row:this._headerCellIds.length-1}}}getRowHeaderRange(){var t,e;return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:((t=this.rowCount)!==null&&t!==void 0?t:0)-1}}:{start:{col:0,row:0},end:{col:((e=this.colCount)!==null&&e!==void 0?e:0)-1,row:this._headerCellIds.length-1}}}getCornerHeaderRange(){}getBodyRange(){var t,e,i,r;return this.transpose?{start:{col:this.headerLevelCount,row:0},end:{col:((t=this.colCount)!==null&&t!==void 0?t:0)-1,row:((e=this.rowCount)!==null&&e!==void 0?e:0)-1}}:{start:{col:0,row:this.headerLevelCount},end:{col:((i=this.colCount)!==null&&i!==void 0?i:0)-1,row:((r=this.rowCount)!==null&&r!==void 0?r:0)-1}}}get headerLevelCount(){return this.showHeader?this._headerCellIds.length:0}get columnHeaderLevelCount(){return this.transpose?0:this.headerLevelCount}get rowHeaderLevelCount(){return this.transpose?this.headerLevelCount:0}get frozenColCount(){return this._table.internalProps.frozenColCount?this.colCount>this._table.internalProps.frozenColCount?this._table.internalProps.frozenColCount:this.colCount:0}get frozenRowCount(){return this._table.internalProps.frozenRowCount?this.rowCount>=this._table.internalProps.frozenRowCount?this._table.internalProps.frozenRowCount:this.rowCount:0}get bottomFrozenRowCount(){return this._table.internalProps.bottomFrozenRowCount?this.rowCount-this.headerLevelCount>=this._table.internalProps.bottomFrozenRowCount?this._table.internalProps.bottomFrozenRowCount:this.rowCount-this.headerLevelCount:0}get rightFrozenColCount(){return this._table.internalProps.rightFrozenColCount?this.colCount-this.frozenColCount>=this._table.internalProps.rightFrozenColCount?this._table.internalProps.rightFrozenColCount:Math.max(0,this.colCount-this.frozenColCount):0}get colCount(){return this.transpose?this.headerLevelCount+this.recordsCount+this.leftRowSeriesNumberColumnCount+this.rightRowSeriesNumberColumnCount:this._columns.length+this.leftRowSeriesNumberColumnCount+this.rightRowSeriesNumberColumnCount}get rowCount(){return this.transpose?this._columns.length:this.headerLevelCount+this.recordsCount}get bodyRowCount(){return this.transpose?this._columns.length:this.rowCount-this.bottomFrozenRowCount-this.headerLevelCount}get bodyColCount(){return this.transpose?this.colCount-this.rightFrozenColCount-this.rowHeaderLevelCount:this._columns.length}get recordsCount(){return this._recordsCount}set recordsCount(t){this._recordsCount=t}get headerObjects(){return this._headerObjects}get columnObjects(){return this._columns}get headerObjectsIncludeHided(){return this._headerObjectsIncludeHided}get columnWidths(){if(this.leftRowSeriesNumberColumnCount){const t=this.leftRowSeriesNumberColumn.map((e=>({width:e.width,minWidth:e.minWidth,maxWidth:e.maxWidth})));return t.push(...this._columns.map((e=>({width:e.width,minWidth:e.minWidth,maxWidth:e.maxWidth})))),t}return this._columns.map((t=>({width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth})))}getColumnWidthDefined(t){var e;if(t>=0){if(t<this.leftRowSeriesNumberColumnCount)return this.leftRowSeriesNumberColumn[t];if(this.transpose){let i,r,o=0;if(t>=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount){let s;return this.columnObjects.forEach(((a,l)=>{typeof a.width=="number"?o=Math.max(a.width,o):a.width==="auto"&&(s=!0),typeof a.minWidth=="number"&&(r=Math.max(a.minWidth,r)),typeof a.maxWidth=="number"&&(i=Math.max(a.maxWidth,i))})),o=o>0?o:s?"auto":void 0,{width:o,minWidth:r,maxWidth:i}}if(this.isRowHeader(t,0)){const s=Array.isArray(this._table.defaultHeaderColWidth)?(e=this._table.defaultHeaderColWidth[t])!==null&&e!==void 0?e:this._table.defaultColWidth:this._table.defaultHeaderColWidth;return s==="auto"?{width:"auto"}:{width:s}}}return this._columns[t-this.leftRowSeriesNumberColumnCount]}}getCellId(t,e){var i,r,o,s;return this.transpose?t>=this.headerLevelCount+this.leftRowSeriesNumberColumnCount?(i=this._columns[e])===null||i===void 0?void 0:i.id:this.isSeriesNumber(t,e)?e+"_series_number":(r=this._headerCellIds[t-this.leftRowSeriesNumberColumnCount])===null||r===void 0?void 0:r[e]:this.isSeriesNumber(t,e)?this.rowSeriesNumberColumn[t].id:this.headerLevelCount<=e?(o=this._columns[t-this.leftRowSeriesNumberColumnCount])===null||o===void 0?void 0:o.id:(s=this._headerCellIds[e])===null||s===void 0?void 0:s[t-this.leftRowSeriesNumberColumnCount]}getHeader(t,e){if(this.isSeriesNumberInHeader(t,e))return this.getSeriesNumberHeader(t,e);const i=this.getCellId(t,e);return this._headerObjectMap[i]}getHeaderField(t,e){var i,r,o;if(this.isSeriesNumberInHeader(t,e))return(i=this.getSeriesNumberHeader(t,e))===null||i===void 0?void 0:i.field;if(this.isSeriesNumberInBody(t,e))return(r=this.getSeriesNumberBody(t,e))===null||r===void 0?void 0:r.field;const s=this.getCellId(t,e);return((o=this._headerObjectMap[s])===null||o===void 0?void 0:o.field)||(this.transpose?this._columns[e]&&this._columns[e].field:this._columns[t-this.leftRowSeriesNumberColumnCount]&&this._columns[t-this.leftRowSeriesNumberColumnCount].field)}getHeaderCellAdressById(t){for(let e=0;e<this._headerCellIds.length;e++){const i=this._headerCellIds[e];for(let r=0;r<i.length;r++)if(i[r]===t)return this.transpose?{col:e,row:r}:{col:r+this.leftRowSeriesNumberColumnCount,row:e}}}getHeaderCellAddressByField(t){const e=this.headerObjects.find((i=>i&&i.field===t));return e&&this.getHeaderCellAdressById(e.id)}getBody(t,e){return this.isSeriesNumber(t,e)?this.getSeriesNumberBody(t,e):this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount]}getBodyLayoutRangeById(t){var e,i;if(this.transpose){for(let r=0;r<((e=this.rowCount)!==null&&e!==void 0?e:0);r++)if(t===this._columns[r].id)return{start:{col:0,row:r},end:{col:0,row:r}}}else for(let r=this.leftRowSeriesNumberColumnCount;r<((i=this.colCount)!==null&&i!==void 0?i:0);r++)if(t===this._columns[r-this.leftRowSeriesNumberColumnCount].id)return{start:{col:r,row:0},end:{col:r,row:0}};return{start:{col:-1,row:-1},end:{col:-1,row:-1}}}getCellRange(t,e){return rct(t,e,this)}isCellRangeEqual(t,e,i,r){const o=this.getCellRange(t,e),s=this.getCellRange(i,r);return o.start.col===s.start.col&&o.end.col===s.end.col&&o.start.row===s.start.row&&o.end.row===s.end.row}getRecordShowIndexByCell(t,e){const i=this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount;return this.transpose?t<i?-1:t-i:e<i?-1:e-i}getRecordStartRowByRecordIndex(t){return(this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount)+t}_calculateMaxDepth(t,e=0){let i=e;return t.forEach((r=>{if(r.columns&&r.columns.length>0){const o=this._calculateMaxDepth(r.columns,e+1);o>i&&(i=o)}})),i}_addHeaders(t,e,i,r,o){const s=[],a=this._newRow(t,r);return e.forEach((l=>{var h,u,d,c;const g=this._columns.length,f=this.seqId++,p={id:f,title:(h=l.title)!==null&&h!==void 0?h:l.caption,headerIcon:l.headerIcon,field:l.field,style:l.headerStyle,headerType:(u=l.headerType)!==null&&u!==void 0?u:"text",dropDownMenu:l.dropDownMenu,define:l,hierarchyState:l.hierarchyState,columnWidthComputeMode:l.columnWidthComputeMode};s[f]=p;let m=t;if(l.levelSpan){m=Math.min(t+l.levelSpan-1,this._columnMaxDepth-1);for(let b=t;b<=m;b++)this._headerCellIds[b]||(this._headerCellIds[b]=[]),this._headerCellIds[b][g]===void 0&&(this._headerCellIds[b][g]=f)}if(o)for(let b=m-1;b>=0;b--)this._headerCellIds[b]&&this._headerCellIds[b][g]===void 0&&i[m-o]!==void 0&&(this._headerCellIds[b][g]=i[m-o]);else for(let b=m-1;b>=0;b--)this._headerCellIds[b]&&this._headerCellIds[b][g]===void 0&&i[b]!==void 0&&(this._headerCellIds[b][g]=i[b]);r?this._headerCellIds[t-1]&&this._headerCellIds[t-1][g]!==void 0&&(a[g]=this._headerCellIds[t-1][g]):a[g]=f;const v=!l.hierarchyState||l.hierarchyState===Tt.expand;if(l.columns&&v)!(l.columns.every((b=>b.hide))||l.hide)&&this._addHeaders(m+1,l.columns,[...i,f],l.hideColumnsSubHeader||r,l.levelSpan).forEach((b=>s.push(b)));else{const b={id:this.seqId++,field:l.field,fieldFormat:l.fieldFormat,width:l.width,minWidth:l.minWidth,maxWidth:l.maxWidth,icon:l.icon,cellType:(c=(d=l.cellType)!==null&&d!==void 0?d:l.columnType)!==null&&c!==void 0?c:"text",chartModule:"chartModule"in l?l.chartModule:null,chartSpec:"chartSpec"in l?l.chartSpec:null,sparklineSpec:"sparklineSpec"in l?l.sparklineSpec:uot,style:l.style,define:l,columnWidthComputeMode:l.columnWidthComputeMode,disableColumnResize:l?.disableColumnResize,aggregation:l.aggregation,isChildNode:t>=1};if(this._columnsIncludeHided.push(b),l.hide!==!0){this._columns.push(b);for(let y=t+1;y<this._headerCellIds.length;y++)this._headerCellIds[y][g]=f}}})),s}_newRow(t,e=!1){if(this._headerCellIds[t]){const o=this._headerCellIds[t-1];if(o.length>this._headerCellIds[t].length)for(let s=this._headerCellIds[t].length;s<o.length;s++)this._headerCellIds[t][s]=o[s];return this._headerCellIds[t]}if(e)return[];const i=this._headerCellIds[t]=[];if(!this._columns.length)return i;const r=this._headerCellIds[t-1];for(let o=0;o<r.length;o++)i[o]=r[o];return i}getCellHeaderPaths(t,e){if(this.isSeriesNumber(t,e))return;let i=[],r=[];return this.transpose?r=[{field:this._columns[e].field}]:i=[{field:this._columns[t-this.leftRowSeriesNumberColumnCount].field}],{colHeaderPaths:i,rowHeaderPaths:r,cellLocation:this.getCellLocation(t,e)}}getParentCellId(t,e){if(e!==0){if(this.isColumnHeader(t,e))return this.getCellId(t,e-1);if(this.isRowHeader(t,e))return this.isSeriesNumberInBody(t-1,e)?void 0:this.getCellId(t-1,e)}}canMoveHeaderPosition(t,e){if(this.isSeriesNumberInHeader(e.col,e.row)||this.isSeriesNumberInHeader(t.col,t.row))return!1;if(!this.transpose&&this.isSeriesNumberInBody(e.col,e.row)&&this.isSeriesNumberInBody(t.col,t.row)){const r=this.getRecordShowIndexByCell(0,t.row),o=this.getRecordShowIndexByCell(0,e.row);return this._table.dataSource.canChangeOrder(r,o)}if(this.transpose&&this.isSeriesNumberInBody(e.col,e.row)&&this.isSeriesNumberInBody(t.col,t.row)&&(this.getBody(t.col+this.leftRowSeriesNumberColumnCount,t.row).isChildNode&&this.getBody(e.col+this.leftRowSeriesNumberColumnCount,e.row).isChildNode?(t.col=t.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1,e.col=e.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1):(t.col=t.col+this.leftRowSeriesNumberColumnCount,e.col=e.col+this.leftRowSeriesNumberColumnCount)),t.col<0||t.row<0||e.col<0||e.row<0||this._table.internalProps.frozenColDragHeaderMode==="disabled"&&this._table.isFrozenColumn(e.col))return!1;const i=this.getCellRange(t.col,t.row);return this.isColumnHeader(t.col,t.row)?this.getParentCellId(t.col,i.start.row)===this.getParentCellId(e.col,i.start.row):this.isRowHeader(t.col,t.row)?this.getParentCellId(i.start.col,t.row)===this.getParentCellId(i.start.col,e.row):!1}moveHeaderPosition(t,e){var i,r;if((!(!((i=this._table.options.dragOrder)===null||i===void 0)&&i.validateDragOrderOnEnd)||!((r=this._table.options.dragOrder)===null||r===void 0)&&r.validateDragOrderOnEnd(t,e))&&this.canMoveHeaderPosition(t,e)){let o=this.getCellRange(t.col,t.row);if(this.isColumnHeader(t.col,t.row)){const s=o.end.col-o.start.col+1;let a;const l=this.getCellRange(e.col,o.start.row);if(a=e.col>=t.col?l.end.col-s+1:l.start.col,a===o.start.col)return null;for(let u=0;u<this._headerCellIds.length;u++){const d=this._headerCellIds[u].splice(o.start.col-this.leftRowSeriesNumberColumnCount,s);d.unshift(a-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._headerCellIds[u],d)}const h=this._columns.splice(o.start.col-this.leftRowSeriesNumberColumnCount,s);return h.unshift(a-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._columns,h),this.columnTree.movePosition(o.start.row,o.start.col-this.leftRowSeriesNumberColumnCount,a-this.leftRowSeriesNumberColumnCount),this.columnTree.reset(this.columnTree.tree.children),this._cellRangeMap=new Map,{sourceIndex:o.start.col,targetIndex:a,sourceSize:s,targetSize:l.end.col-l.start.col+1,moveType:"column"}}if(this.isRowHeader(t.col,t.row)||this.isSeriesNumberInBody(t.col,t.row)&&this.transpose){this.isSeriesNumberInBody(t.col,t.row)&&(o=this.getCellRange(t.col+this.leftRowSeriesNumberColumnCount,t.row));const s=o.end.row-o.start.row+1;let a;const l=this.getCellRange(o.start.col,e.row);if(a=e.row>=t.row?l.end.row-s+1:l.start.row,a===o.start.row)return null;for(let u=0;u<this._headerCellIds.length;u++){const d=this._headerCellIds[u].splice(o.start.row,s);d.unshift(a,0),Array.prototype.splice.apply(this._headerCellIds[u],d)}const h=this._columns.splice(o.start.row,s);return h.unshift(a,0),Array.prototype.splice.apply(this._columns,h),this.columnTree.movePosition(o.start.col-this.leftRowSeriesNumberColumnCount,o.start.row,a+(e.row>t.row?o.end.row-o.start.row:0)),this.columnTree.reset(this.columnTree.tree.children),this._cellRangeMap=new Map,{sourceIndex:o.start.row,targetIndex:a,sourceSize:s,targetSize:l.end.row-l.start.row+1,moveType:"row"}}if(this.isSeriesNumberInBody(t.col,t.row))return{sourceIndex:t.row,targetIndex:e.row,sourceSize:1,targetSize:1,moveType:"row"}}return null}toggleHierarchyState(t){return{addCellPositions:t.add.map((e=>({col:0,row:this._table.columnHeaderLevelCount+e}))),removeCellPositions:t.remove.map((e=>({col:0,row:this._table.columnHeaderLevelCount+e})))}}setChartInstance(t,e,i){const r=this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount];typeof r.chartSpec!="function"&&(r.chartInstance=i)}getChartInstance(t,e){return(this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount]).chartInstance}checkHasChart(){return nct(this)}getAxisConfigInPivotChart(t,e){}isEmpty(t,e){return!1}isAxisCell(t,e){return!1}getChartAxes(t,e){return[]}isShareChartSpec(t,e){const i=this.getBody(t,e);return typeof i?.chartSpec!="function"}isNoChartDataRenderNothing(t,e){const i=this.getBody(t,e);return(i?.define).noDataRenderNothing}getChartSpec(t,e){return this.getRawChartSpec(t,e)}getRawChartSpec(t,e){const i=this.getBody(t,e),r=i?.chartSpec;return typeof r=="function"?r({col:t,row:e,dataValue:this._table.getCellOriginValue(t,e)||"",value:this._table.getCellValue(t,e)||"",rect:this._table.getCellRangeRelativeRect(this._table.getCellRange(t,e)),table:this._table}):r}getChartDataId(t,e){return ict(t,e,this)}release(){const t=this._table._getActiveChartInstance();t?.release(),this.columnObjects.forEach((e=>{var i;(i=e.chartInstance)===null||i===void 0||i.release()}))}clearCellRangeMap(){this._cellRangeMap.clear()}updateColumnTitle(t,e,i){const r=this._table.internalProps.layoutMap.getHeader(t,e);r.title=i,r.define.title=i}getColumnByField(t){var e;return(e=this.columnObjects)===null||e===void 0?void 0:e.reduce(((i,r,o)=>(r.field===t&&i.push({col:o,columnDefine:r}),i)),[])}getColumnByKey(t){var e;let i;return{columnDefine:(e=this.columnObjects)===null||e===void 0?void 0:e.find(((r,o)=>{var s;return((s=r.define)===null||s===void 0?void 0:s.key)===t&&(i=o+this.leftRowSeriesNumberColumnCount,!0)})),col:i}}getColumnDefine(t,e){if(t>=0)return t<this.leftRowSeriesNumberColumnCount?this.leftRowSeriesNumberColumn[t].define:this.transpose?this._columns[e].define:this._columns[t-this.leftRowSeriesNumberColumnCount].define}}class lct{constructor(t){this.isValidatingValue=!1,this.listenersId=[],this.table=t,this.bindEvent()}bindEvent(){const t=this.table,e=t.on(tt.DBLCLICK_CELL,(r=>{var o,s,a;const{editCellTrigger:l="doubleclick"}=t.options;if(!l.includes("doubleclick"))return;const{col:h,row:u}=r,d=Si(r.federatedEvent),c=t.scenegraph.getResizeColAt(d.abstractPos.x,d.abstractPos.y,(o=d.eventArgs)===null||o===void 0?void 0:o.targetCell);t._canResizeColumn(c.col,c.row)&&c.col>=0||!((a=(s=r.target)===null||s===void 0?void 0:s.attribute)===null||a===void 0)&&a.funcType||(this.beginTriggerEditCellMode="doubleclick",this.startEditCell(h,u))})),i=t.on(tt.CLICK_CELL,(r=>{var o,s;const{editCellTrigger:a="doubleclick"}=t.options;if(a==="click"||Array.isArray(a)&&a.includes("click")){if(!((s=(o=r.target)===null||o===void 0?void 0:o.attribute)===null||s===void 0)&&s.funcType)return;this.beginTriggerEditCellMode="click";const{col:l,row:h}=r;this.startEditCell(l,h)}}));this.listenersId.push(e,i)}startEditCell(t,e,i){var r,o,s,a,l,h,u,d,c;if(this.editingEditor)return;const g=this.table.getEditor(t,e);if(g){if(!((o=(r=this.table.internalProps.layoutMap)===null||r===void 0?void 0:r.isAggregation)===null||o===void 0)&&o.call(r,t,e)){const b=(a=(s=this.table).isPivotTable)===null||a===void 0?void 0:a.call(s),y=!!b&&((h=(l=this.table.internalProps)===null||l===void 0?void 0:l.dataConfig)===null||h===void 0?void 0:h.updateAggregationOnEditCell);if(!b||b&&y)return}const f=this.table.getCellRawRecord(t,e);if(f?.vtableMerge)return;this.editingEditor||(this.editCell={col:t,row:e}),this.table._makeVisibleCell(t,e),this.editingEditor=g;const p=$(i)?i:this.table.getCellOriginValue(t,e),m=this.table.getCellRangeRelativeRect(this.table.getCellRange(t,e)),v={rect:{left:m.left,top:m.top,width:m.width,height:m.height}};t===this.table.colCount-1?v.rect.width=m.width-1:v.rect.width=m.width+1,e===this.table.rowCount-1?v.rect.height=m.height-1:v.rect.height=m.height+1,g.beginEditing,(u=g.beginEditing)===null||u===void 0||u.call(g,this.table.getElement(),v,p),g.bindSuccessCallback,(d=g.bindSuccessCallback)===null||d===void 0||d.call(g,(()=>{this.completeEdit()})),(c=g.onStart)===null||c===void 0||c.call(g,{value:p,endEdit:()=>{this.completeEdit()},referencePosition:v,container:this.table.getElement(),col:t,row:e,table:this.table})}}completeEdit(t){var e,i;if(!this.editingEditor)return!0;if(this.isValidatingValue)return!1;const r=t?.target,{editingEditor:o}=this;if(r){if(o.targetIsOnEditor){if(o.targetIsOnEditor(r))return!1}else if(!o.isEditorElement||o.isEditorElement(r))return!1}if(this.editingEditor.getValue,this.editingEditor.validateValue){this.isValidatingValue=!0;const s=this.editingEditor.getValue(),a=this.table.getCellOriginValue(this.editCell.col,this.editCell.row),l=t?.target,h=(i=(e=this.editingEditor).validateValue)===null||i===void 0?void 0:i.call(e,s,a,this.editCell,this.table,!!this.table.getElement().contains(l));return fo(h)?(this.isValidatingValue=!0,new Promise(((u,d)=>{h.then((c=>{lP(c,this,a,u)})).catch((c=>{this.isValidatingValue=!1,d(c)}))}))):lP(h,this,a)}return this.doExit(),!0}doExit(){var t,e,i,r,o,s,a,l;const h=(e=(t=this.editingEditor).getValue)===null||e===void 0?void 0:e.call(t),u=this.table.getCellRange(this.editCell.col,this.editCell.row),d=[];for(let c=u.start.row;c<=u.end.row;c++){const g=[];for(let f=u.start.col;f<=u.end.col;f++)g.push(h);d.push(g)}(r=(i=this.editingEditor).beforeEnd)===null||r===void 0||r.call(i),this.table.changeCellValues(u.start.col,u.start.row,d),this.editingEditor.exit,(s=(o=this.editingEditor).exit)===null||s===void 0||s.call(o),(l=(a=this.editingEditor).onEnd)===null||l===void 0||l.call(a),this.editingEditor=null,this.isValidatingValue=!1,this.beginTriggerEditCellMode=null}cancelEdit(){var t,e,i,r;this.editingEditor&&((e=(t=this.editingEditor).exit)===null||e===void 0||e.call(t),(r=(i=this.editingEditor).onEnd)===null||r===void 0||r.call(i),this.editingEditor=null)}release(){this.listenersId.forEach((t=>{this.table.off(t)}))}}function lP(n,t,e,i){return t.isValidatingValue=!1,n==="validate-exit"?(t.doExit(),i?.(!0),!0):n==="invalidate-exit"?(t.editingEditor.setValue(e),t.doExit(),i?.(!0),!0):n==="validate-not-exit"||n==="invalidate-not-exit"?(i?.(!1),!1):n===!0?(t.doExit(),i?.(!0),!0):(i?.(!1),!1)}function hP(n,t){return Xe(n)?{groupByRules:[n],addRecordRule:t}:wt(n)?{groupByRules:n.map((e=>Xe(e)?e:e.key)),addRecordRule:t}:{addRecordRule:t}}var hct=function(n,t,e,i){return new(e||(e=Promise))((function(r,o){function s(h){try{l(i.next(h))}catch(u){o(u)}}function a(h){try{l(i.throw(h))}catch(u){o(u)}}function l(h){var u;h.done?r(h.value):(u=h.value,u instanceof e?u:new e((function(d){d(u)}))).then(s,a)}l((i=i.apply(n,t||[])).next())}))};function uct(n,t,e,i,r,o){if(i&&o.isHasEditorDefine(n,t)||i===!1){const s=o.getRecordShowIndexByCell(n,t),{field:a}=o.internalProps.layoutMap.getBody(n,t),l=o.getCellRawValue(n,t),h=o.getCellOriginValue(n,t);o.isHeader(n,t)?o.internalProps.layoutMap.updateColumnTitle(n,t,e):o.dataSource.changeFieldValue(e,s,a,n,t,o);const u=o.getCellRange(n,t),d=o.internalProps.layoutMap.getAggregatorsByCell(n,t);if(d){if(Array.isArray(d))for(let f=0;f<d?.length;f++)d[f].recalculate();else d.recalculate();const g=o.internalProps.layoutMap.getAggregatorCellAddress(u.start.col,u.start.row,u.end.col,u.end.row);for(let f=0;f<g.length;f++){const p=o.getCellRange(g[f].col,g[f].row);for(let m=p.start.col;m<=p.end.col;m++)for(let v=p.start.row;v<=p.end.row;v++)o.scenegraph.updateCellContent(m,v)}}for(let g=u.start.col;g<=u.end.col;g++)for(let f=u.start.row;f<=u.end.row;f++)o.scenegraph.updateCellContent(g,f);if(o.widthMode==="adaptive"||o.autoFillWidth&&o.getAllColsWidth()<=o.tableNoFrameWidth)o.internalProps._widthResizedColMap.size===0&&o.scenegraph.recalculateColWidths();else if(!o.internalProps._widthResizedColMap.has(n)){const g=o.getColWidth(n),f=Nh(n,0,o.rowCount-1,o,!1);f!==g&&o.scenegraph.updateColWidth(n,f-g)}if(o.heightMode==="adaptive"||o.autoFillHeight&&o.getAllRowsHeight()<=o.tableNoFrameHeight)o.internalProps._heightResizedRowMap.size===0&&o.scenegraph.recalculateRowHeights();else if(o.isAutoRowHeight(t)&&!o.internalProps._heightResizedRowMap.has(t)){const g=o.getRowHeight(t),f=Ar(t,0,o.colCount-1,o);o.scenegraph.updateRowHeight(t,f-g)}const c=o.getCellOriginValue(n,t);h!==c&&r&&o.fireListeners(tt.CHANGE_CELL_VALUE,{col:n,row:t,rawValue:l,currentValue:h,changedValue:c}),o.scenegraph.updateNextFrame()}}function dct(n,t,e,i,r,o){var s,a;return hct(this,void 0,void 0,(function*(){const l=[];let h=n,u=t;const d=[],c=[];let g;for(let v=0;v<e.length&&!(t+v>o.rowCount-1);v++){const b=e[v],y=[],C=[];d.push(y),c.push(C);for(let w=0;w<b.length&&!(n+w>o.colCount-1);w++){g=cct(n+w,t+v,o,g);const _=o.getCellRawValue(n+w,t+v);y.push(_);const A=o.getCellOriginValue(n+w,t+v);C.push(A)}}for(let v=0;v<e.length&&!(t+v>o.rowCount-1);v++){l[v]=[],u=t+v;const b=e[v];let y=n;for(let C=0;C<b.length&&!(n+C>o.colCount-1);C++){y=n+C;let w=!1;if(i===!1)w=!0;else if(o.isHasEditorDefine(n+C,t+v)){const _=o.getEditor(n+C,t+v),A=c[v][C],x=b[C],S=(a=(s=_?.validateValue)===null||s===void 0?void 0:s.call(_,x,A,{col:n+C,row:t+v},o))===null||a===void 0||a;if(fo(S)){const T=yield S;w=T===!0||T==="validate-exit"||T==="validate-not-exit"}else w=S===!0||S==="validate-exit"||S==="validate-not-exit"}if(w){l[v][C]=!0;const _=b[C],A=o.getRecordShowIndexByCell(n+C,t+v),{field:x}=o.internalProps.layoutMap.getBody(n+C,t+v),S=d[v][C],T=c[v][C];o.isHeader(n+C,t+v)?o.internalProps.layoutMap.updateColumnTitle(n+C,t+v,_):o.dataSource.changeFieldValue(_,A,x,n+C,t+v,o);const M=o.getCellOriginValue(n+C,t+v);T!==M&&r&&o.fireListeners(tt.CHANGE_CELL_VALUE,{col:n+C,row:t+v,rawValue:S,currentValue:T,changedValue:M})}else l[v][C]=!1}h=Math.max(h,y)}const f=o.getCellRange(n,t),p=o.getCellRange(h,u),m=o.internalProps.layoutMap.getAggregatorsByCellRange(f.start.col,f.start.row,p.end.col,p.end.row);if(m){for(let v=0;v<m?.length;v++)m[v].recalculate();if(g==="normal"){const v=o.internalProps.layoutMap.getAggregatorCellAddress(f.start.col,f.start.row,p.end.col,p.end.row);for(let b=0;b<v.length;b++){const y=o.getCellRange(v[b].col,v[b].row);for(let C=y.start.col;C<=y.end.col;C++)for(let w=y.start.row;w<=y.end.row;w++)o.scenegraph.updateCellContent(C,w)}}}if(g==="group"&&o.dataSource.updateRecordsForGroup([],[]),g==="sort"||g==="group")return o.dataSource.sortedIndexMap.clear(),Wn(o),o.refreshRowColCount(),o.internalProps.layoutMap.clearCellRangeMap(),o.scenegraph.clearCells(),o.scenegraph.createSceneGraph(),l;for(let v=f.start.col;v<=p.end.col;v++)for(let b=f.start.row;b<=p.end.row;b++)o.scenegraph.updateCellContent(v,b);if(o.widthMode==="adaptive"||o.autoFillWidth&&o.getAllColsWidth()<=o.tableNoFrameWidth)o.internalProps._widthResizedColMap.size===0&&o.scenegraph.recalculateColWidths();else for(let v=n;v<=p.end.col;v++)if(!o.internalProps._widthResizedColMap.has(v)){const b=o.getColWidth(v),y=Nh(v,0,o.rowCount-1,o,!1);y!==b&&o.scenegraph.updateColWidth(v,y-b)}if(o.heightMode==="adaptive"||o.autoFillHeight&&o.getAllRowsHeight()<=o.tableNoFrameHeight)o.scenegraph.recalculateRowHeights();else if(o.isAutoRowHeight(t)){const v=[],b=[];for(let y=t;y<=p.end.row;y++)if(o.rowHeightsMap.get(y)){const C=o.getRowHeight(y),w=Ar(y,0,o.colCount-1,o);v.push(y),b.push(w-C)}o.scenegraph.updateRowsHeight(v,b)}return o.scenegraph.updateNextFrame(),l}))}function cct(n,t,e,i){if(i==="group"||i==="sort"&&!e.internalProps.groupBy)return i;let r="normal";return e.internalProps.groupBy?r="group":!e.isHeader(n,t)&&e.dataSource.lastOrderField&&e.getBodyField(n,t)===e.dataSource.lastOrderField&&(r="sort"),r}function Wn(n){let t=n.sortState;t=!t||Array.isArray(t)?t:[t],t&&(t=t.map((e=>{var i;return e.orderFn=(i=n._getSortFuncFromHeaderOption(void 0,e.field))!==null&&i!==void 0?i:z0,e})),n.dataSource.sort(t))}function gct(n,t,e){var i,r,o,s;if(e.internalProps.groupBy)(r=(i=e.dataSource).addRecordsForGroup)===null||r===void 0||r.call(i,[n],t),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&Wn(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if(e.dataSource.rowHierarchyType==="tree")(s=(o=e.dataSource).addRecordsForTree)===null||s===void 0||s.call(o,[n],t),Bm(e,t,1),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&Wn(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if(e.sortState)e.dataSource.addRecordForSorted(n),e.stateManager.checkedState.clear(),Wn(e),e.refreshRowColCount(),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{(t===void 0||t>e.dataSource.sourceLength)&&(t=e.dataSource.sourceLength);const a=e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount;e.dataSource.addRecord(n,t),Bm(e,t,1);const l=e.rowCount;if(e.refreshRowColCount(),e.scenegraph.proxy.totalActualBodyRowCount===0)return e.scenegraph.clearCells(),void e.scenegraph.createSceneGraph();const h=e.transpose?e.colCount:e.rowCount;if(e.pagination){const{perPageCount:u,currentPage:d}=e.pagination,c=u*(d||0)+u;if(t<c)if(t<c-u)e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{const g=t-(c-u)+a;if(l-a===e.pagination.perPageCount){const f=[];for(let p=g;p<h;p++)e.transpose?f.push({col:p,row:0}):f.push({col:0,row:p});e.transpose?e.scenegraph.updateCol([],[],f):e.scenegraph.updateRow([],[],f)}else{const f=[];for(let p=g;p<Math.min(h,g+1);p++)e.transpose?f.push({col:p,row:0}):f.push({col:0,row:p});e.transpose?e.scenegraph.updateCol([],f,[]):e.scenegraph.updateRow([],f,[])}}}else{const u=[];for(let f=t+a;f<t+a+1;f++)e.transpose?u.push({col:f,row:0}):u.push({col:0,row:f});const d=[],c=e.internalProps.layoutMap.hasAggregationOnTopCount,g=e.internalProps.layoutMap.hasAggregationOnBottomCount;for(let f=a;f<a+c;f++)e.transpose?d.push({col:f,row:0}):d.push({col:0,row:f});for(let f=(e.transpose?e.colCount:e.rowCount)-g;f<(e.transpose?e.colCount:e.rowCount);f++)e.transpose?d.push({col:f,row:0}):d.push({col:0,row:f});e.transpose?e.scenegraph.updateCol([],u,[]):e.scenegraph.updateRow([],u,[])}}}function fct(n,t,e){var i,r,o,s;if(e.internalProps.groupBy)(r=(i=e.dataSource).addRecordsForGroup)===null||r===void 0||r.call(i,n,t),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&Wn(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if(e.dataSource.rowHierarchyType==="tree")(s=(o=e.dataSource).addRecordsForTree)===null||s===void 0||s.call(o,n,t),Bm(e,t,n.length),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&Wn(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if(e.sortState)e.dataSource.addRecordsForSorted(n),Wn(e),e.refreshRowColCount(),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{t===void 0||t>e.dataSource.sourceLength?t=e.dataSource.sourceLength:t<0&&(t=0);const a=e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount;e.dataSource.addRecords(n,t),Bm(e,t,n.length);const l=e.transpose?e.colCount:e.rowCount;if(e.refreshRowColCount(),e.scenegraph.proxy.totalActualBodyRowCount===0)return e.scenegraph.clearCells(),void e.scenegraph.createSceneGraph();const h=e.transpose?e.colCount:e.rowCount;if(e.pagination){const{perPageCount:u,currentPage:d}=e.pagination,c=u*(d||0)+u;if(t<c)if(t<c-u)e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{const g=t-(c-u)+a;if(l-a===e.pagination.perPageCount){const f=[];for(let p=g;p<h;p++)e.transpose?f.push({col:p,row:0}):f.push({col:0,row:p});e.transpose?e.scenegraph.updateCol([],[],f):e.scenegraph.updateRow([],[],f)}else{const f=[];for(let p=g;p<Math.min(h,g+(Array.isArray(n)?n.length:1));p++)e.transpose?f.push({col:p,row:0}):f.push({col:0,row:p});e.transpose?e.scenegraph.updateCol([],f,[]):e.scenegraph.updateRow([],f,[])}}}else{const u=[];for(let f=t+a;f<t+a+(Array.isArray(n)?n.length:1);f++)e.transpose?u.push({col:f,row:0}):u.push({col:0,row:f});const d=e.internalProps.layoutMap.hasAggregationOnTopCount,c=e.internalProps.layoutMap.hasAggregationOnBottomCount,g=[];for(let f=a;f<a+d;f++)e.transpose?g.push({col:f,row:0}):g.push({col:0,row:f});for(let f=(e.transpose?e.colCount:e.rowCount)-c;f<(e.transpose?e.colCount:e.rowCount);f++)e.transpose?g.push({col:f,row:0}):g.push({col:0,row:f});e.transpose?e.scenegraph.updateCol([],u,g):e.scenegraph.updateRow([],u,g)}}}function pct(n,t){var e,i,r,o,s,a,l,h;if(n?.length>0)if(t.internalProps.groupBy)(i=(e=t.dataSource).deleteRecordsForGroup)===null||i===void 0||i.call(e,n),t.refreshRowColCount(),t.internalProps.layoutMap.clearCellRangeMap(),t.sortState&&Wn(t),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else if(t.dataSource.rowHierarchyType==="tree"){const u=(o=(r=t.dataSource).deleteRecordsForTree)===null||o===void 0?void 0:o.call(r,n);if(u.length===0)return;for(let d=0;d<u.length;d++)uP(t,u[d],1);t.refreshRowColCount(),t.internalProps.layoutMap.clearCellRangeMap(),t.sortState&&Wn(t),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph()}else if(t.sortState)t.dataSource.deleteRecordsForSorted(n),Wn(t),t.refreshRowColCount(),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else{const u=t.dataSource.deleteRecords(n);if(u.length===0)return;for(let p=0;p<u.length;p++)uP(t,u[p],1);const d=t.transpose?t.colCount:t.rowCount;t.refreshRowColCount();const c=t.transpose?t.colCount:t.rowCount,g=u.sort(((p,m)=>p-m)),f=g[0];if(t.pagination){const{perPageCount:p,currentPage:m}=t.pagination,v=p*(m||0)+p;if(f<v)if(f<v-p)t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else{const b=t.transpose?t.rowHeaderLevelCount:t.columnHeaderLevelCount,y=t.internalProps.layoutMap.hasAggregationOnTopCount,C=[],w=[];for(let _=f-(v-p)+(t.transpose?t.rowHeaderLevelCount:t.columnHeaderLevelCount)+y;_<c;_++)t.transpose?C.push({col:_,row:0}):C.push({col:0,row:_});for(let _=b;_<b+y;_++)t.transpose?C.push({col:_,row:0}):C.push({col:0,row:_});if(c<d)for(let _=c;_<d;_++)t.transpose?w.push({col:_,row:0}):w.push({col:0,row:_});(s=t.reactCustomLayout)===null||s===void 0||s.clearCache(),t.transpose?t.scenegraph.updateCol(w,[],C):t.scenegraph.updateRow(w,[],C),(a=t.reactCustomLayout)===null||a===void 0||a.updateAllCustomCell()}}else{const p=[],m=t.transpose?t.rowHeaderLevelCount:t.columnHeaderLevelCount,v=t.internalProps.layoutMap.hasAggregationOnTopCount,b=t.internalProps.layoutMap.hasAggregationOnBottomCount;for(let C=0;C<g.length;C++){const w=g[C]+m+v;t.transpose?p.push({col:w,row:0}):p.push({col:0,row:w})}const y=[];for(let C=m;C<m+v;C++)t.transpose?y.push({col:C,row:0}):y.push({col:0,row:C});for(let C=(t.transpose?t.colCount:t.rowCount)-b;C<(t.transpose?t.colCount:t.rowCount);C++)t.transpose?y.push({col:C,row:0}):y.push({col:0,row:C});(l=t.reactCustomLayout)===null||l===void 0||l.clearCache(),t.transpose?t.scenegraph.updateCol(p,[],y):t.scenegraph.updateRow(p,[],y),(h=t.reactCustomLayout)===null||h===void 0||h.updateAllCustomCell()}}}function mct(n,t,e){var i,r,o,s;if(t?.length>0)if(e.internalProps.groupBy)(r=(i=e.dataSource).updateRecordsForGroup)===null||r===void 0||r.call(i,n,t),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&Wn(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if(e.dataSource.rowHierarchyType==="tree")(s=(o=e.dataSource).updateRecordsForTree)===null||s===void 0||s.call(o,n,t),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&Wn(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if(e.sortState)e.dataSource.updateRecordsForSorted(n,t),Wn(e),e.refreshRowColCount(),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{const a=e.dataSource.updateRecords(n,t);if(a.length===0)return;const l=a.map((h=>e.getBodyRowIndexByRecordIndex(h))).sort(((h,u)=>h-u));if(e.pagination){const{perPageCount:h,currentPage:u}=e.pagination,d=e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount,c=e.internalProps.layoutMap.hasAggregationOnTopCount,g=h*(u||0)+h,f=[];for(let p=0;p<l.length;p++){const m=l[p];if(m<g&&m>=g-h){const v=m-(g-h)+(e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount)+c;f.push(v)}}if(f.length>=1){const p=[];for(let m=0;m<f.length;m++){const v=f[m];e.transpose?p.push({col:v,row:0}):p.push({col:0,row:v})}for(let m=d;m<d+c;m++)e.transpose?p.push({col:m,row:0}):p.push({col:0,row:m});e.transpose?e.scenegraph.updateCol([],[],p):e.scenegraph.updateRow([],[],p)}}else{const h=[],u=e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount,d=e.internalProps.layoutMap.hasAggregationOnTopCount,c=e.internalProps.layoutMap.hasAggregationOnBottomCount;for(let g=0;g<l.length;g++){const f=l[g]+u+d;e.transpose?h.push({col:f,row:0}):h.push({col:0,row:f})}for(let g=u;g<u+d;g++)e.transpose?h.push({col:g,row:0}):h.push({col:0,row:g});for(let g=(e.transpose?e.colCount:e.rowCount)-c;g<(e.transpose?e.colCount:e.rowCount);g++)e.transpose?h.push({col:g,row:0}):h.push({col:0,row:g});e.transpose?e.scenegraph.updateCol([],[],h):e.scenegraph.updateRow([],[],h)}}}function uP(n,t,e){const{checkedState:i}=n.stateManager;if(i)if(n.dataSource.rowHierarchyType==="tree"){let r;r=dt(t)?[t]:t;const o=r.length,s=[];i.forEach(((a,l)=>{var h;const u=l.split(",");if(u.length>=r.length)for(let d=0;d<u.length;d++){const c=(h=r[d])!==null&&h!==void 0?h:-1,g=Number(u[d]);if(!(c===g&&d<u.length-1)){if(c===g&&d===u.length-1||c===-1){s.push({originKey:l,value:a});break}if(c<g&&d===o-1){u[d]=(g-e).toString(),s.push({originKey:l,targetKey:u.toString(),value:a});break}break}}})),s.sort(((a,l)=>{const h=a.originKey.split(","),u=l.originKey.split(","),d=h.length,c=u.length,g=Math.min(d,c);for(let f=0;f<g;f++){const p=Number(h[f]),m=Number(u[f]);if(p!==m)return p-m}return d-c})),s.forEach((({originKey:a,targetKey:l,value:h})=>{i.delete(a),l&&i.set(l,h)}))}else{const r=[],o=[];i.forEach(((s,a)=>{const l=Number(a);!isNaN(l)&&l>=t&&(l===t?r.push(a):l>t&&o.push({originKey:a,targetKey:(l-e).toString(),value:s}))})),r.forEach((s=>i.delete(s))),o.forEach((({originKey:s,targetKey:a,value:l})=>{i.delete(s),i.set(a,l)}))}}function Bm(n,t,e){const{checkedState:i}=n.stateManager;if(i)if(n.dataSource.rowHierarchyType==="tree"){let r;r=dt(t)?[t]:t;const o=r.length,s=[];i.forEach(((a,l)=>{var h;const u=l.split(",");if(u.length>=r.length)for(let d=0;d<u.length;d++){const c=(h=r[d])!==null&&h!==void 0?h:-1,g=Number(u[d]);if(c===g&&(d===u.length-1||d===o-1)){u[d]=(g+e).toString(),s.push({originKey:l,targetKey:u.toString(),value:a});break}if(!(c===g&&d<u.length-1)){if(c<g&&d===o-1){u[d]=(g+e).toString(),s.push({originKey:l,targetKey:u.toString(),value:a});break}break}}})),s.sort(((a,l)=>{const h=a.originKey.split(","),u=l.originKey.split(","),d=h.length,c=u.length,g=Math.min(d,c);for(let f=0;f<g;f++){const p=Number(h[f]),m=Number(u[f]);if(p!==m)return-p+m}return-d+c})),s.forEach((({originKey:a,targetKey:l,value:h})=>{i.delete(a),l&&i.set(l,h)}))}else for(let r=i.size-1;r>=t;r--){const o=i.get(r.toString());i.delete(r.toString()),i.set((r+e).toString(),o)}}function vct(n,t,e,i){const r=[{col:t,row:e}],o=[],s=[],{addCellPositions:a,removeCellPositions:l}=n,h=i.scenegraph.proxy,{rowStart:u,rowLimit:d}=h;let{rowEnd:c}=h,g=1/0;for(let m=0;m<a.length;m++){const{row:v}=a[m];c-u+1===d?v>=u&&v<=c&&(g=Math.min(g,v)):(o.push({col:t,row:v}),c++)}const f=Math.min(u+d,i.rowCount-1-i.bottomFrozenRowCount),p=f<u+d;for(let m=0;m<l.length;m++){const{row:v}=l[l.length-m-1];v<u||v>c||(v>f||p?(s.push({col:t,row:v}),g--):g=Math.min(g,v))}if(g!==1/0)for(let m=g;m<=c;m++)r.push({col:t,row:m});return i.scenegraph.proxy.refreshRowCount(),{updateCells:r,addCells:o,removeCells:s}}class bct extends Mdt{constructor(t,e){var i,r,o,s,a,l,h,u;super(t,e),this.showHeader=!0,e=this.options;const d=this.internalProps;if(d.frozenColDragHeaderMode=(r=(i=e.dragOrder)===null||i===void 0?void 0:i.frozenColDragHeaderMode)!==null&&r!==void 0?r:e.frozenColDragHeaderMode,this.pagination=e.pagination,d.sortState=e.sortState,d.multipleSort=!!e.multipleSort,d.dataConfig=this.internalProps.groupBy?hP(this.internalProps.groupBy,e.addRecordRule):{addRecordRule:e.addRecordRule},d.columns=e.columns?gh(e.columns,["children"]):e.header?gh(e.header,["children"]):[],wf(this),d.enableTreeNodeMerge=(s=(o=e.enableTreeNodeMerge)!==null&&o!==void 0?o:$(this.internalProps.groupBy))!==null&&s!==void 0&&s,this.internalProps.headerHelper.setTableColumnsEditor(),this.showHeader=(a=e.showHeader)===null||a===void 0||a,this.internalProps.columnWidthConfig=e.columnWidthConfig,this.transpose=(l=e.transpose)!==null&&l!==void 0&&l,te.mode!=="node"&&(this.editorManager=new lct(this)),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,e.dataSource?this.dataSource=e.dataSource:e.records?this.setRecords(e.records,{sortState:d.sortState}):this.setRecords([]),e.title){const c=St.getComponent("title");d.title=new c(e.title,this)}if(this.options.emptyTip)if(this.internalProps.emptyTip)(h=this.internalProps.emptyTip)===null||h===void 0||h.resetVisible();else{const c=St.getComponent("emptyTip");this.internalProps.emptyTip=new c(this.options.emptyTip,this),(u=this.internalProps.emptyTip)===null||u===void 0||u.resetVisible()}if(this.internalProps.enableTreeStickCell){const c=St.getComponent("listTreeStickCellPlugin");this.listTreeStickCellPlugin=new c(this)}setTimeout((()=>{this.isReleased||(this.resize(),this.fireListeners(tt.INITIALIZED,null))}),0)}isListTable(){return!0}isPivotTable(){return!1}isPivotChart(){return!1}get sortState(){return this.internalProps.sortState}get records(){var t;return(t=this.dataSource)===null||t===void 0?void 0:t.records}get recordsCount(){return this.dataSource.records.length}updateColumns(t,e){var i,r,o,s;this.scenegraph.clearCells();const a={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.columns=gh(t,["children"]),wf(this),e?.clearColWidthCache&&this.internalProps._widthResizedColMap.clear(),this.options.columns=t,this.internalProps.headerHelper.setTableColumnsEditor(),this._hasAutoImageColumn=void 0,this.refreshHeader(),(r=(i=this.dataSource).updateColumns)===null||r===void 0||r.call(i,this.internalProps.columns),this.records&&$2(this.internalProps.columns)&&this.dataSource.processRecords((s=(o=this.dataSource.dataSourceObj)===null||o===void 0?void 0:o.records)!==null&&s!==void 0?s:this.dataSource.dataSourceObj),this.internalProps.useOneRowHeightFillAll=!1,this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyBottomStyleCache=new Map,this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(a.col,a.row),this.renderAsync(),this.eventManager.updateEventBinder()}_recreateSceneForStateChange(){var t,e;this.scenegraph.clearCells();const i={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this._hasAutoImageColumn=void 0,this.refreshHeader(),this.records&&$2(this.internalProps.columns)&&this.dataSource.processRecords((e=(t=this.dataSource.dataSourceObj)===null||t===void 0?void 0:t.records)!==null&&e!==void 0?e:this.dataSource.dataSourceObj),this.internalProps.useOneRowHeightFillAll=!1,this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyBottomStyleCache=new Map,this._updateSize(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(i.col,i.row),this.renderAsync(),this.eventManager.updateEventBinder()}addColumn(t,e,i=!0){const r=this.options.columns;if(e===void 0)r.push(t);else{if(i)for(let o=0;o<r.length;o++)typeof r[o].field=="number"&&r[o].field>=e&&(r[o].field=r[o].field+1);r.splice(e,0,t)}if(i)for(let o=0;o<this.records.length;o++){const s=this.records[o];Array.isArray(s)&&s.splice(e,0,void 0)}this.updateColumns(r)}deleteColumn(t){const e=this.options.columns;e.splice(t,1),this.updateColumns(e)}get columns(){return this.internalProps.layoutMap.columnTree.getCopiedTree()}get header(){return this.internalProps.columns}set header(t){this.internalProps.columns=t,wf(this),this.options.header=t,this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.renderAsync()}get transpose(){var t;return(t=this.internalProps.transpose)!==null&&t!==void 0&&t}set transpose(t){this.internalProps.transpose!==t&&(this.internalProps.transpose=t,this.internalProps.layoutMap&&(this.internalProps.layoutMap.transpose=t,this.refreshRowColCount(),this._resetFrozenColCount(),this.renderAsync()))}getCellValue(t,e,i){var r;if(t===-1||e===-1)return null;if(!i){const l=this.getCustomMergeValue(t,e);if(l)return l}const o=this;if(o.internalProps.layoutMap.isSeriesNumber(t,e)){if(o.internalProps.layoutMap.isSeriesNumberInHeader(t,e)){const{title:u}=o.internalProps.layoutMap.getSeriesNumberHeader(t,e);return u}let l;if(this.internalProps.groupBy){const u=o.getCellRawRecord(t,e);if(u?.vtableMerge)return"";o.internalProps.layoutMap.isAggregation(t,e)||(l=this.dataSource.getGroupSeriesNumber(e-this.columnHeaderLevelCount))}else{const u=o.getBodyColumnDefine(t,e),d=o.getFieldData(u.field,t,e);l=["number","string"].includes(typeof d)?d:d?.text?(r=d.text)!==null&&r!==void 0?r:"":e-this.columnHeaderLevelCount+1}const{format:h}=o.internalProps.layoutMap.getSeriesNumberBody(t,e);return typeof h=="function"?h(t,e,this,l):l}if(o.internalProps.layoutMap.isHeader(t,e)){const{title:l}=o.internalProps.layoutMap.getHeader(t,e);return typeof l=="function"?l():l}if(o.internalProps.layoutMap.isAggregation(t,e)){if(o.internalProps.layoutMap.isTopAggregation(t,e)){const l=o.internalProps.layoutMap.getAggregatorOnTop(t,e);return l?.formatValue?l.formatValue(t,e,this):""}if(o.internalProps.layoutMap.isBottomAggregation(t,e)){const l=o.internalProps.layoutMap.getAggregatorOnBottom(t,e);return l?.formatValue?l.formatValue(t,e,this):""}}const{field:s,fieldFormat:a}=o.internalProps.layoutMap.getBody(t,e);return o.getFieldData(a||s,t,e)}getCellOriginValue(t,e){if(t===-1||e===-1)return null;const i=this;if(i.internalProps.layoutMap.isSeriesNumber(t,e)){if(i.internalProps.layoutMap.isSeriesNumberInHeader(t,e)){const{title:s}=i.internalProps.layoutMap.getSeriesNumberHeader(t,e);return s}const{format:o}=i.internalProps.layoutMap.getSeriesNumberBody(t,e);return typeof o=="function"?o(t,e,this):e-this.columnHeaderLevelCount}if(i.internalProps.layoutMap.isHeader(t,e)){const{title:o}=i.internalProps.layoutMap.getHeader(t,e);return typeof o=="function"?o():o}if(i.internalProps.layoutMap.isAggregation(t,e)){if(i.internalProps.layoutMap.isTopAggregation(t,e)){const o=i.internalProps.layoutMap.getAggregatorOnTop(t,e);return o?.value()}if(i.internalProps.layoutMap.isBottomAggregation(t,e)){const o=i.internalProps.layoutMap.getAggregatorOnBottom(t,e);return o?.value()}}const{field:r}=i.internalProps.layoutMap.getBody(t,e);return i.getFieldData(r,t,e)}getCellRawValue(t,e){if(t===-1||e===-1)return null;const i=this;if(i.internalProps.layoutMap.isHeader(t,e)){const{title:o}=i.internalProps.layoutMap.getHeader(t,e);return typeof o=="function"?o():o}const{field:r}=i.internalProps.layoutMap.getBody(t,e);return i.getRawFieldData(r,t,e)}getRecordShowIndexByCell(t,e){const{layoutMap:i}=this.internalProps;return i.getRecordShowIndexByCell(t,e)}getRecordIndexByCell(t,e){const{layoutMap:i}=this.internalProps,r=i.getRecordShowIndexByCell(t,e);return this.dataSource.getRecordIndexPaths(r)}getTableIndexByRecordIndex(t){return this.transpose?this.dataSource.getTableIndex(t)+this.rowHeaderLevelCount:this.dataSource.getTableIndex(t)+this.columnHeaderLevelCount}getTableIndexByField(t){const e=this.internalProps.layoutMap.columnObjects.find((r=>r.field===t));if(!e)return-1;const i=this.internalProps.layoutMap.getBodyLayoutRangeById(e.id);return this.transpose?i.start.row:i.start.col}getCellAddrByFieldRecord(t,e){return this.transpose?{col:this.getTableIndexByRecordIndex(e),row:this.getTableIndexByField(t)}:{col:this.getTableIndexByField(t),row:this.getTableIndexByRecordIndex(e)}}getCellOriginRecord(t,e){const i=this,r=i.getRecordShowIndexByCell(t,e);if(r>-1)return i.dataSource.get(r)}getCellRawRecord(t,e){const i=this,r=i.getRecordShowIndexByCell(t,e);if(r>-1)return i.dataSource.getRaw(r)}_canResizeColumn(t,e){const i=super._canResizeColumn(t,e);if(i&&!this.transpose){const r=this.internalProps.layoutMap.getBody(t,this.columnHeaderLevelCount),o=this.internalProps.layoutMap.isSeriesNumber(t,e);if(r?.disableColumnResize||o&&this.internalProps.rowSeriesNumber.disableColumnResize===!0)return!1}return i}updateOption(t,e={clearColWidthCache:!0,clearRowHeightCache:!0}){var i,r,o,s,a,l,h,u,d;const c=this.internalProps;if(super.updateOption(t,e),c.frozenColDragHeaderMode=(r=(i=t.dragOrder)===null||i===void 0?void 0:i.frozenColDragHeaderMode)!==null&&r!==void 0?r:t.frozenColDragHeaderMode,this.pagination=t.pagination,c.sortState=t.sortState,c.dataConfig=this.internalProps.groupBy?hP(this.internalProps.groupBy,t.addRecordRule):{addRecordRule:t.addRecordRule},this.showHeader=(o=t.showHeader)===null||o===void 0||o,c.columns=t.columns?gh(t.columns,["children"]):t.header?gh(t.header,["children"]):[],wf(this),c.enableTreeNodeMerge=(a=(s=t.enableTreeNodeMerge)!==null&&s!==void 0?s:$(this.internalProps.groupBy))!==null&&a!==void 0&&a,this.internalProps.headerHelper.setTableColumnsEditor(),this.transpose=(l=t.transpose)!==null&&l!==void 0&&l,this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.internalProps.columnWidthConfig=t.columnWidthConfig,c.releaseList)for(let g=c.releaseList.length-1;g>=0;g--){const f=c.releaseList[g];f instanceof Ss?f.updateColumns(this.internalProps.columns):((h=f?.release)===null||h===void 0||h.call(f),c.releaseList.splice(g,1))}if(t.dataSource&&this.dataSource!==t.dataSource?this.dataSource=t.dataSource:t.records?this.setRecords(t.records,{sortState:t.sortState}):(this.refreshRowColCount(),this._resetFrozenColCount(),this.scenegraph.createSceneGraph(),this.render()),t.title){const g=St.getComponent("title");c.title=new g(t.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)(u=this.internalProps.emptyTip)===null||u===void 0||u.resetVisible();else{const g=St.getComponent("emptyTip");this.internalProps.emptyTip=new g(this.options.emptyTip,this),(d=this.internalProps.emptyTip)===null||d===void 0||d.resetVisible()}return this.pluginManager.updatePlugins(t.plugins),setTimeout((()=>{this.fireListeners(tt.UPDATED,null)}),0),new Promise((g=>{setTimeout(g,0)}))}updatePagination(t){this.pagination&&(typeof t.currentPage=="number"&&t.currentPage>=0&&(this.pagination.currentPage=t.currentPage),t.perPageCount&&(this.pagination.perPageCount=t.perPageCount||this.pagination.perPageCount),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.dataSource.updatePagination(this.pagination),this.refreshRowColCount(),this.stateManager.initCheckedState(this.records),this.scenegraph.createSceneGraph(),this.renderAsync())}refreshHeader(){var t;const e=this.internalProps,i=this.transpose,r=this.showHeader;(e.layoutMap=new act(this,(t=e.columns)!==null&&t!==void 0?t:[],r,this.options.hierarchyIndent)).transpose=i,i||this.setMinMaxLimitWidth(!0),this.refreshRowColCount()}refreshRowColCount(){var t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b;const y=this,{layoutMap:C}=y.internalProps;if(!C)return;const w=(e=(t=y.internalProps.dataSource)===null||t===void 0?void 0:t.length)!==null&&e!==void 0?e:0;C.recordsCount=w+(w>0||this.options.showAggregationWhenEmpty?C.hasAggregationOnTopCount+C.hasAggregationOnBottomCount:0),y.transpose?(y.rowCount=(i=C.rowCount)!==null&&i!==void 0?i:0,y.colCount=(r=C.colCount)!==null&&r!==void 0?r:0,this.internalProps.frozenColCount=Math.max(((o=C.headerLevelCount)!==null&&o!==void 0?o:0)+C.leftRowSeriesNumberColumnCount,(s=this.options.frozenColCount)!==null&&s!==void 0?s:0),this.internalProps.frozenRowCount=(a=this.options.frozenRowCount)!==null&&a!==void 0?a:0,y.bottomFrozenRowCount!==((l=this.options.bottomFrozenRowCount)!==null&&l!==void 0?l:0)&&(y.bottomFrozenRowCount=(h=this.options.bottomFrozenRowCount)!==null&&h!==void 0?h:0),y.rightFrozenColCount!==((u=this.options.rightFrozenColCount)!==null&&u!==void 0?u:0)&&(y.rightFrozenColCount=(d=this.options.rightFrozenColCount)!==null&&d!==void 0?d:0)):(y.colCount=(c=C.colCount)!==null&&c!==void 0?c:0,y.rowCount=C.recordsCount*C.bodyRowSpanCount+C.headerLevelCount,this.internalProps.frozenColCount=(g=this.options.frozenColCount)!==null&&g!==void 0?g:0,this.options.frozenColCount>=this.colCount&&(this.internalProps.frozenColCount=0),y._setFrozenRowCount(Math.max(C.headerLevelCount,(f=this.options.frozenRowCount)!==null&&f!==void 0?f:0)),y.bottomFrozenRowCount!==((p=this.options.bottomFrozenRowCount)!==null&&p!==void 0?p:0)&&(y.bottomFrozenRowCount=(m=this.options.bottomFrozenRowCount)!==null&&m!==void 0?m:0),y.rightFrozenColCount!==((v=this.options.rightFrozenColCount)!==null&&v!==void 0?v:0)&&(y.rightFrozenColCount=(b=this.options.rightFrozenColCount)!==null&&b!==void 0?b:0)),this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}getFieldData(t,e,i){if(t===null||this.internalProps.layoutMap.isHeader(e,i))return null;const r=this.getRecordShowIndexByCell(this.transpose?e-this.internalProps.layoutMap.leftRowSeriesNumberColumnCount:e,i);return this.internalProps.dataSource.getField(r,t,e,i,this)}getRawFieldData(t,e,i){if(t===null||this.internalProps.layoutMap.isHeader(e,i))return null;const r=this.getRecordShowIndexByCell(e,i);return this.internalProps.dataSource.getRawField(r,t,e,i,this)}_moveHeaderPosition(t,e){const i=this.getCellRange(t.col,t.row),r=this.getCellRange(e.col,e.row),o=this.internalProps.layoutMap.moveHeaderPosition(t,e);return o?(o.moveType==="column"?(this.colWidthsMap.exchangeOrder(i.start.col,i.end.col-i.start.col+1,r.start.col,r.end.col-r.start.col+1,o.targetIndex),this.transpose||(this.colWidthsLimit={},this.setMinMaxLimitWidth())):o.targetIndex>o.sourceIndex?this.rowHeightsMap.exchangeOrder(o.sourceIndex,o.sourceSize,o.targetIndex+o.sourceSize-o.targetSize,o.targetSize,o.targetIndex):this.rowHeightsMap.exchangeOrder(o.sourceIndex,o.sourceSize,o.targetIndex,o.targetSize,o.targetIndex),o):null}changeRecordOrder(t,e){this.transpose?(t=this.getRecordShowIndexByCell(t,0),e=this.getRecordShowIndexByCell(e,0)):(t=this.getRecordShowIndexByCell(0,t),e=this.getRecordShowIndexByCell(0,e)),this.dataSource.changeOrder(t,e)}getCellAddress(t,e){let i;for(let o=0;o<this.internalProps.records.length;o++){const s=this.internalProps.records[o];if(typeof t=="function")t(s)&&(i=o);else{let a=!0;for(const l in t)if(s[l]!==t[l]){a=!1;break}a&&(i=o)}if($(i))break}const r=this.getCellRangeByField(e,i);if(r)return{row:r.start.row,col:r.start.col}}getCellRangeByField(t,e){const{layoutMap:i}=this.internalProps,r=i.columnObjects.find((o=>o.field===t));if(r){const o=i.getBodyLayoutRangeById(r.id);let s;return $(e)&&(s=i.getRecordStartRowByRecordIndex(e)),this.transpose?{start:{row:o.start.row,col:$(s)?s+o.start.col:void 0},end:{row:o.end.row,col:$(s)?s+o.end.col:void 0}}:{start:{col:o.start.col,row:$(s)?s+o.start.row:void 0},end:{col:o.end.col,row:$(s)?s+o.end.row:void 0}}}return null}getHierarchyState(t,e){var i;if(this.isHeader(t,e))return(i=this._getHeaderLayoutMap(t,e))===null||i===void 0?void 0:i.hierarchyState;if((!this.internalProps.groupBy||wt(this.internalProps.groupBy)&&this.internalProps.groupBy.length===0)&&!this.getBodyColumnDefine(t,e).tree)return Tt.none;const r=this.getRecordShowIndexByCell(t,e);return this.dataSource.getHierarchyState(r)}getRecordHierarchyState(t,e){let i;return this.transpose?this.getRecordShowIndexByCell(t,0):i=this.getRecordShowIndexByCell(0,e),this.dataSource.getHierarchyState(i)}toggleHierarchyState(t,e,i=!0){this.stateManager.updateHoverIcon(t,e,void 0,void 0);const r=this.getHierarchyState(t,e);if(this.isHeader(t,e)){const o=this.internalProps.layoutMap.getHeader(t,e),{hierarchyState:s,define:a}=o;if(![Tt.collapse,Tt.expand].includes(s)||!a)return;const l=a.columns;if(Array.isArray(l)&&l.length>0){const h=s===Tt.expand?Tt.collapse:Tt.expand;o.hierarchyState=h,o.define.hierarchyState=h,this.updateColumns(this.internalProps.columns)}this.fireListeners(tt.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:r,originData:o,cellLocation:this.getCellLocation(t,e)})}else if(r===Tt.expand)this._refreshHierarchyState(t,e,i),this.fireListeners(tt.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:Tt.collapse});else if(r===Tt.collapse){const o=this.getCellOriginRecord(t,e);Array.isArray(o.children)&&this._refreshHierarchyState(t,e,i),this.fireListeners(tt.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:Tt.expand,originData:o})}}setLoadingHierarchyState(t,e){this.scenegraph.setLoadingHierarchyState(t,e)}_refreshHierarchyState(t,e,i=!0){var r,o;let s=!1,a=!1;const l=this.internalProps.layoutMap.checkHasChart();l&&(this.autoFillWidth&&(s=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&(a=this.getAllRowsHeight()<=this.tableNoFrameHeight));const h=this.getRecordShowIndexByCell(t,e),u=this.dataSource.toggleHierarchyState(h,this.scenegraph.proxy.rowStart-this.columnHeaderLevelCount,Math.max(this.scenegraph.proxy.rowEnd-this.columnHeaderLevelCount,this.scenegraph.proxy.rowStart-this.columnHeaderLevelCount+this.scenegraph.proxy.rowLimit-1)),d=this.internalProps.layoutMap.toggleHierarchyState(u);this.refreshRowColCount();for(let p=this.rowCount-this.bottomFrozenRowCount;p<this.rowCount;p++){const m=Ar(p,0,this.colCount-1,this);this._setRowHeight(p,m)}this.clearCellStyleCache(),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1;const{updateCells:c,addCells:g,removeCells:f}=vct(d,t,e,this);(r=this.reactCustomLayout)===null||r===void 0||r.clearCache(),this.scenegraph.updateRow(f,g,c,i,!0),(o=this.reactCustomLayout)===null||o===void 0||o.updateAllCustomCell(),l&&(this.autoFillWidth&&!s&&(s=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&!a&&(a=this.getAllRowsHeight()<=this.tableNoFrameHeight),(this.widthMode==="adaptive"||s||this.heightMode==="adaptive"||a)&&this.scenegraph.updateChartSizeForResizeColWidth(-1))}_hasHierarchyTreeHeader(){var t,e;return(e=(t=this.options.columns)!==null&&t!==void 0?t:this.options.header)===null||e===void 0?void 0:e.some(((i,r)=>i.tree))}getMenuInfo(t,e,i){return{field:this.getHeaderField(t,e),value:this.getCellValue(t,e),cellLocation:this.getCellLocation(t,e),event:void 0}}_getSortFuncFromHeaderOption(t,e,i){if(t||(t=this.internalProps.columns),e&&t&&t.length>0)for(let r=0;r<t.length;r++){const o=t[r];if((i&&i===o.fieldKey||!i&&o.field===e)&&o.sort&&typeof o.sort=="function")return o.sort;if(o.columns){const s=this._getSortFuncFromHeaderOption(o.columns,e,i);if(s)return s}}}updateSortState(t,e=!0){var i;if(t)this.internalProps.sortState=t;else if(this.internalProps.sortState)if(Array.isArray(this.internalProps.sortState))for(let r=0;r<this.internalProps.sortState.length;r++)(t=(i=this.internalProps.sortState)===null||i===void 0?void 0:i[r])&&(t.order="normal");else this.internalProps.sortState.order="normal",t=this.internalProps.sortState;(t=Array.isArray(t)?t:[t]).some((r=>r.field))&&e&&this.internalProps.layoutMap.headerObjects.some((r=>r.define.sort!==!1))&&(this.dataSource.sort(t.map((r=>{const o=this._getSortFuncFromHeaderOption(this.internalProps.columns,r.field);return this.internalProps.layoutMap.headerObjects.find((s=>s&&s.field===r.field)),{field:r.field,order:r.order,orderFn:o??z0}}))),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.sortCell()),t.length&&this.stateManager.updateSortState(t)}updateFilterRules(t){this.scenegraph.clearCells(),this.sortState?(this.dataSource.updateFilterRulesForSorted(t),Wn(this)):this.dataSource.updateFilterRules(t),this.refreshRowColCount(),this.stateManager.initCheckedState(this.records),this.scenegraph.createSceneGraph(),this.resize()}getCheckboxState(t){if(this.stateManager.checkedState.size<this.rowCount-this.columnHeaderLevelCount&&this.stateManager.initLeftRecordsCheckState(this.records),$(t)){let e=Array.from(this.stateManager.checkedState.keys()).sort(((i,r)=>{var o,s;const a=i.split(","),l=r.split(","),h=Math.max(a.length,l.length);for(let u=0;u<h;u++){const d=(o=Number(a[u]))!==null&&o!==void 0?o:0,c=(s=Number(l[u]))!==null&&s!==void 0?s:0;if(d!==c)return d-c}return 0})).map((i=>this.stateManager.checkedState.get(i)));return this.options.groupBy&&(e=Qht(this)),Array.from(e,(i=>i&&i[t]))}return new Array(...this.stateManager.checkedState.values())}getCellCheckboxState(t,e){var i;const r=this.getBodyColumnDefine(t,e),o=r?.field,s=this.getCellType(t,e);if($(o)&&(s==="checkbox"||s==="switch")){const a=this.dataSource.getIndexKey(this.getRecordShowIndexByCell(t,e)).toString();return(i=this.stateManager.checkedState.get(a))===null||i===void 0?void 0:i[o]}}getRadioState(t){return $(t)?this.stateManager.radioState[t]:this.stateManager.radioState}getCellRadioState(t,e){return Wht(t,e,this)}setCellCheckboxState(t,e,i){Zht(t,e,i,this)}setCellRadioState(t,e,i){Vht(t,e,i,this)}getSwitchState(t){return this.getCheckboxState(t)}getCellSwitchState(t,e){return this.getCellCheckboxState(t,e)}setCellSwitchState(t,e,i){this.setCellCheckboxState(t,e,i)}setRecords(t,e){var i,r,o,s;let a;a1(),(i=this.internalProps.dataSource)===null||i===void 0||i.release(),this.internalProps.releaseList=(r=this.internalProps.releaseList)===null||r===void 0?void 0:r.filter((h=>!h.dataSourceObj)),this.internalProps.dataSource=null,Array.isArray(e)||e?.order?a=e:e?a=e.sortState:e===null&&(a=null),typeof window<"u"&&window.performance.now();const l={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};if(this.scenegraph.clearCells(),a!==void 0&&(a===null||!Array.isArray(a)&&$(a.field)||Array.isArray(a))&&(this.internalProps.sortState=this.internalProps.multipleSort?Array.isArray(a)?a:[a]:a,this.stateManager.setSortState(this.sortState)),t){if(G2(this,t),this.sortState){const h=Array.isArray(this.sortState)?this.sortState:[this.sortState];h.some((u=>u.order&&u.field&&u.order!=="normal"))&&this.internalProps.layoutMap.headerObjectsIncludeHided.some((u=>u.define.sort!==!1))&&this.dataSource.sort(h.map((u=>{const d=this._getSortFuncFromHeaderOption(void 0,u.field);return this.internalProps.layoutMap.headerObjectsIncludeHided.find((c=>c&&c.field===u.field)),{field:u.field,order:u.order||"asc",orderFn:d??z0}})))}this.refreshRowColCount()}else G2(this,t);if(this.stateManager.initCheckedState(t),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(l.col,l.row),this._updateSize(),this.internalProps.title&&!this.internalProps.title.isReleased&&this.internalProps.title.resize(),this.scenegraph.resize(),this.options.emptyTip)if(this.internalProps.emptyTip)(o=this.internalProps.emptyTip)===null||o===void 0||o.resetVisible();else{const h=St.getComponent("emptyTip");this.internalProps.emptyTip=new h(this.options.emptyTip,this),(s=this.internalProps.emptyTip)===null||s===void 0||s.resetVisible()}this.render(),$(l.col)&&$(l.row)&&l.col>=0&&l.row>=0&&setTimeout((()=>{var h;(h=this.internalProps)===null||h===void 0||h.tooltipHandler.showTooltip(l.col,l.row)}),0)}setRecordChildren(t,e,i,r=!0){const o=this.getCellOriginRecord(e,i);o.children=t;const s=this.getRecordShowIndexByCell(e,i);this.dataSource.setRecord(o,s),this._refreshHierarchyState(e,i,r)}startEditCell(t,e,i){var r;if($(t)&&$(e))this.eventManager.isDraging=!1,this.selectCell(t,e),this.editorManager.startEditCell(t,e,i);else if(!((r=this.stateManager.select)===null||r===void 0)&&r.cellPos){const{col:o,row:s}=this.stateManager.select.cellPos;$(o)&&$(s)&&this.editorManager.startEditCell(o,s,i)}}completeEditCell(){this.editorManager.completeEdit()}getEditor(t,e){var i,r;const o=this.getBodyColumnDefine(t,e);let s=this.isHeader(t,e)?(i=o?.headerEditor)!==null&&i!==void 0?i:this.options.headerEditor:(r=o?.editor)!==null&&r!==void 0?r:this.options.editor;return typeof s=="function"&&(s=s({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})),typeof s=="string"?kdt(s):s}isHasEditorDefine(t,e){var i,r;const o=this.getBodyColumnDefine(t,e);let s=this.isHeader(t,e)?(i=o?.headerEditor)!==null&&i!==void 0?i:this.options.headerEditor:(r=o?.editor)!==null&&r!==void 0?r:this.options.editor;return typeof s=="function"&&(s=s({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})),$(s)}changeCellValue(t,e,i,r=!1,o=!0){return uct(t,e,i,r,o,this)}changeCellValues(t,e,i,r=!1,o=!0){return dct(t,e,i,r,o,this)}addRecord(t,e){var i;gct(t,e,this),(i=this.internalProps.emptyTip)===null||i===void 0||i.resetVisible()}addRecords(t,e){var i;fct(t,e,this),(i=this.internalProps.emptyTip)===null||i===void 0||i.resetVisible()}deleteRecords(t){var e;pct(t,this),(e=this.internalProps.emptyTip)===null||e===void 0||e.resetVisible()}updateRecords(t,e){mct(t,e,this)}_hasCustomRenderOrLayout(){var t,e,i,r;const{headerObjects:o}=this.internalProps.layoutMap;if(this.options.customRender)return!0;for(let s=0;s<o.length;s++){const a=o[s];if(!((t=a?.define)===null||t===void 0)&&t.customLayout||!((e=a?.define)===null||e===void 0)&&e.headerCustomLayout||!((i=a?.define)===null||i===void 0)&&i.customRender||!((r=a?.define)===null||r===void 0)&&r.headerCustomRender)return!0}return!1}getAggregateValuesByField(t){const e=this.internalProps.layoutMap.getColumnByField(t),i=[];for(let r=0;r<e.length;r++){const o=e[r].columnDefine.aggregator;if(delete e[r].columnDefine,o){const s={col:e[r].col,aggregateValue:null};if(s.aggregateValue=[],Array.isArray(o))for(let a=0;a<o.length;a++)s.aggregateValue.push({aggregationType:o[a].type,value:o[a].value()});else s.aggregateValue.push({aggregationType:o.type,value:o.value()});i.push(s)}}return i}isAggregation(t,e){return this.internalProps.layoutMap.isAggregation(t,e)}getGroupTitleLevel(t,e){var i;if(!this.internalProps.groupBy)return;const r=this.dataSource.getIndexKey(this.getRecordShowIndexByCell(t,e)),o=(i=this.dataSource.getGroupLength())!==null&&i!==void 0?i:0;let s=wt(r)?r.length-1:0;return o>0&&s===o&&(s=void 0),s}getBodyRowIndexByRecordIndex(t){return Array.isArray(t)&&t.length===1&&(t=t[0]),this.dataSource.getTableIndex(t)}release(){var t;(t=this.editorManager)===null||t===void 0||t.release(),super.release()}expandAllTreeNode(){if(!this._hasHierarchyTreeHeader())return;let t=!1;this.dataSource&&typeof this.dataSource.expandAllNodes=="function"&&(this.dataSource.expandAllNodes(),t=!0),t&&(this._recreateSceneForStateChange(),this.fireListeners(tt.TREE_HIERARCHY_STATE_CHANGE,{col:-1,row:-1,hierarchyState:Tt.expand,originData:{children:this.records}}))}collapseAllTreeNode(){if(!this._hasHierarchyTreeHeader())return;let t=!1;this.dataSource&&typeof this.dataSource.collapseAllNodes=="function"&&(this.dataSource.collapseAllNodes(),t=!0),t&&(this._recreateSceneForStateChange(),this.fireListeners(tt.TREE_HIERARCHY_STATE_CHANGE,{col:-1,row:-1,hierarchyState:Tt.collapse,originData:{children:this.records}}))}mergeCells(t,e,i,r){for(let o=t;o<=i;o++)for(let s=e;s<=r;s++){const a=this.getCellRange(o,s);if(a.start.col!==a.end.col||a.start.row!==a.end.row)return}this.options.customMergeCell?typeof this.options.customMergeCell=="function"&&(this.options.customMergeCell=[]):this.options.customMergeCell=[],this.options.customMergeCell.push({text:this.getCellValue(t,e),range:{start:{col:t,row:e},end:{col:i,row:r}}}),this.internalProps.customMergeCell=Mm(this.options.customMergeCell);for(let o=t;o<=i;o++)for(let s=e;s<=r;s++)this.scenegraph.updateCellContent(o,s);this.scenegraph.updateNextFrame()}unmergeCells(t,e,i,r){this.options.customMergeCell?typeof this.options.customMergeCell=="function"&&(this.options.customMergeCell=[]):this.options.customMergeCell=[],this.options.customMergeCell=this.options.customMergeCell.filter((o=>{const{start:s,end:a}=o.range;return!(s.col===t&&s.row===e&&a.col===i&&a.row===r)})),this.internalProps.customMergeCell=Mm(this.options.customMergeCell);for(let o=t;o<=i;o++)for(let s=e;s<=r;s++)this.scenegraph.updateCellContent(o,s);this.scenegraph.updateNextFrame()}}function f1(n){return n==="bottom"||n==="top"}function yct(n){return n==="left"||n==="right"}const NF=(n,t)=>Object.prototype.toString.call(n)===`[object ${t}]`,Cct=n=>typeof n=="function",hn=n=>n==null,Ri=n=>n!=null,WF=n=>Array.isArray?Array.isArray(n):NF(n,"Array"),yr=(n,t=!1)=>{const e=typeof n;return t?e==="number":e==="number"||NF(n,"Number")};function _ct(n){if(!n)return[];if(Object.keys)return Object.keys(n);const t=[];for(const e in n)n.hasOwnProperty(e)&&t.push(e);return t}function wct(n,t,e){const i=_ct(t);for(let r=0;r<i.length;r++){const o=i[r];(e?t[o]!=null:n[o]==null)&&(n[o]=t[o])}return n}function jF(n,t,e=!0){if(n="prototype"in n?n.prototype:n,t="prototype"in t?t.prototype:t,Object.getOwnPropertyNames){const i=Object.getOwnPropertyNames(t);for(let r=0;r<i.length;r++){const o=i[r];o!=="constructor"&&(e?t[o]!=null:n[o]==null)&&(n[o]=t[o])}}else wct(n,t,e)}function xct(n,t,e){Ri(t)||(t=n,n=0),Ri(e)||(e=1);let i=-1;const r=0|Math.max(0,Math.ceil((t-n)/e)),o=new Array(r);for(;++i<r;)o[i]=n+i*e;return o}function Sct(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function Rd(n){return Number(n)}function Act(n,t,e=0,i){for(hn(i)&&(i=n.length);e<i;){const r=e+i>>>1;Sct(n[r],t)>0?i=r:e=r+1}return e}const Mct=1e-10,Tct=1e-10;function VF(n,t,e=Tct,i=Mct){const r=i,o=e*Math.max(n,t);return Math.abs(n-t)<=Math.max(r,o)}function dP(n,t,e,i){return n>t&&!VF(n,t,e,i)}function cP(n,t,e,i){return n<t&&!VF(n,t,e,i)}const Cg=n=>{let t=null,e=null;return(...i)=>(t&&i.every(((r,o)=>r===t[o]))||(t=i,e=n(...i)),e)},GF=function(n,t,e){return n<t?t:n>e?e:n};function uS(n,t){let e;return n>t&&(e=n,n=t,t=e),i=>Math.max(n,Math.min(t,i))}function tp(n,t){return e=>n*(1-e)+t*e}function Rct(n,t){return function(e){return Math.round(n*(1-e)+t*e)}}function Bct(n,t){const e=n.valueOf(),i=t.valueOf(),r=new Date;return o=>(r.setTime(e*(1-o)+i*o),r)}function p1(n,t,e){t/=100,e/=100;const i=(1-Math.abs(2*e-1))*t,r=i*(1-Math.abs(n/60%2-1)),o=e-i/2;let s=0,a=0,l=0;return 0<=n&&n<60?(s=i,a=r,l=0):60<=n&&n<120?(s=r,a=i,l=0):120<=n&&n<180?(s=0,a=i,l=r):180<=n&&n<240?(s=0,a=r,l=i):240<=n&&n<300?(s=r,a=0,l=i):300<=n&&n<360&&(s=i,a=0,l=r),s=Math.round(255*(s+o)),a=Math.round(255*(a+o)),l=Math.round(255*(l+o)),{r:s,g:a,b:l}}function dS(n,t,e){n/=255,t/=255,e/=255;const i=Math.min(n,t,e),r=Math.max(n,t,e),o=r-i;let s=0,a=0,l=0;return s=o===0?0:r===n?(t-e)/o%6:r===t?(e-n)/o+2:(n-t)/o+4,s=Math.round(60*s),s<0&&(s+=360),l=(r+i)/2,a=o===0?0:o/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:s,s:a,l}}const kct=/^#([0-9a-f]{3,8})$/,gP={transparent:4294967040},ep={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Bf(n){return((n=Math.max(0,Math.min(255,Math.round(n)||0)))<16?"0":"")+n.toString(16)}function $F(n){return yr(n)?new En(n>>16,n>>8&255,255&n,1):WF(n)?new En(n[0],n[1],n[2]):new En(255,255,255)}function Pct(n){return yr(n)?new En(n>>>24,n>>>16&255,n>>>8&255,255&n):WF(n)?new En(n[0],n[1],n[2],n[3]):new En(255,255,255,1)}function zC(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function NC(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}const fP=(n,t)=>{const e=kct.exec(n);if(t||e){const i=parseInt(e[1],16),r=e[1].length;return r===3?new En((i>>8&15)+((i>>8&15)<<4),(i>>4&15)+((i>>4&15)<<4),(15&i)+((15&i)<<4),1):r===6?$F(i):r===8?new En(i>>24&255,i>>16&255,i>>8&255,(255&i)/255):null}};class Xr{static Brighter(t,e=1){return e===1?t:new Xr(t).brighter(e).toRGBA()}static SetOpacity(t,e=1){return e===1?t:new Xr(t).setOpacity(e).toRGBA()}static getColorBrightness(t,e="hsl"){const i=t instanceof Xr?t:new Xr(t);switch(e){case"hsv":default:return i.getHSVBrightness();case"hsl":return i.getHSLBrightness();case"lum":return i.getLuminance();case"lum2":return i.getLuminance2();case"lum3":return i.getLuminance3()}}static parseColorString(t){if(Ri(gP[t]))return Pct(gP[t]);if(Ri(ep[t]))return $F(ep[t]);const e=`${t}`.trim().toLowerCase(),i=fP(e);if(i!==void 0)return i;if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const r=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new En(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10),parseFloat(r[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const r=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),o=p1(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10));return new En(o.r,o.g,o.b,parseFloat(r[3]))}}constructor(t){const e=Xr.parseColorString(t);e?this.color=e:this.color=new En(255,255,255)}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t))),this}add(t){const{r:e,g:i,b:r}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,r+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return .5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const r=this.color.opacity,o=dS(this.color.r,this.color.g,this.color.b),s=p1(hn(t)?o.h:GF(t,0,360),hn(e)?o.s:e>=0&&e<=1?100*e:e,hn(i)?o.l:i<=1&&i>=0?100*i:i);return this.color=new En(s.r,s.g,s.b,r),this}setRGB(t,e,i){return!hn(t)&&(this.color.r=t),!hn(e)&&(this.color.g=e),!hn(i)&&(this.color.b=i),this}setHex(t){const e=`${t}`.trim().toLowerCase(),i=fP(e,!0);return i??this}setColorName(t){const e=ep[t.toLowerCase()];return e!==void 0&&this.setHex(e),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(t=1){return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}clone(){return new Xr(this.color.toString())}copyGammaToLinear(t,e=2){return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t,e=2){const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=zC(t.color.r),this.color.g=zC(t.color.g),this.color.b=zC(t.color.b),this}copyLinearToSRGB(t){return this.color.r=NC(t.color.r),this.color.g=NC(t.color.g),this.color.b=NC(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}}class En{constructor(t,e,i,r){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),Ri(r)?this.opacity=isNaN(+r)?1:Math.max(0,Math.min(1,+r)):this.opacity=1}formatHex(){return`#${Bf(this.r)+Bf(this.g)+Bf(this.b)+(this.opacity===1?"":Bf(255*this.opacity))}`}formatRgb(){const t=this.opacity;return`${t===1?"rgb(":"rgba("}${this.r},${this.g},${this.b}${t===1?")":`,${t})`}`}formatHsl(){const t=this.opacity,{h:e,s:i,l:r}=dS(this.r,this.g,this.b);return`${t===1?"hsl(":"hsla("}${e},${i}%,${r}%${t===1?")":`,${t})`}`}toString(){return this.formatHex()}}function Ect(n){let t="",e="",i="";const r=n[0]==="#"?1:0;for(let o=r;o<n.length;o++)n[o]!=="#"&&(o<r+2?t+=n[o]:o<r+4?e+=n[o]:o<r+6&&(i+=n[o]));return[parseInt(t,16),parseInt(e,16),parseInt(i,16)]}function Lct(n,t,e){return Number((1<<24)+(n<<16)+(t<<8)+e).toString(16).slice(1)}function Oct(n,t){const e=n.r,i=t.r,r=n.g,o=t.g,s=n.b,a=t.b,l=n.opacity,h=t.opacity;return u=>{const d=Math.round(e*(1-u)+i*u),c=Math.round(r*(1-u)+o*u),g=Math.round(s*(1-u)+a*u);return new En(d,c,g,l*(1-u)+h*u)}}const Ict=Object.freeze(Object.defineProperty({__proto__:null,Color:Xr,DEFAULT_COLORS:ep,RGB:En,hexToRgb:Ect,hslToRgb:p1,interpolateRgb:Oct,rgbToHex:Lct,rgbToHsl:dS},Symbol.toStringTag,{value:"Module"}));var Ps;(function(n){n.Identity="identity",n.Linear="linear",n.Log="log",n.Pow="pow",n.Sqrt="sqrt",n.Symlog="symlog",n.Time="time",n.Quantile="quantile",n.Quantize="quantize",n.Threshold="threshold",n.Ordinal="ordinal",n.Point="point",n.Band="band"})(Ps||(Ps={}));Object.values(Ps).forEach((n=>{}));function fh(n){return n}const Hct=n=>-Math.log(-n),Dct=n=>-Math.exp(-n),Fct=n=>isFinite(n)?Math.pow(10,n):n<0?0:n,pP=n=>n===10?Fct:n===Math.E?Math.exp:t=>Math.pow(n,t),mP=n=>n===Math.E?Math.log:n===10?Math.log10:n===2?Math.log2:(n=Math.log(n),t=>Math.log(t)/n),vP=n=>t=>Math.sign(t)*Math.log1p(Math.abs(t/n)),bP=n=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*n;function m1(n,t){if(n=Number(n),t=Number(t),t-=n)return i=>(i-n)/t;const e=Number.isNaN(t)?NaN:.5;return()=>e}function yP(n,t,e){const i=n[0],r=n[1],o=t[0],s=t[1];let a,l;return r<i?(a=m1(r,i),l=e(s,o)):(a=m1(i,r),l=e(o,s)),h=>l(a(h))}function cS(n,t,e){let i;return i=n===1?n+2*e:n-t+2*e,n?i>0?i:1:0}function zct(n,t,e,i){return e===1&&(e=0),cS(n,e,i)*(t/(1-e))}function Nct(n,t,e,i,r){const o=cS(n,e,i);let s=t/Math.max(1,o||1);r&&(s=Math.floor(s));let a=s*(1-e);return r&&(a=Math.round(a)),a}function UF(n,t){const e=(n[1]-n[0])/(t[1]-t[0]),i=n[0]-e*t[0];return[i,e+i]}function Wct(n,t,e){const i=Math.min(n.length,t.length)-1,r=new Array(i),o=new Array(i);let s=-1;for(n[i]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++s<i;)r[s]=m1(n[s],n[s+1]),o[s]=e(t[s],t[s+1]);return function(a){const l=Act(n,a,1,i)-1;return o[l](r[l](a))}}const jct=(n,t)=>{const e=n.slice();let i=0,r=e.length-1,o=e[i],s=e[r];return s<o&&([i,r]=[r,i],[o,s]=[s,o]),e[i]=t.floor(o),e[r]=t.ceil(s),e},XF=(n,t=!1)=>{const e=Math.floor(Math.log10(n)),i=n/Math.pow(10,e);let r;return r=t?i<1.5?1:i<3?2:i<7?5:10:i<=1?1:i<=2?2:i<=5?5:10,r*Math.pow(10,e)},Vct=(n,t)=>{let e,i;return t[0]<t[1]?(e=t[0],i=t[1]):(e=t[1],i=t[0]),Math.min(Math.max(n,e),i)};class YF{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:Ri(this._rangeFactorStart)&&Ri(this._rangeFactorEnd)&&t.length===2?(this._wholeRange=UF(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(t.length===2&&t.every((r=>r>=0&&r<=1))&&(this._wholeRange=null,t[0]===0&&t[1]===1?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):Ri(this._rangeFactorStart)&&Ri(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return hn(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!hn(this._rangeFactorEnd)&&this._rangeFactorEnd!==1?(this._rangeFactorStart=t,this._rangeFactorEnd=(i=this._rangeFactorEnd)!==null&&i!==void 0?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return hn(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!hn(this._rangeFactorStart)&&this._rangeFactorStart!==0?(this._rangeFactorEnd=t,this._rangeFactorStart=(i=this._rangeFactorStart)!==null&&i!==void 0?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:r}=this._fishEyeOptions,o=this.range(),s=o[0],a=o[o.length-1],l=Math.min(s,a),h=Math.max(s,a),u=GF((t=this._fishEyeOptions.focus)!==null&&t!==void 0?t:0,l,h),d=hn(r)?(h-l)*i:r;let c=Math.exp(e);c=c/(c-1)*d;const g=e/d;this._fishEyeTransform=f=>{const p=Math.abs(f-u);if(p>=d)return f;if(p<=1e-6)return u;const m=c*(1-Math.exp(-p*g))/p*.75+.25;return u+(f-u)*m}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}get(t,e){var i;return(i=this==null?void 0:this[t])!==null&&i!==void 0?i:e}}const v1=Symbol("implicit");class gS extends YF{specified(t){var e;return t?(this._specified=Object.assign((e=this._specified)!==null&&e!==void 0?e:{},t),this):Object.assign({},this._specified)}_getSpecifiedValue(t){if(this._specified)return this._specified[t]}constructor(){super(),this.type=Ps.Ordinal,this._index=new Map,this._domain=[],this._ordinalRange=[],this._unknown=v1}clone(){const t=new gS().domain(this._domain).range(this._ordinalRange).unknown(this._unknown);return this._specified&&t.specified(this._specified),t}calculateVisibleDomain(t){return Ri(this._rangeFactorStart)&&Ri(this._rangeFactorEnd)&&t.length===2?[this.invert(t[0]),this.invert(t[1])]:this._domain}scale(t){const e=`${t}`,i=this._getSpecifiedValue(e);if(i!==void 0)return i;let r=this._index.get(e);if(!r){if(this._unknown!==v1)return this._unknown;r=this._domain.push(t),this._index.set(e,r)}const o=this._ordinalRange[(r-1)%this._ordinalRange.length];return this._fishEyeTransform?this._fishEyeTransform(o):o}invert(t){let e=0;for(;e<this._ordinalRange.length&&this._ordinalRange[e]!==t;)e++;return this._domain[(e-1)%this._domain.length]}domain(t){if(!t)return this._domain.slice();this._domain=[],this._index=new Map;for(const e of t){const i=`${e}`;this._index.has(i)||this._index.set(i,this._domain.push(e))}return this}range(t){if(!t)return this._ordinalRange.slice();const e=Array.from(t);return this._ordinalRange=e,this}index(t){var e;return this._index&&(e=this._index.get(`${t}`))!==null&&e!==void 0?e:-1}}function qF(n,t,e,i){const r=[];let o=n;for(;o<=t;)r.push(o),o+=e;return i&&r.reverse(),r}function CP(n,t,e,i){let r,o;if(t=Math.floor(+t),n=Math.floor(+n),!(e=Math.floor(+e)))return[];if(n===t)return[n];if(r=t<n){const a=n;n=t,t=a}let s=uS(1,t-n+1)(e);if(o=Math.floor((t-n+1)/s),!i)for(;Math.ceil((t-n+1)/o)>e&&s>1;)s-=1,o=Math.floor((t-n)/s);return qF(n,t,o,r)}function Gct(n,t,e){let i;if(t=Math.floor(+t),n=Math.floor(+n),e=uS(1,t-n+1)(Math.floor(+e)),i=t<n){const r=n;n=t,t=r}return qF(n,t,e,i)}class jv extends gS{constructor(t){super(),this.type=Ps.Band,this._range=[0,1],this._step=void 0,this._bandwidth=void 0,this._isFixed=!1,this._round=!1,this._paddingInner=0,this._paddingOuter=0,this._align=.5,this._unknown=void 0,delete this.unknown,this.rescale(t)}rescale(t,e){if(t)return this;this._wholeRange=null;const i=this._calculateWholeRange(this._range,e),r=super.domain().length,o=i[1]<i[0];let s=i[Number(o)-0];const a=i[1-Number(o)],l=cS(r,this._paddingInner,this._paddingOuter);return this._step=(a-s)/Math.max(1,l||1),this._round&&(this._step=Math.floor(this._step)),s+=(a-s-this._step*(r-this._paddingInner))*this._align,this.isBandwidthFixed()||(this._bandwidth=this._step*(1-this._paddingInner)),this._round&&(s=Math.round(s),this.isBandwidthFixed()||(this._bandwidth=Math.round(this._bandwidth))),this._bandRangeState={reverse:o,start:o?s+this._step*(r-1):s,count:r},this.generateFishEyeTransform(),this}scale(t){if(!this._bandRangeState)return;const e=`${t}`,i=this._getSpecifiedValue(e);if(i!==void 0)return i;let r=this._index.get(e);if(!r){if(this._unknown!==v1)return this._unknown;r=this._domain.push(t),this._index.set(e,r)}const{count:o,start:s,reverse:a}=this._bandRangeState,l=s+(a?-1:1)*((r-1)%o)*this._step;return this._fishEyeTransform?this._fishEyeTransform(l):l}_calculateWholeRange(t,e){if(this._wholeRange)return this._wholeRange;if((this._minBandwidth||this._maxBandwidth)&&!this._isBandwidthFixedByUser()){let i;if(Ri(this._rangeFactorStart)&&Ri(this._rangeFactorEnd)&&t.length===2){const o=UF(t,[this._rangeFactorStart,this._rangeFactorEnd]);i=Math.abs(o[1]-o[0])}else i=Math.abs(t[1]-t[0]);const r=Nct(super.domain().length,i,this._paddingInner,this._paddingOuter,this._round);r<this._minBandwidth?(this._bandwidth=this._minBandwidth,this._isFixed=!0):r>this._maxBandwidth?(this._bandwidth=this._maxBandwidth,this._isFixed=!0):(this._bandwidth=r,this._isFixed=!1)}if(this.isBandwidthFixed()){const i=zct(super.domain().length,this._bandwidth,this._paddingInner,this._paddingOuter)*Math.sign(t[1]-t[0]),r=Math.min((t[1]-t[0])/i,1);if(Ri(this._rangeFactorStart)&&Ri(this._rangeFactorEnd)){if(i>0){const a=t[0]-i*this._rangeFactorStart,l=a+i;this._wholeRange=[a,l]}else{const a=t[1]+i*(1-this._rangeFactorEnd),l=a-i;this._wholeRange=[l,a]}const o=this._rangeFactorStart+r<=1,s=this._rangeFactorEnd-r>=0;e==="rangeFactorStart"&&o?this._rangeFactorEnd=this._rangeFactorStart+r:e==="rangeFactorEnd"&&s?this._rangeFactorStart=this._rangeFactorEnd-r:t[0]<=t[1]?o?this._rangeFactorEnd=this._rangeFactorStart+r:s?this._rangeFactorStart=this._rangeFactorEnd-r:(this._rangeFactorStart=0,this._rangeFactorEnd=r):s?this._rangeFactorStart=this._rangeFactorEnd-r:o?this._rangeFactorEnd=this._rangeFactorStart+r:(this._rangeFactorStart=1-r,this._rangeFactorEnd=1)}else this._rangeFactorStart=0,this._rangeFactorEnd=r,this._wholeRange=[t[0],t[0]+i];return this._wholeRange}return super._calculateWholeRange(t)}calculateWholeRangeSize(){const t=this._calculateWholeRange(this._range);return Math.abs(t[1]-t[0])}calculateVisibleDomain(t){const e=this._domain;if(Ri(this._rangeFactorStart)&&Ri(this._rangeFactorEnd)&&e.length){const i=this._getInvertIndex(t[0]),r=this._getInvertIndex(t[1]);return e.slice(Math.min(i,r),Math.max(i,r)+1)}return e}domain(t,e){return t?(super.domain(t),this.rescale(e)):super.domain()}range(t,e){return t?(this._range=[Rd(t[0]),Rd(t[1])],this.rescale(e)):this._range}rangeRound(t,e){return this._range=[Rd(t[0]),Rd(t[1])],this._round=!0,this.rescale(e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return t===-1?e:CP(0,e.length-1,t,!1).map((i=>e[i]))}tickData(t=10){return this.ticks(t).map(((e,i)=>({index:i,tick:e,value:(this.scale(e)-this._range[0]+this._bandwidth/2)/(this._range[1]-this._range[0])})))}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return CP(0,e.length-1,t,!0).filter((i=>i<e.length)).map((i=>e[i]))}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return Gct(0,e.length-1,t).map((i=>e[i]))}_getInvertIndex(t){let e=0;const i=this.step()/2,r=this.bandwidth()/2,o=this._domain.length,s=this.range(),a=s[0]>s[s.length-1];for(e=0;e<o;e++){const l=this.scale(this._domain[e])+r;if(e===0&&(!a&&!dP(t,l+i)||a&&!cP(t,l-i))||e===o-1||!cP(t,l-i)&&!dP(t,l+i))break}return e>=0&&e<=o-1?e:o-1}invert(t){return this._domain[this._getInvertIndex(t)]}padding(t,e){return t!==void 0?(this._paddingOuter=Math.max(0,Math.min(Array.isArray(t)?Math.min.apply(null,t):t)),this._paddingInner=this._paddingOuter,this.rescale(e)):this._paddingInner}paddingInner(t,e){return t!==void 0?(this._paddingInner=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingInner}paddingOuter(t,e){return t!==void 0?(this._paddingOuter=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingOuter}step(){return this._step}round(t,e){return t!==void 0?(this._round=t,this.rescale(e)):this._round}align(t,e){return t!==void 0?(this._align=Math.max(0,Math.min(1,t)),this.rescale(e)):this._align}rangeFactor(t,e){return t?(super.rangeFactor(t),this.rescale(e)):super.rangeFactor()}rangeFactorStart(t,e){return hn(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this.rescale(e,"rangeFactorStart"))}rangeFactorEnd(t,e){return hn(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this.rescale(e,"rangeFactorEnd"))}bandwidth(t,e){return t?(t==="auto"?(this._bandwidth=void 0,this._isFixed=!1):(this._bandwidth=t,this._isFixed=!0),this._userBandwidth=t,this.rescale(e)):this._bandwidth}maxBandwidth(t,e){return t?(this._maxBandwidth=t==="auto"?void 0:t,this.rescale(e)):this._maxBandwidth}minBandwidth(t,e){return t?(this._minBandwidth=t==="auto"?void 0:t,this.rescale(e)):this._minBandwidth}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}isBandwidthFixed(){return this._isFixed&&!!this._bandwidth}_isBandwidthFixedByUser(){return this._isFixed&&this._userBandwidth&&yr(this._userBandwidth)}clone(){var t,e,i;return new jv(!0).domain(this._domain,!0).range(this._range,!0).round(this._round,!0).paddingInner(this._paddingInner,!0).paddingOuter(this._paddingOuter,!0).align(this._align,!0).bandwidth((t=this._userBandwidth)!==null&&t!==void 0?t:"auto",!0).maxBandwidth((e=this._maxBandwidth)!==null&&e!==void 0?e:"auto",!0).minBandwidth((i=this._maxBandwidth)!==null&&i!==void 0?i:"auto")}}const{interpolateRgb:WC}=Ict;function $ct(n,t){const e=typeof t;let i;if(hn(t)||e==="boolean")return()=>t;if(e==="number")return tp(n,t);if(e==="string"){if(i=Xr.parseColorString(t)){const r=WC(Xr.parseColorString(n),i);return o=>r(o).formatRgb()}return tp(Number(n),Number(t))}return t instanceof En?WC(n,t):t instanceof Xr?WC(n.color,t.color):t instanceof Date?Bct(n,t):tp(Number(n),Number(t))}class KF extends YF{constructor(t=fh,e=fh){super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=fh,this._piecewise=yP,this._interpolate=$ct}calculateVisibleDomain(t){var e;return Ri(this._rangeFactorStart)&&Ri(this._rangeFactorEnd)&&t.length===2?[this.invert(t[0]),this.invert(t[1])]:(e=this._niceDomain)!==null&&e!==void 0?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),tp)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return((i=this._niceDomain)!==null&&i!==void 0?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const r=Array.from(t,Rd);return this._domain=r,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=Rct,this.rescale(e)}rescale(t){var e;if(t)return this;const i=(e=this._niceDomain)!==null&&e!==void 0?e:this._domain,r=i.length,o=this._range.length;let s=Math.min(r,o);if(r&&r<o&&this._forceAlign){const a=o-r+1,l=i[r-1],h=r>=2?(l-i[r-2])/a:0;for(let u=1;u<=a;u++)i[r-2+u]=l-h*(a-u);s=o}return this._autoClamp&&(this._clamp=uS(i[0],i[s-1])),this._piecewise=s>2?Wct:yP,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:fh),this.rescale(i)):this._clamp!==fh}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(t=10){return[]}tickData(t=10){const e=this.ticks(t);return(e??[]).map(((i,r)=>({index:r,tick:i,value:(this.scale(i)-this._range[0])/(this._range[1]-this._range[0])})))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return hn(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return hn(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}}const Uct=Math.sqrt(50),Xct=Math.sqrt(10),Yct=Math.sqrt(2),kf=[1,2,5,10],_P=(n,t,e)=>{let i=1,r=n;const o=Math.floor((t-1)/2),s=Math.abs(n);return n>=0&&n<=Number.MIN_VALUE?r=0:n<0&&n>=-Number.MIN_VALUE?r=-(t-1):!e&&s<1?i=ZF(s).step:(e||s>1)&&(r=Math.floor(n)-o*i),i>0?(n>0?r=Math.max(r,0):n<0&&(r=Math.min(r,-(t-1)*i)),xct(0,t).map((a=>r+a*i))):n>0?km(0,-(t-1)/i,i):km((t-1)/i,0,i)},qct=Cg(((n,t,e,i)=>{let r,o,s,a,l=-1;if(e=+e,(n=+n)==(t=+t))return[n];if(Math.abs(n-t)<=Number.MIN_VALUE&&e>0)return[n];if((r=t<n)&&(o=n,n=t,t=o),a=fS(n,t,e).step,!isFinite(a))return[];if(a>0){let h=Math.round(n/a),u=Math.round(t/a);for(h*a<n&&++h,u*a>t&&--u,s=new Array(o=u-h+1);++l<o;)s[l]=(h+l)*a}else if(a<0&&i?.noDecimals){a=1;const h=Math.ceil(n),u=Math.floor(t);if(!(h<=u))return[];for(s=new Array(o=u-h+1);++l<o;)s[l]=h+l}else{a=-a;let h=Math.round(n*a),u=Math.round(t*a);for(h/a<n&&++h,u/a>t&&--u,s=new Array(o=u-h+1);++l<o;)s[l]=(h+l)/a}return r&&s.reverse(),s})),km=(n,t,e)=>{let i,r,o=-1;if(e>0){let s=Math.floor(n/e),a=Math.ceil(t/e);for((s+1)*e<n&&++s,(a-1)*e>t&&--a,r=new Array(i=a-s+1);++o<i;)r[o]=(s+o)*e}else{e=-e;let s=Math.floor(n*e),a=Math.ceil(t*e);for((s+1)/e<n&&++s,(a-1)/e>t&&--a,r=new Array(i=a-s+1);++o<i;)r[o]=(s+o)/e}return r},Kct=(n,t,e)=>{let i;const r=n[0],o=n[n.length-1],s=t-n.length;if(o<=0){const h=[];for(i=s;i>=1;i--)h.push(r-i*e);return h.concat(n)}if(r>=0){for(i=1;i<=s;i++)n.push(o+i*e);return n}let a=[];const l=[];for(i=1;i<=s;i++)i%2==0?a=[r-Math.floor(i/2)*e].concat(a):l.push(o+Math.ceil(i/2)*e);return a.concat(n).concat(l)},Pm=Cg(((n,t,e,i)=>{let r,o,s;if(e=+e,(n=+n)==(t=+t)||Math.abs(n-t)<=Number.MIN_VALUE&&e>0)return _P(n,e,i?.noDecimals);(r=t<n)&&(s=n,n=t,t=s);const a=fS(n,t,e);let l=a.step;if(!isFinite(l))return[];if(l>0){let h=1;const{power:u,gap:d}=a,c=d===10?2*10**u:1*10**u;for(;h<=5&&(o=km(n,t,l),o.length>e+1)&&e>2;)l+=c,h+=1;e>2&&o.length<e-1&&(o=Kct(o,e,l))}else i?.noDecimals&&l<0&&(l=1),o=km(n,t,l);return r&&o.reverse(),o})),ZF=n=>{const t=Math.floor(Math.log(n)/Math.LN10),e=n/10**t;let i=kf[0];return e>=Uct?i=kf[3]:e>=Xct?i=kf[2]:e>=Yct&&(i=kf[1]),t>=0?{step:i*10**t,gap:i,power:t}:{step:-(10**-t)/i,gap:i,power:t}};function fS(n,t,e){const i=(t-n)/Math.max(0,e);return ZF(i)}function JF(n,t,e){let i;if(e=+e,(n=+n)==(t=+t)&&e>0)return[n];if(e<=0||(i=Zct(n,t,e))===0||!isFinite(i))return[];const r=new Array(e);for(let o=0;o<e;o++)r[o]=n+o*i;return r}function Zct(n,t,e){return(t-n)/Math.max(1,e-1)}function Jct(n,t,e){let i,r,o=-1;if(e=+e,(r=(t=+t)<(n=+n))&&(i=n,n=t,t=i),!isFinite(e)||t-n<=e)return[n];const s=Math.floor((t-n)/e+1),a=new Array(s);for(;++o<s;)a[o]=n+o*e;return r&&a.reverse(),a}function jC(n,t=10){let e,i,r=0,o=n.length-1,s=n[r],a=n[o],l=10;for(a<s&&(i=s,s=a,a=i,i=r,r=o,o=i);l-- >0;){if(i=fS(s,a,t).step,i===e)return n[r]=s,n[o]=a,n;if(i>0)s=Math.floor(s/i)*i,a=Math.ceil(a/i)*i;else{if(!(i<0))break;s=Math.ceil(s*i)/i,a=Math.floor(a*i)/i}e=i}}function QF(n,t){const e=yr(t.forceMin),i=yr(t.forceMax);let r=null;const o=[];let s=null;const a=e&&i?l=>l>=t.forceMin&&l<=t.forceMax:e?l=>l>=t.forceMin:i?l=>l<=t.forceMax:null;return e?o[0]=t.forceMin:yr(t.min)&&t.min<=Math.min(n[0],n[n.length-1])&&(o[0]=t.min),i?o[1]=t.forceMax:yr(t.max)&&t.max>=Math.max(n[0],n[n.length-1])&&(o[1]=t.max),yr(o[0])&&yr(o[1])?(s=n.slice(),s[0]=o[0],s[s.length-1]=o[1]):r=yr(o[0])||yr(o[1])?yr(o[0])?"max":"min":"all",{niceType:r,niceDomain:s,niceMinMax:o,domainValidator:a}}const VC=(n,t,e)=>Math.abs(t-n)<1?+e.toFixed(1):Math.round(+e),tz=Cg(((n,t,e,i,r,o,s)=>{let a=n,l=t;const h=l<a;h&&([a,l]=[l,a]);let u,d,c=r(a),g=r(l),f=[];if(!(i%1)&&g-c<e){if(c=Math.floor(c),g=Math.ceil(g),a>0){for(;c<=g;++c)for(u=1;u<i;++u)if(d=c<0?u/o(-c):u*o(c),!(d<a)){if(d>l)break;f.push(d)}}else for(;c<=g;++c)for(u=i-1;u>=1;--u)if(d=c>0?u/o(-c):u*o(c),!(d<a)){if(d>l)break;f.push(d)}2*f.length<e&&(f=Pm(a,l,e))}else f=Pm(c,g,Math.min(g-c,e)).map(o);return f=f.filter((p=>p!==0)),s?.noDecimals&&(f=Array.from(new Set(f.map((p=>Math.floor(p)))))),h?f.reverse():f})),ez=Cg(((n,t,e,i,r,o)=>{const s=[],a={},l=r(n),h=r(t);let u=[];if(Number.isInteger(i))u=Pm(l,h,e);else{const d=(h-l)/(e-1);for(let c=0;c<e;c++)u.push(l+c*d)}return u.forEach((d=>{const c=o(d),g=Number.isInteger(i)?VC(n,t,c):VC(n,t,XF(c)),f=VC(n,t,Vct(g,[n,t]));!a[f]&&!isNaN(f)&&u.length>1&&(a[f]=1,s.push(f))})),s})),Em=Cg(((n,t,e,i,r)=>JF(i(n),i(t),e).map((o=>XF(r(o))))));class Uu extends KF{constructor(){super(...arguments),this.type=Ps.Linear}clone(){return new Uu().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}tickFormat(){return()=>{}}d3Ticks(t=10,e){const i=this.calculateVisibleDomain(this._range);return qct(i[0],i[i.length-1],t,e)}ticks(t=10,e){var i;if(Cct(e?.customTicks))return e.customTicks(this,t);if(Ri(this._rangeFactorStart)&&Ri(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&this._range.length===2||!this._niceType)return this.d3Ticks(t,e);const r=(i=this._niceDomain)!==null&&i!==void 0?i:this._domain,o=this._domain,s=r[0],a=r[r.length-1];let l=Pm(o[0],o[o.length-1],t,e);if(!l.length)return l;if(this._domainValidator)l=l.filter(this._domainValidator);else if((l[0]!==s||l[l.length-1]!==a)&&this._niceType){const h=r.slice();if(this._niceType==="all"?(h[0]=l[0],h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()):this._niceType==="min"&&l[0]!==s?(h[0]=l[0],this._niceDomain=h,this.rescale()):this._niceType==="max"&&l[l.length-1]!==a&&(h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()),this._niceType!=="all"){const u=Math.min(h[0],h[h.length-1]),d=Math.max(h[0],h[h.length-1]);l=l.filter((c=>c>=u&&c<=d))}}return l}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return JF(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return Jct(e[0],e[e.length-1],t)}nice(t=10,e){var i,r;const o=this._domain;let s=[];if(e){const a=QF(o,e);if(s=a.niceMinMax,this._domainValidator=a.domainValidator,this._niceType=a.niceType,a.niceDomain)return this._niceDomain=a.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const a=jC(o.slice(),t);this._niceType==="min"?a[a.length-1]=(i=s[1])!==null&&i!==void 0?i:a[a.length-1]:this._niceType==="max"&&(a[0]=(r=s[0])!==null&&r!==void 0?r:a[0]),this._niceDomain=a,this.rescale()}return this}niceMin(t=10){this._niceType="min";const e=this._domain[this._domain.length-1],i=jC(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(t=10){this._niceType="max";const e=this._domain[0],i=jC(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}}class iz{nice(t=10,e){var i,r,o,s;const a=this._domain;let l=[],h=null;if(e){const u=QF(a,e);if(l=u.niceMinMax,this._domainValidator=u.domainValidator,h=u.niceType,u.niceDomain)return this._niceDomain=u.niceDomain,this.rescale(),this}else h="all";if(h){const u=jct(a.slice(),(r=(i=this.getNiceConfig)===null||i===void 0?void 0:i.call(this))!==null&&r!==void 0?r:{floor:d=>Math.floor(d),ceil:d=>Math.ceil(d)});return h==="min"?u[u.length-1]=(o=l[1])!==null&&o!==void 0?o:u[u.length-1]:h==="max"&&(u[0]=(s=l[0])!==null&&s!==void 0?s:u[0]),this._niceDomain=u,this.rescale(),this}return this}niceMin(){const t=this._domain[this._domain.length-1];this.nice();const e=this._domain.slice();return this._domain&&(e[e.length-1]=t,this._niceDomain=e,this.rescale()),this}niceMax(){const t=this._domain[0];this.nice();const e=this._domain.slice();return this._domain&&(e[0]=t,this._niceDomain=e,this.rescale()),this}}function wP(n){return t=>-n(-t)}function xP(n=Number.EPSILON){return t=>Math.max(t,n)}function Qct(n=Number.EPSILON){return t=>Math.min(t,-n)}class _g extends KF{constructor(){super(mP(10),pP(10)),this.type=Ps.Log,this._limit=xP(),this._logs=this.transformer,this._pows=this.untransformer,this._domain=[1,10],this._base=10}clone(){return new _g().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).base(this._base)}rescale(t){var e;if(t)return this;super.rescale();const i=mP(this._base),r=pP(this._base);return((e=this._niceDomain)!==null&&e!==void 0?e:this._domain)[0]<0?(this._logs=wP(i),this._pows=wP(r),this._limit=Qct(),this.transformer=Hct,this.untransformer=Dct):(this._logs=i,this._pows=r,this._limit=xP(),this.transformer=this._logs,this.untransformer=r),this}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this._limit).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._limit(this._clamp(t))));return this._fishEyeTransform?this._fishEyeTransform(i):i}base(t,e){return arguments.length?(this._base=t,this.rescale(e)):this._base}tickFormat(){return fh}d3Ticks(t=10,e){const i=this.domain(),r=this._limit(i[0]),o=this._limit(i[i.length-1]);return tz(r,o,t,this._base,this.transformer,this.untransformer,e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return ez(this._limit(e[0]),this._limit(e[e.length-1]),t,this._base,this.transformer,this.untransformer)}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return Em(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return Em(this._limit(e[0]),this._limit(e[e.length-1]),t,this.transformer,this.untransformer)}getNiceConfig(){return{floor:t=>this._pows(Math.floor(this._logs(this._limit(t)))),ceil:t=>Math.abs(t)>=1?Math.ceil(t):this._pows(Math.ceil(this._logs(this._limit(t))))}}}jF(_g,iz);class tgt extends jv{constructor(t){super(!1),this.type=Ps.Point,this._padding=0,this.paddingInner(1,t),this.padding=this.paddingOuter,this.paddingInner=void 0,this.paddingOuter=void 0}}class wg extends Uu{constructor(){super(vP(1),bP(1)),this.type=Ps.Symlog,this._const=1}clone(){return new wg().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).constant(this._const)}constant(t,e){return arguments.length?(this._const=t,this.transformer=vP(t),this.untransformer=bP(t),this.rescale(e)):this._const}d3Ticks(t=10,e){const i=this.domain(),r=i[0],o=i[i.length-1];return tz(r,o,t,this._const,this.transformer,this.untransformer,e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return ez(e[0],e[e.length-1],t,this._const,this.transformer,this.untransformer)}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return Em(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return Em(e[0],e[e.length-1],t,this.transformer,this.untransformer)}}jF(wg,iz);class egt{constructor(){this._scale=new jv,this._scales=[this._scale]}valueToPosition(t){return this._scale.scale(t)}getPosition(t){let e=0,i=this._scale;if(this._scales.length===1||t.length===1)e=this.valueToPosition(t[0]);else{const r=Math.min(t.length,this._scales.length);for(let o=0;o<r;o++)e+=this._scales[o].scale(t[o]);i=this._scales[r-1]}return{position:e,bandScale:i}}calcScales(t,e){var i,r;const{bandPadding:o,paddingInner:s,paddingOuter:a}=this,l=wt(o),h=wt(s),u=wt(a);for(let d=0;d<this._scales.length;d++){const c=l?o[d]:o,g=h?s[d]:s,f=u?a[d]:a;this._scales[d].paddingInner((i=g??c)!==null&&i!==void 0?i:t,!0).paddingOuter((r=f??c)!==null&&r!==void 0?r:e)}}dataToPosition(t,e={}){var i;if(t.length===0||this._scales.length===0)return 0;const{position:r,bandScale:o}=this.getPosition(t);return r+o.bandwidth()*((i=e.bandPosition)!==null&&i!==void 0?i:.5)}updateScaleDomain(t){for(let e=0;e<this._scales.length;e++)this._scales[e].domain(t)}updateRange(t){const[e,i]=this._scale.range();t[0]===e&&t[1]===i||this._scale.range(t)}}function igt(n,t,e){n.getTransform(t)||n.registerTransform(t,e)}function ngt(n,t,e){n.getParser(t)||n.registerParser(t,e)}const rgt=Math.sqrt(50),ogt=Math.sqrt(10),sgt=Math.sqrt(2);class agt{constructor(t){this._extend={},this.type=t??"linear",this._scale=t==="log"?new _g:t==="symlog"?new wg:new Uu,this._scales=[this._scale]}setExtraAttrFromSpec(t,e,i,r,o,s){this.nice=!1,this.zero=e,this.zero&&(i.min=Math.min(i.min,0),i.max=Math.max(i.max,0)),this.domain=i,this.expand=r,this.type==="log"?this._scale.base(o??10):this.type==="symlog"&&this._scale.constant(s??10)}transformScaleDomain(){this.type==="symlog"||this.type==="log"||this.setScaleNice()}setScaleNice(){this.type==="log"?this.setLogScaleNice():this.setLinearScaleNice()}setLogScaleNice(){var t,e,i,r,o,s;he((t=this.domain)===null||t===void 0?void 0:t.min)&&he((e=this.domain)===null||e===void 0?void 0:e.max)?this.nice&&this._scale.nice():$((i=this.domain)===null||i===void 0?void 0:i.min)&&he((r=this.domain)===null||r===void 0?void 0:r.max)?this.nice&&this._scale.niceMax():he((o=this.domain)===null||o===void 0?void 0:o.min)&&$((s=this.domain)===null||s===void 0?void 0:s.max)&&this.nice&&this._scale.niceMin()}setLinearScaleNice(){var t,e,i,r,o,s,a,l;let h=(e=(t=this.forceTickCount)!==null&&t!==void 0?t:this.tickCount)!==null&&e!==void 0?e:10;this.niceType==="accurateFirst"&&(h=Math.max(10,h)),he((i=this.domain)===null||i===void 0?void 0:i.min)&&he((r=this.domain)===null||r===void 0?void 0:r.max)?this.nice&&this._scale.nice(h):$((o=this.domain)===null||o===void 0?void 0:o.min)&&he((s=this.domain)===null||s===void 0?void 0:s.max)?this.nice&&this._scale.niceMax(h):he((a=this.domain)===null||a===void 0?void 0:a.min)&&$((l=this.domain)===null||l===void 0?void 0:l.max)?this.nice&&this._scale.niceMin(h):this.nice&&this._scale.nice(h)}dataToPosition(t){return this.valueToPosition(t[0])}valueToPosition(t){return this._scale.scale(t)}computeLinearDomain(t){const e=[];return t.forEach((i=>{const{min:r,max:o}=i;e[0]=e[0]===void 0?r:Math.min(e[0],r),e[1]=e[1]===void 0?o:Math.max(e[1],o)})),this.expandDomain(e),this.includeZero(e),this.setDomainMinMax(e),e}expandDomain(t){if(!this.expand)return;const e=t[0],i=t[t.length-1];$(this.expand.min)&&(t[0]=e-(i-e)*this.expand.min),$(this.expand.max)&&(t[t.length-1]=i+(i-e)*this.expand.max)}niceDomain(t){if($(t[0])||$(t[1])||this.type!=="linear")return t;if(Math.abs(Pnt(t)-knt(t))<=1e-12){let e=t[0];const i=e>=0?1:-1;if(e=Math.abs(e),e<1)t[0]=0,t[1]=1;else{let r=e/5;const o=Math.floor(Math.log(r)/Math.LN10),s=r/Math.pow(10,o);r=(s>=rgt?10:s>=ogt?5:s>=sgt?2:1)*Math.pow(10,o),t[0]=0,t[1]=10*r}i<0&&(t.reverse(),t[0]*=-1,t[1]*=-1)}return t}niceMinMax(){var t,e,i,r,o,s,a,l;if(this.nice){let h=(e=(t=this.forceTickCount)!==null&&t!==void 0?t:this.tickCount)!==null&&e!==void 0?e:10;this.niceType==="accurateFirst"&&(h=Math.max(10,h)),he((i=this.domain)===null||i===void 0?void 0:i.min)&&he((r=this.domain)===null||r===void 0?void 0:r.max)?this._scale.nice(h):$((o=this.domain)===null||o===void 0?void 0:o.min)&&he((s=this.domain)===null||s===void 0?void 0:s.max)?this._scale.niceMax(h):he((a=this.domain)===null||a===void 0?void 0:a.min)&&$((l=this.domain)===null||l===void 0?void 0:l.max)?this._scale.niceMin(h):this._scale.nice(h)}}includeZero(t){this.zero&&(t[0]=Math.min(t[0],0),t[t.length-1]=Math.max(t[t.length-1],0))}setExtendDomain(t,e){if(e===void 0)return void delete this._extend[t];this._extend[t]=e;const i=this._scale.domain();this.extendDomain(i),this.includeZero(i),this.setDomainMinMax(i),this.niceDomain(i),this._scale.domain(i,this.nice),this.niceMinMax()}extendDomain(t){let e;const i=t.length-1,r=t[0]-t[i]>0,o=r?i:0,s=r?0:i;for(const a in this._extend)e=this._extend[a],e>t[s]&&(t[s]=e),e<t[o]&&(t[o]=e)}setDomainMinMax(t){if(!this.domain)return;const{min:e,max:i}=this.domain;$(e)&&(t[0]=e),$(i)&&(t[1]=i)}setZero(t){this.zero!==t&&(this.zero=t,this.updateScaleDomain())}updateScaleDomain(){const t=this.computeDomain([this.domain]);this.updateScaleDomainByModel(t)}computeDomain(t){return this.computeLinearDomain(t)}updateScaleDomainByModel(t){t=t??this._scale.domain(),this.extendDomain(t),this.includeZero(t),this.setDomainMinMax(t),this.niceDomain(t),this._scale.domain(t,this.nice),this.niceMinMax()}updateRange(t){const[e,i]=this._scale.range();t[0]===e&&t[1]===i||this._scale.range(t)}}function lgt(n,t){const e=n.find((r=>r.name==="axis-label-container-layer-0"),!0),i=n.find((r=>r.name==="axis-label-container-layer-1"),!0);SP(e?e.getChildren():[],t),SP(i?i.getChildren():[],t)}function hgt(n,t){const{width:e,height:i}=t.getLayoutRect(),r=f1(t.orient),o=t.option.inverse===!0,s=n[0],a=Bnt(n);if(r)if(o){const l=e,h=0,u=s.AABBBounds.x2,d=a.AABBBounds.x1;u>l&&s.setAttributes({x:l,textAlign:"right"}),d<h&&a.setAttributes({x:h,textAlign:"left"})}else{const h=e,u=s.AABBBounds.x1,d=a.AABBBounds.x2;u<0&&s.setAttributes({x:0,textAlign:"left"}),d>h&&a.setAttributes({x:h,textAlign:"right"})}else if(o){const l=s.AABBBounds.y1,h=a.AABBBounds.y2,u=0,d=i;l<u&&s.setAttributes({y:u,textBaseline:"top"}),h>d&&a.setAttributes({y:d,textBaseline:"bottom"})}else{const l=i,h=0,u=s.AABBBounds.y2,d=a.AABBBounds.y1;u>l&&s.setAttributes({y:l,textBaseline:"bottom"}),d<h&&a.setAttributes({y:h,textBaseline:"top"})}}function SP(n,t){var e;const i=t.option;dn(n)||!((e=i?.label)===null||e===void 0)&&e.flush&&hgt(n,t)}const ugt=n=>n;class dgt{constructor(t,e,i,r,o){var s,a,l;this.x=0,this.y=0,this.padding=r,this.table=o,this.orient=(s=t.orient)!==null&&s!==void 0?s:"left",this.type=(a=t.type)!==null&&a!==void 0?a:"band",this.option=xe({},ect(t.__vtableChartTheme),cgt(this.orient,o.theme),ggt(this.orient,this.type,t.__vtableChartTheme),t),this.orient==="left"||this.orient==="right"?(this.width=e,this.height=i-r[0]-r[2]-0,this.y=r[0]+0):(this.orient==="top"||this.orient==="bottom")&&(this.width=e-r[1]-r[3]-0,this.height=i,this.x=r[3]+0),this.visible=(l=t.visible)===null||l===void 0||l,this.inverse="inverse"in t&&!!t.inverse,t.type==="band"&&(this.data=t.domain),this.initScale(),this.initData(),this.createComponent(),this.initEvent()}initScale(){const t=this.option;this.type==="band"||this.type==="point"?(this.scale=new egt,this.scale.bandPadding=t.bandPadding,this.scale.paddingInner=t.paddingInner,this.scale.paddingOuter=t.paddingOuter,this.scale.calcScales(.1,.3),this.scale.updateScaleDomain(this.data),this.updateScaleRange()):this.type!=="linear"&&this.type!=="time"&&this.type!=="log"&&this.type!=="symlog"||(this.scale=new agt(this.type),this.scale.setExtraAttrFromSpec(t.nice,t.zero,t.range,t.expand,t.base,t.constant),this.scale.transformScaleDomain(),this.scale.updateScaleDomain(),this.updateScaleRange())}initData(){this.table._vDataSet||(this.table._vDataSet=new Zdt),ngt(this.table._vDataSet,"scale",ugt),igt(this.table._vDataSet,"ticks",Kit);const t=this.option.label||{},e=this.option.tick||{},i=new DF(this.table._vDataSet).parse(this.scale._scale,{type:"scale"}).transform({type:"ticks",options:{sampling:this.option.sampling!==!1,tickCount:e.tickCount,forceTickCount:e.forceTickCount,tickStep:e.tickStep,tickMode:e.tickMode,noDecimals:e.noDecimals,axisOrientType:this.orient,coordinateType:"cartesian",labelStyle:t.style,labelFormatter:t.formatMethod,labelGap:t.minGap,labelLastVisible:t.lastVisible,labelFlush:t.flush}},!1);this.tickData=i,this.computeData()}computeData(){this.tickData.reRunAllTransform()}initEvent(){}createComponent(){const t=aP(this.option),e=this.getUpdateAttribute();e.verticalFactor=this.orient==="top"||this.orient==="right"?-1:1,this.component=new Dc(xe({disableTriggerEvent:this.table.options.disableInteraction},t,e)),this.component.setAttributes(this.setLayoutStartPosition({x:this.x,y:this.y})),this.component.originAxis=this}resize(t,e){this.width=t-(this.orient==="top"||this.orient==="bottom"?this.padding[1]+this.padding[3]:0),this.height=e-(this.orient==="left"||this.orient==="right"?this.padding[2]+this.padding[0]:0),this.updateScaleRange(),this.computeData();const i=aP(this.option),r=this.getUpdateAttribute();r.verticalFactor=this.orient==="top"||this.orient==="right"?-1:1,this.component.setAttributes(xe({},i,r)),this.component.setAttributes(this.setLayoutStartPosition({x:this.x,y:this.y})),this.overlap()}overlap(){lgt(this.component,this)}getLayoutRect(){return{width:this.width,height:this.height}}getUpdateAttribute(){this.table.tableNoFrameHeight,this.table.tableNoFrameWidth;const{width:t,height:e}=this.getLayoutRect(),i=f1(this.orient),r=yct(this.orient);let o={x:0,y:0},s=0;i?(o={x:t,y:0},s=t):r&&(o={x:0,y:e},s=e);const a=this.orient==="top"||this.orient==="bottom"?e:t;return{start:{x:0,y:0},end:o,title:{text:this.option.title.text,maxWidth:this._getTitleLimit(i)},items:this.getLabelItems(s),verticalLimitSize:a,verticalMinSize:a}}getLabelItems(t){return[this.tickData.latestData.map((e=>({id:e.value,label:e.value,value:t===0?0:this.scale.dataToPosition([e.value])/t,rawValue:e.value}))).filter((e=>e.value>=0&&e.value<=1))]}updateScaleRange(){var t,e,i,r,o,s,a,l;const h=(e=(t=this.option.innerOffset)===null||t===void 0?void 0:t.right)!==null&&e!==void 0?e:0,u=(r=(i=this.option.innerOffset)===null||i===void 0?void 0:i.left)!==null&&r!==void 0?r:0,d=(s=(o=this.option.innerOffset)===null||o===void 0?void 0:o.top)!==null&&s!==void 0?s:0,c=(l=(a=this.option.innerOffset)===null||a===void 0?void 0:a.bottom)!==null&&l!==void 0?l:0,{width:g,height:f}=this.getLayoutRect(),p=this.option.inverse||!1;let m=[0,0];f1(this.orient)?pl(g)&&(m=p?[g-h,u]:[u,g-h]):pl(f)&&(m=p?[d,f-c]:[f-c,d]),this.scale.updateRange(m)}setLayoutStartPosition(t){let{x:e,y:i}=t;return pl(e)&&(e+=+(this.orient==="left")*this.getLayoutRect().width),pl(i)&&(i+=+(this.orient==="top")*this.getLayoutRect().height),{x:e,y:i}}_getTitleLimit(t){var e,i,r;if(this.option.title.visible&&he((e=this.option.title.style)===null||e===void 0?void 0:e.maxLineWidth)){let o=((i=this.option.title.style)===null||i===void 0?void 0:i.angle)||0;if(!((r=this.option.title)===null||r===void 0)&&r.autoRotate&&he(this.option.title.angle)&&(o=this.option.orient==="left"?-90:90),t){const l=this.getLayoutRect().width,h=Math.abs(Math.cos(D0(o)));return h<1e-6?1/0:l/h}const s=this.getLayoutRect().height,a=Math.abs(Math.sin(D0(o)));return a<1e-6?1/0:s/a}return null}getScale(){return this.scale._scale}getDomainSpec(){return this.scale.domain}}function cgt(n,t){let e;return n==="left"?e=t.axisStyle.leftAxisStyle:n==="right"?e=t.axisStyle.rightAxisStyle:n==="top"?e=t.axisStyle.topAxisStyle:n==="bottom"&&(e=t.axisStyle.bottomAxisStyle),xe({},t.axisStyle.defaultAxisStyle,e)}function ggt(n,t,e){if(!e)return{};const i=e.axis;let r,o;return t==="linear"||t==="log"||t==="symlog"?r=e.axisLinear:t==="band"&&(r=e.axisBand),n==="top"||n==="bottom"?o=e.axisX:n!=="left"&&n!=="right"||(o=e.axisY),xe({},i,r,o)}function fgt(n,t){var e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y;const C=xe({},Rm,n);let w=0;C.tick.visible!==!1&&(w=(e=C.tick.width)!==null&&e!==void 0?e:4);let _=0;if(C.label.visible){if(C.type==="band")C.domain.forEach((x=>{var S,T,M,R,E,P,B,k,L,O,I,H,D,z,G,U;C.label.formatMethod&&(x=C.label.formatMethod(x));const{width:j,height:X}=t.measureText(x,{fontSize:(M=(T=(S=C.label)===null||S===void 0?void 0:S.style)===null||T===void 0?void 0:T.fontSize)!==null&&M!==void 0?M:Vh,fontWeight:(P=(E=(R=C.label)===null||R===void 0?void 0:R.style)===null||E===void 0?void 0:E.fontWeight)!==null&&P!==void 0?P:"normal",fontFamily:(L=(k=(B=C.label)===null||B===void 0?void 0:B.style)===null||k===void 0?void 0:k.fontFamily)!==null&&L!==void 0?L:jh}),Z=((I=(O=C.label)===null||O===void 0?void 0:O.style)===null||I===void 0?void 0:I.maxLineWidth)||1/0,J=((z=(D=(H=C.label)===null||H===void 0?void 0:H.style)===null||D===void 0?void 0:D.angle)!==null&&z!==void 0?z:0)+(((U=(G=C.label)===null||G===void 0?void 0:G.style)===null||U===void 0?void 0:U.direction)==="vertical"?90:0);_=Math.max(_,Gh(Math.min(j,Z),X,J).width)}));else{let x;if(!((i=n.sync)===null||i===void 0)&&i.tickAlign&&ur((r=n.tick)===null||r===void 0?void 0:r.tickMode))x=n.tick.tickMode();else if(wt(n.__ticksForVTable))x=n.__ticksForVTable;else{const S=C.range,T=Math.abs(S.min)>1?Math.round(S.min):S.min,M=Math.abs(S.max)>1?Math.round(S.max):S.max;x=[Lm(T),Lm(M)]}x.forEach((S=>{var T,M,R,E,P,B,k,L,O,I,H,D,z,G,U,j;C.label.formatMethod&&(S=C.label.formatMethod(S));const{width:X,height:Z}=t.measureText(S,{fontSize:(R=(M=(T=C.label)===null||T===void 0?void 0:T.style)===null||M===void 0?void 0:M.fontSize)!==null&&R!==void 0?R:Vh,fontWeight:(B=(P=(E=C.label)===null||E===void 0?void 0:E.style)===null||P===void 0?void 0:P.fontWeight)!==null&&B!==void 0?B:"normal",fontFamily:(O=(L=(k=C.label)===null||k===void 0?void 0:k.style)===null||L===void 0?void 0:L.fontFamily)!==null&&O!==void 0?O:jh}),J=((H=(I=C.label)===null||I===void 0?void 0:I.style)===null||H===void 0?void 0:H.maxLineWidth)||1/0,q=((G=(z=(D=C.label)===null||D===void 0?void 0:D.style)===null||z===void 0?void 0:z.angle)!==null&&G!==void 0?G:0)+(((j=(U=C.label)===null||U===void 0?void 0:U.style)===null||j===void 0?void 0:j.direction)==="vertical"?90:0);_=Math.max(_,Gh(Math.min(X,J),Z,q).width)}))}_+=(o=C.label.space)!==null&&o!==void 0?o:4}let A=0;if(C.title.visible&&Xe(C.title.text)){const{width:x,height:S}=t.measureText(C.title.text,{fontSize:(l=(a=(s=C.title)===null||s===void 0?void 0:s.style)===null||a===void 0?void 0:a.fontSize)!==null&&l!==void 0?l:Vh,fontWeight:(d=(u=(h=C.title)===null||h===void 0?void 0:h.style)===null||u===void 0?void 0:u.fontWeight)!==null&&d!==void 0?d:"normal",fontFamily:(f=(g=(c=C.title)===null||c===void 0?void 0:c.style)===null||g===void 0?void 0:g.fontFamily)!==null&&f!==void 0?f:jh}),T=((m=(p=C.label)===null||p===void 0?void 0:p.style)===null||m===void 0?void 0:m.maxLineWidth)||1/0,M=Gh(Math.min(x,T),S,(b=(v=C.title)===null||v===void 0?void 0:v.style)===null||b===void 0?void 0:b.angle);A=n.orient!=="left"&&n.orient!=="right"||!C.title.autoRotate?M.width:M.height,A+=(y=C.title.space)!==null&&y!==void 0?y:4}return Math.ceil(w+_+A+1)}function pgt(n,t){var e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y;const C=xe({},Rm,n);let w=0;C.tick.visible!==!1&&(w=(e=C.tick.width)!==null&&e!==void 0?e:4);let _=0;if(C.label.visible){if(C.type==="band")C.domain.forEach((x=>{var S,T,M,R,E,P,B,k,L,O,I,H,D,z,G,U;C.label.formatMethod&&(x=C.label.formatMethod(x));const{width:j,height:X}=t.measureText(x,{fontSize:(M=(T=(S=C.label)===null||S===void 0?void 0:S.style)===null||T===void 0?void 0:T.fontSize)!==null&&M!==void 0?M:Vh,fontWeight:(P=(E=(R=C.label)===null||R===void 0?void 0:R.style)===null||E===void 0?void 0:E.fontWeight)!==null&&P!==void 0?P:"normal",fontFamily:(L=(k=(B=C.label)===null||B===void 0?void 0:B.style)===null||k===void 0?void 0:k.fontFamily)!==null&&L!==void 0?L:jh}),Z=((I=(O=C.label)===null||O===void 0?void 0:O.style)===null||I===void 0?void 0:I.maxLineWidth)||1/0,J=((z=(D=(H=C.label)===null||H===void 0?void 0:H.style)===null||D===void 0?void 0:D.angle)!==null&&z!==void 0?z:0)+(((U=(G=C.label)===null||G===void 0?void 0:G.style)===null||U===void 0?void 0:U.direction)==="vertical"?90:0);_=Math.max(_,Gh(Math.min(j,Z),X,J).height)}));else{let x;if(!((i=n.sync)===null||i===void 0)&&i.tickAlign&&ur((r=n.tick)===null||r===void 0?void 0:r.tickMode))x=n.tick.tickMode();else if(wt(n.__ticksForVTable))x=n.__ticksForVTable;else{const S=C.range,T=Math.abs(S.min)>1?Math.round(S.min):S.min,M=Math.abs(S.max)>1?Math.round(S.max):S.max;x=[Lm(T),Lm(M)]}x.forEach((S=>{var T,M,R,E,P,B,k,L,O,I,H,D,z,G,U,j;C.label.formatMethod&&(S=C.label.formatMethod(S));const{width:X,height:Z}=t.measureText(S,{fontSize:(R=(M=(T=C.label)===null||T===void 0?void 0:T.style)===null||M===void 0?void 0:M.fontSize)!==null&&R!==void 0?R:Vh,fontWeight:(B=(P=(E=C.label)===null||E===void 0?void 0:E.style)===null||P===void 0?void 0:P.fontWeight)!==null&&B!==void 0?B:"normal",fontFamily:(O=(L=(k=C.label)===null||k===void 0?void 0:k.style)===null||L===void 0?void 0:L.fontFamily)!==null&&O!==void 0?O:jh}),J=((H=(I=C.label)===null||I===void 0?void 0:I.style)===null||H===void 0?void 0:H.maxLineWidth)||1/0,q=((G=(z=(D=C.label)===null||D===void 0?void 0:D.style)===null||z===void 0?void 0:z.angle)!==null&&G!==void 0?G:0)+(((j=(U=C.label)===null||U===void 0?void 0:U.style)===null||j===void 0?void 0:j.direction)==="vertical"?90:0);_=Math.max(_,Gh(Math.min(X,J),Z,q).height)}))}_+=(o=C.label.space)!==null&&o!==void 0?o:4}let A=0;if(C.title.visible&&C.title.text){const{width:x,height:S}=t.measureText(C.title.text,{fontSize:(l=(a=(s=C.title)===null||s===void 0?void 0:s.style)===null||a===void 0?void 0:a.fontSize)!==null&&l!==void 0?l:Vh,fontWeight:(d=(u=(h=C.title)===null||h===void 0?void 0:h.style)===null||u===void 0?void 0:u.fontWeight)!==null&&d!==void 0?d:"normal",fontFamily:(f=(g=(c=C.title)===null||c===void 0?void 0:c.style)===null||g===void 0?void 0:g.fontFamily)!==null&&f!==void 0?f:jh}),T=((m=(p=C.label)===null||p===void 0?void 0:p.style)===null||m===void 0?void 0:m.maxLineWidth)||1/0,M=Gh(Math.min(x,T),S,(b=(v=C.title)===null||v===void 0?void 0:v.style)===null||b===void 0?void 0:b.angle);A=n.orient!=="bottom"&&n.orient!=="top"||!C.title.autoRotate?M.height:M.width,A+=(y=C.title.space)!==null&&y!==void 0?y:4}return w+_+A+1}function Lm(n){return typeof n!="number"&&(n=Number(n)),Number(n.toPrecision(1)).toString()}function Gh(n,t,e=0){const i=e*Math.PI/180,r=-n/2,o=-t/2,s=n/2,a=-t/2,l=n/2,h=t/2,u=-n/2,d=t/2,c={x:r*Math.cos(i)-o*Math.sin(i),y:r*Math.sin(i)+o*Math.cos(i)},g={x:s*Math.cos(i)-a*Math.sin(i),y:s*Math.sin(i)+a*Math.cos(i)},f={x:l*Math.cos(i)-h*Math.sin(i),y:l*Math.sin(i)+h*Math.cos(i)},p={x:u*Math.cos(i)-d*Math.sin(i),y:u*Math.sin(i)+d*Math.cos(i)},m=Math.min(c.x,g.x,f.x,p.x),v=Math.max(c.x,g.x,f.x,p.x),b=Math.min(c.y,g.y,f.y,p.y);return{width:v-m,height:Math.max(c.y,g.y,f.y,p.y)-b}}const mgt='<svg t="1716726614852" class="icon" viewBox="0 0 1194 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2621" width="200" height="200"><path d="M1038.694079 367.237067c13.265507 23.342857-16.633865-40.004445-63.05621-40.004446H219.018794c-26.558738 0-46.46393 13.334815-63.05621 40.004446S0.006238 607.277601 0.006238 650.608819V940.647979a82.351494 82.351494 0 0 0 82.961402 83.349526H1111.702885a82.337632 82.337632 0 0 0 82.975264-83.349526V650.608819c0-43.331218-155.970208-283.371753-155.970208-283.371752zM730.066575 667.284269a136.328386 136.328386 0 0 1-132.738243 133.33429 133.417459 133.417459 0 0 1-132.738243-133.33429v-6.681269a40.6698 40.6698 0 0 0-36.497473-26.66963H73.015044l119.458874-220.02445s23.231965-40.004445 53.103614-40.004446h713.481918c26.544876 0 29.871649 10.008042 46.436207 40.004446L1128.33675 633.947231H769.904682c-26.184476 0-39.838107 7.623855-39.838107 33.337038zM338.505391 210.559919l-89.601086-86.69016a22.178487 22.178487 0 0 1 0-33.26773 21.984425 21.984425 0 0 1 33.170699 0l89.601087 86.676299a22.317102 22.317102 0 0 1 0 33.26773 24.950798 24.950798 0 0 1-33.1707 0z m252.197118-40.059891a25.532983 25.532983 0 0 1-6.639685-16.633865l-3.326773-126.694606A28.263709 28.263709 0 0 1 603.995739 0.515788c13.251646-3.326773 23.204242 10.021904 26.544877 23.342858V153.866163a28.249847 28.249847 0 0 1-23.259688 26.66963c-6.611961-3.312911-13.279369-3.312911-16.578419-10.035765z m235.646421 33.337038a22.372548 22.372548 0 0 1 0-33.337038l86.288175-90.030795a22.039871 22.039871 0 0 1 33.170699 0 22.289379 22.289379 0 0 1 0 33.364761l-82.961401 90.003072a25.962691 25.962691 0 0 1-36.483611 0z" fill="#8a8a8a" p-id="2622"></path></svg>';class vgt{constructor(t,e){this._emptyTipOption={spaceBetweenTextAndIcon:20,text:"no data",textStyle:{fontSize:14,color:"#000"},icon:{image:mgt,width:100,height:100}},this.isReleased=!1,this.table=e,this._emptyTipOption=Object.assign(this._emptyTipOption,t===!0?{}:t),$(this._emptyTipOption.displayMode)||(this.table.isListTable()?this._emptyTipOption.displayMode="basedOnTable":this._emptyTipOption.displayMode="basedOnContainer"),this._emptyTipComponent=this._createOrUpdateEmptyTipComponent(this._getEmptyTipAttrs())}_createOrUpdateEmptyTipComponent(t){if(this._emptyTipComponent)Nc(t,this._cacheAttrs)||this._emptyTipComponent.setAttributes(t);else{const e=new rD(t);e.name="emptyTip",this.table.scenegraph.stage.defaultLayer.appendChild(e),this._emptyTipComponent=e,this.bindEvents()}return this._emptyTipComponent}bindEvents(){this._emptyTipComponent.on("click",(t=>{const e=new $d;this._emptyTipComponent.forEachChildren((i=>{e.union(i.globalAABBBounds)})),e.contains(t.x,t.y)&&this.table.fireListeners("empty_tip_click",t)})),this._emptyTipComponent.on("dblclick",(t=>{const e=new $d;this._emptyTipComponent.forEachChildren((i=>{e.union(i.globalAABBBounds)})),e.contains(t.x,t.y)&&this.table.fireListeners("empty_tip_dblclick",t)}))}resize(){var t;if(!this._emptyTipComponent)return;const{leftHeaderWidth:e,topHeaderHeight:i,width:r,height:o}=this.getWidthAndHeight();this._emptyTipComponent.setAttributes({spaceBetweenTextAndIcon:this._emptyTipOption.spaceBetweenTextAndIcon,x:this.table.tableX+e,y:this.table.tableY+i,width:r,height:o,text:Object.assign(Object.assign({text:this._emptyTipOption.text},this._emptyTipOption.textStyle),{fill:(t=this._emptyTipOption.textStyle)===null||t===void 0?void 0:t.color}),icon:Object.assign({},this._emptyTipOption.icon)})}release(){this._emptyTipComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this._emptyTipComponent),this._emptyTipComponent=null,this.isReleased=!0}resetVisible(){(this.table.recordsCount&&this.table.recordsCount!==0||this.table.internalProps.layoutMap.rowCount!==this.table.internalProps.layoutMap.columnHeaderLevelCount)&&this.table.internalProps.layoutMap.colCount!==this.table.internalProps.layoutMap.rowHeaderLevelCount?this.table.scenegraph.stage.defaultLayer.children.includes(this._emptyTipComponent)&&this.table.scenegraph.stage.defaultLayer.removeChild(this._emptyTipComponent):this.table.scenegraph.stage.defaultLayer.children.includes(this._emptyTipComponent)||this.table.scenegraph.stage.defaultLayer.appendChild(this._emptyTipComponent)}getWidthAndHeight(){const t=this.table.transpose||this.table.options.indicatorsAsCol===!1?this.table.getFrozenColsWidth():0,e=!this.table.transpose||this.table.options.indicatorsAsCol?this.table.getFrozenRowsHeight():0;return{leftHeaderWidth:t,topHeaderHeight:e,width:(this._emptyTipOption.displayMode!=="basedOnContainer"&&this.table.columnHeaderLevelCount>0&&this.table.colCount>this.table.rowHeaderLevelCount?this.table.getDrawRange().width:this.table.tableNoFrameWidth)-t-this.table.getTheme().scrollStyle.width,height:(this._emptyTipOption.displayMode!=="basedOnContainer"&&this.table.rowHeaderLevelCount>0&&this.table.rowCount>this.table.columnHeaderLevelCount?this.table.getDrawRange().height:this.table.tableNoFrameHeight)-e-this.table.getTheme().scrollStyle.width}}_getEmptyTipAttrs(){var t;const{leftHeaderWidth:e,topHeaderHeight:i,width:r,height:o}=this.getWidthAndHeight();return{spaceBetweenTextAndIcon:this._emptyTipOption.spaceBetweenTextAndIcon,x:this.table.tableX+e,y:this.table.tableY+i,width:r,height:o,text:Object.assign(Object.assign({text:this._emptyTipOption.text},this._emptyTipOption.textStyle),{fill:(t=this._emptyTipOption.textStyle)===null||t===void 0?void 0:t.color}),icon:Object.assign({},this._emptyTipOption.icon)}}}var bgt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const ygt={orient:"bottom",position:"middle",padding:30,title:{visible:!1,padding:0,textStyle:{fontSize:14,fill:"#000000",fontWeight:"normal"},space:12},item:{visible:!0,spaceCol:10,spaceRow:10,padding:2,background:{state:{selectedHover:{fill:"gray",fillOpacity:.7},unSelectedHover:{fill:"gray",fillOpacity:.2}}},shape:{space:4,state:{unSelected:{fillOpacity:.5}}},label:{space:4,style:{fill:"#89909D",fontSize:14},state:{unSelected:{fillOpacity:.5}}}},allowAllCanceled:!0,visible:!0};function Cgt(n,t){const e=xe({},ygt,n),{title:i={},item:r={},pager:o={},background:s={},type:a,id:l,visible:h,orient:u,position:d,data:c,filter:g,regionId:f,regionIndex:p,seriesIndex:m,seriesId:v,padding:b}=e,y=bgt(e,["title","item","pager","background","type","id","visible","orient","position","data","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return i.visible&&(y.title=zF(i)),dn(r.focusIconStyle)||ci(r.focusIconStyle),Zr(r.shape),Zr(r.label),Zr(r.value),Zr(r.background),_C(r.maxWidth)&&(r.maxWidth=Number(r.maxWidth.substring(0,r.maxWidth.length-1))*t.width/100),_C(r.width)&&(r.width=Number(r.width.substring(0,r.width.length-1))*t.width/100),_C(r.height)&&(r.height=Number(r.height.substring(0,r.height.length-1))*t.width/100),y.item=r,dn(o.textStyle)||ci(o.textStyle),Zr(o.handler),y.pager=o,s.visible&&!dn(s.style)&&(xe(y,s.style),$(s.padding)&&(y.padding=s.padding)),y}class _gt{constructor(t,e){var i,r,o,s;this.table=e,this.option=Ul(t),this.orient=(i=t.orient)!==null&&i!==void 0?i:"left",this.visible=(r=t.visible)===null||r===void 0||r,this.position=(o=t.position)!==null&&o!==void 0?o:"middle",this.selectedData=(s=t.defaultSelected)!==null&&s!==void 0?s:null,this.createComponent(),this.initEvent()}createComponent(){const t=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),e=new Av(xe({},t,{defaultSelected:this.selectedData,disableTriggerEvent:this.table.options.disableInteraction}));e.name="legend",this.legendComponent=e,this.visible===!1&&(e.setAttributes({visible:!1,visibleAll:!1}),e.hideAll()),this.table.scenegraph.stage.defaultLayer.appendChild(e),this.adjustTableSize(t)}resize(){if(!this.legendComponent||this.visible===!1)return;const t=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight});this.legendComponent.setAttributes(t),this.adjustTableSize(this.legendComponent.attribute)}adjustTableSize(t){var e,i;if(!this.legendComponent||this.visible===!1)return;let r=isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,o=isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0;if(r<=0||o<=0)return;const s=this.table.tableNoFrameWidth,a=this.table.tableNoFrameHeight,l=Kt((i=(e=t.padding)!==null&&e!==void 0?e:this.option.padding)!==null&&i!==void 0?i:10);let h=0,u=0;this.orient==="left"?(h=l[3],u=0,r+=l[1]+l[3]):this.orient==="top"?(h=0,u=l[0],o+=l[0]+l[2]):this.orient==="right"?(h=s-r-l[1],u=0,r+=l[1]+l[3]):this.orient==="bottom"&&(h=0,u=a-o-l[2],o+=l[0]+l[2]);const d=this.orient==="bottom"||this.orient==="top"?"horizontal":"vertical",c=this.position;let g=0,f=0;d==="horizontal"?g=c==="middle"?(s-r)/2:c==="end"?s-r-l[1]:l[3]:f=c==="middle"?(a-o)/2:c==="end"?a-o-l[2]:l[0],this.legendComponent.setAttributes({dx:g,dy:f,x:h,y:u}),this.orient==="left"?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r),this.table.tableX+=Math.ceil(r)):this.orient==="top"?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(o),this.table.tableY+=Math.ceil(o)):this.orient==="right"?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r):this.orient==="bottom"&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(o))}getLegendAttributes(t){var e,i;const r=this.orient==="bottom"||this.orient==="top"?"horizontal":"vertical",o=Cgt(this.option,t),s=Kt((i=(e=o.padding)!==null&&e!==void 0?e:this.option.padding)!==null&&i!==void 0?i:10);return Object.assign({layout:r,items:this.getLegendItems(),maxWidth:t.width-s[1]-s[3],maxHeight:t.height-s[0]-s[2]},o)}getLegendItems(){return this.option.data}initEvent(){this.legendComponent&&(this.legendComponent.addEventListener(xr.legendItemClick,(t=>{const e=Uf(t,"detail.currentSelected");this.table.fireListeners(tt.LEGEND_ITEM_CLICK,{model:this,value:e,event:t})})),this.legendComponent.addEventListener(xr.legendItemHover,(t=>{const e=Uf(t,"detail");this.table.fireListeners(tt.LEGEND_ITEM_HOVER,{model:this,value:e,event:t})})),this.legendComponent.addEventListener(xr.legendItemUnHover,(t=>{const e=Uf(t,"detail");this.table.fireListeners(tt.LEGEND_ITEM_UNHOVER,{model:this,value:e,event:t})})),this.legendComponent.addEventListener("legendItemAttributeUpdate",(t=>{this.table.scenegraph.updateNextFrame()})))}getLegendBounds(){return{width:isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,height:isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0}}release(){this.legendComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent),this.legendComponent=null}}var wgt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const Om={orient:"right",position:"middle",padding:30,title:{visible:!1,padding:0,textStyle:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"titleFontColor"}},space:12},handler:{visible:!0},startText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}},endText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}},handlerText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}}},xgt={horizontal:Object.assign(Object.assign({},Om),{rail:{width:200,height:8,style:{fill:"rgba(0,0,0,0.04)"}}}),vertical:Object.assign(Object.assign({},Om),{rail:{width:8,height:200,style:{fill:"rgba(0,0,0,0.04)"}}})},Sgt={horizontal:Object.assign({sizeBackground:{fill:"#cdcdcd"},track:{style:{fill:"rgba(20,20,20,0.1)"}},rail:{width:200,height:4,style:{fill:"rgba(0,0,0,0.04)"}}},Om),vertical:Object.assign({sizeBackground:{fill:"#cdcdcd"},track:{style:{fill:"rgba(20,20,20,0.1)"}},rail:{width:4,height:200,style:{fill:"rgba(0,0,0,0.04)"}}},Om)};function Agt(n,t){const e=xe({},(n.type==="color"?xgt:Sgt)[n.orient==="bottom"||n.orient==="top"?"horizontal":"vertical"],n),{title:i={},handler:r={},rail:o={},track:s={},startText:a,endText:l,handlerText:h,sizeBackground:u,background:d={},type:c,id:g,visible:f,orient:p,position:m,data:v,defaultSelected:b,field:y,filter:C,regionId:w,regionIndex:_,seriesIndex:A,seriesId:x,padding:S}=e,T=wgt(e,["title","handler","rail","track","startText","endText","handlerText","sizeBackground","background","type","id","visible","orient","position","data","defaultSelected","field","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return i.visible&&(T.title=zF(i)),T.showHandler=r.visible!==!1,dn(r.style)||(T.handlerStyle=ci(r.style)),$(o.width)&&(T.railWidth=o.width),$(o.height)&&(T.railHeight=o.height),dn(o.style)||(T.railStyle=ci(o.style)),dn(s.style)||(T.trackStyle=ci(s.style)),T.startText=Zr(a),T.endText=Zr(l),T.handlerText=Zr(h),dn(u)||(T.sizeBackground=ci(u)),d.visible&&!dn(d.style)&&(xe(T,d.style),$(d.padding)&&(T.padding=d.padding)),T}class Mgt{constructor(t,e){var i,r,o,s;this.table=e,this.option=Ul(t),this.orient=(i=t.orient)!==null&&i!==void 0?i:"left",this.visible=(r=t.visible)===null||r===void 0||r,this.position=(o=t.position)!==null&&o!==void 0?o:"middle",this.selectedData=(s=t.defaultSelected)!==null&&s!==void 0?s:null,this.createComponent(),this.initEvent()}createComponent(){const t=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight});let e;e=this.option.type==="color"?new Mv(xe({},t,{slidable:!0})):new Tv(xe({},t,{slidable:!0})),e.name="legend",this.legendComponent=e,this.visible===!1&&(e.setAttributes({visible:!1,visibleAll:!1}),e.hideAll()),this.table.scenegraph.stage.defaultLayer.appendChild(e),this.adjustTableSize(t)}resize(){this.legendComponent&&this.visible!==!1&&(this.legendComponent.setAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),this.adjustTableSize(this.legendComponent.attribute))}adjustTableSize(t){var e,i;if(!this.legendComponent||this.visible===!1)return;let r=isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,o=isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0;if(r<=0||o<=0)return;const s=this.table.tableNoFrameWidth,a=this.table.tableNoFrameHeight,l=Kt((i=(e=t.padding)!==null&&e!==void 0?e:this.option.padding)!==null&&i!==void 0?i:10);let h=0,u=0;this.orient==="left"?(h=l[3],u=0,r+=l[1]+l[3]):this.orient==="top"?(h=0,u=l[0],o+=l[0]+l[2]):this.orient==="right"?(h=s-r-l[1],u=0,r+=l[1]+l[3]):this.orient==="bottom"&&(h=0,u=a-o-l[2],o+=l[0]+l[2]);const d=this.orient==="bottom"||this.orient==="top"?"horizontal":"vertical",c=this.position;let g=0,f=0;d==="horizontal"?g=c==="middle"?(s-r)/2:c==="end"?s-r-l[1]:l[3]:f=c==="middle"?(a-o)/2:c==="end"?a-o-l[2]:l[0],this.legendComponent.setAttributes({dx:g,dy:f,x:h,y:u}),this.orient==="left"?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r),this.table.tableX+=Math.ceil(r)):this.orient==="top"?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(o),this.table.tableY+=Math.ceil(o)):this.orient==="right"?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r):this.orient==="bottom"&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(o))}getLegendAttributes(t){const e=this.orient==="bottom"||this.orient==="top"?"horizontal":"vertical",i=e==="horizontal"?"bottom":this.orient;return Object.assign(Object.assign({},Agt(this.option)),{layout:e,align:i,min:this.option.min,max:this.option.max,value:this.option.value,[this.option.type==="color"?"colors":"sizeRange"]:this.option.type==="color"?this.option.colors:this.option.sizeRange})}initEvent(){this.legendComponent&&this.legendComponent.addEventListener("change",(t=>{const e=Uf(t,"detail.value");this.table.fireListeners(tt.LEGEND_CHANGE,{model:this,value:e,event:t}),this.table.scenegraph.updateNextFrame()}))}getLegendBounds(){return{width:isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,height:isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0}}release(){this.legendComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent),this.legendComponent=null}}function Tgt(n,t){return n.type==="color"||n.type==="size"?new Mgt(n,t):new _gt(n,t)}class nz{constructor(t){this._table=t}release(){this.unbindMenuElement(),this._menuElement&&this._menuElement.release(),this._menuElement=void 0}_getMenuElement(){return this._menuElement||(this._menuElement=this.createMenuElementInternal()),this._menuElement}bindMenuElement(t,e,i){return this._getMenuElement().bindToCell(this._table,t,e,i)}unbindMenuElement(){this._getMenuElement().unbindFromCell()}pointInMenuElement(t,e){return this._getMenuElement().pointInMenuElement(t,e)}getRootElement(){return this._getMenuElement().rootElement}}const pS="vtable__menu-element",ph=`${pS}--hidden`,GC=`${pS}--shown`;function Rgt(){return Ro("div",[pS,ph])}class Bgt{constructor(t){var e,i,r;this._handler=new Ev,this._rootElement=Rgt(),this._rootElement.addEventListener("wheel",(o=>{o.stopPropagation()})),(e=this._rootElement)===null||e===void 0||e.addEventListener("mousedown",(o=>{o.stopPropagation(),o.preventDefault()})),(i=this._rootElement)===null||i===void 0||i.addEventListener("click",(o=>{if(o.stopPropagation(),o.preventDefault(),this._rootElement.classList.contains(ph))return;const{col:s,row:a,dropDownIndex:l,menuKey:h,text:u,hasChildren:d}=o.target;if(typeof l!="number"||d)return void o.stopPropagation();const c=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(s,a):t.getHeaderField(s,a),g=t._dropDownMenuIsHighlight(s,a,l);t.fireListeners(tt.DROPDOWN_MENU_CLICK,{col:s,row:a,field:c,menuKey:h,text:u,highlight:g,cellLocation:t.getCellLocation(s,a),event:o}),t.fireListeners(tt.DROPDOWN_MENU_CLEAR,null),t.fireListeners(tt.HIDE_MENU,null),o.stopPropagation()})),(r=this._rootElement)===null||r===void 0||r.addEventListener("mousemove",(o=>{this._rootElement.classList.contains(ph)||o.stopPropagation()}))}get rootElement(){return this._rootElement}release(){this.unbindFromCell();const t=this._rootElement;t?.parentElement&&t.parentElement.removeChild(t),this._handler.release(),delete this._rootElement}bindToCell(t,e,i,r){const o=this._rootElement;if(this._menuInstanceInfo=r,o?.classList.remove(GC),o?.classList.add(ph),this._canBindToCell(t,e,i)){if(o.innerHTML="",o.appendChild(r.content),this._bindCell(t,e,i,r.position,r.referencePosition))return o?.classList.add(GC),o?.classList.remove(ph),!0}else this.unbindFromCell();return!1}unbindFromCell(){const t=this._rootElement;this._menuInstanceInfo=void 0,t?.parentElement&&(t.classList.remove(GC),t.classList.add(ph))}_canBindToCell(t,e,i){var r;const o=t.getCellRangeRelativeRect({col:e,row:i}),s=(r=t.internalProps.menu.parentElement)!==null&&r!==void 0?r:t.getElement(),{top:a,bottom:l,left:h,right:u}=o;if(t.isFrozenCell(e,i))return!0;if(l<t.getFrozenRowsHeight()||u<t.getFrozenColsWidth()||h>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||a>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:d,offsetWidth:c}=s;return!(d<a)&&!(c<h)}_bindCell(t,e,i,r,o){var s;const a=this._rootElement,l=(s=t.internalProps.menu.parentElement)!==null&&s!==void 0?s:t.getElement(),{width:h,height:u,left:d,top:c}=l.getBoundingClientRect();if(a){a.parentElement!==l&&l.appendChild(a),a.style.left="0px";const g=.8*h;a.style.maxWidth=`${g}px`;const f=a.clientWidth,p=a.clientHeight;let m,v;r&&(m=r.x,v=r.y),o&&(m=o.rect.right-f,v=o.rect.bottom),v+p>u&&(v=u-p,m+=f-2),v<0&&(v/=2);let b=0,y=0;if(t.getElement()!==l){const{left:C,top:w}=t.getElement().getBoundingClientRect();b=w-c,y=C-d}return a.style.top=`${v+b}px`,m<0?m=0:m+f>h&&(m=h-f),a.style.left=`${m+y}px`,!0}return!1}pointInMenuElement(t,e){const i=this._rootElement,{x:r,y:o,width:s,height:a}=i.getBoundingClientRect();return t>r-5&&t<r+s+5&&e>o-5&&e<o+a+5}}class AP extends nz{createMenuElementInternal(){return new qut(this._table)}}class kgt extends nz{createMenuElementInternal(){return new Bgt(this._table)}}const Pgt={"dropdown-menu":function(n){return new AP(n)},"context-menu":function(n){return new AP(n)},container:n=>new kgt(n)};function Egt(n,t,e,i,r){var o,s,a;if(t===-1&&e===-1&&i==="context-menu")return r?.content?{type:i,position:r.position,referencePosition:(o=r.referencePosition)!==null&&o!==void 0?o:{rect:{left:0,right:0,top:0,bottom:0,width:0,height:0}},content:r.content}:null;const{lineHeight:l,textBaseline:h,textStick:u}=n._getCellStyle(t,e);let d=n.getCellRangeRelativeRect(n.getCellRange(t,e));u&&(d=n.getVisibleCellRangeRelativeRect({col:t,row:e}));let{left:c,right:g,bottom:f,top:p,width:m,height:v}=d;if(n.isHeader(t,e)&&({left:c,right:g,bottom:f,top:p,width:m,height:v}=n.internalProps.headerHelper.getDropDownIconRect(d,l,h||"middle")),r?.content)return{type:i,position:r.position,referencePosition:(s=r.referencePosition)!==null&&s!==void 0?s:{rect:{left:c,right:g,top:p,bottom:f,width:m,height:v}},content:r.content};if(i==="dropdown-menu"){let b=n.globalDropDownMenu;const y=n._getHeaderLayoutMap(t,e);b=(a=y.dropDownMenu)!==null&&a!==void 0?a:b;const C=y.pivotInfo;return typeof b=="function"&&(b=b({row:e,col:t,table:n})),{type:i,referencePosition:{rect:{left:c,right:g,top:p,bottom:f,width:m,height:v}},content:b,pivotInfo:C}}return null}class Lgt{constructor(t){this._table=t,this._menuInstances={},this._bindTableEvent(t)}release(){const t=this._menuInstances;for(const e in t)t[e].release();delete this._menuInstances,this._attachInfo=null}_bindToCell(t,e,i,r){var o;const s=this._attachInfo,a=this._getMenuInstanceInfo(t,e,i,r);if(!s||a&&s.instance===a.instance||((o=s.instance)===null||o===void 0||o.unbindMenuElement(),this._attachInfo=null),!a)return;const{instance:l,info:h}=a;if(l&&l.bindMenuElement(t,e,h)){const u=t===-1&&e===-1?{start:{col:-1,row:-1},end:{col:-1,row:-1}}:this._table.getCellRange(t,e);this._attachInfo={range:u,instance:l}}}_unbindFromCell(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;e?.unbindMenuElement(),this._attachInfo=null}_isBindToCell(t,e){const i=this._attachInfo;return!!i&&Ir(i.range,t,e)}pointInMenuElement(t,e){if(!this._attachInfo)return!1;const i=this._attachInfo,{instance:r}=i;return r.pointInMenuElement(t,e)}_bindTableEvent(t){t.on(tt.DROPDOWN_ICON_CLICK,(e=>{this._attachInfo&&this._isBindToCell(e.col,e.row)?this._unbindFromCell():this._bindToCell(e.col,e.row,"dropdown-menu")})),t.on(tt.DROPDOWN_MENU_CLEAR,(e=>{this._unbindFromCell()})),t.on(tt.CONTEXTMENU_CELL,(e=>{var i,r,o,s;if(((i=t.internalProps.menu)===null||i===void 0?void 0:i.renderMode)==="html"){const a=t._getMouseAbstractPoint(e.event);let l=null;a.inTable&&typeof((r=t.internalProps.menu)===null||r===void 0?void 0:r.contextMenuItems)=="function"?l=t.internalProps.menu.contextMenuItems(t.getHeaderField(e.col,e.row),e.row,e.col,t):a.inTable&&Array.isArray((o=t.internalProps.menu)===null||o===void 0?void 0:o.contextMenuItems)&&(l=(s=t.internalProps.menu)===null||s===void 0?void 0:s.contextMenuItems),this._bindToCell(e.col,e.row,"context-menu",{content:l,position:{x:a.x,y:a.y}})}})),t.on(tt.CONTEXTMENU_CANVAS,(e=>{var i,r,o,s;if(((i=t.internalProps.menu)===null||i===void 0?void 0:i.renderMode)==="html"){const a=t._getMouseAbstractPoint(e.event);let l=null;a.inTable&&typeof((r=t.internalProps.menu)===null||r===void 0?void 0:r.contextMenuItems)=="function"?l=t.internalProps.menu.contextMenuItems(t.getHeaderField(e.col,e.row),e.row,e.col,t):a.inTable&&Array.isArray((o=t.internalProps.menu)===null||o===void 0?void 0:o.contextMenuItems)&&(l=(s=t.internalProps.menu)===null||s===void 0?void 0:s.contextMenuItems),this._bindToCell(-1,-1,"context-menu",{content:l,position:{x:a.x,y:a.y}})}}))}_getMenuInstanceInfo(t,e,i,r){const o=this._table,s=this._menuInstances,a=Egt(o,t,e,i,r);return a?{instance:s&&s[i]||s&&(s[i]=Pgt[i](o)),type:i,info:a}:null}containElement(t){var e;for(const i in this._menuInstances)if(!((e=this._menuInstances[i].getRootElement())===null||e===void 0)&&e.contains(t))return!0;return!1}}class Ogt{constructor(t,e){this.isReleased=!1,this.table=e,this._titleOption=xe({orient:"top"},t),t.visible!==!1&&(this._titleComponent=this._createOrUpdateTitleComponent(this._getTitleAttrs()))}_createOrUpdateTitleComponent(t){if(this._titleComponent)Nc(t,this._cacheAttrs)||this._titleComponent.setAttributes(t);else{const e=new iD(t);e.name="title",this.table.scenegraph.stage.defaultLayer.appendChild(e),this._titleComponent=e}return this._adjustTableSize(this._titleComponent.attribute),this._titleComponent}resize(){var t,e,i,r,o;if(!this._titleComponent)return;const s=Kt((t=this._titleOption.padding)!==null&&t!==void 0?t:10),a=(e=this._titleOption.width)!==null&&e!==void 0?e:(this.table.widthMode==="adaptive"?this.table.tableNoFrameWidth:Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width))-s[1]-s[3],l=(i=this._titleOption.height)!==null&&i!==void 0?i:(this.table.heightMode==="adaptive"?this.table.tableNoFrameHeight:Math.min(this.table.tableNoFrameHeight,this.table.getDrawRange().height))-s[0]-s[2];this._titleComponent.setAttributes({x:((r=this._titleOption.x)!==null&&r!==void 0?r:this._titleOption.orient==="right")?this.table.tableX+Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width):this.table.tableX,y:((o=this._titleOption.y)!==null&&o!==void 0?o:this._titleOption.orient==="bottom")?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY,width:this._titleOption.orient==="top"||this._titleOption.orient==="bottom"?a:this._titleOption.width,height:this._titleOption.orient==="left"||this._titleOption.orient==="right"?l:this._titleOption.height,textStyle:Object.assign({width:a},this._titleOption.textStyle),subtextStyle:Object.assign({width:a},this._titleOption.subtextStyle)}),this._adjustTableSize(this._titleComponent.attribute)}_adjustTableSize(t){var e,i,r,o;const s=isFinite((e=this._titleComponent)===null||e===void 0?void 0:e.AABBBounds.width())?this._titleComponent.AABBBounds.width():0,a=isFinite((i=this._titleComponent)===null||i===void 0?void 0:i.AABBBounds.height())?this._titleComponent.AABBBounds.height():0;this._titleOption.orient==="left"?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(s),this.table.tableX+=Math.ceil(s)):this._titleOption.orient==="top"?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(a),this.table.tableY+=Math.ceil(a)):this._titleOption.orient==="right"?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(s):this._titleOption.orient==="bottom"&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(a)),this._cacheAttrs=t,this._titleOption.orient!=="right"&&this._titleOption.orient!=="bottom"||this._titleComponent.setAttributes({x:((r=this._titleOption.x)!==null&&r!==void 0?r:this._titleOption.orient==="right")?this.table.tableX+this.table.tableNoFrameWidth:this.table.tableX,y:((o=this._titleOption.y)!==null&&o!==void 0?o:this._titleOption.orient==="bottom")?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY})}release(){this._titleComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this._titleComponent),this._titleComponent=null,this.isReleased=!0}_getTitleAttrs(){var t,e,i,r,o,s,a,l,h,u,d;const c=this._titleOption.text||this._titleOption.subtext?10:0,g=Kt((t=this._titleOption.padding)!==null&&t!==void 0?t:c),f=(e=this._titleOption.width)!==null&&e!==void 0?e:Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width)-g[1]-g[3],p=(i=this._titleOption.height)!==null&&i!==void 0?i:Math.min(this.table.tableNoFrameHeight,this.table.getDrawRange().height)-g[0]-g[2];return{text:(r=this._titleOption.text)!==null&&r!==void 0?r:"",subtext:(o=this._titleOption.subtext)!==null&&o!==void 0?o:"",x:((s=this._titleOption.x)!==null&&s!==void 0?s:this._titleOption.orient==="right")?this.table.tableX+Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width):this.table.tableX,y:((a=this._titleOption.y)!==null&&a!==void 0?a:this._titleOption.orient==="bottom")?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY,width:this._titleOption.orient==="top"||this._titleOption.orient==="bottom"?f:this._titleOption.width,height:this._titleOption.orient==="left"||this._titleOption.orient==="right"?p:this._titleOption.height,minWidth:this._titleOption.minWidth,maxWidth:this._titleOption.maxWidth,minHeight:this._titleOption.minHeight,maxHeight:this._titleOption.maxHeight,padding:this._titleOption.padding,align:(l=this._titleOption.align)!==null&&l!==void 0?l:"left",verticalAlign:(h=this._titleOption.verticalAlign)!==null&&h!==void 0?h:"top",textStyle:Object.assign({width:f},this._titleOption.textStyle),subtextStyle:Object.assign({width:f},this._titleOption.subtextStyle),dx:(u=this._titleOption.dx)!==null&&u!==void 0?u:0,dy:(d=this._titleOption.dy)!==null&&d!==void 0?d:0}}getComponentGraphic(){return this._titleComponent}}class Igt{constructor(t){this._table=t}release(){var t,e;this.unbindTooltipElement(),this._tooltipElement&&((e=(t=this._tooltipElement).release)===null||e===void 0||e.call(t)),this._tooltipElement=void 0}_getTooltipElement(){return this._tooltipElement||(this._tooltipElement=this.createTooltipElementInternal()),this._tooltipElement}bindTooltipElement(t,e,i,r){return this._getTooltipElement().bindToCell(this._table,t,e,i,r)}moveTooltipElement(t,e,i,r){this._getTooltipElement().move(this._table,t,e,i,r)}unbindTooltipElement(){this._getTooltipElement().unbindFromCell()}locateTooltipElement(t,e,i,r,o){this._getTooltipElement()._locate(this._table,t,e,i,r,o)}}function Hgt(){if(te.mode==="node")return;const n=document.createElement("style");n.id="vtable-tooltip-styleSheet",n.textContent=`
@keyframes vtable__bubble-tooltip-element--shown-animation {
	0% {
		opacity: 0;
	}
	100% {
		opacity: 1;
	}
}
.vtable__bubble-tooltip-element {
	position: absolute;
	
	// pointer-events: none;
	//user-select: none;
	max-width: 300px;
	z-index: 99999;

	background: #FFFFFF;
    border: 1px solid #E6E8ED;
    box-sizing: border-box;
    border-radius: 4px;
    box-shadow: 0px 2px 4px rgb(27 31 35 / 8%);
    color: #141414;
    font-size: 13px;
}
.vtable__bubble-tooltip-element--hidden {
	opacity: 0;
  pointer-events: none;
	user-select: none;
	/* transform: translate(-50%, -50%); */
	transition: opacity 75ms linear;
}
.vtable__bubble-tooltip-element--shown {
	opacity: 1;
	/* transform: translate(-50%, -50%); */
	animation: vtable__bubble-tooltip-element--shown-animation 150ms ease-out;
}
.vtable__bubble-tooltip-element__content {
	/* font-size: .75rem; */
	padding: 6px 8px;
	min-height: 1em;
	line-height: 1.5;
	width: 100%;
	display: block;
	white-space: pre-wrap;
	margin: 0;
	box-sizing: border-box;
	overflow: auto;
	word-wrap: break-word;
	position: relative;
	background-color: #FFF;
	z-index: 2;
	border-radius: 4px;
}
/*  WebKit Microsoft Edge（新版）： */
.vtable__bubble-tooltip-element__content::-webkit-scrollbar {
  width: 0;
  height: 0;
  background-color: transparent;
}
/*  Opera Firefox  */
.vtable__bubble-tooltip-element__content > scrollbar-track {
  width: 0;
  height: 0;
  background-color: transparent;
}
/* Internet Explorer 11 和 Microsoft Edge（旧版） */
.vtable__bubble-tooltip-element__content > scrollbar {
  width: 0;
  height: 0;
  background-color: transparent;
}
.vtable__bubble-tooltip-element__triangle {
	/* font-size: .75rem; */
	position: absolute;
	width: 10px;
	height: 10px;
	display: block;
	transform: rotate(45deg);
    transform-origin: 50% 50% 0;
	z-index: 1;
	background-color: #FFF;
	border: 1px solid #E6E8ED;
}
`,document.head.appendChild(n)}Hgt();const xg="vtable__bubble-tooltip-element",MP=`${xg}__content`,TP=`${xg}__triangle`,uh=`${xg}--hidden`,dd=`${xg}--shown`;class Dgt{constructor(){this._handler=new Ev;const t=this._rootElement=Ro("div",[xg,uh]),e=Ro("div",[MP]),i=Ro("span",[TP]);t.appendChild(i),t.appendChild(e),this._messageElement=t.querySelector(`.${MP}`)||void 0,this._triangleElement=t.querySelector(`.${TP}`)||void 0,t.addEventListener("mousemove",(()=>{this._disappearDelayId&&clearTimeout(this._disappearDelayId)})),t.addEventListener("mouseleave",(()=>{this._disappearDelay=void 0,this.unbindFromCell()})),e.addEventListener("wheel",(r=>{r.stopPropagation()})),e.addEventListener("copy",(r=>{Ert(e)&&r.stopPropagation()}))}bindToCell(t,e,i,r,o){var s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x;this._disappearDelay=r?.disappearDelay,this._disappearDelayId&&clearTimeout(this._disappearDelayId);const S=this._rootElement,T=this._messageElement,M=this._triangleElement;if(S?.classList.remove(dd),S?.classList.add(uh),this._canBindToCell(t,e,i)){if(T.setAttribute("style",""),M.setAttribute("style",""),r?.className&&S.classList.add(r.className),!((s=r?.style)===null||s===void 0)&&s.bgColor&&(T.style.backgroundColor=(a=r?.style)===null||a===void 0?void 0:a.bgColor),!((l=r?.style)===null||l===void 0)&&l.bgColor&&(M.style.backgroundColor=(h=r?.style)===null||h===void 0?void 0:h.bgColor),M.style.display=((u=r?.style)===null||u===void 0?void 0:u.arrowMark)===!0?"block":"none",!((d=r?.style)===null||d===void 0)&&d.fontSize&&(T.style.fontSize=((g=(c=r?.style)===null||c===void 0?void 0:c.fontSize)!==null&&g!==void 0?g:12)+"px"),!((f=r?.style)===null||f===void 0)&&f.fontFamily&&(T.style.fontFamily=(p=r?.style)===null||p===void 0?void 0:p.fontFamily),!((m=r?.style)===null||m===void 0)&&m.color&&(T.style.color=(v=r?.style)===null||v===void 0?void 0:v.color),!((b=r?.style)===null||b===void 0)&&b.padding&&(T.style.padding=`${(y=r?.style)===null||y===void 0?void 0:y.padding.join("px ")}px`),!((C=r?.style)===null||C===void 0)&&C.maxHeight&&(T.style.maxHeight=`${(w=r?.style)===null||w===void 0?void 0:w.maxHeight}px`),!((_=r?.style)===null||_===void 0)&&_.maxWidth&&(T.style.maxWidth=`${(A=r?.style)===null||A===void 0?void 0:A.maxWidth}px`),T&&(T.textContent=r?.content),this._bindToCell(t,e,i,r?.position,r?.referencePosition,o,(x=r?.style)===null||x===void 0?void 0:x.arrowMark))return S?.classList.add(dd),S?.classList.remove(uh),!0}else this.unbindFromCell();return!1}release(){var t,e;this.unbindFromCell();const i=this._rootElement;i?.parentElement&&i.parentElement.removeChild(i),(e=(t=this._handler)===null||t===void 0?void 0:t.release)===null||e===void 0||e.call(t),delete this._rootElement,delete this._messageElement}move(t,e,i,r,o){const s=this._rootElement;this._canBindToCell(t,e,i)?(this._bindToCell(t,e,i,r?.position,r?.referencePosition,o),s?.classList.add(dd),s?.classList.remove(uh)):this.unbindFromCell()}unbindFromCell(){var t;if(this._disappearDelay)this._disappearDelayId=setTimeout((()=>{const e=this._rootElement;e?.parentElement&&(e.classList.remove(dd),e.classList.add(uh))}),(t=this._disappearDelay)!==null&&t!==void 0?t:0);else{const e=this._rootElement;e?.parentElement&&(e.classList.remove(dd),e.classList.add(uh))}}_canBindToCell(t,e,i){const r=t.getCellRangeRelativeRect({col:e,row:i}),o=t.getElement(),{bottom:s,left:a,right:l,top:h}=r;if(t.isFrozenCell(e,i))return!0;if(s<t.getFrozenRowsHeight()||l<t.getFrozenColsWidth()||a>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||h>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:u,offsetWidth:d}=o;return!(h>u)&&!(a>d)}_bindToCell(t,e,i,r,o,s,a){const l=this._rootElement,h=t.getCellRangeRelativeRect({col:e,row:i}),u=t.internalProps.tooltip.parentElement,d=t.internalProps.element.offsetWidth,{width:c}=h;if(l){let g,f;l.parentElement!==u&&u.appendChild(l),l.style.left="0px";const p=Math.min(.8*d,4*c);l.style.maxWidth=`${p}px`;const m=l.clientWidth,v=l.clientHeight;if(!r&&!o)return!1;{const T=this.getComputedPosition(t,e,i,r,o,s,a);f=T.x,g=T.y}l.style.left=`${f}px`,l.style.top=`${g}px`,Uw()&&(l.style.fontSize="11px");const{x1:b,x2:y,y1:C,y2:w}=t.stateManager.menu.bounds,_=f,A=_+m,x=g,S=_+v;return!(t.stateManager.menu.isShow&&b<A&&y>_&&w>x&&C<S)}return!1}getComputedPosition(t,e,i,r,o,s,a){var l;const h=this._rootElement,u=t.getCellRangeRelativeRect({col:e,row:i}),{x:d,y:c}=t.internalProps.tooltip.parentElement.getBoundingClientRect(),{width:g,height:f,x:p,y:m}=t.internalProps.element.getBoundingClientRect(),{width:v}=u;let b,y;const C=Math.min(.8*g,4*v);h.style.maxWidth=`${C}px`;const w=h.clientWidth,_=h.clientHeight,A=a?6:0;if(r)y=r.x,b=r.y+A,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.top="-5px";else if(o){let x=(l=o.placement)!==null&&l!==void 0?l:Zn.bottom;const S=o.rect.left+o.rect.width/2,T=o.rect.top+o.rect.height/2,M=o.rect.top,R=o.rect.bottom,E=o.rect.left,P=o.rect.right;let B=0;const k=()=>{B++,B>=4||(this.removeStyleFromTriangle(),x===Zn.top?(y=S-w/2,b=M-_-A,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.bottom="-5px",s&&b<0&&(x=Zn.right,k())):x===Zn.bottom?(y=S-w/2,b=R+A,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.top="-5px",s&&b+_>f&&(x=Zn.left,k())):x===Zn.left?(b=T-_/2,y=E-w-A,this._triangleElement.style.top="50%",this._triangleElement.style.marginTop="-5px",this._triangleElement.style.right="-5px",s&&y<0&&(x=Zn.top,k())):x===Zn.right&&(b=T-_/2,y=P+A,this._triangleElement.style.top="50%",this._triangleElement.style.marginTop="-5px",this._triangleElement.style.left="-5px",s&&y+w>g&&(x=Zn.bottom,k())))};k()}return s&&(y<0?y=0:y+h.offsetWidth>g&&(y=g-h.offsetWidth)),{x:y+p-d,y:b+m-c}}removeStyleFromTriangle(){this._triangleElement.style.left="",this._triangleElement.style.right="",this._triangleElement.style.top="",this._triangleElement.style.bottom="",this._triangleElement.style.marginLeft="",this._triangleElement.style.marginTop=""}_locate(t,e,i,r,o,s){const a=this.getComputedPosition(t,e,i,r,o,s),l=a.x,h=a.y;this._rootElement.style.left=`${l}px`,this._rootElement.style.top=`${h}px`}}class Fgt extends Igt{createTooltipElementInternal(){return new Dgt}}const zgt={"bubble-tooltip":function(n){return new Fgt(n)}};class Ngt{constructor(t,e){this._table=t,this._tooltipInstances={},this._bindTableEvent(t),this.confine=e}release(){var t,e;const i=this._tooltipInstances;for(const r in i)(e=(t=i[r])===null||t===void 0?void 0:t.release)===null||e===void 0||e.call(t);delete this._tooltipInstances,this._attachInfo=null}_bindToCell(t,e,i){var r;const o=this._attachInfo,s=this._getTooltipInstanceInfo(t,e);if(!o||s&&o.instance===s||((r=o.instance)===null||r===void 0||r.unbindTooltipElement(),this._attachInfo=null),!!s&&s&&s.bindTooltipElement(t,e,i,this.confine)){const a=this._table.getCellRange(t,e);this._attachInfo={range:a,instance:s,tooltipOptions:i}}}_move(t,e,i){const r=this._attachInfo;if(!r||!Ir(r.range,t,e))return;const{instance:o}=r;o?.moveTooltipElement(t,e,i,this.confine)}moveToPosition(t,e,i,r){const o=this._attachInfo;if(!o||!Ir(o.range,t,e))return;const{instance:s}=o;this._attachInfo.tooltipOptions.position=i,this._attachInfo.tooltipOptions.referencePosition=r,s?.locateTooltipElement(t,e,i,r,this.confine)}_unbindFromCell(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;e?.unbindTooltipElement(),this._attachInfo=null}_isBindCell(t,e){const i=this._attachInfo;return!!i&&Ir(i.range,t,e)}_bindTableEvent(t){t.on(tt.MOUSEENTER_CELL,(e=>{if(Uw())return;const{x1:i,x2:r,y1:o,y2:s}=t.stateManager.menu.bounds;if(t.stateManager.menu.isShow&&typeof e.x=="number"&&typeof e.y=="number"&&e.x>i&&e.x<r&&e.y>o&&e.y<s)return;const{col:a,row:l}=e;this.showTooltip(a,l)})),t.on(tt.MOUSEMOVE_CELL,(e=>{var i,r;if(!Uw()){if(!((r=(i=this._attachInfo)===null||i===void 0?void 0:i.tooltipOptions)===null||r===void 0)&&r.referencePosition){const o=this._attachInfo.tooltipOptions.referencePosition,{event:s}=e,{left:a,right:l,top:h,bottom:u}=o.rect,d=t._getMouseAbstractPoint(s);d.inTable&&d.x>=a-5&&d.x<=l+5&&d.y>=h-5&&d.y<=u+5||this._unbindFromCell()}this._attachInfo&&t.stateManager.menu.isShow&&this._bindToCell(e.col,e.row)}})),t.on(tt.MOUSELEAVE_CELL,(e=>{this._unbindFromCell()})),t.on(tt.SELECTED_CELL,(e=>{this._isBindCell(e.col,e.row)&&this._unbindFromCell()})),t.on(tt.MOUSELEAVE_TABLE,(e=>{this._unbindFromCell()})),t.on(tt.SCROLL,(e=>{this._unbindFromCell()}))}showTooltip(t,e){var i,r,o;let s;const a=this._table,l=a.getHeaderDescription(t,e);if(l){const h=a.getCellRangeRelativeRect({col:t,row:e});s={content:l,referencePosition:{placement:a.internalProps.tooltip.position,rect:h},disappearDelay:(i=a.internalProps.tooltip.overflowTextTooltipDisappearDelay)!==null&&i!==void 0?i:0,style:a.theme.tooltipStyle}}else if(ur((r=a.internalProps.tooltip)===null||r===void 0?void 0:r.isShowOverflowTextTooltip)?a.internalProps.tooltip.isShowOverflowTextTooltip(t,e,a):a.internalProps.tooltip.isShowOverflowTextTooltip){const h=a.getCellOverflowText(t,e),u=a.getCellRangeRelativeRect({col:t,row:e});h&&(s={content:l?`${l}
  ${h}`:h,referencePosition:{placement:a.internalProps.tooltip.position,rect:u},disappearDelay:(o=a.internalProps.tooltip.overflowTextTooltipDisappearDelay)!==null&&o!==void 0?o:0,style:a.theme.tooltipStyle})}s?this._bindToCell(t,e,s):this._unbindFromCell()}_getTooltipInstanceInfo(t,e){const i=this._table,r=this._tooltipInstances;return r&&r["bubble-tooltip"]||r&&(r["bubble-tooltip"]=zgt["bubble-tooltip"](i))}isBinded(t){var e;return JSON.stringify(t)===JSON.stringify((e=this._attachInfo)===null||e===void 0?void 0:e.tooltipOptions)}}const Wgt=()=>{St.registerComponent("axis",dgt),St.registerFunction("computeAxisComponentWidth",fgt),St.registerFunction("computeAxisComponentHeight",pgt),St.registerFunction("getAxisConfigInPivotChart",ddt)},jgt=()=>{St.registerComponent("emptyTip",vgt)},Vgt=()=>{St.registerFunction("createLegend",Tgt)},Ggt=()=>{St.registerComponent("menuHandler",Lgt)},$gt=()=>{St.registerComponent("title",Ogt)},Ugt=()=>{St.registerComponent("tooltipHandler",Ngt)},Xgt=()=>{Cit(),Ntt()};class Ygt{constructor(t){this.titleRows=[],this.showedTitleRows=[],this.rowNow=-1,this.skipStartRow=-1,this.skipEndRow=-1,this.table=t,this.table.on("scroll",(e=>{e.scrollDirection==="vertical"&&this.updateGroupTitle()})),this.table.on("tree_hierarchy_state_change",(e=>{this.updateGroupTitle()})),this.table.on("resize_column",(e=>{this.updateGroupTitle()}))}updateGroupTitle(){this.table.scrollTop===0?(this.titleRows=[],this.showedTitleRows=[]):this.skipStartRow!==-1&&this.skipEndRow!==-1&&this.skipStartRow!==this.table.scenegraph.proxy.bodyTopRow-1?(this.table.scenegraph.proxy.screenTopRow<=this.skipStartRow||this.table.scenegraph.proxy.screenTopRow>=this.skipEndRow)&&(this.skipStartRow=-1,this.skipEndRow=-1,this.updateGroupTitleInfo()):(this.skipStartRow=-1,this.skipEndRow=-1,this.updateGroupTitleInfo()),this.updateScenegraph()}updateGroupTitleInfo(){this.rowNow=this.table.scenegraph.proxy.screenTopRow+this.titleRows.length;const t=this.table.getRecordIndexByCell(0,this.rowNow),e=this.table.getRecordIndexByCell(0,this.rowNow+1);this.getTitleRowsByRecordIndex(t,e)}getTitleRowsByRecordIndex(t,e){wt(t)||(t=[t]),wt(e)||(e=[e]);for(let a=0;a<t.length;a++){const l=t.slice(0,a+1);this.table.dataSource.getRaw(l)}const i=[],r=e.length===t.length+1;let o=t.slice(0,r?t.length:t.length-1);const s=this.table.dataSource.currentIndexedData;for(let a=this.rowNow-this.table.columnHeaderLevelCount;a>=0;a--){const l=s[a];if(wt(l)&&o.length===l.length){let h=!0;for(let u=0;u<l.length;u++)if(l[u]!==o[u]){h=!1;break}h&&(i.push(a+this.table.columnHeaderLevelCount),o=o.slice(0,o.length-1))}else if(l===t[0]){i.push(a+this.table.columnHeaderLevelCount);break}}this.titleRows=i.reverse()}updateScenegraph(){const{table:t}=this,{shadowGroup:e,shadowGroupFrozen:i}=Kgt(t);this.showedTitleRows.length=0;let r=0;for(let o=0;o<t.colCount;o++){let s;o<t.frozenColCount?(s=new Vt({x:t.getColsWidth(0,o-1),y:t.getFrozenRowsHeight()}),i.add(s)):(s=new Vt({x:t.getColsWidth(t.frozenColCount,o-1),y:t.getFrozenRowsHeight()}),e.add(s)),s.col=o;for(let a=0;a<this.titleRows.length;a++){const l=this.titleRows[a];if(qgt(l,this.rowNow,t.scenegraph.proxy.screenTopRow,this.titleRows)){o===0&&r++;continue}o===0&&this.showedTitleRows.push(l);const h=t.scenegraph.getCell(o,l);if(h.role==="cell"){const u=rz(h);u.setAttributes({y:40*a}),s.add(u)}else{const u=Er(o,l,t,!0,!0);u.setAttributes({y:40*a}),s.add(u)}}}r>0&&this.skipStartRow===-1&&this.skipEndRow===-1&&(this.skipStartRow=t.scenegraph.proxy.screenTopRow-1,this.skipEndRow=t.scenegraph.proxy.screenTopRow+1)}}function qgt(n,t,e,i){return n===t&&n!==e+i.length-1?!0:n===e+i.indexOf(n)+1&&n<t}function rz(n){const t=n.clone();if(t.role=n.role,t.col=n.col,t.row=n.row,t.mergeStartCol=n.mergeStartCol,t.mergeStartRow=n.mergeStartRow,t.mergeEndCol=n.mergeEndCol,t.mergeEndRow=n.mergeEndRow,t.contentWidth=n.contentWidth,t.contentHeight=n.contentHeight,t.role==="cell"){const e=be({x:0,y:0,width:t.attribute.width,height:t.attribute.height});t.add(e)}if(n.type==="group"){const e=t;n.forEachChildren((i=>{const r=rz(i);e.add(r)}))}return t}function Kgt(n){const t=n.scenegraph.colHeaderGroup,e=n.scenegraph.cornerHeaderGroup;if(!t.border){const o=be({x:0,y:0,width:0,height:0,cursor:"pointer"});t.add(o),t.border=o,o.attachShadow(o.shadowRoot),o.name="border-rect",o.addEventListener("click",(s=>{const a=n.listTreeStickCellPlugin.titleRows,{shadowTarget:l}=s.pickParams,h=jl(l),{col:u,row:d}=h;RP(d-a.indexOf(d),n)}))}if(!e.border){const o=be({x:0,y:0,width:0,height:0,cursor:"pointer"});e.add(o),e.border=o,o.attachShadow(o.shadowRoot),o.name="border-rect",o.addEventListener("click",(s=>{const a=n.listTreeStickCellPlugin.titleRows,{shadowTarget:l}=s.pickParams,h=jl(l),{col:u,row:d}=h;RP(d-a.indexOf(d),n)}))}const i=t.border.shadowRoot,r=e.border.shadowRoot;return i.removeAllChild(),r.removeAllChild(),{shadowGroup:i,shadowGroupFrozen:r}}function RP(n,t){const e=t.getDrawRange();if($(n)&&n>=t.frozenRowCount){const i=t.getFrozenRowsHeight(),r=t.getRowsHeight(0,n-1);t.scrollTop=Math.min(r-i,t.getAllRowsHeight()-e.height)-1}t.scenegraph.updateNextFrame()}const Zgt=()=>{St.registerComponent("listTreeStickCellPlugin",Ygt)};function Jgt(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b){var y,C,w,_,A,x,S,T,M,R,E,P,B,k,L,O,I,H,D,z,G,U,j,X,Z,J;const q=Bdt()[u],st=f._getCellStyle(r,o),Q=Nv("padding",st,r,o,f);if($(Q)&&(l=Q),!n){const ot=Xo(r,o,p,f);v&&(n=f.scenegraph.highPerformanceGetCell(r,o,!0))&&n.role==="cell"&&n.setAttributes({x:e,y:i,width:s,height:a,lineWidth:(C=(y=p?.group)===null||y===void 0?void 0:y.lineWidth)!==null&&C!==void 0?C:void 0,fill:(_=(w=p?.group)===null||w===void 0?void 0:w.fill)!==null&&_!==void 0?_:void 0,stroke:(x=(A=p?.group)===null||A===void 0?void 0:A.stroke)!==null&&x!==void 0?x:void 0,strokeArrayWidth:ot,strokeArrayColor:(T=(S=p?.group)===null||S===void 0?void 0:S.strokeArrayColor)!==null&&T!==void 0?T:void 0,cursor:(R=(M=p?.group)===null||M===void 0?void 0:M.cursor)!==null&&R!==void 0?R:void 0,lineDash:(P=(E=p?.group)===null||E===void 0?void 0:E.lineDash)!==null&&P!==void 0?P:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),n&&n.role==="cell"||((n=new Vt({x:e,y:i,width:s,height:a,lineWidth:(k=(B=p?.group)===null||B===void 0?void 0:B.lineWidth)!==null&&k!==void 0?k:void 0,fill:(O=(L=p?.group)===null||L===void 0?void 0:L.fill)!==null&&O!==void 0?O:void 0,stroke:(H=(I=p?.group)===null||I===void 0?void 0:I.stroke)!==null&&H!==void 0?H:void 0,strokeArrayWidth:ot,strokeArrayColor:(z=(D=p?.group)===null||D===void 0?void 0:D.strokeArrayColor)!==null&&z!==void 0?z:void 0,cursor:(U=(G=p?.group)===null||G===void 0?void 0:G.cursor)!==null&&U!==void 0?U:void 0,lineDash:(X=(j=p?.group)===null||j===void 0?void 0:j.lineDash)!==null&&X!==void 0?X:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})).role="cell",n.col=r,n.row=o,t?.addCellGroup(n))}if(n.AABBBounds.width(),b&&Array.isArray(f.getCellValue(r,o))||!b){const ot=new zh(m,{stroke:!1,x:l[3],y:l[0],canvas:(Z=f.canvas)!==null&&Z!==void 0?Z:f.scenegraph.stage.window.getContext().canvas,mode:f.options.mode,modeParams:f.options.modeParams,spec:f.options.specTransformInCell?f.options.specTransformInCell(d,r,o):d,ClassType:q,width:s-l[3]-l[1],height:a-l[2]-l[0],chartInstance:c,dataId:g,data:f.getCellValue(r,o)||[],cellPadding:l,dpr:f.internalProps.pixelRatio,detectPickChartItem:(J=f.options.customConfig)===null||J===void 0?void 0:J.detectPickChartItem,axes:f.isPivotChart()?f.internalProps.layoutMap.getChartAxes(r,o):[],tableChartOption:f.options.chartOption,col:r,row:o});n.appendChild(ot),f.internalProps.layoutMap.setChartInstance(r,o,ot.chartInstance)}return n}class Qgt extends Vt{constructor(t){super(t),this._autoWidth=!1,this._autoHeight=!1,this._leftGroup=new Vt({pickable:!1,fill:!1,stroke:!1}),this._leftGroup.role="content-left",this._rightGroup=new Vt({pickable:!1,fill:!1,stroke:!1}),this._rightGroup.role="content-right",this._checkboxGroup=new Vt({pickable:!1,fill:!1,stroke:!1}),this._checkboxGroup.role="content-center",this.appendChild(this._leftGroup),this.appendChild(this._rightGroup),this.appendChild(this._checkboxGroup)}addLeftOccupyingIcon(t){var e,i,r;t.setAttribute("x",this._leftGroup.width+((e=t.attribute.marginLeft)!==null&&e!==void 0?e:0)),this._leftGroup.appendChild(t),this._leftGroup.setDeltaWidth(((i=t.attribute.marginLeft)!==null&&i!==void 0?i:0)+((r=t.attribute.marginRight)!==null&&r!==void 0?r:0)+t.attribute.width)}addRightOccupyingIcon(t){var e,i,r;t.setAttribute("x",this._rightGroup.width+((e=t.attribute.marginLeft)!==null&&e!==void 0?e:0)),this._rightGroup.appendChild(t),this._rightGroup.setDeltaWidth(((i=t.attribute.marginLeft)!==null&&i!==void 0?i:0)+((r=t.attribute.marginRight)!==null&&r!==void 0?r:0)+t.attribute.width)}addCheckbox(t){this._checkboxGroup.appendChild(t)}setCheckboxContentOption(t){this._autoWidth=t.autoWidth,this._autoHeight=t.autoHeight,this._cellWidth=t.cellWidth,this._originCellWidth=t.cellWidth,this._cellHeight=t.cellHeight,this._align=t.align,this._baseline=t.baseline}layout(){let t=this._leftGroup.width;t===1/0&&(t=0);let e=this._rightGroup.width;if(e===-1/0&&(e=0),this._autoWidth){const s=this._checkboxGroup.width;this._cellWidth=t+e+s,this.setAttribute("width",this._cellWidth)}else{const s=this._cellWidth-t-e;this.updateCenterLayout(s);const a=this._checkboxGroup.width;this._cellWidth=t+e+a,this.setAttribute("width",this._cellWidth)}this.updateHorizontalPos();const i=this._leftGroup.height,r=this._rightGroup.height,o=this._checkboxGroup.height;this._cellHeight=Math.max(i,r,o),this.setAttribute("height",this._cellHeight),this.updateVerticalPos()}updateCenterLayout(t){let e=t;this._checkboxGroup.forEachChildren((o=>{o instanceof ya&&(e-=o.AABBBounds.width())}));const i=this._checkboxGroup.getChildByName("checkbox-content");i instanceof ya&&i.setAttribute("width",e);let r=0;this._checkboxGroup.forEachChildren((o=>{o.setAttribute("x",r),r+=o.AABBBounds.width()}))}updateHorizontalPos(){this._leftGroup.setAttribute("x",0),this._rightGroup.setAttribute("x",this._cellWidth-this._rightGroup.width),this._checkboxGroup.setAttribute("x",4),this._align==="left"||this._align==="start"?this.setAttribute("dx",0):this._align==="center"?this.setAttribute("dx",-this.attribute.width/2):this._align!=="right"&&this._align!=="end"||this.setAttribute("dx",-this.attribute.width)}updateVerticalPos(){this._baseline==="top"?(this._leftGroup.setAttribute("y",0),this._rightGroup.setAttribute("y",0),this._checkboxGroup.setAttribute("y",0)):this._baseline==="middle"?(this._leftGroup.forEachChildren((t=>{t.setAttribute("y",(this._leftGroup.height-t.AABBBounds.height())/2)})),this._rightGroup.forEachChildren((t=>{t.setAttribute("y",(this._rightGroup.height-t.AABBBounds.height())/2)})),this._leftGroup.setAttribute("y",this._cellHeight/2-this._leftGroup.height/2),this._rightGroup.setAttribute("y",this._cellHeight/2-this._rightGroup.height/2),this._checkboxGroup.setAttribute("y",this._cellHeight/2-this._checkboxGroup.height/2)):this._baseline==="bottom"&&(this._leftGroup.forEachChildren((t=>{t.setAttribute("y",this._leftGroup.height-t.AABBBounds.height())})),this._rightGroup.forEachChildren((t=>{t.setAttribute("y",this._rightGroup.height-t.AABBBounds.height())})),this._leftGroup.setAttribute("y",this._cellHeight-this._leftGroup.height),this._rightGroup.setAttribute("y",this._cellHeight-this._rightGroup.height),this._checkboxGroup.setAttribute("y",this._cellHeight-this._checkboxGroup.height))}}function tft(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b){var y,C,w,_,A,x,S,T,M,R,E,P,B,k,L,O,I,H,D,z,G,U,j,X;if(!n){const F=Xo(r,o,f,g);v&&(n=g.scenegraph.highPerformanceGetCell(r,o,!0))&&n.role==="cell"&&n.setAttributes({x:e,y:i,width:a,height:l,lineWidth:(C=(y=f?.group)===null||y===void 0?void 0:y.lineWidth)!==null&&C!==void 0?C:void 0,fill:(_=(w=f?.group)===null||w===void 0?void 0:w.fill)!==null&&_!==void 0?_:void 0,stroke:(x=(A=f?.group)===null||A===void 0?void 0:A.stroke)!==null&&x!==void 0?x:void 0,strokeArrayWidth:F,strokeArrayColor:(T=(S=f?.group)===null||S===void 0?void 0:S.strokeArrayColor)!==null&&T!==void 0?T:void 0,cursor:(R=(M=f?.group)===null||M===void 0?void 0:M.cursor)!==null&&R!==void 0?R:void 0,lineDash:(P=(E=f?.group)===null||E===void 0?void 0:E.lineDash)!==null&&P!==void 0?P:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius}),n&&n.role==="cell"||((n=new Vt({x:e,y:i,width:a,height:l,lineWidth:(k=(B=f?.group)===null||B===void 0?void 0:B.lineWidth)!==null&&k!==void 0?k:void 0,fill:(O=(L=f?.group)===null||L===void 0?void 0:L.fill)!==null&&O!==void 0?O:void 0,stroke:(H=(I=f?.group)===null||I===void 0?void 0:I.stroke)!==null&&H!==void 0?H:void 0,strokeArrayWidth:F,strokeArrayColor:(z=(D=f?.group)===null||D===void 0?void 0:D.strokeArrayColor)!==null&&z!==void 0?z:void 0,cursor:(U=(G=f?.group)===null||G===void 0?void 0:G.cursor)!==null&&U!==void 0?U:void 0,lineDash:(X=(j=f?.group)===null||j===void 0?void 0:j.lineDash)!==null&&X!==void 0?X:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius})).role="cell",n.col=r,n.row=o,t?.addCellGroup(n))}let Z;if(c){let F=r,N=o;m&&(F=m.start.col,N=m.start.row),Z=g.getCellIcons(F,N)}let J=0,q=0,st=0,Q=0,ot=[];if(Array.isArray(Z)&&Z.length!==0){const{leftIconWidth:F,rightIconWidth:N,contentLeftIcons:W,absoluteRightIconWidth:V}=ju(Z,n,m,g);J=F+N,q=F,st=N,ot=W,Q=V,n.forEachChildren((K=>{K.role==="icon-left"?K.setAttribute("x",K.attribute.x+h[3]):K.role==="icon-right"?K.setAttribute("x",K.attribute.x+a-N-h[1]):K.role==="icon-absolute-right"&&K.setAttribute("x",K.attribute.x+a-V-h[1])})),n.forEachChildren((K=>{d==="middle"?K.setAttribute("y",(l-K.AABBBounds.height())/2):d==="bottom"?K.setAttribute("y",l-K.AABBBounds.height()-h[2]):K.setAttribute("y",h[0])}))}const nt=eft(r,o,s-J,a,l,h,f,p,g,b);if(ot.length!==1||ot[0].name!==on.expandIconName&&ot[0].name!==on.collapseIconName)nt&&n.appendChild(nt),nt.render();else{const F=new Qgt({x:0,y:0,fill:!1,stroke:!1,pickable:!1});F.name="checkbox-content",F.setCheckboxContentOption({autoWidth:!1,autoHeight:!1,cellWidth:a-(h[1]+h[3]),cellHeight:l-h[0]-h[2],align:u,baseline:d});const N={addedHierarchyOffset:0};ot.forEach((K=>{const et=or(K,void 0,n.col,n.row,m,g,N);et.role="icon-content-left",et.name=K.name,F.addLeftOccupyingIcon(et)})),nt&&F.addCheckbox(nt),n.appendChild(F),F.layout(),F.AABBBounds.width(),F.AABBBounds.height();const W=a-(h[1]+h[3]),V=l-(h[0]+h[2]);n.forEachChildren((K=>{K.role==="icon-left"?K.setAttribute("x",K.attribute.x+h[3]):K.role==="icon-right"?K.setAttribute("x",K.attribute.x+W-st+h[3]):K.role==="icon-absolute-right"?K.setAttribute("x",K.attribute.x+W-Q+h[3]+h[1]):K.name!=="content"&&K.name!=="checkbox-content"||(u==="center"&&K.type!=="richtext"?K.setAttribute("x",h[3]+q+(W-q-st)/2):u==="right"&&K.type!=="richtext"?K.setAttribute("x",h[3]+W-st):K.setAttribute("x",h[3]+q))})),n.forEachChildren((K=>{K.name!==ho&&(d==="middle"?K?._checkboxGroup&&K._leftGroup.setAttribute("y",h[0]+(V-K._checkboxGroup.AABBBounds.height())/2):d==="bottom"?K.setAttribute("y",h[0]+V-K.AABBBounds.height()):K.setAttribute("y",h[0]))}))}return a-=h[1]+h[3]+J,l-=h[0]+h[2],u==="center"?nt.setAttribute("x",h[3]+q+(a-nt.AABBBounds.width())/2):u==="right"?nt.setAttribute("x",h[3]+q+a-nt.AABBBounds.width()):nt.setAttribute("x",h[3]+q),d==="middle"?nt.setAttribute("y",h[0]+(l-nt.AABBBounds.height())/2):d==="bottom"?nt.setAttribute("y",h[0]+l-nt.AABBBounds.height()):nt.setAttribute("y",h[0]),n}function eft(n,t,e,i,r,o,s,a,l,h){var u,d,c,g;const f=l._getCellStyle(n,t),p=ht("size",f,n,t,l),m=ht("spaceBetweenTextAndIcon",f,n,t,l),v=ht("defaultFill",f,n,t,l),b=ht("defaultStroke",f,n,t,l),y=ht("disableFill",f,n,t,l),C=ht("checkedFill",f,n,t,l),w=ht("checkedStroke",f,n,t,l),_=ht("disableCheckedFill",f,n,t,l),A=ht("disableCheckedStroke",f,n,t,l),x=ht("checkIconImage",f,n,t,l),S=ht("indeterminateIconImage",f,n,t,l),T=l.getCellValue(n,t),M=l.getCellOriginValue(n,t);let R,E,P=(u=T)!==null&&u!==void 0?u:"";if(Pi(T)?(R=T.checked,E=T.disable,P=(d=T.text)!==null&&d!==void 0?d:""):typeof T=="boolean"&&(R=T,P=""),l.internalProps.layoutMap.isSeriesNumber(n,t)){const Z=l.getFieldData(a.field,n,t);Z&&(typeof Z=="string"||(typeof Z=="object"?(R=Z.checked,E=Z.disable):typeof Z=="boolean"&&(R=Z)))}R=l.stateManager.syncCheckedState(n,t,a.field,R);const B=Nn(n,t,l),k=l._getCellStyle(n,t),L=(c=k.autoWrapText)!==null&&c!==void 0?c:l.internalProps.autoWrapText,{lineClamp:O}=k,{checked:I,disable:H}=a;if(R==null||typeof R=="function"){const Z=fe(I,{col:n,row:t,table:l,context:null,value:T,dataValue:M});R=l.stateManager.syncCheckedState(n,t,a.field,Z)}const D=fe(H,{col:n,row:t,table:l,context:null,value:T,dataValue:M}),z=e==="auto",G=l.isAutoRowHeight(t),U={text:P.length===1?P[0]:P,maxLineWidth:z?1/0:i-(o[1]+o[3]+B)-p-m,textAlign:"left",textBaseline:"top",autoWrapText:L,lineClamp:O,wordBreak:"break-word",heightLimit:G?-1:r-Math.floor(o[0]+o[2]),pickable:!1,dx:h?0:B,whiteSpace:P.length!==1||L?"normal":"no-wrap"},j={x:0,y:0,text:s.text?Object.assign({},s.text,U):U,icon:{width:Math.floor(p/1.4),height:Math.floor(p/1.4)},box:{width:p,height:p},dx:h?B:0,spaceBetweenTextAndIcon:m,disabled:(g=E??D)!==null&&g!==void 0&&g};R==="indeterminate"?(j.checked=void 0,j.indeterminate=!0):(j.checked=R,j.indeterminate=void 0),v&&(j.box.fill=v),b&&(j.box.stroke=b),y&&(j.box.disableFill=y),C&&(j.box.checkedFill=C),w&&(j.box.checkedStroke=w),_&&(j.box.disableCheckedFill=_),A&&(j.box.disableCheckedStroke=A),x&&(j.icon.checkIconImage=x),S&&(j.icon.indeterminateIconImage=S);const X=new ya(j);return X.name="checkbox",X}function ift(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p){var m,v,b,y,C,w,_,A,x,S,T,M;if(!n){const P=Xo(r,o,g,c);(n=new Vt({x:e,y:i,width:a,height:l,lineWidth:(v=(m=g?.group)===null||m===void 0?void 0:m.lineWidth)!==null&&v!==void 0?v:void 0,fill:(y=(b=g?.group)===null||b===void 0?void 0:b.fill)!==null&&y!==void 0?y:void 0,stroke:(w=(C=g?.group)===null||C===void 0?void 0:C.stroke)!==null&&w!==void 0?w:void 0,strokeArrayWidth:P,strokeArrayColor:(A=(_=g?.group)===null||_===void 0?void 0:_.strokeArrayColor)!==null&&A!==void 0?A:void 0,cursor:(S=(x=g?.group)===null||x===void 0?void 0:x.cursor)!==null&&S!==void 0?S:void 0,lineDash:(M=(T=g?.group)===null||T===void 0?void 0:T.lineDash)!==null&&M!==void 0?M:void 0,lineCap:"butt",clip:!0,cornerRadius:g.group.cornerRadius})).role="cell",n.col=r,n.row=o,t?.addCellGroup(n)}const{width:R,height:E}=nft(r,o,s,a,l,h,g,f,n,p,c);return a-=h[1]+h[3],l-=h[0]+h[2],n.forEachChildren((P=>{u==="center"?P.setAttribute("x",h[3]+P.attribute.x+(a-R)/2):u==="right"?P.setAttribute("x",h[3]+P.attribute.x+a-R):P.setAttribute("x",h[3]+P.attribute.x),d==="middle"?P.setAttribute("y",h[0]+P.attribute.y+(l-E)/2):d==="bottom"?P.setAttribute("y",h[0]+P.attribute.y+l-E):P.setAttribute("y",h[0]+P.attribute.y)})),n}function nft(n,t,e,i,r,o,s,a,l,h,u){var d,c,g,f;const p=u._getCellStyle(n,t);let m=ht("size",p,n,t,u),v=ht("innerRadius",p,n,t,u),b=ht("outerRadius",p,n,t,u);const y=ht("spaceBetweenTextAndIcon",p,n,t,u),C=ht("spaceBetweenRadio",p,n,t,u),w=ht("defaultFill",p,n,t,u),_=ht("defaultStroke",p,n,t,u),A=ht("disableFill",p,n,t,u),x=ht("checkedFill",p,n,t,u),S=ht("checkedStroke",p,n,t,u),T=ht("disableCheckedFill",p,n,t,u),M=ht("disableCheckedStroke",p,n,t,u);dt(b)?m=2*b:b=Math.round(m/2),(!dt(v)||v<0)&&(v=Math.round(b/7*3));const R=u.getCellValue(n,t),E=u.getCellOriginValue(n,t),P=Nn(n,t,u),B=u._getCellStyle(n,t),k=(d=B.autoWrapText)!==null&&d!==void 0?d:u.internalProps.autoWrapText,{lineClamp:L}=B,O=e==="auto",I=u.isAutoRowHeight(t),H={maxLineWidth:O?1/0:i-(o[1]+o[3]+P)-m-y,textAlign:"left",textBaseline:"top",autoWrapText:k,lineClamp:L,wordBreak:"break-word",heightLimit:I?-1:r-Math.floor(o[0]+o[2]),pickable:!1,dx:P},D={x:0,y:0,text:s.text?Object.assign({},s.text,H):H,circle:{innerRadius:v,outerRadius:b},spaceBetweenTextAndIcon:y};w&&(D.circle.fill=w),_&&(D.circle.stroke=_),A&&(D.circle.disableFill=A),x&&(D.circle.checkedFill=x),S&&(D.circle.checkedStroke=S),T&&(D.circle.disableCheckedFill=T),M&&(D.circle.disableCheckedStroke=M);let z=0,G=0;const U=(c=a.radioDirectionInCell)!==null&&c!==void 0?c:"vertical";if(wt(R))R.forEach(((j,X)=>{var Z,J;const q=BP(j,E,X,n,t,a,k,D,u);q&&l.appendChild(q),q.id=`radio-${(Z=h?.start.col)!==null&&Z!==void 0?Z:n}-${(J=h?.start.row)!==null&&J!==void 0?J:t}-${X}`,q.render();const st=q.AABBBounds;U==="vertical"?(q.setAttribute("y",G),G+=st.height()+(X!==R.length-1?C:0),z=Math.max(z,st.width())):U==="horizontal"&&(q.setAttribute("x",z),z+=st.width()+(X!==R.length-1?C:0),G=Math.max(G,st.height()))}));else{const j=BP(R,E,void 0,n,t,a,k,D,u);j&&l.appendChild(j),j.id=`radio-${(g=h?.start.col)!==null&&g!==void 0?g:n}-${(f=h?.start.row)!==null&&f!==void 0?f:t}`,j.render();const X=j.AABBBounds;z=X.width(),G=X.height()}return{width:z,height:G}}function BP(n,t,e,i,r,o,s,a,l){const h=rft(n,t,e,i,r,o,l),u=oft(n,t,i,r,o,l),d=Pi(n)?n.text:ko(n)?"":n??"",c=xe({},a,{checked:h,disabled:u,text:{text:d.length===1?d[0]:d,whiteSpace:d.length!==1||s?"normal":"no-wrap"},boundsPadding:0}),g=new Mu(c);return g.name="radio",g}function rft(n,t,e,i,r,o,s){var a,l;const h=(a=o.radioCheckType)!==null&&a!==void 0?a:"column";let u,d;return Pi(n)?u=n.checked:typeof n=="boolean"&&(u=n),u=s.stateManager.syncRadioState(i,r,o.field,h,e,u),u!=null&&typeof u!="function"||(d=fe(o.checked,{col:i,row:r,table:s,context:null,value:n,dataValue:t}),u=s.stateManager.syncRadioState(i,r,o.field,h,e,d)),(l=u??d)!==null&&l!==void 0&&l}function oft(n,t,e,i,r,o){var s;let a;Pi(n)&&(a=n.disable);const l=fe(r.disable,{col:e,row:i,table:o,context:null,value:n,dataValue:t});return(s=a??l)!==null&&s!==void 0&&s}function sft(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v){var b,y,C,w,_,A,x,S,T,M,R,E,P,B,k,L,O,I,H,D,z,G,U,j;if(!n){const st=Xo(r,o,f,g);v&&(n=g.scenegraph.highPerformanceGetCell(r,o,!0))&&n.role==="cell"&&n.setAttributes({x:e,y:i,width:a,height:l,lineWidth:(y=(b=f?.group)===null||b===void 0?void 0:b.lineWidth)!==null&&y!==void 0?y:void 0,fill:(w=(C=f?.group)===null||C===void 0?void 0:C.fill)!==null&&w!==void 0?w:void 0,stroke:(A=(_=f?.group)===null||_===void 0?void 0:_.stroke)!==null&&A!==void 0?A:void 0,strokeArrayWidth:st,strokeArrayColor:(S=(x=f?.group)===null||x===void 0?void 0:x.strokeArrayColor)!==null&&S!==void 0?S:void 0,cursor:(M=(T=f?.group)===null||T===void 0?void 0:T.cursor)!==null&&M!==void 0?M:void 0,lineDash:(E=(R=f?.group)===null||R===void 0?void 0:R.lineDash)!==null&&E!==void 0?E:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius}),n&&n.role==="cell"||((n=new Vt({x:e,y:i,width:a,height:l,lineWidth:(B=(P=f?.group)===null||P===void 0?void 0:P.lineWidth)!==null&&B!==void 0?B:void 0,fill:(L=(k=f?.group)===null||k===void 0?void 0:k.fill)!==null&&L!==void 0?L:void 0,stroke:(I=(O=f?.group)===null||O===void 0?void 0:O.stroke)!==null&&I!==void 0?I:void 0,strokeArrayWidth:st,strokeArrayColor:(D=(H=f?.group)===null||H===void 0?void 0:H.strokeArrayColor)!==null&&D!==void 0?D:void 0,cursor:(G=(z=f?.group)===null||z===void 0?void 0:z.cursor)!==null&&G!==void 0?G:void 0,lineDash:(j=(U=f?.group)===null||U===void 0?void 0:U.lineDash)!==null&&j!==void 0?j:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius})).role="cell",n.col=r,n.row=o,t?.addCellGroup(n))}let X;if(c){let st=r,Q=o;m&&(st=m.start.col,Q=m.start.row),X=g.getCellIcons(st,Q)}let Z=0,J=0;if(Array.isArray(X)&&X.length!==0){const{leftIconWidth:st,rightIconWidth:Q,absoluteRightIconWidth:ot}=ju(X,n,m,g);Z=st+Q,J=st,n.forEachChildren((nt=>{nt.role==="icon-left"?nt.setAttribute("x",nt.attribute.x+h[3]):nt.role==="icon-right"?nt.setAttribute("x",nt.attribute.x+a-Q-h[1]):nt.role==="icon-absolute-right"&&nt.setAttribute("x",nt.attribute.x+a-ot-h[1])})),n.forEachChildren((nt=>{d==="middle"?nt.setAttribute("y",(l-nt.AABBBounds.height())/2):d==="bottom"?nt.setAttribute("y",l-nt.AABBBounds.height()-h[2]):nt.setAttribute("y",h[0])}))}const q=aft(r,o,s-Z,a,l,h,f,p,g);return q&&n.appendChild(q),q.render(),a-=h[1]+h[3]+Z,l-=h[0]+h[2],u==="center"?q.setAttribute("x",h[3]+J+(a-q.AABBBounds.width())/2):u==="right"?q.setAttribute("x",h[3]+J+a-q.AABBBounds.width()):q.setAttribute("x",h[3]+J),d==="middle"?q.setAttribute("y",h[0]+(l-q.AABBBounds.height())/2):d==="bottom"?q.setAttribute("y",h[0]+l-q.AABBBounds.height()):q.setAttribute("y",h[0]),n}function aft(n,t,e,i,r,o,s,a,l){var h,u,d,c;const g=l._getCellStyle(n,t),f=ht("spaceBetweenTextAndCircle",g,n,t,l),p=ht("circleRadius",g,n,t,l),m=ht("boxWidth",g,n,t,l),v=ht("boxHeight",g,n,t,l),b=ht("checkedFill",g,n,t,l),y=ht("uncheckedFill",g,n,t,l),C=ht("disableCheckedFill",g,n,t,l),w=ht("disableUncheckedFill",g,n,t,l),_=ht("circleFill",g,n,t,l),A=l.getCellValue(n,t),x=l.getCellOriginValue(n,t);let S,T,M=(h=A)!==null&&h!==void 0?h:"";Pi(A)?(S=A.checked,T=A.disable,M=(u=A.text)!==null&&u!==void 0?u:""):typeof A=="boolean"&&(S=A,M=""),S=l.stateManager.syncCheckedState(n,t,a.field,S);const R=Nn(n,t,l),E=l._getCellStyle(n,t),P=(d=E.autoWrapText)!==null&&d!==void 0?d:l.internalProps.autoWrapText,{lineClamp:B}=E,{checked:k,disable:L,uncheckedText:O,checkedText:I}=a;if(S==null||typeof S=="function"){const J=fe(k,{col:n,row:t,table:l,context:null,value:A,dataValue:x});S=l.stateManager.syncCheckedState(n,t,a.field,J)}const H=fe(L,{col:n,row:t,table:l,context:null,value:A,dataValue:x}),D=fe(I,{col:n,row:t,table:l,context:null,value:A,dataValue:x}),z=fe(O,{col:n,row:t,table:l,context:null,value:A,dataValue:x}),G=e==="auto",U=l.isAutoRowHeight(t),j={text:M.length===1?M[0]:M,maxLineWidth:G?1/0:i-(o[1]+o[3]+R)-2*p-f,textAlign:"left",textBaseline:"top",autoWrapText:P,lineClamp:B,wordBreak:"break-word",heightLimit:U?-1:r-Math.floor(o[0]+o[2]),pickable:!1,dx:R,whiteSpace:M.length!==1||P?"normal":"no-wrap",checkedText:D,uncheckedText:z},X={x:0,y:0,text:s.text?Object.assign({},s.text,j):j,circle:{radius:p},box:{width:m,height:v},spaceBetweenTextAndCircle:f,disabled:(c=T??H)!==null&&c!==void 0&&c};X.checked=S,y&&(X.box.uncheckedFill=y),w&&(X.box.disableUncheckedFill=w),b&&(X.box.checkedFill=b),C&&(X.box.disableCheckedFill=C),_&&(X.circle.fill=_);const Z=new zc(X);return Z.name="switch",Z}const Ws=new tgt,js=new Uu;function lft(n,t,e,i,r,o,s,a,l,h,u,d){var c,g,f,p,m,v,b,y,C,w,_,A,x,S,T,M,R,E,P,B,k,L,O,I;if(!n){const D=Xo(r,o,u,h);d&&(n=h.scenegraph.highPerformanceGetCell(r,o,!0))&&n.role==="cell"&&n.setAttributes({x:e,y:i,width:s,height:a,lineWidth:(g=(c=u?.group)===null||c===void 0?void 0:c.lineWidth)!==null&&g!==void 0?g:void 0,fill:(p=(f=u?.group)===null||f===void 0?void 0:f.fill)!==null&&p!==void 0?p:void 0,stroke:(v=(m=u?.group)===null||m===void 0?void 0:m.stroke)!==null&&v!==void 0?v:void 0,strokeArrayWidth:D,strokeArrayColor:(y=(b=u?.group)===null||b===void 0?void 0:b.strokeArrayColor)!==null&&y!==void 0?y:void 0,cursor:(w=(C=u?.group)===null||C===void 0?void 0:C.cursor)!==null&&w!==void 0?w:void 0,lineDash:(A=(_=u?.group)===null||_===void 0?void 0:_.lineDash)!==null&&A!==void 0?A:void 0,lineCap:"butt",clip:!0,cornerRadius:u.group.cornerRadius}),n&&n.role==="cell"||((n=new Vt({x:e,y:i,width:s,height:a,lineWidth:(S=(x=u?.group)===null||x===void 0?void 0:x.lineWidth)!==null&&S!==void 0?S:void 0,fill:(M=(T=u?.group)===null||T===void 0?void 0:T.fill)!==null&&M!==void 0?M:void 0,stroke:(E=(R=u?.group)===null||R===void 0?void 0:R.stroke)!==null&&E!==void 0?E:void 0,strokeArrayWidth:D,strokeArrayColor:(B=(P=u?.group)===null||P===void 0?void 0:P.strokeArrayColor)!==null&&B!==void 0?B:void 0,cursor:(L=(k=u?.group)===null||k===void 0?void 0:k.cursor)!==null&&L!==void 0?L:void 0,lineDash:(I=(O=u?.group)===null||O===void 0?void 0:O.lineDash)!==null&&I!==void 0?I:void 0,lineCap:"butt",clip:!0,cornerRadius:u.group.cornerRadius})).role="cell",n.col=r,n.row=o,t?.addCellGroup(n))}const H=hft(r,o,s,a,l,h);return H&&n.appendChild(H),n}function hft(n,t,e,i,r,o){let s,a;const l=o.internalProps.layoutMap.getBody(n,t).sparklineSpec,h=o.getCellValue(n,t);if(!Array.isArray(h))return;const u=r[3],d=r[0];e-=r[1]+r[3];const c=i-=r[0]+r[2];if(typeof l=="function"){const y={col:n,row:t,dataValue:o.getCellOriginValue(n,t)||"",value:o.getCellValue(n,t)||"",rect:o.getCellRangeRelativeRect(o.getCellRange(n,t)),table:o};s=l(y),a=kP(s,u,d,e,i)}else s=l,a=kP(l,u,d,e,i);const g=[],f=[];let p,m;if(typeof s.xField=="object")Ws.domain(s.xField.domain),p=s.xField.field;else if(typeof s.xField=="string"){const y=h.map((C=>C[s.xField]));Ws.domain(y),p=s.xField}else Array.isArray(h)&&(Ws.domain(Array.from({length:h.length},((y,C)=>C))),p=s.xField);if(Ws.range([0,e]),typeof s.yField=="object")js.domain(s.yField.domain),m=s.yField.field;else if(typeof s.yField=="string"){const y=PP(h,s.yField);js.domain([Math.min(...y),Math.max(...y)]),m=s.yField}else if(Array.isArray(h)){const y=PP(h);js.domain([Math.min(...y),Math.max(...y)]),m=s.yField}if(js.range([0,i]),typeof s.xField=="object"&&Array.isArray(s.xField.domain)){const y=h.map((w=>w[s.xField.field])),C=s.xField.domain;for(let w=0;w<C.length;w++){let _=!1;for(let A=0;A<y.length;A++)if(C[w]===y[A]){const x=h[A];if(!$(x[p])||!$(x[m]))break;g.push({x:0+Ws.scale(x[p]),y:c-js.scale(x[m]),defined:$(x[m])}),f.push(x),_=!0;break}_||(g.push({x:0+Ws.scale(C[w]),y:0,defined:!1}),f.push({[p]:C[w],[m]:null}))}}else for(let y=0;y<h.length;y++){const C=h[y];g.push({x:0+Ws.scale(p?C[p]:y),y:c-js.scale(m?C[m]:C),defined:$(m?C[m]:C),rawData:C}),f.push(C)}const v=a.getChildByName("sparkline-line");v&&v.setAttribute("points",g),v.bandwidth=Ws.step(),v.min=js.range()[0],v.max=js.range()[1];const b=a.getChildByName("sparkline-symbol-group");if(b){const y=s.pointShowRule==="isolatedPoint";if(s.pointShowRule==="all")for(let C=0;C<g.length;C++){const{x:w,y:_,defined:A}=g[C];if(A){const x=yu({x:w,y:_});b.appendChild(x)}}else if(y)for(let C=0;C<g.length;C++){const{x:w,y:_,defined:A}=g[C];if(A&&(!g[C-1]||!g[C-1].defined)&&(!g[C+1]||!g[C+1].defined)){const x=yu({x:w,y:_});b.appendChild(x)}}}return a}function kP(n,t,e,i,r){var o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x,S,T;let M;M=typeof n=="function"?n(null):n;const R=new Vt({x:t,y:e,width:i,height:r,stroke:!1,fill:!1});if(R.name="sparkline",M.type==="line"){const E=Ke({x:0,y:0,curveType:M.smooth?"monotoneX":"linear",stroke:(a=(s=(o=M.line)===null||o===void 0?void 0:o.style)===null||s===void 0?void 0:s.stroke)!==null&&a!==void 0?a:"blue",lineWidth:(u=(h=(l=M.line)===null||l===void 0?void 0:l.style)===null||h===void 0?void 0:h.strokeWidth)!==null&&u!==void 0?u:2});E.name="sparkline-line",R.addChild(E),M.crosshair&&(E.hover=(c=(d=M.crosshair)===null||d===void 0?void 0:d.style)!==null&&c!==void 0?c:{stroke:"#000",interpolate:"linear"});const P=new Vt({x:0,y:0,width:i,height:r,stroke:!1,fill:!1});P.name="sparkline-symbol-group",P.setTheme({symbol:{stroke:(p=(f=(g=M.point)===null||g===void 0?void 0:g.style)===null||f===void 0?void 0:f.stroke)!==null&&p!==void 0?p:"#000",lineWidth:(b=(v=(m=M.point)===null||m===void 0?void 0:m.style)===null||v===void 0?void 0:v.strokeWidth)!==null&&b!==void 0?b:1,fill:(w=(C=(y=M.point)===null||y===void 0?void 0:y.style)===null||C===void 0?void 0:C.fill)!==null&&w!==void 0?w:"#000",size:2*((x=(A=(_=M.point)===null||_===void 0?void 0:_.style)===null||A===void 0?void 0:A.size)!==null&&x!==void 0?x:3),symbolType:"circle"}}),R.addChild(P),P.hover=(T=(S=M.point)===null||S===void 0?void 0:S.hover)!==null&&T!==void 0&&T}return R}function PP(n,t){const e=[];for(let i=0;i<n.length;i++){const r=n[i];$(t)&&$(r[t])?e.push(r[t]):!$(t)&&$(r)&&e.push(r)}return e}const $C=Fr();function uft(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m){var v,b,y,C,w,_,A,x,S,T,M,R,E,P,B,k,L,O,I,H,D,z,G,U,j,X,Z,J,q,st;const Q=g._getCellStyle(i,r),ot=Nv("padding",Q,i,r,g);!((v=g.options.customConfig)===null||v===void 0)&&v.imageMargin?h=Kt((b=g.options.customConfig)===null||b===void 0?void 0:b.imageMargin):$(ot)&&(h=ot),!((y=f?.text)===null||y===void 0)&&y.textAlign&&(u=(C=f?.text)===null||C===void 0?void 0:C.textAlign),!((w=f?.text)===null||w===void 0)&&w.textBaseline&&(d=(_=f?.text)===null||_===void 0?void 0:_.textBaseline);const nt=Xo(i,r,f,g);let F,N;if(m&&(F=g.scenegraph.highPerformanceGetCell(i,r,!0),F&&F.role==="cell"&&F.setAttributes({x:t,y:e,width:o,height:s,lineWidth:(x=(A=f?.group)===null||A===void 0?void 0:A.lineWidth)!==null&&x!==void 0?x:void 0,fill:(T=(S=f?.group)===null||S===void 0?void 0:S.fill)!==null&&T!==void 0?T:void 0,stroke:(R=(M=f?.group)===null||M===void 0?void 0:M.stroke)!==null&&R!==void 0?R:void 0,strokeArrayWidth:nt,strokeArrayColor:(P=(E=f?.group)===null||E===void 0?void 0:E.strokeArrayColor)!==null&&P!==void 0?P:void 0,cursor:(k=(B=f?.group)===null||B===void 0?void 0:B.cursor)!==null&&k!==void 0?k:void 0,lineDash:(O=(L=f?.group)===null||L===void 0?void 0:L.lineDash)!==null&&O!==void 0?O:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius})),F&&F.role==="cell"||(F=new Vt({x:t,y:e,width:o,height:s,lineWidth:(H=(I=f?.group)===null||I===void 0?void 0:I.lineWidth)!==null&&H!==void 0?H:void 0,fill:(z=(D=f?.group)===null||D===void 0?void 0:D.fill)!==null&&z!==void 0?z:void 0,stroke:(U=(G=f?.group)===null||G===void 0?void 0:G.stroke)!==null&&U!==void 0?U:void 0,strokeArrayWidth:nt,strokeArrayColor:(X=(j=f?.group)===null||j===void 0?void 0:j.strokeArrayColor)!==null&&X!==void 0?X:void 0,cursor:(J=(Z=f?.group)===null||Z===void 0?void 0:Z.cursor)!==null&&J!==void 0?J:void 0,lineDash:(st=(q=f?.group)===null||q===void 0?void 0:q.lineDash)!==null&&st!==void 0?st:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius}),F.role="cell",F.col=i,F.row=r,n?.addCellGroup(F)),c){let rt=i,lt=r;p&&(rt=p.start.col,lt=p.start.row),N=g.getCellIcons(rt,lt)}let W=0,V=0;if(Array.isArray(N)&&N.length!==0){const{leftIconWidth:rt,rightIconWidth:lt,absoluteRightIconWidth:ct}=ju(N,F,p,g);W=rt,V=lt,F.forEachChildren((ut=>{ut.role==="icon-left"?ut.setAttribute("x",ut.attribute.x+h[3]):ut.role==="icon-right"?ut.setAttribute("x",ut.attribute.x+o-lt-h[1]):ut.role==="icon-absolute-right"&&ut.setAttribute("x",ut.attribute.x+o-ct-h[1])})),F.forEachChildren((ut=>{d==="middle"?ut.setAttribute("y",(s-ut.AABBBounds.height())/2):d==="bottom"?ut.setAttribute("y",s-ut.AABBBounds.height()-h[2]):ut.setAttribute("y",h[0])})),F._cellLeftIconWidth=W,F._cellRightIconWidth=V}const K=g.getCellValue(i,r),et=document.createElement("video");et.addEventListener("loadeddata",(()=>{l&&qD(i,r,et.videoWidth,et.videoHeight,g.scenegraph,h,F);const{width:rt,height:lt,isMerge:ct}=Ru(F,g);if(a){const{width:Ht,height:Ie}=zv(et.videoWidth,et.videoHeight,rt-h[1]-h[3],lt-h[0]-h[2]),ye=tS(0,0,rt,lt,Ht,Ie,u,d,h);it.setAttributes({width:Ht,height:Ie,x:ye.x,y:ye.y,dx:0})}else it.setAttributes({x:h[3],y:h[0],width:rt-h[1]-h[3],height:lt-h[2]-h[0],dy:0});ct&&eS(F.mergeStartCol,F.mergeEndCol,F.mergeStartRow,F.mergeEndRow,g);const{width:ut,height:gt}=Ru(F,g),Gt=Math.floor(Math.min(ut-h[1]-h[3],gt-h[2]-h[0])/2),re=0+(ut>it.attribute.width?it.attribute.x-0+it.attribute.width/2:ut/2),Fe=0+(gt>it.attribute.height?it.attribute.y-0+it.attribute.height/2:gt/2),Qt=F.getChildByName("image",!0),{dx:Ii,dy:hi}=Qt.attribute,ri=new Wl({x:re-Gt/2,y:Fe-Gt/2,width:Gt,height:Gt,image:$C.play.svg,cursor:$C.play.cursor,dx:Ii,dy:hi});ri.name="play-icon",F.appendChild(ri),g.scenegraph.updateNextFrame()})),et.onerror=()=>{it.image=$C.damage_pic.svg},et.src=K,et.setAttribute("preload","auto");const it=mv({x:h[3],y:h[0],width:o-h[1]-h[3],height:s-h[2]-h[0],image:et,cursor:"pointer"});return it.name="image",it.keepAspectRatio=a,it.textAlign=u,it.textBaseline=d,F.appendChild(it),F}function dft(n,t,e){if(typeof n=="boolean"){const i=Dp({x:t.attribute.width,y:0,startAngle:Math.PI/2,endAngle:Math.PI,outerRadius:6,fill:"#3073F2",pickable:!1});i.name="mark",t.appendChild(i)}else{const{bgColor:i="#3073F2",shape:r="sector",position:o="right-top",size:s=10,offset:a=0}=n;let l,h,u,d,c,g;if(r==="sector")o==="right-top"?(l=t.attribute.width-a,h=a,u=Math.PI/2,d=Math.PI):o==="left-top"?(l=a,h=a,u=0,d=Math.PI/2):o==="right-bottom"?(l=t.attribute.width-a,h=t.attribute.height-a,u=Math.PI,d=Math.PI/2*3):o==="left-bottom"&&(l=a,h=t.attribute.height-a,u=Math.PI/2*3,d=2*Math.PI),c=i,g=Dp({x:l,y:h,startAngle:u,endAngle:d,outerRadius:s,fill:c,pickable:!1});else if(r==="triangle"){let f,p,m,v;o==="right-top"?(l=t.attribute.width-a,h=a,f=l-s,p=h,m=l,v=h+s):o==="left-top"?(l=a,h=a,f=l+s,p=h,m=l,v=h+s):o==="right-bottom"?(l=t.attribute.width-a,h=t.attribute.height-a,f=l-s,p=h,m=l,v=h-s):o==="left-bottom"&&(l=a,h=t.attribute.height-a,f=l+s,p=h,m=l,v=h-s),c=i,g=II({points:[{x:l,y:h},{x:f,y:p},{x:m,y:v}],fill:c,pickable:!1})}else r==="rect"&&(o==="right-top"?(l=t.attribute.width-s-a,h=a):o==="left-top"?(l=a,h=a):o==="right-bottom"?(l=t.attribute.width-s-a,h=t.attribute.height-s-a):o==="left-bottom"&&(l=a,h=t.attribute.height-s-a),c=i,g=be({x:l,y:h,width:s,height:s,fill:c,pickable:!1}));g.name="mark",t.appendChild(g)}}function cft(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b){var y,C,w,_,A,x,S,T,M,R,E,P,B,k,L,O,I,H,D,z,G,U,j,X,Z,J,q,st,Q,ot,nt,F,N;const W=n._getCellStyle(o,s),V=Nv("padding",W,o,s,n);$(V)&&(u=V),!((y=m?.text)===null||y===void 0)&&y.textAlign&&(d=(C=m?.text)===null||C===void 0?void 0:C.textAlign),!((w=m?.text)===null||w===void 0)&&w.textBaseline&&(c=(_=m?.text)===null||_===void 0?void 0:_.textBaseline);const K=n.isAutoRowHeight(s),et=a==="auto",it=(A=W.autoWrapText)!==null&&A!==void 0?A:n.internalProps.autoWrapText,rt=W.lineClamp,lt=Xo(o,s,m,n);let ct;if(b&&(ct=n.scenegraph.getCell(o,s,!0),ct&&ct.role==="cell"&&ct.setAttributes({x:i,y:r,width:l,height:h,lineWidth:(S=(x=m?.group)===null||x===void 0?void 0:x.lineWidth)!==null&&S!==void 0?S:void 0,fill:(M=(T=m?.group)===null||T===void 0?void 0:T.fill)!==null&&M!==void 0?M:void 0,stroke:(E=(R=m?.group)===null||R===void 0?void 0:R.stroke)!==null&&E!==void 0?E:void 0,strokeArrayWidth:lt??void 0,strokeArrayColor:(B=(P=m?.group)===null||P===void 0?void 0:P.strokeArrayColor)!==null&&B!==void 0?B:void 0,cursor:(L=(k=m?.group)===null||k===void 0?void 0:k.cursor)!==null&&L!==void 0?L:void 0,lineDash:(I=(O=m?.group)===null||O===void 0?void 0:O.lineDash)!==null&&I!==void 0?I:void 0,lineCap:"butt",clip:!0,cornerRadius:m.group.cornerRadius})),ct&&ct.role==="cell"||(ct=new Vt({x:i,y:r,width:l,height:h,lineWidth:(D=(H=m?.group)===null||H===void 0?void 0:H.lineWidth)!==null&&D!==void 0?D:void 0,fill:(G=(z=m?.group)===null||z===void 0?void 0:z.fill)!==null&&G!==void 0?G:void 0,stroke:(j=(U=m?.group)===null||U===void 0?void 0:U.stroke)!==null&&j!==void 0?j:void 0,strokeArrayWidth:lt??void 0,strokeArrayColor:(Z=(X=m?.group)===null||X===void 0?void 0:X.strokeArrayColor)!==null&&Z!==void 0?Z:void 0,cursor:(q=(J=m?.group)===null||J===void 0?void 0:J.cursor)!==null&&q!==void 0?q:void 0,lineDash:(Q=(st=m?.group)===null||st===void 0?void 0:st.lineDash)!==null&&Q!==void 0?Q:void 0,lineCap:"butt",clip:!0,cornerRadius:m.group.cornerRadius}),ct.role="cell",ct.col=o,ct.row=s,e?.addCellGroup(ct)),f&&ct.appendChild(f),p){const ut=t;let gt;if(g){let Gt=o,re=s;v&&(Gt=v.start.col,re=v.start.row),gt=n.getCellIcons(Gt,re)}nat(ct,gt,ut,u,et,K,it,typeof rt=="number"?rt:void 0,ct.attribute.width,ct.attribute.height,d,c,n,m,v),!((ot=m?._vtable)===null||ot===void 0)&&ot.marked&&dft((nt=m?._vtable)===null||nt===void 0?void 0:nt.marked,ct)}return f&&ct.setAttributes({width:Math.max(ct.attribute.width,(F=f.attribute.width)!==null&&F!==void 0?F:0),height:Math.max(ct.attribute.height,(N=f.attribute.height)!==null&&N!==void 0?N:0)}),ct}function gft(n,t,e,i,r,o,s,a,l,h){var u,d,c,g,f;if(n.dependField){const Q=fe(n.dependField,{col:o,row:s,table:l,value:i,dataValue:r,cellHeaderPaths:void 0});r=(d=(u=l.getCellOriginRecord(o,s))===null||u===void 0?void 0:u[Q])!==null&&d!==void 0?d:r}const p=(c=fe(n.barType,{col:o,row:s,table:l,value:i,dataValue:r,cellHeaderPaths:void 0}))!==null&&c!==void 0?c:"default",m=(g=fe(n.min,{col:o,row:s,table:l,value:i,dataValue:r,cellHeaderPaths:void 0}))!==null&&g!==void 0?g:0,v=(f=fe(n.max,{col:o,row:s,table:l,value:i,dataValue:r,cellHeaderPaths:void 0}))!==null&&f!==void 0?f:m+100;let b=0;b=h?l.getRowsHeight(h.start.row,h.end.row):l.getRowHeight(s);let y=e,C=b,w=0;dt(l.theme._contentOffset)&&(w=l.theme._contentOffset);const _=new Vt({x:-w,y:-w,width:y,height:C});_.name="progress-bar";const{showBar:A,barColor:x,barBgColor:S,barPositiveColor:T,barNegativeColor:M,barAxisColor:R,barRightToLeft:E,showBarMark:P,barMarkPositiveColor:B,barMarkNegativeColor:k,barMarkWidth:L,barMarkPosition:O,barMarkInBar:I}=t;let{barHeight:H,barBottom:D,barPadding:z}=t;z.length===1?z=[z[0],z[0],z[0],z[0]]:z.length===2?z=[z[0],z[1],z[0],z[1]]:z.length===3&&(z=[z[0],z[1],z[2],z[1]]),z=z.map(((Q,ot)=>{if(typeof Q=="string"&&bf.endsWith(Q,"%")){const nt=Number(Q.substr(0,Q.length-1));return ot===0||ot===2?b*nt/100:e*nt/100}return Number(Q)}));const G=Kt(ht("borderLineWidth",t,o,s,l)),U=Math.max(z[0],Math.ceil(G[0]/2));let j=Math.max(z[1],Math.floor(G[1]/2));const X=Math.max(z[2],Math.floor(G[2]/2));let Z=Math.max(z[3],Math.ceil(G[3]/2));P&&L>0&&O==="right"&&I===!1&&(j+=L,Z+=L),y-=j+Z,C-=X+U,s===l.rowCount-1&&[0,"0"].includes(D)&&(C-=1);const J=U,q=Z,st=y;if(typeof H=="string"&&bf.endsWith(H,"%")?(H=Number(H.substr(0,H.length-1)),H=C*H/100):H=Number(H),typeof D=="string"&&bf.endsWith(D,"%")?(D=Number(D.substr(0,D.length-1)),D=C*D/100):D=Number(D),fe(A,{col:o,row:s,table:l,context:null,value:i,dataValue:r})){let Q=`${r}`;bf.endsWith(Q,"%")&&(Q=Q.substr(0,Q.length-1));const ot=Number(Q);if(isNaN(ot))return _;if((p??"default")==="default"){const nt=ot<m?0:ot>v?1:(ot-m)/(v-m),F=y,N=J+C-H-D;let W=Math.min(F*nt,F);const V=E?q+st-W:q;o!==l.colCount-1||nt!==1||E||(W-=1);const K=fe(S,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:nt});if(K){const rt=be({x:V,y:N,width:F,height:H,fill:K});_.addChild(rt)}const et=fe(x,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:nt})||"#20a8d8",it=be({x:V,y:N,width:W,height:H,fill:et});_.addChild(it)}else if(p==="negative"){const nt=m<0?-m:0,F=v>0?v:0,N=nt/(nt+F),W=1-N,V=ot>0?ot/F:0,K=ot<0?-ot/nt:0,et=y,it=J+C-H-D,rt=q,lt=fe(S,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:V});if(lt){const ye=be({x:rt,y:it,width:et,height:H,fill:lt});_.addChild(ye)}const ct=E?W*et:N*et,ut=Math.min(et*N*K,et),gt=E?{left:rt+ct,top:it,width:ut,height:H}:{left:rt+ct-ut,top:it,width:ut,height:H},Gt=fe(M,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:K})||"#20a8d8",re=be({x:gt.left,y:gt.top,width:gt.width,height:gt.height,fill:Gt});_.addChild(re);let Fe=Math.min(et*W*V,et);o!==l.colCount-1||V!==1||E||(Fe-=1);const Qt=E?{left:rt+ct-Fe,top:it,width:Fe,height:H}:{left:rt+ct,top:it,width:Fe,height:H},Ii=fe(T,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:V})||"#20a8d8",hi=be({x:Qt.left,y:Qt.top,width:Qt.width,height:Qt.height,fill:Ii});_.addChild(hi);const ri=E?gt.left:Qt.left,Ht=fe(R,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:V}),Ie=Ke({x:0,y:0,stroke:Ht,lineWidth:1,lineDash:[2,2],points:[{x:ri,y:0},{x:ri,y:b}]});if(_.addChild(Ie),P&&(V||K)){const ye=L,oi=[];let Sn;if(V>0)if(Sn=fe(B,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:V})||"#20a8d8",O==="right"){const Ve=E?Qt.left+L/2:Qt.left+Qt.width+(I?-L/2:L/2);oi.push({x:Ve,y:Qt.top}),oi.push({x:Ve,y:Qt.top+Qt.height})}else O==="bottom"&&(oi.push({x:Qt.left,y:Qt.top+Qt.height-L/2}),oi.push({x:Qt.left+Qt.width,y:Qt.top+Qt.height-L/2}));else if(K>0)if(Sn=fe(k,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:K})||"#20a8d8",O==="right"){const Ve=E?gt.left+gt.width-L/2:gt.left+L/2;oi.push({x:Ve,y:gt.top}),oi.push({x:Ve,y:gt.top+gt.height})}else O==="bottom"&&(oi.push({x:gt.left,y:gt.top+gt.height-L/2}),oi.push({x:gt.left+gt.width,y:gt.top+gt.height-L/2}));const Ct=Ke({x:0,y:0,stroke:Sn,lineWidth:ye,points:oi});_.addChild(Ct)}}else if(p==="negative_no_axis"){const nt=m<0?-m:0,F=v>0?v:0,N=Math.max(nt,F),W=N===0?0:Math.abs(ot)/N,V=y;let K=Math.min(V*W,V);o!==l.colCount-1||W!==1||E||(K-=1);const et=J+C-H-D,it=E?q+st-K:q,rt=fe(S,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:W});if(rt){const gt=be({x:it,y:et,width:V,height:H,fill:rt});_.addChild(gt)}const lt={left:it,top:et,width:K,height:H};let ct;ct=ot>=0?fe(T,{col:o,row:s,table:l,context:null,value:i,percentile:W,dataValue:r})||"#20a8d8":fe(M,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:W})||"#20a8d8";const ut=be({x:lt.left,y:lt.top,width:lt.width,height:lt.height,fill:ct});if(_.addChild(ut),P&&ot){const gt=L,Gt=[];let re;if(re=ot>=0?fe(B,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:W})||"#20a8d8":fe(k,{col:o,row:s,table:l,context:null,value:i,dataValue:r,percentile:W})||"#20a8d8",O==="right"){const Qt=E?lt.left+L/2:lt.left+lt.width-L/2;Gt.push({x:Qt,y:lt.top}),Gt.push({x:Qt,y:lt.top+lt.height})}else O==="bottom"&&(Gt.push({x:lt.left,y:lt.top+lt.height-L/2}),Gt.push({x:lt.left+lt.width,y:lt.top+lt.height-L/2}));const Fe=Ke({x:0,y:0,stroke:re,lineWidth:gt,points:Gt});_.addChild(Fe)}}}return _}function fft(n,t,e,i,r,o){var s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w;if(e?.zero&&(n=Math.min(n,0),t=Math.max(t,0)),e?.expand){const x=n,S=t;$(e.expand.min)&&(n=x-(S-x)*e.expand.min),$(e.expand.max)&&(t=S+(S-x)*e.expand.max)}let _,A;if(dt(e?.min)&&(n=e.min),dt(e?.max)&&(t=e.max),e?.type==="log"?(_=new _g,_.base((s=e?.base)!==null&&s!==void 0?s:10)):e?.type==="symlog"?(_=new wg,_.constant((a=e?.constant)!==null&&a!==void 0?a:10)):_=new Uu,_.domain([n,t],!!e?.nice),o)pft(_,o);else if(e?.nice){let x=(d=(h=(l=e.tick)===null||l===void 0?void 0:l.forceTickCount)!==null&&h!==void 0?h:(u=e.tick)===null||u===void 0?void 0:u.tickCount)!==null&&d!==void 0?d:10;ur(x)&&(x=x({axisLength:r,labelStyle:(g=(c=e?.label)===null||c===void 0?void 0:c.style)!==null&&g!==void 0?g:{fontSize:Td.LABEL_FONT_SIZE}})),e.niceType==="accurateFirst"&&(x=Math.max(10,x)),he(e.min)&&he(e.max)?_.nice(x):$(e.min)&&he(e.max)?_.niceMax(x):he(e.min)&&$(e.max)&&_.niceMin(x)}return delete _._niceType,A=((p=(f=o?.targetTicks)===null||f===void 0?void 0:f.length)!==null&&p!==void 0?p:!((m=e?.tick)===null||m===void 0)&&m.forceTickCount)?_.forceTicks((b=(v=o?.targetTicks)===null||v===void 0?void 0:v.length)!==null&&b!==void 0?b:(y=e?.tick)===null||y===void 0?void 0:y.forceTickCount):_.ticks(dt((C=e?.tick)===null||C===void 0?void 0:C.tickCount)?e.tick.tickCount:5,{noDecimals:(w=e?.tick)===null||w===void 0?void 0:w.noDecimals}),{range:_.domain(),ticks:A}}function pft(n,t){n.niceMax(t.targetTicks.length)}function mft(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v){var b,y,C,w,_,A,x,S,T,M,R,E,P,B,k,L,O,I,H,D,z,G,U,j;if(!n){const st=Xo(r,o,f,g);v&&(n=g.scenegraph.highPerformanceGetCell(r,o,!0))&&n.role==="cell"&&n.setAttributes({x:e,y:i,width:a,height:l,lineWidth:(y=(b=f?.group)===null||b===void 0?void 0:b.lineWidth)!==null&&y!==void 0?y:void 0,fill:(w=(C=f?.group)===null||C===void 0?void 0:C.fill)!==null&&w!==void 0?w:void 0,stroke:(A=(_=f?.group)===null||_===void 0?void 0:_.stroke)!==null&&A!==void 0?A:void 0,strokeArrayWidth:st,strokeArrayColor:(S=(x=f?.group)===null||x===void 0?void 0:x.strokeArrayColor)!==null&&S!==void 0?S:void 0,cursor:(M=(T=f?.group)===null||T===void 0?void 0:T.cursor)!==null&&M!==void 0?M:void 0,lineDash:(E=(R=f?.group)===null||R===void 0?void 0:R.lineDash)!==null&&E!==void 0?E:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius}),n&&n.role==="cell"||((n=new Vt({x:e,y:i,width:a,height:l,lineWidth:(B=(P=f?.group)===null||P===void 0?void 0:P.lineWidth)!==null&&B!==void 0?B:void 0,fill:(L=(k=f?.group)===null||k===void 0?void 0:k.fill)!==null&&L!==void 0?L:void 0,stroke:(I=(O=f?.group)===null||O===void 0?void 0:O.stroke)!==null&&I!==void 0?I:void 0,strokeArrayWidth:st,strokeArrayColor:(D=(H=f?.group)===null||H===void 0?void 0:H.strokeArrayColor)!==null&&D!==void 0?D:void 0,cursor:(G=(z=f?.group)===null||z===void 0?void 0:z.cursor)!==null&&G!==void 0?G:void 0,lineDash:(j=(U=f?.group)===null||U===void 0?void 0:U.lineDash)!==null&&j!==void 0?j:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius})).role="cell",n.col=r,n.row=o,t?.addCellGroup(n))}let X;if(c){let st=r,Q=o;m&&(st=m.start.col,Q=m.start.row),X=g.getCellIcons(st,Q)}let Z=0,J=0;if(Array.isArray(X)&&X.length!==0){const{leftIconWidth:st,rightIconWidth:Q,absoluteRightIconWidth:ot}=ju(X,n,m,g);Z=st+Q,J=st,n.forEachChildren((nt=>{nt.role==="icon-left"?nt.setAttribute("x",nt.attribute.x+h[3]):nt.role==="icon-right"?nt.setAttribute("x",nt.attribute.x+a-Q-h[1]):nt.role==="icon-absolute-right"&&nt.setAttribute("x",nt.attribute.x+a-ot-h[1])})),n.forEachChildren((nt=>{d==="middle"?nt.setAttribute("y",(l-nt.AABBBounds.height())/2):d==="bottom"?nt.setAttribute("y",l-nt.AABBBounds.height()-h[2]):nt.setAttribute("y",h[0])}))}const q=vft(r,o,s-Z,a,l,h,f,p,g);return q&&n.appendChild(q),a-=h[1]+h[3]+Z,l-=h[0]+h[2],u==="center"?q.setAttribute("x",h[3]+J+(a-q.AABBBounds.width())/2):u==="right"?q.setAttribute("x",h[3]+J+a-q.AABBBounds.width()):q.setAttribute("x",h[3]+J),d==="middle"?q.setAttribute("y",h[0]+(l-q.AABBBounds.height())/2):d==="bottom"?q.setAttribute("y",h[0]+l-q.AABBBounds.height()):q.setAttribute("y",h[0]),n}function vft(n,t,e,i,r,o,s,a,l){var h,u;const d=l._getCellStyle(n,t),c=ht("buttonColor",d,n,t,l),g=ht("buttonBorderColor",d,n,t,l),f=ht("buttonLineWidth",d,n,t,l),p=ht("buttonBorderRadius",d,n,t,l),m=ht("buttonHoverColor",d,n,t,l),v=ht("buttonHoverBorderColor",d,n,t,l),b=ht("buttonPadding",d,n,t,l),y=ht("buttonTextHoverColor",d,n,t,l),C=ht("buttonDisableColor",d,n,t,l),w=ht("buttonDisableBorderColor",d,n,t,l),_=ht("buttonTextDisableColor",d,n,t,l),A=l.getCellValue(n,t),x=l.getCellOriginValue(n,t),S=Nn(n,t,l),T=l._getCellStyle(n,t),M=(h=T.autoWrapText)!==null&&h!==void 0?h:l.internalProps.autoWrapText,{lineClamp:R}=T,E=e==="auto",P=l.isAutoRowHeight(t),{disable:B,text:k}=a,L=fe(B,{col:n,row:t,table:l,context:null,value:A,dataValue:x}),O=fe(k,{col:n,row:t,table:l,context:null,value:A,dataValue:x}),I=(u=O??A)!==null&&u!==void 0?u:"",H={maxLineWidth:E?1/0:i-(o[1]+o[3]+S),textAlign:"left",textBaseline:"top",autoWrapText:M,lineClamp:R,wordBreak:"break-word",heightLimit:P?-1:r-Math.floor(o[0]+o[2]),pickable:!1,dx:S,whiteSpace:I.length!==1||M?"normal":"no-wrap"},D=s.text?Object.assign({},s.text,H):H,z={x:0,y:0,cursor:L?"not-allowed":"pointer",disable:L,childrenPickable:!1,text:I.length===1?I[0]:I,textStyle:D,padding:b,panel:{visible:!0,fill:L?C:c,stroke:L?w:g,lineWidth:f,cornerRadius:p},state:{text:{hover:{}},panel:{hover:{fill:m,stroke:v}}}};_&&(z.state.text.fill=_),y&&(z.state.text.hover.fill=y);const G=new va(z);return G.name="button",L||(G.addEventListener("mouseenter",(()=>{G.addState("hover",!0,!1),G.stage.renderNextFrame()})),G.addEventListener("mouseleave",(()=>{G.removeState("hover",!1),G.stage.renderNextFrame()}))),G}const bft=()=>{St.registerFunction("createChartCellGroup",Jgt),St.registerFunction("getAxisDomainRangeAndLabels",fft)},yft=()=>{St.registerFunction("createCheckboxCellGroup",tft)},Cft=()=>{St.registerFunction("createImageCellGroup",sat)},_ft=()=>{St.registerFunction("createProgressBarCell",gft)},wft=()=>{St.registerFunction("createRadioCellGroup",ift)},xft=()=>{St.registerFunction("createSwitchCellGroup",sft)},Sft=()=>{St.registerFunction("createButtonCellGroup",mft)},Aft=()=>{St.registerFunction("createSparkLineCellGroup",lft)},Mft=()=>{St.registerFunction("createTextCellGroup",cft)},Tft=()=>{St.registerFunction("createVideoCellGroup",uft)};Wgt(),jgt(),Vgt(),Ggt(),$gt(),Ugt(),Zgt(),bdt(),Xgt(),bft(),yft(),Cft(),_ft(),wft(),xft(),Sft(),Aft(),Mft(),Tft();class Rft extends bct{}sD();class Bft extends Jt{constructor(t){super(t),this._lastWidth=t.width,this._lastHeight=t.height,this._lastX=t.x,this._lastY=t.y}updateTextPosition(){var t,e,i;if(!this.textLabel||!this.barRect)return;const r=this.labelStyle||{},{textAlign:o="left",textBaseline:s="middle",textOverflow:a,color:l="#333333",outsideColor:h="#333333",padding:u=8}=r,d=Array.isArray(u)?u[3]:u,c=this.barRect.attribute.width,g=this.barRect.attribute.height,f=this.textLabel.attribute.fontSize||12,p=this.textLabel.attribute.fontFamily||"Arial",m=String(this.textLabel.attribute.text||""),v=nS.measureTextWidth(m,{fontSize:f,fontFamily:p})+2*d<=c,b=mg(pg(d),o,s,c,g),y=r.orient||(!v&&r.orientHandleWithOverflow?r.orientHandleWithOverflow:null);if(this.textLabel.setAttribute("visible",!0),this.textLabel.setAttribute("textBaseline",s),y){(t=this.textLabel.parent)===null||t===void 0||t.removeChild(this.textLabel),this.appendChild(this.textLabel),this.textLabel.setAttribute("fill",h),this.textLabel.setAttribute("ellipsis",void 0),this.textLabel.setAttribute("maxLineWidth",void 0),this.textLabel.setAttribute("zIndex",1e4),this.setAttribute("zIndex",1e4);const C={left:{x:-d,y:g/2,align:"right",baseline:"middle"},right:{x:c+d,y:g/2,align:"left",baseline:"middle"},top:{x:c/2,y:-d,align:"center",baseline:"bottom"},bottom:{x:c/2,y:g+d,align:"center",baseline:"top"}}[y];C&&(this.textLabel.setAttribute("x",C.x),this.textLabel.setAttribute("y",C.y),this.textLabel.setAttribute("textAlign",C.align),this.textLabel.setAttribute("textBaseline",C.baseline))}else(e=this.textLabel.parent)===null||e===void 0||e.removeChild(this.textLabel),(i=this.clipGroupBox)===null||i===void 0||i.appendChild(this.textLabel),this.textLabel.setAttribute("x",b.x),this.textLabel.setAttribute("y",b.y),this.textLabel.setAttribute("textAlign",o),this.textLabel.setAttribute("fill",l),this.textLabel.setAttribute("maxLineWidth",c-d),this.textLabel.setAttribute("ellipsis",a==="clip"?"":a==="ellipsis"?"...":$(a)?a:void 0)}}const EP=`<svg width="100" height="200" xmlns="http://www.w3.org/2000/svg">
  <line x1="30" y1="10" x2="30" y2="190" stroke="black" stroke-width="4"/>
  <line x1="70" y1="10" x2="70" y2="190" stroke="black" stroke-width="4"/>
</svg>`,oz=10;class kft{formatMilestoneText(t,e){if(!t)return"";const i=t.match(/{([^}]+)}/g);return i&&i.forEach((r=>{const o=r.substring(1,r.length-1),s=e[o];s!==void 0&&(t=t.replace(r,String(s)))})),t}calculateMilestoneTextPosition(t,e,i=4){const r=typeof i=="number"?i:4;let o=0,s=0,a="left",l="middle";const h=e/2;switch(t){case"left":o=-r,s=h,a="end",l="middle";break;case"right":default:o=e+r,s=h,a="start",l="middle";break;case"top":o=h,s=-r,a="center",l="bottom";break;case"bottom":o=h,s=e+r,a="center",l="top"}return{textX:o,textY:s,textAlignValue:a,textBaselineValue:l}}constructor(t){this.selectedBorders=[],this._scene=t,this.width=t._gantt.tableNoFrameWidth,this.height=t._gantt.gridHeight,this.group=new Jt({x:0,y:t._gantt.getAllHeaderRowsHeight(),width:this.width,height:this.height,pickable:!1,clip:!0}),this.group.name="task-bar-container",t.ganttGroup.addChild(this.group),this.initBars(),this.initHoverBarIcons()}initBars(){var t,e,i;this.barContainer=new Jt({x:0,y:0,width:this._scene._gantt.getAllDateColsWidth(),height:this._scene._gantt.getAllTaskBarsHeight(),pickable:!1,clip:!0}),this.group.appendChild(this.barContainer);for(let r=0;r<this._scene._gantt.itemCount;r++)if(this._scene._gantt.parsedOptions.tasksShowMode!==ft.Sub_Tasks_Inline&&this._scene._gantt.parsedOptions.tasksShowMode!==ft.Sub_Tasks_Separate&&this._scene._gantt.parsedOptions.tasksShowMode!==ft.Sub_Tasks_Arrange&&this._scene._gantt.parsedOptions.tasksShowMode!==ft.Sub_Tasks_Compact)if(this._scene._gantt.parsedOptions.tasksShowMode!==ft.Project_Sub_Tasks_Inline){const o=this.initBar(r);o&&this.barContainer.appendChild(o)}else{const o=this._scene._gantt.getRecordByIndex(r),s=o.hierarchyState==="expand";if(o.type===se.PROJECT&&((i=o.children)===null||i===void 0?void 0:i.length)>0&&!s){const a=this._scene._gantt.getRecordIndexByTaskShowIndex(r),l=Array.isArray(a)?[...a]:[a],h=(u,d)=>{var c,g;if(((c=u.children)===null||c===void 0?void 0:c.length)>0)for(let f=0;f<((g=u.children)===null||g===void 0?void 0:g.length);f++){const p=u.children[f];if(p.type!==se.PROJECT){const m=this.initBar(r,[...d,f],u.children.length);m&&this.barContainer.appendChild(m)}else h(p,[...d,f])}};h(o,l)}else{const a=this.initBar(r);a&&this.barContainer.appendChild(a)}}else{const o=this._scene._gantt.getRecordByIndex(r);if(((t=o.children)===null||t===void 0?void 0:t.length)>0)for(let s=0;s<((e=o.children)===null||e===void 0?void 0:e.length);s++){const a=this.initBar(r,s,o.children.length);a&&this.barContainer.appendChild(a)}else{const s=this.initBar(r);s&&this.barContainer.appendChild(s)}}}initBar(t,e,i){var r,o,s,a,l;const h=this._scene._gantt.parsedOptions.taskBarCustomLayout,{startDate:u,endDate:d,taskDays:c,progress:g,taskRecord:f}=this._scene._gantt.getTaskInfoByTaskListIndex(t,e),p=f.type===se.MILESTONE;if(p&&!u||!p&&(c<=0||!u||!d||u.getTime()>d.getTime()))return null;const{unit:m,step:v}=this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0];let b=ce(d,u,m,v,1)*this._scene._gantt.parsedOptions.timelineColWidth;const y=this._scene._gantt.getTaskBarStyle(t,e),C=y.width;$(y.minSize)&&(b=Math.max(b,y.minSize));const w=this._scene._gantt.parsedOptions.rowHeight,_=this._scene._gantt.parsedOptions.taskBarMilestoneStyle.width,A=ce(u,this._scene._gantt.parsedOptions.minDate,m,v)*this._scene._gantt.parsedOptions.timelineColWidth-(p?_/2:0),x=this._scene._gantt.getRowsHeightByIndex(0,t-1)+(this._scene._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Separate?((r=e)!==null&&r!==void 0?r:0)*w:this._scene._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||this._scene._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact?f.vtable_gantt_showIndex*w:0)+(w-(p?_:C))/2,S=new Bft({x:A,y:x,width:p?_:b,height:p?_:C,cornerRadius:p?this._scene._gantt.parsedOptions.taskBarMilestoneStyle.cornerRadius:y.cornerRadius,lineWidth:p?2*this._scene._gantt.parsedOptions.taskBarMilestoneStyle.borderLineWidth:2*((o=y.borderLineWidth)!==null&&o!==void 0?o:y.borderWidth),stroke:p?this._scene._gantt.parsedOptions.taskBarMilestoneStyle.borderColor:y.borderColor,angle:p?.25*Math.PI:0,anchor:p?[A+_/2,x+_/2]:void 0});S.name="task-bar",S.task_index=t,S.sub_task_index=e,S.record=f;const T=new Jt({x:0,y:0,width:S.attribute.width,height:S.attribute.height,cornerRadius:p?this._scene._gantt.parsedOptions.taskBarMilestoneStyle.cornerRadius:y.cornerRadius,clip:!0});let M;T.name="task-bar-group",S.appendChild(T),S.clipGroupBox=T;let R=!0,E=!0;if(h){let P;typeof h=="function"?P=h({width:b,height:C,index:t,startDate:u,endDate:d,taskDays:c,progress:g,taskRecord:f,ganttInstance:this._scene._gantt}):P=h,P&&(M=P.rootContainer,R=(s=P.renderDefaultBar)!==null&&s!==void 0&&s,E=(a=P.renderDefaultText)!==null&&a!==void 0&&a,M&&(M.name="task-bar-custom-render"))}if(R){const P=be({x:0,y:0,width:S.attribute.width,height:S.attribute.height,fill:p?this._scene._gantt.parsedOptions.taskBarMilestoneStyle.fillColor:y.barColor,pickable:!1});if(P.name="task-bar-rect",T.appendChild(P),S.barRect=P,f.type!==se.MILESTONE){const B=be({x:0,y:0,width:b*g/100,height:C,fill:y.completedBarColor,pickable:!1});B.name="task-bar-progress-rect",T.appendChild(B),S.progressRect=B}}if(M&&T.appendChild(M),E&&f.type!==se.MILESTONE){const{textAlign:P,textBaseline:B,fontSize:k,fontFamily:L,textOverflow:O,color:I,padding:H}=this._scene._gantt.parsedOptions.taskBarLabelStyle,D=mg(pg(H),P,B,b,C),z=Bc({x:D.x,y:D.y,fontSize:k,fill:I,fontFamily:L,text:aD(this._scene._gantt.parsedOptions.taskBarLabelText,f),maxLineWidth:b-10,textBaseline:B,textAlign:P,ellipsis:O==="clip"?"":O==="ellipsis"?"...":$(O)?O:void 0,poptip:{position:"bottom"}});T.appendChild(z),S.textLabel=z,S.labelStyle=this._scene._gantt.parsedOptions.taskBarLabelStyle,S.updateTextPosition()}if(E&&f.type==="milestone"&&this._scene._gantt.parsedOptions.taskBarMilestoneStyle.labelText){const P=this._scene._gantt.parsedOptions.taskBarMilestoneStyle,B=P.labelTextStyle||{},k=this.calculateMilestoneTextPosition(P.textOrient||"right",P.width,(l=B.padding)!==null&&l!==void 0?l:4),L=new Jt({x:A,y:x,width:P.width,height:P.width,angle:0,pickable:!1}),O=Bc({x:k.textX,y:k.textY,fontSize:B.fontSize||16,fontFamily:B.fontFamily||"Arial",fill:B.color||"#ff0000",textBaseline:B.textBaseline||k.textBaselineValue,textAlign:B.textAlign||k.textAlignValue,text:this.formatMilestoneText(P.labelText,f),pickable:!1});L.appendChild(O),this.barContainer.appendChild(L),S.milestoneTextLabel=O,S.milestoneTextContainer=L}return S}updateTaskBarNode(t,e){const i=this.getTaskBarNodeByIndex(t,e);i&&this.barContainer.removeChild(i);const r=this.initBar(t,e);r&&(this.barContainer.insertInto(r,t),r.updateTextPosition())}initHoverBarIcons(){var t,e;const i=new Jt({x:0,y:0,width:100,height:100,clip:!1,pickable:!1,cornerRadius:(e=(t=this._scene._gantt.parsedOptions.taskBarHoverStyle.cornerRadius)!==null&&t!==void 0?t:F0.cornerRadius)!==null&&e!==void 0?e:0,fill:this._scene._gantt.parsedOptions.taskBarHoverStyle.barOverlayColor,visibleAll:!1});if(this.hoverBarGroup=i,i.name="task-bar-hover-shadow",this._scene._gantt.parsedOptions.taskBarResizable){const s=new zo({x:0,y:0,width:10,height:20,image:EP,pickable:!0,cursor:"col-resize"});s.name="task-bar-hover-shadow-left-icon",this.hoverBarLeftIcon=s,i.appendChild(s);const a=new zo({x:0,y:0,width:10,height:20,image:EP,pickable:!0,cursor:"col-resize"});a.name="task-bar-hover-shadow-right-icon",this.hoverBarRightIcon=a,i.appendChild(a)}const r=new Jt({x:0,y:0,width:12,height:12,pickable:!0,cursor:"ew-resize",visible:!1}),o=new Dl({points:[{x:6,y:0},{x:0,y:6},{x:12,y:6}],fill:"#0064ff",stroke:"#ffffff",lineWidth:1,pickable:!1});r.appendChild(o),r.name="task-bar-progress-handle",this.hoverBarProgressHandle=r,i.appendChild(r)}setX(t){this.barContainer.setAttribute("x",t)}setY(t){this.barContainer.setAttribute("y",t)}refresh(){this.width=this._scene._gantt.tableNoFrameWidth,this.height=this._scene._gantt.gridHeight,this.group.setAttributes({height:this.height,width:this.width,y:this._scene._gantt.getAllHeaderRowsHeight()});const t=this.barContainer.attribute.x,e=this.barContainer.attribute.y;this.barContainer.removeAllChild(),this.group.removeChild(this.barContainer),this.initBars(),this.setX(t),this.setY(e)}resize(){this.width=this._scene._gantt.tableNoFrameWidth,this.height=this._scene._gantt.gridHeight,this.group.setAttribute("width",this.width),this.group.setAttribute("height",this.height)}showHoverBar(t,e,i,r,o){var s,a,l,h,u;const{startDate:d,endDate:c,taskRecord:g}=this._scene._gantt.getTaskInfoByTaskListIndex(o.task_index,o.sub_task_index);o&&o.name==="task-bar"&&o.appendChild(this.hoverBarGroup),this.hoverBarGroup.setAttribute("x",0),this.hoverBarGroup.setAttribute("y",0),this.hoverBarGroup.setAttribute("width",i),this.hoverBarGroup.setAttribute("height",r),this.hoverBarGroup.setAttribute("visibleAll",!0);const f=this._scene._gantt.getTaskBarStyle(o.task_index,o.sub_task_index);if(g.type===se.MILESTONE)this.hoverBarGroup.setAttribute("cornerRadius",o.attribute.cornerRadius);else{const y=(a=(s=this._scene._gantt.parsedOptions.taskBarHoverStyle.cornerRadius)!==null&&s!==void 0?s:f.cornerRadius)!==null&&a!==void 0?a:0;this.hoverBarGroup.setAttribute("cornerRadius",y)}(l=this.hoverBarLeftIcon)===null||l===void 0||l.setAttribute("visible",!1),(h=this.hoverBarRightIcon)===null||h===void 0||h.setAttribute("visible",!1),(u=this.hoverBarProgressHandle)===null||u===void 0||u.setAttribute("visibleAll",!1);let p=!0,m=!0,v=!0;const b=this._scene._gantt.parsedOptions.progressField;if(b&&g[b]!==void 0&&g[b]!==null)if(typeof this._scene._gantt.parsedOptions.taskBarProgressAdjustable=="function"){const y={index:o.task_index,startDate:d,endDate:c,taskRecord:g,ganttInstance:this._scene._gantt};v=this._scene._gantt.parsedOptions.taskBarProgressAdjustable(y)}else v=this._scene._gantt.parsedOptions.taskBarProgressAdjustable;else v=!1;if(g.type===se.MILESTONE)p=!1,m=!1,v=!1;else if(typeof this._scene._gantt.parsedOptions.taskBarResizable=="function"){const y={index:o.task_index,startDate:d,endDate:c,taskRecord:g,ganttInstance:this._scene._gantt},C=this._scene._gantt.parsedOptions.taskBarResizable(y);Array.isArray(C)?[p,m]=C:(p=C,m=C)}else Array.isArray(this._scene._gantt.parsedOptions.taskBarResizable)?[p,m]=this._scene._gantt.parsedOptions.taskBarResizable:(p=this._scene._gantt.parsedOptions.taskBarResizable,m=this._scene._gantt.parsedOptions.taskBarResizable);if(p&&this.hoverBarLeftIcon.setAttribute("visible",!0),m&&this.hoverBarRightIcon.setAttribute("visible",!0),v&&this.hoverBarProgressHandle.setAttribute("visibleAll",!0),this.hoverBarLeftIcon&&(this.hoverBarLeftIcon.setAttribute("x",0),this.hoverBarLeftIcon.setAttribute("y",Math.ceil(r/10)),this.hoverBarLeftIcon.setAttribute("width",10),this.hoverBarLeftIcon.setAttribute("height",r-2*Math.ceil(r/10)),this.hoverBarRightIcon.setAttribute("x",i-10),this.hoverBarRightIcon.setAttribute("y",Math.ceil(r/10)),this.hoverBarRightIcon.setAttribute("width",10),this.hoverBarRightIcon.setAttribute("height",r-2*Math.ceil(r/10))),this.hoverBarProgressHandle){const{progress:y}=this._scene._gantt.getTaskInfoByTaskListIndex(o.task_index,o.sub_task_index),C=i*y/100-6;this.hoverBarProgressHandle.setAttribute("x",C),this.hoverBarProgressHandle.setAttribute("y",r-3)}}hideHoverBar(){this.hoverBarGroup.setAttribute("visibleAll",!1)}createSelectedBorder(t,e,i,r,o,s=!1){const a=o.record,l=new Jt({x:t,y:e,width:i,height:r,pickable:!1,attachedToTaskBarNode:o,zIndex:1e4});l.name="task-bar-select-border",this.barContainer.appendChild(l),this.selectedBorders.push(l);const h=new Jt({x:0,y:0,width:i,height:r,lineWidth:this._scene._gantt.parsedOptions.taskBarSelectedStyle.borderLineWidth,pickable:!1,cornerRadius:o.attribute.cornerRadius,fill:!1,stroke:this._scene._gantt.parsedOptions.taskBarSelectedStyle.borderColor,shadowColor:this._scene._gantt.parsedOptions.taskBarSelectedStyle.shadowColor,shadowOffsetX:this._scene._gantt.parsedOptions.taskBarSelectedStyle.shadowOffsetX,shadowOffsetY:this._scene._gantt.parsedOptions.taskBarSelectedStyle.shadowOffsetY,shadowBlur:this._scene._gantt.parsedOptions.taskBarSelectedStyle.shadowBlur,angle:o.attribute.angle,anchor:[i/2,r/2]});if(l.appendChild(h),s){const u=a.type===se.MILESTONE?15:10,d=new Jt({x:-u,y:0,width:10,height:r,pickable:!0}),c=new ma({x:5,y:r/2,radius:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.radius,fill:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.fillColor,stroke:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeColor,lineWidth:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeWidth,pickable:!1});d.appendChild(c),d.name="task-bar-link-point-left",l.appendChild(d);const g=new Jt({x:i+(u-10),y:0,width:10,height:r,pickable:!0}),f=new ma({x:5,y:r/2,radius:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.radius,fill:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.fillColor,stroke:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeColor,lineWidth:this._scene._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeWidth,pickable:!1,pickStrokeBuffer:10});g.appendChild(f),g.name="task-bar-link-point-right",l.appendChild(g)}}removeSelectedBorder(){this.selectedBorders.forEach((t=>{t.delete()})),this.selectedBorders=[]}removeSecondSelectedBorder(){this.selectedBorders.length===2&&this.selectedBorders.pop().delete()}updateCreatingDependencyLine(t,e,i,r){this.creatingDependencyLine&&(this.creatingDependencyLine.delete(),this.creatingDependencyLine=void 0);const o=new Cx({points:[{x:t,y:e},{x:i,y:r}],stroke:this._scene._gantt.parsedOptions.dependencyLinkLineCreatingStyle.lineColor,lineWidth:this._scene._gantt.parsedOptions.dependencyLinkLineCreatingStyle.lineWidth,lineDash:this._scene._gantt.parsedOptions.dependencyLinkLineCreatingStyle.lineDash,pickable:!1});this.creatingDependencyLine=o,this.selectedBorders[0].appendChild(o)}getTaskBarNodeByIndex(t,e){let i=this.barContainer.firstChild;if(!i)return null;for(let r=0;r<this.barContainer.childrenCount;r++){if(i.task_index===t&&(!$(e)||$(e)&&i.sub_task_index===e))return i;i=i._next}return null}}class Pft{constructor(t){this.markLineContainerWidth=20,this._scene=t,this.height=Math.min(t._gantt.tableNoFrameHeight,t._gantt.drawHeight)-t._gantt.getAllHeaderRowsHeight(),this.group=new Jt({x:0,y:t._gantt.getAllHeaderRowsHeight(),width:t._gantt.tableNoFrameWidth,height:this.height,pickable:!1,clip:!0}),this.group.name="mark-line-container",t.ganttGroup.addChild(this.group),this.markLIneContainer=new Jt({x:0,y:0,width:this._scene._gantt.getAllDateColsWidth(),height:this.height,pickable:!1,clip:!0}),this.group.appendChild(this.markLIneContainer),this.initMarkLines()}initMarkLines(){const t=Math.min(this._scene._gantt.tableNoFrameHeight,this._scene._gantt.drawHeight)-this._scene._gantt.getAllHeaderRowsHeight();this.group.setAttributes({y:this._scene._gantt.getAllHeaderRowsHeight(),width:this._scene._gantt.tableNoFrameWidth,height:t}),this.markLIneContainer.setAttribute("width",this._scene._gantt.getAllDateColsWidth()),this.markLIneContainer.setAttribute("height",t);const e=this._scene._gantt.parsedOptions.markLine,i=this._scene._gantt.parsedOptions.minDate;i&&e.forEach((r=>{const o=r.style,s=r.contentStyle||{},a=this._scene._gantt.parsedOptions.timeScaleIncludeHour?Ye(r.date):Ye(r.date,!0),{unit:l,step:h}=this._scene._gantt.parsedOptions.reverseSortedTimelineScales[0],u=ce(a,i,l,h);let d=0;if(r.position==="right")d=1;else if(r.position==="middle")d=.5;else if(r.position==="date"){const p=Ye(r.date),m=ce(p,i,l,h);d=m-Math.floor(m)}const c=this._scene._gantt.parsedOptions.timelineColWidth*(Math.floor(u)+d),g=new Jt({pickable:!1,x:c-this.markLineContainerWidth/2,y:0,width:this.markLineContainerWidth,height:this.height});g.name="mark-line",this.markLIneContainer.appendChild(g);const f=Ke({pickable:!1,stroke:o.lineColor,lineWidth:o.lineWidth,lineDash:o.lineDash,points:[{x:this.markLineContainerWidth/2,y:0},{x:this.markLineContainerWidth/2,y:this.height}]});if(g.appendChild(f),r.content){const p=this._scene._gantt.parsedOptions.timelineColWidth,m=s.lineHeight||18,v=new Jt({x:this.markLineContainerWidth/2,y:0,cursor:"pointer",height:m,clip:!1,fill:s.backgroundColor||o.lineColor,display:"flex",cornerRadius:s.cornerRadius||[0,2,2,0]});v.name="mark-line-content",v.data=r,g.appendChild(v);const b=new Oe({maxLineWidth:p,text:r.content,cursor:"pointer",lineHeight:m,fontWeight:s.fontWeight||"normal",fill:s.color||o.lineColor,fontSize:s.fontSize||12,poptip:{position:"top",dx:p/4,dy:-m/4}});v.appendChild(b)}}))}refresh(){this.height=Math.min(this._scene._gantt.tableNoFrameHeight,this._scene._gantt.drawHeight)-this._scene._gantt.getAllHeaderRowsHeight(),this.markLIneContainer.removeAllChild(),this.group.setAttribute("height",this.height),this.markLIneContainer.setAttribute("height",this.height),this.initMarkLines()}setX(t){this.markLIneContainer.setAttribute("x",t)}}class Eft{constructor(t){this._scene=t,this.createFrameBorder()}createFrameBorder(){var t,e,i,r,o,s;const a=this._scene.ganttGroup,l=this._scene._gantt.parsedOptions.outerFrameStyle;if(!l)return;const{cornerRadius:h,borderColor:u,borderLineWidth:d,borderLineDash:c}=l,g={},f={pickable:!1},p=Ur(d??0),m=[p[0],p[1],p[2],this._scene._gantt.taskListTableInstance?0:p[3]];f.stroke=!0,f.fill=!1,f.stroke=u,f.lineWidth=Math.max(...m),f.strokeArrayWidth=m,c&&(f.lineDash=c),f.lineCap="butt";const v=!!this._scene._gantt.taskListTableInstance;f.x=v?0:m[3]/2,f.y=m[0]/2;const b=(e=(t=this._scene._gantt.parsedOptions.verticalSplitLine)===null||t===void 0?void 0:t.lineWidth)!==null&&e!==void 0?e:0;if(f.width=a.attribute.width+m[3]/2+m[1]/2+(v?b:0),f.height=a.attribute.height+m[0]/2+m[2]/2,h){const y=Array.isArray(h)?h:[h,h,h,h];this._scene._gantt.taskListTableInstance?(f.cornerRadius=[0,(i=y[1])!==null&&i!==void 0?i:0,(r=y[2])!==null&&r!==void 0?r:0,0],g.cornerRadius=[0,(o=y[1])!==null&&o!==void 0?o:0,(s=y[2])!==null&&s!==void 0?s:0,0]):(f.cornerRadius=y,g.cornerRadius=y)}if(a.setAttributes(g),f.stroke){const y=be(f);y.name="border-rect",a.parent.insertAfter(y,a),this.border=y,a.border=y}}refresh(){this.border&&this.border.parent&&this.border.parent.removeChild(this.border),this.createFrameBorder()}resize(){var t,e,i;const{borderLineWidth:r}=this._scene._gantt.parsedOptions.outerFrameStyle,o=Ur(r??0),s=[o[0],o[1],o[2],this._scene._gantt.taskListTableInstance?0:o[3]],a=(e=(t=this._scene._gantt.parsedOptions.verticalSplitLine)===null||t===void 0?void 0:t.lineWidth)!==null&&e!==void 0?e:0,l=!!this._scene._gantt.taskListTableInstance;(i=this.border)===null||i===void 0||i.setAttributes({x:l?0:s[3]/2,y:s[0]/2,width:this._scene.ganttGroup.attribute.width+s[3]/2+s[1]/2+(l?a:0),height:this._scene.ganttGroup.attribute.height+s[0]/2+s[2]/2}),this.border.strokeArrayWidth=s}}var Lft=function(n,t,e,i){var r,o=arguments.length,s=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(s=(o<3?r(s):o>3?r(t,e,s):r(t,e))||s);return o>3&&s&&Object.defineProperty(t,e,s),s};let Im=class{constructor(){this.time=ne.beforeFillStroke,this.useStyle=!0,this.order=0,this.supportedAppName="vtable"}drawShape(n,t,e,i,r,o,s,a,l,h,u,d,c){n.name==="date-header-cell"&&n.forEachChildren((g=>{var f;if(g.name==="date-header-cell-text"&&g.attribute.textStick===!0){const p=g;p.setAttribute("dx",0);const m=p.globalAABBBounds,v=p.stage.globalAABBBounds,b=p.parent.globalAABBBounds,y=v.intersect(b);v.intersect(b)&&(m.width()>=y.width()&&p.attribute.last_dx?p.setAttribute("dx",(f=p.attribute.last_dx)!==null&&f!==void 0?f:0):v.x1>=m.x1?(p.setAttribute("dx",v.x1-m.x1),p.setAttribute("last_dx",v.x1-m.x1)):v.x2<=m.x2&&(p.setAttribute("dx",v.x2-m.x2),p.setAttribute("last_dx",v.x1-m.x1)))}}))}};Im=Lft([pt()],Im);const Oft=new Ot(((n,t,e,i)=>{n(Im).toSelf().inSingletonScope(),n(mr).toService(Im)}));class Ift{constructor(t){this._scene=t,this.createAddButton()}createAddButton(){var t;this._scene._gantt.parsedOptions.taskBarCreationCustomLayout?this.group=new Jt({x:0,y:0,width:100,height:100}):(this.group=new Jt({x:0,y:0,width:100,height:100,lineDash:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineDash,cursor:"pointer",lineWidth:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineWidth,stroke:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineColor,cornerRadius:(t=this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.cornerRadius)!==null&&t!==void 0?t:0,fill:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.backgroundColor}),this.lineVertical=Ke({pickable:!1,stroke:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineColor,lineWidth:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineWidth,points:[{x:50,y:0},{x:50,y:100}]}),this.group.appendChild(this.lineVertical),this.lineHorizontal=Ke({pickable:!1,stroke:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineColor,lineWidth:this._scene._gantt.parsedOptions.taskBarCreationButtonStyle.lineWidth,points:[{x:0,y:50},{x:100,y:50}]}),this.group.appendChild(this.lineHorizontal)),this.group.name="task-creation-button",this._scene.taskBar.group.addChild(this.group)}show(t,e,i,r){if(this._scene._gantt.parsedOptions.taskBarCreationCustomLayout)this.group.appendChild(this._scene._gantt.parsedOptions.taskBarCreationCustomLayout({width:i,height:r,ganttInstance:this._scene._gantt}).rootContainer);else{const o=Math.min(i,r)/6;this.lineHorizontal.setAttribute("points",[{x:(i-4*o)/2,y:r/2},{x:(i-4*o)/2+4*o,y:r/2}]),this.lineVertical.setAttribute("points",[{x:i/2,y:(r-4*o)/2},{x:i/2,y:(r-4*o)/2+4*o}])}this.group.setAttribute("x",t),this.group.setAttribute("y",e),this.group.setAttribute("width",i),this.group.setAttribute("height",r),this.group.setAttribute("visibleAll",!0)}hide(){this.group.setAttribute("visibleAll",!1),this._scene._gantt.parsedOptions.taskBarCreationCustomLayout&&this.group.removeAllChild()}}class LP{constructor(t){this._scene=t,this.group=new Su({position:"top",content:"",contentStyle:{fill:"#fff"},visible:!1,panel:{background:"#14161c",cornerRadius:4}}),t.ganttGroup.addChild(this.group)}show(t){var e,i,r;const o=((e=this._scene._gantt.parsedOptions.markLineCreateOptions)===null||e===void 0?void 0:e.markLineCreationHoverToolTip)||{},s=t.globalTransMatrix,a=t.attribute.width,l=t.attribute.height;let h,u;const d=o.position||"top";d==="top"?(h=s.e+a/2-2,u=s.f):d==="bottom"&&(h=s.e+a/2-2,u=s.f+l);const c=((i=o.style)===null||i===void 0?void 0:i.contentStyle)||{fill:"#fff"},g=((r=o.style)===null||r===void 0?void 0:r.panelStyle)||{background:"#14161c",cornerRadius:4};this.group.setAttributes({content:o.tipContent,position:d,visibleAll:!0,visible:!0,contentStyle:c,panel:Object.assign(Object.assign({},g),{visible:!0}),x:h,y:u})}hide(){this.group.setAttributes({visibleAll:!1,visible:!1})}}class Hft{constructor(t){this._scene=t,this.width=t._gantt.tableNoFrameWidth,this.height=t._gantt.gridHeight,this.group=new Jt({x:0,y:t._gantt.getAllHeaderRowsHeight(),width:this.width,height:this.height,pickable:!1,clip:!0}),this.group.name="dependency-link-container",t.ganttGroup.addChild(this.group),this.initLinkLines()}initLinkLines(){var t;if(gD(this._scene._gantt.records),this.linkLinesContainer=new Jt({x:0,y:0,width:this._scene._gantt.getAllDateColsWidth(),height:this._scene._gantt.getAllTaskBarsHeight(),pickable:!1,clip:!0}),this.group.appendChild(this.linkLinesContainer),(t=this._scene._gantt.records)===null||t===void 0?void 0:t.length)for(let e=0;e<this._scene._gantt.parsedOptions.dependencyLinks.length;e++)this.initLinkLine(e)}initLinkLine(t){var e,i,r,o,s,a,l,h,u,d;const{taskKeyField:c,dependencyLinks:g}=this._scene._gantt.parsedOptions,f=g[t],{linkedToTaskKey:p,linkedFromTaskKey:m,type:v}=f,b=Po(this._scene._gantt.records,c,p),y=Po(this._scene._gantt.records,c,m);if(!b||!y)return;let C,w,_,A,x,S,T,M;if(b.record.vtable_gantt_linkedTo||(b.record.vtable_gantt_linkedTo=[]),b.record.vtable_gantt_linkedTo.push(f),y.record.vtable_gantt_linkedFrom||(y.record.vtable_gantt_linkedFrom=[]),y.record.vtable_gantt_linkedFrom.push(f),this._scene._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Inline)M=y.index[0],T=b.index[0],{startDate:C,endDate:w,taskDays:_}=this._scene._gantt.getTaskInfoByTaskListIndex(b.index[0],b.index[1]),{startDate:A,endDate:x,taskDays:S}=this._scene._gantt.getTaskInfoByTaskListIndex(y.index[0],y.index[1]);else if(this._scene._gantt.parsedOptions.tasksShowMode===ft.Project_Sub_Tasks_Inline){const L=this._scene._gantt.getTaskShowIndexByRecordIndex(y.index.slice(0,-1)),O=this._scene._gantt.getTaskShowIndexByRecordIndex(b.index.slice(0,-1)),I=this._scene._gantt.getRecordByIndex(L),H=this._scene._gantt.getRecordByIndex(O);M=I.type===se.PROJECT&&I.hierarchyState!=="expand"&&this._scene._gantt.parsedOptions.projectSubTasksExpandable!==!1?L:this._scene._gantt.getTaskShowIndexByRecordIndex(y.index),T=H.type===se.PROJECT&&H.hierarchyState!=="expand"&&this._scene._gantt.parsedOptions.projectSubTasksExpandable!==!1?O:this._scene._gantt.getTaskShowIndexByRecordIndex(b.index),{startDate:C,endDate:w,taskDays:_}=this._scene._gantt.getTaskInfoByTaskListIndex(T,b.index),{startDate:A,endDate:x,taskDays:S}=this._scene._gantt.getTaskInfoByTaskListIndex(M,y.index)}else this._scene._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Separate||this._scene._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||this._scene._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact?(M=this._scene._gantt.getRowsHeightByIndex(0,y.index[0]-1)/this._scene._gantt.parsedOptions.rowHeight+(this._scene._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||this._scene._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact?y.record.vtable_gantt_showIndex:(e=y.index[1])!==null&&e!==void 0?e:0),T=this._scene._gantt.getRowsHeightByIndex(0,b.index[0]-1)/this._scene._gantt.parsedOptions.rowHeight+(this._scene._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||this._scene._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact?b.record.vtable_gantt_showIndex:(i=b.index[1])!==null&&i!==void 0?i:0),{startDate:C,endDate:w,taskDays:_}=this._scene._gantt.getTaskInfoByTaskListIndex(b.index[0],b.index[1]),{startDate:A,endDate:x,taskDays:S}=this._scene._gantt.getTaskInfoByTaskListIndex(y.index[0],y.index[1])):(M=this._scene._gantt.getTaskShowIndexByRecordIndex(y.index),T=this._scene._gantt.getTaskShowIndexByRecordIndex(b.index),{startDate:C,endDate:w,taskDays:_}=this._scene._gantt.getTaskInfoByTaskListIndex(T),{startDate:A,endDate:x,taskDays:S}=this._scene._gantt.getTaskInfoByTaskListIndex(M));if(!S||!_)return;Ye(this._scene._gantt.parsedOptions.minDate);const{arrowPoints:R,linePoints:E}=Dft(v,A,x,M,S,y.record.type===se.MILESTONE,C,w,T,_,b.record.type===se.MILESTONE,this._scene._gantt),P=this._scene._gantt.parsedOptions.dependencyLinkLineStyle,B=Ke({pickable:!0,stroke:(o=(r=f.linkLineStyle)===null||r===void 0?void 0:r.lineColor)!==null&&o!==void 0?o:P.lineColor,lineWidth:(a=(s=f.linkLineStyle)===null||s===void 0?void 0:s.lineWidth)!==null&&a!==void 0?a:P.lineWidth,lineDash:(h=(l=f.linkLineStyle)===null||l===void 0?void 0:l.lineDash)!==null&&h!==void 0?h:P.lineDash,points:E,pickStrokeBuffer:3,vtable_link:f});this.linkLinesContainer.appendChild(B),f.vtable_gantt_linkLineNode=B;const k=new Dl({fill:(d=(u=f.linkLineStyle)===null||u===void 0?void 0:u.lineColor)!==null&&d!==void 0?d:P.lineColor,points:R});this.linkLinesContainer.appendChild(k),f.vtable_gantt_linkArrowNode=k}setX(t){this.linkLinesContainer.setAttribute("x",t)}setY(t){this.linkLinesContainer.setAttribute("y",t)}refresh(){this.width=this._scene._gantt.tableNoFrameWidth,this.height=this._scene._gantt.gridHeight,this.group.setAttributes({height:this.height,width:this.width,y:this._scene._gantt.getAllHeaderRowsHeight()});const t=this.linkLinesContainer.attribute.x,e=this.linkLinesContainer.attribute.y;this.linkLinesContainer.removeAllChild(),this.group.removeChild(this.linkLinesContainer),this.initLinkLines(),this.setX(t),this.setY(e)}resize(){this.width=this._scene._gantt.tableNoFrameWidth,this.height=this._scene._gantt.gridHeight,this.group.setAttribute("width",this.width),this.group.setAttribute("height",this.height)}createSelectedLinkLine(t){const e=t.vtable_gantt_linkLineNode,i=t.vtable_gantt_linkArrowNode,r=e.clone(),o=i.clone();r.setAttribute("stroke",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.lineColor),r.setAttribute("lineWidth",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.lineWidth),r.setAttribute("shadowColor",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.shadowColor),r.setAttribute("shadowOffsetX",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.shadowOffset),r.setAttribute("shadowOffsetY",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.shadowOffset),r.setAttribute("shadowBlur",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.shadowBlur),this.linkLinesContainer.appendChild(r),o.setAttribute("fill",this._scene._gantt.parsedOptions.dependencyLinkSelectedLineStyle.lineColor),this.linkLinesContainer.appendChild(o),this.selectedEffectNodes=[r,o]}removeSelectedLinkLine(){var t;(t=this.selectedEffectNodes)===null||t===void 0||t.forEach((e=>{e.delete()})),this.selectedEffectNodes=[]}deleteLink(t){const e=t.vtable_gantt_linkLineNode,i=t.vtable_gantt_linkArrowNode;e.delete(),i.delete()}}function Dft(n,t,e,i,r,o,s,a,l,h,u,d){const{unit:c,step:g}=d.parsedOptions.reverseSortedTimelineScales[0],{minDate:f,rowHeight:p,timelineColWidth:m}=d.parsedOptions,v=d.parsedOptions.taskBarMilestoneHypotenuse;let b=[],y=[];if(n===Fn.FinishToStart){let C=ce(e,f,c,g,1)*m;o&&(C=ce(t,f,c,g,1)*m+v/2);let w=ce(s,f,c,g)*m;u&&(w-=v/2),b=[{x:C,y:p*(i+.5)},{x:C+20,y:p*(i+.5)},{x:C+20,y:p*(i+(i>l?0:1))},{x:w-20,y:p*(i+(i>l?0:1))},{x:w-20,y:p*(l+.5)},{x:w,y:p*(l+.5)}],C+20<=w-20&&b.splice(2,3,{x:C+20,y:p*(l+.5)});const _=b[b.length-1];y=[{x:_.x,y:_.y},{x:_.x-10,y:_.y-5},{x:_.x-10,y:_.y+5},{x:_.x,y:_.y}]}else if(n===Fn.StartToFinish){let C=ce(t,f,c,g)*m;o&&(C-=v/2);let w=ce(a,f,c,g,1)*m;u&&(w=ce(s,f,c,g,1)*m+v/2),b=[{x:C,y:p*(i+.5)},{x:C-20,y:p*(i+.5)},{x:C-20,y:p*(i+(i>l?0:1))},{x:w+20,y:p*(i+(i>l?0:1))},{x:w+20,y:p*(l+.5)},{x:w,y:p*(l+.5)}],C-20>=w+20&&b.splice(2,3,{x:C-20,y:p*(l+.5)});const _=b[b.length-1];y=[{x:_.x,y:_.y},{x:_.x+10,y:_.y-5},{x:_.x+10,y:_.y+5},{x:_.x,y:_.y}]}else if(n===Fn.StartToStart){let C=ce(t,f,c,g)*m;o&&(C-=v/2);let w=ce(s,f,c,g)*m;u&&(w-=v/2),b=[{x:C,y:p*(i+.5)},{x:(i===l?C:Math.min(C,w))-20,y:p*(i+.5)},{x:(i===l?C:Math.min(C,w))-20,y:p*(l+(i===l?1:.5))},{x:w-20,y:p*(l+(i===l?1:.5))},{x:(i===l?w:Math.min(C,w))-20,y:p*(l+.5)},{x:w,y:p*(l+.5)}];const _=b[b.length-1];y=[{x:_.x,y:_.y},{x:_.x-10,y:_.y-5},{x:_.x-10,y:_.y+5},{x:_.x,y:_.y}]}else if(n===Fn.FinishToFinish){let C=ce(e,f,c,g,1)*m;o&&(C=ce(t,f,c,g,1)*m+v/2);let w=ce(a,f,c,g,1)*m;u&&(w=ce(s,f,c,g,1)*m+v/2),b=[{x:C,y:p*(i+.5)},{x:(i===l?C:Math.max(C,w))+20,y:p*(i+.5)},{x:(i===l?C:Math.max(C,w))+20,y:p*(l+(i===l?1:.5))},{x:w+20,y:p*(l+(i===l?1:.5))},{x:w+20,y:p*(l+.5)},{x:w,y:p*(l+.5)}];const _=b[b.length-1];y=[{x:_.x,y:_.y},{x:_.x+10,y:_.y-5},{x:_.x+10,y:_.y+5},{x:_.x,y:_.y}]}return{linePoints:b,arrowPoints:y}}function OP(n,t,e,i,r,o,s,a,l,h,u,d,c,g,f,p){const{unit:m,step:v}=p.parsedOptions.reverseSortedTimelineScales[0],{minDate:b,rowHeight:y,timelineColWidth:C}=p.parsedOptions,w=p.parsedOptions.taskBarMilestoneHypotenuse,_=p.parsedOptions.taskBarMilestoneStyle.width;let A=[],x=[];if(n===Fn.FinishToStart){let S=s?s.attribute.x+s.attribute.width:ce(e,b,m,v,1)*C;o&&(S=s?s.attribute.x+s.attribute.width+(w-_)/2:ce(t,b,m,v,1)*C+w/2);let T=g?g.attribute.x:ce(l,b,m,v)*C;c&&(T-=(w-_)/2),A=[{x:S,y:y*(i+.5)+a},{x:S+20,y:y*(i+.5)+a},{x:S+20,y:y*(i+(i>u?0:1))+a},{x:T-20,y:y*(i+(i>u?0:1))+a},{x:T-20,y:y*(u+.5)+f},{x:T,y:y*(u+.5)+f}],S+20<=T-20&&A.splice(2,3,{x:S+20,y:y*(u+.5)+f});const M=A[A.length-1];x=[{x:M.x,y:M.y},{x:M.x-10,y:M.y-5},{x:M.x-10,y:M.y+5},{x:M.x,y:M.y}]}else if(n===Fn.StartToFinish){let S=s?s.attribute.x:ce(t,b,m,v)*C;o&&(S-=(w-_)/2);let T=g?g.attribute.x+g.attribute.width:ce(h,b,m,v,1)*C;c&&(T=g?g.attribute.x+g.attribute.width+(w-_)/2:ce(l,b,m,v,1)*C+w/2),A=[{x:S,y:y*(i+.5)+a},{x:S-20,y:y*(i+.5)+a},{x:S-20,y:y*(i+(i>u?0:1))+a},{x:T+20,y:y*(i+(i>u?0:1))+a},{x:T+20,y:y*(u+.5)+f},{x:T,y:y*(u+.5)+f}],S-20>=T+20&&A.splice(2,3,{x:S-20,y:y*(u+.5)+f});const M=A[A.length-1];x=[{x:M.x,y:M.y},{x:M.x+10,y:M.y-5},{x:M.x+10,y:M.y+5},{x:M.x,y:M.y}]}else if(n===Fn.StartToStart){let S=s?s.attribute.x:ce(t,b,m,v)*C;o&&(S-=(w-_)/2);let T=g?g.attribute.x:ce(l,b,m,v)*C;c&&(T-=(w-_)/2),A=[{x:S,y:y*(i+.5)+a},{x:(i===u?S:Math.min(S,T))-20,y:y*(i+.5)+a},{x:(i===u?S:Math.min(S,T))-20,y:y*(u+(i===u?1:.5))+f},{x:T-20,y:y*(u+(i===u?1:.5))+f},{x:(i===u?T:Math.min(S,T))-20,y:y*(u+.5)+f},{x:T,y:y*(u+.5)+f}];const M=A[A.length-1];x=[{x:M.x,y:M.y},{x:M.x-10,y:M.y-5},{x:M.x-10,y:M.y+5},{x:M.x,y:M.y}]}else if(n===Fn.FinishToFinish){let S=s?s.attribute.x+s.attribute.width:ce(e,b,m,v,1)*C;o&&(S=s?s.attribute.x+s.attribute.width+(w-_)/2:ce(t,b,m,v,1)*C+w/2);let T=g?g.attribute.x+g.attribute.width:ce(h,b,m,v,1)*C;c&&(T=g?g.attribute.x+g.attribute.width+(w-_)/2:ce(l,b,m,v,1)*C+w/2),A=[{x:S,y:y*(i+.5)+a},{x:(i===u?S:Math.max(S,T))+20,y:y*(i+.5)+a},{x:(i===u?S:Math.max(S,T))+20,y:y*(u+(i===u?1:.5))+f},{x:T+20,y:y*(u+(i===u?1:.5))+f},{x:T+20,y:y*(u+.5)+f},{x:T,y:y*(u+.5)+f}];const M=A[A.length-1];x=[{x:M.x,y:M.y},{x:M.x+10,y:M.y-5},{x:M.x+10,y:M.y+5},{x:M.x,y:M.y}]}return{linePoints:A,arrowPoints:x}}class Fft{constructor(t){this._scene=t,this.dragLineContainer=new Jt({x:0,y:0,width:t._gantt.tableNoFrameWidth,height:Math.min(t._gantt.tableNoFrameHeight,t._gantt.drawHeight),pickable:!1,clip:!0,visible:!1}),this.dragLineContainer.name="drag-order-line-container",t.ganttGroup.addChild(this.dragLineContainer),this.initDragLine()}initDragLine(){if(this._scene._gantt.taskListTableInstance){const t=this._scene._gantt.taskListTableInstance.theme.dragHeaderSplitLine,e=Ke({pickable:!1,stroke:t.lineColor,lineWidth:t.lineWidth,points:[]});this.dragLine=e,this.dragLineContainer.appendChild(e)}}showDragLine(t){this.dragLineContainer.showAll(),this.dragLine.setAttribute("points",[{x:0,y:t},{x:this._scene._gantt.tableNoFrameWidth,y:t}])}hideDragLine(){this.dragLineContainer.hideAll()}}Et.load(Oft);class zft{constructor(t){let e,i;this._gantt=t,this.tableGroupWidth=t.tableNoFrameWidth,this.tableGroupHeight=Math.min(t.tableNoFrameHeight,t.drawHeight),Sr.mode==="node"||(Bt.setEnv("browser"),e=t.canvas.width,i=t.canvas.height),this.stage=XI({canvas:t.canvas,width:e,height:i,disableDirtyBounds:!1,background:t.parsedOptions.underlayBackgroundColor,enableLayout:!0,autoRender:!1,context:{appName:"vtable"},pluginList:["poptipForText"]}),this.stage.gantt=this._gantt,this.stage.table=this._gantt,this.stage.defaultLayer.setTheme({group:{boundsPadding:0,strokeBoundsBuffer:0,lineJoin:"round"},text:{ignoreBuf:!0}}),this.initSceneGraph()}initSceneGraph(){this.ganttGroup=new Jt({x:this._gantt.tableX,y:this._gantt.tableY,width:this.tableGroupWidth,height:this.tableGroupHeight,clip:!0,pickable:!1}),this.stage.defaultLayer.add(this.ganttGroup),this.ganttGroup.name="table",this.timelineHeader=new ort(this),this.grid=new bnt(this),this.dependencyLink=new Hft(this),this.taskBar=new kft(this),this.markLine=new Pft(this),this.toolTip=new LP(this),this.frameBorder=new Eft(this),this.scrollbarComponent=new Int(this._gantt),this.stage.defaultLayer.addChild(this.scrollbarComponent.hScrollBar),this.stage.defaultLayer.addChild(this.scrollbarComponent.vScrollBar),this.dragOrderLine=new Fft(this)}updateSceneGraph(){const t=this._gantt;let e,i;this.tableGroupWidth=t.tableNoFrameWidth,this.tableGroupHeight=Math.min(t.tableNoFrameHeight,t.drawHeight),Sr.mode==="node"||(Bt.setEnv("browser"),e=t.canvas.width,i=t.canvas.height),this.stage.resize(e,i),this.refreshAll()}afterCreateSceneGraph(){this.scrollbarComponent.updateScrollBar(),Wnt(this._gantt.eventManager)}refreshAll(){this.tableGroupHeight=Math.min(this._gantt.tableNoFrameHeight,this._gantt.drawHeight),this.tableGroupWidth=this._gantt.tableNoFrameWidth,this.ganttGroup.setAttribute("height",this.tableGroupHeight),this.ganttGroup.setAttribute("width",this.tableGroupWidth),this.timelineHeader.refresh(),this.grid.refresh(),this.taskBar.refresh(),this.dependencyLink.refresh(),this.markLine.refresh(),this.dependencyLink.refresh(),this.frameBorder.refresh(),this.scrollbarComponent.updateScrollBar(),this.updateNextFrame()}refreshTaskBars(){this.dependencyLink.refresh(),this.taskBar.refresh(),this.updateNextFrame()}refreshTaskBarsAndGrid(){this._gantt.verticalSplitResizeLine.style.height=this._gantt.drawHeight+"px",this.tableGroupHeight=Math.min(this._gantt.tableNoFrameHeight,this._gantt.drawHeight),this.ganttGroup.setAttribute("height",this.tableGroupHeight),this.grid.refresh(),this.taskBar.refresh(),this.dependencyLink.refresh(),this.markLine.refresh(),this.frameBorder.resize(),this.scrollbarComponent.updateScrollBar(),this.updateNextFrame()}updateTableSize(){this.tableGroupHeight=Math.min(this._gantt.tableNoFrameHeight,this._gantt.drawHeight),this.tableGroupWidth=this._gantt.tableNoFrameWidth,this.ganttGroup.setAttributes({x:this._gantt.tableX,y:this._gantt.tableY,width:this._gantt.tableNoFrameWidth,height:this.tableGroupHeight}),this.grid.resize(),this.taskBar.resize(),this.dependencyLink.resize(),this.markLine.refresh(),this.frameBorder.resize()}updateStageBackground(){this.stage.background=this._gantt.parsedOptions.underlayBackgroundColor,this.updateNextFrame()}renderSceneGraph(){this.stage.render()}updateNextFrame(){this.stage.renderNextFrame()}get width(){var t,e;return(e=(t=this.ganttGroup.attribute)===null||t===void 0?void 0:t.width)!==null&&e!==void 0?e:0}get height(){var t,e;return(e=(t=this.ganttGroup.attribute)===null||t===void 0?void 0:t.height)!==null&&e!==void 0?e:0}get x(){var t,e;return(e=(t=this.ganttGroup.attribute)===null||t===void 0?void 0:t.x)!==null&&e!==void 0?e:0}get y(){var t,e;return(e=(t=this.ganttGroup.attribute)===null||t===void 0?void 0:t.y)!==null&&e!==void 0?e:0}setX(t,e=!1){this.timelineHeader.setX(t),this.grid.setX(t),this.taskBar.setX(t),this.dependencyLink.setX(t),this.markLine.setX(t),this.updateNextFrame()}setY(t,e=!1){this.grid.setY(t),this.taskBar.setY(t),this.dependencyLink.setY(t),this.updateNextFrame()}setPixelRatio(t){this.stage.disableDirtyBounds(),this.stage.window.setDpr(t),this.stage.render(),this.stage.enableDirtyBounds()}resize(){this.updateTableSize(),this.scrollbarComponent.updateScrollBar(),this.updateNextFrame()}release(){this.stage.release()}showTaskCreationButton(t,e,i){this.taskCreationButton||(this.taskCreationButton=new Ift(this._gantt.scenegraph));const r=this._gantt.parsedOptions.taskBarCreationMaxWidth,o=this._gantt.parsedOptions.taskBarCreationMinWidth,s=this._gantt.getDateColWidth(i),a=r?Math.min(r,o?Math.max(o,s):s):o?Math.max(o,s):s,l=t-(a-s)/2;this.taskCreationButton.show(l,e,a,this._gantt.parsedOptions.rowHeight),this.updateNextFrame()}hideTaskCreationButton(){this.taskCreationButton&&(this.taskCreationButton.hide(),this.updateNextFrame())}showToolTip(t){this.toolTip||(this.toolTip=new LP(this._gantt.scenegraph)),this.toolTip.show(t)}hideToolTip(){this.toolTip.hide()}refreshRecordLinkNodes(t,e,i,r=0){const o=this._gantt,s=o.getRecordByIndex(t,e),a=s.vtable_gantt_linkedTo,l=s.vtable_gantt_linkedFrom;for(let h=0;h<a?.length;h++){const u=a[h],d=u.vtable_gantt_linkLineNode,c=u.vtable_gantt_linkArrowNode,{linkedToTaskKey:g,linkedFromTaskKey:f,type:p}=u,{taskKeyField:m,minDate:v}=o.parsedOptions,b=Po(o.records,m,f),y=Po(o.records,m,g);let C,w,_,A,x,S,T,M,R;const E=this._gantt.getTaskBarStyle(t,e);if(o.parsedOptions.tasksShowMode===ft.Sub_Tasks_Inline){const k=nr(i.attribute.y+r,o);M=b.index[0],T=o.getRowsHeightByIndex(0,k.task_index-1)/o.parsedOptions.rowHeight,{startDate:C,endDate:w,taskDays:_}=o.getTaskInfoByTaskListIndex(y.index[0],y.index[1]),{startDate:A,endDate:x,taskDays:S}=o.getTaskInfoByTaskListIndex(b.index[0],b.index[1]);const L=E.width;R=i.attribute.y+L/2-(T+.5)*o.parsedOptions.rowHeight}else if(o.parsedOptions.tasksShowMode===ft.Project_Sub_Tasks_Inline){const k=o.getTaskShowIndexByRecordIndex(b.index.slice(0,-1)),L=o.getTaskShowIndexByRecordIndex(y.index.slice(0,-1)),O=o.getRecordByIndex(k),I=o.getRecordByIndex(L);M=O.type===se.PROJECT&&O.hierarchyState!=="expand"&&o.parsedOptions.projectSubTasksExpandable!==!1?k:o.getTaskShowIndexByRecordIndex(b.index),T=I.type===se.PROJECT&&I.hierarchyState!=="expand"&&o.parsedOptions.projectSubTasksExpandable!==!1?L:o.getTaskShowIndexByRecordIndex(y.index),{startDate:C,endDate:w,taskDays:_}=o.getTaskInfoByTaskListIndex(T,y.index),{startDate:A,endDate:x,taskDays:S}=o.getTaskInfoByTaskListIndex(M,b.index)}else if(o.parsedOptions.tasksShowMode===ft.Sub_Tasks_Separate||o.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||o.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact){const k=nr(i.attribute.y+r,o);M=o.getRowsHeightByIndex(0,b.index[0]-1)/o.parsedOptions.rowHeight+(o.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||o.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact?b.record.vtable_gantt_showIndex:b.index[1]),T=o.getRowsHeightByIndex(0,k.task_index-1)/o.parsedOptions.rowHeight+(o.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||o.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact?y.record.vtable_gantt_showIndex:k.sub_task_index),{startDate:C,endDate:w,taskDays:_}=o.getTaskInfoByTaskListIndex(y.index[0],y.index[1]),{startDate:A,endDate:x,taskDays:S}=o.getTaskInfoByTaskListIndex(b.index[0],b.index[1]);const L=E.width;R=i.attribute.y+L/2-(T+.5)*o.parsedOptions.rowHeight}else{if(M=o.getTaskShowIndexByRecordIndex(b.index),T=o.getTaskShowIndexByRecordIndex(y.index),M===-1||T===-1)continue;({startDate:C,endDate:w,taskDays:_}=o.getTaskInfoByTaskListIndex(T)),{startDate:A,endDate:x,taskDays:S}=o.getTaskInfoByTaskListIndex(M)}if(!(A&&x&&C&&w&&d&&c))return;const{linePoints:P,arrowPoints:B}=OP(p,A,x,M,S,b.record.type===se.MILESTONE,null,0,C,w,T,_,y.record.type===se.MILESTONE,i,R??0,this._gantt);d.setAttribute("points",P),c.setAttribute("points",B)}for(let h=0;h<l?.length;h++){const u=l[h],d=u.vtable_gantt_linkLineNode,c=u.vtable_gantt_linkArrowNode,{linkedToTaskKey:g,linkedFromTaskKey:f,type:p}=u,{taskKeyField:m,minDate:v}=o.parsedOptions,b=Po(o.records,m,g),y=Po(o.records,m,f);let C,w,_,A,x,S,T,M,R;const E=this._gantt.getTaskBarStyle(t,e);if(o.parsedOptions.tasksShowMode===ft.Sub_Tasks_Inline){const k=nr(i.attribute.y+r,o);M=o.getRowsHeightByIndex(0,k.task_index-1)/o.parsedOptions.rowHeight,T=b.index[0],{startDate:C,endDate:w,taskDays:_}=o.getTaskInfoByTaskListIndex(b.index[0],b.index[1]),{startDate:A,endDate:x,taskDays:S}=o.getTaskInfoByTaskListIndex(y.index[0],y.index[1]);const L=E.width;R=i.attribute.y+L/2-(M+.5)*o.parsedOptions.rowHeight}else if(o.parsedOptions.tasksShowMode===ft.Project_Sub_Tasks_Inline){const k=o.getTaskShowIndexByRecordIndex(y.index.slice(0,-1)),L=o.getTaskShowIndexByRecordIndex(b.index.slice(0,-1)),O=o.getRecordByIndex(k),I=o.getRecordByIndex(L);M=O.type===se.PROJECT&&O.hierarchyState!=="expand"&&o.parsedOptions.projectSubTasksExpandable!==!1?k:o.getTaskShowIndexByRecordIndex(y.index),T=I.type===se.PROJECT&&I.hierarchyState!=="expand"&&o.parsedOptions.projectSubTasksExpandable!==!1?L:o.getTaskShowIndexByRecordIndex(b.index),{startDate:C,endDate:w,taskDays:_}=o.getTaskInfoByTaskListIndex(T,b.index),{startDate:A,endDate:x,taskDays:S}=o.getTaskInfoByTaskListIndex(M,y.index)}else if(o.parsedOptions.tasksShowMode===ft.Sub_Tasks_Separate||o.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||o.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact){const k=nr(i.attribute.y+r,o);M=o.getRowsHeightByIndex(0,k.task_index-1)/o.parsedOptions.rowHeight+(o.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||o.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact?y.record.vtable_gantt_showIndex:k.sub_task_index),T=o.getRowsHeightByIndex(0,b.index[0]-1)/o.parsedOptions.rowHeight+(o.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||o.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact?b.record.vtable_gantt_showIndex:b.index[1]),{startDate:C,endDate:w,taskDays:_}=o.getTaskInfoByTaskListIndex(b.index[0],b.index[1]),{startDate:A,endDate:x,taskDays:S}=o.getTaskInfoByTaskListIndex(y.index[0],y.index[1]);const L=E.width;R=i.attribute.y+L/2-(M+.5)*o.parsedOptions.rowHeight}else{if(M=o.getTaskShowIndexByRecordIndex(y.index),T=o.getTaskShowIndexByRecordIndex(b.index),M===-1||T===-1)continue;({startDate:C,endDate:w,taskDays:_}=o.getTaskInfoByTaskListIndex(T)),{startDate:A,endDate:x,taskDays:S}=o.getTaskInfoByTaskListIndex(M)}if(!(A&&x&&C&&w&&d&&c))return;const{linePoints:P,arrowPoints:B}=OP(p,A,x,M,S,y.record.type===se.MILESTONE,i,R??0,C,w,T,_,b.record.type===se.MILESTONE,null,0,this._gantt);d.setAttribute("points",P),c.setAttribute("points",B)}}}const Nft=n=>{switch(Object.prototype.toString.call(n)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}},Wft=(n,t)=>Nft(n)===t,jft=n=>Wft(n,"object");function sz(n,t,e){let i,r,o,s,a,l,h=0,u=!1,d=!1,c=!0;const g=!t&&t!==0&&typeof requestAnimationFrame=="function";if(typeof n!="function")throw new TypeError("Expected a function");function f(b){const y=i,C=r;return r=void 0,i=void 0,h=b,s=n.apply(C,y),s}function p(b,y){return g?requestAnimationFrame(b):setTimeout(b,y)}function m(b){const y=b-l;return l===void 0||y>=t||y<0||u&&b-h>=o}function v(){const b=Date.now();if(m(b))return(function(y){return a=void 0,c&&i?f(y):(r=void 0,i=void 0,s)})(b);a=p(v,(function(y){const C=y-h,w=t&&-(y-l);return u?Math.min(w,o-C):w})(b))}return t=+t||0,jft(e)&&(d=!!e.leading,u="maxWait"in e,u&&(o=Math.max(+e.maxWait||0,t)),c="trailing"in e?!!e.trailing:c),function(...b){const y=Date.now(),C=m(y);if(i=b,r=this,l=y,C){if(a===void 0)return(function(w){return h=w,a=p(v,t),d?f(w):s})(l);if(u)return a=p(v,t),f(l)}return a===void 0&&(a=p(v,t)),s}}let Vft=1,Gft=class{constructor(t,e,i){var r;if(this.resizeTime=100,this.lastSize={width:0,height:0},this.mutationResize=()=>{this.onResize()},this.callBack=()=>{const o=this.getSize();let s=!1;o.width===this.lastSize.width&&o.height===this.lastSize.height&&(s=!0),this.lastSize=o,this.cb&&this.cb(Object.assign(Object.assign({},this.lastSize),{windowSizeNotChange:s}))},this.onResize=()=>{this.callBackDebounce()},this.element=t,this.cb=e,this.lastSize=this.getSize(),i&&(this.resizeTime=Math.max(i,16)),this.callBackDebounce=sz(this.callBack,this.resizeTime),window?.addEventListener("resize",this.onResize),"ResizeObserver"in window){const o=window.ResizeObserver;this.observer=new o(this.mutationResize),(r=this.observer)===null||r===void 0||r.observe(this.element)}else"MutationObserver"in window&&(this.observer=new MutationObserver(this.mutationResize),this.observer.observe(this.element,{attributes:!0,attributeFilter:["style"]}))}disConnect(){window.removeEventListener("resize",this.onResize),this.observer&&(this.observer.disconnect(),this.observer=void 0)}setSize(t){this.lastSize=t}checkSize(){const t=this.getSize();return t.width!==this.lastSize.width||t.height!==this.lastSize.height}getSize(){return this.element?{width:Math.floor(this.element.clientWidth),height:Math.floor(this.element.clientHeight)}:Object.assign({},this.lastSize)}};class $ft{constructor(){this.listeners={},this.reseizeListeners={}}on(t,e,i,...r){if(Sr.mode==="node")return-1;const o=Vft++;if(t?.addEventListener)if(e!=="resize"||t===window)t?.addEventListener(e,i,...r);else{const a=new Gft(t,i,this.resizeTime);this.reseizeListeners[o]=a}const s={target:t,type:e,listener:i,options:r};return this.listeners[o]=s,o}once(t,e,i,...r){if(Sr.mode==="node")return-1;const o=this.on(t,e,((...s)=>{this.off(o),i(...s)}),...r);return o}off(t){var e;if(Sr.mode==="node"||t==null)return;const i=(e=this.listeners)===null||e===void 0?void 0:e[t];i&&(delete this.listeners[t],i.target.removeEventListener&&i.target.removeEventListener(i.type,i.listener,...i.options))}fire(t,e,...i){if(Sr.mode!=="node")for(const r in this.listeners){const o=this.listeners[r];o.target===t&&o.type===e&&o.listener.call(o.target,...i)}}hasListener(t,e){if(Sr.mode==="node")return!1;let i=!1;for(const r in this.listeners){const o=this.listeners[r];o.target===t&&o.type===e&&(i=!0)}return i}clear(){if(Sr.mode!=="node"){for(const t in this.listeners){const e=this.listeners[t];e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options)}for(const t in this.reseizeListeners){const e=this.reseizeListeners[t];e?.disConnect()}this.listeners={}}}release(){Sr.mode!=="node"&&(this.clear(),this.listeners={})}}let dh=1;function az(){return Vnt?dh=1:(dh=Math.ceil(window.devicePixelRatio||1),dh>1&&dh%2!=0&&(dh+=1)),dh}az();function Uft(n){const t=n._gantt,e=t.stateManager,i=t.scenegraph;if(Bt.envContribution.supportsTouchEvents===!1)return;Bt.addEventListener("contextmenu",(a=>{a.stopPropagation(),a.preventDefault()}),{capture:!0}),n.touchMovePoints=[],t.scenegraph.ganttGroup.addEventListener("touchstart",(a=>{a.target.isChildOf(i.scrollbarComponent.vScrollBar)||a.target.isChildOf(i.scrollbarComponent.hScrollBar)||(n.isTouchdown=!0,n.touchMovePoints.push({x:a.page.x,y:a.page.y,timestamp:Date.now()}))}));const r=a=>{if(n.isLongTouch&&a.preventDefault(),n.isTouchdown&&IP(a)&&(n.isTouchMove=!0,n.touchMovePoints.length>4&&n.touchMovePoints.shift(),n.touchMovePoints.push({x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY,timestamp:Date.now()}),n._enableTableScroll)){const l=-n.touchMovePoints[n.touchMovePoints.length-1].x+n.touchMovePoints[n.touchMovePoints.length-2].x,h=-n.touchMovePoints[n.touchMovePoints.length-1].y+n.touchMovePoints[n.touchMovePoints.length-2].y;jw(a,e,t),a.cancelable&&(t.parsedOptions.overscrollBehavior==="none"||Math.abs(h)>=Math.abs(l)&&h!==0&&dD(h,e)||Math.abs(h)<=Math.abs(l)&&l!==0&&cD(l,e))&&a.preventDefault()}};Bt.addEventListener("touchmove",r,{passive:!1}),n.globalEventListeners.push({name:"touchmove",env:"vglobal",callback:r});const o=a=>{var l,h;if(n.touchEnd=!0,n.isLongTouch=!1,n.isTouchdown&&IP(a)){if(!((l=n.touchMovePoints)===null||l===void 0)&&l.length&&(n.touchMovePoints.length>4&&n.touchMovePoints.shift(),n.touchMovePoints.push({x:a.changedTouches[0].pageX,y:a.changedTouches[0].pageY,timestamp:Date.now()}),n._enableTableScroll)){const u=n.touchMovePoints[0],d=n.touchMovePoints[((h=n.touchMovePoints)===null||h===void 0?void 0:h.length)-1],c=(d.x-u.x)/(d.timestamp-u.timestamp),g=(d.y-u.y)/(d.timestamp-u.timestamp);n.inertiaScroll.startInertia(c,g,.95),t.eventManager.inertiaScroll.setScrollHandle(((f,p)=>{jw({deltaX:-f,deltaY:-p},t.stateManager,t)}))}n.isTouchdown=!1,n.isTouchMove=!1,n.isDraging=!1,n.touchMovePoints=[]}};Bt.addEventListener("touchend",o),n.globalEventListeners.push({name:"touchend",env:"vglobal",callback:o});const s=a=>{n.touchEnd=!0,n.isLongTouch=!1,n.isTouchdown&&(n.isTouchdown=!1,n.isTouchMove=!1,n.touchMovePoints=[],n.isDraging=!1)};Bt.addEventListener("touchcancel",s),n.globalEventListeners.push({name:"touchcancel",env:"vglobal",callback:s})}function IP(n){return!!n.changedTouches}class lz{constructor(){}setScrollHandle(t){this.scrollHandle=t}startInertia(t,e,i){this.stopped=!1,this.lastTime=Date.now(),this.speedX=t,this.speedY=e,this.friction=i,this.runingId||(this.runingId=requestAnimationFrame(this.inertia.bind(this)))}inertia(){var t;if(this.stopped)return;const e=Date.now(),i=e-this.lastTime;let r=!0;const o=Math.pow(this.friction,i/16),s=o*this.speedX,a=o*this.speedY;let l=0,h=0;Math.abs(s)>.05&&(r=!1,l=(this.speedX+s)/2*i),Math.abs(a)>.05&&(r=!1,h=(this.speedY+a)/2*i),(t=this.scrollHandle)===null||t===void 0||t.call(this,l,h),r?this.runingId=null:(this.lastTime=e,this.speedX=s,this.speedY=a,this.runingId=requestAnimationFrame(this.inertia.bind(this)))}endInertia(){cancelAnimationFrame(this.runingId),this.runingId=null,this.stopped=!0}isInertiaScrolling(){return!!this.runingId}}class Xft{constructor(t){this.isDown=!1,this.isDraging=!1,this.globalEventListeners=[],this._enableTableScroll=!0,this._gantt=t,this.inertiaScroll=new lz,this._eventHandler=new $ft,this.bindEvent()}release(){this._eventHandler.release(),this.globalEventListeners.forEach((t=>{t.env==="document"?document.removeEventListener(t.name,t.callback):t.env==="body"?document.body.removeEventListener(t.name,t.callback):t.env==="window"&&window.removeEventListener(t.name,t.callback)})),this.globalEventListeners=[],this.inertiaScroll.endInertia()}bindEvent(){Yft(this),qft(this),Uft(this)}}function Yft(n){const t=n._gantt.scenegraph,e=n._gantt,i=e.stateManager;t.ganttGroup.addEventListener("pointerdown",(r=>{if(r.button!==0)return;let o,s,a;if(r.detailPath.find((l=>l.name==="task-bar"?(o=l,!0):l.name==="task-creation-button"?!0:l.name==="task-bar-link-point-left"?(s=l,!0):l.name==="task-bar-link-point-right"?(a=l,!0):!!l.attribute.vtable_link&&(l.attribute.vtable_link,!0))),o){const l=o.record;if(l?.type!==se.PROJECT){if(r.target.name==="task-bar-hover-shadow-left-icon")i.startResizeTaskBar(o,r.nativeEvent.x,r.nativeEvent.y,r.offset.y,"left"),i.updateInteractionState(Ce.grabing);else if(r.target.name==="task-bar-hover-shadow-right-icon")i.startResizeTaskBar(o,r.nativeEvent.x,r.nativeEvent.y,r.offset.y,"right"),i.updateInteractionState(Ce.grabing);else if(r.target.name==="task-bar-progress-handle")i.startAdjustProgressBar(o,r.nativeEvent.x,r.nativeEvent.y),i.updateInteractionState(Ce.grabing);else if(e.parsedOptions.taskBarMoveable){const h=()=>{let u=!0;if(typeof e.parsedOptions.taskBarMoveable=="function"){const{startDate:d,endDate:c,taskRecord:g}=t._gantt.getTaskInfoByTaskListIndex(o.task_index,o.sub_task_index),f={index:o.task_index,startDate:d,endDate:c,taskRecord:g,ganttInstance:t._gantt};u=e.parsedOptions.taskBarMoveable(f)}else u=e.parsedOptions.taskBarMoveable;u&&(i.startMoveTaskBar(o,r.nativeEvent.x,r.nativeEvent.y,r.offset.y),i.updateInteractionState(Ce.grabing))};r.pointerType==="touch"?(n.touchEnd=!1,n.touchSetTimeout=setTimeout((()=>{n.isTouchdown=!1,n.isLongTouch=!0,h()}),100)):h()}}}else s?(i.startCreateDependencyLine(s,r.nativeEvent.x,r.nativeEvent.y,r.offset.y,"left"),i.updateInteractionState(Ce.grabing)):a&&(i.startCreateDependencyLine(a,r.nativeEvent.x,r.nativeEvent.y,r.offset.y,"right"),i.updateInteractionState(Ce.grabing))})),t.ganttGroup.addEventListener("pointermove",(r=>{var o,s,a,l,h;if(n.touchSetTimeout&&(clearTimeout(n.touchSetTimeout),n.touchSetTimeout=void 0),i.interactionState===Ce.default){const u=r.detailPath.find((g=>g.name==="task-bar")),d=r.detailPath.find((g=>g.name==="markline-hover-group")),c=r.detailPath.find((g=>g.name==="mark-line-content"));if(!((o=e.parsedOptions.markLineCreateOptions)===null||o===void 0)&&o.markLineCreatable&&(d&&!irt(d.data,e.parsedOptions.markLine)?t._gantt.stateManager.marklineIcon.target!==d&&(t._gantt.stateManager.marklineIcon.target=d,i.showMarklineIconHover()):t._gantt.stateManager.marklineIcon.target&&i.hideMarklineIconHover()),u){if(t._gantt.stateManager.hoverTaskBar.target!==u){t._gantt.stateManager.hoverTaskBar.target=u;const g=u.task_index,f=u.sub_task_index,p=u.record;p.type!==se.PROJECT&&i.showTaskBarHover(),t._gantt.hasListeners(qt.MOUSEENTER_TASK_BAR)&&t._gantt.fireListeners(qt.MOUSEENTER_TASK_BAR,{federatedEvent:r,event:r.nativeEvent,index:g,sub_task_index:f,record:p})}}else{if(t._gantt.stateManager.hoverTaskBar.target){if(t._gantt.hasListeners(qt.MOUSELEAVE_TASK_BAR)){const g=t._gantt.stateManager.hoverTaskBar.target.task_index,f=t._gantt.stateManager.hoverTaskBar.target.sub_task_index,p=t._gantt.getRecordByIndex(g,f);t._gantt.fireListeners(qt.MOUSELEAVE_TASK_BAR,{federatedEvent:r,event:r.nativeEvent,index:g,sub_task_index:f,record:p})}i.hideTaskBarHover(r)}if(e.parsedOptions.taskBarCreatable&&!c){const g=nr(r.offset.y-e.headerHeight+e.stateManager.scrollTop,e),f=e.getTaskInfoByTaskListIndex(g.task_index,g.sub_task_index);let p=!0;if(typeof e.parsedOptions.taskBarCreatable=="function"){const{startDate:m,endDate:v,taskRecord:b}=f,y={index:g.task_index,sub_task_index:g.sub_task_index,startDate:m,endDate:v,taskRecord:b,ganttInstance:e};p=e.parsedOptions.taskBarCreatable(y)}else p=e.parsedOptions.taskBarCreatable;if(p){const m=ert(r.offset.x,r.offset.y,e);if((e.parsedOptions.tasksShowMode===ft.Sub_Tasks_Separate||e.parsedOptions.tasksShowMode===ft.Tasks_Separate)&&!f.taskDays&&f.taskRecord&&!f.taskRecord.vtableMerge||(e.parsedOptions.tasksShowMode===ft.Sub_Tasks_Inline||e.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||e.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact)&&!m){const v=Fh(r.offset.x,e),b=(v>=1?e.getDateColsWidth(0,v-1):0)-e.stateManager.scroll.horizontalBarPos,y=e.taskListTableInstance.getRowsHeight(e.taskListTableInstance.columnHeaderLevelCount,g.task_index+e.taskListTableInstance.columnHeaderLevelCount-1)+((s=g.sub_task_index)!==null&&s!==void 0?s:0)*e.parsedOptions.rowHeight-e.stateManager.scroll.verticalBarPos;return void e.scenegraph.showTaskCreationButton(b,y,v)}}}}e.scenegraph.hideTaskCreationButton()}else if(i.interactionState===Ce.grabing){let u,d,c;r.detailPath.find((g=>g.name==="task-bar"?(u=g,!0):g.name==="task-creation-button"?!0:g.name==="task-bar-link-point-left"?(d=g,!0):g.name==="task-bar-link-point-right"?(c=g,!0):!!g.attribute.vtable_link&&(g.attribute.vtable_link,!0))),u=(l=u??((a=d?.parent)===null||a===void 0?void 0:a.attribute.attachedToTaskBarNode))!==null&&l!==void 0?l:(h=c?.parent)===null||h===void 0?void 0:h.attribute.attachedToTaskBarNode,t._gantt.stateManager.isCreatingDependencyLine()&&!u?i.hideSecondTaskBarSelectedBorder():t._gantt.stateManager.isCreatingDependencyLine()&&d&&t._gantt.stateManager.selectedTaskBar.target!==u?(i.highlightLinkPointNode(d),i.creatingDenpendencyLink.lastHighLightLinkPoint=d,i.creatingDenpendencyLink.secondTaskBarPosition="left"):t._gantt.stateManager.isCreatingDependencyLine()&&c&&t._gantt.stateManager.selectedTaskBar.target!==u?(i.highlightLinkPointNode(c),i.creatingDenpendencyLink.lastHighLightLinkPoint=c,i.creatingDenpendencyLink.secondTaskBarPosition="right"):t._gantt.stateManager.isCreatingDependencyLine()&&u&&t._gantt.stateManager.selectedTaskBar.target!==u&&(i.unhighlightLinkPointNode(i.creatingDenpendencyLink.lastHighLightLinkPoint),i.creatingDenpendencyLink.secondTaskBarNode&&i.creatingDenpendencyLink.secondTaskBarNode===u||(i.creatingDenpendencyLink.secondTaskBarNode&&i.creatingDenpendencyLink.secondTaskBarNode!==u&&i.hideSecondTaskBarSelectedBorder(),i.creatingDenpendencyLink.secondTaskBarNode=u,i.showSecondTaskBarSelectedBorder()))}})),t.ganttGroup.addEventListener("pointerup",(r=>{var o,s;if(n.touchSetTimeout&&(clearTimeout(n.touchSetTimeout),n.touchSetTimeout=void 0),r.button===0){let a,l,h,u=!1,d=!1,c=!1,g=!1,f=!1,p=!1,m=!1;const v=r.detailPath.find((b=>b.name==="task-bar"?(u=!0,!0):b.name==="task-creation-button"?(d=!0,!1):b.name==="task-bar-link-point-left"?(g=!0,!1):b.name==="task-bar-link-point-right"?(f=!0,!1):b.attribute.vtable_link?(c=!0,a=b.attribute.vtable_link,!1):b.name==="markline-hover-group"?(p=!0,h=b,!1):b.name==="mark-line-content"&&(m=!0,l=b,!1)));if(u&&t._gantt.parsedOptions.taskBarSelectable&&n.poniterState==="down"){if(i.hideDependencyLinkSelectedLine(),i.showTaskBarSelectedBorder(v),e.hasListeners(qt.CLICK_TASK_BAR)){const b=v.task_index,y=v.sub_task_index,C=e.getRecordByIndex(b,y);e.fireListeners(qt.CLICK_TASK_BAR,{federatedEvent:r,event:r.nativeEvent,index:b,sub_task_index:y,record:C})}}else if(d&&n.poniterState==="down"){i.hideDependencyLinkSelectedLine(),i.hideTaskBarSelectedBorder();const b=nr(r.offset.y-e.headerHeight+e.stateManager.scrollTop,e);if(e.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||e.parsedOptions.tasksShowMode===ft.Sub_Tasks_Inline||e.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact){if(e.hasListeners(qt.CREATE_TASK_SCHEDULE)){const y=Fh(r.offset.x,e),C=e.getDateRangeByIndex(y),w=(o=e.parsedOptions.dateFormat)!==null&&o!==void 0?o:e.parsedOptions.timeScaleIncludeHour?"yyyy-mm-dd hh:mm:ss":"yyyy-mm-dd";e.fireListeners(qt.CREATE_TASK_SCHEDULE,{federatedEvent:r,event:r.nativeEvent,index:b.task_index,sub_task_index:b.sub_task_index,startDate:fs(C.startDate,w),endDate:fs(C.endDate,w),record:void 0,parentRecord:e.getRecordByIndex(b.task_index)})}}else{const y=e.getTaskInfoByTaskListIndex(b.task_index,b.sub_task_index);if(y.taskRecord){const C=(s=e.parsedOptions.dateFormat)!==null&&s!==void 0?s:e.parsedOptions.timeScaleIncludeHour?"yyyy-mm-dd hh:mm:ss":"yyyy-mm-dd",w=Fh(r.offset.x,e),_=e.getDateRangeByIndex(w);y.taskRecord[e.parsedOptions.startDateField]=fs(_.startDate,C),y.taskRecord[e.parsedOptions.endDateField]=fs(_.endDate,C),e.scenegraph.hideTaskCreationButton(),e.updateTaskRecord(y.taskRecord,b.task_index,b.sub_task_index),e.hasListeners(qt.CREATE_TASK_SCHEDULE)&&e.fireListeners(qt.CREATE_TASK_SCHEDULE,{federatedEvent:r,event:r.nativeEvent,index:b.task_index,sub_task_index:b.sub_task_index,startDate:y.taskRecord[e.parsedOptions.startDateField],endDate:y.taskRecord[e.parsedOptions.endDateField],record:y.taskRecord})}}}else if(c&&t._gantt.parsedOptions.dependencyLinkSelectable&&n.poniterState==="down")i.hideDependencyLinkSelectedLine(),i.hideTaskBarSelectedBorder(),t._gantt.stateManager.selectedDenpendencyLink.link=a,i.showDependencyLinkSelectedLine();else if((g||f)&&n.poniterState==="down"){if(e.hasListeners(qt.CLICK_DEPENDENCY_LINK_POINT)){const b=nr(r.offset.y-e.headerHeight+e.stateManager.scrollTop,e),y=e.getRecordByIndex(b.task_index,b.sub_task_index);e.fireListeners(qt.CLICK_DEPENDENCY_LINK_POINT,{event:r.nativeEvent,index:b.task_index,sub_task_index:b.sub_task_index,point:g?"start":"end",record:y})}i.hideTaskBarSelectedBorder()}else if(p&&n.poniterState==="down")e.hasListeners(qt.CLICK_MARKLINE_CREATE)&&e.fireListeners(qt.CLICK_MARKLINE_CREATE,{event:r.nativeEvent,position:_B(h,t._gantt),data:t._gantt.stateManager.marklineIcon.target.data});else if(m&&n.poniterState==="down")e.hasListeners(qt.CLICK_MARKLINE_CONTENT)&&e.fireListeners(qt.CLICK_MARKLINE_CONTENT,{event:r.nativeEvent,position:_B(l,t._gantt),data:l.data});else if(g&&n.poniterState==="draging"){if(i.isCreatingDependencyLine()){const b=i.endCreateDependencyLine(r.offset.y);e.hasListeners(qt.CREATE_DEPENDENCY_LINK)&&e.fireListeners(qt.CREATE_DEPENDENCY_LINK,{federatedEvent:r,event:r.nativeEvent,link:b})}}else if(f&&n.poniterState==="draging"){if(i.isCreatingDependencyLine()){const b=i.endCreateDependencyLine(r.offset.y);e.hasListeners(qt.CREATE_DEPENDENCY_LINK)&&e.fireListeners(qt.CREATE_DEPENDENCY_LINK,{federatedEvent:r,event:r.nativeEvent,link:b})}}else i.hideDependencyLinkSelectedLine(),i.hideTaskBarSelectedBorder()}})),t.ganttGroup.addEventListener("rightdown",(r=>{let o,s=!1,a=!1;const l=r.detailPath.find((h=>h.name==="task-bar"?(s=!0,!0):!!h.attribute.vtable_link&&(a=!0,o=h.attribute.vtable_link,!1)));if(s){if(e.hasListeners(qt.CONTEXTMENU_TASK_BAR)){const h=l.task_index,u=l.sub_task_index,d=e.getRecordByIndex(h,u);e.fireListeners(qt.CONTEXTMENU_TASK_BAR,{federatedEvent:r,event:r.nativeEvent,index:h,sub_task_index:u,record:d})}}else a&&e.hasListeners(qt.CONTEXTMENU_DEPENDENCY_LINK)&&e.fireListeners(qt.CONTEXTMENU_DEPENDENCY_LINK,{federatedEvent:r,event:r.nativeEvent,link:o})})),t.ganttGroup.addEventListener("pointerenter",(r=>{(e.parsedOptions.scrollStyle.horizontalVisible&&e.parsedOptions.scrollStyle.horizontalVisible==="focus"||!e.parsedOptions.scrollStyle.horizontalVisible&&e.parsedOptions.scrollStyle.visible==="focus")&&t.scrollbarComponent.showHorizontalScrollBar(),(e.parsedOptions.scrollStyle.verticalVisible&&e.parsedOptions.scrollStyle.verticalVisible==="focus"||!e.parsedOptions.scrollStyle.verticalVisible&&e.parsedOptions.scrollStyle.visible==="focus")&&t.scrollbarComponent.showVerticalScrollBar()})),t.ganttGroup.addEventListener("pointerleave",(r=>{if((e.parsedOptions.scrollStyle.horizontalVisible&&e.parsedOptions.scrollStyle.horizontalVisible==="focus"||!e.parsedOptions.scrollStyle.horizontalVisible&&e.parsedOptions.scrollStyle.visible==="focus")&&t.scrollbarComponent.hideHorizontalScrollBar(),(e.parsedOptions.scrollStyle.verticalVisible&&e.parsedOptions.scrollStyle.verticalVisible==="focus"||!e.parsedOptions.scrollStyle.verticalVisible&&e.parsedOptions.scrollStyle.visible==="focus")&&t.scrollbarComponent.hideVerticalScrollBar(),t._gantt.stateManager.hoverTaskBar.target){if(t._gantt.hasListeners(qt.MOUSELEAVE_TASK_BAR)){const o=t._gantt.stateManager.hoverTaskBar.target.task_index,s=t._gantt.stateManager.hoverTaskBar.target.sub_task_index,a=t._gantt.getRecordByIndex(o,s);t._gantt.fireListeners(qt.MOUSELEAVE_TASK_BAR,{federatedEvent:r,event:r.nativeEvent,index:o,sub_task_index:s,record:a})}i.hideTaskBarHover(r)}})),t.ganttGroup.addEventListener("wheel",(r=>{jw(r,i,e)}))}function qft(n){const t=n._gantt,e=(n._gantt.scenegraph,t.stateManager),i=n._eventHandler;i.on(t.getElement(),"contextmenu",(l=>{var h;((h=t.parsedOptions.eventOptions)===null||h===void 0?void 0:h.preventDefaultContextMenu)!==!1&&l.preventDefault()})),i.on(t.getContainer(),"resize",(l=>{l.width===0&&l.height===0||($(t.options.pixelRatio)||t.setPixelRatio(az()),l.windowSizeNotChange||t._resize())})),t.taskListTableInstance&&t.parsedOptions.verticalSplitLineMoveable&&i.on(t.verticalSplitResizeLine,"mousedown",(l=>{e.updateInteractionState(Ce.grabing),e.startResizeTableWidth(l)})),t.parsedOptions.verticalSplitLineHighlight&&(t.verticalSplitResizeLine&&i.on(t.verticalSplitResizeLine,"mouseover",(l=>{t.verticalSplitResizeLine.childNodes[1].style.opacity="1"})),t.verticalSplitResizeLine&&i.on(t.verticalSplitResizeLine,"mouseout",(l=>{t.verticalSplitResizeLine.childNodes[1].style.opacity="0"})));const r=l=>{t.eventManager.lastDragPointerXYOnWindow={x:l.x,y:l.y},t.eventManager.poniterState="down"};n.globalEventListeners.push({name:"pointerdown",env:"document",callback:r}),Bt.addEventListener("pointerdown",r);const o=l=>{var h,u,d,c,g,f;if(t.eventManager.poniterState==="down"){const p=(h=t.eventManager.lastDragPointerXYOnWindow.x)!==null&&h!==void 0?h:l.x,m=l.x-p,v=(u=t.eventManager.lastDragPointerXYOnWindow.y)!==null&&u!==void 0?u:l.y,b=l.y-v;(Math.abs(m)>=1||Math.abs(b)>=1)&&(t.eventManager.poniterState="draging")}if(e.interactionState===Ce.grabing&&t.eventManager.poniterState==="draging"){const p=(c=(d=t.eventManager.lastDragPointerXYOnWindow)===null||d===void 0?void 0:d.x)!==null&&c!==void 0?c:l.x,m=(f=(g=t.eventManager.lastDragPointerXYOnWindow)===null||g===void 0?void 0:g.y)!==null&&f!==void 0?f:l.y;(Math.abs(p-l.x)>=1||Math.abs(m-l.y)>=1)&&(e.isResizingTableWidth()?(e.hideDependencyLinkSelectedLine(),e.hideTaskBarSelectedBorder(),e.dealResizeTableWidth(l)):e.isMoveingTaskBar()?(e.hideDependencyLinkSelectedLine(),e.hideTaskBarSelectedBorder(),e.dealTaskBarMove(l)):e.isResizingTaskBar()?(e.hideDependencyLinkSelectedLine(),e.hideTaskBarSelectedBorder(),e.dealTaskBarResize(l)):e.isAdjustingProgressBar()?e.dealAdjustProgressBar(l):e.isCreatingDependencyLine()&&e.dealCreateDependencyLine(l),t.eventManager.lastDragPointerXYOnWindow={x:l.x,y:l.y})}};n.globalEventListeners.push({name:"pointermove",env:"document",callback:o}),Bt.addEventListener("pointermove",o);const s=l=>{e.interactionState==="grabing"&&(e.updateInteractionState(Ce.default),e.isResizingTableWidth()?e.endResizeTableWidth():e.isMoveingTaskBar()?e.endMoveTaskBar():e.isResizingTaskBar()?e.endResizeTaskBar(l.x):e.isAdjustingProgressBar()&&e.endAdjustProgressBar(l.x)),setTimeout((()=>{t.eventManager.lastDragPointerXYOnWindow=void 0,t.eventManager.poniterState="up"}),0)};n.globalEventListeners.push({name:"pointerup",env:"document",callback:s}),Bt.addEventListener("pointerup",s);const a=l=>{var h,u;if(t.parsedOptions.dependencyLinkDeletable&&(l.key==="Delete"&&(!((h=t.parsedOptions.keyboardOptions)===null||h===void 0)&&h.deleteLinkOnDel)||l.key==="Backspace"&&(!((u=t.parsedOptions.keyboardOptions)===null||u===void 0)&&u.deleteLinkOnBack))&&t.stateManager.selectedDenpendencyLink.link){const d=t.stateManager.selectedDenpendencyLink.link;t.deleteLink(t.stateManager.selectedDenpendencyLink.link),e.hideDependencyLinkSelectedLine(),e.hideTaskBarSelectedBorder(),t.hasListeners(qt.DELETE_DEPENDENCY_LINK)&&t.fireListeners(qt.DELETE_DEPENDENCY_LINK,{event:l,link:d})}};n.globalEventListeners.push({name:"keydown",env:"document",callback:a}),Bt.addEventListener("keydown",a)}function HP(n){const{scroll:t}=n.stateManager,{verticalBarPos:e}=t;n.taskListTableInstance.stateManager.setScrollTop(e,void 0,!1)}function Kft(n){var t;n.taskListTableInstance&&((t=n.taskListTableInstance)===null||t===void 0||t.on("scroll",(e=>{if(e.scrollDirection==="vertical"){const{scroll:i}=n.taskListTableInstance.stateManager,{verticalBarPos:r}=i;n.stateManager.scroll.verticalBarPos!==r&&n.stateManager.setScrollTop(r,!1)}})))}function Zft(n){var t;(t=n.taskListTableInstance)===null||t===void 0||t.on("change_cell_value",(e=>{const{col:i,row:r}=e;n.taskListTableInstance.isHeader(i,r)||n._refreshTaskBar(r-n.taskListTableInstance.columnHeaderLevelCount)}))}function Jft(n){var t;(t=n.taskListTableInstance)===null||t===void 0||t.on("tree_hierarchy_state_change",(e=>{var i,r;const{row:o,hierarchyState:s}=e;if(n.parsedOptions.tasksShowMode===ft.Project_Sub_Tasks_Inline){const h=o-n.taskListTableInstance.columnHeaderLevelCount,u=n.getRecordByIndex(h);u&&u.type===se.PROJECT&&((i=u.children)===null||i===void 0?void 0:i.length)>0&&(u.hierarchyState=s)}n._syncPropsFromTable(),n.scenegraph.refreshTaskBarsAndGrid(),!n.taskListTableInstance.checkHasColumnAutoWidth()||((r=n.options.taskListTable)===null||r===void 0?void 0:r.tableWidth)!=="auto"&&n.taskTableWidth!==-1||hz(n);const a=n.stateManager.scroll.horizontalBarPos,l=n.stateManager.scroll.verticalBarPos;n.scenegraph.setX(-a),n.scenegraph.setY(-l)}))}function Qft(n){var t;(t=n.taskListTableInstance)===null||t===void 0||t.on("after_sort",(e=>{n.scenegraph.refreshTaskBars();const i=n.stateManager.scroll.horizontalBarPos,r=n.stateManager.scroll.verticalBarPos;n.scenegraph.setX(-i),n.scenegraph.setY(-r)}))}function tpt(n){var t,e,i,r;(t=n.taskListTableInstance)===null||t===void 0||t.on("change_header_position",(o=>{n.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||n.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact||n.parsedOptions.tasksShowMode===ft.Sub_Tasks_Separate||n.parsedOptions.tasksShowMode===ft.Project_Sub_Tasks_Inline?n.scenegraph.refreshTaskBarsAndGrid():n.scenegraph.refreshTaskBars(),n.scenegraph.dragOrderLine.hideDragLine();const s=n.stateManager.scroll.horizontalBarPos,a=n.stateManager.scroll.verticalBarPos;n.scenegraph.setX(-s),n.scenegraph.setY(-a)})),(e=n.taskListTableInstance)===null||e===void 0||e.on("change_header_position_start",(o=>{const{col:s,row:a,x:l,y:h,backX:u,lineX:d,backY:c,lineY:g,event:f}=o;n.scenegraph.dragOrderLine.showDragLine(g),n.scenegraph.updateNextFrame()})),(i=n.taskListTableInstance)===null||i===void 0||i.on("changing_header_position",(o=>{const{col:s,row:a,x:l,y:h,backX:u,lineX:d,backY:c,lineY:g,event:f}=o;n.scenegraph.dragOrderLine.showDragLine(g),n.scenegraph.updateNextFrame()})),(r=n.taskListTableInstance)===null||r===void 0||r.on("change_header_position_fail",(o=>{n.scenegraph.dragOrderLine.hideDragLine(),n.scenegraph.updateNextFrame()}))}function ept(n){var t;(t=n.taskListTableInstance)===null||t===void 0||t.on("resize_column",(e=>{hz(n)}))}function hz(n){var t,e,i,r,o,s,a,l;const h=n.taskTableWidth;n.taskTableWidth=n.taskListTableInstance.getAllColsWidth()+n.parsedOptions.outerFrameStyle.borderLineWidth,!((e=(t=n.options)===null||t===void 0?void 0:t.taskListTable)===null||e===void 0)&&e.maxTableWidth&&(n.taskTableWidth=Math.min((r=(i=n.options)===null||i===void 0?void 0:i.taskListTable)===null||r===void 0?void 0:r.maxTableWidth,n.taskTableWidth)),!((s=(o=n.options)===null||o===void 0?void 0:o.taskListTable)===null||s===void 0)&&s.minTableWidth&&(n.taskTableWidth=Math.max((l=(a=n.options)===null||a===void 0?void 0:a.taskListTable)===null||l===void 0?void 0:l.minTableWidth,n.taskTableWidth)),h!==n.taskTableWidth&&(n.element.style.left=n.taskTableWidth?`${n.taskTableWidth}px`:"0px",n.taskListTableInstance.setCanvasSize(n.taskTableWidth,n.tableNoFrameHeight+2*n.parsedOptions.outerFrameStyle.borderLineWidth),n._updateSize(),Xf(n))}class ipt{constructor(t){var e;this.interactionState=Ce.default,this.resetInteractionState=sz((()=>{this.updateInteractionState(Ce.default)}),100),this._gantt=t,this.scroll={horizontalBarPos:0,verticalBarPos:0},this.moveTaskBar={targetStartX:null,targetStartY:null,deltaX:0,deltaY:0,startOffsetY:null,startX:null,startY:null,moving:!1,target:null,moveTaskBarXSpeed:0,moveTaskBarXInertia:new lz},this.hoverTaskBar={targetStartX:null,startX:null,target:null},this.marklineIcon={target:null},this.selectedTaskBar={target:null},this.resizeTaskBar={startOffsetY:null,targetStartX:null,targetEndX:null,startX:null,startY:null,target:null,resizing:!1,onIconName:""},this.adjustProgressBar={startX:null,startY:null,target:null,adjusting:!1,originalProgress:0},this.resizeTableWidth={lastX:null,resizing:!1},this.selectedDenpendencyLink={link:null},this.creatingDenpendencyLink={startClickedPoint:null,startX:null,startY:null,startOffsetY:null,targetStartX:null,creating:!1,secondTaskBarNode:null},this.updateVerticalScrollBar=this.updateVerticalScrollBar.bind(this),this.updateHorizontalScrollBar=this.updateHorizontalScrollBar.bind(this),Kft(this._gantt),Zft(this._gantt),tpt(this._gantt),Jft(this._gantt),Qft(this._gantt),((e=this._gantt.options.taskListTable)===null||e===void 0?void 0:e.tableWidth)!=="auto"&&this._gantt.taskTableWidth!==-1||ept(this._gantt)}setScrollTop(t,e=!0){const i=this._gantt.getAllRowsHeight();t=Math.max(0,Math.min(t,i-this._gantt.scenegraph.height)),t=Math.ceil(t);const r=this.scroll.verticalBarPos;this.scroll.verticalBarPos=t,$(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this._gantt.scenegraph.setY(-t);const o=t/(i-this._gantt.scenegraph.height);this._gantt.scenegraph.scrollbarComponent.updateVerticalScrollBarPos(o),r!==t&&e&&(HP(this._gantt),this._gantt.fireListeners(qt.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollDirection:"vertical",scrollRatioY:o}))}get scrollLeft(){return this.scroll.horizontalBarPos}get scrollTop(){return this.scroll.verticalBarPos}setScrollLeft(t,e=!0){const i=this._gantt.getAllDateColsWidth();t=Math.max(0,Math.min(t,i-this._gantt.scenegraph.width)),t=Math.ceil(t);const r=this.scroll.horizontalBarPos;this.scroll.horizontalBarPos=t,$(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this._gantt.scenegraph.setX(-t);const o=t/(i-this._gantt.scenegraph.width);this._gantt.scenegraph.scrollbarComponent.updateHorizontalScrollBarPos(o),r!==t&&e&&this._gantt.fireListeners(qt.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollDirection:"horizontal",scrollRatioX:o})}updateInteractionState(t){if(this.interactionState===t)return;const e=this.interactionState;this.interactionState=t,e===Ce.scrolling&&Ce.default}updateVerticalScrollBar(t){const e=this._gantt.getAllRowsHeight();this.scroll.verticalBarPos,this.scroll.verticalBarPos=Math.ceil(t*(e-this._gantt.scenegraph.height)),$(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this._gantt.scenegraph.setY(-this.scroll.verticalBarPos,t===1),HP(this._gantt),this._gantt.fireListeners(qt.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollDirection:"vertical",scrollRatioY:t})}updateHorizontalScrollBar(t){const e=this._gantt.getAllDateColsWidth();this.scroll.horizontalBarPos,this.scroll.horizontalBarPos=Math.ceil(t*(e-this._gantt.scenegraph.width)),$(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this._gantt.scenegraph.setX(-this.scroll.horizontalBarPos,t===1),this._gantt.fireListeners(qt.SCROLL,{scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollDirection:"horizontal",scrollRatioY:t})}startMoveTaskBar(t,e,i,r){t.name==="task-bar-hover-shadow"&&(t=t.parent),this.moveTaskBar.moving=!0,this.moveTaskBar.target=t,this.moveTaskBar.targetStartX=t.attribute.x,this.moveTaskBar.targetStartY=t.attribute.y,this.moveTaskBar.startX=e,this.moveTaskBar.startY=i,this.moveTaskBar.startOffsetY=r,t.setAttribute("zIndex",1e4)}isMoveingTaskBar(){return this.moveTaskBar.moving}endMoveTaskBar(){this.moveTaskBar.moveTaskBarXInertia.isInertiaScrolling()&&this.moveTaskBar.moveTaskBarXInertia.endInertia();const t=this.moveTaskBar.deltaX,e=this.moveTaskBar.deltaY,i=this.moveTaskBar.target;if(Math.abs(t)>=1||Math.abs(e)>=1){const r=i.task_index,o=i.task_index,s=i.sub_task_index,{startDate:a,endDate:l}=this._gantt.getTaskInfoByTaskListIndex(o,s),h=this.moveTaskBar.targetStartY+this._gantt.parsedOptions.rowHeight*Math.round(e/this._gantt.parsedOptions.rowHeight),u=this._gantt.parsedOptions.taskBarMilestoneStyle.width,d=this.moveTaskBar.target.attribute.x+(i.record.type===se.MILESTONE?u/2:0),c=Fh(d-this._gantt.stateManager.scroll.horizontalBarPos,this._gantt),g=this._gantt.parsedOptions.reverseSortedTimelineScales[0].timelineDates[c];if(!g)return;const f=g.startDate,p=new Date(f.getTime()+(Ye(l).getTime()-Ye(a).getTime()));let m;if(Ye(a).getTime()!==f.getTime()){m=Ye(a).getTime()>f.getTime()?"left":"right",this._gantt._updateStartEndDateToTaskRecord(f,p,o,s);const v=this._gantt.getRecordByIndex(o,s);this._gantt.hasListeners(qt.CHANGE_DATE_RANGE)&&this._gantt.fireListeners(qt.CHANGE_DATE_RANGE,{startDate:v[this._gantt.parsedOptions.startDateField],endDate:v[this._gantt.parsedOptions.endDateField],oldStartDate:a,oldEndDate:l,index:o,record:v});const b=nr(h,this._gantt).task_index;this._gantt.hasListeners(qt.MOVE_END_TASK_BAR)&&this._gantt.fireListeners(qt.MOVE_END_TASK_BAR,{startDate:v[this._gantt.parsedOptions.startDateField],endDate:v[this._gantt.parsedOptions.endDateField],oldStartDate:a,oldEndDate:l,oldRowIndex:r,newRowIndex:b,index:o,record:v})}else{const v=this._gantt.getRecordByIndex(o,s),b=nr(h,this._gantt).task_index;this._gantt.hasListeners(qt.MOVE_END_TASK_BAR)&&this._gantt.fireListeners(qt.MOVE_END_TASK_BAR,{startDate:v[this._gantt.parsedOptions.startDateField],endDate:v[this._gantt.parsedOptions.endDateField],oldStartDate:a,oldEndDate:l,oldRowIndex:r,newRowIndex:b,index:b,record:v})}if(this._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||this._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact){const v=nr(h,this._gantt);this._gantt._dragOrderTaskRecord(i.task_index,i.sub_task_index,v.task_index,v.sub_task_index),fD(this._gantt.records),this._gantt.taskListTableInstance.renderWithRecreateCells(),this._gantt._syncPropsFromTable(),this._gantt.scenegraph.refreshTaskBarsAndGrid()}else if(this._gantt.parsedOptions.tasksShowMode!==ft.Tasks_Separate&&Math.abs(Math.round(e/this._gantt.parsedOptions.rowHeight))>=1){const v=nr(h,this._gantt);this._gantt._dragOrderTaskRecord(i.task_index,i.sub_task_index,v.task_index,v.sub_task_index),this._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Separate?(this._gantt.taskListTableInstance.renderWithRecreateCells(),this._gantt.scenegraph.refreshTaskBarsAndGrid()):(this._gantt.scenegraph.taskBar.refresh(),this._gantt.scenegraph.dependencyLink.refresh())}else{let v=c>=1?this._gantt.getDateColsWidth(0,c-1):0;if(i.record.type===se.MILESTONE&&(v-=this._gantt.parsedOptions.taskBarMilestoneStyle.width/2),ch(i,v-i.attribute.x,h-i.attribute.y,this),m==="right"){let b=i;for(;b.nextSibling&&b.nextSibling.attribute.y===i.attribute.y&&b.nextSibling.record[this._gantt.parsedOptions.startDateField]<=i.record[this._gantt.parsedOptions.startDateField];)b=b.nextSibling;b!==i&&b.parent.insertAfter(i,b)}else if(m==="left"){let b=i;for(;b.previousSibling&&b.previousSibling.attribute.y===i.attribute.y&&b.previousSibling.record[this._gantt.parsedOptions.startDateField]>=i.record[this._gantt.parsedOptions.startDateField];)b=b.previousSibling;b!==i&&b.parent.insertBefore(i,b)}}this._gantt.scenegraph.updateNextFrame()}this.moveTaskBar.moving=!1,this.selectedTaskBar.target!==i&&i.setAttribute("zIndex",0),i.updateTextPosition(),this.moveTaskBar.target=null,this.moveTaskBar.deltaX=0,this.moveTaskBar.deltaY=0,this.moveTaskBar.moveTaskBarXSpeed=0}dealTaskBarMove(t){var e,i,r,o,s,a;const l=this._gantt;let h=this.moveTaskBar.target;h.setAttribute("zIndex",1e4);const u=l.eventManager.lastDragPointerXYOnWindow.x,d=t.x-u,c=l.eventManager.lastDragPointerXYOnWindow.y,g=t.y-c;if(this.moveTaskBar.deltaX+=d,this.moveTaskBar.deltaY+=g,ch(h,d,g,this),h.attribute.x<=l.stateManager.scrollLeft&&d<0)if(l.parsedOptions.moveTaskBarToExtendDateRange&&l.stateManager.scrollLeft===0){(e=this.moveTaskBar.moveTaskBarXInertia)===null||e===void 0||e.endInertia();const f=l.parsedOptions.reverseSortedTimelineScales[0].timelineDates[1].startDate.getTime()-l.parsedOptions.reverseSortedTimelineScales[0].timelineDates[0].startDate.getTime(),{unit:p,startOfWeek:m}=l.parsedOptions.reverseSortedTimelineScales[0];l.parsedOptions.minDate=Nl(new Date(l.parsedOptions.reverseSortedTimelineScales[0].timelineDates[0].startDate.getTime()-f/2),p,m),l.parsedOptions._minDateTime=(i=l.parsedOptions.minDate)===null||i===void 0?void 0:i.getTime(),l._generateTimeLineDateMap(),l._updateSize(),l.scenegraph.refreshAll(),h=this.moveTaskBar.target=l.scenegraph.taskBar.getTaskBarNodeByIndex(this.moveTaskBar.target.task_index,this.moveTaskBar.target.sub_task_index),l.scrollLeft=l.parsedOptions.timelineColWidth-1,l.eventManager.lastDragPointerXYOnWindow.x=t.x,((r=h.record)===null||r===void 0?void 0:r.type)==="milestone"?ch(h,l.scrollLeft-h.attribute.x,0,this):h.setAttribute("x",l.scrollLeft)}else this.moveTaskBar.moveTaskBarXSpeed=-l.parsedOptions.timelineColWidth/100,this.moveTaskBar.moveTaskBarXInertia.startInertia(this.moveTaskBar.moveTaskBarXSpeed,0,1),this.moveTaskBar.moveTaskBarXInertia.setScrollHandle(((f,p)=>{this.moveTaskBar.deltaX+=f,this.moveTaskBar.deltaY+=p,ch(h,f,p,this),l.stateManager.setScrollLeft(h.attribute.x),l.stateManager.scrollLeft===0&&this.moveTaskBar.moveTaskBarXInertia.endInertia()}));else if(h.attribute.x+h.attribute.width>=l.stateManager.scrollLeft+l.tableNoFrameWidth&&d>0)if(l.parsedOptions.moveTaskBarToExtendDateRange&&l.stateManager.scrollLeft+l.tableNoFrameWidth===l.getAllDateColsWidth()){(o=this.moveTaskBar.moveTaskBarXInertia)===null||o===void 0||o.endInertia();const f=l.parsedOptions.reverseSortedTimelineScales[0].timelineDates,p=f[1].startDate.getTime()-f[0].startDate.getTime(),{unit:m,startOfWeek:v,step:b}=l.parsedOptions.reverseSortedTimelineScales[0];if(l.parsedOptions.maxDate=Tu(l.parsedOptions.minDate,new Date(f[f.length-1].endDate.getTime()+p/2),m,b),l.parsedOptions._maxDateTime=(s=l.parsedOptions.maxDate)===null||s===void 0?void 0:s.getTime(),l._generateTimeLineDateMap(),l._updateSize(),l.scenegraph.refreshAll(),h=this.moveTaskBar.target=l.scenegraph.taskBar.getTaskBarNodeByIndex(this.moveTaskBar.target.task_index,this.moveTaskBar.target.sub_task_index),l.scrollLeft+=1,l.eventManager.lastDragPointerXYOnWindow.x=t.x,((a=h.record)===null||a===void 0?void 0:a.type)==="milestone"){const y=l.scrollLeft+l.tableNoFrameWidth-h.attribute.width;ch(h,y-h.attribute.x,0,this)}else h.setAttribute("x",l.scrollLeft+l.tableNoFrameWidth-h.attribute.width)}else this.moveTaskBar.moveTaskBarXSpeed=l.parsedOptions.timelineColWidth/100,this.moveTaskBar.moveTaskBarXInertia.startInertia(this.moveTaskBar.moveTaskBarXSpeed,0,1),this.moveTaskBar.moveTaskBarXInertia.setScrollHandle(((f,p)=>{this.moveTaskBar.deltaX+=f,this.moveTaskBar.deltaY+=p,ch(h,f,p,this),l.stateManager.setScrollLeft(h.attribute.x+h.attribute.width-l.tableNoFrameWidth),l.stateManager.scrollLeft===l.getAllDateColsWidth()-l.tableNoFrameWidth&&this.moveTaskBar.moveTaskBarXInertia.endInertia()}));else this.moveTaskBar.moveTaskBarXInertia.isInertiaScrolling()?this.moveTaskBar.moveTaskBarXInertia.endInertia():this.moveTaskBar.moveTaskBarXSpeed=0;l.scenegraph.updateNextFrame()}startResizeTaskBar(t,e,i,r,o){this.resizeTaskBar.onIconName=o,this.resizeTaskBar.resizing=!0,this.resizeTaskBar.target=t,this.resizeTaskBar.targetStartX=t.attribute.x,this.resizeTaskBar.targetEndX=t.attribute.x+t.attribute.width,this.resizeTaskBar.startX=e,this.resizeTaskBar.startY=i,this.resizeTaskBar.startOffsetY=r}isResizingTaskBar(){return this.resizeTaskBar.resizing}endResizeTaskBar(t){const e=this._gantt.stateManager.resizeTaskBar.onIconName,i=t-this.resizeTaskBar.startX;if(Math.abs(i)>=1){const r=Fh((e==="left"?this.resizeTaskBar.target.attribute.x:this.resizeTaskBar.target.attribute.x+this.resizeTaskBar.target.attribute.width)-this._gantt.stateManager.scroll.horizontalBarPos,this._gantt),o=this._gantt.parsedOptions.reverseSortedTimelineScales[0].timelineDates[r];if(!o)return;const s=e==="left"?o.startDate:o.endDate,a=this.resizeTaskBar.target,l=a.clipGroupBox,h=a.barRect,u=a.progressRect,d=a.textLabel,c=a.task_index,g=a.sub_task_index,{taskDays:f,progress:p,startDate:m,endDate:v}=this._gantt.getTaskInfoByTaskListIndex(c,g);let b=!1;if(e==="left"?(this._gantt._updateStartDateToTaskRecord(s,c,g),s.getTime()!==new Date(m).getTime()&&(b=!0)):(this._gantt._updateEndDateToTaskRecord(s,c,g),s.getTime()!==new Date(v).getTime()&&(b=!0)),this._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||this._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact)this._gantt.taskListTableInstance.renderWithRecreateCells(),this._gantt._syncPropsFromTable(),this._gantt.scenegraph.refreshTaskBarsAndGrid();else{if(e==="left"){const y=r>=1?this._gantt.getDateColsWidth(0,r-1):0;a.setAttribute("x",y),a.setAttribute("width",this.resizeTaskBar.targetEndX-y)}else if(e==="right"){const y=this._gantt.getDateColsWidth(0,r);a.setAttribute("width",y-this.resizeTaskBar.targetStartX)}if(l.setAttribute("width",a.attribute.width),h?.setAttribute("width",a.attribute.width),u?.setAttribute("width",p/100*a.attribute.width),d){const{textAlign:y,textBaseline:C,padding:w}=this._gantt.parsedOptions.taskBarLabelStyle,_=mg(pg(w),y,C,a.attribute.width,a.attribute.height);d.setAttribute("maxLineWidth",a.attribute.width-2*oz),d.setAttribute("x",_.x)}this._gantt.scenegraph.refreshRecordLinkNodes(c,g,a,0),this.showTaskBarHover(),uz(this._gantt,a,c,g),a.setAttribute("zIndex",0)}if(a.updateTextPosition(),this.resizeTaskBar.resizing=!1,this.resizeTaskBar.target=null,b&&this._gantt.hasListeners(qt.CHANGE_DATE_RANGE)){const y=this._gantt.getRecordByIndex(c,g);this._gantt.fireListeners(qt.CHANGE_DATE_RANGE,{startDate:y[this._gantt.parsedOptions.startDateField],endDate:y[this._gantt.parsedOptions.endDateField],oldStartDate:m,oldEndDate:v,index:c,record:y})}this._gantt.scenegraph.updateNextFrame()}}dealTaskBarResize(t){const e=this._gantt.eventManager.lastDragPointerXYOnWindow.x,i=t.x-e,r=this._gantt.stateManager.resizeTaskBar.target;let o=this._gantt.stateManager.resizeTaskBar.onIconName==="left"?-i:i;const s=Math.max(1,r.attribute.width+o);o=s-r.attribute.width,npt(r,this._gantt.stateManager.resizeTaskBar.onIconName==="left"?-o:0,s,this),this._gantt.scenegraph.updateNextFrame()}startAdjustProgressBar(t,e,i){const{progress:r}=this._gantt.getTaskInfoByTaskListIndex(t.task_index,t.sub_task_index);this.adjustProgressBar.target=t,this.adjustProgressBar.adjusting=!0,this.adjustProgressBar.startX=e,this.adjustProgressBar.startY=i,this.adjustProgressBar.originalProgress=r}isAdjustingProgressBar(){return this.adjustProgressBar.adjusting}endAdjustProgressBar(t){const e=this.adjustProgressBar.target,i=e.attribute.width,r=t-this.adjustProgressBar.startX,o=Math.max(0,Math.min(100,this.adjustProgressBar.originalProgress+r/i*100));if(Math.abs(o-this.adjustProgressBar.originalProgress)>=.1){const s=e.task_index,a=e.sub_task_index;this._gantt._updateProgressToTaskRecord(Math.round(10*o)/10,s,a);const l=this._gantt.getRecordByIndex(s,a);this._gantt.hasListeners(qt.PROGRESS_UPDATE)&&this._gantt.fireListeners(qt.PROGRESS_UPDATE,{federatedEvent:null,event:null,index:s,sub_task_index:a,progress:Math.round(10*o)/10,oldProgress:Math.round(10*this.adjustProgressBar.originalProgress)/10,record:l})}this.adjustProgressBar.adjusting=!1,this.adjustProgressBar.target=null,this.adjustProgressBar.startX=null,this.adjustProgressBar.startY=null,this.adjustProgressBar.originalProgress=0}dealAdjustProgressBar(t){const e=this.adjustProgressBar.target,i=e.attribute.width,r=t.x-this.adjustProgressBar.startX,o=Math.max(0,Math.min(100,this.adjustProgressBar.originalProgress+r/i*100));if(e.progressRect&&e.progressRect.setAttribute("width",i*o/100),this._gantt.scenegraph.taskBar.hoverBarProgressHandle&&this._gantt.scenegraph.taskBar.hoverBarProgressHandle.attribute.visibleAll&&this._gantt.scenegraph.taskBar.hoverBarProgressHandle.setAttribute("x",i*o/100-6),e.textLabel&&e.record){const s=Object.assign(Object.assign({},e.record),{progress:Math.round(10*o)/10}),a=aD(this._gantt.parsedOptions.taskBarLabelText,s);e.textLabel.setAttribute("text",a)}this._gantt.scenegraph&&this._gantt.scenegraph.stage&&this._gantt.scenegraph.stage.renderNextFrame()}startCreateDependencyLine(t,e,i,r,o){this.resizeTaskBar.resizing=!1,this.creatingDenpendencyLink.creating=!0,this.creatingDenpendencyLink.startClickedPoint=t,this.creatingDenpendencyLink.startX=e,this.creatingDenpendencyLink.startY=i,this.creatingDenpendencyLink.startOffsetY=r,this.creatingDenpendencyLink.firstTaskBarPosition=o,this.highlightLinkPointNode(t)}isCreatingDependencyLine(){return this.creatingDenpendencyLink.creating}endCreateDependencyLine(t){const e=this._gantt.parsedOptions.taskKeyField,i=this.selectedTaskBar.target.task_index,r=this.selectedTaskBar.target.sub_task_index,o=this.creatingDenpendencyLink.secondTaskBarNode.task_index,s=this.creatingDenpendencyLink.secondTaskBarNode.sub_task_index,a={linkedFromTaskKey:this._gantt.getRecordByIndex(i,r)[e],linkedToTaskKey:this._gantt.getRecordByIndex(o,s)[e],type:this.creatingDenpendencyLink.firstTaskBarPosition==="left"&&this.creatingDenpendencyLink.secondTaskBarPosition==="left"?Fn.StartToStart:this.creatingDenpendencyLink.firstTaskBarPosition==="right"&&this.creatingDenpendencyLink.secondTaskBarPosition==="left"?Fn.FinishToStart:this.creatingDenpendencyLink.firstTaskBarPosition==="right"&&this.creatingDenpendencyLink.secondTaskBarPosition==="right"?Fn.FinishToFinish:Fn.StartToFinish};return this._gantt.addLink(a),this.hideTaskBarSelectedBorder(),this._gantt.scenegraph.updateNextFrame(),this.creatingDenpendencyLink.creating=!1,a}dealCreateDependencyLine(t){const e=this.creatingDenpendencyLink.startX,i=this.creatingDenpendencyLink.startY,r=t.x-e,o=t.y-i,s=this.creatingDenpendencyLink.startClickedPoint,a=s.attribute.x+s.attribute.width/2,l=s.attribute.y+s.attribute.height/2;this._gantt.scenegraph.taskBar.updateCreatingDependencyLine(a,l,a+r,l+o),this._gantt.scenegraph.updateNextFrame()}startResizeTableWidth(t){this.resizeTableWidth.resizing=!0,this.resizeTableWidth.lastX=t.pageX}isResizingTableWidth(){return this.resizeTableWidth.resizing}endResizeTableWidth(){this.resizeTableWidth.resizing=!1}dealResizeTableWidth(t){var e,i;if(!this.resizeTableWidth.resizing)return;const r=t.pageX-this.resizeTableWidth.lastX;if(Math.abs(r)>=1){let o=this._gantt.taskTableWidth+r;const s=Math.min(this._gantt.taskListTableInstance.getAllColsWidth()+this._gantt.parsedOptions.outerFrameStyle.borderLineWidth,(e=this._gantt.options.taskListTable.maxTableWidth)!==null&&e!==void 0?e:1e5),a=Math.max(this._gantt.parsedOptions.outerFrameStyle.borderLineWidth,(i=this._gantt.options.taskListTable.minTableWidth)!==null&&i!==void 0?i:0);r>0&&o>s&&(o=s),r<0&&o<a&&(o=a),this._gantt.taskTableWidth=o,this._gantt.element.style.left=this._gantt.taskTableWidth?`${this._gantt.taskTableWidth}px`:"0px",this._gantt.verticalSplitResizeLine.style.left=this._gantt.taskTableWidth?this._gantt.taskTableWidth-7+"px":"0px",this._gantt._resize(),this.resizeTableWidth.lastX=t.pageX}}showTaskBarHover(){const t=this._gantt.stateManager.hoverTaskBar.target;if(t){const e=t.attribute.x,i=t.attribute.y,r=t.attribute.width,o=t.attribute.height;this._gantt.scenegraph.taskBar.showHoverBar(e,i,r,o,t),this._gantt.scenegraph.updateNextFrame()}}hideTaskBarHover(t){this._gantt.stateManager.hoverTaskBar.target=null,this._gantt.scenegraph.taskBar.hideHoverBar(),this._gantt.scenegraph.updateNextFrame()}showTaskBarSelectedBorder(t){var e;(e=this._gantt.stateManager.selectedTaskBar.target)===null||e===void 0||e.setAttribute("zIndex",0),this._gantt.stateManager.selectedTaskBar.target=t;const i=this._gantt.parsedOptions.dependencyLinkCreatable;t.setAttribute("zIndex",1e4);const r=t.attribute.x,o=t.attribute.y,s=t.attribute.width,a=t.attribute.height;this._gantt.scenegraph.taskBar.createSelectedBorder(r,o,s,a,t,i),this._gantt.scenegraph.updateNextFrame()}hideTaskBarSelectedBorder(){var t;(t=this._gantt.stateManager.selectedTaskBar.target)===null||t===void 0||t.setAttribute("zIndex",0),this._gantt.stateManager.selectedTaskBar.target=null,this._gantt.scenegraph.taskBar.removeSelectedBorder(),this._gantt.scenegraph.updateNextFrame()}showSecondTaskBarSelectedBorder(){const t=this._gantt.stateManager.creatingDenpendencyLink.secondTaskBarNode,e=t.attribute.x,i=t.attribute.y,r=t.attribute.width,o=t.attribute.height;this._gantt.scenegraph.taskBar.createSelectedBorder(e,i,r,o,t,!0),this._gantt.scenegraph.updateNextFrame()}hideSecondTaskBarSelectedBorder(){this._gantt.stateManager.creatingDenpendencyLink.secondTaskBarNode=null,this._gantt.scenegraph.taskBar.removeSecondSelectedBorder(),this._gantt.scenegraph.updateNextFrame()}showDependencyLinkSelectedLine(){const t=this._gantt.stateManager.selectedDenpendencyLink.link;this._gantt.scenegraph.dependencyLink.createSelectedLinkLine(t);const{taskKeyField:e,dependencyLinks:i}=this._gantt.parsedOptions,{linkedToTaskKey:r,linkedFromTaskKey:o,type:s}=t;let a,l,h,u;const d=Po(this._gantt.records,e,r),c=Po(this._gantt.records,e,o);this._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Inline||this._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Separate||this._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||this._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact?(a=c.index[0],l=c.index[1],h=d.index[0],u=d.index[1]):(a=this._gantt.getTaskShowIndexByRecordIndex(c.index),h=this._gantt.getTaskShowIndexByRecordIndex(d.index));const g=this._gantt.scenegraph.taskBar.getTaskBarNodeByIndex(a,l);this._gantt.scenegraph.taskBar.createSelectedBorder(g.attribute.x,g.attribute.y,g.attribute.width,g.attribute.height,g,!1);const f=this._gantt.scenegraph.taskBar.getTaskBarNodeByIndex(h,u);this._gantt.scenegraph.taskBar.createSelectedBorder(f.attribute.x,f.attribute.y,f.attribute.width,f.attribute.height,f,!1),this._gantt.scenegraph.updateNextFrame()}hideDependencyLinkSelectedLine(){this._gantt.stateManager.selectedDenpendencyLink.link=null,this._gantt.scenegraph.dependencyLink.removeSelectedLinkLine(),this._gantt.scenegraph.taskBar.removeSelectedBorder(),this._gantt.scenegraph.updateNextFrame()}highlightLinkPointNode(t){if(t?.children.length>0){const e=t.children[0];e.setAttribute("fill",this._gantt.parsedOptions.dependencyLinkLineCreatingPointStyle.fillColor),e.setAttribute("stroke",this._gantt.parsedOptions.dependencyLinkLineCreatingPointStyle.strokeColor),e.setAttribute("radius",this._gantt.parsedOptions.dependencyLinkLineCreatingPointStyle.radius),e.setAttribute("lineWidth",this._gantt.parsedOptions.dependencyLinkLineCreatingPointStyle.strokeWidth),this._gantt.scenegraph.updateNextFrame()}}unhighlightLinkPointNode(t){if(t?.children.length>0){const e=t.children[0];e.setAttribute("fill",this._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.fillColor),e.setAttribute("stroke",this._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeColor),e.setAttribute("radius",this._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.radius),e.setAttribute("lineWidth",this._gantt.parsedOptions.dependencyLinkLineCreatePointStyle.strokeWidth),this._gantt.scenegraph.updateNextFrame()}}showMarklineIconHover(){var t,e;const i=this._gantt.stateManager.marklineIcon.target;if(i){const r=this._gantt.scenegraph.timelineHeader.showMarklineIcon(i.parent);r&&(!((e=(t=this._gantt.parsedOptions.markLineCreateOptions)===null||t===void 0?void 0:t.markLineCreationHoverToolTip)===null||e===void 0)&&e.tipContent)&&this._gantt.scenegraph.showToolTip(r),this._gantt.scenegraph.updateNextFrame()}}hideMarklineIconHover(){this._gantt.scenegraph.timelineHeader.hideMarklineIconHover(this._gantt.stateManager.marklineIcon.target.parent),this._gantt.scenegraph.hideToolTip(),this._gantt.stateManager.marklineIcon.target=null,this._gantt.scenegraph.updateNextFrame()}updateProjectTaskTimes(t){var e,i;if(!t||t.length===0||!this._gantt||!this._gantt.records)return;const r=this._gantt.parsedOptions.startDateField,o=this._gantt.parsedOptions.endDateField,s=[...t];for(;s.length>0;){const a=[...s],l=a.pop();let h=this._gantt.records;for(const d of a){if(!h[d]||!h[d].children)return;h=h[d].children}const u=a.length===0?this._gantt.records[l]:h[l];if(u&&u.type===se.PROJECT&&u.children&&u.children.length>0){let d=null,c=null;for(const g of u.children)if(g[r]&&g[o]){const f=new Date(g[r]),p=new Date(g[o]);(!d||f<d)&&(d=f),(!c||p>c)&&(c=p)}if(d&&c){const g=u[r]?new Date(u[r]):null,f=u[o]?new Date(u[o]):null;if(!g||!f||d.getTime()!==g.getTime()||c.getTime()!==f.getTime()){const p=(e=this._gantt.parsedOptions.dateFormat)!==null&&e!==void 0?e:this._gantt.parseTimeFormat(u[r]||u.children[0][r]),m=v=>this._gantt.formatDate?this._gantt.formatDate(v,p):v.toISOString().split("T")[0];u[r]=m(d),u[o]=m(c)}}}s.pop()}(i=this._gantt.scenegraph)===null||i===void 0||i.refreshAll()}}function uz(n,t,e,i){const r=n.parsedOptions.taskBarCustomLayout;if(r){let o;if(typeof r=="function"){const{startDate:s,endDate:a,taskDays:l,progress:h,taskRecord:u}=n.getTaskInfoByTaskListIndex(e,i);o=r({width:t.attribute.width,height:t.attribute.height,index:e,startDate:s,endDate:a,taskDays:l,progress:h,taskRecord:u,ganttInstance:n})}else o=r;if(o){const s=o.rootContainer;s.name="task-bar-custom-render";const a=t.children.find((l=>l.name==="task-bar-group"));if(a){const l=a.children.findIndex((u=>u.name==="task-bar-custom-render")),h=a.children[l];h&&(a.removeChild(h),a.insertInto(s,l))}}}}function ch(n,t,e,i){const r=n.task_index,o=n.sub_task_index,s=n.record.type===se.MILESTONE,a=n.attribute.x,l=n.attribute.y;if(t&&n.setAttribute("x",Math.max(0,n.attribute.x+t)),i._gantt.parsedOptions.tasksShowMode!==ft.Tasks_Separate&&i._gantt.parsedOptions.tasksShowMode!==ft.Project_Sub_Tasks_Inline?e&&n.setAttribute("y",n.attribute.y+e):e=0,s&&(n.setAttribute("anchor",[n.attribute.x+n.attribute.width/2,n.attribute.y+n.attribute.height/2]),n.milestoneTextContainer)){const h=n.attribute.x-a,u=n.attribute.y-l,d=n.milestoneTextContainer.attribute.x,c=n.milestoneTextContainer.attribute.y;n.milestoneTextContainer.setAttribute("x",d+h),n.milestoneTextContainer.setAttribute("y",c+u)}n.updateTextPosition(),i._gantt.scenegraph.refreshRecordLinkNodes(r,o,n,e)}function npt(n,t,e,i){const r=i._gantt.parsedOptions.progressField,o=n.clipGroupBox,s=n.barRect,a=n.progressRect,l=n.textLabel,h=n.task_index,u=n.sub_task_index,d=n.record,c=d[r],g=d.type===se.MILESTONE;if(n.setAttribute("zIndex",1e4),t&&n.setAttribute("x",n.attribute.x+t),g&&n.setAttribute("anchor",[n.attribute.x+n.attribute.width/2,n.attribute.y+n.attribute.height/2]),e&&n.setAttribute("width",e),o.setAttribute("width",n.attribute.width),s?.setAttribute("width",n.attribute.width),a?.setAttribute("width",c/100*n.attribute.width),l){const{textAlign:f,textBaseline:p,padding:m}=i._gantt.parsedOptions.taskBarLabelStyle,v=mg(pg(m),f,p,e,n.attribute.height);l.setAttribute("maxLineWidth",e-2*oz),l.setAttribute("x",v.x)}n.updateTextPosition(),i.showTaskBarHover(),uz(i._gantt,n,h,u),i._gantt.scenegraph.refreshRecordLinkNodes(h,u,n,0)}let rpt=1,opt=class{constructor(){this.listenersData={listeners:{},listenerData:{}}}on(t,e){const i=this.listenersData.listeners[t]||(this.listenersData.listeners[t]=[]);i.push(e);const r=rpt++;return this.listenersData.listenerData[r]={type:t,listener:e,remove:()=>{delete this.listenersData.listenerData[r];const o=i.indexOf(e);i.splice(o,1),this.listenersData.listeners[t].length||delete this.listenersData.listeners[t]}},r}off(t,e){var i;if(e){const r=t;this.removeEventListener(r,e)}else{const r=t;if(!this.listenersData)return;(i=this.listenersData.listenerData[r])===null||i===void 0||i.remove()}}addEventListener(t,e,i){this.on(t,e)}removeEventListener(t,e){if(this.listenersData)for(const i in this.listenersData.listenerData){const r=this.listenersData.listenerData[i];r.type===t&&r.listener===e&&this.off(i)}}hasListeners(t){return!!this.listenersData&&!!this.listenersData.listeners[t]}fireListeners(t,e){if(!this.listenersData)return[];const i=this.listenersData.listeners[t];return i?i.map((r=>r.call(this,e))).filter((r=>$(r))):[]}release(){delete this.listenersData}};class spt{constructor(t){this._gantt=t,this.records=t.records,this.processRecords()}processRecords(){const t=!this._gantt.options.minDate,e=!this._gantt.options.maxDate;let i=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;if((t||e||this._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Inline||this._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact)&&this.records.length){for(let l=0;l<this.records.length;l++){const h=this.records[l];if(t&&h[this._gantt.parsedOptions.startDateField]){const u=Ye(h[this._gantt.parsedOptions.startDateField]);i=Math.min(i,u.getTime())}if(e&&h[this._gantt.parsedOptions.endDateField]){const u=Ye(h[this._gantt.parsedOptions.endDateField]);r=Math.max(r,u.getTime())}this._gantt.parsedOptions.tasksShowMode!==ft.Sub_Tasks_Inline&&this._gantt.parsedOptions.tasksShowMode!==ft.Sub_Tasks_Compact||h.children&&h.children.sort(((u,d)=>Ye(u[this._gantt.parsedOptions.startDateField]).getTime()-Ye(d[this._gantt.parsedOptions.startDateField]).getTime()))}const{unit:o,startOfWeek:s,step:a}=this._gantt.parsedOptions.reverseSortedTimelineScales[0];t&&(this._gantt.parsedOptions.minDate=Nl(new Date(i),o,s),this._gantt.parsedOptions._minDateTime=this._gantt.parsedOptions.minDate.getTime()),t&&!e&&(this._gantt.parsedOptions.maxDate=Tu(this._gantt.parsedOptions.minDate,new Date(this._gantt.options.maxDate),o,a),this._gantt.parsedOptions._maxDateTime=this._gantt.parsedOptions.maxDate.getTime()),e&&(this._gantt.parsedOptions.maxDate=Tu(this._gantt.parsedOptions.minDate,new Date(r),o,a),this._gantt.parsedOptions._maxDateTime=this._gantt.parsedOptions.maxDate.getTime())}}adjustOrder(t,e,i,r){var o,s,a,l;if(this._gantt.parsedOptions.tasksShowMode!==ft.Sub_Tasks_Arrange&&this._gantt.parsedOptions.tasksShowMode!==ft.Sub_Tasks_Compact||t!==i){if(this._gantt.parsedOptions.tasksShowMode===ft.Sub_Tasks_Inline){if($(e)&&$(r)&&$(t)&&$(i)){const h=this.records[t].children[e];this.records[t].children.splice(e,1),this.records[i].children||(this.records[i].children=[]),this.records[i].children.splice(r,0,h)}(s=(o=this.records[i])===null||o===void 0?void 0:o.children)===null||s===void 0||s.sort(((h,u)=>Ye(h[this._gantt.parsedOptions.startDateField]).getTime()-Ye(u[this._gantt.parsedOptions.startDateField]).getTime()))}else if(this._gantt.parsedOptions.tasksShowMode===ft.Project_Sub_Tasks_Inline){if($(e)&&$(r)&&$(t)&&$(i)){this.records[t].type,se.PROJECT;const h=this.records[i].type===se.PROJECT,u=this.records[t].children[e];this.records[t].children.splice(e,1),this.records[i].children||(this.records[i].children=[]),this.records[i].children.splice(r,0,u),h&&((l=(a=this.records[i])===null||a===void 0?void 0:a.children)===null||l===void 0||l.sort(((d,c)=>Ye(d[this._gantt.parsedOptions.startDateField]).getTime()-Ye(c[this._gantt.parsedOptions.startDateField]).getTime())))}}else if($(e)&&$(r)&&$(t)&&$(i)){const h=this.records[t].children[e];this.records[t].children.splice(e,1),this.records[i].children||(this.records[i].children=[]),this.records[i].children.splice(r,0,h)}}}setRecords(t){this.records=t,this.processRecords()}}class apt{constructor(t,e){var i;this.plugins=new Map,this.gantt=t,(i=e.plugins)===null||i===void 0||i.forEach((r=>{this.register(r),this._initializePluginRun(r)}))}_initializePluginRun(t){if(t.runTime===void 0)try{t.run(this.gantt)}catch{}else this._bindGanttEventForPlugin(t)}register(t){this.plugins.set(t.id,t)}registerAll(t){t.forEach((e=>this.register(e)))}getPlugin(t){return this.plugins.get(t)}getPluginByName(t){return Array.from(this.plugins.values()).find((e=>e.name===t))}_bindGanttEventForPlugin(t){t.runTime&&t.runTime.forEach((e=>{this.gantt.on(e,((...i)=>{var r;try{(r=t.run)===null||r===void 0||r.call(t,...i,e,this.gantt)}catch{}}))}))}updatePlugins(t){Array.from(this.plugins.values()).filter((i=>!t?.some((r=>r.id===i.id)))).forEach((i=>{this.release(),this.plugins.delete(i.id)})),this.plugins.forEach((i=>{i.update&&i.update()}));const e=t?.filter((i=>!this.plugins.has(i.id)));e?.forEach((i=>{this.register(i),this._initializePluginRun(i)}))}release(){this.plugins.forEach((t=>{var e;try{(e=t.release)===null||e===void 0||e.call(t,this.gantt)}catch{}}))}}function lpt(n,t="vtable-gantt"){var e,i;const r=document.createElement("div");r.setAttribute("tabindex","0"),r.classList.add(t),r.style.outline="none",r.style.margin=`${n.top}px ${n.right}px ${n.bottom}px ${n.left}px`;const o=(r.offsetWidth||((e=r.parentElement)===null||e===void 0?void 0:e.offsetWidth)||1)-1,s=(r.offsetHeight||((i=r.parentElement)===null||i===void 0?void 0:i.offsetHeight)||1)-1;return r.style.width=o&&o-n.left-n.right+"px"||"0px",r.style.height=s&&s-n.top-n.bottom+"px"||"0px",r}class hpt extends opt{constructor(t,e){var i,r,o,s,a;super(),this.parsedOptions={},this.container=t,this.options=e,this.taskTableWidth=typeof((i=e?.taskListTable)===null||i===void 0?void 0:i.tableWidth)=="number"?(r=e?.taskListTable)===null||r===void 0?void 0:r.tableWidth:-1,this.taskTableColumns=(s=(o=e?.taskListTable)===null||o===void 0?void 0:o.columns)!==null&&s!==void 0?s:[],this.records=(a=e?.records)!==null&&a!==void 0?a:[],this._sortScales(),CB(this),nrt(this),this.data=new spt(this),this._generateTimeLineDateMap(),this.timeLineHeaderLevel=this.parsedOptions.sortedTimelineScales.length,this.element=lpt({top:0,right:0,left:0,bottom:0},"vtable-gantt"),this.element.style.left=this.taskTableWidth!==-1?`${this.taskTableWidth}px`:"0px",this.canvas=document.createElement("canvas"),this.element.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),t?(t.appendChild(this.element),this._updateSize()):this._updateSize(),this._generateListTable(),this._syncPropsFromTable(),qnt(this),this.scenegraph=new zft(this),this.stateManager=new ipt(this),this.eventManager=new Xft(this),this.scenegraph.afterCreateSceneGraph(),this._scrollToMarkLine(),this.pluginManager=new apt(this,e)}renderTaskBarsTable(){this.scenegraph.updateNextFrame()}_updateSize(){var t,e,i,r,o,s,a,l,h;let u=0,d=0;if(Sr.mode==="browser"){const f=this.getElement();let p=0,m=0;if(f.parentElement){const C=f.parentElement.style||window.getComputedStyle(f.parentElement);p=f.parentElement.offsetWidth-parseInt(C.paddingLeft||"0px",10)-parseInt(C.paddingRight||"0px",10),m=f.parentElement.offsetHeight-parseInt(C.paddingTop||"0px",10)-parseInt(C.paddingBottom||"0px",20)}const v=(p??1)-1-this.taskTableWidth,b=(m??1)-1;f.style.width=v&&`${v}px`||"0px",f.style.height=b&&`${b}px`||"0px";const{canvas:y}=this;u=(e=(t=y.parentElement)===null||t===void 0?void 0:t.offsetWidth)!==null&&e!==void 0?e:1,d=(r=(i=y.parentElement)===null||i===void 0?void 0:i.offsetHeight)!==null&&r!==void 0?r:1,!((o=this==null?void 0:this.scenegraph)===null||o===void 0)&&o.stage?this.scenegraph.stage.resize(u,d):(y.style.width="",y.style.height="",y.width=u,y.height=d,y.style.width=`${u}px`,y.style.height=`${d}px`)}else Sr.mode;const c=Math.floor(u-$nt(this.parsedOptions.scrollStyle)),g=Math.floor(d-Gnt(this.parsedOptions.scrollStyle));if(this.tableNoFrameWidth=u,this.tableNoFrameHeight=Math.floor(d),this.parsedOptions.outerFrameStyle){const[f,p,m,v]=Ur((a=(s=this.parsedOptions.outerFrameStyle)===null||s===void 0?void 0:s.borderLineWidth)!==null&&a!==void 0?a:0);this.tableX=this.taskTableColumns.length>=1||!((l=this.options)===null||l===void 0)&&l.rowSeriesNumber?(h=this.parsedOptions.verticalSplitLine.lineWidth)!==null&&h!==void 0?h:0:v,this.tableY=f,this.tableNoFrameWidth=Math.min(c-p-this.tableX,this.getAllDateColsWidth()),this.tableNoFrameHeight=g-f-m}}_updateListTableSize(t){var e,i,r,o,s,a,l,h,u,d,c,g;if(t){if(((i=(e=this.options)===null||e===void 0?void 0:e.taskListTable)===null||i===void 0?void 0:i.tableWidth)==="auto"||this.taskTableWidth===-1){const[f,p,m]=Ur((o=(r=this.parsedOptions.outerFrameStyle)===null||r===void 0?void 0:r.borderLineWidth)!==null&&o!==void 0?o:0);this.taskTableWidth=t.getAllColsWidth()+p,!((a=(s=this.options)===null||s===void 0?void 0:s.taskListTable)===null||a===void 0)&&a.maxTableWidth&&(this.taskTableWidth=Math.min((h=(l=this.options)===null||l===void 0?void 0:l.taskListTable)===null||h===void 0?void 0:h.maxTableWidth,this.taskTableWidth)),!((d=(u=this.options)===null||u===void 0?void 0:u.taskListTable)===null||d===void 0)&&d.minTableWidth&&(this.taskTableWidth=Math.max((g=(c=this.options)===null||c===void 0?void 0:c.taskListTable)===null||g===void 0?void 0:g.minTableWidth,this.taskTableWidth)),this.element.style.left=this.taskTableWidth!==-1?`${this.taskTableWidth}px`:"0px",t.setCanvasSize(this.taskTableWidth,this.tableNoFrameHeight+f+m),this._updateSize()}if(t.columnHeaderLevelCount>1)if(t.columnHeaderLevelCount===this.parsedOptions.timeLineHeaderRowHeights.length)for(let f=0;f<t.columnHeaderLevelCount;f++)t.setRowHeight(f,this.parsedOptions.timeLineHeaderRowHeights[f]);else{const f=this.getAllHeaderRowsHeight()/t.columnHeaderLevelCount;for(let p=0;p<t.columnHeaderLevelCount;p++)t.setRowHeight(p,f)}}}_generateListTable(){var t;if(this.taskTableColumns.length>=1||!((t=this.options)===null||t===void 0)&&t.rowSeriesNumber){const e=this._generateListTableOptions();this.taskListTableInstance=new Rft(this.container,e),this._updateListTableSize(this.taskListTableInstance)}}_generateListTableOptions(){var t,e,i,r,o,s,a,l,h,u,d,c,g,f,p,m,v,b,y,C,w,_,A,x,S,T,M,R,E,P,B,k,L,O,I,H,D,z,G,U,j,X,Z,J,q,st,Q,ot,nt,F,N,W,V,K;const et={},it=["container","records","rowSeriesNumber","overscrollBehavior","pixelRatio","eventOptions"];for(const rt of it)rt in this.options&&(et[rt]=this.options[rt]);if(et.defaultRowHeight=this.options.rowHeight,this.options.taskListTable)for(const rt in this.options.taskListTable){if(et[rt]=this.options.taskListTable[rt],rt==="columns"&&(et[rt][et[rt].length-1].disableColumnResize=!0,this.parsedOptions.tasksShowMode===ft.Sub_Tasks_Inline||this.parsedOptions.tasksShowMode===ft.Sub_Tasks_Separate||this.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange||this.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact))for(let lt=0;lt<et.columns.length;lt++)et.columns[lt].tree&&(et.columns[lt].tree=!1);rt!=="hierarchyExpandLevel"||this.parsedOptions.tasksShowMode!==ft.Sub_Tasks_Inline&&this.parsedOptions.tasksShowMode!==ft.Sub_Tasks_Separate&&this.parsedOptions.tasksShowMode!==ft.Sub_Tasks_Arrange&&this.parsedOptions.tasksShowMode!==ft.Sub_Tasks_Compact||delete et[rt]}if(!((t=this.options.taskListTable)===null||t===void 0)&&t.theme)if(et.theme=(e=this.options.taskListTable)===null||e===void 0?void 0:e.theme,et.theme.bodyStyle&&!pnt(et.theme,"bodyStyle")){et.theme=((i=this.options.taskListTable)===null||i===void 0?void 0:i.theme).extends(((r=this.options.taskListTable)===null||r===void 0?void 0:r.theme).getExtendTheme());const rt=et.theme.getExtendTheme();et.theme.clearBodyStyleCache(),!((o=et.theme.headerStyle)===null||o===void 0)&&o.bgColor||(rt.headerStyle?rt.headerStyle.bgColor||(rt.headerStyle.bgColor=this.parsedOptions.timelineHeaderBackgroundColor):rt.headerStyle={bgColor:this.parsedOptions.timelineHeaderBackgroundColor}),rt.bodyStyle?rt.bodyStyle.frameStyle={borderLineWidth:[(a=(s=this.parsedOptions.horizontalSplitLine)===null||s===void 0?void 0:s.lineWidth)!==null&&a!==void 0?a:0,0,0,0],borderColor:(l=this.parsedOptions.horizontalSplitLine)===null||l===void 0?void 0:l.lineColor}:rt.bodyStyle={frameStyle:{borderLineWidth:[(u=(h=this.parsedOptions.horizontalSplitLine)===null||h===void 0?void 0:h.lineWidth)!==null&&u!==void 0?u:0,0,0,0],borderColor:(d=this.parsedOptions.horizontalSplitLine)===null||d===void 0?void 0:d.lineColor}},rt.cellInnerBorder=!1;const[lt,ct,ut,gt]=Ur((g=(c=this.parsedOptions.outerFrameStyle)===null||c===void 0?void 0:c.borderLineWidth)!==null&&g!==void 0?g:0);rt.frameStyle=Object.assign({},this.parsedOptions.outerFrameStyle,{shadowBlur:0,cornerRadius:[(p=(f=this.parsedOptions.outerFrameStyle)===null||f===void 0?void 0:f.cornerRadius)!==null&&p!==void 0?p:0,0,0,(v=(m=this.parsedOptions.outerFrameStyle)===null||m===void 0?void 0:m.cornerRadius)!==null&&v!==void 0?v:0],borderLineWidth:[lt,0,ut,gt]}),rt.scrollStyle=Object.assign({},(y=(b=this.options.taskListTable)===null||b===void 0?void 0:b.theme)===null||y===void 0?void 0:y.scrollStyle,this.parsedOptions.scrollStyle,{verticalVisible:"none"}),rt.columnResize=Object.assign({labelColor:"rgba(0,0,0,0)",labelBackgroundFill:"rgba(0,0,0,0)"},rt?.columnResize),rt.underlayBackgroundColor||(rt.underlayBackgroundColor=this.parsedOptions.underlayBackgroundColor)}else{et.theme.headerStyle?et.theme.headerStyle.bgColor||(et.theme.headerStyle.bgColor=this.parsedOptions.timelineHeaderBackgroundColor):et.theme.headerStyle={bgColor:this.parsedOptions.timelineHeaderBackgroundColor},et.theme.headerStyle=Object.assign({},xh.headerStyle,{bgColor:this.parsedOptions.timelineHeaderBackgroundColor},(w=(C=this.options.taskListTable)===null||C===void 0?void 0:C.theme)===null||w===void 0?void 0:w.headerStyle),et.theme.bodyStyle=Object.assign({},xh.bodyStyle,(A=(_=this.options.taskListTable)===null||_===void 0?void 0:_.theme)===null||A===void 0?void 0:A.bodyStyle,{frameStyle:{borderLineWidth:[(S=(x=this.parsedOptions.horizontalSplitLine)===null||x===void 0?void 0:x.lineWidth)!==null&&S!==void 0?S:0,0,0,0],borderColor:(T=this.parsedOptions.horizontalSplitLine)===null||T===void 0?void 0:T.lineColor}}),et.theme.cellInnerBorder=!1;const[rt,lt,ct,ut]=Ur((R=(M=this.parsedOptions.outerFrameStyle)===null||M===void 0?void 0:M.borderLineWidth)!==null&&R!==void 0?R:0);et.theme.frameStyle=Object.assign({},this.parsedOptions.outerFrameStyle,{cornerRadius:[(P=(E=this.parsedOptions.outerFrameStyle)===null||E===void 0?void 0:E.cornerRadius)!==null&&P!==void 0?P:0,0,0,(k=(B=this.parsedOptions.outerFrameStyle)===null||B===void 0?void 0:B.cornerRadius)!==null&&k!==void 0?k:0],borderLineWidth:[rt,0,ct,ut]}),et.theme.scrollStyle=Object.assign({},(O=(L=this.options.taskListTable)===null||L===void 0?void 0:L.theme)===null||O===void 0?void 0:O.scrollStyle,this.parsedOptions.scrollStyle,{verticalVisible:"none"}),et.theme.columnResize=Object.assign({labelColor:"rgba(0,0,0,0)",labelBackgroundFill:"rgba(0,0,0,0)"},(H=(I=this.options.taskListTable)===null||I===void 0?void 0:I.theme)===null||H===void 0?void 0:H.columnResize),et.theme.underlayBackgroundColor||(et.theme.underlayBackgroundColor=this.parsedOptions.underlayBackgroundColor)}else{const[rt,lt,ct,ut]=Ur((z=(D=this.parsedOptions.outerFrameStyle)===null||D===void 0?void 0:D.borderLineWidth)!==null&&z!==void 0?z:0);et.theme={scrollStyle:Object.assign({},(U=(G=this.options.taskListTable)===null||G===void 0?void 0:G.theme)===null||U===void 0?void 0:U.scrollStyle,this.parsedOptions.scrollStyle,{verticalVisible:"none"}),headerStyle:Object.assign({},xh.headerStyle,{bgColor:this.parsedOptions.timelineHeaderBackgroundColor},(X=(j=this.options.taskListTable)===null||j===void 0?void 0:j.theme)===null||X===void 0?void 0:X.headerStyle),bodyStyle:Object.assign({},xh.bodyStyle,(J=(Z=this.options.taskListTable)===null||Z===void 0?void 0:Z.theme)===null||J===void 0?void 0:J.bodyStyle,{frameStyle:{borderLineWidth:[(st=(q=this.parsedOptions.horizontalSplitLine)===null||q===void 0?void 0:q.lineWidth)!==null&&st!==void 0?st:0,0,0,0],borderColor:(Q=this.parsedOptions.horizontalSplitLine)===null||Q===void 0?void 0:Q.lineColor}}),cellInnerBorder:!1,frameStyle:Object.assign({},this.parsedOptions.outerFrameStyle,{cornerRadius:[(nt=(ot=this.parsedOptions.outerFrameStyle)===null||ot===void 0?void 0:ot.cornerRadius)!==null&&nt!==void 0?nt:0,0,0,(N=(F=this.parsedOptions.outerFrameStyle)===null||F===void 0?void 0:F.cornerRadius)!==null&&N!==void 0?N:0],borderLineWidth:[rt,0,ct,ut]}),columnResize:Object.assign({labelColor:"rgba(0,0,0,0)",labelBackgroundFill:"rgba(0,0,0,0)"},(V=(W=this.options.taskListTable)===null||W===void 0?void 0:W.theme)===null||V===void 0?void 0:V.columnResize),underlayBackgroundColor:this.parsedOptions.underlayBackgroundColor}}return et.canvasWidth=this.taskTableWidth,et.canvasHeight=this.canvas.height,et.defaultHeaderRowHeight=this.getAllHeaderRowsHeight(),this.parsedOptions.tasksShowMode===ft.Sub_Tasks_Separate?(et.customComputeRowHeight=rt=>{var lt;const{row:ct,table:ut}=rt,gt=ut.getRecordByRowCol(0,ct);if(gt)return(((lt=gt.children)===null||lt===void 0?void 0:lt.length)||1)*this.parsedOptions.rowHeight},et.defaultRowHeight="auto",et.customConfig={forceComputeAllRowHeight:!0}):this.parsedOptions.tasksShowMode===ft.Sub_Tasks_Compact?(et.customComputeRowHeight=rt=>{const{row:lt,table:ct}=rt,ut=ct.getRecordByRowCol(0,lt);if(ut)return Knt(this,ut)*this.parsedOptions.rowHeight},et.defaultRowHeight="auto",et.customConfig={forceComputeAllRowHeight:!0}):this.parsedOptions.tasksShowMode===ft.Sub_Tasks_Arrange?(et.customComputeRowHeight=rt=>{const{row:lt,table:ct}=rt,ut=ct.getRecordByRowCol(0,lt);if(ut)return Jnt(this,ut)*this.parsedOptions.rowHeight},et.defaultRowHeight="auto",et.customConfig={forceComputeAllRowHeight:!0}):et.defaultRowHeight=(K=this.options.rowHeight)!==null&&K!==void 0?K:40,et.clearDOM=!1,et}getElement(){return this.element}getContainer(){return this.element.parentElement}_sortScales(){const{timelineHeader:t}=this.options;if(t){const e=t.scales,i=["year","quarter","month","week","day","hour","minute","second"];e.length===1&&(e[0].unit!=="hour"&&e[0].unit!=="minute"&&e[0].unit!=="second"||(this.parsedOptions.timeScaleIncludeHour=!0));const r=e.slice().sort(((s,a)=>{s.unit!=="hour"&&s.unit!=="minute"&&s.unit!=="second"||(this.parsedOptions.timeScaleIncludeHour=!0);const l=i.indexOf(s.unit),h=i.indexOf(a.unit);return l===-1?1:h===-1?-1:l-h})),o=e.slice().sort(((s,a)=>{const l=i.indexOf(s.unit),h=i.indexOf(a.unit);return l===-1?1:h===-1?-1:h-l}));this.parsedOptions.sortedTimelineScales=r,this.parsedOptions.reverseSortedTimelineScales=o}}_generateTimeLineDateMap(){if(this.parsedOptions.minDate&&this.parsedOptions.maxDate)for(const t of this.parsedOptions.reverseSortedTimelineScales)t.timelineDates=Xnt(new Date(this.parsedOptions.minDate),this.parsedOptions.maxDate,t)}getRowHeightByIndex(t){return this.taskListTableInstance?this.taskListTableInstance.getRowHeight(t+this.taskListTableInstance.columnHeaderLevelCount):this.parsedOptions.rowHeight}getRowsHeightByIndex(t,e){return this.taskListTableInstance?this.taskListTableInstance.getRowsHeight(t+this.taskListTableInstance.columnHeaderLevelCount,e+this.taskListTableInstance.columnHeaderLevelCount):this.parsedOptions.rowHeight*(e-t+1)}getAllRowsHeight(){return this.taskListTableInstance?this.taskListTableInstance.getAllRowsHeight():this.getAllHeaderRowsHeight()+this.itemCount*this.parsedOptions.rowHeight}getAllHeaderRowsHeight(){return this.parsedOptions.timeLineHeaderRowHeights.reduce(((t,e,i)=>this.parsedOptions.sortedTimelineScales[i].visible===!1?t:t+e),0)}getAllDateColsWidth(){var t,e;return this.parsedOptions.timelineColWidth*((e=(t=this.parsedOptions.reverseSortedTimelineScales[0].timelineDates)===null||t===void 0?void 0:t.length)!==null&&e!==void 0?e:0)}getAllTaskBarsHeight(){return this.taskListTableInstance?this.taskListTableInstance.getRowsHeight(this.taskListTableInstance.columnHeaderLevelCount,this.taskListTableInstance.rowCount-1):this.itemCount*this.parsedOptions.rowHeight}getRecordIndexByTaskShowIndex(t){return this.taskListTableInstance?this.taskListTableInstance.getRecordIndexByCell(0,this.taskListTableInstance.columnHeaderLevelCount+t):t}getTaskShowIndexByRecordIndex(t){return this.taskListTableInstance.getBodyRowIndexByRecordIndex(t)}getRecordByIndex(t,e){var i,r;if(this.taskListTableInstance){if($(e)){const o=this.taskListTableInstance.getRecordByCell(0,t+this.taskListTableInstance.columnHeaderLevelCount);if(Array.isArray(e)){const s=this.getRecordIndexByTaskShowIndex(t),a=Array.isArray(s)?s.length:1,l=[...e];l.splice(0,a);let h=o;for(;l.length>0;){const u=l.shift();h=(i=h?.children)===null||i===void 0?void 0:i[u]}return h}return(r=o?.children)===null||r===void 0?void 0:r[e]}return this.taskListTableInstance.getRecordByCell(0,t+this.taskListTableInstance.columnHeaderLevelCount)}return this.records[t]}_refreshTaskBar(t,e){this.scenegraph.taskBar.updateTaskBarNode(t,e),this.scenegraph.refreshRecordLinkNodes(t,void 0,this.scenegraph.taskBar.getTaskBarNodeByIndex(t,e)),this.scenegraph.updateNextFrame()}_updateRecordToListTable(t,e){this.taskListTableInstance.updateRecords([t],[e])}getTaskInfoByTaskListIndex(t,e){const i=this.getRecordByIndex(t,e),r=i?.type,o=this.parsedOptions.startDateField,s=this.parsedOptions.endDateField,a=this.parsedOptions.progressField,l=Ye(i?.[o]).getTime(),h=Ye(i?.[s]).getTime();if(r&&!i?.[o]||!r&&(h<this.parsedOptions._minDateTime||l>this.parsedOptions._maxDateTime||!i?.[o]||!i?.[s]))return{taskDays:0,progress:0,startDate:null,endDate:null,taskRecord:i};const u=Ynt(i[a]);let d,c;return this.parsedOptions.timeScaleIncludeHour?(d=Ye(Math.min(Math.max(this.parsedOptions._minDateTime,l),this.parsedOptions._maxDateTime)),c=lD(Math.max(Math.min(this.parsedOptions._maxDateTime,h),this.parsedOptions._minDateTime),!0)):(d=Ye(Math.min(Math.max(this.parsedOptions._minDateTime,l),this.parsedOptions._maxDateTime),!0),c=Ks(Math.max(Math.min(this.parsedOptions._maxDateTime,h),this.parsedOptions._minDateTime),!0)),{taskRecord:i,taskDays:(c.getTime()-d.getTime()+1)/864e5,startDate:d,endDate:c,progress:u}}_updateStartDateToTaskRecord(t,e,i){var r;const o=this.getRecordByIndex(e,i),s=this.parsedOptions.startDateField,a=(r=this.parsedOptions.dateFormat)!==null&&r!==void 0?r:pf(o[s]),l=fs(t,a);if(o[s]=l,$(i))Array.isArray(i)&&this.stateManager.updateProjectTaskTimes(i);else{const h=this.getRecordIndexByTaskShowIndex(e);this._updateRecordToListTable(o,h),Array.isArray(h)&&this.stateManager.updateProjectTaskTimes(h)}}_updateEndDateToTaskRecord(t,e,i){var r;const o=this.getRecordByIndex(e,i),s=this.parsedOptions.endDateField,a=(r=this.parsedOptions.dateFormat)!==null&&r!==void 0?r:pf(o[s]),l=fs(t,a);if(o[s]=l,$(i))Array.isArray(i)&&this.stateManager.updateProjectTaskTimes(i);else{const h=this.getRecordIndexByTaskShowIndex(e);this._updateRecordToListTable(o,h),Array.isArray(h)&&this.stateManager.updateProjectTaskTimes(h)}}_updateStartEndDateToTaskRecord(t,e,i,r){var o;const s=this.getRecordByIndex(i,r),a=this.parsedOptions.startDateField,l=this.parsedOptions.endDateField,h=(o=this.parsedOptions.dateFormat)!==null&&o!==void 0?o:pf(s[a]),u=fs(t,h);s[a]=u;const d=fs(e,h);if(s[l]=d,$(r))Array.isArray(r)&&this.stateManager.updateProjectTaskTimes(r);else{const c=this.getRecordIndexByTaskShowIndex(i);this._updateRecordToListTable(s,c),Array.isArray(c)&&this.stateManager.updateProjectTaskTimes(c)}}_updateProgressToTaskRecord(t,e,i){const r=this.getRecordByIndex(e,i),o=this.parsedOptions.progressField;if(o){r[o]=t;const s=this.getRecordIndexByTaskShowIndex(e);this._updateRecordToListTable(r,s),this._refreshTaskBar(e,i)}}_dragOrderTaskRecord(t,e,i,r){this.data.adjustOrder(t,e,i,r)}updateTaskRecord(t,e,i){if($(i)){const o=typeof e=="number"?e:e[0];return this._updateRecordToListTable(t,[o,i]),void this._refreshTaskBar(o,i)}if(Array.isArray(e)){const o=e[0],s=e[1];return this._updateRecordToListTable(t,e),void this._refreshTaskBar(o,s)}let r=e;this.taskListTableInstance.rowHierarchyType==="tree"&&(r=this.taskListTableInstance.getRecordIndexByCell(0,e+this.taskListTableInstance.columnHeaderLevelCount)),this._updateRecordToListTable(t,r),this._refreshTaskBar(e,void 0)}setPixelRatio(t){var e;(e=this.taskListTableInstance)===null||e===void 0||e.setPixelRatio(t),this.parsedOptions.pixelRatio=t,this.scenegraph.setPixelRatio(t)}updateTasksShowMode(t){this.options.tasksShowMode=t,this.updateOption(this.options)}_resize(){var t,e,i,r,o;this._updateSize(),(t=this.taskListTableInstance)===null||t===void 0||t.setCanvasSize(this.taskTableWidth,this.tableNoFrameHeight+Ur((i=(e=this.parsedOptions.outerFrameStyle)===null||e===void 0?void 0:e.borderLineWidth)!==null&&i!==void 0?i:0)[0]+Ur((o=(r=this.parsedOptions.outerFrameStyle)===null||r===void 0?void 0:r.borderLineWidth)!==null&&o!==void 0?o:0)[2]),this._syncPropsFromTable(),this.scenegraph.resize(),Xf(this)}_syncPropsFromTable(){this.itemCount=this.taskListTableInstance?this.taskListTableInstance.rowCount-this.taskListTableInstance.columnHeaderLevelCount:this.records.length,this.headerHeight=this.getAllHeaderRowsHeight(),this.drawHeight=Math.min(this.getAllRowsHeight(),this.tableNoFrameHeight),this.gridHeight=this.drawHeight-this.headerHeight}getContext(){return this.context}release(){var t,e,i;(t=super.release)===null||t===void 0||t.call(this),this.eventManager.release(),(e=this.taskListTableInstance)===null||e===void 0||e.release();const r=(i=this.element)===null||i===void 0?void 0:i.parentElement;r&&(r.removeChild(this.element),this.verticalSplitResizeLine&&r.removeChild(this.verticalSplitResizeLine),this.horizontalSplitLine&&r.removeChild(this.horizontalSplitLine)),this.scenegraph=null,this.pluginManager.release()}updateOption(t){var e,i,r,o,s;if(this.parsedOptions={},this.options=t,this.taskTableWidth=typeof((e=t?.taskListTable)===null||e===void 0?void 0:e.tableWidth)=="number"?(i=t?.taskListTable)===null||i===void 0?void 0:i.tableWidth:-1,this.taskTableColumns=(o=(r=t?.taskListTable)===null||r===void 0?void 0:r.columns)!==null&&o!==void 0?o:[],this.records=(s=t?.records)!==null&&s!==void 0?s:[],this._sortScales(),CB(this),this.data.setRecords(this.records),this._generateTimeLineDateMap(),this.timeLineHeaderLevel=this.parsedOptions.sortedTimelineScales.length,this._updateSize(),this.taskListTableInstance){const a=this._generateListTableOptions();this.taskListTableInstance.updateOption(a),this._updateListTableSize(this.taskListTableInstance)}this._syncPropsFromTable(),this.scenegraph.updateStageBackground(),this.element.style.left=this.taskTableWidth!==-1?`${this.taskTableWidth}px`:"0px",Xf(this),this.scenegraph.updateSceneGraph(),this.scenegraph.afterCreateSceneGraph(),this._scrollToMarkLine()}setRecords(t){this.records=t,this.data.setRecords(t),Qnt(this),this.taskListTableInstance.setRecords(t),this._syncPropsFromTable(),this._generateTimeLineDateMap(),this.timeLineHeaderLevel=this.parsedOptions.sortedTimelineScales.length,this._updateSize(),this.scenegraph.refreshAll(),this.verticalSplitResizeLine.style.height=this.drawHeight+"px";const e=this.stateManager.scroll.horizontalBarPos,i=this.stateManager.scroll.verticalBarPos;this.scenegraph.setX(-e),this.scenegraph.setY(-i)}updateScales(t){const e=this.parsedOptions.sortedTimelineScales.length;if(this.options.timelineHeader.scales=t,this._sortScales(),Unt(this),this._generateTimeLineDateMap(),this.timeLineHeaderLevel=this.parsedOptions.sortedTimelineScales.length,this.scenegraph.refreshAll(),Xf(this),this.taskListTableInstance)if(this.taskListTableInstance.columnHeaderLevelCount===this.parsedOptions.timeLineHeaderRowHeights.length)for(let i=0;i<this.taskListTableInstance.columnHeaderLevelCount;i++)this.taskListTableInstance.setRowHeight(i,this.parsedOptions.timeLineHeaderRowHeights[i]);else{const i=this.getAllHeaderRowsHeight()/this.taskListTableInstance.columnHeaderLevelCount;for(let r=0;r<this.taskListTableInstance.columnHeaderLevelCount;r++)this.taskListTableInstance.setRowHeight(r,i)}e!==t.length&&this._resize()}updateDateRange(t,e){this.options.minDate=t,this.options.maxDate=e,trt(this),this._generateTimeLineDateMap(),this._updateSize(),this.scenegraph.refreshAll(),this._scrollToMarkLine()}updateMarkLine(t){this.options.markLine=t,my(this),this.scenegraph.markLine.refresh(),this.scenegraph.renderSceneGraph()}addMarkLine(t){this.options.markLine=[...this.parsedOptions.markLine,t],my(this),this.scenegraph.markLine.refresh(),this.scenegraph.renderSceneGraph(),this.scenegraph.updateNextFrame()}updateCurrentMarkLine(t){const e=this.parsedOptions.markLine.findIndex((i=>i.date===t.date));e!==-1&&(this.options.markLine=[...this.parsedOptions.markLine.slice(0,e),Object.assign(Object.assign({},this.options.markLine[e]),t),...this.parsedOptions.markLine.slice(e+1)],my(this),this.scenegraph.markLine.refresh(),this.scenegraph.renderSceneGraph(),this.scenegraph.updateNextFrame())}_scrollToMarkLine(){if(this.parsedOptions.scrollToMarkLineDate&&this.parsedOptions.minDate){const t=this.parsedOptions.minDate,{unit:e,step:i}=this.parsedOptions.reverseSortedTimelineScales[0],r=ce(this.parsedOptions.scrollToMarkLineDate,t,e,i)*this.parsedOptions.timelineColWidth-this.tableNoFrameWidth/2;this.stateManager.setScrollLeft(r)}}scrollToMarkLine(t){if(!t||!this.parsedOptions.minDate)return;const e=this.parsedOptions.minDate,{unit:i,step:r}=this.parsedOptions.reverseSortedTimelineScales[0],o=ce(t,e,i,r)*this.parsedOptions.timelineColWidth-this.tableNoFrameWidth/2;this.stateManager.setScrollLeft(o)}addLink(t){this.parsedOptions.dependencyLinks.push(t),this.scenegraph.dependencyLink.initLinkLine(this.parsedOptions.dependencyLinks.length-1),this.scenegraph.updateNextFrame()}deleteLink(t){if(this.parsedOptions.dependencyLinkDeletable){const e=this.parsedOptions.dependencyLinks.findIndex((i=>i.type===t.type&&i.linkedFromTaskKey===t.linkedFromTaskKey&&i.linkedToTaskKey===t.linkedToTaskKey));if(e!==-1){const i=this.parsedOptions.dependencyLinks[e];this.parsedOptions.dependencyLinks.splice(e,1),this.scenegraph.dependencyLink.deleteLink(i),this.scenegraph.updateNextFrame()}}}get scrollTop(){return this.stateManager.scrollTop}set scrollTop(t){this.stateManager.setScrollTop(t)}get scrollLeft(){return this.stateManager.scrollLeft}set scrollLeft(t){this.stateManager.setScrollLeft(t)}getTaskBarRelativeRect(t){const e=this.scenegraph.taskBar.getTaskBarNodeByIndex(t);return{left:e.attribute.x+this.taskListTableInstance.tableNoFrameWidth+this.taskListTableInstance.tableX+this.tableX-this.scrollLeft,top:e.attribute.y+this.tableY+this.headerHeight-this.scrollTop,width:e.attribute.width,height:e.attribute.height}}getDateColWidth(t){return this.parsedOptions.timelineColWidth}getDateColsWidth(t,e){return(e-t+1)*this.parsedOptions.timelineColWidth}getDateRangeByIndex(t){const e=this.parsedOptions.reverseSortedTimelineScales[0];return t<e.timelineDates.length?{startDate:e.timelineDates[t].startDate,endDate:e.timelineDates[t].endDate}:null}parseTimeFormat(t){return pf(t)}getTaskBarStyle(t,e){const{startDate:i,endDate:r,taskRecord:o}=this.getTaskInfoByTaskListIndex(t,e);let s;return s=o.type===se.PROJECT?this.parsedOptions.projectBarStyle:this.parsedOptions.taskBarStyle,typeof s=="function"?s({index:t,startDate:i,endDate:r,taskRecord:o,ganttInstance:this}):s}formatDate(t,e){return fs(t,e)}}const Xpt=Object.freeze(Object.defineProperty({__proto__:null,Gantt:hpt},Symbol.toStringTag,{value:"Module"}));export{jn as G,mpt as _,C1 as a,Ag as c,cpt as g,Xpt as i,ku as s};
