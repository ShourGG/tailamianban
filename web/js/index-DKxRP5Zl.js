import{k as T,aF as B,r as k,o as V,c as q,Q as D,R as b,S as i,U as n,_ as I,Y as L,K as m,j as x,V as o,$ as g,m as a}from"./vue-vendor-B-HGZVTd.js";import{g as A,s as E,a as F,d as K}from"./terraria-rooms-CwNP5Fu0.js";import{am as Q,aF as j,ad as H,H as c,K as S,R as O,S as U,a7 as C,I as Y,aI as G}from"./ui-vendor-C2DiPTQI.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CZdsPYOi.js";import"./spline-vendor-CTguZ3V6.js";import"./charts-vendor-CzveNv9z.js";import"./editor-vendor-CkYh0R4B.js";const W={class:"rooms-page"},X={class:"stat-item"},Z={class:"stat-value"},ee={class:"stat-item"},se={class:"stat-value stat-success"},te={class:"stat-item"},ae={class:"stat-value stat-secondary"},oe={class:"stat-item"},re={class:"stat-value stat-primary"},le=T({__name:"index",setup(ie){const d=B(),r=Q(),l=k([]),f=k(!1),v=async()=>{try{f.value=!0;const s=await A();s.code==="0"?l.value=s.data.map(e=>({...e,id:e.id.toString()})):r.error(s.msg||"加载房间列表失败")}catch(s){r.error(s.message||"加载房间列表失败")}finally{f.value=!1}};V(()=>{v()});const R={vanilla:{label:"原版服",color:"default"},tshock:{label:"TShock插件服",color:"success"},tmodloader:{label:"TModLoader Mod服",color:"warning"}},$={stopped:{label:"已停止",color:"default"},starting:{label:"启动中",color:"info"},running:{label:"运行中",color:"success"},stopping:{label:"停止中",color:"warning"},error:{label:"错误",color:"error"}},w=[{title:"房间名称",key:"name",width:150,ellipsis:{tooltip:!0}},{title:"服务器类型",key:"type",width:150,render:s=>{const e=R[s.type];return a(C,{type:e.color},()=>e.label)}},{title:"状态",key:"status",width:100,render:s=>{const e=$[s.status];return a(C,{type:e.color},()=>e.label)}},{title:"玩家",key:"players",width:100,render:s=>`${s.currentPlayers}/${s.maxPlayers}`},{title:"端口",key:"port",width:80},{title:"世界名称",key:"worldName",width:120,ellipsis:{tooltip:!0}},{title:"创建时间",key:"createdAt",width:160},{title:"操作",key:"actions",width:320,fixed:"right",render:s=>{const e=[{label:"控制台",key:"console",icon:()=>a("div",{class:"i-mdi:console"})},{label:"世界管理",key:"worlds",icon:()=>a("div",{class:"i-mdi:earth"})},{label:"玩家管理",key:"players",icon:()=>a("div",{class:"i-mdi:account-group"})}];s.type==="tshock"&&e.push({type:"divider",key:"divider1"},{label:"TShock配置",key:"tshock-config",icon:()=>a("div",{class:"i-mdi:cog-outline text-orange-500"})},{label:"SSC开荒配置",key:"ssc-config",icon:()=>a("div",{class:"i-mdi:shield-lock text-red-500"})},{label:"模组/插件市场",key:"mod-market",icon:()=>a("div",{class:"i-mdi:shopping text-indigo-500"})}),s.type==="tmodloader"&&e.push({type:"divider",key:"divider1"},{label:"Mod管理",key:"mods",icon:()=>a("div",{class:"i-mdi:package-variant text-yellow-500"})},{label:"模组/插件市场",key:"mod-market",icon:()=>a("div",{class:"i-mdi:shopping text-indigo-500"})});const t=u=>{u==="tshock-config"?d.push(`/terraria/rooms/${s.id}/tshock-config`):u==="ssc-config"?d.push(`/terraria/rooms/${s.id}/ssc-config`):u==="mod-market"?d.push(`/terraria/rooms/${s.id}/mod-market`):d.push(`/terraria/${u}`)};return a(S,{size:"small"},()=>[s.status==="running"?a(c,{size:"small",type:"warning",onClick:()=>M(s.id)},()=>"停止"):a(c,{size:"small",type:"success",onClick:()=>P(s.id)},()=>"启动"),a(c,{size:"small",type:"primary",onClick:()=>z(s.id)},()=>"管理"),a(Y,{trigger:"hover",options:e,onSelect:t},{default:()=>a(c,{size:"small",quaternary:!0},{default:()=>"快速入口",icon:()=>a("div",{class:"i-mdi:menu-down"})})}),a(G,{onPositiveClick:()=>N(s.id)},{default:()=>"确定删除这个房间吗？",trigger:()=>a(c,{size:"small",type:"error",quaternary:!0},{default:()=>"删除",icon:()=>a("div",{class:"i-mdi:delete"})})})])}}],h=()=>{d.push("/rooms/create")},P=async s=>{const e=l.value.find(t=>t.id===s);if(e)try{const t=await E(s);t.code==="0"?(r.success(`房间 "${e.name}" 启动成功`),v()):r.error(t.msg||"启动失败")}catch(t){r.error(t.message||"启动失败")}},M=async s=>{const e=l.value.find(t=>t.id===s);if(e)try{const t=await F(s);t.code==="0"?(r.success(`房间 "${e.name}" 已停止`),v()):r.error(t.msg||"停止失败")}catch(t){r.error(t.message||"停止失败")}},z=s=>{d.push(`/terraria/rooms/${s}`)},N=async s=>{const e=l.value.find(t=>t.id===s);if(e)try{const t=await K(s);t.code==="0"?(r.success(`房间 "${e.name}" 已删除`),v()):r.error(t.msg||"删除失败")}catch(t){r.error(t.message||"删除失败")}},p=q(()=>{const s=l.value.length,e=l.value.filter(y=>y.status==="running").length,t=l.value.reduce((y,_)=>y+_.currentPlayers,0),u=l.value.reduce((y,_)=>y+_.maxPlayers,0);return{total:s,running:e,stopped:s-e,totalPlayers:t,totalMaxPlayers:u}});return(s,e)=>{const t=O;return b(),D("div",W,[i(m(U),{title:"房间管理",bordered:!1},{"header-extra":n(()=>[i(m(S),{align:"center"},{default:n(()=>[o("div",X,[e[0]||(e[0]=o("span",{class:"stat-label"},"总数",-1)),o("span",Z,g(p.value.total),1)]),i(t,{vertical:""}),o("div",ee,[e[1]||(e[1]=o("span",{class:"stat-label"},"运行",-1)),o("span",se,g(p.value.running),1)]),i(t,{vertical:""}),o("div",te,[e[2]||(e[2]=o("span",{class:"stat-label"},"停止",-1)),o("span",ae,g(p.value.stopped),1)]),i(t,{vertical:""}),o("div",oe,[e[3]||(e[3]=o("span",{class:"stat-label"},"玩家",-1)),o("span",re,g(p.value.totalPlayers)+"/"+g(p.value.totalMaxPlayers),1)]),i(t,{vertical:""}),i(m(c),{type:"primary",onClick:h},{icon:n(()=>[...e[4]||(e[4]=[o("div",{class:"i-mdi:plus"},null,-1)])]),default:n(()=>[e[5]||(e[5]=x(" 创建房间 ",-1))]),_:1})]),_:1})]),default:n(()=>[i(m(j),{columns:w,data:l.value,pagination:{pageSize:10},"scroll-x":1200,loading:f.value},null,8,["data","loading"]),l.value.length===0?(b(),I(m(H),{key:0,description:"暂无房间，快去创建一个吧！",class:"py-8"},{extra:n(()=>[i(m(c),{type:"primary",onClick:h},{default:n(()=>[...e[6]||(e[6]=[x("创建房间",-1)])]),_:1})]),_:1})):L("",!0)]),_:1})])}}}),ve=J(le,[["__scopeId","data-v-d58bb47f"]]);export{ve as default};
