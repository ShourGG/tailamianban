import{f}from"./index-CZdsPYOi.js";import{am as N,aG as D,M as $,a3 as L,T as P,U,S as x,K as m,ah as h,H as z}from"./ui-vendor-C2DiPTQI.js";import{k as F,r as v,o as K,Q as r,R as d,S as e,U as a,K as s,V as o,j as i,F as R,N as j,_ as y,M as b,Y as p,I as A,$ as c}from"./vue-vendor-B-HGZVTd.js";import"./spline-vendor-CTguZ3V6.js";import"./charts-vendor-CzveNv9z.js";import"./editor-vendor-CkYh0R4B.js";const G={style:{padding:"16px"}},H={style:{"font-size":"18px","font-weight":"bold"}},O={style:{"font-size":"13px",color:"#999","margin-top":"4px"}},Q={key:0,style:{"margin-left":"auto"}},W={style:{color:"#666"}},Y={style:{color:"#666"}},q={key:0,style:{color:"#18a058"}},J={key:1,style:{color:"#999","margin-left":"auto","font-size":"12px"}},X={style:{background:"#f6f6f6",padding:"12px","border-radius":"4px","font-size":"13px"}},Z={key:0},tt={key:1},nt={key:2},rt=F({__name:"install-game",setup(lt){const u=N(),C=D(),_=v(!1),k=v([]),S=v([]),M=async()=>{_.value=!0;try{const l=await f.get("/api/terraria/install/versions");if(l.data.code==="200"){const t=l.data.data;k.value=t.map(n=>({...n,icon:V(n.type),color:E(n.type),installed:!1,installing:!1,progress:0})),await w()}}catch(l){u.error("获取版本列表失败: "+(l.response?.data?.message||l.message))}finally{_.value=!1}},w=async()=>{try{const l=await f.get("/api/terraria/install/status");l.data.code==="200"&&(S.value=l.data.data||[],k.value.forEach(t=>{const n=S.value.find(g=>g.type===t.type&&g.version===t.version);n&&(t.installed=!0,t.install_dir=n.install_dir)}))}catch{}},I=async l=>{C.warning({title:"确认安装",content:`确定要安装 ${l.name} 吗？这将会下载并安装游戏服务器文件（约${l.size}）。`,positiveText:"确定",negativeText:"取消",onPositiveClick:async()=>{l.installing=!0,l.progress=0;const t=setInterval(()=>{l.progress<90&&(l.progress+=Math.random()*10)},500);try{const n=await f.post("/api/terraria/install/game",{version:l.version,type:l.type,download_url:l.download_url,name:l.name});if(clearInterval(t),n.data.code==="200")l.progress=100,l.installed=!0,l.install_dir=n.data.data.install_dir,n.data.data.status==="already_installed"?u.info("该版本已经安装过了"):u.success(`${l.name} 安装完成！`),await w();else throw new Error(n.data.message)}catch(n){clearInterval(t),u.error("安装失败: "+(n.response?.data?.message||n.message))}finally{l.installing=!1,l.progress=0}}})},T=async l=>{if(!l.install_dir){u.error("无法获取安装目录");return}C.error({title:"确认卸载",content:`确定要卸载 ${l.name} 吗？这将删除所有服务器文件！`,positiveText:"确定卸载",negativeText:"取消",onPositiveClick:async()=>{try{const t=await f.delete("/api/terraria/install/game",{params:{install_dir:l.install_dir}});if(t.data.code==="200")l.installed=!1,l.install_dir=void 0,u.success("卸载成功"),await w();else throw new Error(t.data.message)}catch(t){u.error("卸载失败: "+(t.response?.data?.message||t.message))}}})},B=l=>{window.open(l,"_blank")},V=l=>({vanilla:"i-mdi:cube",tshock:"i-mdi:puzzle",tmodloader:"i-mdi:package-variant"})[l]||"i-mdi:server",E=l=>({vanilla:"#2080f0",tshock:"#18a058",tmodloader:"#f0a020"})[l]||"#666";return K(()=>{M()}),(l,t)=>(d(),r("div",G,[e(s(x),{title:"安装游戏服务器"},{default:a(()=>[e(s($),{type:"info",style:{"margin-bottom":"24px"}},{icon:a(()=>[...t[0]||(t[0]=[o("div",{class:"i-mdi:information"},null,-1)])]),default:a(()=>[t[1]||(t[1]=o("strong",null,"提示：",-1)),t[2]||(t[2]=i("在创建房间前，需要先安装对应版本的游戏服务器。请根据需要选择并安装以下版本。 ",-1))]),_:1}),e(s(L),{show:_.value,description:"加载中..."},{default:a(()=>[e(s(P),{cols:1,"y-gap":16},{default:a(()=>[(d(!0),r(R,null,j(k.value,n=>(d(),y(s(U),{key:`${n.type}-${n.version}`},{default:a(()=>[e(s(x),{style:b({borderLeft:`4px solid ${n.color}`})},{default:a(()=>[e(s(m),{vertical:"",size:16},{default:a(()=>[e(s(m),{align:"center",size:12},{default:a(()=>[o("div",{class:A(n.icon),style:b({fontSize:"32px",color:n.color})},null,6),o("div",null,[o("div",H,c(n.name),1),o("div",O,c(n.description),1)]),n.installed?(d(),r("div",Q,[e(s($),{type:"success",bordered:!1,style:{padding:"4px 12px"}},{icon:a(()=>[...t[3]||(t[3]=[o("div",{class:"i-mdi:check-circle"},null,-1)])]),default:a(()=>[t[4]||(t[4]=i(" 已安装 ",-1))]),_:1})])):p("",!0)]),_:2},1024),e(s(m),{align:"center",style:{"font-size":"13px"}},{default:a(()=>[o("div",W,[t[5]||(t[5]=o("strong",null,"版本：",-1)),i(c(n.version),1)]),o("div",Y,[t[6]||(t[6]=o("strong",null,"大小：",-1)),i(c(n.size),1)]),n.recommended?(d(),r("div",q,[...t[7]||(t[7]=[o("strong",null,"✓ 推荐",-1)])])):p("",!0),n.install_dir?(d(),r("div",J,c(n.install_dir),1)):p("",!0)]),_:2},1024),n.installing?(d(),y(s(h),{key:0,type:"line",percentage:n.progress,"indicator-placement":"inside",processing:""},null,8,["percentage"])):p("",!0),e(s(m),null,{default:a(()=>[n.installed?p("",!0):(d(),y(s(z),{key:0,type:"primary",color:n.color,onClick:g=>I(n),loading:n.installing,disabled:n.installing},{icon:a(()=>[...t[8]||(t[8]=[o("div",{class:"i-mdi:download"},null,-1)])]),default:a(()=>[i(" "+c(n.installing?"安装中...":"安装服务器"),1)]),_:2},1032,["color","onClick","loading","disabled"])),n.installed?(d(),y(s(z),{key:1,type:"error",onClick:g=>T(n)},{icon:a(()=>[...t[9]||(t[9]=[o("div",{class:"i-mdi:delete"},null,-1)])]),default:a(()=>[t[10]||(t[10]=i(" 卸载 ",-1))]),_:1},8,["onClick"])):p("",!0),e(s(z),{onClick:g=>B(n.download_url)},{icon:a(()=>[...t[11]||(t[11]=[o("div",{class:"i-mdi:open-in-new"},null,-1)])]),default:a(()=>[t[12]||(t[12]=i(" 访问下载页面 ",-1))]),_:1},8,["onClick"])]),_:2},1024),o("div",X,[n.type==="vanilla"?(d(),r("div",Z,[...t[13]||(t[13]=[o("strong",null,"特性：",-1),i("官方标准版本 | 无插件 | 无Mod | 最稳定 ",-1)])])):n.type==="tshock"?(d(),r("div",tt,[...t[14]||(t[14]=[o("strong",null,"特性：",-1),i("插件系统 | REST API | 权限管理 | 经济系统 | 区域保护 ",-1)])])):n.type==="tmodloader"?(d(),r("div",nt,[...t[15]||(t[15]=[o("strong",null,"特性：",-1),i("Steam Workshop | 支持Mod | 新物品/BOSS | 客户端需同步Mod ",-1)])])):p("",!0)])]),_:2},1024)]),_:2},1032,["style"])]),_:2},1024))),128))]),_:1})]),_:1},8,["show"])]),_:1}),e(s(x),{title:"安装说明",style:{"margin-top":"16px"}},{default:a(()=>[e(s(m),{vertical:"",size:12},{default:a(()=>[...t[16]||(t[16]=[o("div",null,[o("strong",null,"1. 选择版本："),i("根据需求选择要安装的服务器版本")],-1),o("div",null,[o("strong",null,"2. 下载文件："),i('点击"访问下载页面"前往官方下载最新版本')],-1),o("div",null,[o("strong",null,"3. 安装服务器："),i('下载完成后点击"安装服务器"按钮进行安装')],-1),o("div",null,[o("strong",null,"4. 创建房间："),i('安装完成后，前往"房间列表"创建新的游戏房间')],-1),o("div",{style:{color:"#f0a020"}},[o("strong",null,"⚠️ 注意："),i("TModLoader服务器要求客户端安装相同的Mod才能连接！ ")],-1)])]),_:1})]),_:1})]))}});export{rt as default};
