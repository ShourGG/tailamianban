import ke from"./index-CcExhs5G.js";import{Q as $,aw as Fe,ax as Te,ay as Ve,a5 as x,az as Pe,af as Ee,ag as Re,a9 as Ae,J as U,K as T,Y as Oe,X as Be,W as Ne,aA as $e,V as xe,H as D,aB as Ue,P as De}from"./ui-vendor-C2DiPTQI.js";import{k as Le,r as Me,e as L,c as g,m as u,g as Ie,n as je,o as ze,w as V,t as Ge,a1 as We,_ as M,U as y,S as v,Y as Ye,K as c,R as I,q as qe,j,s as Ke}from"./vue-vendor-B-HGZVTd.js";function z(s="blur",d,l){return{trigger:s,validator:async(o,a)=>{if(!d(a))throw new Error(l)},message:l}}const Ze={required:(s,d=["blur","input"])=>z(d,l=>l==null?!1:typeof l=="string"?l.trim()!=="":Array.isArray(l)?l.length>0:typeof l=="object"?Object.keys(l).length>0:!!l,`${s}不能为空`),length:(s,d,l)=>z("blur",o=>{if(!o)return!0;const a=String(o).length;return l!==void 0?a>=d&&a<=l:a>=d},l?`${s}长度需在${d}-${l}位之间`:`${s}长度至少${d}位`)};function He(s){return s.length<=1?s:[{trigger:["blur","input"],validator:async(d,l)=>{for(const o of s)try{await o.validator?.(o,l,()=>{},{},{})}catch(a){throw a}}}]}const et=Le({__name:"index",props:{options:{},modelValue:{},layoutType:{default:"default"},layoutConfig:{default:()=>({})},validateOnValueChange:{type:Boolean,default:!1},labelPlacement:{default:"left"},labelWidth:{default:"auto"},showRequireMark:{type:Boolean},size:{default:"medium"},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},showDefaultActions:{type:Boolean,default:!0}},emits:["submit","update:modelValue","validate-success","validate-error","fields-change","editor-mounted","on-preview","on-remove","before-remove","on-exceed","on-success","tab-change","step-change","step-before-change","step-validate","field-add","field-remove","field-toggle","fields-clear","render-mode-change","group-toggle","group-reset"],setup(s,{expose:d,emit:l}){const o=s,a=l,i=Me(null),r=L({}),_=L({}),P={default:"Default",inline:"Inline",grid:"Grid",card:"Card",tabs:"Tabs",steps:"Steps",dynamic:"Dynamic",custom:"Custom"},G={input:U,textarea:U,inputNumber:Ae,switch:Re,slider:Ee,rate:Pe,datePicker:x,daterange:x,timePicker:Ve,cascader:Te,colorPicker:Fe},W=["select","checkbox","radio","upload","editor"],Y={input:"",textarea:"",editor:"",select:null,datePicker:null,daterange:null,timePicker:null,cascader:null,colorPicker:null,checkbox:null,upload:[],radio:"",inputNumber:null,slider:null,rate:null,switch:null},q=["steps","custom"],K=g(()=>P[o.layoutType]||P.default),H=g(()=>({type:o.layoutType,...o.layoutConfig})),C=g(()=>!(o.showDefaultActions===!1||q.includes(o.layoutType))),E=g(()=>o.options.filter(e=>e.show!==!1)),J=g(()=>E.value.map(e=>u($,{label:e.label,path:e.prop,key:e.prop,required:!!e.rules?.length},{default:()=>Q(e)}))),Q=e=>{try{if(W.includes(e.type))return X(e);const t=G[e.type];return t?u(t,{...R(e),...e.attrs}):null}catch{return null}},X=e=>{const t=R(e);switch(e.type){case"select":return u(xe,{...t,options:e.children?.map(n=>({value:n.value,label:n.label,disabled:n.disabled}))||[],...e.attrs});case"checkbox":return u($e,{...t,...e.attrs},{default:()=>u(T,{},{default:()=>e.children?.map(n=>u(Ne,{value:n.value,label:n.label,disabled:n.disabled,key:String(n.value)}))||[]})});case"radio":return u(Be,{...t,...e.attrs},{default:()=>u(T,{},{default:()=>e.children?.map(n=>u(Oe,{value:n.value,disabled:n.disabled,key:String(n.value)},{default:()=>n.label}))||[]})});case"upload":return ee(e);case"editor":return Z(e);default:return null}},Z=e=>u(ke,{editorId:`editor-${e.prop}`,modelValue:r[e.prop]||"",placeholder:e.placeholder,disabled:o.disabled,readonly:o.readonly,"onUpdate:modelValue":t=>{r[e.prop]=t,w(e.prop)},"onEditor-mounted":t=>{a("editor-mounted",{editor:t,prop:e.prop,html:r[e.prop]||""})},...e.attrs}),ee=e=>{const t=Ie();return u(Ue,{fileList:r[e.prop]||[],"onUpdate:fileList":n=>{r[e.prop]=n,w(e.prop)},onPreview:n=>a("on-preview",n),onRemove:n=>a("on-remove",n),onBeforeRemove:n=>a("before-remove",n),onExceed:n=>a("on-exceed",n),onSuccess:n=>a("on-success",n),...e.attrs},{trigger:()=>t?.slots.uploadClick?.()||u(D,{type:"primary"},{default:()=>"选择文件"}),tip:()=>t?.slots.uploadTip?.()||null})},R=e=>{const t={value:r[e.prop],"onUpdate:value":n=>{r[e.prop]=n,w(e.prop)}};return e.type==="textarea"&&(t.type="textarea"),e.placeholder&&(t.placeholder=e.placeholder),t},A=e=>Y[e]??null,w=e=>{o.validateOnValueChange&&je(()=>{f(e).catch(()=>{})})},S=()=>{try{Object.keys(_).forEach(e=>delete _[e]),o.options.forEach(e=>{r[e.prop]=e.value!==void 0?e.value:A(e.type),e.rules?.length&&(_[e.prop]=He(e.rules))})}catch{}},m=async()=>{if(!i.value)throw new Error("[C_Form] 表单引用不存在");try{await i.value.validate(),a("validate-success",b())}catch(e){throw a("validate-error",e),e}},f=async e=>{if(!i.value)throw new Error("[C_Form] 表单引用不存在");const t=Array.isArray(e)?e:[e];await i.value.validate(t)},k=e=>{i.value&&(e?(Array.isArray(e)?e:[e]).forEach(n=>{if(r[n]!==void 0){const p=r[n];r[n]=p}}):i.value.restoreValidation())},h=async(e,t)=>{try{const n=o.options.filter(e).map(p=>p.prop);return n.length===0||await f(n),!0}catch{return!1}},te=async e=>{const t=o.layoutConfig?.steps?.steps?.[e]?.key;return t?h(n=>n.layout?.step===t):!0},ne=async e=>h(t=>t.layout?.tab===e),ae=async()=>h(e=>!!e.layout?.dynamic),oe=async e=>h(t=>t.layout?.group===e),re=e=>{a("fields-change",e)},le=e=>a("tab-change",e),se=(e,t)=>a("step-change",e,t),ue=async(e,t)=>(a("step-before-change",e,t),!0),de=async e=>{try{const t=o.layoutConfig?.steps?.steps?.[e]?.key;if(!t)return!0;const n=o.options.filter(p=>p.layout?.step===t).map(p=>p.prop);return n.length===0||(await f(n),a("step-validate",e)),!0}catch{return!1}},ce=e=>a("field-add",e),ie=e=>a("field-remove",e),pe=(e,t)=>a("field-toggle",e,t),fe=()=>a("fields-clear"),ge=e=>a("render-mode-change",e),ye=(e,t)=>a("group-toggle",e,t),_e=e=>a("group-reset",e),me=async()=>{try{await m(),a("submit",{model:b(),form:i.value})}catch{}},O=()=>{try{k(),o.options.forEach(e=>{const t=e.value!==void 0?e.value:A(e.type);r[e.prop]=t})}catch{}},B=()=>O(),N=e=>{Object.assign(r,e)},b=()=>({...r}),he=async(e,t,n=!1)=>{r[e]=t,n&&await f(e)},be=e=>r[e],ve=async(e,t=!1)=>{Object.assign(r,e),t&&await m()};return ze(()=>{S(),V(()=>o.options,()=>S(),{deep:!0}),V(()=>o.modelValue,e=>{e&&Object.assign(r,e)},{immediate:!0,deep:!0}),V(r,e=>a("update:modelValue",{...e}),{deep:!0})}),d({validate:m,validateField:f,validateStep:te,validateTab:ne,validateDynamicFields:ae,validateCustomGroup:oe,clearValidation:k,getModel:b,setFields:N,resetFields:B,setFieldValue:he,getFieldValue:be,setFieldsValue:ve,formRef:i,formModel:r,initialize:S,layoutType:Ge(o,"layoutType"),shouldShowDefaultActions:C}),(e,t)=>{const n=We("DynamicComponent"),p=D,Ce=T,we=$,Se=De;return I(),M(Se,Ke({ref_key:"formRef",ref:i,model:c(r),rules:c(_),"validate-on-rule-change":!1,"label-placement":s.labelPlacement,"label-width":s.labelWidth,size:s.size,disabled:s.disabled,readonly:s.readonly},e.$attrs),{default:y(()=>[v(n,{name:c(K),"form-items":c(J),"layout-config":c(H),options:c(E),"form-data":c(r),"show-default-actions":c(C),onTabChange:le,onStepChange:se,onStepBeforeChange:ue,onStepValidate:de,onFieldAdd:ce,onFieldRemove:ie,onFieldToggle:pe,onFieldsClear:fe,onRenderModeChange:ge,onGroupToggle:ye,onGroupReset:_e,onValidateSuccess:t[0]||(t[0]=F=>a("validate-success",F)),onValidateError:t[1]||(t[1]=F=>a("validate-error",F)),onFieldsChange:re},null,8,["name","form-items","layout-config","options","form-data","show-default-actions"]),c(C)?(I(),M(we,{key:0,class:"mt-5"},{default:y(()=>[qe(e.$slots,"action",{form:c(i),model:c(r),validate:m,validateField:f,reset:B,setFields:N,getModel:b,clearValidation:k},()=>[v(Ce,null,{default:y(()=>[v(p,{type:"primary",onClick:me},{default:y(()=>[...t[2]||(t[2]=[j("提交",-1)])]),_:1}),v(p,{onClick:O},{default:y(()=>[...t[3]||(t[3]=[j("重置",-1)])]),_:1})]),_:1})])]),_:3})):Ye("",!0)]),_:3},16,["model","rules","label-placement","label-width","size","disabled","readonly"])}}});export{Ze as P,et as _};
