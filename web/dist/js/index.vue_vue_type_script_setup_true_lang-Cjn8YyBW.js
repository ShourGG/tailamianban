import{X as be,Y as Ce,M as Ne,K as we}from"./ui-vendor-qucRfopV.js";import{k as ke,r as Se,e as O,a0 as r,c as f,m as s,g as _e,n as Fe,o as Te,w as F,t as Pe,Z as D,P as I,s as Ve,J as u,R as y,Q as b,X as Re,q as xe,j as M}from"./vue-vendor-DIhTWhib.js";function Ee(d){return d.length<=1?d:[{trigger:["blur","input"],validator:async(T,C)=>{for(const l of d)try{await l.validator?.(l,C,()=>{},{},{})}catch(o){throw o}}}]}const Oe=ke({__name:"index",props:{options:{},modelValue:{},layoutType:{default:"default"},layoutConfig:{default:()=>({})},validateOnValueChange:{type:Boolean,default:!1},labelPlacement:{default:"left"},labelWidth:{default:"auto"},showRequireMark:{type:Boolean},size:{default:"medium"},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},showDefaultActions:{type:Boolean,default:!0}},emits:["submit","update:modelValue","validate-success","validate-error","fields-change","editor-mounted","on-preview","on-remove","before-remove","on-exceed","on-success","tab-change","step-change","step-before-change","step-validate","field-add","field-remove","field-toggle","fields-clear","render-mode-change","group-toggle","group-reset"],setup(d,{expose:T,emit:C}){const l=d,o=C,c=Se(null),n=O({}),g=O({}),P={default:"Default",inline:"Inline",grid:"Grid",card:"Card",tabs:"Tabs",steps:"Steps",dynamic:"Dynamic",custom:"Custom"},L={input:r("NInput"),textarea:r("NInput"),inputNumber:r("NInputNumber"),switch:r("NSwitch"),slider:r("NSlider"),rate:r("NRate"),datePicker:r("NDatePicker"),daterange:r("NDatePicker"),timePicker:r("NTimePicker"),cascader:r("NCascader"),colorPicker:r("NColorPicker")},U=["select","checkbox","radio","upload","editor"],G={input:"",textarea:"",editor:"",select:null,datePicker:null,daterange:null,timePicker:null,cascader:null,colorPicker:null,checkbox:null,upload:[],radio:"",inputNumber:null,slider:null,rate:null,switch:null},j=["steps","custom"],z=f(()=>P[l.layoutType]||P.default),W=f(()=>({type:l.layoutType,...l.layoutConfig})),N=f(()=>!(l.showDefaultActions===!1||j.includes(l.layoutType))),V=f(()=>l.options.filter(e=>e.show!==!1)),Y=f(()=>V.value.map(e=>s(r("NFormItem"),{label:e.label,path:e.prop,key:e.prop,required:!!e.rules?.length},{default:()=>q(e)}))),q=e=>{try{if(U.includes(e.type))return K(e);const t=L[e.type];return t?s(t,{...R(e),...e.attrs}):null}catch{return null}},K=e=>{const t=R(e);switch(e.type){case"select":return s(r("NSelect"),{...t,options:e.children?.map(a=>({value:a.value,label:a.label,disabled:a.disabled}))||[],...e.attrs});case"checkbox":return s(r("NCheckboxGroup"),{...t,...e.attrs},{default:()=>s(r("NSpace"),{},{default:()=>e.children?.map(a=>s(r("NCheckbox"),{value:a.value,label:a.label,disabled:a.disabled,key:String(a.value)}))||[]})});case"radio":return s(r("NRadioGroup"),{...t,...e.attrs},{default:()=>s(r("NSpace"),{},{default:()=>e.children?.map(a=>s(r("NRadio"),{value:a.value,disabled:a.disabled,key:String(a.value)},{default:()=>a.label}))||[]})});case"upload":return X(e);case"editor":return $(e);default:return null}},$=e=>s(r("C_Editor"),{editorId:`editor-${e.prop}`,modelValue:n[e.prop]||"",placeholder:e.placeholder,disabled:l.disabled,readonly:l.readonly,"onUpdate:modelValue":t=>{n[e.prop]=t,w(e.prop)},"onEditor-mounted":t=>{o("editor-mounted",{editor:t,prop:e.prop,html:n[e.prop]||""})},...e.attrs}),X=e=>{const t=_e();return s(r("NUpload"),{fileList:n[e.prop]||[],"onUpdate:fileList":a=>{n[e.prop]=a,w(e.prop)},onPreview:a=>o("on-preview",a),onRemove:a=>o("on-remove",a),onBeforeRemove:a=>o("before-remove",a),onExceed:a=>o("on-exceed",a),onSuccess:a=>o("on-success",a),...e.attrs},{trigger:()=>t?.slots.uploadClick?.()||s(r("NButton"),{type:"primary"},{default:()=>"选择文件"}),tip:()=>t?.slots.uploadTip?.()||null})},R=e=>{const t={value:n[e.prop],"onUpdate:value":a=>{n[e.prop]=a,w(e.prop)}};return e.type==="textarea"&&(t.type="textarea"),e.placeholder&&(t.placeholder=e.placeholder),t},x=e=>G[e]??null,w=e=>{l.validateOnValueChange&&Fe(()=>{p(e).catch(()=>{})})},k=()=>{try{Object.keys(g).forEach(e=>delete g[e]),l.options.forEach(e=>{n[e.prop]=e.value!==void 0?e.value:x(e.type),e.rules?.length&&(g[e.prop]=Ee(e.rules))})}catch{}},h=async()=>{if(!c.value)throw new Error("[C_Form] 表单引用不存在");try{await c.value.validate(),o("validate-success",v())}catch(e){throw o("validate-error",e),e}},p=async e=>{if(!c.value)throw new Error("[C_Form] 表单引用不存在");const t=Array.isArray(e)?e:[e];await c.value.validate(t)},S=e=>{c.value&&(e?(Array.isArray(e)?e:[e]).forEach(a=>{if(n[a]!==void 0){const i=n[a];n[a]=i}}):c.value.restoreValidation())},m=async(e,t)=>{try{const a=l.options.filter(e).map(i=>i.prop);return a.length===0||await p(a),!0}catch{return!1}},H=async e=>{const t=l.layoutConfig?.steps?.steps?.[e]?.key;return t?m(a=>a.layout?.step===t):!0},J=async e=>m(t=>t.layout?.tab===e),Q=async()=>m(e=>!!e.layout?.dynamic),Z=async e=>m(t=>t.layout?.group===e),ee=e=>{o("fields-change",e)},te=e=>o("tab-change",e),ae=(e,t)=>o("step-change",e,t),oe=async(e,t)=>(o("step-before-change",e,t),!0),ne=async e=>{try{const t=l.layoutConfig?.steps?.steps?.[e]?.key;if(!t)return!0;const a=l.options.filter(i=>i.layout?.step===t).map(i=>i.prop);return a.length===0||(await p(a),o("step-validate",e)),!0}catch{return!1}},re=e=>o("field-add",e),le=e=>o("field-remove",e),se=(e,t)=>o("field-toggle",e,t),ue=()=>o("fields-clear"),de=e=>o("render-mode-change",e),ce=(e,t)=>o("group-toggle",e,t),ie=e=>o("group-reset",e),pe=async()=>{try{await h(),o("submit",{model:v(),form:c.value})}catch{}},E=()=>{try{S(),l.options.forEach(e=>{const t=e.value!==void 0?e.value:x(e.type);n[e.prop]=t})}catch{}},A=()=>E(),B=e=>{Object.assign(n,e)},v=()=>({...n}),fe=async(e,t,a=!1)=>{n[e]=t,a&&await p(e)},ye=e=>n[e],ge=async(e,t=!1)=>{Object.assign(n,e),t&&await h()};return Te(()=>{k(),F(()=>l.options,()=>k(),{deep:!0}),F(()=>l.modelValue,e=>{e&&Object.assign(n,e)},{immediate:!0,deep:!0}),F(n,e=>o("update:modelValue",{...e}),{deep:!0})}),T({validate:h,validateField:p,validateStep:H,validateTab:J,validateDynamicFields:Q,validateCustomGroup:Z,clearValidation:S,getModel:v,setFields:B,resetFields:A,setFieldValue:fe,getFieldValue:ye,setFieldsValue:ge,formRef:c,formModel:n,initialize:k,layoutType:Pe(l,"layoutType"),shouldShowDefaultActions:N}),(e,t)=>{const a=r("DynamicComponent"),i=Ne,he=we,me=Ce,ve=be;return I(),D(ve,Ve({ref_key:"formRef",ref:c,model:u(n),rules:u(g),"validate-on-rule-change":!1,"label-placement":d.labelPlacement,"label-width":d.labelWidth,size:d.size,disabled:d.disabled,readonly:d.readonly},e.$attrs),{default:y(()=>[b(a,{name:u(z),"form-items":u(Y),"layout-config":u(W),options:u(V),"form-data":u(n),"show-default-actions":u(N),onTabChange:te,onStepChange:ae,onStepBeforeChange:oe,onStepValidate:ne,onFieldAdd:re,onFieldRemove:le,onFieldToggle:se,onFieldsClear:ue,onRenderModeChange:de,onGroupToggle:ce,onGroupReset:ie,onValidateSuccess:t[0]||(t[0]=_=>o("validate-success",_)),onValidateError:t[1]||(t[1]=_=>o("validate-error",_)),onFieldsChange:ee},null,8,["name","form-items","layout-config","options","form-data","show-default-actions"]),u(N)?(I(),D(me,{key:0,class:"mt-5"},{default:y(()=>[xe(e.$slots,"action",{form:u(c),model:u(n),validate:h,validateField:p,reset:A,setFields:B,getModel:v,clearValidation:S},()=>[b(he,null,{default:y(()=>[b(i,{type:"primary",onClick:pe},{default:y(()=>[...t[2]||(t[2]=[M("提交",-1)])]),_:1}),b(i,{onClick:E},{default:y(()=>[...t[3]||(t[3]=[M("重置",-1)])]),_:1})]),_:1})])]),_:3})):Re("",!0)]),_:3},16,["model","rules","label-placement","label-width","size","disabled","readonly"])}}});export{Oe as _};
