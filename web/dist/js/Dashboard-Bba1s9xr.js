import{u as j}from"./server-B0OLwv7R.js";import{ab as q,r as w,k as A,c as $,o as K,E as Q,a0 as d,O as v,P as m,S as s,Q as o,R as n,X,H as T,_ as i,J as r,j as h,F as G,W as Y}from"./vue-vendor-DIhTWhib.js";import{H as Z,$ as ss,K as ts,M as es}from"./ui-vendor-qucRfopV.js";import{_ as os}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ns=q("websocket",()=>{const l=w(null),c=w(!1),e=w(null);function _(){if(l.value?.readyState===WebSocket.OPEN)return;const p=window.location.protocol==="https:"?"wss:":"ws:",N=window.location.host;l.value=new WebSocket(`${p}//${N}/ws`),l.value.onopen=()=>{c.value=!0,e.value&&(clearTimeout(e.value),e.value=null)},l.value.onclose=()=>{c.value=!1,e.value=setTimeout(()=>{_()},3e3)},l.value.onerror=y=>{},l.value.onmessage=y=>{try{const k=JSON.parse(y.data);x(k)}catch{}}}function S(){e.value&&(clearTimeout(e.value),e.value=null),l.value&&(l.value.close(),l.value=null),c.value=!1}function f(p){l.value?.readyState===WebSocket.OPEN&&l.value.send(JSON.stringify(p))}function x(p){switch(p.type){}}return{connected:c,connect:_,disconnect:S,send:f}}),as={class:"dashboard"},rs={class:"status-cards"},ls={class:"card-content"},is={class:"card-icon server-icon"},cs={class:"card-info"},us={key:0},ds={class:"card-content"},_s={class:"card-icon players-icon"},ps={class:"card-info"},vs={class:"count-text"},ms={class:"card-content"},fs={class:"card-icon world-icon"},gs={class:"card-info"},bs={class:"world-text"},hs={class:"card-content"},ws={class:"card-icon port-icon"},Ss={class:"card-info"},ys={class:"port-text"},ks={class:"quick-actions"},Cs={class:"system-info"},$s={class:"info-grid"},xs={class:"info-item"},Ns={class:"info-value"},Ts={class:"info-item"},Ds={class:"info-value"},zs={class:"info-item"},Ms={class:"info-item"},Os={class:"info-value"},Vs={class:"recent-logs"},Ws={class:"logs-container"},Es={key:0,class:"no-logs"},Ls={key:1,class:"logs-list"},Ps={class:"log-time"},Bs={class:"log-content"},Is=A({__name:"Dashboard",setup(l){const c=Z(),e=j(),_=ns(),S=w(new Date),f=w([]),x=__APP_VERSION__,p=$(()=>{switch(e.status?.status){case"running":return"运行中";case"starting":return"启动中";case"stopping":return"停止中";case"stopped":default:return"已停止"}}),N=$(()=>{switch(e.status?.status){case"running":return"status-running";case"starting":case"stopping":return"status-warning";case"stopped":default:return"status-stopped"}}),y=$(()=>_.connected?"已连接":"未连接"),k=$(()=>_.connected?"status-connected":"status-disconnected"),D=async()=>{try{await e.startServer(),c.success("服务器启动指令已发送")}catch(a){c.error(a.message||"启动服务器失败")}},z=async()=>{try{await e.stopServer(),c.success("服务器停止指令已发送")}catch(a){c.error(a.message||"停止服务器失败")}},M=async()=>{try{await e.restartServer(),c.success("服务器重启指令已发送")}catch(a){c.error(a.message||"重启服务器失败")}},O=a=>{const t=Math.floor(a/3600),g=Math.floor(a%3600/60),u=Math.floor(a%60);return t>0?`${t}小时${g}分钟`:g>0?`${g}分钟${u}秒`:`${u}秒`},V=a=>a.toLocaleTimeString("zh-CN"),W=a=>a.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});return K(()=>{e.fetchStatus(),_.connect(),setInterval(()=>{S.value=new Date},1e3),f.value=[{time:new Date,content:"服务器启动完成"},{time:new Date(Date.now()-6e4),content:"世界加载完成"},{time:new Date(Date.now()-12e4),content:"配置文件已加载"}]}),Q(()=>{_.disconnect()}),(a,t)=>{const g=d("i-carbon-server"),u=ss,E=d("i-carbon-user-multiple"),L=d("i-carbon-earth"),P=d("i-carbon-network-3"),B=d("i-carbon-play"),b=es,I=d("i-carbon-stop"),J=d("i-carbon-restart"),R=d("i-carbon-settings"),U=ts,F=d("i-carbon-document");return m(),v("div",as,[t[19]||(t[19]=s("div",{class:"dashboard-header"},[s("h1",null,"仪表板"),s("p",null,"泰拉瑞亚服务器管理概览")],-1)),s("div",rs,[o(u,{class:"status-card",hoverable:""},{default:n(()=>[s("div",ls,[s("div",is,[o(g)]),s("div",cs,[t[2]||(t[2]=s("h3",null,"服务器状态",-1)),s("p",{class:T(["status-text",N.value])},i(p.value),3),r(e).status?.uptime?(m(),v("small",us," 运行时间: "+i(O(r(e).status.uptime)),1)):X("",!0)])])]),_:1}),o(u,{class:"status-card",hoverable:""},{default:n(()=>[s("div",ds,[s("div",_s,[o(E)]),s("div",ps,[t[3]||(t[3]=s("h3",null,"在线玩家",-1)),s("p",vs,i(r(e).status?.player_count||0)+" / "+i(r(e).status?.max_players||0),1),t[4]||(t[4]=s("small",null,"当前在线人数",-1))])])]),_:1}),o(u,{class:"status-card",hoverable:""},{default:n(()=>[s("div",ms,[s("div",fs,[o(L)]),s("div",gs,[t[5]||(t[5]=s("h3",null,"当前世界",-1)),s("p",bs,i(r(e).status?.world_name||"未设置"),1),t[6]||(t[6]=s("small",null,"活跃世界",-1))])])]),_:1}),o(u,{class:"status-card",hoverable:""},{default:n(()=>[s("div",hs,[s("div",ws,[o(P)]),s("div",Ss,[t[7]||(t[7]=s("h3",null,"服务器端口",-1)),s("p",ys,i(r(e).status?.port||7777),1),t[8]||(t[8]=s("small",null,"监听端口",-1))])])]),_:1})]),s("div",ks,[o(u,{title:"快速操作",hoverable:""},{default:n(()=>[o(U,null,{default:n(()=>[o(b,{type:"primary",size:"large",loading:r(e).loading,disabled:r(e).status?.status==="running",onClick:D},{icon:n(()=>[o(B)]),default:n(()=>[t[9]||(t[9]=h(" 启动服务器 ",-1))]),_:1},8,["loading","disabled"]),o(b,{type:"warning",size:"large",loading:r(e).loading,disabled:r(e).status?.status!=="running",onClick:z},{icon:n(()=>[o(I)]),default:n(()=>[t[10]||(t[10]=h(" 停止服务器 ",-1))]),_:1},8,["loading","disabled"]),o(b,{type:"info",size:"large",loading:r(e).loading,onClick:M},{icon:n(()=>[o(J)]),default:n(()=>[t[11]||(t[11]=h(" 重启服务器 ",-1))]),_:1},8,["loading"]),o(b,{size:"large",onClick:t[0]||(t[0]=C=>a.$router.push("/server"))},{icon:n(()=>[o(R)]),default:n(()=>[t[12]||(t[12]=h(" 服务器设置 ",-1))]),_:1})]),_:1})]),_:1})]),s("div",Cs,[o(u,{title:"系统信息",hoverable:""},{default:n(()=>[s("div",$s,[s("div",xs,[t[13]||(t[13]=s("span",{class:"info-label"},"面板版本:",-1)),s("span",Ns,i(r(x)),1)]),s("div",Ts,[t[14]||(t[14]=s("span",{class:"info-label"},"泰拉瑞亚版本:",-1)),s("span",Ds,i(r(e).status?.version||"未知"),1)]),s("div",zs,[t[15]||(t[15]=s("span",{class:"info-label"},"WebSocket连接:",-1)),s("span",{class:T(["info-value",k.value])},i(y.value),3)]),s("div",Ms,[t[16]||(t[16]=s("span",{class:"info-label"},"最后更新:",-1)),s("span",Os,i(V(S.value)),1)])])]),_:1})]),s("div",Vs,[o(u,{title:"最近日志",hoverable:""},{"header-extra":n(()=>[o(b,{size:"small",onClick:t[1]||(t[1]=C=>a.$router.push("/server"))},{default:n(()=>[...t[17]||(t[17]=[h(" 查看全部 ",-1)])]),_:1})]),default:n(()=>[s("div",Ws,[f.value.length===0?(m(),v("div",Es,[o(F),t[18]||(t[18]=s("p",null,"暂无日志",-1))])):(m(),v("div",Ls,[(m(!0),v(G,null,Y(f.value,(C,H)=>(m(),v("div",{key:H,class:"log-item"},[s("span",Ps,i(W(C.time)),1),s("span",Bs,i(C.content),1)]))),128))]))])]),_:1})])])}}}),Hs=os(Is,[["__scopeId","data-v-b20a3f94"]]);export{Hs as default};
