import{ah as Ne,ad as Se,K as Pe,M as Re}from"./ui-vendor-Dblj447Y.js";import{k as _e,r as Ee,e as M,a0 as d,c as b,m as c,g as ke,n as Ae,o as $e,w as $,t as Te,Z as L,Q as U,s as Fe,J as f,S as C,R as P,X as Ve,q as Oe,j as x}from"./vue-vendor-DgJqRHrX.js";const g={MOBILE:/^(?:(?:\+|00)86)?1[3-9]\d{9}$/,ID_CARD:/^\d{15}$|^\d{18}$|^\d{17}[\dXx]$/,EMAIL:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,USERNAME:/^[a-zA-Z0-9_]{3,20}$/,PASSWORD:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d@$!%*?&]{6,20}$/,URL:/^https?:\/\/.+/,IP:/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/};function i(t="blur",r,l){return{trigger:t,validator:async(s,n)=>{if(!r(n))throw new Error(l)},message:l}}function Ie(t="blur",r,l){return{trigger:t,validator:async(s,n)=>{if(!await r(n))throw new Error(l)},message:l}}const h={required:(t,r=["blur","input"])=>i(r,l=>l==null?!1:typeof l=="string"?l.trim()!=="":Array.isArray(l)?l.length>0:typeof l=="object"?Object.keys(l).length>0:!!l,`${t}不能为空`),length:(t,r,l)=>i("blur",s=>{if(!s)return!0;const n=String(s).length;return l!==void 0?n>=r&&n<=l:n>=r},l?`${t}长度需在${r}-${l}位之间`:`${t}长度至少${r}位`),range:(t,r,l)=>i("blur",s=>{if(!s&&s!==0)return!0;const n=Number(s);return isNaN(n)?!1:n>=r&&n<=l},`${t}必须在${r}-${l}之间`),mobile:(t="手机号")=>i("blur",r=>!r||g.MOBILE.test(r),`${t}格式错误`),idCard:(t="身份证号")=>i("blur",r=>!r||g.ID_CARD.test(r),`${t}格式错误`),email:(t="邮箱")=>i("blur",r=>!r||g.EMAIL.test(r),`${t}格式错误`),username:(t="用户名")=>i("blur",r=>!r||g.USERNAME.test(r),`${t}只能包含字母、数字、下划线，长度3-20位`),strongPassword:(t="密码")=>i("blur",r=>!r||g.PASSWORD.test(r),`${t}必须包含大小写字母和数字，长度6-20位`),url:(t="链接")=>i("blur",r=>!r||g.URL.test(r),`${t}格式错误`),ip:(t="IP地址")=>i("blur",r=>!r||g.IP.test(r),`${t}格式错误`),confirmPassword:(t,r)=>i("blur",l=>!l||l===r(),`${t}不一致`),pattern:(t,r,l)=>i("blur",s=>!s||r.test(s),l||`${t}格式错误`),asyncCheck:(t,r,l)=>Ie("blur",r,l||`${t}验证失败`)};function Be(t){return t.length<=1?t:[{trigger:["blur","input"],validator:async(r,l)=>{for(const s of t)try{await s.validator?.(s,l,()=>{},{},{})}catch(n){throw n}}}]}const Le={username:(t="用户名")=>[h.required(t),h.username(t)],password:(t="密码")=>[h.required(t),h.strongPassword(t)],email:(t="邮箱")=>[h.required(t),h.email(t)],mobile:(t="手机号")=>[h.required(t),h.mobile(t)],confirmPassword:(t,r)=>[h.required(t),h.confirmPassword(t,r)]},Ue=_e({__name:"index",props:{options:{},modelValue:{},layoutType:{default:"default"},layoutConfig:{default:()=>({})},validateOnValueChange:{type:Boolean,default:!1},labelPlacement:{default:"left"},labelWidth:{default:"auto"},showRequireMark:{type:Boolean},size:{default:"medium"},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},showDefaultActions:{type:Boolean,default:!0}},emits:["submit","update:modelValue","validate-success","validate-error","fields-change","editor-mounted","on-preview","on-remove","before-remove","on-exceed","on-success","tab-change","step-change","step-before-change","step-validate","field-add","field-remove","field-toggle","fields-clear","render-mode-change","group-toggle","group-reset"],setup(t,{expose:r,emit:l}){const s=t,n=l,p=Ee(null),u=M({}),v=M({}),T={default:"Default",inline:"Inline",grid:"Grid",card:"Card",tabs:"Tabs",steps:"Steps",dynamic:"Dynamic",custom:"Custom"},q={input:d("NInput"),textarea:d("NInput"),inputNumber:d("NInputNumber"),switch:d("NSwitch"),slider:d("NSlider"),rate:d("NRate"),datePicker:d("NDatePicker"),daterange:d("NDatePicker"),timePicker:d("NTimePicker"),cascader:d("NCascader"),colorPicker:d("NColorPicker")},G=["select","checkbox","radio","upload","editor"],z={input:"",textarea:"",editor:"",select:null,datePicker:null,daterange:null,timePicker:null,cascader:null,colorPicker:null,checkbox:null,upload:[],radio:"",inputNumber:null,slider:null,rate:null,switch:null},j=["steps","custom"],W=b(()=>T[s.layoutType]||T.default),Z=b(()=>({type:s.layoutType,...s.layoutConfig})),R=b(()=>!(s.showDefaultActions===!1||j.includes(s.layoutType))),F=b(()=>s.options.filter(e=>e.show!==!1)),K=b(()=>F.value.map(e=>c(d("NFormItem"),{label:e.label,path:e.prop,key:e.prop,required:!!e.rules?.length},{default:()=>X(e)}))),X=e=>{try{if(G.includes(e.type))return Y(e);const a=q[e.type];return a?c(a,{...V(e),...e.attrs}):null}catch{return null}},Y=e=>{const a=V(e);switch(e.type){case"select":return c(d("NSelect"),{...a,options:e.children?.map(o=>({value:o.value,label:o.label,disabled:o.disabled}))||[],...e.attrs});case"checkbox":return c(d("NCheckboxGroup"),{...a,...e.attrs},{default:()=>c(d("NSpace"),{},{default:()=>e.children?.map(o=>c(d("NCheckbox"),{value:o.value,label:o.label,disabled:o.disabled,key:String(o.value)}))||[]})});case"radio":return c(d("NRadioGroup"),{...a,...e.attrs},{default:()=>c(d("NSpace"),{},{default:()=>e.children?.map(o=>c(d("NRadio"),{value:o.value,disabled:o.disabled,key:String(o.value)},{default:()=>o.label}))||[]})});case"upload":return J(e);case"editor":return H(e);default:return null}},H=e=>c(d("C_Editor"),{editorId:`editor-${e.prop}`,modelValue:u[e.prop]||"",placeholder:e.placeholder,disabled:s.disabled,readonly:s.readonly,"onUpdate:modelValue":a=>{u[e.prop]=a,_(e.prop)},"onEditor-mounted":a=>{n("editor-mounted",{editor:a,prop:e.prop,html:u[e.prop]||""})},...e.attrs}),J=e=>{const a=ke();return c(d("NUpload"),{fileList:u[e.prop]||[],"onUpdate:fileList":o=>{u[e.prop]=o,_(e.prop)},onPreview:o=>n("on-preview",o),onRemove:o=>n("on-remove",o),onBeforeRemove:o=>n("before-remove",o),onExceed:o=>n("on-exceed",o),onSuccess:o=>n("on-success",o),...e.attrs},{trigger:()=>a?.slots.uploadClick?.()||c(d("NButton"),{type:"primary"},{default:()=>"选择文件"}),tip:()=>a?.slots.uploadTip?.()||null})},V=e=>{const a={value:u[e.prop],"onUpdate:value":o=>{u[e.prop]=o,_(e.prop)}};return e.type==="textarea"&&(a.type="textarea"),e.placeholder&&(a.placeholder=e.placeholder),a},O=e=>z[e]??null,_=e=>{s.validateOnValueChange&&Ae(()=>{m(e).catch(()=>{})})},E=()=>{try{Object.keys(v).forEach(e=>delete v[e]),s.options.forEach(e=>{u[e.prop]=e.value!==void 0?e.value:O(e.type),e.rules?.length&&(v[e.prop]=Be(e.rules))})}catch{}},w=async()=>{if(!p.value)throw new Error("[C_Form] 表单引用不存在");try{await p.value.validate(),n("validate-success",S())}catch(e){throw n("validate-error",e),e}},m=async e=>{if(!p.value)throw new Error("[C_Form] 表单引用不存在");const a=Array.isArray(e)?e:[e];await p.value.validate(a)},k=e=>{p.value&&(e?(Array.isArray(e)?e:[e]).forEach(o=>{if(u[o]!==void 0){const y=u[o];u[o]=y}}):p.value.restoreValidation())},N=async(e,a)=>{try{const o=s.options.filter(e).map(y=>y.prop);return o.length===0||await m(o),!0}catch{return!1}},Q=async e=>{const a=s.layoutConfig?.steps?.steps?.[e]?.key;return a?N(o=>o.layout?.step===a):!0},ee=async e=>N(a=>a.layout?.tab===e),te=async()=>N(e=>!!e.layout?.dynamic),ae=async e=>N(a=>a.layout?.group===e),re=e=>{n("fields-change",e)},oe=e=>n("tab-change",e),ne=(e,a)=>n("step-change",e,a),le=async(e,a)=>(n("step-before-change",e,a),!0),se=async e=>{try{const a=s.layoutConfig?.steps?.steps?.[e]?.key;if(!a)return!0;const o=s.options.filter(y=>y.layout?.step===a).map(y=>y.prop);return o.length===0||(await m(o),n("step-validate",e)),!0}catch{return!1}},ue=e=>n("field-add",e),de=e=>n("field-remove",e),ce=(e,a)=>n("field-toggle",e,a),ie=()=>n("fields-clear"),pe=e=>n("render-mode-change",e),fe=(e,a)=>n("group-toggle",e,a),ye=e=>n("group-reset",e),he=async()=>{try{await w(),n("submit",{model:S(),form:p.value})}catch{}},I=()=>{try{k(),s.options.forEach(e=>{const a=e.value!==void 0?e.value:O(e.type);u[e.prop]=a})}catch{}},B=()=>I(),D=e=>{Object.assign(u,e)},S=()=>({...u}),ge=async(e,a,o=!1)=>{u[e]=a,o&&await m(e)},me=e=>u[e],be=async(e,a=!1)=>{Object.assign(u,e),a&&await w()};return $e(()=>{E(),$(()=>s.options,()=>E(),{deep:!0}),$(()=>s.modelValue,e=>{e&&Object.assign(u,e)},{immediate:!0,deep:!0}),$(u,e=>n("update:modelValue",{...e}),{deep:!0})}),r({validate:w,validateField:m,validateStep:Q,validateTab:ee,validateDynamicFields:te,validateCustomGroup:ae,clearValidation:k,getModel:S,setFields:D,resetFields:B,setFieldValue:ge,getFieldValue:me,setFieldsValue:be,formRef:p,formModel:u,initialize:E,layoutType:Te(s,"layoutType"),shouldShowDefaultActions:R}),(e,a)=>{const o=d("DynamicComponent"),y=Re,Ce=Pe,ve=Se,we=Ne;return U(),L(we,Fe({ref_key:"formRef",ref:p,model:f(u),rules:f(v),"validate-on-rule-change":!1,"label-placement":t.labelPlacement,"label-width":t.labelWidth,size:t.size,disabled:t.disabled,readonly:t.readonly},e.$attrs),{default:C(()=>[P(o,{name:f(W),"form-items":f(K),"layout-config":f(Z),options:f(F),"form-data":f(u),"show-default-actions":f(R),onTabChange:oe,onStepChange:ne,onStepBeforeChange:le,onStepValidate:se,onFieldAdd:ue,onFieldRemove:de,onFieldToggle:ce,onFieldsClear:ie,onRenderModeChange:pe,onGroupToggle:fe,onGroupReset:ye,onValidateSuccess:a[0]||(a[0]=A=>n("validate-success",A)),onValidateError:a[1]||(a[1]=A=>n("validate-error",A)),onFieldsChange:re},null,8,["name","form-items","layout-config","options","form-data","show-default-actions"]),f(R)?(U(),L(ve,{key:0,class:"mt-5"},{default:C(()=>[Oe(e.$slots,"action",{form:f(p),model:f(u),validate:w,validateField:m,reset:B,setFields:D,getModel:S,clearValidation:k},()=>[P(Ce,null,{default:C(()=>[P(y,{type:"primary",onClick:he},{default:C(()=>[...a[2]||(a[2]=[x("提交",-1)])]),_:1}),P(y,{onClick:I},{default:C(()=>[...a[3]||(a[3]=[x("重置",-1)])]),_:1})]),_:1})])]),_:3})):Ve("",!0)]),_:3},16,["model","rules","label-placement","label-width","size","disabled","readonly"])}}});export{h as P,Le as R,Ue as _};
