import{r as c,k as P,ag as Q,o as Z,n as K,c as ee,O as F,Z as R,X as z,S as v,J as s,Q as m,_ as N,R as h,P as b,ai as te,j as ae}from"./vue-vendor-DIhTWhib.js";import{a as re}from"./robot-avatar-1-CBzFR956.js";import{n as j,d as se,f as oe,l as ne,i as T,h as le}from"./index-CAzJpzbq.js";import{u as ie}from"./index-Dn66_L_1.js";import ue from"./index-De6-uA5J.js";import ce from"./Typewriter-CYjfrikF.js";import{H as me,ab as de,Y as ge,T as pe,M as fe,X as ve}from"./ui-vendor-qucRfopV.js";import"./spline-vendor-BYERog9l.js";import"./charts-vendor-XI8Sg87J.js";import"./editor-vendor-CUlQiixb.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const he=()=>{const w=c(!1),M=()=>{j.error({content:"表单实例未准备好",duration:3e3})},i=async a=>await a.form.validate(),_=(a,r)=>{if(a.code===(r.successCode||"0")){r.onSuccess?.(a);const p=r.successMsg||"提交成功";let n;return r.meta&&(n=typeof r.meta=="function"?r.meta(a):r.meta),j.success({content:p,meta:n,duration:3e3}),!0}return!1},k=(a,r)=>{r.globalErrorHandler&&r.globalErrorHandler(a),j.error({content:a instanceof Error?a.message:"提交失败",duration:3e3})};return{loading:w,createSubmit:(a,r={})=>{const p=r.debounce!==!1?ie(a,r.debounce||500):a;return async n=>{if(!n.form){M();return}try{await i(n),w.value=!0;const o=await p(n.model);if(_(o,r))return o;throw new Error(o.message||r.errorMsg||"操作失败")}catch(o){throw k(o,r),o}finally{w.value=!1}}}}},_e="1.2.0.14",ye={class:"login-container bg-[#181818]"},be={class:"login-wrapper"},we={class:"login-title"},ke={class:"version-info",style:{"text-align":"center",color:"#666","font-size":"12px","margin-bottom":"10px"}},Se={key:0,style:{"text-align":"center",padding:"20px"}},Ie=P({__name:"index",setup(w){const M=_e,i=c("login"),_=c(!0),k=Q(),x=se(),a=me(),{loading:r,createSubmit:p}=he(),n=c(null),o=c({username:"",password:"",email:""}),I=c(!1);Z(async()=>{K(()=>{I.value=!0});try{_.value=!0;const e=await oe();if(e.data){const t=e.data.initialized;i.value=t?"login":"register"}else i.value="login"}catch{a.error("检查系统状态失败"),i.value="login"}finally{_.value=!1}});const B=ee(()=>{const e={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:30,message:"密码长度在 6 到 30 个字符",trigger:"blur"}]};return i.value==="register"?{...e,email:[{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}]}:e}),E=c(!0),H=c(),d=c(!1),u=c(null),S={timeSlots:[{hours:[6,12],greeting:"早上好",emoji:"🌅"},{hours:[12,14],greeting:"中午好",emoji:"☀️"},{hours:[14,18],greeting:"下午好",emoji:"🌤️"},{hours:[18,22],greeting:"晚上好",emoji:"🌆"},{hours:[22,24,0,6],greeting:"夜深了",emoji:"🌙"}],templates:["{greeting}，{username}！欢迎回来～ {emoji}","{emoji} {greeting}，{username}！开始今天的工作吧","欢迎回来，{username}！{greeting} {emoji}","{greeting}，{username}！准备好了吗？ {emoji}"]},D=()=>{const e=new Date().getHours();return S.timeSlots.find(({hours:l})=>l.length===2?e>=l[0]&&e<l[1]:l.includes(e))||S.timeSlots[0]},V=e=>{const t=e.data?.username||"CHENY",{greeting:l,emoji:g}=D();return S.templates[Math.floor(Math.random()*S.templates.length)].replace("{greeting}",l).replace("{username}",t).replace("{emoji}",g)},A=()=>{},L=()=>{E.value=!1},O=e=>{d.value=!0,u.value=e,a.success("人机验证成功")},U=()=>{d.value=!1,u.value=null},q=e=>{d.value=e,e||(u.value=null)},C=()=>{d.value=!1,u.value=null,H.value?.reset()},G=()=>{if(!d.value||!u.value){a.error("请先完成人机验证");return}if(!n.value){a.error("表单初始化失败，请刷新页面重试");return}const{username:e,password:t}=o.value,l={form:n.value,model:{username:e,password:t,captcha:{token:u.value.token,timestamp:u.value.timestamp,type:"puzzle-captcha"}}};W(l)},W=p(ne,{successMsg:"登录成功",meta:V,errorMsg:"账号或密码错误",onSuccess:async e=>{try{const{data:{token:t}}=e;x.handleLoginSuccess(t),await T(),k.push("/terraria/dashboard")}catch{C()}},globalErrorHandler:e=>{C()}}),X=()=>{if(!d.value||!u.value){a.error("请先完成人机验证");return}if(!n.value){a.error("表单初始化失败，请刷新页面重试");return}const{username:e,password:t,email:l}=o.value,g={form:n.value,model:{username:e,password:t,email:l||void 0,captcha:{token:u.value.token,timestamp:u.value.timestamp,type:"puzzle-captcha"}}};Y(g)},Y=p(le,{successMsg:"注册成功",errorMsg:"注册失败",onSuccess:async e=>{try{const{data:{token:t}}=e;x.handleLoginSuccess(t),await T(),i.value="login",a.success("注册成功！正在跳转..."),setTimeout(()=>{k.push("/terraria/dashboard")},1e3)}catch{C()}},globalErrorHandler:e=>{C()}});return(e,t)=>{const l=de,g=pe,y=ge,$=fe,J=ve;return b(),F("div",ye,[s(E)?(b(),R(ce,{key:0,text:"Hey！伙计，欢迎来到泰拉瑞亚。",duration:2e3,delay:300,"pause-after":1e3,onComplete:A,onHidden:L})):z("",!0),v("div",be,[t[5]||(t[5]=v("div",{class:"robot-avatar"},[v("img",{src:re,alt:"Robot Avatar"})],-1)),v("h3",we,N(s(i)==="register"?"首次注册":"泰拉瑞亚管理面板"),1),v("div",ke," 版本: v"+N(s(M)),1),s(_)?(b(),F("div",Se,[m(l,{size:"small"}),t[4]||(t[4]=v("p",{style:{"margin-top":"10px",color:"#999"}},"正在检查系统状态...",-1))])):(b(),R(J,{key:1,ref_key:"formRef",ref:n,class:"login-form",model:s(o),rules:s(B)},{default:h(()=>[m(y,{label:"用户名",path:"username"},{default:h(()=>[m(g,{value:s(o).username,"onUpdate:value":t[0]||(t[0]=f=>s(o).username=f),placeholder:"请输入用户名",clearable:""},null,8,["value"])]),_:1}),m(y,{label:"密码",path:"password"},{default:h(()=>[m(g,{value:s(o).password,"onUpdate:value":t[1]||(t[1]=f=>s(o).password=f),type:"password",placeholder:"请输入密码","show-password-on":"mousedown",clearable:""},null,8,["value"])]),_:1}),s(i)==="register"?(b(),R(y,{key:0,label:"邮箱（可选）",path:"email"},{default:h(()=>[m(g,{value:s(o).email,"onUpdate:value":t[2]||(t[2]=f=>s(o).email=f),placeholder:"请输入邮箱",clearable:""},null,8,["value"])]),_:1})):z("",!0),m(y,null,{default:h(()=>[m($,{class:"login-btn",type:"primary",loading:s(r),disabled:!s(d),onClick:t[3]||(t[3]=te(f=>s(i)==="register"?X():G(),["prevent"]))},{default:h(()=>[ae(N(s(d)?s(i)==="register"?"注册":"登录":"请先点击下方图标完成人机验证"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model","rules"])),m(ue,{ref_key:"captchaRef",ref:H,class:"login-captcha","trigger-text":"",theme:"dark",onSuccess:O,onFail:U,onChange:q},null,512)])])}}});export{Ie as default};
