import ze from"./index-B144fC0P.js";import De from"./index-Dx1Z0Rb1.js";import Ie from"./index-CmtMtyJe.js";import{m as f,k as Re,r as b,e as W,c as _,P as j,Q as v,R as a,X as A,S as s,ah as Me,J as l,j as d,F as Le,M as Fe,Z as z,H as Oe,U as L,_ as k,a2 as V,ak as Ee}from"./vue-vendor-DgJqRHrX.js";import{u as qe}from"./useTableData-5GmbMwfo.js";import{L as K,H as Be,K as je,a0 as Ve,af as Ge,M as Ke,X as Ze,a4 as He,a5 as Xe,at as Ye,ah as Je,ad as Qe,a2 as We,U as et,ap as tt}from"./ui-vendor-Dblj447Y.js";import{f as te,h as lt,p as at}from"./index-DbHuSC4d.js";import{_ as st}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./charts-vendor-DjXuxi75.js";import"./TableEditModal-bjxWmP9M.js";import"./index.vue_vue_type_script_setup_true_lang-D3cPmkgY.js";import"./data-Cf-TtYuJ.js";import"./iconify-sN5qq56k.js";import"./index-D3z4ySpN.js";import"./robot-avatar-1-CBzFR956.js";import"./spline-vendor-Btm54g1Q.js";import"./editor-vendor-BwkH8h9-.js";const c={module:{text:"模块权限",type:"info",icon:"material-symbols:dashboard",color:"#1890ff",description:"系统功能模块访问权限"},function:{text:"功能权限",type:"success",icon:"material-symbols:settings",color:"#52c41a",description:"具体功能操作权限"},button:{text:"按钮权限",type:"warning",icon:"material-symbols:touch-app",color:"#fa8c16",description:"页面按钮操作权限"},api:{text:"API权限",type:"error",icon:"material-symbols:api",color:"#f5222d",description:"接口访问权限"}},ot={1:{text:"启用",type:"success"},0:{text:"禁用",type:"error"}},D={permissionType:[{label:"模块权限",value:"module"},{label:"功能权限",value:"function"},{label:"按钮权限",value:"button"},{label:"API权限",value:"api"}],permissionStatus:[{label:"启用",value:1},{label:"禁用",value:0}]},C=[{label:"系统管理",value:"system"},{label:"用户管理",value:"user"},{label:"角色管理",value:"role"},{label:"权限管理",value:"permission"},{label:"菜单管理",value:"menu"},{label:"字典管理",value:"dict"},{label:"配置管理",value:"config"},{label:"日志管理",value:"log"},{label:"监控管理",value:"monitor"},{label:"文件管理",value:"file"}],nt=()=>[{key:"name",title:"权限名称",width:120,fixed:"left",editable:!0,required:!0,editType:"input",editProps:{placeholder:"请输入权限名称",rules:[{required:!0,message:"请输入权限名称"},{min:2,max:50,message:"权限名称长度在 2 到 50 个字符"}]}},{key:"code",title:"权限编码",width:220,editable:!1,render:r=>f("code",{class:"permission-code"},r.code)},{key:"type",title:"权限类型",width:120,editable:!0,required:!0,editType:"select",editProps:{options:D.permissionType},render:r=>{const u=c[r.type];return u?f(K,{type:u.type,size:"small",class:"permission-type-tag"},{default:()=>u.text,icon:()=>f("i",{class:`iconify ${u.icon} type-icon`})}):f("span",{class:"permission-type-unknown"},r.type)}},{key:"module",title:"所属模块",width:120,editable:!0,required:!0,editType:"select",editProps:{options:C},render:r=>{const u=C.find(h=>h.value===r.module)?.label||r.module;return f("span",{class:"module-tag"},u)}},{key:"description",title:"描述",width:200,editable:!0,editType:"textarea",editProps:{rows:2,placeholder:"请输入权限描述"},render:r=>r.description||"-"},{key:"resources",title:"关联资源",width:160,render:r=>!r.resources||r.resources.length===0?"-":f("div",{class:"resource-list"},r.resources.map(u=>f("div",{class:"resource-item"},u)))},{key:"sort",title:"排序",width:80,editable:!0,editType:"number",editProps:{min:0,max:9999,placeholder:"排序"}},{key:"status",title:"状态",width:80,render:r=>{const u=ot[r.status];return f(K,{type:u.type,size:"small",class:`permission-status status-${r.status===1?"active":"inactive"}`},{default:()=>u.text})}},{key:"createTime",title:"创建时间",width:160,render:r=>typeof r.createTime=="number"?new Date(r.createTime).toLocaleString():String(r.createTime)}],it={name:[{required:!0,message:"请输入权限名称",trigger:["input","blur"]},{min:2,max:50,message:"权限名称长度在 2 到 50 个字符",trigger:["input","blur"]}],code:[{required:!0,message:"请输入权限编码",trigger:["input","blur"]},{pattern:/^[a-zA-Z][a-zA-Z0-9_:]*$/,message:"权限编码格式不正确，必须以字母开头，只能包含字母、数字、下划线和冒号",trigger:["input","blur"]}],type:[{required:!0,message:"请选择权限类型",trigger:["change","blur"]}],module:[{required:!0,message:"请选择所属模块",trigger:["change","blur"]}],sort:[{type:"number",required:!0,message:"请输入排序值",trigger:["input","blur"]},{type:"number",min:0,max:9999,message:"排序值必须在 0-9999 之间",trigger:["input","blur"]}]},G={name:"",code:"",type:"button",module:"system",description:"",resources:"",status:1,sort:0,remark:""},rt=r=>te("/sys/permissionsList",{params:{page:r?.page!=null?String(r.page):void 0,pageSize:r?.pageSize!=null?String(r.pageSize):void 0}}),ee=r=>te(`/sys/permissions/${r}`),F=(r,u)=>at(`/sys/permissions/${r}`,u),ut=r=>lt(`/sys/permissions/${r}`),dt={class:"permission-management"},pt={class:"stat-icon-wrapper"},ct={class:"stat-content"},mt={class:"stat-label"},yt={class:"stat-value"},ft={key:0,class:"filter-tags"},bt=Re({__name:"index",setup(r){const u=Be(),h=b(!1),w=b(!1),S=b(!1),O=b(!1),x=b("add"),Z=b(null),le=b(),E=b(null),n=W({...G}),ae=it,i=W({keyword:"",status:null,type:null,module:null}),se=async t=>{const e=await rt(t);return{...e,data:{...e.data,list:e.data.list.map(m=>({...m,type:m.type}))}}},{tableData:q,loading:oe,refresh:g}=qe(se,{immediate:!0,defaultParams:{page:1,pageSize:10},onError:t=>{u.error("获取权限列表失败")}}),ne=_(()=>x.value==="add"?"新增权限":"编辑权限"),H=_(()=>!!(i.keyword||i.type||i.module||i.status!==null)),I=_(()=>{let t=[...q.value];if(i.keyword){const e=i.keyword.toLowerCase();t=t.filter(p=>(p.name||"").toLowerCase().includes(e)||(p.code||"").toLowerCase().includes(e)||(p.description||"").toLowerCase().includes(e))}return i.type&&(t=t.filter(e=>e.type===i.type)),i.module&&(t=t.filter(e=>e.module===i.module)),i.status!==null&&(t=t.filter(e=>e.status===i.status)),t}),ie=_(()=>H.value?`筛选出 ${I.value.length} 个权限`:`共 ${q.value.length} 个权限`),re=_(()=>nt()),ue=_(()=>{const t={module:0,function:0,button:0,api:0};return q.value.forEach(e=>{e.status===1&&t[e.type]++}),[{type:"module",label:"模块权限",value:t.module,icon:c.module.icon,color:c.module.color},{type:"function",label:"功能权限",value:t.function,icon:c.function.icon,color:c.function.color},{type:"button",label:"按钮权限",value:t.button,icon:c.button.icon,color:c.button.color},{type:"api",label:"API权限",value:t.api,icon:c.api.icon,color:c.api.color}]}),de={sections:[{title:"基本信息",columns:2,items:[{label:"权限名称",key:"name",type:"text"},{label:"权限编码",key:"code",type:"tag",tagType:"info"},{label:"权限类型",key:"type",type:"tag",tagType:"success",formatter:t=>c[t]?.text||t},{label:"所属模块",key:"module",type:"text",formatter:t=>C.find(e=>e.value===t)?.label||t},{label:"状态",key:"status",type:"tag",tagType:"success",formatter:t=>t===1?"启用":"禁用"},{label:"创建时间",key:"createTime",type:"text"}]},{title:"扩展信息",columns:1,items:[{label:"关联资源",key:"resources",type:"text",span:2,formatter:t=>Array.isArray(t)?t.join(", "):"无"},{label:"描述",key:"description",type:"text",span:2},{label:"备注",key:"remark",type:"text",span:2}]}]},pe=async()=>{h.value=!0;try{u.info("导出功能开发中...")}finally{h.value=!1}},ce=t=>{const e={...t};e.name=`${t.name} - 副本`,e.code=`${t.code}_copy`,X(e)},me=async t=>{try{const e=t.status===1?0:1;await F(t.id,{status:e}),await g(),u.success((e===1?"启用":"禁用")+"成功")}catch{u.error("操作失败")}},ye=_(()=>({edit:async t=>(await F(t.id,t),await g(),!0),delete:async t=>(await ut(t.id),await g(),!0),detail:async t=>{const{data:e}=await ee(t.id);return e},custom:[{key:"copy",label:"复制",icon:"material-symbols:content-copy",type:"info",onClick:t=>ce(t)},{key:"toggle",label:t=>t.status===1?"禁用":"启用",icon:t=>t.status===1?"material-symbols:pause":"material-symbols:play-arrow",type:t=>t.status===1?"warning":"success",onClick:t=>me(t)}]})),fe=t=>C.find(e=>e.value===t)?.label||t,be=t=>D.permissionType.find(e=>e.value===t)?.label||t,ve=t=>{i.type=i.type===t?null:t},R=t=>{i[t]=t==="status"||t==="type"||t==="module"?null:""},ge=()=>{Object.assign(i,{keyword:"",status:null,type:null,module:null})},M=()=>{},_e=async t=>{try{const e=t;await F(e.id,e),u.success("修改成功"),setTimeout(async()=>{await g()},500)}catch(e){throw u.error("保存失败"),e}},ke=async()=>{await g()},we=async t=>{try{O.value=!0;const{data:e}=await ee(t.id);E.value=e,S.value=!0}catch{u.error("获取详情失败")}finally{O.value=!1}},xe=()=>{E.value=null,S.value=!1},X=t=>{x.value=t?"edit":"add",t?Object.assign(n,{id:t.id,name:t.name,code:t.code,type:t.type,module:t.module,description:t.description||"",resources:Array.isArray(t.resources)?t.resources.join(", "):"",sort:t.sort,status:t.status,remark:t.remark||""}):Object.assign(n,G),w.value=!0},Ce=()=>{w.value=!1,Object.assign(n,G)},he=t=>{n.module&&t&&Y()},Y=()=>{if(!n.module||!n.type)return;const t={module:n.module,function:`${n.module}:manage`,button:`${n.module}:add`,api:`${n.module}:create`};n.code=t[n.type]||""},Se=async()=>{try{if(await Z.value?.validate(),x.value==="add")return u.info("请在后端提供创建接口或在 src/api/permission-manage.ts 增加 createPermissionApi"),!1;if(n.id!=null){const t={...n,resources:n.resources?n.resources.split(",").map(e=>e.trim()).filter(Boolean):[]};await F(n.id,t),await g(),u.success("修改成功")}return w.value=!1,!0}catch{return!1}};return(t,e)=>{const p=Ie,m=Ve,T=Ge,N=je,P=Ke,B=Ze,$=He,J=Xe,Q=Ye,U=K,Te=De,Ne=ze,y=Qe,Pe=We,$e=et,Ue=Je,Ae=tt;return v(),j("div",dt,[a(B,{class:"header-card"},{default:s(()=>[a(N,{justify:"space-between",align:"center"},{default:s(()=>[a(N,{class:"search-filters"},{default:s(()=>[a(m,{value:l(i).keyword,"onUpdate:value":e[0]||(e[0]=o=>l(i).keyword=o),placeholder:"搜索权限名称、编码、描述",clearable:"",style:{width:"300px"},onKeyup:Me(M,["enter"])},{prefix:s(()=>[a(p,{name:"material-symbols:search",size:16})]),_:1},8,["value"]),a(T,{value:l(i).type,"onUpdate:value":[e[1]||(e[1]=o=>l(i).type=o),M],placeholder:"权限类型",clearable:"",style:{width:"120px"},options:l(D).permissionType},null,8,["value","options"]),a(T,{value:l(i).module,"onUpdate:value":[e[2]||(e[2]=o=>l(i).module=o),M],placeholder:"所属模块",clearable:"",style:{width:"120px"},options:l(C)},null,8,["value","options"]),a(T,{value:l(i).status,"onUpdate:value":[e[3]||(e[3]=o=>l(i).status=o),M],placeholder:"权限状态",clearable:"",style:{width:"120px"},options:l(D).permissionStatus},null,8,["value","options"])]),_:1}),a(N,null,{default:s(()=>[a(P,{type:"primary",onClick:e[4]||(e[4]=o=>X())},{icon:s(()=>[a(p,{name:"material-symbols:add",size:16})]),default:s(()=>[e[21]||(e[21]=d(" 新增权限 ",-1))]),_:1}),a(P,{onClick:pe,loading:l(h)},{icon:s(()=>[a(p,{name:"material-symbols:download",size:16})]),default:s(()=>[e[22]||(e[22]=d(" 导出 ",-1))]),_:1},8,["loading"]),a(P,{onClick:l(g)},{icon:s(()=>[a(p,{name:"material-symbols:refresh",size:16})]),default:s(()=>[e[23]||(e[23]=d(" 刷新 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),a(J,{cols:4,"x-gap":16,class:"stat-grid"},{default:s(()=>[(v(!0),j(Le,null,Fe(l(ue),o=>(v(),z($,{key:o.type},{default:s(()=>[a(B,{size:"small",hoverable:"",class:Oe([{"stat-card-active":l(i).type===o.type},"stat-card-clickable"]),onClick:vt=>ve(o.type)},{default:s(()=>[a(N,{align:"center"},{default:s(()=>[L("div",pt,[a(p,{name:o.icon,size:24,color:o.color},null,8,["name","color"])]),L("div",ct,[L("div",mt,k(o.label),1),L("div",yt,k(o.value),1)])]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1}),l(H)?(v(),j("div",ft,[a(N,null,{default:s(()=>[a(Q,{depth:"3",style:{"margin-right":"8px"}},{default:s(()=>[...e[24]||(e[24]=[d(" 当前筛选： ",-1)])]),_:1}),l(i).keyword?(v(),z(U,{key:0,closable:"",onClose:e[5]||(e[5]=o=>R("keyword")),type:"info"},{default:s(()=>[d(" 关键词: "+k(l(i).keyword),1)]),_:1})):A("",!0),l(i).type?(v(),z(U,{key:1,closable:"",onClose:e[6]||(e[6]=o=>R("type")),type:"success"},{default:s(()=>[d(" 类型: "+k(be(l(i).type)),1)]),_:1})):A("",!0),l(i).module?(v(),z(U,{key:2,closable:"",onClose:e[7]||(e[7]=o=>R("module")),type:"warning"},{default:s(()=>[d(" 模块: "+k(fe(l(i).module)),1)]),_:1})):A("",!0),l(i).status!==null?(v(),z(U,{key:3,closable:"",onClose:e[8]||(e[8]=o=>R("status")),type:l(i).status===1?"success":"error"},{default:s(()=>[d(" 状态: "+k(l(i).status===1?"启用":"禁用"),1)]),_:1},8,["type"])):A("",!0),a(P,{text:"",size:"small",onClick:ge,type:"error"},{default:s(()=>[...e[25]||(e[25]=[d(" 清空筛选 ",-1)])]),_:1})]),_:1})])):A("",!0),a(B,{class:"content-card"},{header:s(()=>[a(Q,null,{default:s(()=>[e[26]||(e[26]=d(" 权限资源库 ",-1)),a(U,{type:"info",size:"small",style:{"margin-left":"8px"}},{default:s(()=>[d(k(l(ie)),1)]),_:1})]),_:1})]),default:s(()=>[a(Te,{ref_key:"tableRef",ref:le,data:l(I),"onUpdate:data":e[9]||(e[9]=o=>V(I)?I.value=o:null),columns:l(re),loading:l(oe),actions:l(ye),"edit-mode":"modal","modal-title":"编辑权限","modal-width":800,size:"small",striped:"",bordered:"",onSave:_e,onRowDelete:ke,onViewDetail:we},null,8,["data","columns","loading","actions","onViewDetail"])]),_:1}),a(Ne,{visible:l(S),"onUpdate:visible":e[10]||(e[10]=o=>V(S)?S.value=o:null),data:l(E)||{},config:de,title:"权限详情",loading:l(O),onClose:xe},null,8,["visible","data","loading"]),a(Ae,{show:l(w),"onUpdate:show":e[20]||(e[20]=o=>V(w)?w.value=o:null),preset:"dialog",title:l(ne),"positive-text":l(x)==="add"?"确认添加":"确认修改","negative-text":"取消",onPositiveClick:Se,onNegativeClick:Ce,style:{width:"700px"}},{default:s(()=>[a(Ue,{ref_key:"formRef",ref:Z,model:l(n),rules:l(ae),"label-placement":"left","label-width":"100px"},{default:s(()=>[a(J,{cols:2,"x-gap":16},{default:s(()=>[a($,null,{default:s(()=>[a(y,{label:"权限名称",path:"name"},{default:s(()=>[a(m,{value:l(n).name,"onUpdate:value":e[11]||(e[11]=o=>l(n).name=o),placeholder:"请输入权限名称"},null,8,["value"])]),_:1})]),_:1}),a($,null,{default:s(()=>[a(y,{label:"权限类型",path:"type"},{default:s(()=>[a(T,{value:l(n).type,"onUpdate:value":[e[12]||(e[12]=o=>l(n).type=o),he],options:l(D).permissionType},null,8,["value","options"])]),_:1})]),_:1}),a($,null,{default:s(()=>[a(y,{label:"所属模块",path:"module"},{default:s(()=>[a(T,{value:l(n).module,"onUpdate:value":e[13]||(e[13]=o=>l(n).module=o),options:l(C)},null,8,["value","options"])]),_:1})]),_:1}),a($,null,{default:s(()=>[a(y,{label:"排序",path:"sort"},{default:s(()=>[a(Pe,{value:l(n).sort,"onUpdate:value":e[14]||(e[14]=o=>l(n).sort=o),min:0,max:9999,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(y,{label:"权限编码",path:"code"},{default:s(()=>[a(m,{value:l(n).code,"onUpdate:value":e[15]||(e[15]=o=>l(n).code=o),placeholder:"自动生成或手动输入",disabled:l(x)==="edit"},Ee({_:2},[l(x)==="add"?{name:"suffix",fn:s(()=>[a(P,{text:"",size:"small",onClick:Y},{default:s(()=>[a(p,{name:"material-symbols:auto-fix",size:14})]),_:1})]),key:"0"}:void 0]),1032,["value","disabled"])]),_:1}),a(y,{label:"关联资源",path:"resources"},{default:s(()=>[a(m,{value:l(n).resources,"onUpdate:value":e[16]||(e[16]=o=>l(n).resources=o),type:"textarea",rows:2,placeholder:"请输入关联资源，多个用逗号分隔"},null,8,["value"])]),_:1}),a(y,{label:"权限描述",path:"description"},{default:s(()=>[a(m,{value:l(n).description,"onUpdate:value":e[17]||(e[17]=o=>l(n).description=o),type:"textarea",rows:3,placeholder:"请输入权限描述"},null,8,["value"])]),_:1}),a(y,{label:"权限状态",path:"status"},{default:s(()=>[a($e,{value:l(n).status,"onUpdate:value":e[18]||(e[18]=o=>l(n).status=o),"checked-value":1,"unchecked-value":0},{checked:s(()=>[...e[27]||(e[27]=[d("启用",-1)])]),unchecked:s(()=>[...e[28]||(e[28]=[d("禁用",-1)])]),_:1},8,["value"])]),_:1}),a(y,{label:"备注",path:"remark"},{default:s(()=>[a(m,{value:l(n).remark,"onUpdate:value":e[19]||(e[19]=o=>l(n).remark=o),type:"textarea",rows:2,placeholder:"请输入备注信息"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["show","title","positive-text"])])}}}),Rt=st(bt,[["__scopeId","data-v-578f9733"]]);export{Rt as default};
