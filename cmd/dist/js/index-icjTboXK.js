import{G as T,s as U}from"./charts-vendor-DjXuxi75.js";import{e as Z,a as ee,b as te}from"./exportUtils-pIheTlXt.js";import{K as ae,M as ie,O as le,ab as se,ah as oe,ad as ne,a0 as re,ae as ue,X as de,V as me,W as pe}from"./ui-vendor-Dblj447Y.js";import{k as fe,r as z,w as X,o as ce,P as y,Q as b,X as j,U as p,R as i,S as a,j as u,J as ge,L as ve,F as P,M as V,_ as E}from"./vue-vendor-DgJqRHrX.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";const be=[{label:"导出PNG",key:"png"},{label:"导出SVG",key:"svg"},{label:"导出JSON",key:"json"}],he={public:"+",private:"-",protected:"#"},ke={extends:{strokeDasharray:0,targetMarker:{name:"block",width:10,height:8,fill:"white",stroke:"#722ed1",strokeWidth:2}},implement:{strokeDasharray:"8,4",targetMarker:{name:"block",width:10,height:8,fill:"white",stroke:"#722ed1",strokeWidth:2}},composition:{strokeDasharray:0,sourceMarker:{name:"diamond",width:12,height:8,fill:"#722ed1",stroke:"#722ed1"}},aggregation:{strokeDasharray:0,sourceMarker:{name:"diamond",width:12,height:8,fill:"white",stroke:"#722ed1",strokeWidth:2}},association:{strokeDasharray:0,targetMarker:{name:"classic",size:8,fill:"#722ed1"}}},xe=["top","right","bottom","left"].reduce((g,h)=>{const D=h==="top"?{refX:.5,refY:0}:h==="right"?{refX:1,refY:.5}:h==="bottom"?{refX:.5,refY:1}:{refX:0,refY:.5};return g[`port-${h}`]={ref:"body",...D,r:4,fill:"#31d0c6",stroke:"#ffffff",strokeWidth:2,magnet:!0,style:{cursor:"crosshair",opacity:0,transition:"opacity 0.2s"}},g},{}),_e={inherit:"rect",markup:[{tagName:"rect",selector:"body"},{tagName:"rect",selector:"name-rect"},{tagName:"rect",selector:"attrs-rect"},{tagName:"rect",selector:"methods-rect"},{tagName:"text",selector:"name-text"},{tagName:"text",selector:"attrs-text"},{tagName:"text",selector:"methods-text"},{tagName:"circle",selector:"port-top"},{tagName:"circle",selector:"port-right"},{tagName:"circle",selector:"port-bottom"},{tagName:"circle",selector:"port-left"}],attrs:{rect:{width:160},body:{stroke:"#5f95ff",strokeWidth:1,fill:"#fff",magnet:!1,style:{cursor:"move"}},"name-rect":{fill:"#5f95ff",stroke:"#fff",strokeWidth:.5,magnet:!1,style:{cursor:"move"}},"attrs-rect":{fill:"#eff4ff",stroke:"#fff",strokeWidth:.5,magnet:!1,style:{cursor:"move"}},"methods-rect":{fill:"#eff4ff",stroke:"#fff",strokeWidth:.5,magnet:!1,style:{cursor:"move"}},"name-text":{ref:"name-rect",refY:.5,refX:.5,textAnchor:"middle",fontWeight:"bold",fill:"#fff",fontSize:12,pointerEvents:"none"},"attrs-text":{ref:"attrs-rect",refY:.5,refX:5,textAnchor:"left",fill:"black",fontSize:10,pointerEvents:"none"},"methods-text":{ref:"methods-rect",refY:.5,refX:5,textAnchor:"left",fill:"black",fontSize:10,pointerEvents:"none"},...xe}},we={grid:!0,panning:!0,mousewheel:{enabled:!0,zoomAtMousePosition:!0,modifiers:"ctrl",minScale:.5,maxScale:3}},Ce={router:"manhattan",connector:{name:"rounded",args:{radius:8}},allowBlank:!1,allowLoop:!1,allowNode:!1,snap:!0,allowEdge:!1},Ne={magnetAvailable:{name:"stroke",args:{attrs:{fill:"#31d0c6",stroke:"#31d0c6",opacity:1}}},magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF",opacity:1}}}},$e={shape:"extends",attrs:{line:{stroke:"#722ed1",strokeWidth:2,targetMarker:{name:"block",width:8,height:6,fill:"#722ed1"}}}},ze=[{id:"animal",name:`<<Abstract>>
动物`,x:342,y:98,attributes:[{name:"名字",type:"string",visibility:"public"}],methods:[{name:"新陈代谢",returnType:"void",visibility:"public"},{name:"繁殖",returnType:"void",visibility:"public"}]},{id:"bird",name:"鸟",x:575,y:280,attributes:[{name:"羽毛",type:"string",visibility:"public"},{name:"下蛋",type:"boolean",visibility:"public"}],methods:[]},{id:"mammal",name:"哺乳动物",x:844,y:319,attributes:[{name:"翅膀",type:"boolean",visibility:"public"}],methods:[]},{id:"dog",name:"狗",x:656,y:456,attributes:[{name:"下蛋",type:"boolean",visibility:"public"}],methods:[]},{id:"enterprise",name:"企鹅",x:984,y:456,attributes:[{name:"下蛋",type:"boolean",visibility:"public"}],methods:[]},{id:"sparrow",name:"麻雀",x:531,y:608,attributes:[{name:"学飞",type:"boolean",visibility:"public"}],methods:[]},{id:"interface-flying",name:`<<interface>>
飞翔`,x:762,y:608,attributes:[{name:"下蛋",type:"boolean",visibility:"public"}],methods:[]},{id:"qemu",name:"气球",x:981,y:608,attributes:[],methods:[]}],Ee=[{id:"edge-1",shape:"extends",source:"bird",target:"animal"},{id:"edge-2",shape:"extends",source:"mammal",target:"animal"},{id:"edge-3",shape:"extends",source:"dog",target:"mammal"},{id:"edge-4",shape:"extends",source:"enterprise",target:"mammal"},{id:"edge-5",shape:"extends",source:"sparrow",target:"bird"},{id:"edge-6",shape:"implement",source:"sparrow",target:"interface-flying"},{id:"edge-7",shape:"implement",source:"enterprise",target:"interface-flying"},{id:"edge-8",shape:"association",source:"bird",target:"mammal",label:"1:2"}],w=g=>he[g]||"+",De={name:"新类",attributes:[{name:"attribute",type:"string",visibility:"private"}],methods:[{name:"method",returnType:"void",visibility:"public"}],position:{x:100,y:100}},Se={class:"uml-layout"},Te={key:0,class:"toolbar"},Ue={key:0,class:"class-editor"},Ae={class:"section"},Fe={style:{display:"flex","justify-content":"between","align-items":"center"}},Me={style:{"font-size":"13px"}},We={class:"section"},Be={style:{display:"flex","justify-content":"between","align-items":"center"}},Ge={style:{"font-size":"13px"}},Xe=fe({__name:"index",props:{data:{},showToolbar:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1},width:{default:"100%"},height:{default:"600px"}},emits:["ready","data-change"],setup(g,{expose:h,emit:D}){const $=g,A=D,C=z(),s=z(),k=z(!1),d=z(),F=()=>s.value?.centerContent(),M=()=>s.value?.zoomToFit({padding:10,maxScale:1}),Y=(l={})=>{C.value&&(s.value=new T({container:C.value,width:C.value.clientWidth,height:C.value.clientHeight,...we,...l}))},I=()=>{T.registerNode("class",{..._e,propHooks(l){const{name:e,attributes:t,methods:o,...m}=l;if(!(e&&t&&o))return l;let c=0;return[{type:"name",text:e},{type:"attrs",text:t},{type:"methods",text:o}].forEach(r=>{const x=Array.isArray(r.text)?r.text.length*12+16:32;U(m,`attrs/${r.type}-text/text`,Array.isArray(r.text)?r.text.join(`
`):r.text),U(m,`attrs/${r.type}-rect/height`,x),U(m,`attrs/${r.type}-rect/transform`,`translate(0,${c})`),c+=x}),m.size={width:160,height:c},m}},!0),Object.entries(ke).forEach(([l,e])=>{T.registerEdge(l,{inherit:"edge",attrs:{line:{strokeWidth:2,stroke:"#722ed1",...e}}},!0)})},L=l=>{if(!s.value||!l.length)return;const e=["extends","composition","implement","aggregation","association"],t=[];l.forEach(o=>{if(e.includes(o.shape))t.push(s.value.createEdge(o));else{const{data:m,...c}=o,r=s.value.createNode(c);m&&r.setData(m),t.push(r)}}),s.value.resetCells(t),setTimeout(()=>s.value.zoomToFit({padding:10,maxScale:1}),200)},O=()=>{if(!s.value)return;s.value.on("node:dblclick",({node:t})=>{!$.readonly&&t.getData()&&R(t.getData())});const l=(t,o)=>{["top","right","bottom","left"].forEach(m=>t.attr(`port-${m}/style/opacity`,o))};s.value.on("node:mouseenter",({node:t})=>l(t,1)),s.value.on("node:mouseleave",({node:t})=>l(t,0)),s.value.on("edge:connected",()=>N()),s.value.on("edge:click",({edge:t})=>{s.value.getEdges().forEach(o=>{o.attr("line/stroke","#722ed1")}),t.attr("line/stroke","#ff4d4f")}),s.value.on("edge:dblclick",({edge:t})=>{t.remove(),N()}),s.value.on("blank:click",()=>{s.value.getEdges().forEach(t=>{t.attr("line/stroke","#722ed1")})}),s.value.on("node:click",()=>{s.value.getEdges().forEach(t=>{t.attr("line/stroke","#722ed1")})}),A("ready",s.value);const e=[...ze.map(t=>({id:t.id,shape:"class",x:t.x,y:t.y,name:t.name,attributes:t.attributes.map(o=>`${w(o.visibility)} ${o.name}: ${o.type}`),methods:t.methods.map(o=>`${w(o.visibility)} ${o.name}(): ${o.returnType}`),data:{id:t.id,name:t.name,attributes:t.attributes,methods:t.methods,position:{x:t.x,y:t.y}}})),...Ee];L(e)},W=()=>{const l={id:`class_${Date.now()}`,...De};if(!s.value)return;const e={id:l.id,shape:"class",x:l.position.x,y:l.position.y,name:l.name,attributes:l.attributes.map(t=>`${w(t.visibility)} ${t.name}: ${t.type}`),methods:l.methods.map(t=>`${w(t.visibility)} ${t.name}(): ${t.returnType}`),data:l};s.value.addCell(s.value.createNode(e)),N()},R=l=>{d.value={...l,attributes:[...l.attributes||[]],methods:[...l.methods||[]]},k.value=!0},q=()=>{if(!s.value||!d.value)return;const l=s.value.getCellById(d.value.id);l&&(l.setData(d.value),l.prop({name:d.value.name,attributes:d.value.attributes.map(e=>`${w(e.visibility)} ${e.name}: ${e.type}`),methods:d.value.methods.map(e=>`${w(e.visibility)} ${e.name}(): ${e.returnType}`)})),k.value=!1,N()},J=()=>{!s.value||!d.value||(s.value.getCellById(d.value.id)?.remove(),k.value=!1,N())},S=()=>({classes:s.value?.getNodes().map(l=>({...l.getData(),position:l.getPosition()}))||[],relations:[]}),H=l=>{if(!s.value)return;const e=S();({png:()=>te(s.value),svg:()=>ee(s.value),json:()=>Z(e)})[l]?.()},N=()=>A("data-change",S());return X(s,l=>{l&&(I(),O())},{immediate:!0}),X(()=>$.data,l=>{s.value},{deep:!0}),ce(()=>{Y({interacting:!0,connecting:{...Ce,createEdge:()=>s.value.createEdge($e),validateConnection:({sourceView:l,targetView:e,sourceMagnet:t,targetMagnet:o})=>l!==e&&!!t&&!!o&&t.getAttribute("magnet")==="true"&&o.getAttribute("magnet")==="true"},highlighting:Ne})}),h({getGraph:()=>s.value,getData:S,addClass:W,centerContent:F,zoomToFit:M}),(l,e)=>{const t=ie,o=le,m=ae,c=re,r=ne,x=ue,_=pe,B=me,G=de,K=oe,Q=se;return b(),y("div",Se,[g.showToolbar?(b(),y("div",Te,[i(m,null,{default:a(()=>[i(t,{onClick:W,type:"primary",size:"small"},{icon:a(()=>[...e[5]||(e[5]=[p("div",{class:"i-mdi-plus-box"},null,-1)])]),default:a(()=>[e[6]||(e[6]=u(" 添加类 ",-1))]),_:1}),i(t,{onClick:F,size:"small"},{icon:a(()=>[...e[7]||(e[7]=[p("div",{class:"i-mdi-image-filter-center-focus"},null,-1)])]),default:a(()=>[e[8]||(e[8]=u(" 居中 ",-1))]),_:1}),i(t,{onClick:M,size:"small"},{icon:a(()=>[...e[9]||(e[9]=[p("div",{class:"i-mdi-fit-to-screen"},null,-1)])]),default:a(()=>[e[10]||(e[10]=u(" 适应 ",-1))]),_:1}),i(o,{options:ge(be),onSelect:H},{default:a(()=>[i(t,{size:"small"},{icon:a(()=>[...e[11]||(e[11]=[p("div",{class:"i-mdi-export"},null,-1)])]),default:a(()=>[e[12]||(e[12]=u(" 导出 ",-1))]),_:1})]),_:1},8,["options"])]),_:1})])):j("",!0),p("div",{ref_key:"containerRef",ref:C,class:"graph-container",style:ve({width:$.width,height:$.height})},null,4),i(Q,{show:k.value,"onUpdate:show":e[4]||(e[4]=n=>k.value=n),width:"450",title:"编辑类"},{default:a(()=>[d.value?(b(),y("div",Ue,[i(K,{"label-placement":"top"},{default:a(()=>[i(r,{label:"类名"},{default:a(()=>[i(c,{value:d.value.name,"onUpdate:value":e[0]||(e[0]=n=>d.value.name=n),placeholder:"请输入类名"},null,8,["value"])]),_:1}),i(x,{style:{margin:"20px 0"}},{default:a(()=>[...e[13]||(e[13]=[u("属性",-1)])]),_:1}),p("div",Ae,[(b(!0),y(P,null,V(d.value.attributes,(n,v)=>(b(),y("div",{key:v,class:"item"},[i(G,{size:"small",style:{"margin-bottom":"12px"}},{header:a(()=>[p("div",Fe,[p("span",Me,"#"+E(v+1)+" "+E(n.name||"新属性"),1),i(t,{onClick:f=>d.value.attributes.splice(v,1),size:"tiny",type:"error",quaternary:"",style:{"margin-left":"auto"}},{default:a(()=>[...e[14]||(e[14]=[u("删除",-1)])]),_:1},8,["onClick"])])]),default:a(()=>[i(m,{vertical:"",size:"small"},{default:a(()=>[i(m,null,{default:a(()=>[i(r,{label:"属性名",style:{margin:"0",flex:"1"}},{default:a(()=>[i(c,{value:n.name,"onUpdate:value":f=>n.name=f,placeholder:"属性名",size:"small"},null,8,["value","onUpdate:value"])]),_:2},1024),i(r,{label:"类型",style:{margin:"0",flex:"1"}},{default:a(()=>[i(c,{value:n.type,"onUpdate:value":f=>n.type=f,placeholder:"类型",size:"small"},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),i(r,{label:"可见性",style:{margin:"0"}},{default:a(()=>[i(B,{value:n.visibility,"onUpdate:value":f=>n.visibility=f,size:"small"},{default:a(()=>[i(_,{value:"public"},{default:a(()=>[...e[15]||(e[15]=[u("+ public",-1)])]),_:1}),i(_,{value:"private"},{default:a(()=>[...e[16]||(e[16]=[u("- private",-1)])]),_:1}),i(_,{value:"protected"},{default:a(()=>[...e[17]||(e[17]=[u("# protected",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)),i(t,{onClick:e[1]||(e[1]=n=>d.value.attributes.push({name:"newAttribute",type:"string",visibility:"private"})),dashed:"",block:"",type:"primary",ghost:"",size:"small"},{icon:a(()=>[...e[18]||(e[18]=[p("div",{class:"i-mdi-plus"},null,-1)])]),default:a(()=>[e[19]||(e[19]=u(" 添加属性 ",-1))]),_:1})]),i(x,{style:{margin:"20px 0"}},{default:a(()=>[...e[20]||(e[20]=[u("方法",-1)])]),_:1}),p("div",We,[(b(!0),y(P,null,V(d.value.methods,(n,v)=>(b(),y("div",{key:v,class:"item"},[i(G,{size:"small",style:{"margin-bottom":"12px"}},{header:a(()=>[p("div",Be,[p("span",Ge,"#"+E(v+1)+" "+E(n.name||"新方法"),1),i(t,{onClick:f=>d.value.methods.splice(v,1),size:"tiny",type:"error",quaternary:"",style:{"margin-left":"auto"}},{default:a(()=>[...e[21]||(e[21]=[u("删除",-1)])]),_:1},8,["onClick"])])]),default:a(()=>[i(m,{vertical:"",size:"small"},{default:a(()=>[i(m,null,{default:a(()=>[i(r,{label:"方法名",style:{margin:"0",flex:"1"}},{default:a(()=>[i(c,{value:n.name,"onUpdate:value":f=>n.name=f,placeholder:"方法名",size:"small"},null,8,["value","onUpdate:value"])]),_:2},1024),i(r,{label:"返回类型",style:{margin:"0",flex:"1"}},{default:a(()=>[i(c,{value:n.returnType,"onUpdate:value":f=>n.returnType=f,placeholder:"返回类型",size:"small"},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),i(r,{label:"可见性",style:{margin:"0"}},{default:a(()=>[i(B,{value:n.visibility,"onUpdate:value":f=>n.visibility=f,size:"small"},{default:a(()=>[i(_,{value:"public"},{default:a(()=>[...e[22]||(e[22]=[u("+ public",-1)])]),_:1}),i(_,{value:"private"},{default:a(()=>[...e[23]||(e[23]=[u("- private",-1)])]),_:1}),i(_,{value:"protected"},{default:a(()=>[...e[24]||(e[24]=[u("# protected",-1)])]),_:1})]),_:1},8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)),i(t,{onClick:e[2]||(e[2]=n=>d.value.methods.push({name:"newMethod",returnType:"void",visibility:"public"})),dashed:"",block:"",type:"primary",ghost:"",size:"small"},{icon:a(()=>[...e[25]||(e[25]=[p("div",{class:"i-mdi-plus"},null,-1)])]),default:a(()=>[e[26]||(e[26]=u(" 添加方法 ",-1))]),_:1})]),i(x,{style:{margin:"20px 0"}}),i(m,{justify:"space-between"},{default:a(()=>[i(t,{onClick:J,type:"error",ghost:""},{icon:a(()=>[...e[27]||(e[27]=[p("div",{class:"i-mdi-delete"},null,-1)])]),default:a(()=>[e[28]||(e[28]=u(" 删除类 ",-1))]),_:1}),i(m,null,{default:a(()=>[i(t,{onClick:e[3]||(e[3]=n=>k.value=!1)},{default:a(()=>[...e[29]||(e[29]=[u("取消",-1)])]),_:1}),i(t,{onClick:q,type:"primary"},{default:a(()=>[...e[30]||(e[30]=[u("保存",-1)])]),_:1})]),_:1})]),_:1})]),_:1})])):j("",!0)]),_:1},8,["show"])])}}}),Le=ye(Xe,[["__scopeId","data-v-50a2e080"]]);export{Le as default};
