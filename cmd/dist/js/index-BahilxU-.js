import Be from"./index-CmtMtyJe.js";import{n as Ie,k as He,K as Oe,r as g,c as W,o as Re,E as je,w as ie,P as h,Q as c,X as K,R as s,J as e,U as n,S as i,j as C,_ as p,a2 as ee,Z as J,F as D,M as Q,H as re,L as ve,l as Ae,v as De}from"./vue-vendor-DgJqRHrX.js";import{r as Ve,l as qe,u as ce}from"./office-vendor-DeHr7Ug1.js";import{ar as Ze,L as Ge,M as We,ap as Ke,ao as Je,as as Qe,a2 as Xe,ae as Ye,a9 as et,a8 as tt,at as nt,a1 as st,au as lt}from"./ui-vendor-Dblj447Y.js";import{_ as ot}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./iconify-sN5qq56k.js";import"./index-D3z4ySpN.js";import"./robot-avatar-1-CBzFR956.js";import"./charts-vendor-DjXuxi75.js";const at={pdf:"pdf",doc:"word",docx:"word",xls:"excel",xlsx:"excel"},fe={pdf:{tagType:"error",icon:"ic:outline-picture-as-pdf",color:"#dc2626"},word:{tagType:"info",icon:"ic:outline-description",color:"#2563eb"},excel:{tagType:"success",icon:"ic:outline-grid-on",color:"#16a34a"},unknown:{tagType:"default",icon:"ic:outline-insert-drive-file",color:"#6b7280"}},_e={pdf:{min:.5,max:3,step:.25,default:1},word:{min:50,max:200,step:10,default:100}},it=[20,50,100,200],he=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],rt=o=>{try{const l=o.split("/").pop()||o.split("\\").pop();if(l?.includes(".")){const y=decodeURIComponent(l.split("?")[0]);if(y&&y!==o)return y}}catch{}return"未知文件"},ge=o=>{if(o===0)return"0 B";const l=1024,y=["B","KB","MB","GB"],u=Math.floor(Math.log(o)/Math.log(l));return parseFloat((o/Math.pow(l,u)).toFixed(1))+" "+y[u]},ct=o=>{if(!o||o==="未知文件")return"unknown";const l=o.toLowerCase().split(".").pop();return l&&at[l]||"unknown"},ut=o=>fe[o]||fe.unknown,ye=(o,l)=>y=>{const{min:u,max:k,step:F,default:S}=l;switch(y){case"reset":o.value=S;break;case"in":o.value<k&&(o.value+=F);break;case"out":o.value>u&&(o.value-=F);break}},dt=o=>{let l="";for(;o>=0;)l=String.fromCharCode(65+o%26)+l,o=Math.floor(o/26)-1;return l},mt=o=>{if(!o)return"";const l=String(o).trim();if(!isNaN(Number(l))&&l!==""&&l.length<15){const y=Number(l);return Number.isInteger(y)?y.toLocaleString():y.toLocaleString(void 0,{maximumFractionDigits:2})}return l},pt=o=>{if(!o)return"cell-empty";const l=String(o).trim();return!isNaN(Number(l))&&l!==""?"cell-number":l.match(/[■▬▪▫─━]/)?"cell-gantt":l.match(/^\d{4}[-/]\d{2}[-/]\d{2}/)||l.match(/^\d{2}[-/]\d{2}[-/]\d{4}/)?"cell-date":["true","false"].includes(l.toLowerCase())?"cell-boolean":l.length>20?"cell-text cell-long":"cell-text"},vt=(o,l)=>{const y=ce.decode_range(o["!ref"]||"A1:A1"),{c:u,r:k}=y.e,F=Array.from({length:u+1},(b,v)=>{const w=ce.encode_cell({r:0,c:v}),f=o[w],m=f?String(f.v||"").trim():`列${v+1}`;return{title:m||`列${v+1}`,key:`col_${v}`,width:Math.min(Math.max(m.length*12,80),200)}}),S=new Map;return l.forEach(({s:{r:b,c:v},e:{r:w,c:f}})=>{for(let m=b;m<=w;m++)for(let z=v;z<=f;z++)S.set(`${m}-${z}`,{isMain:m===b&&z===v,rowspan:w-b+1,colspan:f-v+1})}),{data:Array.from({length:k+1},(b,v)=>{const w={};for(let f=0;f<=u;f++){const m=ce.encode_cell({r:v,c:f}),z=o[m],_=S.get(`${v}-${f}`);w[`col_${f}`]={value:z&&z.v||"",merged:!!_,hidden:_&&!_.isMain,rowspan:_?.isMain?_.rowspan:1,colspan:_?.isMain?_.colspan:1}}return w}),columns:F}},ft=o=>{const{pdfUrl:l,totalPages:y,wordContent:u,headings:k,excelSheets:F,activeSheet:S,excelData:P,excelColumns:b}=o;return{pdf:async v=>{const w=URL.createObjectURL(v);l.value=w+"#toolbar=1&navpanes=1&scrollbar=1&view=FitH",y.value=1},word:async v=>{const w=await v.arrayBuffer(),f=await qe.convertToHtml({arrayBuffer:w,styleMap:["p[style-name='Heading 1'] => h1:fresh","p[style-name='Heading 2'] => h2:fresh","p[style-name='Heading 3'] => h3:fresh","p[style-name='Title'] => h1.title:fresh"]});u.value=f.value,await Ie();const m=document.createElement("div");m.innerHTML=u.value;const z=m.querySelectorAll("h1, h2, h3, h4, h5, h6");k.value=Array.from(z).map((_,E)=>{const N=`heading-${E}`,B=parseInt(_.tagName.charAt(1)),V=_.textContent||"";return u.value=u.value.replace(_.outerHTML,_.outerHTML.replace(_.tagName.toLowerCase(),`${_.tagName.toLowerCase()} id="${N}"`)),{id:N,text:V,level:B}})},excel:async v=>{const w=await v.arrayBuffer(),f=Ve(w,{type:"array",cellStyles:!0,cellFormula:!0,cellDates:!0});if(!f.SheetNames.length)throw new Error("Excel文件中没有找到工作表");if(F.value=f.SheetNames.map(m=>{const z=f.Sheets[m],_=z["!merges"]||[],{data:E,columns:N}=vt(z,_);return{name:m,data:E,merges:_,columns:N}}),F.value.length>0){const[m]=F.value;S.value=m.name,P.value=m.data,b.value=m.columns}}}},_t=o=>async()=>{const l=o.value;if(!l)return;const y=!!document.fullscreenElement,u={request:[()=>l.requestFullscreen(),()=>l.webkitRequestFullscreen(),()=>l.mozRequestFullScreen(),()=>l.msRequestFullscreen()],exit:[()=>document.exitFullscreen(),()=>document.webkitExitFullscreen(),()=>document.mozCancelFullScreen(),()=>document.msExitFullscreen()]},k=y?u.exit:u.request,F=S=>S.reduce((P,b)=>P.then(v=>v?!0:b().then(()=>!0).catch(()=>!1)),Promise.resolve(!1));try{if(await F(k))return}catch{}},ht={class:"c-file-preview-wrapper"},gt={key:0,class:"file-info-card"},yt={class:"file-info"},wt={class:"file-icon"},xt={class:"file-details"},kt={class:"file-name"},bt={class:"file-meta"},Ct={class:"file-size"},zt={class:"file-actions"},Ft={class:"modal-header"},Et={class:"modal-title"},Nt={class:"modal-actions"},St={class:"modal-content"},Mt={class:"preview-header"},$t={class:"flex justify-between items-center"},Lt={class:"flex items-center gap-3"},Tt={class:"text-sm text-gray-500"},Ut={class:"flex gap-2"},Pt={class:"preview-content"},Bt={key:0,class:"status-container"},It={key:0,class:"file-container"},Ht={class:"file-toolbar"},Ot={class:"flex justify-between items-center"},Rt={class:"flex gap-2 items-center"},jt={class:"text-sm text-gray-600"},At={class:"flex gap-2 items-center"},Dt={class:"text-sm text-gray-600 min-w-12 text-center"},Vt={class:"file-viewer"},qt=["src"],Zt={key:1,class:"file-container"},Gt={class:"file-toolbar"},Wt={class:"flex gap-2 items-center"},Kt={class:"text-sm text-gray-600 min-w-12 text-center"},Jt={class:"word-layout"},Qt={class:"word-main"},Xt={key:0,class:"word-outline"},Yt={class:"outline-content"},en=["onClick"],tn={class:"word-content"},nn=["innerHTML"],sn={key:2,class:"file-container excel-container"},ln={class:"file-toolbar"},on={class:"flex justify-between items-center"},an={class:"flex gap-2 items-center"},rn={key:1,class:"text-sm text-gray-600"},cn={class:"flex gap-2 items-center"},un={class:"excel-viewer"},dn={key:0,class:"excel-info"},mn={class:"excel-table-container"},pn={key:0,class:"excel-table"},vn={class:"header-content"},fn={class:"column-letter"},_n={class:"column-title"},hn={class:"row-number"},gn=["rowspan","colspan","title"],yn={key:1,class:"excel-empty"},wn={key:0,class:"excel-pagination"},xn=He({__name:"index",props:{file:{},url:{},fileName:{default:"未知文件"},autoPreview:{type:Boolean,default:!1}},emits:["preview","download"],setup(o,{emit:l}){const y=o,{file:u,url:k,fileName:F,autoPreview:S}=Oe(y),P=l,b=g(!1),v=g(""),w=g(0),f=g(!1),m=g(!1),z=g(),_=g(""),E=g(1),N=g(0),B=g(1),V=g(""),H=g(100),X=g(!0),te=g([]),q=g([]),L=g(""),O=g([]),T=g([]),Z=g(!1),U=g(1),R=g(50),j=W(()=>F.value&&F.value!=="未知文件"?F.value:u.value?.name?u.value.name:k.value?rt(k.value):"未知文件"),M=W(()=>ct(j.value)),I=W(()=>ut(M.value)),ne=W(()=>Math.ceil(T.value.length/R.value)),we=W(()=>{const r=(U.value-1)*R.value;return T.value.slice(r,r+R.value)}),se=ye(B,_e.pdf),le=ye(H,_e.word),xe=_t(z),oe=r=>{if(typeof r=="number")E.value=Math.max(1,Math.min(r,N.value));else{const t=r==="prev"?-1:1;E.value=Math.max(1,Math.min(E.value+t,N.value))}},ke=r=>{R.value=r,U.value=1},be=r=>{document.getElementById(r)?.scrollIntoView({behavior:"smooth",block:"start"})},Ce=()=>{v.value="",b.value=!1,_.value="",V.value="",L.value="",E.value=1,N.value=0,B.value=1,H.value=100,q.value=[],T.value=[],O.value=[],te.value=[]},ae=r=>{v.value=r,b.value=!1},ze=ft({pdfUrl:_,totalPages:N,wordContent:V,headings:te,excelSheets:q,activeSheet:L,excelData:T,excelColumns:O}),Y=async()=>{if(!u.value&&!k.value){ae("未提供文件或URL");return}Ce(),b.value=!0;try{let r;if(u.value)r=u.value,w.value=u.value.size;else if(k.value){const d=await fetch(k.value);if(!d.ok)throw new Error(`HTTP ${d.status}: ${d.statusText}`);const G=await d.blob();r=new File([G],j.value,{type:G.type})}else throw new Error("未提供文件或URL");if(M.value==="unknown")throw new Error("不支持的文件格式");const t=ze[M.value];if(t)await t(r);else throw new Error("不支持的文件格式");b.value=!1}catch(r){const t=r instanceof Error?r.message:"未知错误";ae(`${M.value.toUpperCase()}文件加载失败: ${t}`)}},Fe=async()=>{m.value=!1,f.value=!0,await Y(),P("preview",u.value||k.value)},ue=()=>{if(u.value){const r=URL.createObjectURL(u.value);Object.assign(document.createElement("a"),{href:r,download:j.value}).click(),URL.revokeObjectURL(r)}else k.value&&window.open(k.value,"_blank");P("download",u.value||k.value)},de=()=>{m.value=!!document.fullscreenElement};return Re(()=>{he.forEach(r=>document.addEventListener(r,de))}),je(()=>{he.forEach(r=>document.removeEventListener(r,de)),_.value?.startsWith("blob:")&&URL.revokeObjectURL(_.value.split("#")[0])}),ie(L,r=>{const t=q.value.find(d=>d.name===r);t&&(T.value=t.data,O.value=t.columns,U.value=1)}),ie(()=>u.value?.size,r=>{w.value=r||0},{immediate:!0}),ie(f,r=>{r||(document.fullscreenElement&&document.exitFullscreen().catch(()=>{}),m.value=!1)}),(r,t)=>{const d=Be,G=Ze,me=Ge,x=We,Ee=Je,pe=Qe,Ne=Xe,Se=Ye,Me=tt,$e=et,Le=nt,Te=st,Ue=lt,Pe=Ke;return c(),h("div",ht,[e(S)?K("",!0):(c(),h("div",gt,[n("div",yt,[n("div",wt,[s(d,{name:e(I).icon,size:40,color:e(I).color},null,8,["name","color"])]),n("div",xt,[n("div",kt,[s(G,{style:{"max-width":"250px"}},{default:i(()=>[C(p(e(j)),1)]),_:1}),s(me,{type:e(I).tagType,size:"small"},{default:i(()=>[C(p(e(M).toUpperCase()),1)]),_:1},8,["type"])]),n("div",bt,[n("span",Ct,p(e(ge)(e(w))),1)])]),n("div",zt,[s(x,{type:"primary",onClick:Fe},{icon:i(()=>[s(d,{name:"ic:outline-visibility"})]),default:i(()=>[t[17]||(t[17]=C(" 预览 ",-1))]),_:1}),s(x,{type:"tertiary",onClick:ue},{icon:i(()=>[s(d,{name:"ic:outline-download"})]),default:i(()=>[t[18]||(t[18]=C(" 下载 ",-1))]),_:1})])])])),s(Pe,{show:e(f),"onUpdate:show":t[16]||(t[16]=a=>ee(f)?f.value=a:null),"mask-closable":!1,closable:!1,"auto-focus":!1,"transform-origin":"center",style:{width:"85vw","max-width":"1200px","min-width":"800px",height:"75vh","max-height":"700px","min-height":"500px"}},{default:i(()=>[n("div",{class:"modal-container",ref_key:"modalContainer",ref:z},[n("div",Ft,[n("div",Et,[s(d,{name:e(I).icon,size:20,color:e(I).color},null,8,["name","color"]),n("span",null,p(e(j)),1)]),n("div",Nt,[s(x,{size:"small",type:"tertiary",onClick:ue},{icon:i(()=>[s(d,{name:"ic:outline-download"})]),default:i(()=>[t[19]||(t[19]=C(" 下载 ",-1))]),_:1}),s(x,{size:"small",type:"tertiary",onClick:t[0]||(t[0]=a=>f.value=!1)},{icon:i(()=>[s(d,{name:"ic:outline-close"})]),_:1})])]),n("div",St,[n("div",Mt,[n("div",$t,[n("div",Lt,[s(me,{type:e(I).tagType,size:"small"},{icon:i(()=>[s(d,{name:e(I).icon},null,8,["name"])]),default:i(()=>[C(" "+p(e(M).toUpperCase()),1)]),_:1},8,["type"]),s(G,{style:{"max-width":"300px"}},{default:i(()=>[C(p(e(j)),1)]),_:1}),n("span",Tt,p(e(ge)(e(w))),1)]),n("div",Ut,[s(x,{size:"small",type:"tertiary",onClick:Y,disabled:e(b)},{icon:i(()=>[s(d,{name:"ic:outline-refresh"})]),default:i(()=>[t[20]||(t[20]=C(" 刷新 ",-1))]),_:1},8,["disabled"]),s(x,{size:"small",type:"primary",onClick:e(xe)},{icon:i(()=>[s(d,{name:e(m)?"ic:outline-fullscreen-exit":"ic:outline-fullscreen"},null,8,["name"])]),default:i(()=>[C(" "+p(e(m)?"退出全屏":"全屏"),1)]),_:1},8,["onClick"])])])]),n("div",Pt,[e(b)||e(v)?(c(),h("div",Bt,[e(b)?(c(),J(Ee,{key:0,size:"large"},{description:i(()=>[C("正在加载"+p(e(M).toUpperCase())+"文件...",1)]),_:1})):(c(),J(pe,{key:1,status:"error",title:"预览失败",description:e(v)},{footer:i(()=>[s(x,{onClick:Y},{default:i(()=>[...t[21]||(t[21]=[C("重试",-1)])]),_:1})]),_:1},8,["description"]))])):(c(),h(D,{key:1},[e(M)==="pdf"?(c(),h("div",It,[n("div",Ht,[n("div",Ot,[n("div",Rt,[s(x,{size:"small",onClick:t[1]||(t[1]=a=>oe("prev")),disabled:e(E)<=1},{icon:i(()=>[s(d,{name:"ic:outline-chevron-left"})]),_:1},8,["disabled"]),s(Ne,{value:e(E),"onUpdate:value":[t[2]||(t[2]=a=>ee(E)?E.value=a:null),oe],size:"small",min:1,max:e(N),style:{width:"80px"}},null,8,["value","max"]),n("span",jt,"/ "+p(e(N)),1),s(x,{size:"small",onClick:t[3]||(t[3]=a=>oe("next")),disabled:e(E)>=e(N)},{icon:i(()=>[s(d,{name:"ic:outline-chevron-right"})]),_:1},8,["disabled"])]),n("div",At,[s(x,{size:"small",onClick:t[4]||(t[4]=a=>e(se)("out")),disabled:e(B)<=.5},{icon:i(()=>[s(d,{name:"ic:outline-zoom-out"})]),_:1},8,["disabled"]),n("span",Dt,p(Math.round(e(B)*100))+"%",1),s(x,{size:"small",onClick:t[5]||(t[5]=a=>e(se)("in")),disabled:e(B)>=3},{icon:i(()=>[s(d,{name:"ic:outline-zoom-in"})]),_:1},8,["disabled"]),s(x,{size:"small",onClick:t[6]||(t[6]=a=>e(se)("reset"))},{icon:i(()=>[s(d,{name:"ic:outline-fit-screen"})]),default:i(()=>[t[22]||(t[22]=C(" 适应 ",-1))]),_:1})])])]),n("div",Vt,[e(_)?(c(),h("iframe",{key:0,src:e(_),class:"w-full h-full border-0",title:"PDF预览",frameborder:"0",allowfullscreen:"",onLoad:t[7]||(t[7]=()=>{}),onError:t[8]||(t[8]=()=>ae("PDF文件无法显示，可能是文件损坏或浏览器不支持"))},null,40,qt)):K("",!0)])])):e(M)==="word"?(c(),h("div",Zt,[n("div",Gt,[n("div",Wt,[s(x,{size:"small",onClick:t[9]||(t[9]=a=>X.value=!e(X))},{icon:i(()=>[s(d,{name:"ic:outline-list"})]),default:i(()=>[C(" "+p(e(X)?"隐藏":"显示")+"目录 ",1)]),_:1}),s(Se,{vertical:""}),s(x,{size:"small",onClick:t[10]||(t[10]=a=>e(le)("out")),disabled:e(H)<=50},{icon:i(()=>[s(d,{name:"ic:outline-zoom-out"})]),_:1},8,["disabled"]),n("span",Kt,p(e(H))+"%",1),s(x,{size:"small",onClick:t[11]||(t[11]=a=>e(le)("in")),disabled:e(H)>=200},{icon:i(()=>[s(d,{name:"ic:outline-zoom-in"})]),_:1},8,["disabled"]),s(x,{size:"small",onClick:t[12]||(t[12]=a=>e(le)("reset"))},{icon:i(()=>[s(d,{name:"ic:outline-fit-screen"})]),default:i(()=>[t[23]||(t[23]=C(" 重置 ",-1))]),_:1})])]),n("div",Jt,[n("div",Qt,[e(X)?(c(),h("div",Xt,[t[24]||(t[24]=n("div",{class:"outline-header"},[n("h3",{class:"text-sm font-semibold"},"文档目录")],-1)),n("div",Yt,[(c(!0),h(D,null,Q(e(te),(a,A)=>(c(),h("div",{key:A,class:re(["outline-item",`level-${a.level}`]),onClick:$=>be(a.id)},p(a.text),11,en))),128))])])):K("",!0),n("div",tn,[n("div",{class:"word-document",style:ve({transform:`scale(${e(H)/100})`,transformOrigin:"top center"}),innerHTML:e(V)},null,12,nn)])])])])):e(M)==="excel"?(c(),h("div",sn,[n("div",ln,[n("div",on,[n("div",an,[e(q).length>1?(c(),J($e,{key:0,value:e(L),"onUpdate:value":t[13]||(t[13]=a=>ee(L)?L.value=a:null),type:"card",size:"small"},{default:i(()=>[(c(!0),h(D,null,Q(e(q),a=>(c(),J(Me,{key:a.name,name:a.name,tab:a.name},null,8,["name","tab"]))),128))]),_:1},8,["value"])):(c(),h("span",rn,"工作表: "+p(e(L)),1))]),n("div",cn,[s(x,{size:"small",onClick:t[14]||(t[14]=a=>Z.value=!e(Z))},{icon:i(()=>[s(d,{name:"ic:outline-format-paint"})]),default:i(()=>[C(" "+p(e(Z)?"紧凑视图":"完整格式"),1)]),_:1})])])]),n("div",un,[e(T).length>0?(c(),h("div",dn,[s(Le,{depth:"3",class:"text-sm"},{default:i(()=>[C(" 当前工作表: "+p(e(L))+" | 总行数: "+p(e(T).length)+" | 总列数: "+p(e(O).length)+" | 当前页: "+p(e(U))+"/"+p(e(ne)),1)]),_:1})])):K("",!0),n("div",mn,[n("div",{class:re(["excel-table-wrapper",{"simple-mode":!e(Z)}])},[e(T).length>0?(c(),h("table",pn,[n("thead",null,[n("tr",null,[t[25]||(t[25]=n("th",{class:"row-number"},"行号",-1)),(c(!0),h(D,null,Q(e(O),(a,A)=>(c(),h("th",{key:a.key,class:"excel-header",style:ve({minWidth:a.width+"px"})},[n("div",vn,[n("span",fn,p(e(dt)(A)),1),n("span",_n,p(a.title),1)])],4))),128))])]),n("tbody",null,[(c(!0),h(D,null,Q(e(we),(a,A)=>(c(),h("tr",{key:A,class:"excel-row"},[n("td",hn,p((e(U)-1)*e(R)+A+1),1),(c(!0),h(D,null,Q(e(O),$=>Ae((c(),h("td",{key:$.key,class:re(["excel-cell",[e(pt)(a[$.key]?.value),a[$.key]?.merged?"merged-cell":"",e(Z)?"":"compact-cell"]]),rowspan:a[$.key]?.rowspan||1,colspan:a[$.key]?.colspan||1,title:a[$.key]?.value},p(e(mt)(a[$.key]?.value)),11,gn)),[[De,!a[$.key]?.hidden]])),128))]))),128))])])):(c(),h("div",yn,[s(Te,{description:"该工作表没有数据或解析失败"},{extra:i(()=>[s(x,{size:"small",onClick:Y},{default:i(()=>[...t[26]||(t[26]=[C("重新解析",-1)])]),_:1})]),_:1})]))],2),e(ne)>1?(c(),h("div",wn,[s(Ue,{page:e(U),"onUpdate:page":t[15]||(t[15]=a=>ee(U)?U.value=a:null),"page-count":e(ne),"page-size":e(R),"show-size-picker":"","page-sizes":e(it),"onUpdate:pageSize":ke},null,8,["page","page-count","page-size","page-sizes"])])):K("",!0)])])])):(c(),J(pe,{key:3,status:"warning",title:"不支持的文件格式",description:`暂不支持预览 ${e(M).toUpperCase()} 格式文件`},null,8,["description"]))],64))])])],512)]),_:1},8,["show"])])}}}),$n=ot(xn,[["__scopeId","data-v-a1b46132"]]);export{$n as default};
