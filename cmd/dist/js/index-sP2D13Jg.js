import{k as $,r as i,ag as P,o as Q,n as X,c as Y,P as R,Z as k,X as N,U as p,J as a,R as r,_ as w,S as d,Q as _,ai as K,j as ee}from"./vue-vendor-DgJqRHrX.js";import{a as te}from"./robot-avatar-1-CBzFR956.js";import{d as ae,i as se,l as oe,j as H,k as re}from"./index-DAKaZtA3.js";import{u as ne}from"./index-C6ekv4W8.js";import{_ as le}from"./Spline.vue_vue_type_script_setup_true_lang-BOT3amkA.js";import ie from"./index-CRxwQnkp.js";import ue from"./Typewriter-BElxj9jy.js";import{H as ce,ao as me,ad as pe,a0 as ge,M as de,ah as fe}from"./ui-vendor-Dblj447Y.js";import"./spline-vendor-Btm54g1Q.js";import"./charts-vendor-DjXuxi75.js";import"./editor-vendor-BwkH8h9-.js";import"./index-DLz9CAvw.js";import"./ParentSize.vue_vue_type_script_setup_true_lang-DEcuBWDs.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ve="1.1.9.34",_e={class:"login-container bg-[#181818]"},he={class:"spline-background"},ye={class:"login-wrapper"},be={class:"login-title"},ke={class:"version-info",style:{"text-align":"center",color:"#666","font-size":"12px","margin-bottom":"10px"}},we={key:0,style:{"text-align":"center",padding:"20px"}},Ve=$({__name:"index",setup(Ce){const z=ve,n=i("login"),b=i(!0),C=P(),S=ae(),c=ce(),{loading:D,createSubmit:x}=ne(),f=i(null),l=i({username:"",password:"",email:""}),E=i(!1);Q(async()=>{X(()=>{E.value=!0});try{b.value=!0;const e=await se();if(e.data){const t=e.data.initialized;n.value=t?"login":"register"}else n.value="login"}catch{c.error("检查系统状态失败"),n.value="login"}finally{b.value=!1}});const I=Y(()=>{const e={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:30,message:"密码长度在 6 到 30 个字符",trigger:"blur"}]};return n.value==="register"?{...e,email:[{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}]}:e}),M=i(!0),j=i(),u=i(!1),o=i(null),h={timeSlots:[{hours:[6,12],greeting:"早上好",emoji:"🌅"},{hours:[12,14],greeting:"中午好",emoji:"☀️"},{hours:[14,18],greeting:"下午好",emoji:"🌤️"},{hours:[18,22],greeting:"晚上好",emoji:"🌆"},{hours:[22,24,0,6],greeting:"夜深了",emoji:"🌙"}],templates:["{greeting}，{username}！欢迎回来～ {emoji}","{emoji} {greeting}，{username}！开始今天的工作吧","欢迎回来，{username}！{greeting} {emoji}","{greeting}，{username}！准备好了吗？ {emoji}"]},T=()=>{const e=new Date().getHours();return h.timeSlots.find(({hours:s})=>s.length===2?e>=s[0]&&e<s[1]:s.includes(e))||h.timeSlots[0]},B=e=>{const t=e.data?.username||"CHENY",{greeting:s,emoji:m}=T();return h.templates[Math.floor(Math.random()*h.templates.length)].replace("{greeting}",s).replace("{username}",t).replace("{emoji}",m)},F=()=>{},V=()=>{M.value=!1},U=e=>{u.value=!0,o.value=e,c.success("人机验证成功")},A=()=>{u.value=!1,o.value=null},L=e=>{u.value=e,e||(o.value=null)},y=()=>{u.value=!1,o.value=null,j.value?.reset()},O=()=>{if(!u.value||!o.value){c.error("请先完成人机验证");return}if(!f.value){c.error("表单初始化失败，请刷新页面重试");return}const{username:e,password:t}=l.value,s={form:f.value,model:{username:e,password:t,captcha:{token:o.value.token,timestamp:o.value.timestamp,type:"puzzle-captcha"}}};G(s)},G=x(oe,{successMsg:"登录成功",meta:B,errorMsg:"账号或密码错误",onSuccess:async e=>{try{const{data:{token:t}}=e;S.handleLoginSuccess(t),await H(),C.push("/home")}catch{y()}},globalErrorHandler:e=>{y()}}),q=()=>{if(!u.value||!o.value){c.error("请先完成人机验证");return}if(!f.value){c.error("表单初始化失败，请刷新页面重试");return}const{username:e,password:t,email:s}=l.value,m={form:f.value,model:{username:e,password:t,email:s||void 0,captcha:{token:o.value.token,timestamp:o.value.timestamp,type:"puzzle-captcha"}}};J(m)},J=x(re,{successMsg:"注册成功",errorMsg:"注册失败",onSuccess:async e=>{try{const{data:{token:t}}=e;S.handleLoginSuccess(t),await H(),n.value="login",c.success("注册成功！正在跳转..."),setTimeout(()=>{C.push("/home")},1e3)}catch{y()}},globalErrorHandler:e=>{y()}});return(e,t)=>{const s=me,m=ge,v=pe,W=de,Z=fe;return _(),R("div",_e,[a(M)?(_(),k(ue,{key:0,text:"Hey！伙计，欢迎来到泰拉瑞亚。",duration:2e3,delay:300,"pause-after":1e3,onComplete:F,onHidden:V})):N("",!0),p("div",he,[r(le,{scene:"https://prod.spline.design/kZDDjO5HuC9GJUM2/scene.splinecode"})]),p("div",ye,[t[5]||(t[5]=p("div",{class:"robot-avatar"},[p("img",{src:te,alt:"Robot Avatar"})],-1)),p("h3",be,w(a(n)==="register"?"首次注册":"泰拉瑞亚管理面板"),1),p("div",ke," 版本: v"+w(a(z)),1),a(b)?(_(),R("div",we,[r(s,{size:"small"}),t[4]||(t[4]=p("p",{style:{"margin-top":"10px",color:"#999"}},"正在检查系统状态...",-1))])):(_(),k(Z,{key:1,ref_key:"formRef",ref:f,class:"login-form",model:a(l),rules:a(I)},{default:d(()=>[r(v,{label:"用户名",path:"username"},{default:d(()=>[r(m,{value:a(l).username,"onUpdate:value":t[0]||(t[0]=g=>a(l).username=g),placeholder:"请输入用户名",clearable:""},null,8,["value"])]),_:1}),r(v,{label:"密码",path:"password"},{default:d(()=>[r(m,{value:a(l).password,"onUpdate:value":t[1]||(t[1]=g=>a(l).password=g),type:"password",placeholder:"请输入密码","show-password-on":"mousedown",clearable:""},null,8,["value"])]),_:1}),a(n)==="register"?(_(),k(v,{key:0,label:"邮箱（可选）",path:"email"},{default:d(()=>[r(m,{value:a(l).email,"onUpdate:value":t[2]||(t[2]=g=>a(l).email=g),placeholder:"请输入邮箱",clearable:""},null,8,["value"])]),_:1})):N("",!0),r(v,null,{default:d(()=>[r(W,{class:"login-btn",type:"primary",loading:a(D),disabled:!a(u),onClick:t[3]||(t[3]=K(g=>a(n)==="register"?q():O(),["prevent"]))},{default:d(()=>[ee(w(a(u)?a(n)==="register"?"注册":"登录":"请先点击下方图标完成人机验证"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model","rules"])),r(ie,{ref_key:"captchaRef",ref:j,class:"login-captcha","trigger-text":"",theme:"dark",onSuccess:U,onFail:A,onChange:L},null,512)])])}}});export{Ve as default};
