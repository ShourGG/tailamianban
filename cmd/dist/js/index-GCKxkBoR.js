import{i as M,j as R,l as V,m as D,n as F,o as O}from"./terraria-Cx1h2WO_.js";import{ab as P,aA as S,ak as T,K as _,M as r,$ as A,X as E,Y as x,aO as K,ao as X,ac as I,L as J,aD as Q}from"./ui-vendor-qucRfopV.js";import{k as Y,r as m,o as Z,O as q,P as v,Q as n,R as l,J as t,Z as k,j as w,S as c,X as G,m as d}from"./vue-vendor-DIhTWhib.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./auth-iZIiIGch.js";import"./index-CAzJpzbq.js";import"./spline-vendor-BYERog9l.js";import"./charts-vendor-XI8Sg87J.js";import"./editor-vendor-CUlQiixb.js";const ee={class:"terraria-worlds"},ae=Y({__name:"index",setup(te){const s=m(!1),y=m([]),p=m(!1),u=m([]),g=m(0),f=async()=>{s.value=!0;try{const e=await M();y.value=e||[]}catch{window.$message?.error("加载世界列表失败")}finally{s.value=!1}},$=async()=>{if(u.value.length===0){window.$message?.warning("请选择要上传的世界文件");return}const e=u.value[0].file;if(e){s.value=!0,g.value=0;try{await R(e),window.$message?.success("世界文件上传成功"),p.value=!1,u.value=[],f()}catch{window.$message?.error("上传世界文件失败")}finally{s.value=!1,g.value=0}}},b=async e=>{s.value=!0;try{const a=await V(e.id),o=window.URL.createObjectURL(a),i=document.createElement("a");i.href=o,i.download=e.fileName,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(o),window.$message?.success("世界文件下载成功")}catch{window.$message?.error("下载世界文件失败")}finally{s.value=!1}},h=async e=>{s.value=!0;try{await D(e.id),window.$message?.success(`已删除世界: ${e.name}`),f()}catch{window.$message?.error("删除世界失败")}finally{s.value=!1}},C=async e=>{s.value=!0;try{await F(e.id),window.$message?.success(`世界 ${e.name} 已备份`),f()}catch{window.$message?.error("备份世界失败")}finally{s.value=!1}},z=async e=>{s.value=!0;try{await O(e.id),window.$message?.success(`世界 ${e.name} 已恢复`),f()}catch{window.$message?.error("恢复世界失败")}finally{s.value=!1}},B=e=>e<1024?`${e} B`:e<1024*1024?`${(e/1024).toFixed(2)} KB`:`${(e/(1024*1024)).toFixed(2)} MB`,N=e=>({normal:"success",expert:"warning",master:"error",journey:"info"})[e]||"default",U=e=>({normal:"普通",expert:"专家",master:"大师",journey:"旅程"})[e]||e,L=[{title:"世界名称",key:"name",width:200},{title:"文件名",key:"fileName",width:200},{title:"难度",key:"difficulty",width:100,render:e=>d(J,{type:N(e.difficulty),size:"small"},{default:()=>U(e.difficulty)})},{title:"文件大小",key:"size",width:120,render:e=>B(e.size)},{title:"创建时间",key:"createdAt",width:180},{title:"最后修改",key:"updatedAt",width:180},{title:"操作",key:"actions",width:280,render:e=>d(_,{size:"small"},{default:()=>[d(r,{size:"small",type:"info",onClick:()=>b(e)},{default:()=>"下载"}),d(r,{size:"small",type:"primary",onClick:()=>C(e)},{default:()=>"备份"}),d(r,{size:"small",type:"warning",onClick:()=>z(e)},{default:()=>"恢复"}),d(Q,{onPositiveClick:()=>h(e),positiveText:"确认",negativeText:"取消"},{trigger:()=>d(r,{size:"small",type:"error"},{default:()=>"删除"}),default:()=>"确定要删除这个世界吗？此操作不可恢复！"})]})}],W=e=>{const a=e.file.file;if(!a)return!1;const o=[".wld",".bak"],i=a.name.toLowerCase();return o.some(j=>i.endsWith(j))?a.size>100*1024*1024?(window.$message?.error("文件大小不能超过 100MB"),!1):!0:(window.$message?.error("只支持 .wld 和 .bak 格式的世界文件"),!1)};return Z(()=>{f()}),(e,a)=>(v(),q("div",ee,[n(t(A),{title:"世界管理",bordered:!1},{"header-extra":l(()=>[n(t(_),null,{default:l(()=>[n(t(r),{type:"primary",onClick:a[0]||(a[0]=o=>p.value=!0)},{default:l(()=>[...a[4]||(a[4]=[w(" 上传世界 ",-1)])]),_:1}),n(t(r),{onClick:f},{default:l(()=>[...a[5]||(a[5]=[w("刷新",-1)])]),_:1})]),_:1})]),default:l(()=>[n(t(P),{show:s.value},{default:l(()=>[y.value.length>0?(v(),k(t(S),{key:0,columns:L,data:y.value,pagination:{pageSize:10},bordered:!1,size:"small"},null,8,["data"])):(v(),k(t(T),{key:1,description:"暂无世界文件"}))]),_:1},8,["show"])]),_:1}),n(t(I),{show:p.value,"onUpdate:show":a[3]||(a[3]=o=>p.value=o),preset:"card",title:"上传世界文件",style:{width:"600px"},bordered:!1},{footer:l(()=>[n(t(_),{justify:"end"},{default:l(()=>[n(t(r),{onClick:a[2]||(a[2]=o=>p.value=!1)},{default:l(()=>[...a[7]||(a[7]=[w("取消",-1)])]),_:1}),n(t(r),{type:"primary",loading:s.value,disabled:u.value.length===0,onClick:$},{default:l(()=>[...a[8]||(a[8]=[w(" 开始上传 ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),default:l(()=>[n(t(E),{"label-placement":"left","label-width":"100"},{default:l(()=>[n(t(x),{label:"选择文件"},{default:l(()=>[n(t(K),{"file-list":u.value,"onUpdate:fileList":a[1]||(a[1]=o=>u.value=o),max:1,"before-upload":W,accept:".wld,.bak"},{default:l(()=>[n(t(r),null,{default:l(()=>[...a[6]||(a[6]=[w("选择世界文件",-1)])]),_:1})]),_:1},8,["file-list"])]),_:1}),g.value>0?(v(),k(t(x),{key:0,label:"上传进度"},{default:l(()=>[n(t(X),{type:"line",percentage:g.value,"indicator-placement":"inside"},null,8,["percentage"])]),_:1})):G("",!0)]),_:1}),a[9]||(a[9]=c("div",{style:{"margin-top":"16px",padding:"12px","background-color":"rgba(0, 0, 0, 0.02)","border-radius":"4px"}},[c("div",{style:{"font-size":"13px",color:"#666"}},[c("div",{style:{"margin-bottom":"8px","font-weight":"600"}},"上传说明："),c("div",null,"• 支持 .wld 和 .bak 格式的泰拉瑞亚世界文件"),c("div",null,"• 文件大小限制：100MB"),c("div",null,"• 上传后需要在服务器配置中选择该世界")])],-1))]),_:1},8,["show"])]))}}),pe=H(ae,[["__scopeId","data-v-daffa640"]]);export{pe as default};
