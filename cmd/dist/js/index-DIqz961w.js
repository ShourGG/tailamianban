import{G as k}from"./charts-vendor-XI8Sg87J.js";import{M as J,O as K,T as Q,K as q,U as Z}from"./ui-vendor-qucRfopV.js";import{k as ee,r as z,w as te,o as ae,O as p,P as g,X as C,S as s,Q as d,R as c,j as y,J as P,F as oe,W as le,H as se,_ as ne,n as ie}from"./vue-vendor-DIhTWhib.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de=[{label:"导出PNG",key:"png"},{label:"导出SVG",key:"svg"},{label:"导出JSON",key:"json"}],ce={"start-event":{name:"开始",title:"开始事件",iconClass:"circle start-event"},activity:{name:"任务",title:"任务活动",iconClass:"rect activity"},gateway:{name:"网关",title:"排他网关",iconClass:"diamond gateway"},"end-event":{name:"结束",title:"结束事件",iconClass:"circle end-event"}},ue={event:"事件",activity:"活动",gateway:"网关","bpmn-edge":"连接线"},F=["top","right","bottom","left"],B=x=>x.reduce((N,f)=>{const v=["event"].includes("circle"),_=f==="top"?v?{refCx:.5,refCy:0}:{refX:.5,refY:0}:f==="right"?v?{refCx:1,refCy:.5}:{refX:1,refY:.5}:f==="bottom"?v?{refCx:.5,refCy:1}:{refX:.5,refY:1}:v?{refCx:0,refCy:.5}:{refX:0,refY:.5};return N[`port-${f}`]={ref:"body",..._,r:4,fill:"#31d0c6",stroke:"#ffffff",strokeWidth:2,magnet:!0,style:{cursor:"crosshair",opacity:0,transition:"opacity 0.2s"}},N},{}),b={event:{inherit:"circle",attrs:{body:{strokeWidth:2,stroke:"#5F95FF",fill:"#FFF",magnet:!1,style:{cursor:"move"}},text:{fontSize:12,fill:"#262626",textAnchor:"middle",textVerticalAnchor:"middle",pointerEvents:"none"}}},activity:{inherit:"rect",attrs:{body:{rx:6,ry:6,stroke:"#5F95FF",fill:"#EFF4FF",strokeWidth:1,magnet:!1,style:{cursor:"move"}},text:{fontSize:12,fill:"#262626",textAnchor:"middle",textVerticalAnchor:"middle",pointerEvents:"none"}}},gateway:{inherit:"polygon",attrs:{body:{refPoints:"0,10 10,0 20,10 10,20",strokeWidth:2,stroke:"#5F95FF",fill:"#EFF4FF",magnet:!1,style:{cursor:"move"}},text:{fontSize:20,fill:"#5F95FF",textAnchor:"middle",textVerticalAnchor:"middle",pointerEvents:"none"}}}},pe={inherit:"edge",attrs:{line:{stroke:"#A2B1C3",strokeWidth:2,targetMarker:{name:"block",width:8,height:6,fill:"#A2B1C3"},cursor:"pointer"}}},M={background:{color:"#ffffff"},grid:{visible:!0,type:"doubleMesh",args:[{color:"#eee",thickness:1},{color:"#ddd",thickness:1,factor:4}]},mousewheel:{enabled:!0,zoomAtMousePosition:!0,modifiers:"ctrl",minScale:.5,maxScale:3},connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:8}},allowBlank:!1,allowLoop:!1,allowNode:!1,snap:!0,allowEdge:!1},highlighting:{magnetAvailable:{name:"stroke",args:{attrs:{fill:"#31d0c6",stroke:"#31d0c6",opacity:1}}},magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF",opacity:1}}}},selecting:{enabled:!0,rubberband:!0,showNodeSelectionBox:!0},resizing:!0,rotating:!1,snapline:!0,keyboard:!0,clipboard:!0},ge={"start-event":{shape:"event",width:50,height:50,label:"开始事件",data:{type:"start"}},"end-event":{shape:"event",width:50,height:50,label:"结束事件",data:{type:"end"}},activity:{shape:"activity",width:120,height:60,label:"新活动",data:{description:"",assignee:""}},gateway:{shape:"gateway",width:40,height:40,label:"+",data:{type:"exclusive"}}},ve=[{id:"start-1",shape:"event",x:100,y:200,width:50,height:50,label:"流程开始",data:{type:"start"}},{id:"activity-1",shape:"activity",x:200,y:180,width:120,height:60,label:"用户申请",data:{description:"用户提交申请表单",assignee:"申请人"}},{id:"activity-2",shape:"activity",x:380,y:180,width:120,height:60,label:"初审",data:{description:"部门进行初步审核",assignee:"部门主管"}},{id:"gateway-1",shape:"gateway",x:550,y:200,width:40,height:40,label:"+",data:{type:"exclusive"}},{id:"activity-3",shape:"activity",x:650,y:120,width:120,height:60,label:"终审",data:{description:"高级主管最终审核",assignee:"总监"}},{id:"activity-4",shape:"activity",x:650,y:260,width:120,height:60,label:"驳回处理",data:{description:"处理驳回流程",assignee:"专员"}},{id:"end-1",shape:"event",x:820,y:140,width:50,height:50,label:"审批通过",data:{type:"end"}},{id:"end-2",shape:"event",x:820,y:280,width:50,height:50,label:"审批驳回",data:{type:"end"}},{id:"edge-1",shape:"bpmn-edge",source:"start-1",target:"activity-1",x:0,y:0},{id:"edge-2",shape:"bpmn-edge",source:"activity-1",target:"activity-2",x:0,y:0},{id:"edge-3",shape:"bpmn-edge",source:"activity-2",target:"gateway-1",x:0,y:0},{id:"edge-4",shape:"bpmn-edge",source:"gateway-1",target:"activity-3",label:"通过",x:0,y:0},{id:"edge-5",shape:"bpmn-edge",source:"gateway-1",target:"activity-4",label:"驳回",x:0,y:0},{id:"edge-6",shape:"bpmn-edge",source:"activity-3",target:"end-1",x:0,y:0},{id:"edge-7",shape:"bpmn-edge",source:"activity-4",target:"end-2",x:0,y:0}],me={class:"bpmn-layout"},ye={key:0,class:"top-toolbar"},fe={class:"toolbar-section"},he={class:"toolbar-group"},be={class:"toolbar-group"},xe={class:"toolbar-group"},we={class:"main-content"},ke={key:0,class:"left-panel"},Ce={class:"element-grid"},Fe=["onClick","title"],Ne={class:"graph-wrapper"},_e={key:0,class:"property-panel"},Ee={class:"property-item"},ze={class:"property-item"},Ae={key:0,class:"property-item"},Se={key:1,class:"property-item"},De={class:"form-actions"},Be=ee({__name:"index",props:{data:{},showToolbar:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1},width:{default:"100%"},height:{default:"600px"}},emits:["ready","data-change"],setup(x,{expose:N,emit:f}){const v=x,_=f,w=z(),h=z(!1),i=z(),t=z(),U=a=>ue[a]||a,V=()=>t.value?.centerContent(),j=()=>t.value?.zoomToFit({padding:50,maxScale:1}),G=a=>{if(!a)return[];if(Array.isArray(a))return a;const e=[];return Object.values(a).forEach(n=>{Array.isArray(n)&&e.push(...n)}),e},A=a=>{const e=a.attr("text/text")||a.attr("label/text")||"";return String(e)},L=()=>{const a=F.map(e=>({tagName:"circle",selector:`port-${e}`}));k.registerNode("event",{...b.event,markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"text"},...a],attrs:{...b.event.attrs,...B(F)}},!0),k.registerNode("activity",{...b.activity,markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"text"},...a],attrs:{...b.activity.attrs,...B(F)}},!0),k.registerNode("gateway",{...b.gateway,markup:[{tagName:"polygon",selector:"body"},{tagName:"text",selector:"text"},...a],attrs:{...b.gateway.attrs,...B(F)}},!0),k.registerEdge("bpmn-edge",pe,!0)},O=async()=>{if(!w.value)return;await ie();const a=w.value.clientWidth||800,e=w.value.clientHeight||500;if(t.value=new k({container:w.value,width:a,height:e,...M,connecting:{...M.connecting,createEdge:()=>t.value.createEdge({shape:"bpmn-edge"}),validateConnection:({sourceView:n,targetView:o,sourceMagnet:l,targetMagnet:r})=>n!==o&&!!l&&!!r&&l.getAttribute("magnet")==="true"&&r.getAttribute("magnet")==="true"}}),!v.readonly){t.value.on("node:dblclick",({node:o})=>I(o)),t.value.on("edge:click",({edge:o})=>{o.attr("line/stroke","#ff4d4f")}),t.value.on("edge:dblclick",({edge:o})=>{o.remove(),m()}),t.value.on("blank:click",()=>{t.value.getEdges().forEach(o=>{o.attr("line/stroke","#A2B1C3")})}),t.value.on("node:click",()=>{t.value.getEdges().forEach(o=>{o.attr("line/stroke","#A2B1C3")})}),t.value.on("edge:connected",m),t.value.on("node:moved",m);const n=(o,l)=>{F.forEach(r=>o.attr(`port-${r}/style/opacity`,l))};t.value.on("node:mouseenter",({node:o})=>n(o,1)),t.value.on("node:mouseleave",({node:o})=>n(o,0))}_("ready",t.value),W()},S=a=>{if(!t.value||!a.length)return;const e=[];a.forEach(n=>{const{data:o,...l}=n,r=n.shape==="bpmn-edge"?t.value.createEdge(l):t.value.createNode(l);o&&r.setData(o),e.push(r)}),t.value.resetCells(e),setTimeout(()=>t.value.zoomToFit({padding:50,maxScale:1}),200)},W=()=>{S(ve)},R=a=>{if(!t.value)return;const e=t.value.options.width/2,n=t.value.options.height/2,o=ge[a];if(o){const{data:l,...r}={id:`${a}-${Date.now()}`,x:e+Math.random()*100-50,y:n+Math.random()*100-50,...o},E=t.value.createNode(r);l&&E.setData(l),t.value.addCell(E),m()}},$=()=>{t.value&&(t.value.clearCells(),m())},I=a=>{const e=a.getData()||{};i.value={id:a.id,shape:a.shape,label:A(a),description:e.description||"",assignee:e.assignee||"",x:0,y:0},h.value=!0},X=()=>{if(!t.value||!i.value)return;const a=t.value.getCellById(i.value.id);a&&(a.setData({description:i.value.description,assignee:i.value.assignee}),a.attr("text/text",i.value.label||""),a.attr("label/text",i.value.label||"")),h.value=!1,m()},Y=()=>{!t.value||!i.value||(t.value.getCellById(i.value.id)?.remove(),h.value=!1,m())},D=()=>t.value?[...t.value.getNodes().map(e=>({id:e.id,shape:e.shape,x:e.getPosition().x,y:e.getPosition().y,width:e.getSize().width,height:e.getSize().height,label:A(e),data:e.getData()||{}})),...t.value.getEdges().map(e=>({id:e.id,shape:"bpmn-edge",source:e.getSourceCellId()||"",target:e.getTargetCellId()||"",label:A(e),x:0,y:0}))]:[],H=a=>{if(!t.value)return;const e=D();({png:()=>t.value.toPNG?.(o=>{const l=document.createElement("a");l.download="bpmn-diagram.png",l.href=o,l.click()}),svg:()=>t.value.toSVG?.(o=>{const l=document.createElement("a");l.download="bpmn-diagram.svg",l.href=o,l.click()}),json:()=>{const o=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),l=URL.createObjectURL(o),r=document.createElement("a");r.href=l,r.download="bpmn-diagram.json",r.click(),URL.revokeObjectURL(l)}})[a]?.()},m=()=>_("data-change",D());return te(()=>v.data,a=>{if(a&&t.value){const e=G(a);e.length>0&&S(e)}},{deep:!0}),ae(async()=>{L(),await O()}),N({getGraph:()=>t.value,getData:D,loadData:S}),(a,e)=>{const n=J,o=K,l=Q,r=q,E=Z;return g(),p("div",me,[x.showToolbar?(g(),p("div",ye,[s("div",fe,[s("div",he,[d(n,{onClick:$,size:"small"},{icon:c(()=>[...e[5]||(e[5]=[s("div",{class:"i-mdi-delete-outline"},null,-1)])]),default:c(()=>[e[6]||(e[6]=y(" 清空 ",-1))]),_:1})]),s("div",be,[d(n,{onClick:V,size:"small"},{icon:c(()=>[...e[7]||(e[7]=[s("div",{class:"i-mdi-image-filter-center-focus"},null,-1)])]),default:c(()=>[e[8]||(e[8]=y(" 居中 ",-1))]),_:1}),d(n,{onClick:j,size:"small"},{icon:c(()=>[...e[9]||(e[9]=[s("div",{class:"i-mdi-fit-to-screen"},null,-1)])]),default:c(()=>[e[10]||(e[10]=y(" 适应 ",-1))]),_:1})]),s("div",xe,[d(o,{options:P(de),onSelect:H},{default:c(()=>[d(n,{size:"small"},{icon:c(()=>[...e[11]||(e[11]=[s("div",{class:"i-mdi-export"},null,-1)])]),default:c(()=>[e[12]||(e[12]=y(" 导出 ",-1))]),_:1})]),_:1},8,["options"])])])])):C("",!0),s("div",we,[x.showToolbar?(g(),p("div",ke,[e[13]||(e[13]=s("div",{class:"panel-title"},"组件",-1)),s("div",Ce,[(g(!0),p(oe,null,le(P(ce),(u,T)=>(g(),p("div",{key:T,class:"element-item",onClick:Te=>R(T),title:u.title},[s("div",{class:se(["element-icon",u.iconClass])},null,2),s("span",null,ne(u.name),1)],8,Fe))),128))])])):C("",!0),s("div",Ne,[s("div",{ref_key:"containerRef",ref:w,class:"graph-container"},null,512)])]),d(E,{show:h.value,"onUpdate:show":e[4]||(e[4]=u=>h.value=u),width:"300",title:"属性设置"},{default:c(()=>[i.value?(g(),p("div",_e,[s("div",Ee,[e[14]||(e[14]=s("div",{class:"property-label"},"名称",-1)),d(l,{value:i.value.label,"onUpdate:value":e[0]||(e[0]=u=>i.value.label=u),placeholder:"请输入名称",size:"small"},null,8,["value"])]),s("div",ze,[e[15]||(e[15]=s("div",{class:"property-label"},"类型",-1)),d(l,{value:U(i.value.shape),readonly:"",size:"small"},null,8,["value"])]),i.value.shape==="activity"?(g(),p("div",Ae,[e[16]||(e[16]=s("div",{class:"property-label"},"描述",-1)),d(l,{value:i.value.description,"onUpdate:value":e[1]||(e[1]=u=>i.value.description=u),type:"textarea",rows:3,placeholder:"请输入活动描述",size:"small"},null,8,["value"])])):C("",!0),i.value.shape==="activity"?(g(),p("div",Se,[e[17]||(e[17]=s("div",{class:"property-label"},"执行人",-1)),d(l,{value:i.value.assignee,"onUpdate:value":e[2]||(e[2]=u=>i.value.assignee=u),placeholder:"请输入执行人",size:"small"},null,8,["value"])])):C("",!0),s("div",De,[d(r,null,{default:c(()=>[d(n,{onClick:X,type:"primary",size:"small"},{default:c(()=>[...e[18]||(e[18]=[y("保存",-1)])]),_:1}),d(n,{onClick:e[3]||(e[3]=u=>h.value=!1),size:"small"},{default:c(()=>[...e[19]||(e[19]=[y("取消",-1)])]),_:1}),d(n,{onClick:Y,type:"error",size:"small"},{default:c(()=>[...e[20]||(e[20]=[y("删除",-1)])]),_:1})]),_:1})])])):C("",!0)]),_:1},8,["show"])])}}}),je=re(Be,[["__scopeId","data-v-77d433fa"]]);export{je as default};
