import{ab as k,r as c,c as p,a as i}from"./vue-vendor-DgJqRHrX.js";import{a as w,r as g}from"./index-DbUecRfU.js";const s=w.create({baseURL:"/api",timeout:15e3,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(t=>{const e=h();return e.token&&(t.headers.Authorization=`Bearer ${e.token}`),t},t=>Promise.reject(t));s.interceptors.response.use(t=>{const e=t.data;if(e.code&&e.code!==200){switch(e.code){case 401:h().logout(),g.push("/login");break}return Promise.reject(new Error(e.message||"Error"))}else return e},t=>(t.response?.status===401&&(h().logout(),g.push("/login")),Promise.reject(t)));const o={get(t,e){return s.get(t,e)},post(t,e,a){return s.post(t,e,a)},put(t,e,a){return s.put(t,e,a)},delete(t,e){return s.delete(t,e)}},h=k("auth",()=>{const t=c(""),e=c(null),a=c(!1),m=p(()=>!!t.value&&!!e.value),v=p(()=>e.value?.role==="admin"),f=async(r,l)=>{a.value=!0;try{const u=await o.post("/auth/login",{username:r,password:l});t.value=u.data.token,e.value=u.data.user,o.defaults.headers.common.Authorization=`Bearer ${t.value}`,localStorage.setItem("auth_token",t.value),localStorage.setItem("auth_user",JSON.stringify(e.value))}catch(u){throw new Error(u.response?.data?.error||"Login failed")}finally{a.value=!1}},n=async()=>{try{await o.post("/auth/logout")}catch{}finally{t.value="",e.value=null,localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),delete o.defaults.headers.common.Authorization}},d=async()=>{try{const r=await o.get("/auth/me");e.value=r.data}catch(r){throw await n(),r}},S=()=>{const r=localStorage.getItem("auth_token"),l=localStorage.getItem("auth_user");if(r&&l)try{t.value=r,e.value=JSON.parse(l),o.defaults.headers.common.Authorization=`Bearer ${t.value}`,d().catch(()=>{n()})}catch{n()}},y=r=>{e.value&&(e.value={...e.value,...r},localStorage.setItem("auth_user",JSON.stringify(e.value)))};return{token:i(t),user:i(e),loading:i(a),isAuthenticated:m,isAdmin:v,login:f,logout:n,getCurrentUser:d,initializeAuth:S,updateUser:y}},{persist:{key:"terraria-panel-auth",storage:localStorage,paths:["token","user"]}});export{h as u};
