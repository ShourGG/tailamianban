import{k as U,r as K,e as W,c,o as Z,w as A,a as G,P as r,Q as a,J as n,F as _,M as h,Z as v,a6 as L,R as g,U as p,S as d,l as O,X as y,_ as S,v as Y,j,q as ee}from"./vue-vendor-DgJqRHrX.js";import{a6 as te,a7 as se,X as ne,M as ae,K as oe}from"./ui-vendor-Dblj447Y.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ie={class:"c-form-steps"},re={key:0,class:"single-panel"},ue={key:1,class:"steps-container"},ce={key:0,class:"step-header"},pe={class:"step-title"},de={key:0,class:"step-description"},fe={class:"step-form-items"},ve={class:"steps-actions"},me=U({__name:"index",props:{formItems:{},layoutConfig:{default:()=>({})},options:{default:()=>[]}},emits:["step-change","step-before-change","step-validate"],setup(V,{expose:X,emit:$}){const k=V,x=$,s=K(0),m=K(!1),w=W({}),i=c(()=>{const e=k.layoutConfig?.steps||{};return{steps:e.steps||[],vertical:e.vertical||!1,size:e.size||"medium",showStepHeader:e.showStepHeader!==!1,validateBeforeNext:e.validateBeforeNext||!1,prevButtonText:e.prevButtonText||"上一步",nextButtonText:e.nextButtonText||"下一步",defaultStep:e.defaultStep||0}}),B=c(()=>i.value.steps.length>0),o=c(()=>{if(!B.value)return[];const e=new Map;return i.value.steps.forEach(t=>{e.set(t.key,[])}),k.formItems.forEach((t,u)=>{const f=k.options?.[u]?.layout?.step||i.value.steps[0]?.key||"default";e.has(f)||e.set(f,[]),e.get(f).push(t)}),i.value.steps.map(t=>({config:t,items:e.get(t.key)||[]})).filter(t=>t.items.length>0)}),q=c(()=>{for(let e=0;e<=s.value;e++)if(w[e]===!1)return"error";return"process"}),J=c(()=>s.value===0),Q=c(()=>s.value===o.value.length-1),z=(e,t)=>{if(e.key!=null)return String(e.key);const u=e.props;return u?.path?u.path:`step-item-${t}`},M=async()=>{try{const t=await Promise.resolve(x("step-validate",s.value))!==!1;return w[s.value]=t,t}catch{return w[s.value]=!1,!1}},N=async(e,t=!1)=>{if(e<0||e>=o.value.length)return!1;if(e===s.value)return!0;try{return m.value=!0,t&&i.value.validateBeforeNext&&!await M()?!1:(await x("step-before-change",s.value,e),s.value=e,x("step-change",s.value,o.value[s.value].config.key),!0)}catch{return!1}finally{m.value=!1}},b=async()=>{await N(s.value+1,!0)},C=()=>{N(s.value-1)},D=async e=>{if(o.value[e]?.config.disabled)return;const t=e>s.value;await N(e,t)},F=()=>{if(!B.value||o.value.length===0)return;const{defaultStep:e}=i.value,t=e>=0&&e<o.value.length&&!o.value[e]?.config.disabled;s.value=t?e:0};return Z(()=>{F()}),A(()=>o.value,()=>F(),{immediate:!0}),X({nextStep:b,previousStep:C,goToStep:D,validateCurrentStep:M,currentStep:G(s),totalSteps:c(()=>o.value.length)}),(e,t)=>{const u=te,I=se,f=ne,P=ae,E=oe;return a(),r("div",ie,[n(B)?(a(),r("div",ue,[g(I,{current:n(s)+1,status:n(q),size:n(i).size,vertical:n(i).vertical,class:"steps-indicator"},{default:d(()=>[(a(!0),r(_,null,h(n(o),l=>(a(),v(u,{key:l.config.key,title:l.config.title,description:l.config.description,disabled:l.config.disabled},null,8,["title","description","disabled"]))),128))]),_:1},8,["current","status","size","vertical"]),g(f,{class:"steps-content",bordered:!1},{default:d(()=>[(a(!0),r(_,null,h(n(o),(l,T)=>O((a(),r("div",{key:l.config.key,class:"step-panel"},[n(i).showStepHeader?(a(),r("div",ce,[p("h3",pe,S(l.config.title),1),l.config.description?(a(),r("p",de,S(l.config.description),1)):y("",!0)])):y("",!0),p("div",fe,[(a(!0),r(_,null,h(l.items,(H,R)=>(a(),v(L(H),{key:z(H,R)}))),128))])])),[[Y,n(s)===T]])),128))]),_:1}),p("div",ve,[g(E,{justify:"space-between"},{default:d(()=>[n(s)>0?(a(),v(P,{key:0,disabled:n(m),onClick:C},{default:d(()=>[t[0]||(t[0]=p("div",{class:"i-mdi:chevron-left-first mr-1"},null,-1)),j(" "+S(n(i).prevButtonText),1)]),_:1},8,["disabled"])):y("",!0),t[2]||(t[2]=p("div",null,null,-1)),g(E,null,{default:d(()=>[n(s)<n(o).length-1?(a(),v(P,{key:0,type:"primary",loading:n(m),onClick:b},{default:d(()=>[j(S(n(i).nextButtonText)+" ",1),t[1]||(t[1]=p("div",{class:"i-mdi:chevron-right-last ml-1"},null,-1))]),_:1},8,["loading"])):y("",!0),ee(e.$slots,"step-actions",{currentStep:n(s),totalSteps:n(o).length,isFirstStep:n(J),isLastStep:n(Q),nextStep:b,previousStep:C,goToStep:D},void 0,!0)]),_:3})]),_:3})])])):(a(),r("div",re,[(a(!0),r(_,null,h(V.formItems,(l,T)=>(a(),v(L(l),{key:z(l,T)}))),128))]))])}}}),ye=le(me,[["__scopeId","data-v-866550c0"]]);export{ye as default};
