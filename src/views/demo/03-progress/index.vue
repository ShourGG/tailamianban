<template>
  <div class="progress-demo">
    <!-- åŸºç¡€çº¿æ€§è¿›åº¦æ¡ - æœ€å¸¸ç”¨çš„è¿›åº¦å±•ç¤ºæ–¹å¼ -->
    <NCard class="demo-section">
      <template #header>
        <div class="section-header">
          <h3>åŸºç¡€è¿›åº¦æ¡</h3>
          <p class="description">
            ç”¨äºå±•ç¤ºæ“ä½œè¿›åº¦ï¼Œå¦‚æ–‡ä»¶ä¸Šä¼ ã€æ•°æ®åŠ è½½ç­‰åœºæ™¯ã€‚æ”¯æŒåŠ¨ç”»æ•ˆæœï¼Œè®©è¿›åº¦å±•ç¤ºæ›´åŠ ç”ŸåŠ¨ã€‚
            é€‚ç”¨äºéœ€è¦æ˜ç¡®æ˜¾ç¤ºè¿›åº¦ç™¾åˆ†æ¯”çš„çº¿æ€§ä»»åŠ¡ã€‚
          </p>
        </div>
      </template>
      <!-- åŸºç¡€çº¿æ€§è¿›åº¦æ¡ï¼Œæ”¯æŒåŠ¨ç”»æ•ˆæœï¼Œé€‚åˆæ–‡ä»¶ä¸Šä¼ ã€ä¸‹è½½ç­‰åœºæ™¯ -->
      <C_Progress
        :percentage="60"
        :is-animation="true"
        :stroke-width="12"
      />
    </NCard>

    <!-- å•åœ†ç¯è¿›åº¦æ¡ - ç´§å‡‘å‹è®¾è®¡ -->
    <NCard class="demo-section">
      <template #header>
        <div class="section-header">
          <h3>åœ†å½¢è¿›åº¦æ¡</h3>
          <p class="description">
            é€‚ç”¨äºåœ¨é™å®šç©ºé—´å†…å±•ç¤ºè¿›åº¦çš„åœºæ™¯ï¼Œå¦‚ä»»åŠ¡å®Œæˆåº¦ã€é¡¹ç›®è¿›åº¦ç­‰ã€‚åœ†å½¢è®¾è®¡æ›´åŠ ç´§å‡‘ç¾è§‚ï¼Œ
            é€‚åˆåœ¨å¡ç‰‡ã€ä»ªè¡¨æ¿ç­‰ç©ºé—´å—é™çš„ç•Œé¢ä¸­ä½¿ç”¨ã€‚
          </p>
        </div>
      </template>
      <!-- å•åœ†ç¯è¿›åº¦æ¡ï¼Œé€‚åˆç©ºé—´å—é™çš„åœºæ™¯ï¼Œå¦‚å¡ç‰‡å±•ç¤º -->
      <C_Progress
        type="circle"
        :percentage="75"
        color="#18a058"
        :stroke-width="10"
        :is-animation="true"
      />
    </NCard>

    <!-- å¤šåœ†ç¯èµ›è·‘è¿›åº¦æ¡ - å¤šä»»åŠ¡å¹¶è¡Œå±•ç¤º -->
    <NCard class="demo-section">
      <template #header>
        <div class="section-header">
          <h3>åœˆåœˆèµ›è·‘</h3>
          <p class="description">
            å¤šåœ†ç¯åŠ¨æ€è¿›åº¦å±•ç¤ºï¼Œé€‚ç”¨äºå¤šä»»åŠ¡å¹¶è¡Œå¤„ç†ã€å¤šç»´åº¦æ•°æ®åŠ è½½ç­‰åœºæ™¯ã€‚åŠ¨ç”»æ•ˆæœå¢å¼ºç”¨æˆ·ä½“éªŒï¼Œ
            å¯ä»¥åŒæ—¶å¯¹æ¯”å¤šä¸ªä»»åŠ¡çš„å®Œæˆæƒ…å†µã€‚
          </p>
        </div>
      </template>
      <!-- å¤šåœ†ç¯èµ›è·‘æ•ˆæœï¼Œé€‚åˆå¤šä»»åŠ¡å¹¶è¡Œå¤„ç†çš„åœºæ™¯å±•ç¤º -->
      <C_Progress
        type="multiple-circle"
        :percentage="circlePercentages"
        :color="[
          'var(--primary-color)',
          'var(--success-color)',
          'var(--warning-color)',
        ]"
        :rail-style="[
          { stroke: 'var(--primary-color)', opacity: 0.2 },
          { stroke: 'var(--success-color)', opacity: 0.2 },
          { stroke: 'var(--warning-color)', opacity: 0.2 },
        ]"
      >
        <template #indicator>
          <div class="race-indicator">
            <div class="race-title">åœˆåœˆèµ›è·‘ï¼</div>
            <div class="race-speeds">
              <span>ğŸƒâ€â™‚ï¸ {{ circlePercentages[0] }}%</span>
              <span>ğŸƒâ€â™€ï¸ {{ circlePercentages[1] }}%</span>
              <span>ğŸƒ {{ circlePercentages[2] }}%</span>
            </div>
          </div>
        </template>
      </C_Progress>
    </NCard>

    <!-- NaiveUI åŸç”Ÿå¤šåœ†ç¯è¿›åº¦æ¡ - ç®€æ´åŒç¯å±•ç¤º -->
    <NCard class="demo-section">
      <template #header>
        <div class="section-header">
          <h3>åŒç¯è¿›åº¦æ¡</h3>
          <p class="description">
            ä½¿ç”¨ NaiveUI
            åŸç”Ÿç»„ä»¶çš„åŒç¯è¿›åº¦æ¡ï¼Œé€‚ç”¨äºéœ€è¦åŒæ—¶å±•ç¤ºä¸¤ä¸ªç›¸å…³æŒ‡æ ‡çš„åœºæ™¯ï¼Œ
            å¦‚å†…å­˜ä½¿ç”¨ç‡ä¸CPUä½¿ç”¨ç‡ã€å®Œæˆä»»åŠ¡ä¸æ€»ä»»åŠ¡ç­‰å¯¹æ¯”å±•ç¤ºã€‚
          </p>
        </div>
      </template>
      <!-- NaiveUI åŸç”ŸåŒç¯è¿›åº¦æ¡ï¼Œé€‚åˆå±•ç¤ºä¸¤ä¸ªç›¸å…³è”çš„è¿›åº¦æŒ‡æ ‡ -->
      <NProgress
        style="width: 120px"
        type="multiple-circle"
        :stroke-width="10"
        :circle-gap="10"
        :percentage="multipleCirclePercentages"
        :color="[themeVars.infoColor, themeVars.successColor]"
        :rail-color="[
          changeColor(themeVars.infoColor, { alpha: 0.2 }),
          changeColor(themeVars.successColor, { alpha: 0.2 }),
        ]"
      />
    </NCard>

    <!-- ä»ªè¡¨ç›˜è¿›åº¦æ¡ - ç›‘æ§ç±»åœºæ™¯ä¸“ç”¨ -->
    <NCard class="demo-section">
      <template #header>
        <div class="section-header">
          <h3>ä»ªè¡¨ç›˜è¿›åº¦æ¡</h3>
          <p class="description">
            ä»ªè¡¨ç›˜å½¢å¼å±•ç¤ºè¿›åº¦ï¼Œé€‚ç”¨äºç³»ç»Ÿæ€§èƒ½ç›‘æ§ã€èµ„æºä½¿ç”¨ç‡ç­‰åœºæ™¯ã€‚ç›´è§‚å±•ç¤ºå½“å‰çŠ¶æ€ï¼Œ
            ç±»ä¼¼æ±½è½¦ä»ªè¡¨ç›˜çš„è®¾è®¡ï¼Œé€‚åˆç›‘æ§ç±»åº”ç”¨çš„æ•°æ®å±•ç¤ºã€‚
          </p>
        </div>
      </template>
      <!-- ä»ªè¡¨ç›˜æ ·å¼è¿›åº¦æ¡ï¼Œé€‚åˆç³»ç»Ÿç›‘æ§ã€æ€§èƒ½æŒ‡æ ‡ç­‰åœºæ™¯ -->
      <C_Progress
        type="dashboard"
        :percentage="85"
        :gap-degree="90"
        status="success"
        :is-animation="true"
      />
    </NCard>
  </div>
</template>

<script lang="ts" setup>
  import { useThemeVars } from 'naive-ui'
  import { changeColor } from 'seemly'

  // è·å–ä¸»é¢˜å˜é‡ï¼Œç”¨äºè®¾ç½®è¿›åº¦æ¡é¢œè‰²
  const themeVars = useThemeVars()

  // å¤šåœ†ç¯èµ›è·‘è¿›åº¦æ•°ç»„ï¼Œæ¨¡æ‹Ÿä¸‰ä¸ªå¹¶è¡Œä»»åŠ¡çš„è¿›å±•
  const circlePercentages = ref([0, 0, 0])

  // NaiveUI åŒç¯è¿›åº¦æ¡æ•°æ®ï¼Œæ¨¡æ‹Ÿä¸¤ä¸ªç›¸å…³æŒ‡æ ‡
  const multipleCirclePercentages = ref([30, 60])

  // å®šæ—¶å™¨å¼•ç”¨ï¼Œç”¨äºæ¸…ç†åŠ¨ç”»
  let raceTimer: NodeJS.Timer | null = null
  let doubleTimer: NodeJS.Timer | null = null

  /**
   * æ›´æ–°åœˆåœˆèµ›è·‘çš„è¿›åº¦ç™¾åˆ†æ¯”
   * æ¯ä¸ªåœ†ç¯ä»¥ä¸åŒçš„éšæœºé€Ÿåº¦å¢é•¿ï¼Œæ¨¡æ‹ŸçœŸå®çš„å¹¶è¡Œä»»åŠ¡è¿›å±•
   */
  const updateRacePercentages = () => {
    circlePercentages.value = circlePercentages.value.map(
      p => (p + Math.random() * 2 + 1) % 100 // 1-3çš„éšæœºé€Ÿåº¦å¢é•¿
    )
  }

  /**
   * æ›´æ–°åŒç¯è¿›åº¦æ¡çš„ç™¾åˆ†æ¯”
   * ä¸¤ä¸ªç¯ä»¥ä¸åŒé€Ÿåº¦å˜åŒ–ï¼Œå±•ç¤ºç›¸å…³æ€§æŒ‡æ ‡
   */
  const updateDoublePercentages = () => {
    multipleCirclePercentages.value = multipleCirclePercentages.value.map(
      (p, index) => {
        // ç¬¬ä¸€ä¸ªç¯å˜åŒ–ç¨å¿«ï¼Œç¬¬äºŒä¸ªç¯å˜åŒ–ç¨æ…¢
        const speed =
          index === 0 ? Math.random() * 1.5 + 0.5 : Math.random() * 1 + 0.3
        return (p + speed) % 100
      }
    )
  }

  // ç»„ä»¶æŒ‚è½½æ—¶å¯åŠ¨åŠ¨ç”»å®šæ—¶å™¨
  onMounted(() => {
    // åœˆåœˆèµ›è·‘åŠ¨ç”»ï¼Œæ›´æ–°é¢‘ç‡è¾ƒé«˜
    raceTimer = setInterval(updateRacePercentages, 100)
    // åŒç¯åŠ¨ç”»ï¼Œæ›´æ–°é¢‘ç‡é€‚ä¸­
    doubleTimer = setInterval(updateDoublePercentages, 150)
  })

  // ç»„ä»¶å¸è½½å‰æ¸…ç†å®šæ—¶å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼
  onBeforeUnmount(() => {
    raceTimer && clearInterval(raceTimer)
    doubleTimer && clearInterval(doubleTimer)
  })
</script>

<style lang="scss" scoped>
  .progress-demo {
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 24px;

    .demo-section {
      .section-header {
        h3 {
          margin: 0 0 8px 0;
          font-size: 16px;
          font-weight: 600;
        }

        .description {
          margin: 0;
          color: var(--text-color-3);
          font-size: 14px;
          line-height: 1.6;
        }
      }

      // å¡ç‰‡å†…å®¹åŒºåŸŸ - è¿›åº¦æ¡å±…ä¸­å±•ç¤º
      :deep(.n-card__content) {
        padding: 24px;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 200px;
      }
    }

    // åœˆåœˆèµ›è·‘æŒ‡ç¤ºå™¨æ ·å¼
    .race-indicator {
      text-align: center;

      .race-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--text-color-1);
      }

      .race-speeds {
        display: flex;
        flex-direction: column;
        gap: 4px;
        font-size: 14px;
        color: var(--text-color-2);

        span {
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 4px;
        }
      }
    }
  }
</style>
